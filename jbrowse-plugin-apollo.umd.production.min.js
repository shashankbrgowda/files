!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jbrowse/core/Plugin"),require("@jbrowse/core/util"),require("mobx-state-tree"),require("@jbrowse/core/configuration"),require("@jbrowse/core/pluggableElementTypes"),require("react/jsx-runtime"),require("@mui/material/utils"),require("@mui/material"),require("mobx"),require("react"),require("tss-react/mui"),require("@mui/x-data-grid"),require("@jbrowse/core/ui"),require("mobx-react"),require("@jbrowse/core/util/types/mst"),require("@jbrowse/core/util/io"),require("@mui/material/Checkbox"),require("@mui/material/FormControlLabel"),require("@mui/material/LinearProgress"),require("@jbrowse/core/pluggableElementTypes/AdapterType"),require("@jbrowse/core/data_adapters/BaseAdapter"),require("@jbrowse/core/util/rxjs"),require("@jbrowse/core/util/tracks")):"function"==typeof define&&define.amd?define(["exports","@jbrowse/core/Plugin","@jbrowse/core/util","mobx-state-tree","@jbrowse/core/configuration","@jbrowse/core/pluggableElementTypes","react/jsx-runtime","@mui/material/utils","@mui/material","mobx","react","tss-react/mui","@mui/x-data-grid","@jbrowse/core/ui","mobx-react","@jbrowse/core/util/types/mst","@jbrowse/core/util/io","@mui/material/Checkbox","@mui/material/FormControlLabel","@mui/material/LinearProgress","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/data_adapters/BaseAdapter","@jbrowse/core/util/rxjs","@jbrowse/core/util/tracks"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JBrowsePluginApollo={},e.JBrowseExports["@jbrowse/core/Plugin"],e.JBrowseExports["@jbrowse/core/util"],e.JBrowseExports["mobx-state-tree"],e.JBrowseExports["@jbrowse/core/configuration"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes"],e.JBrowseExports["react/jsx-runtime"],e.JBrowseExports["@mui/material/utils"],e.JBrowseExports["@mui/material"],e.JBrowseExports.mobx,e.JBrowseExports.react,e.JBrowseExports["tss-react/mui"],e.JBrowseExports["@mui/x-data-grid"],e.JBrowseExports["@jbrowse/core/ui"],e.JBrowseExports["mobx-react"],e.JBrowseExports["@jbrowse/core/util/types/mst"],e.JBrowseExports["@jbrowse/core/util/io"],e.JBrowseExports["@mui/material/Checkbox"],e.JBrowseExports["@mui/material/FormControlLabel"],e.JBrowseExports["@mui/material/LinearProgress"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/AdapterType"],e.JBrowseExports["@jbrowse/core/data_adapters/BaseAdapter"],e.JBrowseExports["@jbrowse/core/util/rxjs"],e.JBrowseExports["@jbrowse/core/util/tracks"])}(this,(function(e,t,n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S){"use strict";function E(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function k(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,t}var C=E(t),A=E(n),O=E(r),T=E(u),N=k(u),I=E(y),R=E(v),F=E(b),P=E(_),M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function D(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}function j(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var L={};function q(e){var t,n;function r(t,n){try{var o=e[t](n),i=o.value,s=i instanceof B;Promise.resolve(s?i.v:i).then((function(n){if(s){var l="return"===t?"return":"next";if(!i.k||n.done)return r(l,n);n=e[l](n).value}a(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise((function(o,i){var s={key:e,arg:a,resolve:o,reject:i,next:null};n?n=n.next=s:(t=n=s,r(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function B(e,t){this.v=e,this.k=t}function U(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new z(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function z(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return z=function(e){this.s=e,this.n=e.next},z.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new z(e)}function G(e){return new B(e,0)}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(){V=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=Object.create((t&&t.prototype instanceof y?t:y).prototype),i=new N(r||[]);return a(o,"_invoke",{value:C(e,n,i)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var f="suspendedStart",p="suspendedYield",h="executing",m="completed",g={};function y(){}function v(){}function b(){}var _={};c(_,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(I([])));x&&x!==n&&r.call(x,i)&&(_=x);var S=b.prototype=y.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,o,i,s){var l=d(e[a],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(u).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function C(t,n,r){var a=f;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var l=A(s,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===f)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var c=d(t,n,r);if("normal"===c.type){if(a=r.done?m:p,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}function A(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=d(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=b,a(S,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new k(u(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(S),c(S,l,"Generator"),c(S,i,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function J(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){J(o,r,a,i,s,"next",e)}function s(e){J(o,r,a,i,s,"throw",e)}i(void 0)}))}}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,be(r.key),r)}}function X(e,t,n){return t&&Z(e.prototype,t),n&&Z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Q(e,t,n){return(t=be(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}function te(e){return te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},te(e)}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}function re(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ae(e,t,n){return ae=re()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&ne(a,n.prototype),a},ae.apply(null,arguments)}function oe(e){var t="function"==typeof Map?new Map:void 0;return oe=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ae(e,arguments,te(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ne(n,e)},oe(e)}function ie(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e){var t=re();return function(){var n,r=te(e);if(t){var a=te(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return se(e)}(this,n)}}function ce(){return ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=te(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},ce.apply(this,arguments)}function ue(e,t){return pe(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(e,t)||me(e,t)||ye()}function de(e){return pe(e)||he(e)||me(e)||ye()}function fe(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||he(e)||me(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(e){if(Array.isArray(e))return e}function he(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function me(e,t){if(e){if("string"==typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ge(e,t):void 0}}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ye(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ve(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=me(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function be(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}q.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},q.prototype.next=function(e){return this._invoke("next",e)},q.prototype.throw=function(e){return this._invoke("throw",e)},q.prototype.return=function(e){return this._invoke("return",e)};var _e=function(e,t){return _e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},_e(e,t)};function we(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}_e(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var xe=function(){return xe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},xe.apply(this,arguments)};function Se(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function Ee(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":W(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function ke(e,t){return function(n,r){t(n,r,e)}}function Ce(e,t){if("object"===("undefined"==typeof Reflect?"undefined":W(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Ae(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function Oe(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var Te=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function Ne(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Te(t,e,n)}function Ie(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Re(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function Fe(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Re(arguments[t]));return e}function Pe(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}function Me(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}function De(e){return this instanceof De?(this.v=e,this):new De(e)}function je(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof De?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Le(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:De(e[r](t)),done:!1}:a?a(t):t}:a}}function qe(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ie(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}}function Be(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Ue=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function ze(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&Te(t,e,n);return Ue(t,e),t}function Ge(e){return e&&e.__esModule?e:{default:e}}function He(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function $e(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n}function Ve(e,t){if(null===t||"object"!==W(t)&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function We(e,t,n){if(null!=t){if("object"!==W(t)&&"function"!=typeof t)throw new TypeError("Object expected.");var r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose]}if("function"!=typeof r)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var Je="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function Ye(e){function t(t){e.error=e.hasError?new Je(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var r=e.stack.pop();try{var a=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(a).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}var Ke={__proto__:null,__extends:we,get __assign(){return xe},__rest:Se,__decorate:Ee,__param:ke,__esDecorate:function(e,t,n,r,a,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),f=!1,p=n.length-1;p>=0;p--){var h={};for(var m in r)h[m]="access"===m?{}:r[m];for(var m in r.access)h.access[m]=r.access[m];h.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var g=(0,n[p])("accessor"===l?{get:d.get,set:d.set}:d[c],h);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!==W(g))throw new TypeError("Object expected");(s=i(g.get))&&(d.get=s),(s=i(g.set))&&(d.set=s),(s=i(g.init))&&a.unshift(s)}else(s=i(g))&&("field"===l?a.unshift(s):d[c]=s)}u&&Object.defineProperty(u,r.name,d),f=!0},__runInitializers:function(e,t,n){for(var r=arguments.length>2,a=0;a<t.length;a++)n=r?t[a].call(e,n):t[a].call(e);return r?n:void 0},__propKey:function(e){return"symbol"===W(e)?e:"".concat(e)},__setFunctionName:function(e,t,n){return"symbol"===W(t)&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})},__metadata:Ce,__awaiter:Ae,__generator:Oe,__createBinding:Te,__exportStar:Ne,__values:Ie,__read:Re,__spread:Fe,__spreadArrays:Pe,__spreadArray:Me,__await:De,__asyncGenerator:je,__asyncDelegator:Le,__asyncValues:qe,__makeTemplateObject:Be,__importStar:ze,__importDefault:Ge,__classPrivateFieldGet:He,__classPrivateFieldSet:$e,__classPrivateFieldIn:Ve,__addDisposableResource:We,__disposeResources:Ye,default:{__extends:we,__assign:xe,__rest:Se,__decorate:Ee,__param:ke,__metadata:Ce,__awaiter:Ae,__generator:Oe,__createBinding:Te,__exportStar:Ne,__values:Ie,__read:Re,__spread:Fe,__spreadArrays:Pe,__spreadArray:Me,__await:De,__asyncGenerator:je,__asyncDelegator:Le,__asyncValues:qe,__makeTemplateObject:Be,__importStar:ze,__importDefault:Ge,__classPrivateFieldGet:He,__classPrivateFieldSet:$e,__classPrivateFieldIn:Ve,__addDisposableResource:We,__disposeResources:Ye}},Ze=D(Ke),Xe={};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.ApolloPlugin=void 0;var Qe=function(e){ee(n,e);var t=le(n);function n(){return K(this,n),t.apply(this,arguments)}return X(n,[{key:"apolloInstall",value:function(e){}}]),n}(Ze.__importDefault(C.default).default);Xe.ApolloPlugin=Qe;var et={},tt={},nt={};Object.defineProperty(nt,"__esModule",{value:!0}),nt.changeRegistry=void 0,nt.changeRegistry=new(function(){function e(){K(this,e),this.changes=new Map}return X(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var rt={};Object.defineProperty(rt,"__esModule",{value:!0}),rt.Operation=void 0;var at=function(){function e(t,n){var r;K(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return X(e,[{key:"execute",value:(t=Y(V().mark((function e(t){var n,r;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();rt.Operation=at,Object.defineProperty(tt,"__esModule",{value:!0}),tt.Change=void 0,tt.isChange=function(e){return void 0!==e.executeOnClient};var ot=nt,it=function(e){ee(r,e);var t,n=le(r);function r(){return K(this,r),n.apply(this,arguments)}return X(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Y(V().mark((function e(t){var n;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",ce(te(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(ot.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(rt.Operation);tt.Change=it,Object.defineProperty(et,"__esModule",{value:!0}),et.AssemblySpecificChange=void 0,et.isAssemblySpecificChange=function(e){return(0,st.isChange)(e)&&void 0!==e.assembly};var st=tt,lt=function(e){ee(n,e);var t=le(n);function n(e,r){var a;return K(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return X(n,[{key:"getIndexedIds",value:function(e,t){var n,r,a=[],o=ve(null!=t?t:[]);try{for(o.s();!(r=o.n()).done;){var i=null===(n=e.attributes)||void 0===n?void 0:n[r.value];i&&a.push(i[0])}}catch(e){o.e(e)}finally{o.f()}if(e.children)for(var s=0,l=Object.values(e.children);s<l.length;s++){var c=this.getIndexedIds(l[s],t);a.push.apply(a,fe(c))}return a}}]),n}(st.Change);et.AssemblySpecificChange=lt;var ct={};Object.defineProperty(ct,"__esModule",{value:!0}),ct.Check=void 0,ct.Check=X((function e(){K(this,e)}));var ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.checkRegistry=void 0,ut.checkRegistry=new(function(){function e(){K(this,e),this.checks=new Map}return X(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var dt={},ft="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function pt(){throw new Error("setTimeout has not been defined")}function ht(){throw new Error("clearTimeout has not been defined")}var mt=pt,gt=ht;function yt(e){if(mt===setTimeout)return setTimeout(e,0);if((mt===pt||!mt)&&setTimeout)return mt=setTimeout,setTimeout(e,0);try{return mt(e,0)}catch(t){try{return mt.call(null,e,0)}catch(t){return mt.call(this,e,0)}}}"function"==typeof ft.setTimeout&&(mt=setTimeout),"function"==typeof ft.clearTimeout&&(gt=clearTimeout);var vt,bt=[],_t=!1,wt=-1;function xt(){_t&&vt&&(_t=!1,vt.length?bt=vt.concat(bt):wt=-1,bt.length&&St())}function St(){if(!_t){var e=yt(xt);_t=!0;for(var t=bt.length;t;){for(vt=bt,bt=[];++wt<t;)vt&&vt[wt].run();wt=-1,t=bt.length}vt=null,_t=!1,function(e){if(gt===clearTimeout)return clearTimeout(e);if((gt===ht||!gt)&&clearTimeout)return gt=clearTimeout,clearTimeout(e);try{return gt(e)}catch(t){try{return gt.call(null,e)}catch(t){return gt.call(this,e)}}}(e)}}function Et(e,t){this.fun=e,this.array=t}function kt(){}Et.prototype.run=function(){this.fun.apply(null,this.array)};var Ct=kt,At=kt,Ot=kt,Tt=kt,Nt=kt,It=kt,Rt=kt,Ft=ft.performance||{},Pt=Ft.now||Ft.mozNow||Ft.msNow||Ft.oNow||Ft.webkitNow||function(){return(new Date).getTime()},Mt=new Date,Dt={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];bt.push(new Et(e,t)),1!==bt.length||_t||yt(St)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ct,addListener:At,once:Ot,off:Tt,removeListener:Nt,removeAllListeners:It,emit:Rt,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Pt.call(Ft),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Mt)/1e3}},jt=[],Lt=[],qt="undefined"!=typeof Uint8Array?Uint8Array:Array,Bt=!1;function Ut(){Bt=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)jt[t]=e[t],Lt[e.charCodeAt(t)]=t;Lt["-".charCodeAt(0)]=62,Lt["_".charCodeAt(0)]=63}function zt(e,t,n){for(var r,a=[],o=t;o<n;o+=3)a.push(jt[(r=(e[o]<<16)+(e[o+1]<<8)+e[o+2])>>18&63]+jt[r>>12&63]+jt[r>>6&63]+jt[63&r]);return a.join("")}function Gt(e,t,n,r,a){var o,i,s=8*a-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?a-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+d],d+=f,u-=8);for(i=o&(1<<-u)-1,o>>=-u,u+=r;u>0;i=256*i+e[t+d],d+=f,u-=8);if(0===o)o=1-c;else{if(o===l)return i?NaN:Infinity*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function Ht(e,t,n,r,a,o){var i,s,l,c=8*o-a-1,u=(1<<c)-1,d=u>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||Infinity===t?(s=isNaN(t)?1:0,i=u):(i=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-i))<1&&(i--,l*=2),(t+=i+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(i++,l/=2),i+d>=u?(s=0,i=u):i+d>=1?(s=(t*l-1)*Math.pow(2,a),i+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),i=0));a>=8;e[n+p]=255&s,p+=h,s/=256,a-=8);for(i=i<<a|s,c+=a;c>0;e[n+p]=255&i,p+=h,i/=256,c-=8);e[n+p-h]|=128*m}var $t={}.toString,Vt=Array.isArray||function(e){return"[object Array]"==$t.call(e)};function Wt(){return Yt.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Jt(e,t){if(Wt()<t)throw new RangeError("Invalid typed array length");return Yt.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Yt.prototype:(null===e&&(e=new Yt(t)),e.length=t),e}function Yt(e,t,n){if(!(Yt.TYPED_ARRAY_SUPPORT||this instanceof Yt))return new Yt(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return Xt(this,e)}return Kt(this,e,t,n)}function Kt(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),Yt.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Yt.prototype:e=Qt(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Yt.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|nn(t,n),a=(e=Jt(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(tn(t)){var n=0|en(t.length);return 0===(e=Jt(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?Jt(e,0):Qt(e,t);if("Buffer"===t.type&&Vt(t.data))return Qt(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Zt(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function Xt(e,t){if(Zt(t),e=Jt(e,t<0?0:0|en(t)),!Yt.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Qt(e,t){var n=t.length<0?0:0|en(t.length);e=Jt(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function en(e){if(e>=Wt())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Wt().toString(16)+" bytes");return 0|e}function tn(e){return!(null==e||!e._isBuffer)}function nn(e,t){if(tn(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Nn(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return In(e).length;default:if(r)return Nn(e).length;t=(""+t).toLowerCase(),r=!0}}function rn(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return bn(this,t,n);case"utf8":case"utf-8":return mn(this,t,n);case"ascii":return yn(this,t,n);case"latin1":case"binary":return vn(this,t,n);case"base64":return hn(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _n(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function an(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function on(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Yt.from(t,r)),tn(t))return 0===t.length?-1:sn(e,t,n,r,a);if("number"==typeof t)return t&=255,Yt.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):sn(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function sn(e,t,n,r,a){var o,i=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;i=2,s/=2,l/=2,n/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(a){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*i}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var d=!0,f=0;f<l;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function ln(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[n+i]=s}return i}function cn(e,t,n,r){return Rn(Nn(t,e.length-n),e,n,r)}function un(e,t,n,r){return Rn(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function dn(e,t,n,r){return un(e,t,n,r)}function fn(e,t,n,r){return Rn(In(t),e,n,r)}function pn(e,t,n,r){return Rn(function(e,t){for(var n,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a.push(n%256),a.push(r);return a}(t,e.length-n),e,n,r)}function hn(e,t,n){return function(e){var t;Bt||Ut();for(var n=e.length,r=n%3,a="",o=[],i=16383,s=0,l=n-r;s<l;s+=i)o.push(zt(e,s,s+i>l?l:s+i));return 1===r?(a+=jt[(t=e[n-1])>>2],a+=jt[t<<4&63],a+="=="):2===r&&(a+=jt[(t=(e[n-2]<<8)+e[n-1])>>10],a+=jt[t>>4&63],a+=jt[t<<2&63],a+="="),o.push(a),o.join("")}(0===t&&n===e.length?e:e.slice(t,n))}function mn(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var o,i,s,l,c=e[a],u=null,d=c>239?4:c>223?3:c>191?2:1;if(a+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[a+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:i=e[a+2],128==(192&(o=e[a+1]))&&128==(192&i)&&(l=(15&c)<<12|(63&o)<<6|63&i)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:i=e[a+2],s=e[a+3],128==(192&(o=e[a+1]))&&128==(192&i)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(r.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),r.push(u),a+=d}return function(e){var t=e.length;if(t<=gn)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=gn));return n}(r)}Yt.TYPED_ARRAY_SUPPORT=void 0===ft.TYPED_ARRAY_SUPPORT||ft.TYPED_ARRAY_SUPPORT,Yt.poolSize=8192,Yt._augment=function(e){return e.__proto__=Yt.prototype,e},Yt.from=function(e,t,n){return Kt(null,e,t,n)},Yt.TYPED_ARRAY_SUPPORT&&(Yt.prototype.__proto__=Uint8Array.prototype,Yt.__proto__=Uint8Array),Yt.alloc=function(e,t,n){return function(e,t,n,r){return Zt(t),t<=0?Jt(e,t):void 0!==n?"string"==typeof r?Jt(e,t).fill(n,r):Jt(e,t).fill(n):Jt(e,t)}(null,e,t,n)},Yt.allocUnsafe=function(e){return Xt(null,e)},Yt.allocUnsafeSlow=function(e){return Xt(null,e)},Yt.isBuffer=function(e){return null!=e&&(!!e._isBuffer||Fn(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Fn(e.slice(0,0))}(e))},Yt.compare=function(e,t){if(!tn(e)||!tn(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=Math.min(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},Yt.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Yt.concat=function(e,t){if(!Vt(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Yt.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Yt.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!tn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},Yt.byteLength=nn,Yt.prototype._isBuffer=!0,Yt.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)an(this,t,t+1);return this},Yt.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)an(this,t,t+3),an(this,t+1,t+2);return this},Yt.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)an(this,t,t+7),an(this,t+1,t+6),an(this,t+2,t+5),an(this,t+3,t+4);return this},Yt.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?mn(this,0,e):rn.apply(this,arguments)},Yt.prototype.equals=function(e){if(!tn(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Yt.compare(this,e)},Yt.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Yt.prototype.compare=function(e,t,n,r,a){if(!tn(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),i=(n>>>=0)-(t>>>=0),s=Math.min(o,i),l=this.slice(r,a),c=e.slice(t,n),u=0;u<s;++u)if(l[u]!==c[u]){o=l[u],i=c[u];break}return o<i?-1:i<o?1:0},Yt.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Yt.prototype.indexOf=function(e,t,n){return on(this,e,t,n,!0)},Yt.prototype.lastIndexOf=function(e,t,n){return on(this,e,t,n,!1)},Yt.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return ln(this,e,t,n);case"utf8":case"utf-8":return cn(this,e,t,n);case"ascii":return un(this,e,t,n);case"latin1":case"binary":return dn(this,e,t,n);case"base64":return fn(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pn(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Yt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var gn=4096;function yn(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function vn(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function bn(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",o=t;o<n;++o)a+=Tn(e[o]);return a}function _n(e,t,n){for(var r=e.slice(t,n),a="",o=0;o<r.length;o+=2)a+=String.fromCharCode(r[o]+256*r[o+1]);return a}function wn(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function xn(e,t,n,r,a,o){if(!tn(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Sn(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function En(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-n,4);a<o;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function kn(e,t,n,r,a,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Cn(e,t,n,r,a){return a||kn(e,0,n,4),Ht(e,t,n,r,23,4),n+4}function An(e,t,n,r,a){return a||kn(e,0,n,8),Ht(e,t,n,r,52,8),n+8}Yt.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Yt.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Yt.prototype;else{var a=t-e;n=new Yt(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+e]}return n},Yt.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||wn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r},Yt.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||wn(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},Yt.prototype.readUInt8=function(e,t){return t||wn(e,1,this.length),this[e]},Yt.prototype.readUInt16LE=function(e,t){return t||wn(e,2,this.length),this[e]|this[e+1]<<8},Yt.prototype.readUInt16BE=function(e,t){return t||wn(e,2,this.length),this[e]<<8|this[e+1]},Yt.prototype.readUInt32LE=function(e,t){return t||wn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Yt.prototype.readUInt32BE=function(e,t){return t||wn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Yt.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||wn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},Yt.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||wn(e,t,this.length);for(var r=t,a=1,o=this[e+--r];r>0&&(a*=256);)o+=this[e+--r]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},Yt.prototype.readInt8=function(e,t){return t||wn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Yt.prototype.readInt16LE=function(e,t){t||wn(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Yt.prototype.readInt16BE=function(e,t){t||wn(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Yt.prototype.readInt32LE=function(e,t){return t||wn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Yt.prototype.readInt32BE=function(e,t){return t||wn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Yt.prototype.readFloatLE=function(e,t){return t||wn(e,4,this.length),Gt(this,e,!0,23,4)},Yt.prototype.readFloatBE=function(e,t){return t||wn(e,4,this.length),Gt(this,e,!1,23,4)},Yt.prototype.readDoubleLE=function(e,t){return t||wn(e,8,this.length),Gt(this,e,!0,52,8)},Yt.prototype.readDoubleBE=function(e,t){return t||wn(e,8,this.length),Gt(this,e,!1,52,8)},Yt.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||xn(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},Yt.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||xn(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},Yt.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,1,255,0),Yt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Yt.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,2,65535,0),Yt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Sn(this,e,t,!0),t+2},Yt.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,2,65535,0),Yt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Sn(this,e,t,!1),t+2},Yt.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,4,4294967295,0),Yt.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):En(this,e,t,!0),t+4},Yt.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,4,4294967295,0),Yt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):En(this,e,t,!1),t+4},Yt.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);xn(this,e,t,n,a-1,-a)}var o=0,i=1,s=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},Yt.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);xn(this,e,t,n,a-1,-a)}var o=n-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},Yt.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,1,127,-128),Yt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Yt.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,2,32767,-32768),Yt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Sn(this,e,t,!0),t+2},Yt.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,2,32767,-32768),Yt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Sn(this,e,t,!1),t+2},Yt.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,4,2147483647,-2147483648),Yt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):En(this,e,t,!0),t+4},Yt.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||xn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Yt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):En(this,e,t,!1),t+4},Yt.prototype.writeFloatLE=function(e,t,n){return Cn(this,e,t,!0,n)},Yt.prototype.writeFloatBE=function(e,t,n){return Cn(this,e,t,!1,n)},Yt.prototype.writeDoubleLE=function(e,t,n){return An(this,e,t,!0,n)},Yt.prototype.writeDoubleBE=function(e,t,n){return An(this,e,t,!1,n)},Yt.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,o=r-n;if(this===e&&n<t&&t<r)for(a=o-1;a>=0;--a)e[a+t]=this[a+n];else if(o<1e3||!Yt.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Yt.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Yt.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var i=tn(e)?e:Nn(new Yt(e,r).toString()),s=i.length;for(o=0;o<n-t;++o)this[o+t]=i[o%s]}return this};var On=/[^+\/0-9A-Za-z-_]/g;function Tn(e){return e<16?"0"+e.toString(16):e.toString(16)}function Nn(e,t){var n;t=t||Infinity;for(var r=e.length,a=null,o=[],i=0;i<r;++i){if((n=e.charCodeAt(i))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(t-=3)>-1&&o.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function In(e){return function(e){var t,n,r,a,o,i;Bt||Ut();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=new qt(3*s/4-(o="="===e[s-2]?2:"="===e[s-1]?1:0)),r=o>0?s-4:s;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)a=Lt[e.charCodeAt(t)]<<18|Lt[e.charCodeAt(t+1)]<<12|Lt[e.charCodeAt(t+2)]<<6|Lt[e.charCodeAt(t+3)],i[l++]=a>>16&255,i[l++]=a>>8&255,i[l++]=255&a;return 2===o?(a=Lt[e.charCodeAt(t)]<<2|Lt[e.charCodeAt(t+1)]>>4,i[l++]=255&a):1===o&&(a=Lt[e.charCodeAt(t)]<<10|Lt[e.charCodeAt(t+1)]<<4|Lt[e.charCodeAt(t+2)]>>2,i[l++]=a>>8&255,i[l++]=255&a),i}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(On,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Rn(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function Fn(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}for(var Pn=Math.floor(16777215*Math.random()),Mn=Gn.index=parseInt(16777215*Math.random(),10),Dn=(void 0===Dt||"number"!=typeof Dt.pid?Math.floor(1e5*Math.random()):Dt.pid)%65535,jn=function(){try{return _Buffer}catch(e){try{return Yt}catch(e){return null}}}(),Ln=function(e){return!(null==e||!e.constructor||"function"!=typeof e.constructor.isBuffer||!e.constructor.isBuffer(e))},qn=[],Bn=0;Bn<256;Bn++)qn[Bn]=(Bn<=15?"0":"")+Bn.toString(16);var Un=new RegExp("^[0-9a-fA-F]{24}$"),zn=[];for(Bn=0;Bn<10;)zn[48+Bn]=Bn++;for(;Bn<16;)zn[55+Bn]=zn[87+Bn]=Bn++;function Gn(e){if(!(this instanceof Gn))return new Gn(e);if(e&&(e instanceof Gn||"ObjectID"===e._bsontype))return e;if(this._bsontype="ObjectID",null!=e&&"number"!=typeof e){var t=Gn.isValid(e);if(!t&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(t&&"string"==typeof e&&24===e.length)return Gn.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&"function"==typeof e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e}else this.id=this.generate(e)}var Hn=Gn;Gn.default=Gn,Gn.createFromTime=function(e){return new Gn(function(e,t){return 8===(t=t.toString(16)).length?t:"00000000".substring(t.length,8)+t}(0,e=parseInt(e,10)%4294967295)+"0000000000000000")},Gn.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var t="",n=0;n<24;)t+=String.fromCharCode(zn[e.charCodeAt(n++)]<<4|zn[e.charCodeAt(n++)]);return new Gn(t)},Gn.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&Un.test(e):e instanceof Gn||(Ln(e)?Gn.isValid(e.toString("hex")):!("function"!=typeof e.toHexString||!jn||!(e.id instanceof jn||"string"==typeof e.id))&&(12===e.id.length||24===e.id.length&&Un.test(e.id)))))},Gn.prototype={constructor:Gn,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(24===this.id.length)return this.id;if(Ln(this.id))return this.id.toString("hex");for(var e="",t=0;t<this.id.length;t++)e+=qn[this.id.charCodeAt(t)];return e},equals:function(e){return e instanceof Gn?this.toString()===e.toString():"string"==typeof e&&Gn.isValid(e)&&12===e.length&&Ln(this.id)?e===this.id.toString("binary"):"string"==typeof e&&Gn.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&Gn.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof Gn||e.toHexString))&&e.toHexString()===this.toHexString()},getTimestamp:function(){var e,t=new Date;return e=Ln(this.id)?this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,t.setTime(1e3*Math.floor(e)),t},generate:function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3)),e=parseInt(e,10)%4294967295;var t=Mn=(Mn+1)%16777215;return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e,Pn>>16&255,Pn>>8&255,255&Pn,Dn>>8&255,255&Dn,t>>16&255,t>>8&255,255&t)}};var $n=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";Gn.prototype[$n]=function(){return"ObjectID("+this+")"},Gn.prototype.toJSON=Gn.prototype.toHexString,Gn.prototype.toString=Gn.prototype.toHexString,Object.defineProperty(dt,"__esModule",{value:!0}),dt.FeatureChange=void 0,dt.isFeatureChange=function(e){return(0,Wn.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var Vn=Ze.__importDefault(Hn),Wn=et,Jn=function(e){ee(n,e);var t=le(n);function n(e,r){var a;return K(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return X(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=ve(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=ue(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=ve((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=ue(t.value,2);n.push.apply(n,[a[0]].concat(fe(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new Vn.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return $($({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=$({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,$($({allIds:[]},t),{},{_id:a})),e.children=new Map(fe(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=ve(r);try{for(s.s();!(i=s.n()).done;){var l=ue(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(Wn.AssemblySpecificChange);dt.FeatureChange=Jn;var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.operationRegistry=void 0,Yn.operationRegistry=new(function(){function e(){K(this,e),this.operations=new Map}return X(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.Validation=void 0,Kn.isContext=function(e){return"context"in e&&"reflector"in e};var Zn=function(){function e(){K(this,e)}var t,n,r,a,o;return X(e,[{key:"frontendPreValidate",value:(o=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Kn.Validation=Zn,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(Xe,e),t.__exportStar(et,e),t.__exportStar(tt,e),t.__exportStar(nt,e),t.__exportStar(ct,e),t.__exportStar(ut,e),t.__exportStar(dt,e),t.__exportStar(rt,e),t.__exportStar(Yn,e),t.__exportStar(Kn,e)}(L);var Xn={},Qn={},er={},tr={},nr={};Object.defineProperty(nr,"__esModule",{value:!0}),nr.ApolloPlugin=void 0;var rr=function(e){ee(n,e);var t=le(n);function n(){return K(this,n),t.apply(this,arguments)}return X(n,[{key:"apolloInstall",value:function(e){}}]),n}(Ze.__importDefault(C.default).default);nr.ApolloPlugin=rr;var ar={},or={},ir={};Object.defineProperty(ir,"__esModule",{value:!0}),ir.changeRegistry=void 0,ir.changeRegistry=new(function(){function e(){K(this,e),this.changes=new Map}return X(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.Operation=void 0;var lr=function(){function e(t,n){var r;K(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return X(e,[{key:"execute",value:(t=Y(V().mark((function e(t){var n,r;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();sr.Operation=lr,Object.defineProperty(or,"__esModule",{value:!0}),or.Change=void 0,or.isChange=function(e){return void 0!==e.executeOnClient};var cr=ir,ur=function(e){ee(r,e);var t,n=le(r);function r(){return K(this,r),n.apply(this,arguments)}return X(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Y(V().mark((function e(t){var n;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",ce(te(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(cr.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(sr.Operation);or.Change=ur,Object.defineProperty(ar,"__esModule",{value:!0}),ar.AssemblySpecificChange=void 0,ar.isAssemblySpecificChange=function(e){return(0,dr.isChange)(e)&&void 0!==e.assembly};var dr=or,fr=function(e){ee(n,e);var t=le(n);function n(e,r){var a;return K(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return X(n,[{key:"getIndexedIds",value:function(e,t){var n,r,a=[],o=ve(null!=t?t:[]);try{for(o.s();!(r=o.n()).done;){var i=null===(n=e.attributes)||void 0===n?void 0:n[r.value];i&&a.push(i[0])}}catch(e){o.e(e)}finally{o.f()}if(e.children)for(var s=0,l=Object.values(e.children);s<l.length;s++){var c=this.getIndexedIds(l[s],t);a.push.apply(a,fe(c))}return a}}]),n}(dr.Change);ar.AssemblySpecificChange=fr;var pr={};Object.defineProperty(pr,"__esModule",{value:!0}),pr.Check=void 0,pr.Check=X((function e(){K(this,e)}));var hr={};Object.defineProperty(hr,"__esModule",{value:!0}),hr.checkRegistry=void 0,hr.checkRegistry=new(function(){function e(){K(this,e),this.checks=new Map}return X(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var mr={};Object.defineProperty(mr,"__esModule",{value:!0}),mr.FeatureChange=void 0,mr.isFeatureChange=function(e){return(0,yr.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var gr=Ze.__importDefault(Hn),yr=ar,vr=function(e){ee(n,e);var t=le(n);function n(e,r){var a;return K(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return X(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=ve(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=ue(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=ve((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=ue(t.value,2);n.push.apply(n,[a[0]].concat(fe(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new gr.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return $($({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=$({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,$($({allIds:[]},t),{},{_id:a})),e.children=new Map(fe(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=ve(r);try{for(s.s();!(i=s.n()).done;){var l=ue(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(yr.AssemblySpecificChange);mr.FeatureChange=vr;var br={};Object.defineProperty(br,"__esModule",{value:!0}),br.operationRegistry=void 0,br.operationRegistry=new(function(){function e(){K(this,e),this.operations=new Map}return X(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var _r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.Validation=void 0,_r.isContext=function(e){return"context"in e&&"reflector"in e};var wr=function(){function e(){K(this,e)}var t,n,r,a,o;return X(e,[{key:"frontendPreValidate",value:(o=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();_r.Validation=wr,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(nr,e),t.__exportStar(ar,e),t.__exportStar(or,e),t.__exportStar(ir,e),t.__exportStar(pr,e),t.__exportStar(hr,e),t.__exportStar(mr,e),t.__exportStar(sr,e),t.__exportStar(br,e),t.__exportStar(_r,e)}(tr),Object.defineProperty(er,"__esModule",{value:!0}),er.AddAssemblyAliasesChange=void 0;var xr=A.default,Sr=function(e){ee(r,e);var t,n=le(r);function r(e,t){var a;return K(this,r),Q(se(a=n.call(this,e,t)),"typeName","AddAssemblyAliasesChange"),Q(se(a),"aliases",void 0),a.aliases=e.aliases,a}return X(r,[{key:"executeOnClient",value:function(e){var t=(0,xr.getSession)(e).assemblyManager.get(this.assembly);if(!t)throw new Error("assembly ".concat(this.assembly," not found"));return t.configuration.aliases.set(this.aliases),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,aliases:this.aliases}}},{key:"executeOnServer",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=this.assembly,i=this.aliases,null===(n=(o=this.logger).debug)||void 0===n||n.call(o,"Updating assembly aliases for assembly: ".concat(a,", aliases: ").concat(JSON.stringify(i))),e.next=5,r.findById(a);case 5:if(s=e.sent){e.next=8;break}throw new Error("Assembly with ID ".concat(a," not found"));case 8:return s.aliases=i,e.next=11,s.save();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"Assembly aliases have been added."}}]),r}(tr.AssemblySpecificChange);er.AddAssemblyAliasesChange=Sr;var Er={},kr={},Cr={},Ar={};Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.annotationFeatureToGFF3=Tr;var Or=A.default;function Tr(e,t,n){var r,a,o,i,s=JSON.parse(JSON.stringify(null!==(r=e.attributes)&&void 0!==r?r:{})),l=[],c=null!==(a=null===(o=e.attributes)||void 0===o||null===(o=o.gff_source)||void 0===o?void 0:o[0])&&void 0!==a?a:null;delete s.gff_source,t&&(s.Parent=[t]),s.gff_id?(s.ID=s.gff_id,delete s.gff_id):e.children&&(s.ID=[e._id]),s.gff_name&&(s.Name=s.gff_name,delete s.gff_name),s.gff_alias&&(s.Alias=s.gff_alias,delete s.gff_alias),s.gff_target&&(s.Target=s.gff_target,delete s.gff_target),s.gff_gap&&(s.Gap=s.gff_gap,delete s.gff_gap),s.gff_derives_from&&(s.Derives_from=s.gff_derives_from,delete s.gff_derives_from),s.gff_note&&(s.Note=s.gff_note,delete s.gff_note),s.gff_dbxref&&(s.Dbxref=s.gff_dbxref,delete s.gff_dbxref),s.gff_is_circular&&(s.Is_circular=s.gff_is_circular,delete s.gff_is_circular),s.gff_ontology_term&&(l.push.apply(l,fe(s.gff_ontology_term)),delete s.gff_ontology_term),s["Gene Ontology"]&&(l.push.apply(l,fe(s["Gene Ontology"])),delete s["Gene Ontology"]),s["Sequence Ontology"]&&(l.push.apply(l,fe(s["Sequence Ontology"])),delete s["Sequence Ontology"]),l.length>0&&(s.Ontology_term=l);var u=null===(i=e.attributes)||void 0===i?void 0:i.gff_score,d=null;return u&&u.length>0&&(u[0]&&(d=Number(u[0]),Number.isNaN(d)&&(d=null)),delete s.gff_score),[{start:e.min,end:e.max}].map((function(t){var r,a;return{start:Number(t.start)+1,end:Number(t.end),seq_id:n?null!==(r=n[e.refSeq])&&void 0!==r?r:null:e.refSeq,source:c,type:e.type,score:d,strand:e.strand?1===e.strand?"+":"-":null,phase:null,attributes:Object.keys(s).length>0?s:null,derived_features:[],child_features:Nr(e,null===(a=s.ID)||void 0===a?void 0:a[0],n)}}))}function Nr(e,t,n){if(!e.children)return[];if("mRNA"===e.type){for(var r=[],a=function(e){var t=[];try{t=function(e){if("mRNA"!==e.type)throw new Error('Only features of type "mRNA" or equivalent can calculate CDS locations');if(!e.children)throw new Error("no CDS or exons in mRNA");var t=Object.values(e.children),n=t.filter((function(e){return"CDS"===e.type}));if(0===n.length)throw new Error("no CDS in mRNA");var r,a=[],o=ve(n);try{var i=function(){for(var n=r.value,o=n.max,i=n.min,s=[],l=!1,c=[],u=0,d=t;u<d.length;u++){var f=d[u];"exon"===f.type&&c.push({min:f.min,max:f.max})}c.sort((function(e,t){return e.min-t.min}));for(var p=0,h=c;p<h.length;p++){var m=h[p],g=s.at(-1);g&&s.push({min:g.max,max:m.min,type:"intron"});var y,v=ue((0,Or.intersection2)(i,o,m.min,m.max),2),b=v[0],_=v[1];y=l?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==b&&void 0!==_?(l=!0,b===m.min&&_===m.max?s.push({min:b,max:_,phase:0,type:"CDS"}):b===m.min?s.push({min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:y}):_===m.max?s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"}):s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:"fivePrimeUTR"===y?"threePrimeUTR":"fivePrimeUTR"})):s.push({min:m.min,max:m.max,type:y})}s.sort((function(e,t){return e.min-t.min})),-1===e.strand&&s.reverse();var w=0,x=s.map((function(e){if("CDS"!==e.type)return e;var t=w;return w=(3-(e.max-e.min-t+3)%3)%3,$($({},e),{},{phase:t})}));a.push(x)};for(o.s();!(r=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return a}(e)}catch(e){return[]}return t.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))}(e),o=0,i=0,s=Object.values(e.children);i<s.length;i++){var l=s[i],c=Tr(l,t,n);if("CDS"===l.type){var u,d=ve(a[o]);try{for(d.s();!(u=d.n()).done;){var f=u.value,p=JSON.parse(JSON.stringify(c));if(1!=p.length)throw new Error("Unexpected CDS: ".concat(JSON.stringify(p,null,2)));p[0].start=f.min+1,p[0].end=f.max,p[0].phase=f.phase.toString(),p[0].type=f.type,r.push(p)}}catch(e){d.e(e)}finally{d.f()}o++}else r.push(c)}return r}return Object.values(e.children).map((function(e){return Tr(e,t,n)}))}var Ir={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.gffInternalToColumn=e.gffColumnToInternal=e.internalToGFF=e.gffToInternal=void 0,e.isGFFReservedAttribute=function(t){return t in e.gffToInternal},e.isGFFInternalAttribute=function(t){return t in e.internalToGFF},e.isGFFColumn=function(t){return t in e.gffColumnToInternal},e.isGFFColumnInternal=function(t){return t in e.gffInternalToColumn},e.gffToInternal={ID:"gff_id",Name:"gff_name",Alias:"gff_alias",Parent:"gff_parent",Target:"gff_target",Gap:"gff_gap",Derives_from:"gff_derives_from",Note:"gff_note",Dbxref:"gff_dbxref",Ontology_term:"gff_ontology_term",Is_circular:"gff_is_circular"},e.internalToGFF={gff_id:"ID",gff_name:"Name",gff_alias:"Alias",gff_parent:"Parent",gff_target:"Target",gff_gap:"Gap",gff_derives_from:"Derives_from",gff_note:"Note",gff_dbxref:"Dbxref",gff_ontology_term:"Ontology_term",gff_is_circular:"Is_circular"},e.gffColumnToInternal={score:"gff_score",source:"gff_source"},e.gffInternalToColumn={gff_score:"score",gff_source:"source"}}(Ir);var Rr={};Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.gff3ToAnnotationFeature=function e(t,n){var r=ue(t,1)[0],a=r.end,o=r.seq_id,i=r.start,s=r.strand,l=r.type;if(!o)throw new Error("feature does not have seq_id: ".concat(JSON.stringify(r)));if(!l)throw new Error("feature does not have type: ".concat(JSON.stringify(r)));if(null===i)throw new Error("feature does not have start: ".concat(JSON.stringify(r)));if(null===a)throw new Error("feature does not have end: ".concat(JSON.stringify(r)));var c=ue(function(e){if(e.length>1&&!e.every((function(e){return"CDS"===e.type})))throw new Error("GFF3 features has multiple locations but is not a CDS");var t=e.map((function(e){return e.start})).filter((function(e){return null!==e})),n=e.map((function(e){return e.end})).filter((function(e){return null!==e}));return[Math.min.apply(Math,fe(t))-1,Math.max.apply(Math,fe(n))]}(t),2),u=c[0],d=c[1],f=function(t,n,r){var a={},o=t.filter((function(e){return e.child_features.length>0}));if(o.length>1)throw new Error("Features with multiple locations may not have children");if(0!==o.length){var i,s=[],l=[],c=[],u=ve(ue(o,1)[0].child_features);try{for(u.s();!(i=u.n()).done;){var d=i.value,f=ue(d,1)[0];if("exon"===f.type&&l.push(d),"three_prime_UTR"!==f.type&&"five_prime_UTR"!==f.type||c.push(d),"three_prime_UTR"!==f.type&&"five_prime_UTR"!==f.type&&"intron"!==f.type&&"start_codon"!==f.type&&"stop_codon"!==f.type)if("CDS"===f.type)s.push(d);else{var p=e(d,n);a[p._id]=p}}}catch(e){u.e(e)}finally{u.f()}if(s.length>0){var h,m=function(t,n){var r=t.map((function(e){return e.length}));if(r.some((function(e){return e>1})))return t.map((function(t){return e(t,n)}));var a=t.map((function(e){return e[0]})).filter((function(e){return null!==e.start&&null!==e.end})).sort((function(e,t){return e.start-t.start}));if(!a.some((function(e,t){var n=a.at(t+1);return!!n&&(0,Fr.doesIntersect2)(e.start,e.end,n.start,n.end)})))return[e(a,n)];var o,i=t.map((function(e){return e[0]})),s=[],l=ve(i);try{var c=function(){var e=o.value,t=s.at(-1);if(!t)return s.push([e]),1;t.some((function(t){return(0,Fr.doesIntersect2)(t.start,t.end,e.start,e.end)}))?s.push([e]):t.push(e)};for(l.s();!(o=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}return s.map((function(t){return e(t,n)}))}(s,n),g=ve(m);try{for(g.s();!(h=g.n()).done;){var y=h.value;a[y._id]=y}}catch(e){g.e(e)}finally{g.f()}var v,b=function(e,t,n,r,a){var o,i=[],s=ve(n);try{for(s.s();!(o=s.n()).done;){var l,c=ve(o.value);try{for(c.s();!(l=c.n()).done;){var u=l.value;if(!u.start||!u.end)throw new Error("UTR has undefined start and/or end\n: ".concat(JSON.stringify(u,null,2)));var d=void 0;"+"===u.strand?d=1:"-"===u.strand&&(d=-1),i.push({_id:(new Pr.default).toHexString(),refSeq:r,type:"exon",min:u.start-1,max:u.end,strand:d})}}catch(e){c.e(e)}finally{c.f()}}}catch(e){s.e(e)}finally{s.f()}i.sort((function(e,t){return e.min-t.min}));var f,p=[],h=ve(e);try{for(h.s();!(f=h.n()).done;){var m=f.value;m.sort((function(e,t){if(!e.start||!t.start)throw new Error("CDS has undefined start");return e.start-t.start}));for(var g=0;g<m.length;g++){var y,v=m[g],b=!1,_=ve(t);try{for(_.s();!(y=_.n()).done;){var w=y.value;if(1!=w.length)throw new Error("Unexpected number of exons");var x=ue(w,1)[0];if(x.start&&x.end&&v.start&&v.end&&x.start<=v.start&&x.end>=v.end){b=!0;break}}}catch(e){_.e(e)}finally{_.f()}if(!b){if(!v.start||!v.end)throw new Error("CDS has undefined start and/or end: ".concat(JSON.stringify(v,null,2)));var S=void 0;"+"===v.strand?S=1:"-"===v.strand&&(S=-1);var E={_id:(new Pr.default).toHexString(),refSeq:r,type:"exon",min:v.start-1,max:v.end,strand:S};if(0===g){var k,C=ve(i);try{for(C.s();!(k=C.n()).done;){var A=k.value;if(A.max>E.min)break;A.max===E.min?E.min=A.min:p.push(A)}}catch(e){C.e(e)}finally{C.f()}}if(g===m.length-1){var O,T=ve(i);try{for(T.s();!(O=T.n()).done;){var N=O.value;N.min<E.max||(N.min===E.max?E.max=N.max:p.push(N))}}catch(e){T.e(e)}finally{T.f()}}p.push(E)}}}}catch(e){h.e(e)}finally{h.f()}var I=function(e){if(0===e.length)return[];e.sort((function(e,t){return e.min-t.min}));var t=[];t.push(e[0]);for(var n=1;n<e.length;n++){var r=t.at(-1),a=e[n];r&&a.min<=r.max?r.max=Math.max(r.max,a.max):t.push(a)}return t}(p);return I}(s,l,c,m[0].refSeq),_=ve(b);try{for(_.s();!(v=_.n()).done;){var w=v.value;a[w._id]=w}}catch(e){_.e(e)}finally{_.f()}}return Object.keys(a).length>0?a:void 0}}(t,n),p=function(e){var t={},n=e.map((function(e){return e.score})).filter((function(e){return null!==e})),r=e.map((function(e){return e.source})).filter((function(e){return null!==e})),a=e.map((function(e){return e.attributes})).filter((function(e){return null!==e}));if(n.length>0){var o=ue(n,1)[0];n.length>1&&(o=n.reduce((function(e,t){return e+t}),0)/n.length),t.gff_score=[String(o)]}if(r.length>0){var i=ue(r,1)[0];r.length>1&&(i=fe(new Set(r)).join(",")),t.gff_source=[i]}if(a.length>0){var s,l=ve(a);try{for(l.s();!(s=l.n()).done;)for(var c=0,u=Object.entries(s.value);c<u.length;c++){var d=ue(u[c],2),f=d[0],p=d[1];if("Parent"!==f){var h=(0,Mr.isGFFReservedAttribute)(f)?Mr.gffToInternal[f]:f,m=t[h];if(m){var g=new Set([].concat(fe(m),fe(p)));t[h]=fe(g)}else t[h]=p}}}catch(e){l.e(e)}finally{l.f()}}if(Object.keys(t).length>0)return t}(t),h={_id:(new Pr.default).toHexString(),refSeq:null!=n?n:o,type:l,min:u,max:d};if(s)if("+"===s)h.strand=1;else{if("-"!==s)throw new Error('Unknown strand: "'.concat(s,'"'));h.strand=-1}return f&&(h.children=f),p&&(h.attributes=p),h};var Fr=A.default,Pr=Ze.__importDefault(Hn),Mr=Ir;!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(Ar,e),t.__exportStar(Ir,e),t.__exportStar(Rr,e)}(Cr),Object.defineProperty(kr,"__esModule",{value:!0}),kr.FromFileBaseChange=void 0;var Dr=Cr,jr=function(e){ee(o,e);var t,n,r,a=le(o);function o(){var e;K(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Q(se(e=a.call.apply(a,[this].concat(n))),"refSeqCache",new Map),e}return X(o,[{key:"addRefSeqIntoDb",value:(r=Y(V().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,I,R,F,P,M,D,j,L,q,B,z,G,H,W,J,Y,K,Z;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.logger,i=r.filesService,s=r.refSeqChunkModel,l=r.refSeqModel,c=r.user,d=(u=Dt.env.CHUNK_SIZE)&&Number(u),f=0,p=0,m="text/x-gff3"!==t.type,g=i.getFileStream(t),y="",v="",b=!0,_=!1,null===(a=o.debug)||void 0===a||a.call(o,"starting sequence stream"),w=0,x=new TextDecoder,S=!1,E=!1,e.prev=17,C=U(g);case 19:return e.next=21,C.next();case 21:if(!(S=!(A=e.sent).done)){e.next=91;break}O=x.decode(A.value),b=!O.endsWith("\n"),T=O.split(/\r?\n/),v&&(T[0]="".concat(v).concat(T[0]),v=""),b&&(v=null!==(N=T.pop())&&void 0!==N?N:""),I=ve(T),e.prev=29,I.s();case 31:if((R=I.n()).done){e.next=80;break}if(F=R.value,++w%1e6==0&&(null===(P=o.debug)||void 0===P||P.call(o,"Processed ".concat(w," lines"))),m){e.next=38;break}return"##FASTA"===F.trim()&&(m=!0),e.abrupt("continue",78);case 38:if(!(M=/^>\s*(\S+)\s*(.*)/.exec(F))){e.next=64;break}if(_=!0,null===(D=o.debug)||void 0===D||D.call(o,'Reference sequence information line "'.concat(M[0],'"')),""===y){e.next=49;break}if(h){e.next=45;break}throw new Error("No refSeq document found");case 45:return p+=y.length,e.next=48,s.create([{refSeq:h._id,n:f,sequence:y,user:c,status:-1}]);case 48:y="";case 49:return e.next=51,null===(j=h)||void 0===j?void 0:j.updateOne({length:p});case 51:return p=0,f=0,q=M[1].trim(),B=M[2]?M[2].trim():"",e.next=57,l.create([$($({name:q,description:B,assembly:n,length:0},d?{chunkSize:d}:null),{},{user:c,status:-1})]);case 57:z=ue(e.sent,1),G=z[0],null===(L=o.debug)||void 0===L||L.call(o,'Added new refSeq "'.concat(q,'", desc "').concat(B,'", docId "').concat(G._id,'"')),h=G,e.next=78;break;case 64:if(!/\S/.test(F)){e.next=78;break}if(h){e.next=67;break}throw new Error("No refSeq document found");case 67:W=(H=h)._id,J=H.chunkSize,y+=F.replaceAll(/\s/g,"");case 69:if(!(y.length>=J)){e.next=78;break}return Y=y.slice(0,J),p+=Y.length,e.next=74,s.create([{refSeq:W,n:f,sequence:Y,user:c,status:-1}]);case 74:f++,y=y.slice(J),e.next=69;break;case 78:e.next=31;break;case 80:e.next=85;break;case 82:e.prev=82,e.t0=e.catch(29),I.e(e.t0);case 85:return e.prev=85,I.f(),e.finish(85);case 88:S=!1,e.next=19;break;case 91:e.next=97;break;case 93:e.prev=93,e.t1=e.catch(17),E=!0,k=e.t1;case 97:if(e.prev=97,e.prev=98,!S||null==C.return){e.next=102;break}return e.next=102,C.return();case 102:if(e.prev=102,!E){e.next=105;break}throw k;case 105:return e.finish(102);case 106:return e.finish(97);case 107:if(_){e.next=109;break}throw new Error("No reference sequences found in file");case 109:if(!y&&!b){e.next=120;break}if(h){e.next=112;break}throw new Error("No refSeq document found");case 112:return b&&(y+=v),p+=y.length,null===(K=o.verbose)||void 0===K||K.call(o,'*** Add the very last chunk to ref seq ("'.concat(h._id,'", index ').concat(f," and total length for ref seq is ").concat(p,'): "').concat(y,'"')),null===(Z=o.debug)||void 0===Z||Z.call(o,"Creating refSeq chunk number ".concat(f,' of "').concat(h._id,'"')),e.next=118,s.create([{refSeq:h._id,n:f,sequence:y,user:c,status:-1}]);case 118:return e.next=120,h.updateOne({length:p});case 120:case"end":return e.stop()}}),e,this,[[17,93,97,107],[29,82,85,88],[98,,102,106]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"removeExistingFeatures",value:(n=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.featureModel,a=t.refSeqModel,o=this.assembly,null===(n=(i=this.logger).debug)||void 0===n||n.call(i,"Removing existing features for assembly = ".concat(o)),e.next=5,a.find({assembly:o}).exec();case 5:s=ve(e.sent),e.prev=7,s.s();case 9:if((l=s.n()).done){e.next=15;break}return c=l.value,e.next=13,r.deleteMany({refSeq:c._id});case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s.e(e.t0);case 20:return e.prev=20,s.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[7,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"addFeatureIntoDb",value:(t=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c,u,d,f,p,h,m,g;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Dt.env.INDEXED_IDS)&&(a=r.split(",")),o=this.assembly,i=this.refSeqCache,s=n.featureModel,l=n.refSeqModel,c=n.user,u=ue(t,1),d=u[0].seq_id){e.next=7;break}throw new Error("Valid seq_id not found in feature ".concat(JSON.stringify(t)));case 7:if(f=i.get(d)){e.next=22;break}return e.next=11,l.findOne({assembly:o,name:d}).exec();case 11:if(e.t1=p=e.sent,e.t0=null!==e.t1,!e.t0){e.next=15;break}e.t0=void 0!==p;case 15:if(!e.t0){e.next=19;break}e.t2=p,e.next=20;break;case 19:e.t2=void 0;case 20:(f=e.t2)&&i.set(d,f);case 22:if(f){e.next=24;break}throw new Error('RefSeq was not found by assembly "'.concat(o,'" and seq_id "').concat(d,'" not found'));case 24:return h=(0,Dr.gff3ToAnnotationFeature)(t,f._id),m=this.getAllIds(h),g=this.getIndexedIds(h,a),e.next=29,s.create([$($({allIds:m,indexedIds:g},h),{},{user:c,status:-1})]);case 29:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getAllIds",value:function(e){var t=[e._id];if(e.children)for(var n=0,r=Object.values(e.children);n<r.length;n++){var a=this.getAllIds(r[n]);t.push.apply(t,fe(a))}return t}}]),o}(tr.AssemblySpecificChange);kr.FromFileBaseChange=jr,Object.defineProperty(Er,"__esModule",{value:!0}),Er.AddAssemblyAndFeaturesFromFileChange=void 0;var Lr=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","AddAssemblyAndFeaturesFromFileChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=ue(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,I;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.fileModel,o=t.filesService,i=t.user,s=this.assembly,l=this.logger,c=ve(this.changes),e.prev=3,c.s();case 5:if((u=c.n()).done){e.next=71;break}if(m=(h=u.value).assemblyName,g=h.parseOptions,y=h.fileIds.fa,Dt.env.FILE_UPLOAD_FOLDER){e.next=12;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 12:return e.next=14,a.findById(y).exec();case 14:if(v=e.sent){e.next=17;break}throw new Error('File "'.concat(y,'" not found in Mongo'));case 17:return null===(d=l.debug)||void 0===d||d.call(l,'FileId "'.concat(y,'", checksum "').concat(v.checksum,'"')),e.next=20,n.findOne({name:m}).exec();case 20:if(!e.sent){e.next=23;break}throw new Error('Assembly "'.concat(m,'" already exists'));case 23:return e.next=25,r.find({isDefault:!0}).exec();case 25:return b=e.sent.map((function(e){return e._id.toHexString()})),e.next=29,n.create([{_id:s,name:m,user:i,status:-1,fileId:y,checks:b}]);case 29:return _=ue(e.sent,1),w=_[0],null===(f=l.debug)||void 0===f||f.call(l,'Added new assembly "'.concat(m,'", docId "').concat(w._id.toHexString(),'"')),null===(p=l.debug)||void 0===p||p.call(l,'File type: "'.concat(v.type,'"')),e.next=36,this.addRefSeqIntoDb(v,w._id.toString(),t);case 36:S=void 0===(x=(null!=g?g:{}).bufferSize)?1e4:x,E=o.parseGFF3(o.getFileStream(v),{bufferSize:S}),k=!1,C=!1,e.prev=40,O=U(E);case 42:return e.next=44,O.next();case 44:if(!(k=!(T=e.sent).done)){e.next=53;break}return I=T.value,null===(N=l.verbose)||void 0===N||N.call(l,"ENTRY=".concat(JSON.stringify(I))),e.next=50,this.addFeatureIntoDb(I,t);case 50:k=!1,e.next=42;break;case 53:e.next=59;break;case 55:e.prev=55,e.t0=e.catch(40),C=!0,A=e.t0;case 59:if(e.prev=59,e.prev=60,!k||null==O.return){e.next=64;break}return e.next=64,O.return();case 64:if(e.prev=64,!C){e.next=67;break}throw A;case 67:return e.finish(64);case 68:return e.finish(59);case 69:e.next=5;break;case 71:e.next=76;break;case 73:e.prev=73,e.t1=e.catch(3),c.e(e.t1);case 76:return e.prev=76,c.f(),e.finish(76);case 79:case"end":return e.stop()}}),e,this,[[3,73,76,79],[40,55,59,69],[60,,64,68]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(kr.FromFileBaseChange);Er.AddAssemblyAndFeaturesFromFileChange=Lr;var qr={},Br={},Ur=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};K(this,e),this.baseOverrides={},this.url=t;var r=n.fetch||globalThis.fetch.bind(globalThis);if(!r)throw new TypeError("no fetch function supplied, and none found in global environment");n.overrides&&(this.baseOverrides=n.overrides),this.fetchImplementation=r}var t,n,r,a,o,i;return X(e,[{key:"getBufferFromResponse",value:(i=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.buffer){e.next=4;break}return e.abrupt("return",t.buffer());case 4:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.next=7,t.arrayBuffer();case 7:return e.abrupt("return",Yt.from(e.sent));case 11:throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method");case 12:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"fetch",value:(o=Y(V().mark((function e(t,n){var r;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchImplementation(t,n);case 3:case 12:r=e.sent,e.next=16;break;case 6:if(e.prev=6,e.t0=e.catch(0),!"".concat(e.t0).includes("Failed to fetch")){e.next=15;break}return console.warn("generic-filehandle: refetching ".concat(t," to attempt to work around chrome CORS header caching bug")),e.next=12,this.fetchImplementation(t,$($({},n),{},{cache:"reload"}));case 15:throw e.t0;case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e,t){return o.apply(this,arguments)})},{key:"read",value:(a=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:0,a=y.length>3&&void 0!==y[3]?y[3]:0,s=void 0===(i=(o=y.length>4&&void 0!==y[4]?y[4]:{}).headers)?{}:i,l=o.signal,u=void 0===(c=o.overrides)?{}:c,(r=y.length>2?y[2]:void 0)<Infinity?s.range="bytes=".concat(a,"-").concat(a+r):Infinity===r&&0!==a&&(s.range="bytes=".concat(a,"-")),d=$($($({},this.baseOverrides),u),{},{headers:$($($({},s),u.headers),this.baseOverrides.headers),method:"GET",redirect:"follow",mode:"cors",signal:l}),e.next=9,this.fetch(this.url,d);case 9:if((f=e.sent).ok){e.next=12;break}throw new Error("HTTP ".concat(f.status," ").concat(f.statusText," ").concat(this.url));case 12:if((200!==f.status||0!==a)&&206!==f.status){e.next=21;break}return e.next=15,this.getBufferFromResponse(f);case 15:return h=(p=e.sent).copy(t,n,0,Math.min(r,p.length)),m=f.headers.get("content-range"),(g=/\/(\d+)$/.exec(m||""))&&g[1]&&(this._stat={size:parseInt(g[1],10)}),e.abrupt("return",{bytesRead:h,buffer:t});case 21:if(200!==f.status){e.next=23;break}throw new Error("${this.url} fetch returned status 200, expected 206");case 23:throw new Error("HTTP ".concat(f.status," fetching ").concat(this.url));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Y(V().mark((function e(){var t,n,r,a,o,i,s,l,c,u=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof(t=u.length>0&&void 0!==u[0]?u[0]:{})?(n=t,r={}):(n=t.encoding,delete(r=t).encoding),s=void 0===(i=(a=r).overrides)?{}:i,l=$($({headers:void 0===(o=a.headers)?{}:o,method:"GET",redirect:"follow",mode:"cors",signal:a.signal},this.baseOverrides),s),e.next=6,this.fetch(this.url,l);case 6:if(c=e.sent){e.next=9;break}throw new Error("generic-filehandle failed to fetch");case 9:if(200===c.status){e.next=11;break}throw Object.assign(new Error("HTTP ".concat(c.status," fetching ").concat(this.url)),{status:c.status});case 11:if("utf8"!==n){e.next=13;break}return e.abrupt("return",c.text());case 13:if(!n){e.next=15;break}throw new Error("unsupported encoding: ".concat(n));case 15:return e.abrupt("return",this.getBufferFromResponse(c));case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stat",value:(n=Y(V().mark((function e(){var t;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._stat){e.next=6;break}return t=Yt.allocUnsafe(10),e.next=4,this.read(t,0,10,0);case 4:if(this._stat){e.next=6;break}throw new Error("unable to determine size of file at ".concat(this.url));case 6:return e.abrupt("return",this._stat);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Y(V().mark((function e(){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function zr(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"!=typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsArrayBuffer(e)}))}function Gr(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"==typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsText(e)}))}var Hr=function(){function e(t){K(this,e),this.blob=t,this.size=t.size}var t,n,r,a;return X(e,[{key:"read",value:(a=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,a=c.length>3&&void 0!==c[3]?c[3]:0,r=c.length>2?c[2]:void 0){e.next=5;break}return e.abrupt("return",{bytesRead:0,buffer:t});case 5:return i=(o=a)+r,e.next=9,zr(this.blob.slice(o,i));case 9:return s=Yt.from(e.sent),l=s.copy(t,n),e.abrupt("return",{bytesRead:l,buffer:s});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Y(V().mark((function e(t){var n;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("utf8"!==(n="string"==typeof t?t:t&&t.encoding)){e.next=3;break}return e.abrupt("return",Gr(this.blob));case 3:if(!n){e.next=5;break}throw new Error("unsupported encoding: ".concat(n));case 5:return e.next=7,zr(this.blob);case 7:return e.abrupt("return",Yt.from(e.sent));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stat",value:(n=Y(V().mark((function e(){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{size:this.size});case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Y(V().mark((function e(){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function $r(e){return new Ur(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}var Vr={__proto__:null,open:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0!==n)return n;if(void 0!==e)return $r(e,r);if(void 0!==t)return new Br(t,r);throw new Error("no url, path, or filehandle provided, cannot open")},fromUrl:$r,RemoteFile:Ur,LocalFile:Br,BlobFile:Hr},Wr={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==W(r))throw new TypeError(r+"must be non-object");for(var a in r)n(r,a)&&(e[a]=r[a])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,r,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),a);else for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){var t,n,r,a,o,i;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(i=new Uint8Array(r),a=0,t=0,n=e.length;t<n;t++)i.set(o=e[t],a),a+=o.length;return i}},a={arraySet:function(e,t,n,r,a){for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(t)}(Wr);var Jr={},Yr={},Kr={},Zr=Wr;function Xr(e){for(var t=e.length;--t>=0;)e[t]=0}var Qr=15,ea=16,ta=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],na=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ra=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],aa=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oa=new Array(576);Xr(oa);var ia=new Array(60);Xr(ia);var sa=new Array(512);Xr(sa);var la=new Array(256);Xr(la);var ca=new Array(29);Xr(ca);var ua,da,fa,pa=new Array(30);function ha(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function ma(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function ga(e){return e<256?sa[e]:sa[256+(e>>>7)]}function ya(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function va(e,t,n){e.bi_valid>ea-n?(e.bi_buf|=t<<e.bi_valid&65535,ya(e,e.bi_buf),e.bi_buf=t>>ea-e.bi_valid,e.bi_valid+=n-ea):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function ba(e,t,n){va(e,n[2*t],n[2*t+1])}function _a(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function wa(e,t,n){var r,a,o=new Array(Qr+1),i=0;for(r=1;r<=Qr;r++)o[r]=i=i+n[r-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=_a(o[s]++,s))}}function xa(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Sa(e){e.bi_valid>8?ya(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Ea(e,t,n,r){var a=2*t,o=2*n;return e[a]<e[o]||e[a]===e[o]&&r[t]<=r[n]}function ka(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Ea(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Ea(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r}function Ca(e,t,n){var r,a,o,i,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===r?ba(e,a,t):(ba(e,(o=la[a])+256+1,t),0!==(i=ta[o])&&va(e,a-=ca[o],i),ba(e,o=ga(--r),n),0!==(i=na[o])&&va(e,r-=pa[o],i))}while(s<e.last_lit);ba(e,256,t)}function Aa(e,t){var n,r,a,o=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=i[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)ka(e,o,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ka(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*a]=o[2*n]+o[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=a,e.heap[1]=a++,ka(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,a,o,i,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(o=0;o<=Qr;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(r=e.heap[n])+1]+1]+1)>h&&(o=h,m++),l[2*r+1]=o,r>c||(e.bl_count[o]++,i=0,r>=p&&(i=f[r-p]),e.opt_len+=(s=l[2*r])*(o+i),d&&(e.static_len+=s*(u[2*r+1]+i)));if(0!==m){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(o=h;0!==o;o--)for(r=e.bl_count[o];0!==r;)(a=e.heap[--n])>c||(l[2*a+1]!==o&&(e.opt_len+=(o-l[2*a+1])*l[2*a],l[2*a+1]=o),r--)}}(e,t),wa(o,c,e.bl_count)}function Oa(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=i,i=t[2*(r+1)+1],++s<l&&a===i||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4))}function Ta(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),r=0;r<=n;r++)if(a=i,i=t[2*(r+1)+1],!(++s<l&&a===i)){if(s<c)do{ba(e,a,e.bl_tree)}while(0!=--s);else 0!==a?(a!==o&&(ba(e,a,e.bl_tree),s--),ba(e,16,e.bl_tree),va(e,s-3,2)):s<=10?(ba(e,17,e.bl_tree),va(e,s-3,3)):(ba(e,18,e.bl_tree),va(e,s-11,7));s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4)}}Xr(pa);var Na=!1;function Ia(e,t,n,r){va(e,0+(r?1:0),3),function(e,t,n,r){Sa(e),ya(e,n),ya(e,~n),Zr.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}Kr._tr_init=function(e){Na||(function(){var e,t,n,r,a,o=new Array(Qr+1);for(n=0,r=0;r<28;r++)for(ca[r]=n,e=0;e<1<<ta[r];e++)la[n++]=r;for(la[n-1]=r,a=0,r=0;r<16;r++)for(pa[r]=a,e=0;e<1<<na[r];e++)sa[a++]=r;for(a>>=7;r<30;r++)for(pa[r]=a<<7,e=0;e<1<<na[r]-7;e++)sa[256+a++]=r;for(t=0;t<=Qr;t++)o[t]=0;for(e=0;e<=143;)oa[2*e+1]=8,e++,o[8]++;for(;e<=255;)oa[2*e+1]=9,e++,o[9]++;for(;e<=279;)oa[2*e+1]=7,e++,o[7]++;for(;e<=287;)oa[2*e+1]=8,e++,o[8]++;for(wa(oa,287,o),e=0;e<30;e++)ia[2*e+1]=5,ia[2*e]=_a(e,5);ua=new ha(oa,ta,257,286,Qr),da=new ha(ia,na,0,30,Qr),fa=new ha(new Array(0),ra,0,19,7)}(),Na=!0),e.l_desc=new ma(e.dyn_ltree,ua),e.d_desc=new ma(e.dyn_dtree,da),e.bl_desc=new ma(e.bl_tree,fa),e.bi_buf=0,e.bi_valid=0,xa(e)},Kr._tr_stored_block=Ia,Kr._tr_flush_block=function(e,t,n,r){var a,o,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),Aa(e,e.l_desc),Aa(e,e.d_desc),i=function(e){var t;for(Oa(e,e.dyn_ltree,e.l_desc.max_code),Oa(e,e.dyn_dtree,e.d_desc.max_code),Aa(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*aa[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(o=e.static_len+3+7>>>3)<=(a=e.opt_len+3+7>>>3)&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?Ia(e,t,n,r):4===e.strategy||o===a?(va(e,2+(r?1:0),3),Ca(e,oa,ia)):(va(e,4+(r?1:0),3),function(e,t,n,r){var a;for(va(e,t-257,5),va(e,n-1,5),va(e,r-4,4),a=0;a<r;a++)va(e,e.bl_tree[2*aa[a]+1],3);Ta(e,e.dyn_ltree,t-1),Ta(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),Ca(e,e.dyn_ltree,e.dyn_dtree)),xa(e),r&&Sa(e)},Kr._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(la[n]+256+1)]++,e.dyn_dtree[2*ga(t)]++),e.last_lit===e.lit_bufsize-1},Kr._tr_align=function(e){va(e,2,3),ba(e,256,oa),function(e){16===e.bi_valid?(ya(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var Ra=function(e,t,n,r){for(var a=65535&e|0,o=e>>>16&65535|0,i=0;0!==n;){n-=i=n>2e3?2e3:n;do{o=o+(a=a+t[r++]|0)|0}while(--i);a%=65521,o%=65521}return a|o<<16|0};function Fa(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var Pa,Ma=Fa(),Da=function(e,t,n,r){var a=Ma,o=r+n;e^=-1;for(var i=r;i<o;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},ja={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},La=Wr,qa=Kr,Ba=Ra,Ua=Da,za=ja,Ga=0,Ha=0,$a=-2,Va=2,Wa=8,Ja=286,Ya=30,Ka=19,Za=2*Ja+1,Xa=15,Qa=3,eo=258,to=eo+Qa+1,no=42,ro=103,ao=113,oo=666;function io(e,t){return e.msg=za[t],t}function so(e){return(e<<1)-(e>4?9:0)}function lo(e){for(var t=e.length;--t>=0;)e[t]=0}function co(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(La.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function uo(e,t){qa._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,co(e.strm)}function fo(e,t){e.pending_buf[e.pending++]=t}function po(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ho(e,t){var n,r,a=e.max_chain_length,o=e.strstart,i=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-to?e.strstart-(e.w_size-to):0,c=e.window,u=e.w_mask,d=e.prev,f=e.strstart+eo,p=c[o+i-1],h=c[o+i];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+i]===h&&c[n+i-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<f);if(r=eo-(f-o),o=f-eo,r>i){if(e.match_start=t,i=r,r>=s)break;p=c[o+i-1],h=c[o+i]}}}while((t=d[t&u])>l&&0!=--a);return i<=e.lookahead?i:e.lookahead}function mo(e){var t,n,r,a,o,i,s,l,c,u,d=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-to)){La.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=d?r-d:0}while(--n);t=n=d;do{r=e.prev[--t],e.prev[t]=r>=d?r-d:0}while(--n);a+=d}if(0===e.strm.avail_in)break;if(s=e.window,l=e.strstart+e.lookahead,u=void 0,(u=(i=e.strm).avail_in)>(c=a)&&(u=c),n=0===u?0:(i.avail_in-=u,La.arraySet(s,i.input,i.next_in,u,l),1===i.state.wrap?i.adler=Ba(i.adler,s,u,l):2===i.state.wrap&&(i.adler=Ua(i.adler,s,u,l)),i.next_in+=u,i.total_in+=u,u),e.lookahead+=n,e.lookahead+e.insert>=Qa)for(e.ins_h=e.window[o=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+Qa-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<Qa)););}while(e.lookahead<to&&0!==e.strm.avail_in)}function go(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(mo(e),0===e.lookahead&&t===Ga)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,uo(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-to&&(uo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(uo(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&uo(e,!1),1)}function yo(e,t){for(var n,r;;){if(e.lookahead<to){if(mo(e),e.lookahead<to&&t===Ga)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=Qa&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Qa-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-to&&(e.match_length=ho(e,n)),e.match_length>=Qa)if(r=qa._tr_tally(e,e.strstart-e.match_start,e.match_length-Qa),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=Qa){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Qa-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=qa._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(uo(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<Qa-1?e.strstart:Qa-1,4===t?(uo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(uo(e,!1),0===e.strm.avail_out)?1:2}function vo(e,t){for(var n,r,a;;){if(e.lookahead<to){if(mo(e),e.lookahead<to&&t===Ga)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=Qa&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Qa-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=Qa-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-to&&(e.match_length=ho(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===Qa&&e.strstart-e.match_start>4096)&&(e.match_length=Qa-1)),e.prev_length>=Qa&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-Qa,r=qa._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-Qa),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+Qa-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=Qa-1,e.strstart++,r&&(uo(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=qa._tr_tally(e,0,e.window[e.strstart-1]))&&uo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=qa._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<Qa-1?e.strstart:Qa-1,4===t?(uo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(uo(e,!1),0===e.strm.avail_out)?1:2}function bo(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}function _o(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Wa,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new La.Buf16(2*Za),this.dyn_dtree=new La.Buf16(2*(2*Ya+1)),this.bl_tree=new La.Buf16(2*(2*Ka+1)),lo(this.dyn_ltree),lo(this.dyn_dtree),lo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new La.Buf16(Xa+1),this.heap=new La.Buf16(2*Ja+1),lo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new La.Buf16(2*Ja+1),lo(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wo(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Va,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?no:ao,e.adler=2===t.wrap?0:1,t.last_flush=Ga,qa._tr_init(t),Ha):io(e,$a)}function xo(e){var t,n=wo(e);return n===Ha&&((t=e.state).window_size=2*t.w_size,lo(t.head),t.max_lazy_match=Pa[t.level].max_lazy,t.good_match=Pa[t.level].good_length,t.nice_match=Pa[t.level].nice_length,t.max_chain_length=Pa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Qa-1,t.match_available=0,t.ins_h=0),n}function So(e,t,n,r,a,o){if(!e)return $a;var i=1;if(-1===t&&(t=6),r<0?(i=0,r=-r):r>15&&(i=2,r-=16),a<1||a>9||n!==Wa||r<8||r>15||t<0||t>9||o<0||o>4)return io(e,$a);8===r&&(r=9);var s=new _o;return e.state=s,s.strm=e,s.wrap=i,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=a+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+Qa-1)/Qa),s.window=new La.Buf8(2*s.w_size),s.head=new La.Buf16(s.hash_size),s.prev=new La.Buf16(s.w_size),s.lit_bufsize=1<<a+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new La.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,xo(e)}Pa=[new bo(0,0,0,0,go),new bo(4,4,8,4,yo),new bo(4,5,16,8,yo),new bo(4,6,32,32,yo),new bo(4,4,16,16,vo),new bo(8,16,32,32,vo),new bo(8,16,128,128,vo),new bo(8,32,128,256,vo),new bo(32,128,258,1024,vo),new bo(32,258,258,4096,vo)],Yr.deflateInit=function(e,t){return So(e,t,Wa,15,8,0)},Yr.deflateInit2=So,Yr.deflateReset=xo,Yr.deflateResetKeep=wo,Yr.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?$a:(e.state.gzhead=t,Ha):$a},Yr.deflate=function(e,t){var n,r,a,o;if(!e||!e.state||t>5||t<0)return e?io(e,$a):$a;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===oo&&4!==t)return io(e,0===e.avail_out?-5:$a);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===no)if(2===r.wrap)e.adler=0,fo(r,31),fo(r,139),fo(r,8),r.gzhead?(fo(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),fo(r,255&r.gzhead.time),fo(r,r.gzhead.time>>8&255),fo(r,r.gzhead.time>>16&255),fo(r,r.gzhead.time>>24&255),fo(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),fo(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(fo(r,255&r.gzhead.extra.length),fo(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ua(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(fo(r,0),fo(r,0),fo(r,0),fo(r,0),fo(r,0),fo(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),fo(r,3),r.status=ao);else{var i=Wa+(r.w_bits-8<<4)<<8;i|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(i|=32),i+=31-i%31,r.status=ao,po(r,i),0!==r.strstart&&(po(r,e.adler>>>16),po(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),co(e),a=r.pending,r.pending!==r.pending_buf_size));)fo(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),co(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,fo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),co(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,fo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=Ua(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.status=ro)}else r.status=ro;if(r.status===ro&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&co(e),r.pending+2<=r.pending_buf_size&&(fo(r,255&e.adler),fo(r,e.adler>>8&255),e.adler=0,r.status=ao)):r.status=ao),0!==r.pending){if(co(e),0===e.avail_out)return r.last_flush=-1,Ha}else if(0===e.avail_in&&so(t)<=so(n)&&4!==t)return io(e,-5);if(r.status===oo&&0!==e.avail_in)return io(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==Ga&&r.status!==oo){var s=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(mo(e),0===e.lookahead)){if(t===Ga)return 1;break}if(e.match_length=0,n=qa._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(uo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(uo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(uo(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,r,a,o,i=e.window;;){if(e.lookahead<=eo){if(mo(e),e.lookahead<=eo&&t===Ga)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=Qa&&e.strstart>0&&(r=i[a=e.strstart-1])===i[++a]&&r===i[++a]&&r===i[++a]){o=e.strstart+eo;do{}while(r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&a<o);e.match_length=eo-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=Qa?(n=qa._tr_tally(e,1,e.match_length-Qa),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=qa._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(uo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(uo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(uo(e,!1),0===e.strm.avail_out)?1:2}(r,t):Pa[r.level].func(r,t);if(3!==s&&4!==s||(r.status=oo),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),Ha;if(2===s&&(1===t?qa._tr_align(r):5!==t&&(qa._tr_stored_block(r,0,0,!1),3===t&&(lo(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),co(e),0===e.avail_out))return r.last_flush=-1,Ha}return 4!==t?Ha:r.wrap<=0?1:(2===r.wrap?(fo(r,255&e.adler),fo(r,e.adler>>8&255),fo(r,e.adler>>16&255),fo(r,e.adler>>24&255),fo(r,255&e.total_in),fo(r,e.total_in>>8&255),fo(r,e.total_in>>16&255),fo(r,e.total_in>>24&255)):(po(r,e.adler>>>16),po(r,65535&e.adler)),co(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Ha:1)},Yr.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==no&&69!==t&&73!==t&&91!==t&&t!==ro&&t!==ao&&t!==oo?io(e,$a):(e.state=null,t===ao?io(e,-3):Ha):$a},Yr.deflateSetDictionary=function(e,t){var n,r,a,o,i,s,l,c,u=t.length;if(!e||!e.state)return $a;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==no||n.lookahead)return $a;for(1===o&&(e.adler=Ba(e.adler,t,u,0)),n.wrap=0,u>=n.w_size&&(0===o&&(lo(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new La.Buf8(n.w_size),La.arraySet(c,t,u-n.w_size,n.w_size,0),t=c,u=n.w_size),i=e.avail_in,s=e.next_in,l=e.input,e.avail_in=u,e.next_in=0,e.input=t,mo(n);n.lookahead>=Qa;){r=n.strstart,a=n.lookahead-(Qa-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+Qa-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=Qa-1,mo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=Qa-1,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=i,n.wrap=o,Ha},Yr.deflateInfo="pako deflate (from Nodeca project)";var Eo={},ko=Wr,Co=!0,Ao=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Co=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ao=!1}for(var Oo=new ko.Buf8(256),To=0;To<256;To++)Oo[To]=To>=252?6:To>=248?5:To>=240?4:To>=224?3:To>=192?2:1;function No(e,t){if(t<65534&&(e.subarray&&Ao||!e.subarray&&Co))return String.fromCharCode.apply(null,ko.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}Oo[254]=Oo[254]=1,Eo.string2buf=function(e){var t,n,r,a,o,i=e.length,s=0;for(a=0;a<i;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new ko.Buf8(s),o=0,a=0;o<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},Eo.buf2binstring=function(e){return No(e,e.length)},Eo.binstring2buf=function(e){for(var t=new ko.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},Eo.buf2string=function(e,t){var n,r,a,o,i=t||e.length,s=new Array(2*i);for(r=0,n=0;n<i;)if((a=e[n++])<128)s[r++]=a;else if((o=Oo[a])>4)s[r++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<i;)a=a<<6|63&e[n++],o--;o>1?s[r++]=65533:a<65536?s[r++]=a:(s[r++]=55296|(a-=65536)>>10&1023,s[r++]=56320|1023&a)}return No(s,r)},Eo.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Oo[e[n]]>t?n:t};var Io=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ro=Yr,Fo=Wr,Po=Eo,Mo=ja,Do=Io,jo=Object.prototype.toString,Lo=0,qo=-1,Bo=0,Uo=8;function zo(e){if(!(this instanceof zo))return new zo(e);this.options=Fo.assign({level:qo,method:Uo,chunkSize:16384,windowBits:15,memLevel:8,strategy:Bo,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Do,this.strm.avail_out=0;var n=Ro.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Lo)throw new Error(Mo[n]);if(t.header&&Ro.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?Po.string2buf(t.dictionary):"[object ArrayBuffer]"===jo.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Ro.deflateSetDictionary(this.strm,r))!==Lo)throw new Error(Mo[n]);this._dict_set=!0}}function Go(e,t){var n=new zo(t);if(n.push(e,!0),n.err)throw n.msg||Mo[n.err];return n.result}zo.prototype.push=function(e,t){var n,r,a=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,a.input="string"==typeof e?Po.string2buf(e):"[object ArrayBuffer]"===jo.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new Fo.Buf8(o),a.next_out=0,a.avail_out=o),1!==(n=Ro.deflate(a,r))&&n!==Lo)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?Po.buf2binstring(Fo.shrinkBuf(a.output,a.next_out)):Fo.shrinkBuf(a.output,a.next_out))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===r?(n=Ro.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Lo):2!==r||(this.onEnd(Lo),a.avail_out=0,!0)},zo.prototype.onData=function(e){this.chunks.push(e)},zo.prototype.onEnd=function(e){e===Lo&&(this.result="string"===this.options.to?this.chunks.join(""):Fo.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Jr.Deflate=zo,Jr.deflate=Go,Jr.deflateRaw=function(e,t){return(t=t||{}).raw=!0,Go(e,t)},Jr.gzip=function(e,t){return(t=t||{}).gzip=!0,Go(e,t)};var Ho={},$o={},Vo=Wr,Wo=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Jo=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Yo=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Ko=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Zo=Wr,Xo=Ra,Qo=Da,ei=function(e,t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C;k=e.input,a=(r=e.next_in)+(e.avail_in-5),C=e.output,i=(o=e.next_out)-(t-e.avail_out),s=o+(e.avail_out-257),l=(n=e.state).dmax,c=n.wsize,u=n.whave,d=n.wnext,f=n.window,p=n.hold,h=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=m[p&y];t:for(;;){if(p>>>=_=b>>>24,h-=_,0==(_=b>>>16&255))C[o++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(p&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(_&=15)&&(h<_&&(p+=k[r++]<<h,h+=8),w+=p&(1<<_)-1,p>>>=_,h-=_),h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=g[p&v];n:for(;;){if(p>>>=_=b>>>24,h-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=g[(65535&b)+(p&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(x=65535&b,h<(_&=15)&&(p+=k[r++]<<h,(h+=8)<_&&(p+=k[r++]<<h,h+=8)),(x+=p&(1<<_)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=_,h-=_,x>(_=o-i)){if((_=x-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,E=f,0===d){if(S+=c-_,_<w){w-=_;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}}else if(d<_){if(S+=c+d-_,(_-=d)<w){w-=_;do{C[o++]=f[S++]}while(--_);if(S=0,d<w){w-=_=d;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}}}else if(S+=d-_,_<w){w-=_;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}for(;w>2;)C[o++]=E[S++],C[o++]=E[S++],C[o++]=E[S++],w-=3;w&&(C[o++]=E[S++],w>1&&(C[o++]=E[S++]))}else{S=o-x;do{C[o++]=C[S++],C[o++]=C[S++],C[o++]=C[S++],w-=3}while(w>2);w&&(C[o++]=C[S++],w>1&&(C[o++]=C[S++]))}break}}break}}while(r<a&&o<s);p&=(1<<(h-=(w=h>>3)<<3))-1,e.next_in=r-=w,e.next_out=o,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=h},ti=function(e,t,n,r,a,o,i,s){var l,c,u,d,f,p,h,m,g,y=s.bits,v=0,b=0,_=0,w=0,x=0,S=0,E=0,k=0,C=0,A=0,O=null,T=0,N=new Vo.Buf16(16),I=new Vo.Buf16(16),R=null,F=0;for(v=0;v<=15;v++)N[v]=0;for(b=0;b<r;b++)N[t[n+b]]++;for(x=y,w=15;w>=1&&0===N[w];w--);if(x>w&&(x=w),0===w)return a[o++]=20971520,a[o++]=20971520,s.bits=1,0;for(_=1;_<w&&0===N[_];_++);for(x<_&&(x=_),k=1,v=1;v<=15;v++)if(k<<=1,(k-=N[v])<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(I[1]=0,v=1;v<15;v++)I[v+1]=I[v]+N[v];for(b=0;b<r;b++)0!==t[n+b]&&(i[I[t[n+b]]++]=b);if(0===e?(O=R=i,p=19):1===e?(O=Wo,T-=257,R=Jo,F-=257,p=256):(O=Yo,R=Ko,p=-1),A=0,b=0,v=_,f=o,S=x,E=0,u=-1,d=(C=1<<x)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){h=v-E,i[b]<p?(m=0,g=i[b]):i[b]>p?(m=R[F+i[b]],g=O[T+i[b]]):(m=96,g=0),l=1<<v-E,_=c=1<<S;do{a[f+(A>>E)+(c-=l)]=h<<24|m<<16|g|0}while(0!==c);for(l=1<<v-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,b++,0==--N[v]){if(v===w)break;v=t[n+i[b]]}if(v>x&&(A&d)!==u){for(0===E&&(E=x),f+=_,k=1<<(S=v-E);S+E<w&&!((k-=N[S+E])<=0);)S++,k<<=1;if(C+=1<<S,1===e&&C>852||2===e&&C>592)return 1;a[u=A&d]=x<<24|S<<16|f-o|0}}return 0!==A&&(a[f+A]=v-E<<24|64<<16|0),s.bits=x,0},ni=0,ri=-2,ai=1,oi=12,ii=30,si=852,li=592;function ci(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ui(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Zo.Buf16(320),this.work=new Zo.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function di(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ai,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Zo.Buf32(si),t.distcode=t.distdyn=new Zo.Buf32(li),t.sane=1,t.back=-1,ni):ri}function fi(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,di(e)):ri}function pi(e,t){var n,r;return e&&e.state?(t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ri:(null!==(r=e.state).window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,fi(e))):ri}function hi(e,t){var n,r;return e?(r=new ui,e.state=r,r.window=null,(n=pi(e,t))!==ni&&(e.state=null),n):ri}var mi,gi,yi=!0;function vi(e){if(yi){var t;for(mi=new Zo.Buf32(512),gi=new Zo.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ti(1,e.lens,0,288,mi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ti(2,e.lens,0,32,gi,0,e.work,{bits:5}),yi=!1}e.lencode=mi,e.lenbits=9,e.distcode=gi,e.distbits=5}function bi(e,t,n,r){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Zo.Buf8(o.wsize)),r>=o.wsize?(Zo.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>r&&(a=r),Zo.arraySet(o.window,t,n-r,a,o.wnext),(r-=a)?(Zo.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}$o.inflateReset=fi,$o.inflateReset2=pi,$o.inflateResetKeep=di,$o.inflateInit=function(e){return hi(e,15)},$o.inflateInit2=hi,$o.inflate=function(e,t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C=0,A=new Zo.Buf8(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ri;(n=e.state).mode===oi&&(n.mode=13),i=e.next_out,a=e.output,o=e.next_in,r=e.input,c=n.hold,u=n.bits,d=s=e.avail_in,f=l=e.avail_out,S=ni;e:for(;;)switch(n.mode){case ai:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,A[0]=255&c,A[1]=c>>>8&255,n.check=Qo(n.check,A,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=ii;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=ii;break}if(u-=4,x=8+(15&(c>>>=4)),0===n.wbits)n.wbits=x;else if(x>n.wbits){e.msg="invalid window size",n.mode=ii;break}n.dmax=1<<x,e.adler=n.check=1,n.mode=512&c?10:oi,c=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=ii;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ii;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Qo(n.check,A,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,n.check=Qo(n.check,A,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Qo(n.check,A,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Qo(n.check,A,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Zo.arraySet(n.head.extra,r,o,p,x)),512&n.flags&&(n.check=Qo(n.check,r,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=Qo(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=Qo(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ii;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=oi;break;case 10:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}e.adler=n.check=ci(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,2;e.adler=n.check=1,n.mode=oi;case oi:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(vi(n),n.mode=20,6===t){c>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=ii}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ii;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>s&&(p=s),p>l&&(p=l),0===p)break e;Zo.arraySet(a,r,o,p,i),s-=p,o+=p,l-=p,i+=p,n.length-=p;break}n.mode=oi;break;case 17:for(;u<14;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.nlen=257+(31&c),u-=5,n.ndist=1+(31&(c>>>=5)),u-=5,n.ncode=4+(15&(c>>>=5)),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ii;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.lens[O[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S=ti(0,n.lens,0,19,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid code lengths set",n.mode=ii;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(k=g+2;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=ii;break}x=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(k=g+3;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(k=g+7;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ii;break}for(;p--;)n.lens[n.have++]=x}}if(n.mode===ii)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ii;break}if(n.lenbits=9,S=ti(1,n.lens,0,n.nlen,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid literal/lengths set",n.mode=ii;break}if(n.distbits=6,n.distcode=n.distdyn,S=ti(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E={bits:n.distbits}),n.distbits=E.bits,S){e.msg="invalid distances set",n.mode=ii;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&l>=258){e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,ei(e,f),i=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,c=n.hold,u=n.bits,n.mode===oi&&(n.back=-1);break}for(n.back=0;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(y&&0==(240&y)){for(b=g,_=y,w=v;y=(C=n.lencode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===y){n.mode=26;break}if(32&y){n.back=-1,n.mode=oi;break}if(64&y){e.msg="invalid literal/length code",n.mode=ii;break}n.extra=15&y,n.mode=22;case 22:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;y=(C=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(0==(240&y)){for(b=g,_=y,w=v;y=(C=n.distcode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,64&y){e.msg="invalid distance code",n.mode=ii;break}n.offset=v,n.extra=15&y,n.mode=24;case 24:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ii;break}n.mode=25;case 25:if(0===l)break e;if(n.offset>(p=f-l)){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ii;break}h=p>n.wnext?n.wsize-(p-=n.wnext):n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=a,h=i-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{a[i++]=m[h++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;a[i++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===s)break e;s--,c|=r[o++]<<u,u+=8}if(e.total_out+=f-=l,n.total+=f,f&&(e.adler=n.check=n.flags?Qo(n.check,a,f,i-f):Xo(n.check,a,f,i-f)),f=l,(n.flags?c:ci(c))!==n.check){e.msg="incorrect data check",n.mode=ii;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ii;break}c=0,u=0}n.mode=29;case 29:S=1;break e;case ii:S=-3;break e;case 31:return-4;default:return ri}return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,(n.wsize||f!==e.avail_out&&n.mode<ii&&(n.mode<27||4!==t))&&bi(e,e.output,e.next_out,f-e.avail_out),f-=e.avail_out,e.total_in+=d-=e.avail_in,e.total_out+=f,n.total+=f,n.wrap&&f&&(e.adler=n.check=n.flags?Qo(n.check,a,f,e.next_out-f):Xo(n.check,a,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===oi?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===f||4===t)&&S===ni&&(S=-5),S},$o.inflateEnd=function(e){if(!e||!e.state)return ri;var t=e.state;return t.window&&(t.window=null),e.state=null,ni},$o.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?ri:(n.head=t,t.done=!1,ni):ri},$o.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?ri:11===n.mode&&Xo(1,t,r,0)!==n.check?-3:bi(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,ni):ri},$o.inflateInfo="pako inflate (from Nodeca project)";var _i={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},wi=$o,xi=Wr,Si=Eo,Ei=_i,ki=ja,Ci=Io,Ai=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Oi=Object.prototype.toString;function Ti(e){if(!(this instanceof Ti))return new Ti(e);this.options=xi.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ci,this.strm.avail_out=0;var n=wi.inflateInit2(this.strm,t.windowBits);if(n!==Ei.Z_OK)throw new Error(ki[n]);if(this.header=new Ai,wi.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Si.string2buf(t.dictionary):"[object ArrayBuffer]"===Oi.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=wi.inflateSetDictionary(this.strm,t.dictionary))!==Ei.Z_OK))throw new Error(ki[n])}function Ni(e,t){var n=new Ti(t);if(n.push(e,!0),n.err)throw n.msg||ki[n.err];return n.result}Ti.prototype.push=function(e,t){var n,r,a,o,i,s=this.strm,l=this.options.chunkSize,c=this.options.dictionary,u=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?Ei.Z_FINISH:Ei.Z_NO_FLUSH,s.input="string"==typeof e?Si.binstring2buf(e):"[object ArrayBuffer]"===Oi.call(e)?new Uint8Array(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new xi.Buf8(l),s.next_out=0,s.avail_out=l),(n=wi.inflate(s,Ei.Z_NO_FLUSH))===Ei.Z_NEED_DICT&&c&&(n=wi.inflateSetDictionary(this.strm,c)),n===Ei.Z_BUF_ERROR&&!0===u&&(n=Ei.Z_OK,u=!1),n!==Ei.Z_STREAM_END&&n!==Ei.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==Ei.Z_STREAM_END&&(0!==s.avail_in||r!==Ei.Z_FINISH&&r!==Ei.Z_SYNC_FLUSH)||("string"===this.options.to?(a=Si.utf8border(s.output,s.next_out),o=s.next_out-a,i=Si.buf2string(s.output,a),s.next_out=o,s.avail_out=l-o,o&&xi.arraySet(s.output,s.output,a,o,0),this.onData(i)):this.onData(xi.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==Ei.Z_STREAM_END);return n===Ei.Z_STREAM_END&&(r=Ei.Z_FINISH),r===Ei.Z_FINISH?(n=wi.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Ei.Z_OK):r!==Ei.Z_SYNC_FLUSH||(this.onEnd(Ei.Z_OK),s.avail_out=0,!0)},Ti.prototype.onData=function(e){this.chunks.push(e)},Ti.prototype.onEnd=function(e){e===Ei.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):xi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Ho.Inflate=Ti,Ho.inflate=Ni,Ho.inflateRaw=function(e,t){return(t=t||{}).raw=!0,Ni(e,t)},Ho.ungzip=Ni;var Ii={};(0,Wr.assign)(Ii,Jr,Ho,_i);var Ri=Ii;function Fi(e){return Pi.apply(this,arguments)}function Pi(){return Pi=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,a=0,o=[],i=0;case 5:if(l=t.subarray(r),s=new Ri.Inflate,n=s.strm,s.push(l,Ri.Z_SYNC_FLUSH),!s.err){e.next=12;break}throw new Error(s.msg);case 12:r+=n.next_in,o[a]=s.result,i+=o[a].length,a+=1;case 16:if(n.avail_in){e.next=5;break}case 17:for(c=new Uint8Array(i),u=0,d=0;u<o.length;u++)c.set(o[u],d),d+=o[u].length;return e.abrupt("return",Yt.from(c));case 22:if(e.prev=22,e.t0=e.catch(0),!"".concat(e.t0).match(/incorrect header check/)){e.next=26;break}throw new Error("problem decompressing block: incorrect gzip header check");case 26:throw e.t0;case 27:case"end":return e.stop()}}),e,null,[[0,22]])}))),Pi.apply(this,arguments)}var Mi=null;try{Mi=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Ql){}function Di(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function ji(e){return!0===(e&&e.__isLong__)}function Li(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(Di.prototype,"__isLong__",{value:!0}),Di.isLong=ji;var qi={},Bi={};function Ui(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=Bi[e])?r:(n=Gi(e,0,!0),a&&(Bi[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=qi[e])?r:(n=Gi(e,e<0?-1:0,!1),a&&(qi[e]=n),n)}function zi(e,t){if(isNaN(e))return t?Xi:Zi;if(t){if(e<0)return Xi;if(e>=Ji)return rs}else{if(e<=-Yi)return as;if(e+1>=Yi)return ns}return e<0?zi(-e,t).neg():Gi(e%Wi|0,e/Wi|0,t)}function Gi(e,t,n){return new Di(e,t,n)}Di.fromInt=Ui,Di.fromNumber=zi,Di.fromBits=Gi;var Hi=Math.pow;function $i(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?Xi:Zi;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return $i(e.substring(1),t,n).neg();for(var a=zi(Hi(n,8)),o=Zi,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),l=parseInt(e.substring(i,i+s),n);if(s<8){var c=zi(Hi(n,s));o=o.mul(c).add(zi(l))}else o=(o=o.mul(a)).add(zi(l))}return o.unsigned=t,o}function Vi(e,t){return"number"==typeof e?zi(e,t):"string"==typeof e?$i(e,t):Gi(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Di.fromString=$i,Di.fromValue=Vi;var Wi=4294967296,Ji=Wi*Wi,Yi=Ji/2,Ki=Ui(16777216),Zi=Ui(0);Di.ZERO=Zi;var Xi=Ui(0,!0);Di.UZERO=Xi;var Qi=Ui(1);Di.ONE=Qi;var es=Ui(1,!0);Di.UONE=es;var ts=Ui(-1);Di.NEG_ONE=ts;var ns=Gi(-1,2147483647,!1);Di.MAX_VALUE=ns;var rs=Gi(-1,-1,!0);Di.MAX_UNSIGNED_VALUE=rs;var as=Gi(0,-2147483648,!1);Di.MIN_VALUE=as;var os=Di.prototype;os.toInt=function(){return this.unsigned?this.low>>>0:this.low},os.toNumber=function(){return this.unsigned?(this.high>>>0)*Wi+(this.low>>>0):this.high*Wi+(this.low>>>0)},os.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(as)){var t=zi(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=zi(Hi(e,6),this.unsigned),o=this,i="";;){var s=o.div(a),l=(o.sub(s.mul(a)).toInt()>>>0).toString(e);if((o=s).isZero())return l+i;for(;l.length<6;)l="0"+l;i=""+l+i}},os.getHighBits=function(){return this.high},os.getHighBitsUnsigned=function(){return this.high>>>0},os.getLowBits=function(){return this.low},os.getLowBitsUnsigned=function(){return this.low>>>0},os.getNumBitsAbs=function(){if(this.isNegative())return this.eq(as)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},os.isZero=function(){return 0===this.high&&0===this.low},os.eqz=os.isZero,os.isNegative=function(){return!this.unsigned&&this.high<0},os.isPositive=function(){return this.unsigned||this.high>=0},os.isOdd=function(){return 1==(1&this.low)},os.isEven=function(){return 0==(1&this.low)},os.equals=function(e){return ji(e)||(e=Vi(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},os.eq=os.equals,os.notEquals=function(e){return!this.eq(e)},os.neq=os.notEquals,os.ne=os.notEquals,os.lessThan=function(e){return this.comp(e)<0},os.lt=os.lessThan,os.lessThanOrEqual=function(e){return this.comp(e)<=0},os.lte=os.lessThanOrEqual,os.le=os.lessThanOrEqual,os.greaterThan=function(e){return this.comp(e)>0},os.gt=os.greaterThan,os.greaterThanOrEqual=function(e){return this.comp(e)>=0},os.gte=os.greaterThanOrEqual,os.ge=os.greaterThanOrEqual,os.compare=function(e){if(ji(e)||(e=Vi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},os.comp=os.compare,os.negate=function(){return!this.unsigned&&this.eq(as)?as:this.not().add(Qi)},os.neg=os.negate,os.add=function(e){ji(e)||(e=Vi(e));var t=0,n=0,r=0,a=0;return r+=(a+=(65535&this.low)+(65535&e.low))>>>16,n+=(r+=(this.low>>>16)+(e.low>>>16))>>>16,t+=(n+=(65535&this.high)+(65535&e.high))>>>16,t+=(this.high>>>16)+(e.high>>>16),Gi((r&=65535)<<16|(a&=65535),(t&=65535)<<16|(n&=65535),this.unsigned)},os.subtract=function(e){return ji(e)||(e=Vi(e)),this.add(e.neg())},os.sub=os.subtract,os.multiply=function(e){if(this.isZero())return this;if(ji(e)||(e=Vi(e)),Mi)return Gi(Mi.mul(this.low,this.high,e.low,e.high),Mi.get_high(),this.unsigned);if(e.isZero())return this.unsigned?Xi:Zi;if(this.eq(as))return e.isOdd()?as:Zi;if(e.eq(as))return this.isOdd()?as:Zi;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ki)&&e.lt(Ki))return zi(this.toNumber()*e.toNumber(),this.unsigned);var t=65535&this.high,n=this.low>>>16,r=65535&this.low,a=65535&e.high,o=e.low>>>16,i=65535&e.low,s=0,l=0,c=0,u=0;return c+=(u+=r*i)>>>16,l+=(c+=n*i)>>>16,c&=65535,l+=(c+=r*o)>>>16,s+=(l+=t*i)>>>16,l&=65535,s+=(l+=n*o)>>>16,l&=65535,s+=(l+=r*a)>>>16,s+=(this.high>>>16)*i+t*o+n*a+r*(e.high>>>16),Gi((c&=65535)<<16|(u&=65535),(s&=65535)<<16|(l&=65535),this.unsigned)},os.mul=os.multiply,os.divide=function(e){if(ji(e)||(e=Vi(e)),e.isZero())throw Error("division by zero");var t,n,r;if(Mi)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Gi((this.unsigned?Mi.div_u:Mi.div_s)(this.low,this.high,e.low,e.high),Mi.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Xi:Zi;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Xi;if(e.gt(this.shru(1)))return es;r=Xi}else{if(this.eq(as))return e.eq(Qi)||e.eq(ts)?as:e.eq(as)?Qi:(t=this.shr(1).div(e).shl(1)).eq(Zi)?e.isNegative()?Qi:ts:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(as))return this.unsigned?Xi:Zi;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Zi}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:Hi(2,a-48),i=zi(t),s=i.mul(e);s.isNegative()||s.gt(n);)s=(i=zi(t-=o,this.unsigned)).mul(e);i.isZero()&&(i=Qi),r=r.add(i),n=n.sub(s)}return r},os.div=os.divide,os.modulo=function(e){return ji(e)||(e=Vi(e)),Mi?Gi((this.unsigned?Mi.rem_u:Mi.rem_s)(this.low,this.high,e.low,e.high),Mi.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},os.mod=os.modulo,os.rem=os.modulo,os.not=function(){return Gi(~this.low,~this.high,this.unsigned)},os.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},os.clz=os.countLeadingZeros,os.countTrailingZeros=function(){return this.low?Li(this.low):Li(this.high)+32},os.ctz=os.countTrailingZeros,os.and=function(e){return ji(e)||(e=Vi(e)),Gi(this.low&e.low,this.high&e.high,this.unsigned)},os.or=function(e){return ji(e)||(e=Vi(e)),Gi(this.low|e.low,this.high|e.high,this.unsigned)},os.xor=function(e){return ji(e)||(e=Vi(e)),Gi(this.low^e.low,this.high^e.high,this.unsigned)},os.shiftLeft=function(e){return ji(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Gi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Gi(0,this.low<<e-32,this.unsigned)},os.shl=os.shiftLeft,os.shiftRight=function(e){return ji(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Gi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Gi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},os.shr=os.shiftRight,os.shiftRightUnsigned=function(e){return ji(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?Gi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):Gi(32===e?this.high:this.high>>>e-32,0,this.unsigned)},os.shru=os.shiftRightUnsigned,os.shr_u=os.shiftRightUnsigned,os.rotateLeft=function(e){var t;return ji(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?Gi(this.high,this.low,this.unsigned):e<32?Gi(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):Gi(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},os.rotl=os.rotateLeft,os.rotateRight=function(e){var t;return ji(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?Gi(this.high,this.low,this.unsigned):e<32?Gi(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):Gi(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},os.rotr=os.rotateRight,os.toSigned=function(){return this.unsigned?Gi(this.low,this.high,!1):this},os.toUnsigned=function(){return this.unsigned?this:Gi(this.low,this.high,!0)},os.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},os.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},os.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Di.fromBytes=function(e,t,n){return n?Di.fromBytesLE(e,t):Di.fromBytesBE(e,t)},Di.fromBytesLE=function(e,t){return new Di(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Di.fromBytesBE=function(e,t){return new Di(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var is=function(){function e(t){var n=t.filehandle,r=t.path;if(K(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new Br(r)}}var t,n,r;return X(e,[{key:"_readLongWithOverflow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Di.fromBytesLE(e.slice(t,t+8),n);if(r.greaterThan(Number.MAX_SAFE_INTEGER)||r.lessThan(Number.MIN_SAFE_INTEGER))throw new TypeError("integer overflow");return r.toNumber()}},{key:"_getIndex",value:function(){return this.index||(this.index=this._readIndex()),this.index}},{key:"_readIndex",value:(r=Y(V().mark((function e(){var t,n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Yt.allocUnsafe(8),e.next=3,this.filehandle.read(t,0,8,0);case 3:if(n=this._readLongWithOverflow(t,0,!0)){e.next=6;break}return e.abrupt("return",[[0,0]]);case 6:if((r=new Array(n+1))[0]=[0,0],!((a=16*n)>Number.MAX_SAFE_INTEGER)){e.next=11;break}throw new TypeError("integer overflow");case 11:return t=Yt.allocUnsafe(a),e.next=14,this.filehandle.read(t,0,a,8);case 14:for(o=0;o<n;o+=1)i=this._readLongWithOverflow(t,16*o),s=this._readLongWithOverflow(t,16*o+8),r[o+1]=[i,s];return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getLastBlock",value:(n=Y(V().mark((function e(){var t;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndex();case 2:if((t=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",t[t.length-1]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getRelevantBlocksForRead",value:(t=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n+t,0!==t){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this._getIndex();case 5:for(o=[],i=function(e,t){var r=e[1];return r<=n&&(t?t[1]:Infinity)>n?0:r<n?-1:1},s=0,l=(a=e.sent).length-1,c=Math.floor(a.length/2),u=i(a[c],a[c+1]);0!==u;)u>0?l=c-1:u<0&&(s=c+1),c=Math.ceil((l-s)/2)+s,u=i(a[c],a[c+1]);o.push(a[c]),d=c+1;case 15:if(!(d<a.length)){e.next=22;break}if(o.push(a[d]),!(a[d][1]>=r)){e.next=19;break}return e.abrupt("break",22);case 19:d+=1,e.next=15;break;case 22:return o[o.length-1][1]<r&&o.push([]),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),ss=function(){function e(t){var n=t.filehandle,r=t.path,a=t.gziFilehandle,o=t.gziPath;if(K(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new Br(r)}if(!a&&!o&&!r)throw new TypeError("either gziFilehandle or gziPath must be defined");this.gzi=new is({filehandle:a,path:a||o||!r?"".concat(r,".gzi"):o})}var t,n,r,a;return X(e,[{key:"stat",value:(a=Y(V().mark((function e(){var t;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.filehandle.stat();case 2:return t=e.sent,e.t0=Object,e.t1=t,e.next=7,this.getUncompressedFileSize();case 7:return e.t2=e.sent,e.t3=void 0,e.t4=void 0,e.t5={size:e.t2,blocks:e.t3,blksize:e.t4},e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t5));case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUncompressedFileSize",value:(r=Y(V().mark((function e(){var t,n,r,a,o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getLastBlock();case 2:return t=ue(e.sent,2),n=t[1],e.next=7,this.filehandle.stat();case 7:return r=e.sent.size,a=Yt.allocUnsafe(4),e.next=12,this.filehandle.read(a,0,4,r-28-4);case 12:if(4===e.sent.bytesRead){e.next=16;break}throw new Error("read error");case 16:return o=a.readUInt32LE(0),e.abrupt("return",n+o);case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_readAndUncompressBlock",value:(n=Y(V().mark((function e(t,n,r){var a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=ue(n,1)[0],o=ue(r,1)[0]){e.next=7;break}return e.next=6,this.filehandle.stat();case 6:o=e.sent.size;case 7:return i=o-a,e.next=10,this.filehandle.read(t,0,i,a);case 10:return e.next=12,Fi(t.slice(0,i));case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"read",value:(t=Y(V().mark((function e(t,n,r,a){var o,i,s,l,c,u,d,f,p,h;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getRelevantBlocksForRead(r,a);case 2:o=e.sent,i=Yt.allocUnsafe(65536),s=n,l=0,c=0;case 7:if(!(c<o.length-1)){e.next=18;break}return e.next=10,this._readAndUncompressBlock(i,o[c],o[c+1]);case 10:u=e.sent,d=ue(o[c],2),p=(f=d[1])>=a?0:a-f,h=Math.min(a+r,f+u.length)-f,p>=0&&p<u.length&&(u.copy(t,s,p,h),s+=h-p,l+=h-p);case 15:c+=1,e.next=7;break;case 18:return e.abrupt("return",{bytesRead:l,buffer:t});case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a){return t.apply(this,arguments)})}]),e}();function ls(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}function cs(e,t){return us.apply(this,arguments)}function us(){return us=Y(V().mark((function e(t,n){var r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if((r=e.sent)&&r.length){e.next=5;break}throw new Error("No data read from FASTA index (FAI) file");case 5:return a=0,i=r.toString("utf8").split(/\r?\n/).filter((function(e){return/\S/.test(e)})).map((function(e){return e.split("\t")})).filter((function(e){return""!==e[0]})).map((function(e){return o&&o.name===e[0]||(o={name:e[0],id:a},a+=1),{id:o.id,name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}})),e.abrupt("return",{name:Object.fromEntries(i.map((function(e){return[e.name,e]}))),id:Object.fromEntries(i.map((function(e){return[e.id,e]})))});case 8:case"end":return e.stop()}}),e)}))),us.apply(this,arguments)}var ds=function(){function e(t){var n=t.fasta,r=t.fai,a=t.path,o=t.faiPath;if(K(this,e),n)this.fasta=n;else{if(!a)throw new Error("Need to pass filehandle for fasta or path to localfile");this.fasta=new Br(a)}if(r)this.fai=r;else if(o)this.fai=new Br(o);else{if(!a)throw new Error("Need to pass filehandle for  or path to localfile");this.fai=new Br("".concat(a,".fai"))}}var t,n,r,a,o,i,s,l,c;return X(e,[{key:"_getIndexes",value:(c=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.indexes||(this.indexes=cs(this.fai,t)),e.abrupt("return",this.indexes);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getSequenceNames",value:(l=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,this._getIndexes(t);case 3:return e.t1=e.sent.name,e.abrupt("return",e.t0.keys.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getSequenceSizes",value:(s=Y(V().mark((function e(t){var n,r,a;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,this._getIndexes(t);case 3:for(r=Object.values(e.sent.id),a=0;a<r.length;a+=1)n[r[a].name]=r[a].length;return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSequenceSize",value:(i=Y(V().mark((function e(t,n){var r;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.abrupt("return",null===(r=e.sent.name[t])||void 0===r?void 0:r.length);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"hasReferenceSequence",value:(o=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.t0=t,e.abrupt("return",!!e.sent.name[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getResiduesById",value:(a=Y(V().mark((function e(t,n,r,a){var o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.id[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"getResiduesByName",value:(r=Y(V().mark((function e(t,n,r,a){var o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.name[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,a){return r.apply(this,arguments)})},{key:"getSequence",value:(n=Y(V().mark((function e(t,n,r,a){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getResiduesByName(t,n,r,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"_fetchFromIndexEntry",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>3?l[3]:void 0,a=l.length>2?l[2]:void 0,!((n=l.length>1&&void 0!==l[1]?l[1]:0)<0)){e.next=6;break}throw new TypeError("regionStart cannot be less than 0");case 6:if((void 0===a||a>t.length)&&(a=t.length),!(n>=a)){e.next=9;break}return e.abrupt("return","");case 9:return o=ls(t,n),i=ls(t,a)-o,s=Yt.allocUnsafe(i),e.next=14,this.fasta.read(s,0,i,o,r);case 14:return e.abrupt("return",s.toString("utf8").replace(/\s+/g,""));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),fs=function(e){ee(n,e);var t=le(n);function n(e){var r,a=e.fasta,o=e.path,i=e.fai,s=e.faiPath,l=e.gzi,c=e.gziPath;return K(this,n),r=t.call(this,{fasta:a,path:o,fai:i,faiPath:s}),a&&l?r.fasta=new ss({filehandle:a,gziFilehandle:l}):o&&c&&(r.fasta=new ss({path:o,gziPath:c})),r}return X(n)}(ds);function ps(e){return e.split(">").filter((function(e){return/\S/.test(e)})).map((function(e){var t=de(e.split("\n")),n=t[0],r=t.slice(1),a=de(n.split(" ")),o=a[0],i=a.slice(1),s=r.join("").replace(/\s/g,"");return{id:o,description:i.join(" "),sequence:s}}))}var hs=function(){function e(t){var n=t.fasta,r=t.path;if(K(this,e),n)this.fasta=n;else{if(!r)throw new Error("Need to pass fasta or path");this.fasta=new Br(r)}this.data=this.fasta.readFile().then((function(e){return ps(e.toString("utf8"))}))}var t,n;return X(e,[{key:"fetch",value:(n=Y(V().mark((function e(t,n,r){var a,o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:if(a=e.sent.find((function(e){return e.id===t})),o=r-n,a){e.next=7;break}throw new Error("no sequence with id ".concat(t," exists"));case 7:return e.abrupt("return",a.sequence.substr(n,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getSequenceNames",value:(t=Y(V().mark((function e(){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:return e.abrupt("return",e.sent.map((function(e){return e.id})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ms=D({__proto__:null,parseSmallFasta:ps,FetchableSmallFasta:hs,IndexedFasta:ds,BgzipIndexedFasta:fs}),gs=D(Vr);Object.defineProperty(qr,"__esModule",{value:!0}),qr.AddAssemblyFromExternalChange=void 0;var ys=ms,vs=gs,bs=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","AddAssemblyFromExternalChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=ue(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,externalLocation:r.externalLocation}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.refSeqModel,o=t.user,i=this.assembly,s=this.changes,l=this.logger,u=(c=Dt.env.CHUNK_SIZE)&&Number(c),d=ve(s),e.prev=5,d.s();case 7:if((f=d.n()).done){e.next=45;break}return m=(h=f.value).assemblyName,y=(g=h.externalLocation).fa,v=g.fai,_=(b=g.gzi)?new ys.BgzipIndexedFasta({fasta:new vs.RemoteFile(y,{fetch:fetch}),fai:new vs.RemoteFile(v,{fetch:fetch}),gzi:new vs.RemoteFile(b,{fetch:fetch})}):new ys.IndexedFasta({fasta:new vs.RemoteFile(y,{fetch:fetch}),fai:new vs.RemoteFile(v,{fetch:fetch})}),e.next=14,_.getSequenceSizes();case 14:if(w=e.sent){e.next=17;break}throw new Error("No data read from indexed fasta getSequenceSizes");case 17:return e.next=19,n.findOne({name:m}).exec();case 19:if(!e.sent){e.next=22;break}throw new Error('Assembly "'.concat(m,'" already exists'));case 22:return e.next=24,r.find({default:!0}).exec();case 24:return x=e.sent.map((function(e){return e._id.toHexString()})),e.next=28,n.create([{_id:i,name:m,user:o,status:-1,externalLocation:g,checks:x}]);case 28:S=ue(e.sent,1),E=S[0],null===(p=l.debug)||void 0===p||p.call(l,'Added new assembly "'.concat(m,'", docId "').concat(E._id,'"')),e.t0=V().keys(w);case 33:if((e.t1=e.t0()).done){e.next=43;break}return k=e.t1.value,e.next=37,a.create([$($({name:k,assembly:E._id,length:w[k]},u?{chunkSize:u}:null),{},{user:o,status:-1})]);case 37:A=ue(e.sent,1),O=A[0],null===(C=l.debug)||void 0===C||C.call(l,'Added new refSeq "'.concat(k,'", docId "').concat(O._id,'"')),e.next=33;break;case 43:e.next=7;break;case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(5),d.e(e.t2);case 50:return e.prev=50,d.f(),e.finish(50);case 53:case"end":return e.stop()}}),e,this,[[5,47,50,53]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(tr.AssemblySpecificChange);qr.AddAssemblyFromExternalChange=bs;var _s={};Object.defineProperty(_s,"__esModule",{value:!0}),_s.AddAssemblyFromFileChange=void 0;var ws=ms,xs=function(e){ee(s,e);var t,n,r,a,o,i=le(s);function s(e,t){var n;return K(this,s),Q(se(n=i.call(this,e,t)),"typeName","AddAssemblyFromFileChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(s,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=ue(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(o=Y(V().mark((function e(t){var n,r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ve(this.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=11;break}return o=(a=r.value).assemblyName,i=a.fileIds,e.next=9,"gzi"in i?this.executeOnServerIndexed(t,o,i):this.executeOnServerFasta(t,o,i.fa);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return o.apply(this,arguments)})},{key:"executeOnServerIndexed",value:(a=Y(V().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,I,R;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(i=Dt.env.CHUNK_SIZE)&&Number(i),Dt.env.FILE_UPLOAD_FOLDER){e.next=5;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 5:return l=r.fa,c=r.fai,u=r.gzi,d=t.assemblyModel,f=t.checkModel,p=t.fileModel,h=t.filesService,m=t.refSeqModel,g=t.user,e.next=9,p.findById(l);case 9:if(null==(y=e.sent)?void 0:y.checksum){e.next=13;break}throw new Error("No checksum for file document ".concat(null==y?void 0:y.id));case 13:return e.next=15,p.findById(c);case 15:if(null==(v=e.sent)?void 0:v.checksum){e.next=19;break}throw new Error("No checksum for file document ".concat(null==v?void 0:v.id));case 19:return e.next=21,p.findById(u);case 21:if(null==(b=e.sent)?void 0:b.checksum){e.next=25;break}throw new Error("No checksum for file document ".concat(null==b?void 0:b.id));case 25:return _=h.getFileHandle(y),w=h.getFileHandle(v),x=h.getFileHandle(b),S=new ws.BgzipIndexedFasta({fasta:_,fai:w,gzi:x}),e.next=31,S.getSequenceSizes();case 31:return E=e.sent,e.next=34,Promise.all([_.close(),w.close(),x.close()]);case 34:return e.next=36,d.findOne({name:n}).exec();case 36:if(!e.sent){e.next=39;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 39:return e.next=41,f.find({isDefault:!0}).exec();case 41:return k=e.sent.map((function(e){return e._id.toHexString()})),e.next=45,d.create([{_id:this.assembly,name:n,user:g,status:-1,fileIds:r,checks:k}]);case 45:C=ue(e.sent,1),A=C[0],null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'Added new assembly "'.concat(n,'", docId "').concat(A._id,'"')),e.t0=V().keys(E);case 50:if((e.t1=e.t0()).done){e.next=60;break}return O=e.t1.value,e.next=54,m.create([$($({name:O,assembly:A._id,length:E[O]},s?{chunkSize:s}:null),{},{user:g,status:-1})]);case 54:I=ue(e.sent,1),R=I[0],null===(T=(N=this.logger).debug)||void 0===T||T.call(N,'Added new refSeq "'.concat(O,'", docId "').concat(R._id,'"')),e.next=50;break;case 60:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"executeOnServerFasta",value:(r=Y(V().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.assemblyModel,d=t.checkModel,f=t.fileModel,p=t.user,e.next=3,f.findById(r).exec();case 3:if(h=e.sent){e.next=6;break}throw new Error('File "'.concat(r,'" not found in Mongo'));case 6:return null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'FileId "'.concat(r,'", checksum "').concat(h.checksum,'"')),e.next=9,u.findOne({name:n}).exec();case 9:if(!e.sent){e.next=12;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 12:return e.next=14,d.find({default:!0}).exec();case 14:return m=e.sent.map((function(e){return e._id.toHexString()})),e.next=18,u.create([{_id:this.assembly,name:n,user:p,status:-1,fileIds:{fa:r},checks:m}]);case 18:return g=ue(e.sent,1),y=g[0],null===(i=(s=this.logger).debug)||void 0===i||i.call(s,'Added new assembly "'.concat(n,'", docId "').concat(y._id,'"')),null===(l=(c=this.logger).debug)||void 0===l||l.call(c,'File type: "'.concat(h.type,'", assemblyId: "').concat(y._id,'"')),e.next=25,this.addRefSeqIntoDb(h,y._id.toString(),t);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new s({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),s}(kr.FromFileBaseChange);_s.AddAssemblyFromFileChange=xs;var Ss={},Es={};Object.defineProperty(Es,"__esModule",{value:!0}),Es.DeleteFeatureChange=void 0,Es.findAndDeleteChildFeature=As,Es.isDeleteFeatureChange=function(e){return"DeleteFeatureChange"===e.typeName};var ks=Ss,Cs=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","DeleteFeatureChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return"Feature deleted successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,deletedFeature:a.deletedFeature,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l=this;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=ve(this.changes),e.prev=3,s=V().mark((function e(){var t,o,s,c,u,d,f,p,h;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(o=i.value).deletedFeature,c=o.parentFeatureId,e.next=4,n.findOne({allIds:s._id}).session(r).exec();case 4:if(u=e.sent){e.next=9;break}throw d="*** ERROR: The following featureId was not found in database ='".concat(s._id,"'"),a.error(d),new Error(d);case 9:if(!u._id.equals(s._id)){e.next=16;break}if(!c){e.next=12;break}throw new Error('Feature "'.concat(s._id,'" is top-level, but received a parent feature ID'));case 12:return e.next=14,n.findByIdAndDelete(u._id);case 14:return null===(f=a.debug)||void 0===f||f.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'". Whole document deleted.')),e.abrupt("return",1);case 16:return(p=As(u,s._id,l)).push(s._id),u.allIds=u.allIds.filter((function(e){return!p.includes(e)})),u.markModified("children"),e.prev=20,e.next=23,u.save();case 23:e.next=29;break;case 25:throw e.prev=25,e.t0=e.catch(20),null===(h=a.debug)||void 0===h||h.call(a,"*** FAILED: ".concat(e.t0)),e.t0;case 29:null===(t=a.debug)||void 0===t||t.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'"'));case 30:case"end":return e.stop()}}),e,null,[[20,25]])})),o.s();case 6:if((i=o.n()).done){e.next=12;break}return e.delegateYield(s(),"t0",8);case 8:if(!e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(3),o.e(e.t1);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=18;break}if(o=(a=r.value).deletedFeature,!(i=a.parentFeatureId)){e.next=15;break}if(s=t.getFeature(i)){e.next=12;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 12:s.deleteChild(o._id),e.next=16;break;case 15:t.getFeature(o._id)&&t.deleteFeature(o._id);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=fe(this.changedIds).reverse(),o=fe(n).reverse().map((function(e){return{addedFeature:e.deletedFeature,parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new ks.AddFeatureChange({changedIds:a,typeName:"AddFeatureChange",changes:o,assembly:t},{logger:r})}}]),o}(tr.FeatureChange);function As(e,t,n){if(!e.children)throw new Error("Feature ".concat(e._id," has no children"));var r=e._id,a=e.children,o=a.get(t);if(o){var i=n.getChildFeatureIds(o);return a.delete(t),i}var s,l=ve(a);try{for(l.s();!(s=l.n()).done;){var c=ue(s.value,2)[1];try{return As(c,t,n)}catch(e){}}}catch(e){l.e(e)}finally{l.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(r))}Es.DeleteFeatureChange=Cs,Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.AddFeatureChange=void 0,Ss.isAddFeatureChange=function(e){return"AddFeatureChange"===e.typeName};var Os=Es,Ts=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","AddFeatureChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return"Feature added successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,addedFeature:a.addedFeature,parentFeatureId:a.parentFeatureId,copyFeature:a.copyFeature,allIds:a.allIds}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,I,R,F,P,M,D,j,L,q;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.assemblyModel,o=t.featureModel,i=t.refSeqModel,s=t.session,l=t.user,c=this.assembly,u=this.changes,d=this.logger,e.next=4,a.findById(c).session(s).exec();case 4:if(e.sent){e.next=9;break}throw f='*** ERROR: Assembly with id "'.concat(c,'" not found'),d.error(f),new Error(f);case 9:p=0,null===(n=d.debug)||void 0===n||n.call(d,"changes: ".concat(JSON.stringify(u))),(h=Dt.env.INDEXED_IDS)&&(m=h.split(",")),g=ve(u),e.prev=14,g.s();case 16:if((y=g.n()).done){e.next=65;break}return b=y.value,null===(v=d.debug)||void 0===v||v.call(d,"change: ".concat(JSON.stringify(b))),w=b.allIds,x=b.copyFeature,S=b.parentFeatureId,E=(_=b.addedFeature)._id,k=_.refSeq,e.next=23,i.findById(k).session(s).exec();case 23:if(e.sent){e.next=26;break}throw new Error('RefSeq was not found by assembly "'.concat(c,'" and seq_id "').concat(k,'" not found'));case 26:if(!x){e.next=37;break}return A=this.getIndexedIds(_,m),e.next=30,o.create([$($({},_),{},{allIds:w,indexedIds:A,status:-1,user:l})],{session:s});case 30:O=ue(e.sent,1),T=O[0],null===(C=d.debug)||void 0===C||C.call(d,'Copied feature, docId "'.concat(T._id,'" to assembly "').concat(c,'"')),p++,e.next=62;break;case 37:if(!S){e.next=53;break}return e.next=40,o.findOne({allIds:S}).session(s).exec();case 40:if(I=e.sent){e.next=43;break}throw new Error('Could not find feature with ID "'.concat(S,'"'));case 43:if(R=this.getFeatureFromId(I,S)){e.next=46;break}throw new Error('Could not find feature with ID "'.concat(S,'" in feature "').concat(I._id,'"'));case 46:return this.addChild(R,_),F=this.getChildFeatureIds(_),(N=I.allIds).push.apply(N,[E].concat(fe(F))),e.next=51,I.save();case 51:e.next=62;break;case 53:return M=this.getChildFeatureIds(_),D=[E].concat(fe(M)),j=this.getIndexedIds(_,m),e.next=58,o.create([$({allIds:D,indexedIds:j,status:0},_)],{session:s});case 58:L=ue(e.sent,1),q=L[0],null===(P=d.verbose)||void 0===P||P.call(d,'Added docId "'.concat(q._id,'"'));case 62:p++;case 63:e.next=16;break;case 65:e.next=70;break;case 67:e.prev=67,e.t0=e.catch(14),g.e(e.t0);case 70:return e.prev=70,g.f(),e.finish(70);case 73:null===(r=d.debug)||void 0===r||r.call(d,"Added ".concat(p," new feature(s) into database."));case 74:case"end":return e.stop()}}),e,this,[[14,67,70,73]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=this.assembly,r=ve(this.changes),e.prev=4,r.s();case 6:if((a=r.n()).done){e.next=24;break}if(i=(o=a.value).addedFeature,!(s=o.parentFeatureId)){e.next=21;break}if(l=t.getFeature(s)){e.next=17;break}return e.next=14,t.loadFeatures([{assemblyName:n,refName:i.refSeq,start:i.min,end:i.max}]);case 14:if(l=t.getFeature(s)){e.next=17;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 17:l.attributes.get("_id")||l.setAttribute("_id",[l._id]),l.addChild(i),e.next=22;break;case 21:t.addFeature(n,i);case 22:e.next=6;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(4),r.e(e.t0);case 29:return e.prev=29,r.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,this,[[4,26,29,32]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=fe(this.changedIds).reverse(),a=fe(t).reverse().map((function(e){return{deletedFeature:e.addedFeature,parentFeatureId:e.parentFeatureId}}));return new Os.DeleteFeatureChange({changedIds:r,typeName:"DeleteFeatureChange",changes:a,assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Ss.AddFeatureChange=Ts;var Ns={};Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.AddFeaturesFromFileChange=void 0;var Is=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n,r;return K(this,o),Q(se(r=a.call(this,e,t)),"typeName","AddFeaturesFromFileChange"),Q(se(r),"changes",void 0),Q(se(r),"deleteExistingFeatures",!1),r.deleteExistingFeatures=null!==(n=e.deleteExistingFeatures)&&void 0!==n&&n,r.changes="changes"in e?e.changes:[e],r}return X(o,[{key:"notification",get:function(){return"Features have been added. To see them, please refresh the page."}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.deleteExistingFeatures,r=this.typeName;return 1===t.length?{typeName:r,assembly:e,fileId:ue(t,1)[0].fileId,deleteExistingFeatures:n}:{typeName:r,assembly:e,changes:t,deleteExistingFeatures:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.fileModel,a=t.filesService,o=this.changes,i=this.logger,!this.deleteExistingFeatures){e.next=5;break}return e.next=5,this.removeExistingFeatures(t);case 5:s=ve(o),e.prev=6,s.s();case 8:if((l=s.n()).done){e.next=57;break}if(d=(u=l.value).fileId,f=u.parseOptions,Dt.env.FILE_UPLOAD_FOLDER){e.next=14;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 14:return e.next=16,r.findById(d).exec();case 16:if(p=e.sent){e.next=19;break}throw new Error('File "'.concat(d,'" not found in Mongo'));case 19:null===(c=i.debug)||void 0===c||c.call(i,'FileId "'.concat(d,'", checksum "').concat(p.checksum,'"')),m=void 0===(h=(null!=f?f:{}).bufferSize)?1e4:h,g=a.parseGFF3(a.getFileStream(p),{bufferSize:m}),y=0,v=!1,b=!1,e.prev=25,w=U(g);case 27:return e.next=29,w.next();case 29:if(!(v=!(x=e.sent).done)){e.next=39;break}return S=x.value,e.next=34,this.addFeatureIntoDb(S,t);case 34:++y%1e3==0&&(null===(E=i.debug)||void 0===E||E.call(i,"Processed ".concat(y," features")));case 36:v=!1,e.next=27;break;case 39:e.next=45;break;case 41:e.prev=41,e.t0=e.catch(25),b=!0,_=e.t0;case 45:if(e.prev=45,e.prev=46,!v||null==w.return){e.next=50;break}return e.next=50,w.return();case 50:if(e.prev=50,!b){e.next=53;break}throw _;case 53:return e.finish(50);case 54:return e.finish(45);case 55:e.next=8;break;case 57:e.next=62;break;case 59:e.prev=59,e.t1=e.catch(6),s.e(e.t1);case 62:return e.prev=62,s.f(),e.finish(62);case 65:null===(n=i.debug)||void 0===n||n.call(i,"New features added into database!");case 66:case"end":return e.stop()}}),e,this,[[6,59,62,65],[25,41,45,55],[46,,50,54]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(kr.FromFileBaseChange);Ns.AddFeaturesFromFileChange=Is;var Rs={};Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.AddRefSeqAliasesChange=void 0;var Fs=A.default,Ps=function(e){ee(r,e);var t,n=le(r);function r(e,t){var a;return K(this,r),Q(se(a=n.call(this,e,t)),"typeName","AddRefSeqAliasesChange"),Q(se(a),"refSeqAliases",void 0),a.refSeqAliases=e.refSeqAliases,a}return X(r,[{key:"executeOnClient",value:function(e){var t,n=(0,Fs.getSession)(e).assemblyManager.get(this.assembly);if(!n)throw new Error("assembly ".concat(this.assembly," not found"));var r,a=null!==(t=n.refNameAliases)&&void 0!==t?t:{},o=ve(this.refSeqAliases);try{for(o.s();!(r=o.n()).done;){var i,s=r.value,l=s.refName,c=ve(s.aliases);try{for(c.s();!(i=c.n()).done;)a[i.value]=l}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}return n.setRefNameAliases(a),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,refSeqAliases:this.refSeqAliases}}},{key:"executeOnServer",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.refSeqModel,r=t.session,a=this.assembly,o=this.logger,i=ve(this.refSeqAliases),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=13;break}return c=s.value,null===(l=o.debug)||void 0===l||l.call(o,"Updating Refname alias for assembly: ".concat(a,", refSeqAlias: ").concat(JSON.stringify(c))),u=c.aliases,d=c.refName,e.next=11,n.updateOne({assembly:a,name:d},{$set:{aliases:u}}).session(r);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"RefSeq aliases have been added."}}]),r}(tr.AssemblySpecificChange);Rs.AddRefSeqAliasesChange=Ps;var Ms={};Object.defineProperty(Ms,"__esModule",{value:!0}),Ms.DeleteAssemblyChange=void 0;var Ds=A.default,js=function(e){ee(o,e);var t,n,r,a=le(o);function o(){var e;K(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Q(se(e=a.call.apply(a,[this].concat(n))),"typeName","DeleteAssemblyChange"),e}return X(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.assembly,'" deleted successfully.')}},{key:"toJSON",value:function(){return{typeName:this.typeName,assembly:this.assembly}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=t.featureModel,o=t.refSeqChunkModel,i=t.refSeqModel,s=t.session,l=this.assembly,c=this.logger,e.next=4,r.findById(l).session(s).exec();case 4:if(e.sent){e.next=9;break}throw u='*** ERROR: Assembly with id "'.concat(l,'" not found'),c.error(u),new Error(u);case 9:return e.next=11,i.find({assembly:l}).exec();case 11:return d=e.sent.map((function(e){return e._id})),e.next=15,o.deleteMany({refSeq:d}).exec();case 15:return e.next=17,a.deleteMany({refSeq:d}).exec();case 17:return e.next=19,i.deleteMany({assembly:l}).exec();case 19:return e.next=21,r.findByIdAndDelete(l).exec();case 21:null===(n=c.debug)||void 0===n||n.call(c,'Assembly "'.concat(l,'" deleted from database.'));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.assembly,t){e.next=3;break}throw new Error("No data store");case 3:return o=(0,Ds.getSession)(t),t.assemblies.has(a)&&t.deleteAssembly(a),e.next=7,null===(n=o.removeAssembly)||void 0===n?void 0:n.call(o,a);case 7:return e.next=9,null===(r=o.removeSessionAssembly)||void 0===r?void 0:r.call(o,a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"DeleteAssemblyChange",assembly:this.assembly},{logger:this.logger})}}]),o}(tr.AssemblySpecificChange);Ms.DeleteAssemblyChange=js;var Ls={};Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.DeleteUserChange=void 0;var qs=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","DeleteUserChange"),Q(se(n),"changes",void 0),Q(se(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return X(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,userId:this.userId}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.userModel,a=this.logger,o=this.userId,e.next=4,r.findOneAndDelete({_id:o}).session(n).exec();case 4:if(e.sent){e.next=9;break}throw i='*** ERROR: User with id "'.concat(o,'" not found'),a.error(i),new Error(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,userId:this.userId},{logger:this.logger})}}]),o}(tr.Change);Ls.DeleteUserChange=qs;var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.FeatureAttributeChange=void 0,Bs.isFeatureAttributeChange=function(e){return"FeatureAttributeChange"===e.typeName};var Us=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","FeatureAttributeChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldAttributes:a.oldAttributes,newAttributes:a.newAttributes}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=26;break}return d=l.value.featureId,e.next=11,n.findOne({allIds:d}).session(r).exec();case 11:if(f=e.sent){e.next=16;break}throw p="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),o.error(p),new Error(p);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(f))),h=this.getFeatureFromId(f,d)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(h))),i.push({feature:h,topLevelFeature:f});case 24:e.next=6;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(4),s.e(e.t0);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m=ve(a.entries()),e.prev=35,m.s();case 37:if((g=m.n()).done){e.next=55;break}return v=ue(g.value,2),w=(b=i[v[0]]).topLevelFeature,(_=b.feature).attributes=v[1].newAttributes,w._id.equals(_._id)?w.markModified("attributes"):w.markModified("children"),e.prev=43,e.next=46,w.save();case 46:e.next=52;break;case 48:throw e.prev=48,e.t1=e.catch(43),null===(x=o.debug)||void 0===x||x.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 52:null===(y=o.debug)||void 0===y||y.call(o,"*** Feature attributes modified (added, edited or deleted), docId: ".concat(JSON.stringify(w)));case 53:e.next=37;break;case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(35),m.e(e.t2);case 60:return e.prev=60,m.f(),e.finish(60);case 63:case"end":return e.stop()}}),e,this,[[4,28,31,34],[35,57,60,63],[43,48]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("applyToLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=ue(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setAttributes(new Map(Object.entries(this.changes[o].newAttributes)));case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger;return new o({changedIds:fe(this.changedIds).reverse(),typeName:"FeatureAttributeChange",changes:fe(t).reverse().map((function(e){return{featureId:e.featureId,oldAttributes:e.newAttributes,newAttributes:e.oldAttributes}})),assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Bs.FeatureAttributeChange=Us;var zs={},Gs=["__v","_id","assemblies","configuration","internetAccounts","plugins","tracks"],Hs=["hasRole"];function $s(e){var t,n=e.assemblies,r=e.configuration,a=e.internetAccounts,o=e.plugins,i=e.tracks,s=ie(e,Gs);if(n&&(s.assemblies=n.filter((function(e){return"ApolloSequenceAdapter"!==e.sequence.adapter.type}))),null!=r&&null!==(t=r.ApolloPlugin)&&void 0!==t&&t.hasRole){var l=ie(r.ApolloPlugin,Hs);s.configuration=$($({},r),{},{ApolloPlugin:l})}return a&&(s.internetAccounts=a.filter((function(e){return"ApolloInternetAccount"!==e.type}))),o&&(s.plugins=o.filter((function(e){return"Apollo"!==e.name}))),i&&(s.tracks=i.filter((function(e){return"ApolloTrack"!==e.type}))),s}Object.defineProperty(zs,"__esModule",{value:!0}),zs.ImportJBrowseConfigChange=void 0,zs.filterJBrowseConfig=$s;var Vs=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","ImportJBrowseConfigChange"),Q(se(n),"oldJBrowseConfig",void 0),Q(se(n),"newJBrowseConfig",void 0),n.oldJBrowseConfig=e.oldJBrowseConfig,n.newJBrowseConfig=e.newJBrowseConfig,n}return X(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,oldJBrowseConfig:this.oldJBrowseConfig,newJBrowseConfig:this.newJBrowseConfig}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.jbrowseConfigModel,a=this.logger,o=this.newJBrowseConfig,e.next=4,r.deleteMany();case 4:if(o){e.next=6;break}return e.abrupt("return");case 6:return i=$s(o),e.next=9,r.create(i);case 9:null===(n=a.debug)||void 0===n||n.call(a,"Stored new JBrowse Config");case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:this.newJBrowseConfig,newJBrowseConfig:this.oldJBrowseConfig},{logger:this.logger})}}]),o}(tr.Change);zs.ImportJBrowseConfigChange=Vs;var Ws={};Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.LocationEndChange=void 0,Ws.isLocationEndChange=function(e){return"LocationEndChange"===e.typeName};var Js=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","LocationEndChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldEnd:a.oldEnd,newEnd:a.newEnd}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=ve(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}d=(u=s.value).featureId,f=u.oldEnd,p=u.newEnd,h=void 0,m=void 0,g=ve(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,d))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:d}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,d)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.max===f){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.max=p,h._id.equals(m._id)?h.markModified("end"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newEnd,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMax(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:fe(this.changedIds).reverse(),typeName:r,changes:fe(t).reverse().map((function(e){return{featureId:e.featureId,oldEnd:e.newEnd,newEnd:e.oldEnd}})),assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Ws.LocationEndChange=Js;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.LocationStartChange=void 0,Ys.isLocationStartChange=function(e){return"LocationStartChange"===e.typeName};var Ks=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","LocationStartChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStart:a.oldStart,newStart:a.newStart}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=ve(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}d=(u=s.value).featureId,f=u.oldStart,p=u.newStart,h=void 0,m=void 0,g=ve(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,d))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:d}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,d)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.min===f){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.min=p,h._id.equals(m._id)?h.markModified("start"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newStart,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMin(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:fe(this.changedIds).reverse(),typeName:r,changes:fe(t).reverse().map((function(e){return{featureId:e.featureId,oldStart:e.newStart,newStart:e.oldStart}})),assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Ys.LocationStartChange=Ks;var Zs={},Xs={};Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.splitStringIntoChunks=function(e,t){for(var n=[],r=0;r<e.length;r+=t){var a=e.slice(r,r+t);n.push(a)}return n},Xs.getPrintableId=function(e){var t,n,r=e,a=null===(t=r.attributes.get("gff_id"))||void 0===t?void 0:t.join(",");if(a)return"ID=".concat(a," (_id: ").concat(e._id.toString(),")");var o=null===(n=r.attributes.get("gff_name"))||void 0===n?void 0:n.join(",");return o?"Name=".concat(o," (_id: ").concat(e._id.toString(),")"):"_id: ".concat(e._id.toString())},Xs.attributesToRecords=function(e){var t={};if(!e)return t;for(var n=0,r=Object.entries(e);n<r.length;n++){var a=ue(r[n],2),o=a[1];t[a[0]]=null==o?void 0:o.slice()}return t},Xs.stringifyAttributes=function(e){if(!e)return"";for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var a=ue(r[n],2),o=a[1],i=a[0];i.startsWith("gff_")&&(i=(i=i.slice(4)).charAt(0).toUpperCase()+i.slice(1)),t.push(o?"".concat(i,"=").concat(o.join(",")):i)}return encodeURIComponent(t.join(";"))};var Qs={};Object.defineProperty(Qs,"__esModule",{value:!0}),Qs.UndoMergeExonsChange=void 0;var el=Zs,tl=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","UndoMergeExonsChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonsToRestore:a.exonsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=ve(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.exonsToRestore).length){e.next=10;break}throw new Error("Expected exactly two exons to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),d=ve(s);try{for(d.s();!(f=d.n()).done;)this.addChild(u,h=f.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(fe(m)))}catch(e){d.e(e)}finally{d.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).exonsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=ve(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=fe(this.changedIds).reverse(),a=fe(t).reverse().map((function(e){return{firstExon:e.exonsToRestore[0],secondExon:e.exonsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new el.MergeExonsChange({changedIds:r,typeName:"MergeExonsChange",changes:a,assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Qs.UndoMergeExonsChange=tl,Object.defineProperty(Zs,"__esModule",{value:!0}),Zs.MergeExonsChange=void 0;var nl=Xs,rl=Es,al=Qs,ol=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","MergeExonsChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return"Exons successfully merged"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstExon:a.firstExon,secondExon:a.secondExon,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l=this;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=ve(this.changes),e.prev=3,s=V().mark((function e(){var t,o,s,c,u,d,f,p;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstExon,s=t.secondExon,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(d=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return d.min=Math.min(o.min,s.min),d.max=Math.max(o.max,s.max),(f=d.attributes?JSON.parse(JSON.stringify(d.attributes)):{}).merged_with=[(0,nl.stringifyAttributes)((0,nl.attributesToRecords)(s.attributes))],d.attributes=f,(p=(0,rl.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!p.includes(e)})),e.next=24,c.save();case 24:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=20;break}if(c=(s=r.value).secondExon,u=t.getFeature((l=s.firstExon)._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(l._id,'"'));case 11:u.setMin(Math.min(l.min,c.min)),u.setMax(Math.max(l.max,c.max)),d=null!==(a=null===(o=u.attributes.get("merged_with"))||void 0===o?void 0:o.slice())&&void 0!==a?a:[],f=(0,nl.stringifyAttributes)((0,nl.attributesToRecords)(c.attributes)),d.includes(f)||d.push(f),u.setAttribute("merged_with",d),null===(i=u.parent)||void 0===i||i.deleteChild(c._id);case 18:e.next=5;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),n.e(e.t0);case 25:return e.prev=25,n.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[3,22,25,28]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=fe(this.changedIds).reverse(),o=fe(n).reverse().map((function(e){return{exonsToRestore:[e.firstExon,e.secondExon],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new al.UndoMergeExonsChange({changedIds:a,typeName:"UndoMergeExonsChange",changes:o,assembly:t},{logger:r})}}]),o}(tr.FeatureChange);Zs.MergeExonsChange=ol;var il={},sl={};Object.defineProperty(sl,"__esModule",{value:!0}),sl.UndoMergeTranscriptsChange=void 0;var ll=il,cl=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","UndoMergeTranscriptsChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,transcriptsToRestore:a.transcriptsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=ve(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.transcriptsToRestore).length){e.next=10;break}throw new Error("Expected exactly two transcripts to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),d=ve(s);try{for(d.s();!(f=d.n()).done;)this.addChild(u,h=f.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(fe(m)))}catch(e){d.e(e)}finally{d.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).transcriptsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=ve(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=fe(this.changedIds).reverse(),a=fe(t).reverse().map((function(e){return{firstTranscript:e.transcriptsToRestore[0],secondTranscript:e.transcriptsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new ll.MergeTranscriptsChange({changedIds:r,typeName:"MergeTranscriptsChange",changes:a,assembly:e},{logger:n})}}]),o}(tr.FeatureChange);sl.UndoMergeTranscriptsChange=cl,Object.defineProperty(il,"__esModule",{value:!0}),il.MergeTranscriptsChange=void 0;var ul=A.default,dl=O.default,fl=Xs,pl=Es,hl=sl,ml=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","MergeTranscriptsChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return"Transcripts successfully merged"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstTranscript:a.firstTranscript,secondTranscript:a.secondTranscript,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l=this;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=ve(this.changes),e.prev=3,s=V().mark((function e(){var t,o,s,c,u,d,f;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstTranscript,s=t.secondTranscript,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(d=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return l.mergeTranscriptsOnServer(d,s),(f=(0,pl.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!f.includes(e)})),e.next=20,c.save();case 20:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"mergeTranscriptsOnServer",value:function(e,t){e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max);var n=e.attributes?JSON.parse(JSON.stringify(e.attributes)):{};if(t.attributes&&(Object.keys(n).includes("merged_with")||(n.merged_with=[]),n.merged_with.push((0,fl.stringifyAttributes)((0,fl.attributesToRecords)(t.attributes)))),e.attributes=n,t.children)for(var r=0,a=Object.entries(t.children);r<a.length;r++){var o=ue(a[r],2);this.mergeFeatureIntoTranscriptOnServer(o[1],e)}}},{key:"mergeFeatureIntoTranscriptOnServer",value:function(e,t){var n=this;t.children||(t.children=new Map);var r,a,o,i=!1,s=ve(t.children);try{for(s.s();!(o=s.n()).done;){var l=ue(o.value,2)[1];if(i&&r?a=!0:(a=!1,r=l),r.type===e.type&&r.type===l.type&&(0,ul.doesIntersect2)(e.min,e.max,r.min,r.max)&&(0,ul.doesIntersect2)(l.min,l.max,r.min,r.max)){r.min=Math.min(e.min,r.min,l.min),r.max=Math.max(e.max,r.max,l.max),r.attributes||(r.attributes={});var c=JSON.parse(JSON.stringify(r.attributes));Object.keys(c).includes("merged_with")||(c.merged_with=[]);var u=c.merged_with;if(u.push((0,fl.stringifyAttributes)((0,fl.attributesToRecords)(e.attributes))),a){var d=l.attributes?JSON.parse(JSON.stringify(l.attributes)):void 0;u.push((0,fl.stringifyAttributes)(d)),t.children.delete(l._id.toString())}c.merged_with=fe(new Set(u)),r.attributes=c,i=!0}}}catch(e){s.e(e)}finally{s.f()}i&&r&&e.children&&Object.entries(e.children).map((function(e){var t=ue(e,2);n.addChild(r,t[1])})),this.addChild(t,i&&r?r:e)}},{key:"executeOnClient",value:(n=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=15;break}if(o=ue(r.value,2),i=o[1],l=(s=this.changes[o[0]]).secondTranscript,c=t.getFeature(s.firstTranscript._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 11:this.mergeTranscriptsOnClient(c,l),null===(a=c.parent)||void 0===a||a.deleteChild(l._id);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"mergeTranscriptsOnClient",value:function(e,t){var n,r;e.setMin(Math.min(e.min,t.min)),e.setMax(Math.max(e.max,t.max));var a=null!==(n=null===(r=e.attributes.get("merged_with"))||void 0===r?void 0:r.slice())&&void 0!==n?n:[],o=(0,fl.stringifyAttributes)((0,fl.attributesToRecords)(t.attributes));if(a.includes(o)||a.push(o),e.setAttribute("merged_with",a),t.children)for(var i=0,s=Object.entries(t.children);i<s.length;i++){var l=ue(s[i],2);this.mergeFeatureIntoTranscriptOnClient(l[1],e)}}},{key:"mergeFeatureIntoTranscriptOnClient",value:function(e,t){t.children||(t.children=new Map);var n,r,a,o=!1,i=ve(t.children);try{for(i.s();!(a=i.n()).done;){var s=ue(a.value,2)[1];if(o&&n?r=!0:(r=!1,n=s),n.type===e.type&&n.type===s.type&&(0,ul.doesIntersect2)(e.min,e.max,n.min,n.max)&&(0,ul.doesIntersect2)(s.min,s.max,n.min,n.max)){var l,c;n.setMin(Math.min(e.min,n.min,s.min)),n.setMax(Math.max(e.max,n.max,s.max));var u=null!==(l=null===(c=n.attributes.get("merged_with"))||void 0===c?void 0:c.slice())&&void 0!==l?l:[];u.push((0,fl.stringifyAttributes)((0,fl.attributesToRecords)(e.attributes))),r&&(u.push((0,fl.stringifyAttributes)((0,dl.getSnapshot)(s).attributes)),t.deleteChild(s._id)),n.setAttribute("merged_with",fe(new Set(u))),o=!0}}}catch(e){i.e(e)}finally{i.f()}o&&n&&e.children&&Object.entries(e.children).map((function(e){var t=ue(e,2);n.addChild(t[1])})),t.addChild(o&&n?(0,dl.getSnapshot)(n):e)}},{key:"executeOnLocalGFF3",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=fe(this.changedIds).reverse(),o=fe(n).reverse().map((function(e){return{transcriptsToRestore:[e.firstTranscript,e.secondTranscript],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new hl.UndoMergeTranscriptsChange({changedIds:a,typeName:"UndoMergeTranscriptsChange",changes:o,assembly:t},{logger:r})}}]),o}(tr.FeatureChange);il.MergeTranscriptsChange=ml;var gl={},yl={};Object.defineProperty(yl,"__esModule",{value:!0}),yl.UndoSplitExonChange=void 0;var vl=Es,bl=gl,_l=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","UndoSplitExonChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToRestore:a.exonToRestore,parentFeatureId:a.parentFeatureId,idsToDelete:a.idsToDelete,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s=this;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=ve(this.changes),e.prev=3,i=V().mark((function e(){var t,a,i,l,c,u,d,f;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(a=o.value).exonToRestore,l=a.parentFeatureId,c=a.idsToDelete,e.next=4,n.findOne({allIds:l}).session(r).exec();case 4:if(u=e.sent){e.next=7;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 7:if(d=s.getFeatureFromId(u,l)){e.next=10;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(u._id.toString(),'"'));case 10:return d.children||(d.children=new Map),s.addChild(d,i),f=s.getChildFeatureIds(i),(t=u.allIds).push.apply(t,[i._id].concat(fe(f))),u.allIds=u.allIds.filter((function(e){return!c.includes(e)})),c.map((function(e){return(0,vl.findAndDeleteChildFeature)(u,e,s)})),e.next=18,u.save();case 18:case"end":return e.stop()}}),e)})),a.s();case 6:if((o=a.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),a.e(e.t1);case 15:return e.prev=15,a.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changes),e.prev=4,a=V().mark((function e(){var n,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=r.value).exonToRestore,i=n.idsToDelete,o=n.parentFeatureId){e.next=4;break}throw new Error("Parent ID is missing");case 4:if(s=t.getFeature(o)){e.next=7;break}throw new Error('Could not find parent feature "'.concat(o,'"'));case 7:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),s.addChild(a),i.map((function(e){s.deleteChild(e)}));case 10:case"end":return e.stop()}}),e)})),n.s();case 7:if((r=n.n()).done){e.next=11;break}return e.delegateYield(a(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),n.e(e.t1);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[4,13,16,19]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=fe(this.changedIds).reverse(),a=fe(t).reverse().map((function(e){return{parentFeatureId:e.parentFeatureId,exonToBeSplit:e.exonToRestore,upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return new bl.SplitExonChange({changedIds:r,typeName:"SplitExonChange",changes:a,assembly:e},{logger:n})}}]),o}(tr.FeatureChange);yl.UndoSplitExonChange=_l,Object.defineProperty(gl,"__esModule",{value:!0}),gl.SplitExonChange=void 0;var wl=Es,xl=yl,Sl=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","SplitExonChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"notification",get:function(){return"Exon successfully split"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToBeSplit:a.exonToBeSplit,parentFeatureId:a.parentFeatureId,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l=this;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=ve(this.changes),e.prev=3,s=V().mark((function e(){var t,o,s,c,u,d,f,p,h,m,g,y,v,b,_;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).exonToBeSplit,s=t.parentFeatureId,c=t.upstreamCut,u=t.downstreamCut,d=t.leftExonId,f=t.rightExonId,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(p=e.sent){e.next=9;break}throw h="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(h),new Error(h);case 9:if(null!=(m=l.getFeatureFromId(p,s))&&m.children){e.next=12;break}throw new Error("ERROR: There should be at least one child (i.e. the exon to be split)");case 12:return g=l.makeSplitExons(o,c,u,d,f),y=ue(g,2),b=y[1],m.children.set((v=y[0])._id,$($({allIds:[]},v),{},{_id:v._id})),m.children.set(b._id,$($({allIds:[]},b),{},{_id:b._id})),m.children=new Map(fe(m.children.entries()).sort((function(e,t){return e[1].min-t[1].min}))),(_=(0,wl.findAndDeleteChildFeature)(p,o._id,l)).push(o._id),p.allIds=p.allIds.filter((function(e){return!_.includes(e)})),p.allIds.push(v._id,b._id),e.next=22,p.save();case 22:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=19;break}if(a=ue(r.value,1),i=(o=this.changes[a[0]]).exonToBeSplit,l=o.upstreamCut,c=o.downstreamCut,u=o.leftExonId,d=o.rightExonId,s=o.parentFeatureId){e.next=10;break}throw new Error("TODO: Split exon without parent");case 10:if(f=this.makeSplitExons(i,l,c,u,d),p=ue(f,2),h=p[0],m=p[1],g=t.getFeature(s)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 14:g.addChild(h),g.addChild(m),t.getFeature(i._id)&&t.deleteFeature(i._id);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=fe(this.changedIds).reverse(),o=fe(n).reverse().map((function(e){return{exonToRestore:e.exonToBeSplit,parentFeatureId:e.parentFeatureId,idsToDelete:[e.leftExonId,e.rightExonId],upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new xl.UndoSplitExonChange({changedIds:a,typeName:"UndoSplitExonChange",changes:o,assembly:t},{logger:r})}},{key:"makeSplitExons",value:function(e,t,n,r,a){var o=JSON.parse(JSON.stringify(e));delete o.attributes._id,delete o.attributes.gff_id;var i=structuredClone(o);i._id=r,i.max=t;var s=structuredClone(o);return s.min=n,s._id=a,[i,s]}}]),o}(tr.FeatureChange);gl.SplitExonChange=Sl;var El={};Object.defineProperty(El,"__esModule",{value:!0}),El.StrandChange=void 0;var kl=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","StrandChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStrand:a.oldStrand,newStrand:a.newStrand}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return f=(d=l.value).featureId,p=d.oldStrand,e.next=11,n.findOne({allIds:f}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,f)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.strand===p){e.next=27;break}throw y="*** ERROR: Feature's current strand \"".concat(h.strand,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=ve(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=ue(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).strand=w[1].newStrand,E._id.equals(S._id)?E.markModified("strand"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=ue(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setStrand(this.changes[o].newStrand);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:fe(this.changedIds).reverse(),typeName:r,changes:fe(t).reverse().map((function(e){return{featureId:e.featureId,oldStrand:e.newStrand,newStrand:e.oldStrand}})),assembly:e},{logger:n})}}]),o}(tr.FeatureChange);El.StrandChange=kl;var Cl={};Object.defineProperty(Cl,"__esModule",{value:!0}),Cl.TypeChange=void 0;var Al=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","TypeChange"),Q(se(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return X(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=ue(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldType:a.oldType,newType:a.newType}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return f=(d=l.value).featureId,p=d.oldType,e.next=11,n.findOne({allIds:f}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,f)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.type===p){e.next=27;break}throw y="*** ERROR: Feature's current type \"".concat(h.type,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=ve(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=ue(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).type=w[1].newType,E._id.equals(S._id)?E.markModified("type"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){var n,r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=ue(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setType(this.changes[o].newType);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:fe(this.changedIds).reverse(),typeName:r,changes:fe(t).reverse().map((function(e){return{featureId:e.featureId,oldType:e.newType,newType:e.oldType}})),assembly:e},{logger:n})}}]),o}(tr.FeatureChange);Cl.TypeChange=Al;var Ol={};Object.defineProperty(Ol,"__esModule",{value:!0}),Ol.UserChange=void 0;var Tl=function(e){ee(o,e);var t,n,r,a=le(o);function o(e,t){var n;return K(this,o),Q(se(n=a.call(this,e,t)),"typeName","UserChange"),Q(se(n),"changes",void 0),Q(se(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return X(o,[{key:"toJSON",value:function(){var e=this.changes,t=this.typeName,n=this.userId;return 1===e.length?{typeName:t,userId:n,role:ue(e,1)[0].role}:{typeName:t,userId:n,changes:e}}},{key:"executeOnServer",value:(r=Y(V().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.session,r=t.userModel,o=this.logger,i=this.userId,s=ve(a=this.changes),e.prev=3,s.s();case 5:if((l=s.n()).done){e.next=18;break}return u=l.value,null===(c=o.debug)||void 0===c||c.call(o,"change: ".concat(JSON.stringify(a))),d=u.role,e.next=11,r.findByIdAndUpdate(i,{role:d}).session(n).exec();case 11:if(e.sent){e.next=16;break}throw f='*** ERROR: User with id "'.concat(i,'" not found'),o.error(f),new Error(f);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),s.e(e.t0);case 23:return e.prev=23,s.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,userId:this.userId},{logger:this.logger})}}]),o}(tr.Change);Ol.UserChange=Tl,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.changes=void 0;var t=Ze;e.changes={AddAssemblyAndFeaturesFromFileChange:Er.AddAssemblyAndFeaturesFromFileChange,AddAssemblyFromFileChange:_s.AddAssemblyFromFileChange,AddAssemblyFromExternalChange:qr.AddAssemblyFromExternalChange,AddFeatureChange:Ss.AddFeatureChange,AddFeaturesFromFileChange:Ns.AddFeaturesFromFileChange,DeleteAssemblyChange:Ms.DeleteAssemblyChange,DeleteFeatureChange:Es.DeleteFeatureChange,DeleteUserChange:Ls.DeleteUserChange,FeatureAttributeChange:Bs.FeatureAttributeChange,ImportJBrowseConfigChange:zs.ImportJBrowseConfigChange,LocationEndChange:Ws.LocationEndChange,LocationStartChange:Ys.LocationStartChange,MergeExonsChange:Zs.MergeExonsChange,SplitExonChange:gl.SplitExonChange,MergeTranscriptsChange:il.MergeTranscriptsChange,UndoMergeExonsChange:Qs.UndoMergeExonsChange,UndoSplitExonChange:yl.UndoSplitExonChange,UndoMergeTranscriptsChange:sl.UndoMergeTranscriptsChange,StrandChange:El.StrandChange,TypeChange:Cl.TypeChange,UserChange:Ol.UserChange,AddRefSeqAliasesChange:Rs.AddRefSeqAliasesChange,AddAssemblyAliasesChange:er.AddAssemblyAliasesChange},t.__exportStar(Er,e),t.__exportStar(_s,e),t.__exportStar(qr,e),t.__exportStar(Ss,e),t.__exportStar(Ns,e),t.__exportStar(Ms,e),t.__exportStar(Es,e),t.__exportStar(Ls,e),t.__exportStar(Bs,e),t.__exportStar(zs,e),t.__exportStar(Ws,e),t.__exportStar(Ys,e),t.__exportStar(Zs,e),t.__exportStar(gl,e),t.__exportStar(il,e),t.__exportStar(Qs,e),t.__exportStar(yl,e),t.__exportStar(sl,e),t.__exportStar(El,e),t.__exportStar(Cl,e),t.__exportStar(Ol,e),t.__exportStar(Rs,e),t.__exportStar(er,e)}(Qn);var Nl={},Il={};Object.defineProperty(Il,"__esModule",{value:!0}),Il.GetAssembliesOperation=void 0;var Rl=function(e){ee(r,e);var t,n=le(r);function r(){var e;K(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return Q(se(e=n.call.apply(n,[this].concat(a))),"typeName","GetAssembliesOperation"),e}return X(r,[{key:"toJSON",value:function(){return{typeName:this.typeName}}},{key:"executeOnServer",value:function(e){return e.assemblyModel.find({status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(tr.Operation);Il.GetAssembliesOperation=Rl;var Fl={};Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.GetFeaturesOperation=void 0;var Pl=function(e){ee(r,e);var t,n=le(r);function r(e,t){var a;return K(this,r),Q(se(a=n.call(this,e,t)),"typeName","GetFeaturesOperation"),Q(se(a),"refSeq",void 0),Q(se(a),"start",void 0),Q(se(a),"end",void 0),a.refSeq=e.refSeq,a.start=e.start,a.end=e.end,a}return X(r,[{key:"toJSON",value:function(){return{typeName:this.typeName,refSeq:this.refSeq,start:this.start,end:this.end}}},{key:"executeOnServer",value:function(e){return e.featureModel.find({refSeq:this.refSeq,min:{$lte:this.end},max:{$gte:this.start},status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(tr.Operation);Fl.GetFeaturesOperation=Pl,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.operations=void 0;var t=Ze;e.operations={GetAssembliesOperation:Il.GetAssembliesOperation,GetFeaturesOperation:Fl.GetFeaturesOperation},t.__exportStar(Il,e),t.__exportStar(Fl,e)}(Nl);var Ml={},Dl={};Object.defineProperty(Dl,"__esModule",{value:!0}),Dl.Validation=void 0,Dl.isContext=function(e){return void 0!==e.context&&void 0!==e.reflector};var jl=function(){function e(){K(this,e)}var t,n,r,a,o;return X(e,[{key:"frontendPreValidate",value:(o=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Y(V().mark((function e(t,n){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Dl.Validation=jl;var Ll={};Object.defineProperty(Ll,"__esModule",{value:!0}),Ll.validationRegistry=Ll.ValidationSet=Ll.ValidationResultSet=void 0;var ql=function(){function e(){K(this,e),Q(this,"results",[]),Q(this,"ok",!0)}return X(e,[{key:"resultsMessages",get:function(){return this.results.map((function(e){var t;return null===(t=e.error)||void 0===t?void 0:t.message})).filter(Boolean).join(", ")}},{key:"add",value:function(e){this.results.push(e),e.error&&(this.ok=!1)}}]),e}();Ll.ValidationResultSet=ql;var Bl=function(){function e(){K(this,e),Q(this,"validations",new Set)}var t,n,r,a,o;return X(e,[{key:"registerValidation",value:function(e){this.validations.add(e)}},{key:"frontendPreValidate",value:(o=Y(V().mark((function e(t){var n,r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new ql,r=ve(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.frontendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Y(V().mark((function e(t,n){var r,a,o,i,s;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new ql,a=ve(this.validations),e.prev=2,a.s();case 4:if((o=a.n()).done){e.next=14;break}return i=o.value,e.next=8,i.frontendPostValidate(t,n);case 8:if(r.add(s=e.sent),!s.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Y(V().mark((function e(t){var n,r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new ql,r=ve(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.backendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=new ql,i=ve(this.validations),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=15;break}return l=s.value,e.next=9,l.backendPostValidate(t,{featureModel:r,session:a});case 9:if(o.add(c=e.sent),!c.error){e.next=13;break}return e.abrupt("break",15);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Y(V().mark((function e(t){var n,r,a,o;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ve(this.validations),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=7,a.possibleValues(t);case 7:if(!(o=e.sent)){e.next=10;break}return e.abrupt("return",o);case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return");case 21:case"end":return e.stop()}}),e,this,[[1,14,17,20]])}))),function(e){return t.apply(this,arguments)})}]),e}();Ll.ValidationSet=Bl,Ll.validationRegistry=new Bl;var Ul={},zl={};Object.defineProperty(zl,"__esModule",{value:!0}),zl.default=["2A_self_cleaving_peptide_region","4_methylcytosine","5S_SINE_retrotransposon","5_carboxylcytosine","5_formylcytosine","5_hydroxymethylcytosine","5_methylcytosine","7SL_SINE_retrotransposon","8_oxoadenine","8_oxoguanine","AACCCT_box","AFLP_fragment","AP_1_binding_site","ARIA","ARRET","ARS","ARS_consensus_sequence","ASPE_primer","AUG_initiated_uORF","AU_rich_element","A_box","A_box_type_1","A_box_type_2","A_minor_RNA_motif","A_to_C_transversion","A_to_G_transition","A_to_T_transversion","Ace2_UAS","Alu_deletion","Alu_insertion","BAC","BAC_cloned_genomic_insert","BAC_end","BAC_read_contig","BREd_motif","BREu_motif","B_box","Bel_Pao_LTR_retrotransposon","Bruno_response_element","C-D_H_ACA_box_scaRNA","C-D_H_ACA_box_scaRNA_gene","CAAT_signal","CAAX_box","CACTA_TIR_transposon","CAGE_cluster","CAGE_tag","CArG_box","CCAAT_motif","CCA_tail","CDRE_motif","CDS","CDS_extension","CDS_five_prime_extension","CDS_fragment","CDS_independently_known","CDS_predicted","CDS_region","CDS_supported_by_EST_or_cDNA_data","CDS_supported_by_domain_match_data","CDS_supported_by_peptide_spectrum_match","CDS_supported_by_sequence_similarity_data","CDS_three_prime_extension","CRE","CRISPR","CSL_response_element","CTCF_binding_site","CTG_start_codon","C_D_box_scaRNA","C_D_box_scaRNA_gene","C_D_box_snoRNA","C_D_box_snoRNA_gene","C_D_box_snoRNA_primary_transcript","C_box","C_cluster","C_gene_segment","C_region","C_to_A_transversion","C_to_G_transversion","C_to_T_transition","C_to_T_transition_at_pCpG_site","ChIP_seq_region","Copia_LTR_retrotransposon","CpG_island","Crick_strand","Crypton_YR_transposon","CsrB_RsmB_RNA","CuRE","DArT_marker","DCE","DCE_SI","DCE_SII","DCE_SIII","DDB_box","DHU_loop","DIRS_YR_retrotransposon","DJ_C_cluster","DJ_J_C_cluster","DJ_J_cluster","DJ_gene_segment","DMv1_motif","DMv2_motif","DMv3_motif","DMv4_motif","DMv5_motif","DNA_aptamer","DNA_binding_site","DNA_chromosome","DNA_constraint_sequence","DNA_loop","DNA_loop_anchor","DNA_motif","DNA_sequence_secondary_structure","DNA_transposon","DNAzyme","DNaseI_hypersensitive_site","DPE1_motif","DPE_motif","DRE","DRE_motif","DSR_motif","D_DJ_C_cluster","D_DJ_J_C_cluster","D_DJ_J_cluster","D_DJ_cluster","D_J_C_cluster","D_J_cluster","D_cluster","D_gene_recombination_feature","D_gene_segment","D_loop","DsrA_RNA","ER_retention_signal","EST","EST_match","E_box_motif","Endogenous_Retrovirus_LTR_retrotransposon","FLEX_element","FRE","FRT_site","GAGA_motif","GATA_box","GC_rich_promoter_region","GNA_oligo","GTT_trinucleotide_repeat","GT_dinucleotide_repeat","G_box","G_quartet","G_to_A_transition","G_to_C_transversion","G_to_T_transversion","GcvB_RNA","Gypsy_LTR_retrotransposon","H2AK5_acetylation_site","H2AK9_acetylation_site","H2AZK11_acetylation_site","H2AZK13_acetylation_site","H2AZK15_acetylation_site","H2AZK4_acetylation_site","H2AZK7_acetylation_site","H2BK120_acetylation_site","H2BK12_acetylation_site","H2BK15_acetylation_site","H2BK20_acetylation_site","H2BK5_acetylation_site","H2BK5_monomethylation_site","H2B_ubiquitination_site","H3K14_acetylation_site","H3K18_acetylation_site","H3K20_trimethylation_site","H3K23_acetylation_site","H3K23_dimethylation_site","H3K27_acetylation_site","H3K27_dimethylation_site","H3K27_methylation_site","H3K27_monomethylation_site","H3K27_trimethylation_site","H3K36_acetylation_site","H3K36_dimethylation_site","H3K36_methylation_site","H3K36_monomethylation_site","H3K36_trimethylation_site","H3K4_acetylation_site","H3K4_dimethylation_site","H3K4_methylation_site","H3K4_monomethylation_site","H3K4_trimethylation","H3K56_acetylation_site","H3K79_dimethylation_site","H3K79_methylation_site","H3K79_monomethylation_site","H3K79_trimethylation_site","H3K9_acetylation_site","H3K9_dimethylation_site","H3K9_methylation_site","H3K9_monomethylation_site","H3K9_trimethylation_site","H3R2_dimethylation_site","H3R2_monomethylation_site","H4K12_acetylation_site","H4K16_acetylation_site","H4K20_monomethylation_site","H4K4_trimethylation_site","H4K5_acetylation_site","H4K8_acetylation_site","H4K91_acetylation_site","H4K_acylation_region","H4R3_dimethylation_site","HERV_deletion","HERV_insertion","HSE","H_ACA_box_scaRNA","H_ACA_box_scaRNA_gene","H_ACA_box_snoRNA","H_ACA_box_snoRNA_gene","H_ACA_box_snoRNA_primary_transcript","H_pseudoknot","Hoogsteen_base_pair","I-box","IG_C_gene","IG_C_pseudogene","IG_D_gene","IG_J_gene","IG_J_pseudogene","IG_V_gene","IG_V_pseudogene","INR1_motif","INR_motif","IRLinv_site","IRRinv_site","ISRE","I_LINE_retrotransposon","J_C_cluster","J_cluster","J_gene_recombination_feature","J_gene_segment","J_heptamer","J_nonamer","J_spacer","Jockey_LINE_retrotransposon","KEN_box","K_turn_RNA_motif","L1_LINE_retrotransposon","LARD","LINE1_deletion","LINE1_insertion","LINE_element","LNA_oligo","LOZ1_response_element","LTR_component","LTR_retrotransposon","L_box","MCB","MITE","MNP","MNV","MNV_artifact","MTE","Mat2P","Mat3M","Merlin_TIR_transposon","MicF_RNA","Mutator_TIR_transposon","N2_2_prime_O_dimethylguanosine","N2_7_2prirme_O_trimethylguanosine","N2_7_dimethylguanosine","N2_N2_2_prime_O_trimethylguanosine","N2_N2_7_trimethylguanosine","N2_N2_dimethylguanosine","N2_methylguanosine","N4_2_prime_O_dimethylcytidine","N4_N4_2_prime_O_trimethylcytidine","N4_acetyl_2_prime_O_methylcytidine","N4_acetylcytidine","N4_methylcytidine","N6_2_prime_O_dimethyladenosine","N6_N6_2_prime_O_trimethyladenosine","N6_N6_dimethyladenosine","N6_acetyladenosine","N6_cis_hydroxyisopentenyl_adenosine","N6_glycinylcarbamoyladenosine","N6_hydroxynorvalylcarbamoyladenosine","N6_isopentenyladenosine","N6_methyl_N6_threonylcarbamoyladenosine","N6_methyladenine","N6_methyladenosine","N6_threonylcarbamoyladenosine","NDM2_motif","NDM3_motif","NMD_polymorphic_pseudogene_transcript","NMD_transcript","NSD_transcript","N_region","Ngaro_YR_retrotransposon","ORF","Okazaki_fragment","OxyS_RNA","PAC","PAC_end","PCB","PCR_product","PIF_Harbinger_TIR_transposon","PIP_box","PNA_oligo","PSE_motif","P_TIR_transposon","Penelope_retrotransposon","Phage_RNA_Polymerase_Promoter","Pho7_binding_site","QTL","R2_LINE_retrotransposon","RAPD","RFLP_fragment","RH_map","RNA_6S","RNA_7SK","RNA_7SK_gene","RNA_aptamer","RNA_chromosome","RNA_hook_turn","RNA_internal_loop","RNA_junction_loop","RNA_motif","RNA_polymerase_III_TATA_box","RNA_polymerase_II_TATA_box","RNA_sequence_secondary_structure","RNA_stability_element","RNA_thermometer","RNAi_reagent","RNApol_III_promoter","RNApol_III_promoter_type_1","RNApol_III_promoter_type_2","RNApol_III_promoter_type_3","RNApol_II_core_promoter","RNApol_II_promoter","RNApol_I_promoter","RNase_MRP_RNA","RNase_MRP_RNA_gene","RNase_P_RNA","RNase_P_RNA_gene","RRE_RNA","RR_tract","RST","RST_match","RTE_LINE_retrotransposon","R_GNA_oligo","R_LTR_region","R_five_prime_LTR_region","R_three_prime_LTR_region","Retrovirus_LTR_retrotransposon","Robertsonian_fusion","RprA_RNA","SAGE_tag","SECIS_element","SHP_box","SINE_element","SL10_acceptor_site","SL11_acceptor_site","SL12_acceptor_site","SL1_acceptor_site","SL2_acceptor_site","SL3_acceptor_site","SL4_acceptor_site","SL5_acceptor_site","SL6_acceptor_site","SL7_acceptor_site","SL8_acceptor_site","SL9_acceptor_site","SNP","SNV","SNV_artifact","SP6_RNA_Polymerase_Promoter","SRP_RNA","SRP_RNA_gene","SRP_RNA_primary_transcript","STREP_motif","STS","STS_map","SUMO_interaction_motif","SVA_deletion","SVA_insertion","S_GNA_oligo","S_region","Sap1_recognition_motif","Shine_Dalgarno_sequence","T3_RNA_Polymerase_Promoter","T7_RNA_Polymerase_Promoter","TATA_box","TCS_element","TCT_motif","TERRA","TFRS_collection","TFRS_module","TF_binding_site","TNA_oligo","TRIM","TR_C_Gene","TR_D_Gene","TR_J_Gene","TR_J_pseudogene","TR_V_Gene","TR_V_pseudogene","TR_box","TSS","T_cell_receptor_gene","T_cell_receptor_pseudogene","T_loop","T_to_A_transversion","T_to_C_transition","T_to_G_transversion","Tc1_Mariner_TIR_transposon","Transib_TIR_transposon","U11_snRNA","U12_intron","U12_snRNA","U14_snoRNA","U14_snoRNA_gene","U14_snoRNA_primary_transcript","U1_snRNA","U2_intron","U2_snRNA","U3_LTR_region","U3_five_prime_LTR_region","U3_snoRNA","U3_snoRNA_gene","U3_three_prime_LTR_region","U4_snRNA","U4atac_snRNA","U5_LTR_region","U5_five_prime_LTR_region","U5_snRNA","U5_three_prime_LTR_region","U6_snRNA","U6atac_snRNA","U7_snRNA","UAA_stop_codon_signal","UAG_stop_codon_signal","UGA_stop_codon_signal","UNAAAC_motif","UPD","UST","UST_match","UTR","UTR_intron","UTR_region","U_box","VDJ_C_cluster","VDJ_J_C_cluster","VDJ_J_cluster","VDJ_gene_segment","VD_gene_segment","VJ_C_cluster","VJ_J_C_cluster","VJ_J_cluster","VJ_gene_segment","V_DJ_C_cluster","V_DJ_J_C_cluster","V_DJ_J_cluster","V_DJ_cluster","V_D_DJ_C_cluster","V_D_DJ_J_C_cluster","V_D_DJ_J_cluster","V_D_DJ_cluster","V_D_J_C_cluster","V_D_J_cluster","V_J_C_cluster","V_J_cluster","V_VDJ_C_cluster","V_VDJ_J_C_cluster","V_VDJ_J_cluster","V_VDJ_cluster","V_VJ_C_cluster","V_VJ_J_C_cluster","V_VJ_J_cluster","V_VJ_cluster","V_cluster","V_gene_recombination_feature","V_gene_segment","V_heptamer","V_nonamer","V_region","V_spacer","Viper_YR_retrotransposon","WC_base_pair","W_region","Watson_strand","X_element","X_element_combinatorial_repeat","X_region","YAC","YAC_end","YR_retrotransposon","Y_RNA","Y_RNA_gene","Y_RNA_primary_transcript","Y_prime_element","Y_region","Z1_region","Z2_region","Zas1_recognition_motif","aberrant_processed_transcript","accessible_DNA_region","active_peptide","adaptive_island","alanine","alanine_tRNA_primary_transcript","alanyl_tRNA","allelic_pseudogene","allelic_pseudogenic_rRNA","allelic_pseudogenic_tRNA","allelically_excluded_gene","alpha_beta_motif","alpha_helix","alternate_sequence_site","alternatively_spliced_transcript","amber_stop_codon","ambisense_ssRNA_viral_sequence","amino_acid","amplification_origin","anchor_binding_site","anchor_region","androgen_response_element","anti_ARRET","anticodon","anticodon_loop","antiparallel_beta_strand","antisense_RNA","antisense_lncRNA","antisense_lncRNA_gene","antisense_primary_transcript","apicoplast_chromosome","apicoplast_gene","aptamer","archaeal_intron","archaeosine","arginine","arginine_tRNA_primary_transcript","arginyl_tRNA","asparagine","asparagine_tRNA_primary_transcript","asparaginyl_tRNA","aspartic_acid","aspartic_acid_tRNA_primary_transcript","aspartyl_tRNA","assembly","assembly_component","assembly_error_correction","asx_motif","asx_turn","asx_turn_left_handed_type_one","asx_turn_left_handed_type_two","asx_turn_right_handed_type_one","asx_turn_right_handed_type_two","asymmetric_RNA_internal_loop","attB_site","attC_site","attCtn_site","attI_site","attL_site","attP_site","attR_site","attenuator","autocatalytically_spliced_intron","bacterial_RNApol_promoter","bacterial_RNApol_promoter_sigma54_element","bacterial_RNApol_promoter_sigma_70_element","bacterial_RNApol_promoter_sigma_ecf_element","bacterial_terminator","base","base_call_error_correction","base_pair","beta_bulge","beta_bulge_loop","beta_bulge_loop_five","beta_bulge_loop_six","beta_strand","beta_turn","beta_turn_left_handed_type_one","beta_turn_left_handed_type_two","beta_turn_right_handed_type_one","beta_turn_right_handed_type_two","beta_turn_type_eight","beta_turn_type_six","beta_turn_type_six_a","beta_turn_type_six_a_one","beta_turn_type_six_a_two","beta_turn_type_six_b","bidirectional_promoter","bidirectional_promoter_lncRNA","binding_site","biochemical_region_of_peptide","biological_region","biomaterial_region","biosynthetic_gene_cluster","blocked_reading_frame","blunt_end_restriction_enzyme_cleavage_junction","blunt_end_restriction_enzyme_cleavage_site","boundary_element","branch_site","cDNA_clone","cDNA_match","c_terminal_region","candidate_gene","canonical_five_prime_splice_site","canonical_three_prime_splice_site","cap","capped_mRNA","capped_primary_transcript","cassette_pseudogene","catalytic_residue","catmat_left_handed_four","catmat_left_handed_three","catmat_right_handed_four","catmat_right_handed_three","central_hydrophobic_region_of_signal_peptide","centromere","centromere_DNA_Element_I","centromere_DNA_Element_II","centromere_DNA_Element_III","centromeric_repeat","chimeric_cDNA_clone","chloroplast_DNA_read","chloroplast_chromosome","chromatin_regulatory_region","chromoplast_chromosome","chromoplast_gene","chromosomal_regulatory_element","chromosomal_structural_element","chromosomal_translocation","chromosome","chromosome_arm","chromosome_band","chromosome_breakage_sequence","chromosome_breakpoint","chromosome_part","circular_double_stranded_DNA_chromosome","circular_double_stranded_RNA_chromosome","circular_mRNA","circular_ncRNA","circular_plasmid","circular_single_stranded_DNA_chromosome","circular_single_stranded_RNA_chromosome","cis_acting_homologous_chromosome_pairing_region","cis_regulatory_frameshift_element","cis_regulatory_module","cis_splice_site","class_II_RNA","class_I_RNA","cleaved_for_gpi_anchor_region","cleaved_initiator_methionine","cleaved_peptide_region","clip","clone","clone_end","clone_insert","clone_insert_end","clone_insert_start","cloned_cDNA_insert","cloned_genomic_insert","cloned_region","coding_conserved_region","coding_end","coding_exon","coding_region_of_exon","coding_start","coding_transcript_with_retained_intron","codon","coiled_coil","cointegrated_plasmid","common_fragile_site","complex_chromosomal_rearrangement","complex_operon","complex_regulon","complex_structural_alteration","complex_substitution","compositionally_biased_region_of_peptide","conformational_switch","conjugative_transposon","consensus_AFLP_fragment","consensus_gDNA","consensus_mRNA","consensus_region","conserved_region","constitutive_promoter","contig","contig_collection","contig_read","copy_number_gain","copy_number_loss","copy_number_variation","core_eukaryotic_promoter_element","core_prokaryotic_promoter_element","core_promoter_element","core_viral_promoter_element","cosmid","cross_genome_match","cryptic_gene","cryptic_promoter","cryptic_prophage","cryptic_splice_site","cryptogene","ct_gene","cyanelle_chromosome","cyanelle_gene","cyclic_translocation","cysteine","cysteine_tRNA_primary_transcript","cysteinyl_tRNA","cytoplasmic_polypeptide_region","cytosolic_16S_rRNA","cytosolic_18S_rRNA","cytosolic_23S_rRNA","cytosolic_25S_rRNA","cytosolic_28S_rRNA","cytosolic_2S_rRNA","cytosolic_5S_rRNA","cytosolic_5_8S_rRNA","cytosolic_LSU_rRNA","cytosolic_LSU_rRNA_gene","cytosolic_SSU_rRNA","cytosolic_SSU_rRNA_gene","cytosolic_rRNA","cytosolic_rRNA_16S_gene","cytosolic_rRNA_18S_gene","cytosolic_rRNA_23S_gene","cytosolic_rRNA_25S_gene","cytosolic_rRNA_28S_gene","cytosolic_rRNA_2S_gene","cytosolic_rRNA_5S_gene","cytosolic_rRNA_5_8S_gene","cytosolic_rRNA_gene","dCAPS_primer","databank_entry","decayed_exon","defective_conjugative_transposon","deficient_translocation","deletion","deletion_artifact","deletion_breakpoint","deletion_junction","delins","destruction_box","dg_repeat","dh_repeat","dicistronic_mRNA","dicistronic_primary_transcript","dicistronic_transcript","dif_site","dihydrouridine","dinucleotide_repeat_microsatellite_feature","direct_repeat","direct_tandem_duplication","disabled_reading_frame","dispersed_repeat","distal_duplication","distal_promoter_element","distant_three_prime_recoding_signal","double_stranded_DNA_chromosome","double_stranded_RNA_chromosome","ds_DNA_viral_sequence","ds_RNA_viral_sequence","ds_oligo","duplicated_pseudogene","duplication","duplication_artifact","dye_terminator_read","early_origin_of_replication","edited_CDS","edited_mRNA","edited_transcript","edited_transcript_by_A_to_I_substitution","edited_transcript_feature","editing_block","editing_domain","endogenous_retroviral_gene","endonuclease_spliced_intron","endosomal_localization_signal","engineered_episome","engineered_foreign_gene","engineered_foreign_region","engineered_foreign_repetitive_element","engineered_foreign_transposable_element","engineered_foreign_transposable_element_gene","engineered_fusion_gene","engineered_gene","engineered_insert","engineered_plasmid","engineered_region","engineered_rescue_region","engineered_tag","engineered_transposable_element","enhancer","enhancerRNA","enhancer_binding_site","enhancer_blocking_element","enhancer_bound_by_factor","enhancer_trap_construct","enzymatic_RNA","enzymatic_RNA_gene","epigenetically_modified_gene","epigenetically_modified_region","epigenomically_modified_region","episome","epitope","epoxyqueuosine","eukaryotic_promoter","eukaryotic_terminator","exemplar_mRNA","exon","exon_junction","exon_of_single_exon_gene","exon_region","exonic_splice_enhancer","exonic_splicing_silencer","experimental_feature","experimental_result_region","experimentally_defined_binding_region","expressed_sequence_assembly","expressed_sequence_match","extended_cis_splice_site","extended_intronic_splice_region","external_transcribed_spacer_region","extrachromosomal_mobile_genetic_element","extramembrane_polypeptide_region","fingerprint_map","five_aminomethyl_two_thiouridine","five_carbamoylmethyl_two_prime_O_methyluridine","five_carbamoylmethyluridine","five_carboxyhydroxymethyl_uridine","five_carboxyhydroxymethyl_uridine_methyl_ester","five_carboxymethylaminomethyl_two_prime_O_methyluridine","five_carboxymethylaminomethyl_two_thiouridine","five_carboxymethylaminomethyluridine","five_carboxymethyluridine","five_formyl_two_prime_O_methylcytidine","five_formylcytidine","five_hydroxymethylcytidine","five_hydroxyuridine","five_isopentenylaminomethyl_two_prime_O_methyluridine","five_isopentenylaminomethyl_two_thiouridine","five_isopentenylaminomethyl_uridine","five_methoxycarbonylmethyl_two_prime_O_methyluridine","five_methoxycarbonylmethyl_two_thiouridine","five_methoxycarbonylmethyluridine","five_methoxyuridine","five_methyl_2_thiouridine","five_methylaminomethyl_two_selenouridine","five_methylaminomethyl_two_thiouridine","five_methylaminomethyluridine","five_methylcytidine","five_methyldihydrouridine","five_methyluridine","five_prime_D_heptamer","five_prime_D_nonamer","five_prime_D_recombination_signal_sequence","five_prime_D_spacer","five_prime_EST","five_prime_LTR","five_prime_LTR_component","five_prime_RST","five_prime_UST","five_prime_UTR","five_prime_UTR_intron","five_prime_cis_splice_site","five_prime_clip","five_prime_coding_exon","five_prime_coding_exon_coding_region","five_prime_coding_exon_noncoding_region","five_prime_flanking_region","five_prime_intron","five_prime_noncoding_exon","five_prime_open_reading_frame","five_prime_recoding_site","five_prime_restriction_enzyme_junction","five_prime_sticky_end_restriction_enzyme_cleavage_site","five_prime_terminal_inverted_repeat","five_taurinomethyl_two_thiouridine","five_taurinomethyluridine","five_two_prime_O_dimethylcytidine","five_two_prime_O_dimethyluridine","flanking_region","flanking_repeat","flanking_three_prime_quadruplet_recoding_signal","floxed_gene","foldback_element","foreign_gene","foreign_transposable_element","forkhead_motif","forward_primer","fosmid","four_bp_start_codon","four_demethylwyosine","four_thiouridine","fragile_site","fragment_assembly","functional_candidate_gene","functional_gene_region","fusion_gene","gRNA_gene","galactosyl_queuosine","gamma_turn","gamma_turn_classic","gamma_turn_inverse","gap","gene","gene_array","gene_cassette","gene_cassette_array","gene_component_region","gene_fragment","gene_group","gene_member_region","gene_rearranged_at_DNA_level","gene_segment","gene_silenced_by_DNA_methylation","gene_silenced_by_DNA_modification","gene_silenced_by_RNA_interference","gene_silenced_by_histone_deacetylation","gene_silenced_by_histone_methylation","gene_silenced_by_histone_modification","gene_subarray","gene_trap_construct","gene_with_dicistronic_mRNA","gene_with_dicistronic_primary_transcript","gene_with_dicistronic_transcript","gene_with_edited_transcript","gene_with_mRNA_recoded_by_translational_bypass","gene_with_mRNA_with_frameshift","gene_with_non_canonical_start_codon","gene_with_polyadenylated_mRNA","gene_with_polycistronic_transcript","gene_with_recoded_mRNA","gene_with_start_codon_CUG","gene_with_stop_codon_read_through","gene_with_stop_codon_redefined_as_pyrrolysine","gene_with_stop_codon_redefined_as_selenocysteine","gene_with_trans_spliced_transcript","gene_with_transcript_with_translational_frameshift","genetic_marker","genomic_DNA_contig","genomic_DNA_read","genomic_clone","genomic_island","genomically_contaminated_cDNA_clone","glutamic_acid","glutamic_acid_tRNA_primary_transcript","glutamine","glutamine_tRNA_primary_transcript","glutaminyl_tRNA","glutamyl_tRNA","glycine","glycine_tRNA_primary_transcript","glycyl_tRNA","golden_path","golden_path_fragment","group_1_intron_homing_endonuclease_target_region","group_IIA_intron","group_IIB_intron","group_IIC_intron","group_III_intron","group_II_intron","group_I_intron","guide_RNA","guide_RNA_region","hAT_TIR_transposon","hammerhead_ribozyme","haplotype_block","helitron","helix_turn_helix","heptamer_of_recombination_feature_of_vertebrate_immune_system_gene","heritable_phenotypic_marker","high_identity_region","histidine","histidine_tRNA_primary_transcript","histidyl_tRNA","histone_2AZ_acetylation_site","histone_2A_acetylation_site","histone_2B_acetylation_site","histone_3_acetylation_site","histone_4_acetylation_site","histone_acetylation_site","histone_acylation_region","histone_binding_site","histone_methylation_site","histone_modification","histone_ubiqitination_site","homing_endonuclease_binding_site","homol_D_box","homol_E_box","homologous_chromosome_recognition_and_pairing_locus","homologous_region","hpRNA","hpRNA_gene","hydrophobic_region_of_peptide","hydroxywybutosine","iDNA","i_motif","immature_peptide_region","immunoglobulin_gene","immunoglobulin_pseudogene","immunoglobulin_region","imprinting_control_region","indel_artifact","inducible_promoter","inert_DNA_spacer","inosine","insertion","insertion_artifact","insertion_breakpoint","insertion_sequence","insertion_site","insulator","insulator_binding_site","integrated_mobile_genetic_element","integrated_plasmid","integration_excision_site","integron","intein","intein_encoding_region","interband","interchromosomal_breakpoint","interchromosomal_translocation","intergenic_region","interior_coding_exon","interior_exon","interior_intron","intermediate_element","internal_Shine_Dalgarno_sequence","internal_UTR","internal_eliminated_sequence","internal_guide_sequence","internal_ribosome_entry_site","internal_transcribed_spacer_region","intrachromosomal_breakpoint","intrachromosomal_translocation","intramembrane_polypeptide_region","intrinsically_unstructured_polypeptide_region","introgressed_chromosome_region","intron","intron_base_5","intron_domain","intronic_regulatory_region","intronic_splice_enhancer","intronic_splicing_silencer","invalidated_cDNA_clone","inversion","inversion_breakpoint","inversion_cum_translocation","inversion_site","inversion_site_part","inverted_intrachromosomal_transposition","inverted_repeat","inverted_tandem_duplication","iron_repressed_GATA_element","iron_responsive_element","isoleucine","isoleucine_tRNA_primary_transcript","isoleucyl_tRNA","isomiR","isowyosine","junction","kinetoplast_gene","knob","kozak_sequence","lambda_vector","lariat_intron","late_origin_of_replication","left_handed_peptide_helix","leucine","leucine_tRNA_primary_transcript","leucoplast_chromosome","leucoplast_gene","leucyl_tRNA","ligand_binding_site","ligation_based_read","lincRNA","lincRNA_gene","linear_double_stranded_DNA_chromosome","linear_double_stranded_RNA_chromosome","linear_plasmid","linear_single_stranded_DNA_chromosome","linear_single_stranded_RNA_chromosome","linkage_group","lipoprotein_signal_peptide","lncRNA","lncRNA_gene","lncRNA_primary_transcript","lncRNA_with_retained_intron","loR","locus_control_region","long_terminal_repeat","long_terminal_repeat_transcript","loop","low_complexity_region","loxP_site","lysidine","lysine","lysine_tRNA_primary_transcript","lysosomal_localization_signal","lysyl_tRNA","mRNA","mRNA_contig","mRNA_read","mRNA_recoded_by_codon_redefinition","mRNA_recoded_by_translational_bypass","mRNA_region","mRNA_with_frameshift","mRNA_with_minus_1_frameshift","mRNA_with_minus_2_frameshift","mRNA_with_plus_1_frameshift","mRNA_with_plus_2_frameshift","macronuclear_chromosome","macronucleus_destined_segment","major_TSS","mannosyl_queuosine","match","match_part","maternal_uniparental_disomy","maternally_imprinted_gene","mathematically_defined_repeat","mating_type_M_box","mating_type_region","mating_type_region_motif","mating_type_region_replication_fork_barrier","matrix_attachment_site","mature_protein_region","mature_protein_region_of_CDS","mature_transcript","mature_transcript_region","maxicircle","maxicircle_gene","meiotic_recombination_region","membrane_peptide_loop","membrane_structure","metabolic_island","metal_binding_site","methionine","methionine_tRNA_primary_transcript","methionyl_tRNA","methylated_DNA_base_feature","methylated_adenine","methylated_cytosine","methylation_guide_snoRNA","methylation_guide_snoRNA_gene","methylation_guide_snoRNA_primary_transcript","methylinosine","methylwyosine","miRNA","miRNA_antiguide","miRNA_gene","miRNA_loop","miRNA_primary_transcript","miRNA_primary_transcript_region","miRNA_stem","miRNA_target_site","miR_encoding_Y_RNA_primary_transcript","miR_encoding_lncRNA_primary_transcript","miR_encoding_shRNA_primary_transcript","miR_encoding_snoRNA_primary_transcript","miR_encoding_tRNA_primary_transcript","miR_encoding_vaultRNA_primary_transcript","miRtron","microarray_oligo","micronuclear_chromosome","microsatellite","mini_exon_donor_RNA","mini_gene","minicircle","minicircle_gene","minisatellite","minor_TSS","minus_10_signal","minus_12_signal","minus_1_translational_frameshift","minus_24_signal","minus_2_translational_frameshift","minus_35_signal","mitochondrial_DNA_read","mitochondrial_D_loop","mitochondrial_chromosome","mitochondrial_contig","mitochondrial_control_region","mitochondrial_supercontig","mitochondrial_targeting_signal","mitotic_recombination_region","moR","mobile_element_deletion","mobile_element_insertion","mobile_genetic_element","mobile_intron","modified_DNA_base","modified_L_alanine","modified_L_arginine","modified_L_asparagine","modified_L_aspartic_acid","modified_L_cysteine","modified_L_glutamic_acid","modified_L_glutamine","modified_L_histidine","modified_L_isoleucine","modified_L_leucine","modified_L_lysine","modified_L_methionine","modified_L_phenylalanine","modified_L_proline","modified_L_selenocysteine","modified_L_serine","modified_L_threonine","modified_L_tryptophan","modified_L_tyrosine","modified_L_valine","modified_RNA_base_feature","modified_adenine","modified_adenosine","modified_amino_acid_feature","modified_cytidine","modified_cytosine","modified_glycine","modified_guanine","modified_guanosine","modified_inosine","modified_uridine","molecular_contact_region","monocistronic_mRNA","monocistronic_primary_transcript","monocistronic_transcript","monomeric_repeat","morpholino_oligo","mt_LSU_rRNA","mt_LSU_rRNA_gene","mt_SSU_rRNA","mt_SSU_rRNA_gene","mt_gene","mt_rRNA","mt_rRNA_gene","mt_tRNA","multiplexing_sequence_identifier","mutated_variant_site","mutational_hotspot","n_terminal_region","natural_plasmid","natural_transposable_element","natural_variant_site","ncRNA","ncRNA_gene","nc_conserved_region","nc_primary_transcript","negative_sense_ssRNA_viral_sequence","negatively_autoregulated_gene","nested_repeat","nested_tandem_repeat","nested_transposon","no_output","no_sequence_alteration","non_AUG_initiated_uORF","non_LTR_retrotransposon","non_LTR_retrotransposon_polymeric_tract","non_adjacent_residues","non_allelic_homologous_recombination_region","non_canonical_five_prime_splice_site","non_canonical_start_codon","non_canonical_three_prime_splice_site","non_complimentary_stem","non_cytoplasmic_polypeptide_region","non_processed_pseudogene","non_terminal_residue","non_transcribed_region","nonamer_of_recombination_feature_of_vertebrate_immune_system_gene","noncoding_exon","noncoding_region_of_exon","novel_sequence_insertion","nuclear_chromosome","nuclear_export_signal","nuclear_gene","nuclear_localization_signal","nuclear_mt_pseudogene","nuclear_rim_localization_signal","nuclease_binding_site","nuclease_hypersensitive_site","nuclease_sensitive_site","nucleomorph_gene","nucleomorphic_chromosome","nucleotide_binding_site","nucleotide_cleavage_site","nucleotide_match","nucleotide_motif","nucleotide_to_protein_binding_site","ochre_stop_codon","octamer_motif","oligo","oligo_U_tail","one_methyl_three_three_amino_three_carboxypropyl_pseudouridine","one_methyladenosine","one_methylguanosine","one_methylinosine","one_methylpseudouridine","one_two_prime_O_dimethyladenosine","one_two_prime_O_dimethylguanosine","one_two_prime_O_dimethylinosine","opal_stop_codon","open_chromatin_region","operator","operon","oriC","oriT","oriV","origin_of_replication","orphan_CDS","orthologous_region","outron","overlapping_EST_set","overlapping_feature_set","paired_end_fragment","parallel_beta_strand","paralogous_region","partial_genomic_sequence_assembly","partially_processed_cDNA_clone","paternal_uniparental_disomy","paternally_imprinted_gene","pathogenic_island","peptide_coil","peptide_helix","peptide_localization_signal","peroxywybutosine","phage_sequence","phagemid","phenylalanine","phenylalanine_tRNA_primary_transcript","phenylalanyl_tRNA","pheromone_response_element","phosphorylation_site","piRNA","piRNA_gene","pi_helix","piggyBac_TIR_transposon","plasmid","plasmid_gene","plasmid_vector","plastid_LSU_rRNA","plastid_LSU_rRNA_gene","plastid_SSU_rRNA","plastid_SSU_rRNA_gene","plastid_gene","plastid_rRNA","plastid_rRNA_gene","plus_1_translational_frameshift","plus_2_translational_frameshift","point_centromere","point_mutation","polinton","polyA_primed_cDNA_clone","polyA_sequence","polyA_signal_sequence","polyA_site","polyA_site_cluster","polyadenylated_mRNA","polycistronic_mRNA","polycistronic_primary_transcript","polycistronic_transcript","polymerase_synthesis_read","polymorphic_pseudogene","polymorphic_pseudogene_processed_transcript","polymorphic_pseudogene_with_retained_intron","polypeptide","polypeptide_DNA_contact","polypeptide_binding_motif","polypeptide_calcium_ion_contact_site","polypeptide_catalytic_motif","polypeptide_cobalt_ion_contact_site","polypeptide_conserved_motif","polypeptide_conserved_region","polypeptide_copper_ion_contact_site","polypeptide_domain","polypeptide_iron_ion_contact_site","polypeptide_ligand_contact","polypeptide_magnesium_ion_contact_site","polypeptide_manganese_ion_contact_site","polypeptide_metal_contact","polypeptide_molybdenum_ion_contact_site","polypeptide_motif","polypeptide_nest_left_right_motif","polypeptide_nest_motif","polypeptide_nest_right_left_motif","polypeptide_nickel_ion_contact_site","polypeptide_region","polypeptide_repeat","polypeptide_secondary_structure","polypeptide_sequencing_information","polypeptide_structural_motif","polypeptide_structural_region","polypeptide_tungsten_ion_contact_site","polypeptide_turn_motif","polypeptide_variation_site","polypeptide_zinc_ion_contact_site","polypyrimidine_tract","positional_candidate_gene","positive_sense_ssRNA_viral_sequence","positively_autoregulated_gene","possible_assembly_error","possible_base_call_error","post_translationally_modified_region","post_translationally_regulated_gene","pre_edited_mRNA","pre_edited_region","pre_miRNA","predicted_gene","predicted_transcript","presence_absence_variation","priRNA","primary_transcript","primary_transcript_region","primer","primer_binding_site","primer_match","probe","processed_pseudogene","processed_pseudogenic_rRNA","processed_pseudogenic_tRNA","processed_transcript","prokaryotic_promoter","proline","proline_tRNA_primary_transcript","prolyl_tRNA","promoter","promoter_element","promoter_flanking_region","promoter_targeting_sequence","promoter_trap_construct","propeptide","propeptide_cleavage_site","propeptide_region_of_CDS","prophage","proplastid_gene","protease_site","protein_binding_site","protein_coding_gene","protein_coding_primary_transcript","protein_hmm_match","protein_match","protein_protein_contact","protein_stability_element","proviral_gene","proviral_region","proximal_promoter_element","pseudogene","pseudogene_by_unequal_crossing_over","pseudogene_processed_transcript","pseudogenic_CDS","pseudogenic_exon","pseudogenic_gene_segment","pseudogenic_rRNA","pseudogenic_region","pseudogenic_tRNA","pseudogenic_transcript","pseudogenic_transcript_with_retained_intron","pseudoknot","pseudouridine","pseudouridylation_guide_snoRNA","pseudouridylation_guide_snoRNA_gene","pumilio_response_element","purine_to_pyrimidine_transversion","purine_transition","pyrimidine_to_purine_transversion","pyrimidine_transition","pyrosequenced_read","pyrrolysine","pyrrolysine_tRNA_primary_transcript","pyrrolysyl_tRNA","queuosine","rDNA_intergenic_spacer_element","rDNA_replication_fork_barrier","rRNA","rRNA_21S_gene","rRNA_cleavage_RNA","rRNA_cleavage_snoRNA_primary_transcript","rRNA_gene","rRNA_large_subunit_primary_transcript","rRNA_primary_transcript","rRNA_primary_transcript_region","rRNA_small_subunit_primary_transcript","rare_fragile_site","rasiRNA","read","read_pair","reading_frame","reagent","rearrangement_region","reciprocal_chromosomal_translocation","recoded_codon","recoded_mRNA","recoding_pseudoknot","recoding_stimulatory_region","recombination_enhancer","recombination_feature","recombination_feature_of_rearranged_gene","recombination_hotspot","recombination_regulatory_region","recombination_signal_sequence","recombinationally_inverted_gene","recombinationally_rearranged_gene","recombinationally_rearranged_vertebrate_immune_system_gene","recursive_splice_site","ref_miRNA","region","regional_centromere","regional_centromere_central_core","regional_centromere_inner_repeat_region","regional_centromere_outer_repeat_region","regional_centromere_outer_repeat_transcript","regulatory_promoter_element","regulatory_region","regulon","remark","repeat_component","repeat_fragment","repeat_instability_region","repeat_region","repeat_unit","replication_regulatory_region","replication_start_site","replicon","rescue_gene","rescue_mini_gene","rescue_region","resolution_site","response_element","restriction_enzyme_assembly_scar","restriction_enzyme_binding_site","restriction_enzyme_cleavage_junction","restriction_enzyme_five_prime_single_strand_overhang","restriction_enzyme_recognition_site","restriction_enzyme_region","restriction_enzyme_single_strand_overhang","restriction_enzyme_three_prime_single_strand_overhang","restriction_fragment","retinoic_acid_responsive_element","retrogene","retron","retrotransposon","reverse_Hoogsteen_base_pair","reverse_primer","rho_dependent_bacterial_terminator","rho_independent_bacterial_terminator","ribonuclease_site","ribosome_entry_site","riboswitch","ribothymidine","ribozyme","ribozyme_gene","right_handed_peptide_helix","sORF","sarcin_like_RNA_motif","satellite_DNA","sbRNA","sbRNA_gene","scRNA","scRNA_gene","scRNA_primary_transcript","scaRNA","scaRNA_gene","schellmann_loop","schellmann_loop_seven","schellmann_loop_six","selection_marker","selenocysteine","selenocysteine_tRNA_primary_transcript","selenocysteinyl_tRNA","self_cleaving_ribozyme","sense_intronic_ncRNA","sense_intronic_ncRNA_gene","sense_overlap_ncRNA","sense_overlap_ncRNA_gene","sequence_alteration","sequence_alteration_artifact","sequence_assembly","sequence_comparison","sequence_conflict","sequence_difference","sequence_feature","sequence_length_alteration","sequence_motif","sequence_rearrangement_feature","sequence_secondary_structure","sequence_uncertainty","sequencing_primer","serine","serine_tRNA_primary_transcript","serine_threonine_motif","serine_threonine_staple_motif","serine_threonine_turn","seryl_tRNA","seven_aminomethyl_seven_deazaguanosine","seven_cyano_seven_deazaguanosine","seven_deazaguanosine","seven_methylguanine","seven_methylguanosine","sgRNA","shRNA","shRNA_primary_transcript","shadow_enhancer","short_tandem_repeat_variation","siRNA","signal_anchor","signal_peptide","signal_peptide_region_of_CDS","signature","silenced_gene","silencer","silent_mating_type_cassette_array","simple_operon","simple_regulon","simple_sequence_length_variation","single_strand_restriction_enzyme_cleavage_site","single_stranded_DNA_chromosome","single_stranded_RNA_chromosome","sisRNA","site_specific_recombination_target_region","smFISH_probe","small_regulatory_ncRNA","snRNA","snRNA_gene","snRNA_primary_transcript","sncRNA","sncRNA_gene","snoRNA","snoRNA_gene","snoRNA_primary_transcript","solo_LTR","sonicate_fragment","specific_recombination_site","splice_enhancer","splice_junction","splice_region","splice_site","spliced_leader_RNA","spliceosomal_intron","spliceosomal_intron_region","splicing_regulatory_region","spot_42_RNA","spurious_protein","ss_RNA_viral_sequence","ss_oligo","st_turn_left_handed_type_one","st_turn_left_handed_type_two","st_turn_right_handed_type_one","st_turn_right_handed_type_two","start_codon","stem","stem_loop","stem_loop_region","sterol_regulatory_element","sticky_end_restriction_enzyme_cleavage_site","stop_codon","stop_codon_read_through","stop_codon_redefined_as_pyrrolysine","stop_codon_redefined_as_selenocysteine","stop_codon_signal","structural_alteration","substitution","substitution_artifact","subtelomere","sugar_edge_base_pair","supercontig","symbiosis_island","symmetric_RNA_internal_loop","syntenic_region","synthetic_oligo","tRNA","tRNA_SINE_retrotransposon","tRNA_gene","tRNA_intron","tRNA_primary_transcript","tRNA_region","tag","tandem_duplication","tandem_repeat","target_site_duplication","targeting_vector","tasiRNA","tasiRNA_primary_transcript","teb1_recognition_motif","telomerase_RNA","telomerase_RNA_gene","telomere","telomeric_D_loop","telomeric_repeat","telomeric_transcript","template_region","terminal_inverted_repeat","terminal_inverted_repeat_element","terminal_repeat","terminator","terminator_of_type_2_RNApol_III_promoter","tetraloop","tetranucleotide_repeat_microsatellite_feature","three_methylcytidine","three_methylpseudouridine","three_methyluridine","three_prime_D_heptamer","three_prime_D_nonamer","three_prime_D_recombination_signal_sequence","three_prime_D_spacer","three_prime_EST","three_prime_LTR","three_prime_LTR_component","three_prime_RACE_clone","three_prime_RST","three_prime_UST","three_prime_UTR","three_prime_UTR_intron","three_prime_cis_splice_site","three_prime_clip","three_prime_coding_exon","three_prime_coding_exon_coding_region","three_prime_coding_exon_noncoding_region","three_prime_flanking_region","three_prime_intron","three_prime_noncoding_exon","three_prime_overlapping_ncrna","three_prime_recoding_site","three_prime_repeat_recoding_signal","three_prime_restriction_enzyme_junction","three_prime_stem_loop_structure","three_prime_sticky_end_restriction_enzyme_cleavage_site","three_prime_terminal_inverted_repeat","three_ten_helix","three_three_amino_three_carboxypropyl_uridine","three_two_prime_O_dimethyluridine","threonine","threonine_tRNA_primary_transcript","threonyl_tRNA","tiling_path","tiling_path_clone","tiling_path_fragment","tmRNA","tmRNA_acceptor_piece","tmRNA_coding_piece","tmRNA_gene","tmRNA_primary_transcript","tmRNA_region","tnaORF","topologically_associated_domain","topologically_associated_domain_boundary","topologically_defined_region","trans_splice_acceptor_site","trans_splice_donor_site","trans_splice_junction","trans_splice_site","trans_spliced_mRNA","trans_spliced_transcript","transcribed_cluster","transcribed_fragment","transcribed_processed_pseudogene","transcribed_spacer_region","transcribed_unitary_pseudogene","transcribed_unprocessed_pseudogene","transcript","transcript_bound_by_nucleic_acid","transcript_bound_by_protein","transcript_region","transcript_with_translational_frameshift","transcription_end_site","transcription_factor_regulatory_site","transcription_pause_site","transcription_start_cluster","transcription_termination_signal","transcription_unit","transcriptional_cis_regulatory_region","transgene","transgenic_insertion","transgenic_transposable_element","transit_peptide","transit_peptide_region_of_CDS","transition","translated_nucleotide_match","translated_processed_pseudogene","translated_unprocessed_pseudogene","translation_regulatory_region","translational_frameshift","translationally_regulated_gene","translocation","translocation_breakpoint","translocation_element","transmembrane_helix","transmembrane_polypeptide_region","transposable_element","transposable_element_CDS","transposable_element_flanking_region","transposable_element_gene","transposable_element_insertion_site","transposable_element_pseudogene","transposon_fragment","transversion","trinucleotide_repeat_microsatellite_feature","tryptophan","tryptophan_tRNA_primary_transcript","tryptophanyl_tRNA","twintron","two_methyladenosine","two_methylthio_N6_cis_hydroxyisopentenyl_adenosine","two_methylthio_N6_hydroxynorvalyl_carbamoyladenosine","two_methylthio_N6_isopentenyladenosine","two_methylthio_N6_methyladenosine","two_methylthio_N6_threonyl_carbamoyladenosine","two_prime_O_methyladenosine","two_prime_O_methylcytidine","two_prime_O_methylguanosine","two_prime_O_methylinosine","two_prime_O_methylpseudouridine","two_prime_O_methyluridine","two_prime_O_ribosyladenosine_phosphate","two_prime_O_ribosylguanosine_phosphate","two_thio_two_prime_O_methyluridine","two_thiocytidine","two_thiouridine","tyrosine","tyrosine_tRNA_primary_transcript","tyrosyl_tRNA","uORF","ultracontig","unassigned_supercontig","unconfirmed_transcript","undermodified_hydroxywybutosine","unedited_region","unigene_cluster","unit_of_gene_expression","unitary_pseudogene","unitary_pseudogenic_rRNA","unitary_pseudogenic_tRNA","unprocessed_pseudogenic_rRNA","unprocessed_pseudogenic_tRNA","unspecified_indel","untranslated_region_polycistronic_mRNA","upstream_AUG_codon","uridine_five_oxyacetic_acid","uridine_five_oxyacetic_acid_methyl_ester","vacuolar_sorting_signal","validated_cDNA_clone","valine","valine_tRNA_primary_transcript","valyl_tRNA","vaultRNA_primary_transcript","vault_RNA","vault_RNA_gene","vector_replicon","vertebrate_immune_system_gene","vertebrate_immune_system_gene_recombination_feature","vertebrate_immune_system_gene_recombination_signal_feature","vertebrate_immune_system_gene_recombination_spacer","vertebrate_immune_system_pseudogene","vertebrate_immunoglobulin_T_cell_receptor_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_segment","vertebrate_immunoglobulin_T_cell_receptor_segment","viral_promoter","viral_sequence","virtual_sequence","wild_type_rescue_gene","wobble_base_pair","wybutosine","wyosine","zinc_finger_binding_site","zinc_repressed_element"],Object.defineProperty(Ul,"__esModule",{value:!0}),Ul.CoreValidation=void 0,Ul.isTypeChange=$l;var Gl=Dl,Hl=Ze.__importDefault(zl);function $l(e){return"oldType"in e&&"newType"in e}var Vl=function(e){ee(a,e);var t,n,r=le(a);function a(){var e;K(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Q(se(e=r.call.apply(r,[this].concat(n))),"name","Core"),e}return X(a,[{key:"frontendPreValidate",value:(n=Y(V().mark((function e(t){var n,r,a;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$l(t)){e.next=18;break}n=ve(t.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}if(Hl.default.includes((a=r.value).newType)){e.next=8;break}return e.abrupt("return",{validationName:this.name,error:{message:'"'.concat(a.newType,'" is not a valid SO sequence_feature term')}});case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:return e.abrupt("return",{validationName:this.name});case 19:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("type"!==t){e.next=2;break}return e.abrupt("return",Hl.default);case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(Gl.Validation);Ul.CoreValidation=Vl;var Wl={};Object.defineProperty(Wl,"__esModule",{value:!0}),Wl.ParentChildValidation=void 0;var Jl=Qn,Yl=Xs,Kl=function(e){ee(a,e);var t,n,r=le(a);function a(){var e;K(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Q(se(e=r.call.apply(r,[this].concat(n))),"name","ParentChildValidation"),e}return X(a,[{key:"backendPostValidate",value:(n=Y(V().mark((function e(t,n){var r,a;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.featureModel,a=n.session,!(0,Jl.isLocationEndChange)(t)&&!(0,Jl.isLocationStartChange)(t)){e.next=3;break}return e.abrupt("return",this.validateParentChildRelationships(t,{session:a,featureModel:r}));case 3:return e.abrupt("return",{validationName:this.name});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"validateParentChildRelationships",value:(t=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c,u,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=[],i=ve(t.changes),e.prev=3,l=V().mark((function e(){var t,n,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value.featureId,e.next=4,r.findOne({allIds:t}).session(a).exec();case 4:if(n=e.sent){e.next=8;break}throw i="ERROR: The following featureId was not found in database ='".concat(t,"'"),new Error(i);case 8:o.some((function(e){return e._id===n._id}))||o.push(n);case 9:case"end":return e.stop()}}),e)})),i.s();case 6:if((s=i.n()).done){e.next=10;break}return e.delegateYield(l(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),i.e(e.t1);case 15:return e.prev=15,i.f(),e.finish(15);case 18:c=0,u=o;case 19:if(!(c<u.length)){e.next=31;break}d=u[c],e.prev=21,this.checkChildFeatureBoundaries(d),e.next=28;break;case 25:return e.prev=25,e.t2=e.catch(21),e.abrupt("return",{validationName:this.name,error:{message:String(e.t2)}});case 28:c++,e.next=19;break;case 31:return e.abrupt("return",{validationName:this.name});case 32:case"end":return e.stop()}}),e,this,[[3,12,15,18],[21,25]])}))),function(e,n){return t.apply(this,arguments)})},{key:"checkChildFeatureBoundaries",value:function(e){if(e.children){var t,n=ve(e.children||new Map);try{for(n.s();!(t=n.n()).done;){var r=ue(t.value,2)[1];if(null!==e.min&&null!==e.max&&null!==r.min&&null!==r.max&&(r.max>e.max||r.min<e.min))throw new Error("Feature ".concat((0,Yl.getPrintableId)(r)," exceeds the bounds of its parent, ").concat((0,Yl.getPrintableId)(e)));this.checkChildFeatureBoundaries(r)}}catch(e){n.e(e)}finally{n.f()}}}}]),a}(Dl.Validation);Wl.ParentChildValidation=Kl,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(Dl,e),t.__exportStar(Ll,e),t.__exportStar(Ul,e),t.__exportStar(Wl,e)}(Ml);var Zl={},Xl={};function Ql(e){this.message=e}(Ql.prototype=new Error).name="InvalidCharacterError";var ec="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Ql("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,a=0,o=0,i="";r=t.charAt(o++);~r&&(n=a%4?64*n+r:r,a++%4)?i+=String.fromCharCode(255&n>>(-2*a&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};function tc(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(ec(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return ec(t)}}function nc(e){this.message=e}(nc.prototype=new Error).name="InvalidTokenError";var rc={__proto__:null,default:function(e,t){if("string"!=typeof e)throw new nc("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(tc(e.split(".")[n]))}catch(e){throw new nc("Invalid token specified: "+e.message)}},InvalidTokenError:nc},ac=D(rc);Object.defineProperty(Xl,"__esModule",{value:!0}),Xl.makeUserSessionId=function(e){var t="string"==typeof e?(0,oc.default)(e):e;return"".concat(t.id,"-").concat(t.iat)},Xl.getDecodedToken=function(e){return(0,oc.default)(e)};var oc=Ze.__importDefault(ac);!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Ze.__exportStar(Xl,e)}(Zl);var ic={},sc={},lc={};Object.defineProperty(lc,"__esModule",{value:!0}),lc.getPrintableId=function(e){var t,n,r=null===(t=e.attributes)||void 0===t||null===(t=t.gff_id)||void 0===t?void 0:t.join(", ");if(r)return"".concat(r," (_id: ").concat(e._id.toString(),")");var a=null===(n=e.attributes)||void 0===n||null===(n=n.gff_name)||void 0===n?void 0:n.join(", ");return a?"".concat(a," (_id: ").concat(e._id.toString(),")"):"_id: ".concat(e._id.toString())},Object.defineProperty(sc,"__esModule",{value:!0}),sc.CDSCheck=void 0;var cc,uc,dc=tr,fc=A.default,pc=Ze.__importDefault(Hn),hc=lc;!function(e){e[e.TAG=0]="TAG",e[e.TAA=1]="TAA",e[e.TGA=2]="TGA"}(cc||(cc={})),function(e){e[e.ATG=0]="ATG"}(uc||(uc={}));var mc,gc="CDSCheck";!function(e){e[e.InternalStopCodon=0]="InternalStopCodon",e[e.MissingStartCodon=1]="MissingStartCodon",e[e.MissingStopCodon=2]="MissingStopCodon"}(mc||(mc={}));var yc={G:"C",A:"T",T:"A",C:"G",R:"Y",Y:"R",M:"K",K:"M",S:"S",W:"W",H:"D",B:"V",V:"B",D:"H",N:"N"};function vc(e){var t,n=[],r=ve(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=yc[a.toUpperCase()];if(void 0===o)throw new TypeError('Cannot complement nucleotide: "'.concat(a,'"'));a===a.toLowerCase()?n.push(o.toLowerCase()):n.push(o)}}catch(e){r.e(e)}finally{r.f()}return n.reverse().join("")}function bc(e,t,n){return _c.apply(this,arguments)}function _c(){return(_c=Y(V().mark((function e(t,n,r){var a;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r(e.min,e.max)})));case 2:return a=e.sent.join(""),-1===n&&(a=vc(a)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wc(e){for(var t=[],n=0;n<=e.length-3;n+=3)t.push(e.slice(n,n+3));return t}function xc(e,t,n){return-1===n?e>t:e<t}function Sc(e,t,n){var r=structuredClone(e);r.sort(-1===t?function(e,t){return e.min<t.min?1:-1}:function(e,t){return e.min<t.min?-1:1});for(var a=0,o=void 0,i=void 0,s=0;s<r.length;s++)for(var l=r[s],c=l.phase,u=-1===t?l.min:l.max,d=-1===t?l.max-c:l.min+c;xc(d,u,t);d=-1===t?d-3:d+3){if(o=d,i=-1===t?o-3:o+3,-1===t&&i<l.min?i=r[s+1].max-r[s+1].phase:i>l.max&&(i=r[s+1].min+r[s+1].phase),a===n)return[o,i].sort((function(e,t){return e-t}));a++}}function Ec(e,t){return kc.apply(this,arguments)}function kc(){return(kc=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,I,R,F,P,M,D;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],a=t._id,o=t.max,i=t.min,s=t.refSeq,l=t.strand,c=Cc(t)){e.next=5;break}return e.abrupt("return",r);case 5:u=[a],d=ve(c),e.prev=7,d.s();case 9:if((f=d.n()).done){e.next=38;break}return y=f.value,e.next=13,bc(y,l,n);case 13:b=wc(v=e.sent),_=-1===l?null!==(p=null===(h=y.at(0))||void 0===h?void 0:h.min)&&void 0!==p?p:i:null!==(m=null===(g=y.at(-1))||void 0===g?void 0:g.max)&&void 0!==m?m:o,v.length%3==0?((w=b.at(0))&&!(w.toUpperCase()in uc)&&(C=-1===l?null!==(x=null===(S=y.at(-1))||void 0===S?void 0:S.max)&&void 0!==x?x:o:null!==(E=null===(k=y.at(0))||void 0===k?void 0:k.min)&&void 0!==E?E:i,C=-1===l?C-3:C,r.push({_id:(new pc.default).toHexString(),name:gc,cause:mc[mc.MissingStartCodon],ids:u,refSeq:s.toString(),start:C,end:C,message:'Unexpected start codon "'.concat(w,'" in feature "').concat((0,hc.getPrintableId)(t),'": ')})),(A=b.at(-1))&&!(A.toUpperCase()in cc)&&r.push({_id:(new pc.default).toHexString(),name:gc,cause:mc[mc.MissingStopCodon],ids:u,refSeq:s.toString(),start:_,end:_,message:'Missing stop codon in feature "'.concat((0,hc.getPrintableId)(t),'"')})):r.push({_id:(new pc.default).toHexString(),name:gc,cause:mc[mc.MissingStopCodon],ids:u,refSeq:s.toString(),start:_,end:_,message:'Missing stop codon in feature "'.concat((0,hc.getPrintableId)(t),'"')}),O=ve(b.entries()),e.prev=18,O.s();case 20:if((T=O.n()).done){e.next=28;break}if(N=ue(T.value,2),R=N[1],(I=N[0])!==b.length-1){e.next=24;break}return e.abrupt("break",28);case 24:(F=Sc(y,l,I))&&R.toUpperCase()in cc&&(P=ue(F,2),M=P[0],D=P[1],r.push({_id:(new pc.default).toHexString(),name:gc,cause:mc[mc.InternalStopCodon],ids:u,refSeq:s.toString(),start:M,end:D,message:'Internal stop codon in feature "'.concat((0,hc.getPrintableId)(t),'"')}));case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(18),O.e(e.t0);case 33:return e.prev=33,O.f(),e.finish(33);case 36:e.next=9;break;case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(7),d.e(e.t1);case 43:return e.prev=43,d.f(),e.finish(43);case 46:return e.abrupt("return",r);case 47:case"end":return e.stop()}}),e,null,[[7,40,43,46],[18,30,33,36]])})))).apply(this,arguments)}function Cc(e){if("mRNA"===e.type){var t=e.children,n=e.strand;if(t){var r=Object.values(t).filter((function(e){return"CDS"===e.type}));if(0!==r.length){var a,o=[],i=ve(r);try{var s=function(){for(var e=a.value,r=e.max,i=e.min,s=[],l=0,c=Object.values(t);l<c.length;l++){var u=c[l];if("exon"===u.type){var d=ue((0,fc.intersection2)(i,r,u.min,u.max),2),f=d[0],p=d[1];void 0!==f&&void 0!==p&&s.push({min:f,max:p})}}s.sort((function(e,t){return e.min-t.min})),-1===n&&s.reverse();var h=0,m=s.map((function(e){var t=h;return h=(3-(e.max-e.min-t+3)%3)%3,$($({},e),{},{phase:t})}));m.sort((function(e,t){return e.min<t.min?-1:1})),o.push(m)};for(i.s();!(a=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return o.length>1&&o.sort((function(e,t){return e[0].min<t[0].min?-1:1})),o}}}}var Ac=function(e){ee(r,e);var t,n=le(r);function r(){var e;K(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return Q(se(e=n.call.apply(n,[this].concat(a))),"name",gc),Q(se(e),"causes",Object.values(mc).filter((function(e){return Number.isNaN(Number(e))}))),Q(se(e),"version",1),Q(se(e),"isDefault",!0),e}return X(r,[{key:"checkFeature",value:(t=Y(V().mark((function e(t,n){var r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mRNA"!==t.type){e.next=2;break}return e.abrupt("return",Ec(t,n));case 2:if(t.children){e.next=4;break}return e.abrupt("return",[]);case 4:r=[],a=0,o=Object.values(t.children);case 6:if(!(a<o.length)){e.next=19;break}return i=o[a],e.t0=r.push,e.t1=r,e.t2=fe,e.next=13,this.checkFeature(i,n);case 13:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 16:a++,e.next=6;break;case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),r}(dc.Check);sc.CDSCheck=Ac;var Oc={};Object.defineProperty(Oc,"__esModule",{value:!0}),Oc.TranscriptCheck=void 0;var Tc,Nc=tr,Ic=A.default,Rc=Ze.__importDefault(Hn),Fc=lc;!function(e){e[e.NonCanonicalSpliceSiteAtFivePrime=0]="NonCanonicalSpliceSiteAtFivePrime",e[e.NonCanonicalSpliceSiteAtThreePrime=1]="NonCanonicalSpliceSiteAtThreePrime"}(Tc||(Tc={}));var Pc="TranscriptCheck";function Mc(e,t){return Dc.apply(this,arguments)}function Dc(){return Dc=Y(V().mark((function e(t,n){var r,a,o,i,s,l,c,u,d,f,p,h;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.children){e.next=2;break}return e.abrupt("return",[]);case 2:for(r=[],a=0,o=Object.entries(t.children);a<o.length;a++)i=ue(o[a],2),"exon"===(s=i[1]).type&&r.push(s);if(!(r.length<2)){e.next=6;break}return e.abrupt("return",[]);case 6:r.sort((function(e,t){return e.min<t.min?-1:1})),l=[],c=0;case 9:if(!(c<r.length-1)){e.next=24;break}return u=r[c].max,d=r[c+1].min,-1===t.strand?(d=(f=[u,d])[0],u=f[1],u-=2):d-=2,e.next=15,n(u,u+2);case 15:return p=e.sent,e.next=18,n(d,d+2);case 18:h=e.sent,-1===t.strand&&(h=(0,Ic.revcom)(h),p=(0,Ic.revcom)(p)),l.push({fivePrimeSeq:p,fivePrimeMin:u,threePrimeSeq:h,threePrimeMin:d});case 21:c++,e.next=9;break;case 24:return e.abrupt("return",l);case 25:case"end":return e.stop()}}),e)}))),Dc.apply(this,arguments)}function jc(e,t){return Lc.apply(this,arguments)}function Lc(){return Lc=Y(V().mark((function e(t,n){var r,a,o,i,s,l;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],a=new Set(["GT"]),o=new Set(["AG"]),e.next=5,Mc(t,n);case 5:i=ve(e.sent);try{for(i.s();!(s=i.n()).done;)a.has((l=s.value).fivePrimeSeq.toUpperCase())||r.push({_id:(new Rc.default).toHexString(),name:Pc,cause:Tc[Tc.NonCanonicalSpliceSiteAtFivePrime],ids:[t._id],refSeq:t.refSeq.toString(),start:l.fivePrimeMin,end:l.fivePrimeMin+2,message:'Unexpected 5 splice site in "'.concat((0,Fc.getPrintableId)(t),'". Expected: ').concat(fe(a).join("|"),", got: ").concat(l.fivePrimeSeq)}),o.has(l.threePrimeSeq.toUpperCase())||r.push({_id:(new Rc.default).toHexString(),name:Pc,cause:Tc[Tc.NonCanonicalSpliceSiteAtThreePrime],ids:[t._id],refSeq:t.refSeq.toString(),start:l.threePrimeMin,end:l.threePrimeMin+2,message:'Unexpected 3 splice site in "'.concat((0,Fc.getPrintableId)(t),'". Expected: ').concat(fe(o).join("|"),", got: ").concat(l.threePrimeSeq)})}catch(e){i.e(e)}finally{i.f()}return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),Lc.apply(this,arguments)}var qc=function(e){ee(r,e);var t,n=le(r);function r(){var e;K(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return Q(se(e=n.call.apply(n,[this].concat(a))),"name","TranscriptCheck"),Q(se(e),"causes",Object.values(Tc).filter((function(e){return Number.isNaN(Number(e))}))),Q(se(e),"version",1),Q(se(e),"isDefault",!0),e}return X(r,[{key:"checkFeature",value:(t=Y(V().mark((function e(t,n){var r,a,o,i;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mRNA"!==t.type&&"transcript"!==t.type&&"pseudogenic_transcript"!==t.type){e.next=2;break}return e.abrupt("return",jc(t,n));case 2:if(t.children){e.next=4;break}return e.abrupt("return",[]);case 4:r=[],a=0,o=Object.values(t.children);case 6:if(!(a<o.length)){e.next=19;break}return i=o[a],e.t0=r.push,e.t1=r,e.t2=fe,e.next=13,this.checkFeature(i,n);case 13:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 16:a++,e.next=6;break;case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),r}(Nc.Check);Oc.TranscriptCheck=qc,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(sc,e),t.__exportStar(Oc,e)}(ic);var Bc={};Object.defineProperty(Bc,"__esModule",{value:!0}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(Qn,e),t.__exportStar(Nl,e),t.__exportStar(Ml,e),t.__exportStar(Zl,e),t.__exportStar(ic,e),t.__exportStar(Xs,e),t.__exportStar(Bc,e),t.__exportStar(Cr,e)}(Xn);var Uc=s.createSvgIcon(i.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const zc=a.ConfigurationSchema("ApolloInternetAccount",{baseURL:{description:"Location of Apollo server",type:"string",defaultValue:""},tokenType:{description:"A custom name for a token to include in the header",type:"string",defaultValue:"Bearer"}},{baseConfiguration:o.BaseInternetAccountConfig,explicitlyTyped:!0});var Gc=Object.create(null);Gc.open="0",Gc.close="1",Gc.ping="2",Gc.pong="3",Gc.message="4",Gc.upgrade="5",Gc.noop="6";var Hc=Object.create(null);Object.keys(Gc).forEach((function(e){Hc[Gc[e]]=e}));var $c,Vc={type:"error",data:"parser error"},Wc="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Jc="function"==typeof ArrayBuffer,Yc=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},Kc=function(e,t,n){var r=e.type,a=e.data;return Wc&&a instanceof Blob?t?n(a):Zc(a,n):Jc&&(a instanceof ArrayBuffer||Yc(a))?t?n(a):Zc(new Blob([a]),n):n(Gc[r]+(a||""))},Zc=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Xc(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var Qc="undefined"==typeof Uint8Array?[]:new Uint8Array(256),eu=0;eu<64;eu++)Qc["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(eu)]=eu;var tu,nu="function"==typeof ArrayBuffer,ru=function(e,t){if("string"!=typeof e)return{type:"message",data:ou(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:au(e.substring(1),t)}:Hc[n]?e.length>1?{type:Hc[n],data:e.substring(1)}:{type:Hc[n]}:Vc},au=function(e,t){if(nu){var n=function(e){var t,n,r,a,o,i=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),u=new Uint8Array(c);for(t=0;t<s;t+=4)n=Qc[e.charCodeAt(t)],r=Qc[e.charCodeAt(t+1)],a=Qc[e.charCodeAt(t+2)],o=Qc[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&o;return c}(e);return ou(n,t)}return{base64:!0,data:e}},ou=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},iu=String.fromCharCode(30);function su(e){return e.reduce((function(e,t){return e+t.length}),0)}function lu(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),r=0,a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function cu(e){if(e)return function(e){for(var t in cu.prototype)e[t]=cu.prototype[t];return e}(e)}cu.prototype.on=cu.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},cu.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},cu.prototype.off=cu.prototype.removeListener=cu.prototype.removeAllListeners=cu.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},cu.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},cu.prototype.emitReserved=cu.prototype.emit,cu.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},cu.prototype.hasListeners=function(e){return!!this.listeners(e).length};var uu=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()}();function du(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var fu=uu.setTimeout,pu=uu.clearTimeout;function hu(e,t){t.useNativeTimers?(e.setTimeoutFn=fu.bind(uu),e.clearTimeoutFn=pu.bind(uu)):(e.setTimeoutFn=uu.setTimeout.bind(uu),e.clearTimeoutFn=uu.clearTimeout.bind(uu))}var mu,gu=function(e){ee(n,e);var t=le(n);function n(e,r,a){var o;return K(this,n),(o=t.call(this,e)).description=r,o.context=a,o.type="TransportError",o}return X(n)}(oe(Error)),yu=function(e){ee(n,e);var t=le(n);function n(e){var r;return K(this,n),(r=t.call(this)).writable=!1,hu(se(r),e),r.opts=e,r.query=e.query,r.socket=e.socket,r}return X(n,[{key:"onError",value:function(e,t,r){return ce(te(n.prototype),"emitReserved",this).call(this,"error",new gu(e,t,r)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,ce(te(n.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=ru(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){ce(te(n.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",ce(te(n.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}]),n}(cu),vu="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),bu=64,_u=0;function wu(e){var t="";do{t=vu[e%bu]+t,e=Math.floor(e/bu)}while(e>0);return t}function xu(){var e=wu(+new Date);return e!==mu?(_u=0,mu=e):e+"."+wu(_u++)}var Su=!1;try{Su="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(io){}var Eu=Su;function ku(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Eu))return new XMLHttpRequest}catch(e){}if(!t)try{return new(uu[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function Cu(){}var Au=function(){return null!=new ku({xdomain:!1}).responseType}(),Ou=function(e){ee(n,e);var t=le(n);function n(e){var r;if(K(this,n),(r=t.call(this,e)).polling=!1,"undefined"!=typeof location){var a="https:"===location.protocol,o=location.port;o||(o=a?"443":"80"),r.xd="undefined"!=typeof location&&e.hostname!==location.hostname||o!==e.port}return r.supportsBinary=Au&&!(e&&e.forceBase64),r.opts.withCredentials&&(r.cookieJar=void 0),r}return X(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(iu),r=[],a=0;a<n.length;a++){var o=ru(n[a],t);if(r.push(o),"error"===o.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,n){var r=e.length,a=new Array(r),o=0;e.forEach((function(e,n){Kc(e,!1,(function(e){var i;a[n]=e,++o===r&&(i=a.join(iu),t.doWrite(i,(function(){t.writable=!0,t.emitReserved("drain")})))}))}))}(e)}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=xu()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Tu(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e,t){n.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t}}]),n}(yu),Tu=function(e){ee(n,e);var t=le(n);function n(e,r){var a;return K(this,n),hu(se(a=t.call(this)),r),a.opts=r,a.method=r.method||"GET",a.uri=e,a.data=void 0!==r.data?r.data:null,a.create(),a}return X(n,[{key:"create",value:function(){var e,t=this,r=du(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;var a=this.xhr=new ku(r);try{a.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var o in a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&a.setRequestHeader(o,this.opts.extraHeaders[o])}catch(e){}if("POST"===this.method)try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{a.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(a),"withCredentials"in a&&(a.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(a.timeout=this.opts.requestTimeout),a.onreadystatechange=function(){var e;3===a.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(a)),4===a.readyState&&(200===a.status||1223===a.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"==typeof a.status?a.status:0)}),0))},a.send(this.data)}catch(e){return void this.setTimeoutFn((function(){t.onError(e)}),0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(null!=this.xhr){if(this.xhr.onreadystatechange=Cu,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}(cu);function Nu(){for(var e in Tu.requests)Tu.requests.hasOwnProperty(e)&&Tu.requests[e].abort()}Tu.requestsCount=0,Tu.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Nu):"function"==typeof addEventListener&&addEventListener("onpagehide"in uu?"pagehide":"unload",Nu,!1));var Iu=function(){return"function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)}}(),Ru=uu.WebSocket||uu.MozWebSocket,Fu="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Pu=function(e){ee(n,e);var t=le(n);function n(e){var r;return K(this,n),(r=t.call(this,e)).supportsBinary=!e.forceBase64,r}return X(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=Fu?{}:du(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Fu?new Ru(e,t,n):t?new Ru(e,t):new Ru(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;Kc(e[r],t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}n&&Iu((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=xu()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!Ru}}]),n}(yu),Mu=function(e){ee(n,e);var t=le(n);function n(){return K(this,n),t.apply(this,arguments)}return X(n,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var n=function(e,t){tu||(tu=new TextDecoder);var n=[],r=0,a=-1,o=!1;return new TransformStream({transform:function(i,s){for(n.push(i);;){if(0===r){if(su(n)<1)break;var l=lu(n,1);o=128==(128&l[0]),r=(a=127&l[0])<126?3:126===a?1:2}else if(1===r){if(su(n)<2)break;var c=lu(n,2);a=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(2===r){if(su(n)<8)break;var u=lu(n,8),d=new DataView(u.buffer,u.byteOffset,u.length),f=d.getUint32(0);if(f>Math.pow(2,21)-1){s.enqueue(Vc);break}a=f*Math.pow(2,32)+d.getUint32(4),r=3}else{if(su(n)<a)break;var p=lu(n,a);s.enqueue(ru(o?p:tu.decode(p),t)),r=0}if(0===a||a>e){s.enqueue(Vc);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),a=new TransformStream({transform:function(e,t){!function(e,t){Wc&&e.data instanceof Blob?e.data.arrayBuffer().then(Xc).then(t):Jc&&(e.data instanceof ArrayBuffer||Yc(e.data))?t(Xc(e.data)):Kc(e,!1,(function(e){$c||($c=new TextEncoder),t($c.encode(e))}))}(e,(function(n){var r,a=n.length;if(a<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,a);else if(a<65536){r=new Uint8Array(3);var o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,a)}else{r=new Uint8Array(9);var i=new DataView(r.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(a))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}});a.readable.pipeTo(t.writable),e.writer=a.writable.getWriter(),function t(){r.read().then((function(n){n.done||(e.onPacket(n.value),t())})).catch((function(e){}))}();var o={type:"open"};e.query.sid&&(o.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(o).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;t.writer.write(e[r]).then((function(){n&&Iu((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),n}(yu),Du={websocket:Pu,webtransport:Mu,polling:Ou},ju=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Lu=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function qu(e){var t,n,r=e,a=e.indexOf("["),o=e.indexOf("]");-1!=a&&-1!=o&&(e=e.substring(0,a)+e.substring(a,o).replace(/:/g,";")+e.substring(o,e.length));for(var i,s=ju.exec(e||""),l={},c=14;c--;)l[Lu[c]]=s[c]||"";return-1!=a&&-1!=o&&(l.source=r,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(n=(t=l.path).replace(/\/{2,9}/g,"/").split("/"),"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n),l.queryKey=(i={},l.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),l}var Bu=function(e){ee(n,e);var t=le(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return K(this,n),(r=t.call(this)).binaryType="arraybuffer",r.writeBuffer=[],e&&"object"===W(e)&&(a=e,e=null),e?(e=qu(e),a.hostname=e.host,a.secure="https"===e.protocol||"wss"===e.protocol,a.port=e.port,e.query&&(a.query=e.query)):a.host&&(a.hostname=qu(a.host).host),hu(se(r),a),r.secure=null!=a.secure?a.secure:"undefined"!=typeof location&&"https:"===location.protocol,a.hostname&&!a.port&&(a.port=r.secure?"443":"80"),r.hostname=a.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=a.port||("undefined"!=typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=a.transports||["polling","websocket","webtransport"],r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),r.opts.path=r.opts.path.replace(/\/$/,"")+(r.opts.addTrailingSlash?"/":""),"string"==typeof r.opts.query&&(r.opts.query=function(e){for(var t={},n=e.split("&"),r=0,a=n.length;r<a;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"==typeof addEventListener&&(r.opts.closeOnBeforeunload&&(r.beforeunloadEventListener=function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())},addEventListener("beforeunload",r.beforeunloadEventListener,!1)),"localhost"!==r.hostname&&(r.offlineEventListener=function(){r.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",r.offlineEventListener,!1))),r.open(),r}return X(n,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Du[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),a=!1;n.priorWebsocketSuccess=!1;var o=function(){a||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(function(e){if(!a)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;n.priorWebsocketSuccess="websocket"===r.name,t.transport.pause((function(){a||"closed"!==t.readyState&&(d(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=r.name,t.emitReserved("upgradeError",o)}})))};function i(){a||(a=!0,d(),r.close(),r=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=r.name,i(),t.emitReserved("upgradeError",n)};function l(){s("transport closed")}function c(){s("socket closed")}function u(e){r&&e.name!==r.name&&i()}var d=function(){r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",l),t.off("close",c),t.off("upgrading",u)};r.once("open",o),r.once("error",s),r.once("close",l),this.once("close",c),this.once("upgrading",u),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){a||r.open()}),200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,n=0;n<this.writeBuffer.length;n++){var r=this.writeBuffer[n].data;if(r&&(t+="string"==typeof(e=r)?function(e){for(var t=0,n=0,r=0,a=e.length;r<a;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(cu);Bu.protocol=4;var Uu="function"==typeof ArrayBuffer,zu=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Gu=Object.prototype.toString,Hu="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Gu.call(Blob),$u="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Gu.call(File);function Vu(e){return Uu&&(e instanceof ArrayBuffer||zu(e))||Hu&&e instanceof Blob||$u&&e instanceof File}function Wu(e,t){if(!e||"object"!==W(e))return!1;if(Array.isArray(e)){for(var n=0,r=e.length;n<r;n++)if(Wu(e[n]))return!0;return!1}if(Vu(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Wu(e.toJSON(),!0);for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&Wu(e[a]))return!0;return!1}function Ju(e){var t=[],n=e;return n.data=Yu(e.data,t),n.attachments=t.length,{packet:n,buffers:t}}function Yu(e,t){if(!e)return e;if(Vu(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var r=new Array(e.length),a=0;a<e.length;a++)r[a]=Yu(e[a],t);return r}if("object"===W(e)&&!(e instanceof Date)){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=Yu(e[i],t));return o}return e}function Ku(e,t){return e.data=Zu(e.data,t),delete e.attachments,e}function Zu(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=Zu(e[n],t);else if("object"===W(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Zu(e[r],t));return e}var Xu,Qu=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Xu||(Xu={}));var ed=function(){function e(t){K(this,e),this.replacer=t}return X(e,[{key:"encode",value:function(e){return e.type!==Xu.EVENT&&e.type!==Xu.ACK||!Wu(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Xu.EVENT?Xu.BINARY_EVENT:Xu.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==Xu.BINARY_EVENT&&e.type!==Xu.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=Ju(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}();function td(e){return"[object Object]"===Object.prototype.toString.call(e)}var nd=function(e){ee(n,e);var t=le(n);function n(e){var r;return K(this,n),(r=t.call(this)).reviver=e,r}return X(n,[{key:"add",value:function(e){var t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===Xu.BINARY_EVENT;r||t.type===Xu.BINARY_ACK?(t.type=r?Xu.EVENT:Xu.ACK,this.reconstructor=new rd(t),0===t.attachments&&ce(te(n.prototype),"emitReserved",this).call(this,"decoded",t)):ce(te(n.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!Vu(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,ce(te(n.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(void 0===Xu[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Xu.BINARY_EVENT||r.type===Xu.BINARY_ACK){for(var a=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(a,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(i,t)}else r.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var l=t+1;++t;){var c=e.charAt(t);if(null==c||Number(c)!=c){--t;break}if(t===e.length)break}r.id=Number(e.substring(l,t+1))}if(e.charAt(++t)){var u=this.tryParse(e.substr(t));if(!n.isPayloadValid(r.type,u))throw new Error("invalid payload");r.data=u}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case Xu.CONNECT:return td(t);case Xu.DISCONNECT:return void 0===t;case Xu.CONNECT_ERROR:return"string"==typeof t||td(t);case Xu.EVENT:case Xu.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Qu.indexOf(t[0]));case Xu.ACK:case Xu.BINARY_ACK:return Array.isArray(t)}}}]),n}(cu),rd=function(){function e(t){K(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return X(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Ku(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),ad={__proto__:null,protocol:5,get PacketType(){return Xu},Encoder:ed,Decoder:nd};function od(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var id=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),sd=function(e){ee(n,e);var t=le(n);function n(e,r,a){var o;return K(this,n),(o=t.call(this)).connected=!1,o.recovered=!1,o.receiveBuffer=[],o.sendBuffer=[],o._queue=[],o._queueSeq=0,o.ids=0,o.acks={},o.flags={},o.io=e,o.nsp=r,a&&a.auth&&(o.auth=a.auth),o._opts=Object.assign({},a),o.io._autoConnect&&o.open(),o}return X(n,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[od(e,"open",this.onopen.bind(this)),od(e,"packet",this.onpacket.bind(this)),od(e,"error",this.onerror.bind(this)),od(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(id.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;var a={type:Xu.EVENT,data:n,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var o=this.ids++,i=n.pop();this._registerAckCallback(o,i),a.id=o}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n,r=this,a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==a){var o=this.io.setTimeoutFn((function(){delete r.acks[e];for(var n=0;n<r.sendBuffer.length;n++)r.sendBuffer[n].id===e&&r.sendBuffer.splice(n,1);t.call(r,new Error("operation has timed out"))}),a);this.acks[e]=function(){r.io.clearTimeoutFn(o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,[null].concat(n))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(n,a){r.push((function(e,t){return o?e?a(e):n(t):n(e)})),t.emit.apply(t,[e].concat(r))}))}},{key:"_addToQueue",value:function(e){var t,n=this;"function"==typeof e[e.length-1]&&(t=e.pop());var r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r===n._queue[0]){if(null!==e)r.tryCount>n._opts.retries&&(n._queue.shift(),t&&t(e));else if(n._queue.shift(),t){for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];t.apply(void 0,[null].concat(o))}return r.pending=!1,n._drainQueue()}})),this._queue.push(r),this._drainQueue()}},{key:"_drainQueue",value:function(){if(this.connected&&0!==this._queue.length){var e=this._queue[0];e.pending&&!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:Xu.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case Xu.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Xu.EVENT:case Xu.BINARY_EVENT:this.onevent(e);break;case Xu.ACK:case Xu.BINARY_ACK:this.onack(e);break;case Xu.DISCONNECT:this.ondisconnect();break;case Xu.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=ve(this._anyListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e)}catch(e){r.e(e)}finally{r.f()}}ce(te(n.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t.packet({type:Xu.ACK,id:e,data:a})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:Xu.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=ve(this._anyOutgoingListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e.data)}catch(e){n.e(e)}finally{n.f()}}}}]),n}(cu);function ld(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}ld.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},ld.prototype.reset=function(){this.attempts=0},ld.prototype.setMin=function(e){this.ms=e},ld.prototype.setMax=function(e){this.max=e},ld.prototype.setJitter=function(e){this.jitter=e};var cd=function(e){ee(n,e);var t=le(n);function n(e,r){var a,o;K(this,n),(a=t.call(this)).nsps={},a.subs=[],e&&"object"===W(e)&&(r=e,e=void 0),(r=r||{}).path=r.path||"/socket.io",a.opts=r,hu(se(a),r),a.reconnection(!1!==r.reconnection),a.reconnectionAttempts(r.reconnectionAttempts||Infinity),a.reconnectionDelay(r.reconnectionDelay||1e3),a.reconnectionDelayMax(r.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(o=r.randomizationFactor)&&void 0!==o?o:.5),a.backoff=new ld({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==r.timeout?2e4:r.timeout),a._readyState="closed",a.uri=e;var i=r.parser||ad;return a.encoder=new i.Encoder,a.decoder=new i.Decoder,a._autoConnect=!1!==r.autoConnect,a._autoConnect&&a.open(),a}return X(n,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Bu(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var a=od(n,"open",(function(){r.onopen(),e&&e()})),o=function(n){t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},i=od(n,"error",o);if(!1!==this._timeout){var s=this.setTimeoutFn((function(){a(),o(new Error("timeout")),n.close()}),this._timeout);this.opts.autoUnref&&s.unref(),this.subs.push((function(){t.clearTimeoutFn(s)}))}return this.subs.push(a),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(od(e,"ping",this.onping.bind(this)),od(e,"data",this.ondata.bind(this)),od(e,"error",this.onerror.bind(this)),od(e,"close",this.onclose.bind(this)),od(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}},{key:"ondecoded",value:function(e){var t=this;Iu((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new sd(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++)if(this.nsps[n[t]].active)return;this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){e.clearTimeoutFn(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),n}(cu),ud={};function dd(e,t){"object"===W(e)&&(t=e,e=void 0);var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=qu(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),a=r.source,o=r.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||ud[o]&&r.path in ud[o].nsps?n=new cd(a,t):(ud[o]||(ud[o]=new cd(a,t)),n=ud[o]),r.query&&!t.query&&(t.query=r.queryKey),n.socket(r.path,t)}Object.assign(dd,{Manager:cd,Socket:sd,io:dd,connect:dd});var fd=s.createSvgIcon([i.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),i.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),pd=s.createSvgIcon(i.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),hd=s.createSvgIcon(i.jsx("path",{d:"M21 3.01H3c-1.1 0-2 .9-2 2V9h2V4.99h18v14.03H3V15H1v4.01c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98v-14c0-1.11-.9-2-2-2M11 16l4-4-4-4v3H1v2h10z"}),"Input"),md=s.createSvgIcon(i.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),gd=s.createSvgIcon(i.jsx("path",{d:"M16.54 11 13 7.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zM11 7H2v2h9zm10 6.41L19.59 12 17 14.59 14.41 12 13 13.41 15.59 16 13 18.59 14.41 20 17 17.41 19.59 20 21 18.59 18.41 16zM11 15H2v2h9z"}),"Rule"),yd=s.createSvgIcon(i.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),vd=s.createSvgIcon(i.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link"),bd=s.createSvgIcon(i.jsx("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonChecked"),_d=s.createSvgIcon(i.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonUnchecked"),wd={},xd={},Sd={},Ed={};function kd(e){return decodeURIComponent(e)}function Cd(e,t){return String(t).replaceAll(e,(function(e){return encodeURIComponent(e).toUpperCase()}))}function Ad(e){return Cd(/[\n;\r\t=%&,\u0000-\u001f\u007f]/g,e)}function Od(e){return Cd(/[\n\r\t%\u0000-\u001f\u007f]/g,e)}function Td(e){if(null==e||!e.length||"."===e)return{};var t={};return e.replace(/\r\n|[\r\n]$/,"").split(";").forEach((function(e){var n,r,a=e.split("=",2);if(null!==(n=a[1])&&void 0!==n&&n.length){a[0]=a[0].trim();var o=t[a[0].trim()];o||(t[a[0]]=o=[]),(r=o).push.apply(r,fe(a[1].split(",").map((function(e){return e.trim()})).map(kd)))}})),t}function Nd(e){var t=[];return Object.entries(e).forEach((function(e){var n=ue(e,2),r=n[0],a=n[1].map(Ad).join(",");t.push("".concat(Ad(r),"=").concat(a))})),t.length?t.join(";"):"."}function Id(e,t){var n=null==e.attributes?".":Nd(e.attributes),r=[null===e.seq_id?".":Od(e.seq_id),null===e.source?".":Od(e.source),null===e.type?".":Od(e.type),null===e.start?".":Od(e.start),null===e.end?".":Od(e.end),null===e.score?".":Od(e.score),null===e.strand?".":Od(e.strand),null===e.phase?".":Od(e.phase),n],a="".concat(r.join("\t"),"\n");return t[a]?"":(t[a]=!0,a)}function Rd(e,t){if(Array.isArray(e))return e.map((function(e){return Rd(e,t)})).join("");var n,r=[Id(e,t)];return void 0!==(n=e).child_features&&void 0!==n.derived_features&&r.push.apply(r,fe(e.child_features.map((function(e){return Rd(e,t)}))).concat(fe(e.derived_features.map((function(e){return Rd(e,t)}))))),r.join("")}function Fd(e){return Rd(e,{})}function Pd(e){var t="##".concat(e.directive);return e.value&&(t+=" ".concat(e.value)),t+"\n"}function Md(e){return"# ".concat(e.comment,"\n")}function Dd(e){for(var t=">".concat(e.id).concat(e.description?" ".concat(e.description):"","\n"),n=Math.ceil(e.sequence.length/80),r=new Array(n),a=0;a<n;a+=1){var o=80*a;r[a]=e.sequence.slice(o,o+80)}return"".concat(t).concat(r.join("\n"),"\n")}function jd(e){return"attributes"in e?Fd(e):"directive"in e?Pd(e):"sequence"in e?Dd(e):"comment"in e?Md(e):"# (invalid item found during format)\n"}Object.defineProperty(Ed,"__esModule",{value:!0}),Ed.unescape=kd,Ed.escape=Ad,Ed.escapeColumn=Od,Ed.parseAttributes=Td,Ed.parseFeature=function(e){var t=e.trim().split("\t").map((function(e){return"."===e||""===e?null:e}));return{seq_id:t[0]&&kd(t[0]),source:t[1]&&kd(t[1]),type:t[2]&&kd(t[2]),start:null===t[3]?null:parseInt(t[3],10),end:null===t[4]?null:parseInt(t[4],10),score:null===t[5]?null:parseFloat(t[5]),strand:t[6],phase:t[7],attributes:null===t[8]?null:Td(t[8])}},Ed.parseDirective=function(e){var t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;var n=ue(t,2)[1],r=ue(t,3)[2],a={directive:n};if(r.length&&(r=r.replace(/\r\n|[\r\n]$/,""),a.value=r),"sequence-region"===n){var o,i,s=r.split(/\s+/,3);return $($({},a),{},{seq_id:s[0],start:null===(o=s[1])||void 0===o?void 0:o.replaceAll(/\D/g,""),end:null===(i=s[2])||void 0===i?void 0:i.replaceAll(/\D/g,"")})}if("genome-build"===n){var l=ue(r.split(/\s+/,2),2),c=l[0],u=l[1];return $($({},a),{},{source:c,buildName:u})}return a},Ed.formatAttributes=Nd,Ed.formatFeature=Fd,Ed.formatDirective=Pd,Ed.formatComment=Md,Ed.formatSequence=Dd,Ed.formatItem=function(e){return Array.isArray(e)?e.map(jd):jd(e)},Object.defineProperty(Sd,"__esModule",{value:!0}),Sd.GFF3Parser=Sd.FASTAParser=void 0;var Ld=Ed,qd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};K(this,e),Q(this,"seqCallback",void 0),Q(this,"currentSequence",void 0),this.seqCallback=t,this.currentSequence=void 0}return X(e,[{key:"addLine",value:function(e){var t=/^>\s*(\S+)\s*(.*)/.exec(e);t?(this.flush(),this.currentSequence={id:t[1],sequence:""},t[2]&&(this.currentSequence.description=t[2].trim())):this.currentSequence&&/\S/.test(e)&&(this.currentSequence.sequence+=e.replaceAll(/\s/g,""))}},{key:"flush",value:function(){this.currentSequence&&this.seqCallback(this.currentSequence)}},{key:"finish",value:function(){this.flush()}}]),e}();Sd.FASTAParser=qd;var Bd=function(){function e(t){K(this,e),Q(this,"endCallback",void 0),Q(this,"disableDerivesFromReferences",void 0),Q(this,"bufferSize",void 0),Q(this,"fastaParser",void 0),Q(this,"eof",!1),Q(this,"lineNumber",0),Q(this,"underConstructionTopLevel",[]),Q(this,"underConstructionById",{}),Q(this,"completedReferences",{}),Q(this,"underConstructionOrphans",new Map),this.endCallback=t.endCallback||function(){},this.disableDerivesFromReferences=t.disableDerivesFromReferences||!1,this.bufferSize=void 0===t.bufferSize?Infinity:t.bufferSize}return X(e,[{key:"addLine",value:function(e,t){if(this.fastaParser)this.fastaParser.addLine(e);else if(!this.eof)if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))this.bufferLine(e,t);else{var n=/^\s*(#+)(.*)/.exec(e);if(n){var r=ue(n,2)[1],a=ue(n,3)[2];if(3===r.length)this.emitAllUnderConstructionFeatures(t);else if(2===r.length){var o=(0,Ld.parseDirective)(e);o&&("FASTA"===o.directive?(this.emitAllUnderConstructionFeatures(t),this.eof=!0,this.fastaParser=new qd(t.sequenceCallback)):this.emitItem(o,t))}else a=a.replace(/\s*/,""),this.emitItem({comment:a},t)}else if(/^\s*$/.test(e));else{if(!/^\s*>/.test(e)){var i=e.replaceAll(/\r\n|[\r\n]$/g,"");throw new Error("GFF3 parse error. Cannot parse '".concat(i,"'."))}this.emitAllUnderConstructionFeatures(t),this.eof=!0,this.fastaParser=new qd(t.sequenceCallback),this.fastaParser.addLine(e)}}}},{key:"finish",value:function(e){this.emitAllUnderConstructionFeatures(e),this.fastaParser&&this.fastaParser.finish(),this.endCallback()}},{key:"emitItem",value:function(e,t){Array.isArray(e)&&t.featureCallback?t.featureCallback(e):"directive"in e&&t.directiveCallback?t.directiveCallback(e):"comment"in e&&t.commentCallback&&t.commentCallback(e)}},{key:"enforceBufferSizeLimit",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0,r=function t(n){var r;n&&Array.isArray(n)&&null!==(r=n[0].attributes)&&void 0!==r&&null!==(r=r.ID)&&void 0!==r&&r[0]&&(n[0].attributes.ID.forEach((function(t){delete e.underConstructionById[t],delete e.completedReferences[t]})),n.forEach((function(e){e.child_features&&e.child_features.forEach((function(e){return t(e)})),e.derived_features&&e.derived_features.forEach((function(e){return t(e)}))})))};this.underConstructionTopLevel.length+t>this.bufferSize;){var a=this.underConstructionTopLevel.shift();a&&(this.emitItem(a,n),r(a))}}},{key:"emitAllUnderConstructionFeatures",value:function(e){var t=this;if(this.underConstructionTopLevel.forEach((function(n){return t.emitItem.bind(t)(n,e)})),this.underConstructionTopLevel=[],this.underConstructionById={},this.completedReferences={},this.underConstructionOrphans.size)throw new Error("some features reference other features that do not exist in the file (or in the same '###' scope). ".concat(Array.from(this.underConstructionOrphans.keys()).join(",")))}},{key:"bufferLine",value:function(e,t){var n,r,a,o=this,i=$($({},(0,Ld.parseFeature)(e)),{},{child_features:[],derived_features:[]}),s=(null===(n=i.attributes)||void 0===n?void 0:n.ID)||[],l=(null===(r=i.attributes)||void 0===r?void 0:r.Parent)||[],c=this.disableDerivesFromReferences?[]:(null===(a=i.attributes)||void 0===a?void 0:a.Derives_from)||[];if(s.length||l.length||c.length){var u=void 0;s.forEach((function(e){var n=o.underConstructionById[e];n?(n[n.length-1].type!==i.type&&o.parseError('multi-line feature "'.concat(e,'" has inconsistent types: "').concat(i.type,'", "').concat(n[n.length-1].type,'"'),t),n.push(i),u=n):(u=[i],o.enforceBufferSizeLimit(1,t),l.length||c.length||o.underConstructionTopLevel.push(u),o.underConstructionById[e]=u,o.resolveReferencesTo(u,e))})),this.resolveReferencesFrom(u||[i],{Parent:l,Derives_from:c},s)}else this.emitItem([i],t)}},{key:"resolveReferencesTo",value:function(e,t){var n=this.underConstructionOrphans.get(t);n&&(e.forEach((function(e){var t;(t=e.child_features).push.apply(t,fe(n.Parent))})),e.forEach((function(e){var t;(t=e.derived_features).push.apply(t,fe(n.Derives_from))})),this.underConstructionOrphans.delete(t))}},{key:"parseError",value:function(e,t){var n;this.eof=!0,null===(n=t.errorCallback)||void 0===n||n.call(t,"".concat(this.lineNumber,": ").concat(e))}},{key:"postSet",value:function(e,t,n){var r=e[t];r||(e[t]=r={});var a=r[n]||!1;return r[n]=!0,a}},{key:"resolveReferencesFrom",value:function(e,t,n){var r=this;t.Parent.forEach((function(t){var a=r.underConstructionById[t];if(a)n.filter((function(e){return r.postSet(r.completedReferences,e,"Parent,".concat(t))})).length||a.forEach((function(t){t.child_features.push(e)}));else{var o=r.underConstructionOrphans.get(t);o||r.underConstructionOrphans.set(t,o={Parent:[],Derives_from:[]}),o.Parent.push(e)}})),t.Derives_from.forEach((function(t){var a=r.underConstructionById[t];if(a)n.filter((function(e){return r.postSet(r.completedReferences,e,"Derives_from,".concat(t))})).length||a.forEach((function(t){t.derived_features.push(e)}));else{var o=r.underConstructionOrphans.get(t);o||r.underConstructionOrphans.set(t,o={Parent:[],Derives_from:[]}),o.Derives_from.push(e)}}))}}]),e}();Sd.GFF3Parser=Bd,Object.defineProperty(xd,"__esModule",{value:!0}),xd.GFFFormattingTransformer=xd.GFFTransformer=void 0,xd.parseStringSync=function(e,t){if(!e)return[];var n=Gd(null!=t?t:{}),r=[],a=r.push.bind(r),o={errorCallback:function(e){throw new Error(e)}};n.parseFeatures&&(o.featureCallback=a),n.parseDirectives&&(o.directiveCallback=a),n.parseComments&&(o.commentCallback=a),n.parseSequences&&(o.sequenceCallback=a);var i=new Ud.GFF3Parser({disableDerivesFromReferences:n.disableDerivesFromReferences||!1,bufferSize:Infinity});return e.split(/\r\n|[\r\n]/).forEach((function(e){return i.addLine.bind(i)(e,o)})),i.finish(o),r},xd.formatSync=function(e){var t=[],n=[];e.forEach((function(e){"sequence"in e?n.push(e):t.push(e)}));var r=t.map((function(e){return Array.isArray(e)?(0,zd.formatItem)(e).join(""):(0,zd.formatItem)(e)})).join("");return n.length&&(r+="##FASTA\n",r+=n.map(zd.formatSequence).join("")),r};var Ud=Sd,zd=Ed;function Gd(e){return $({parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1,bufferSize:Infinity,disableDerivesFromReferences:!1},e)}var Hd=function(){function e(t){K(this,e),Q(this,"decoder",void 0),Q(this,"parser",void 0),Q(this,"lastString",""),Q(this,"parseFeatures",void 0),Q(this,"parseDirectives",void 0),Q(this,"parseComments",void 0),Q(this,"parseSequences",void 0),this.decoder=new TextDecoder;var n=Gd(null!=t?t:{});this.parser=new Ud.GFF3Parser({bufferSize:n.bufferSize,disableDerivesFromReferences:n.disableDerivesFromReferences}),this.parseFeatures=n.parseFeatures,this.parseDirectives=n.parseDirectives,this.parseComments=n.parseComments,this.parseSequences=n.parseSequences}return X(e,[{key:"makeCallbacks",value:function(e){var t={errorCallback:this.emitErrorMessage.bind(this,e)};return this.parseFeatures&&(t.featureCallback=function(t){e.enqueue(t)}),this.parseDirectives&&(t.directiveCallback=function(t){e.enqueue(t)}),this.parseComments&&(t.commentCallback=function(t){e.enqueue(t)}),this.parseSequences&&(t.sequenceCallback=function(t){e.enqueue(t)}),t}},{key:"emitErrorMessage",value:function(e,t){e.error(t)}},{key:"transform",value:function(e,t){var n="".concat(this.lastString).concat(this.decoder.decode(e,{stream:!0})).split(/\r\n|[\r\n]/g);this.lastString=n.pop()||"";var r,a=ve(n);try{for(a.s();!(r=a.n()).done;)this.parser.addLine(r.value,this.makeCallbacks(t))}catch(e){a.e(e)}finally{a.f()}}},{key:"flush",value:function(e){var t=this.makeCallbacks(e);this.lastString="".concat(this.lastString).concat(this.decoder.decode()),this.lastString&&(this.parser.addLine(this.lastString,t),this.lastString=""),this.parser.finish(t)}}]),e}();xd.GFFTransformer=Hd;var $d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K(this,e),Q(this,"linesSinceLastSyncMark",0),Q(this,"haveWeEmittedData",!1),Q(this,"fastaMode",!1),Q(this,"minLinesBetweenSyncMarks",void 0),Q(this,"insertVersionDirective",void 0),this.minLinesBetweenSyncMarks=t.minSyncLines||100,this.insertVersionDirective=!1!==t.insertVersionDirective}return X(e,[{key:"transform",value:function(e,t){!this.haveWeEmittedData&&this.insertVersionDirective&&(!("directive"in e)||"directive"in e&&"gff-version"!==e.directive)&&t.enqueue("##gff-version 3\n"),"sequence"in e&&!this.fastaMode&&(t.enqueue("##FASTA\n"),this.fastaMode=!0);var n=Array.isArray(e)?e.map((function(e){return(0,zd.formatItem)(e)})).join(""):(0,zd.formatItem)(e);if(t.enqueue(n),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)t.enqueue("###\n"),this.linesSinceLastSyncMark=0;else{for(var r=0,a=0;a<n.length;a+=1)"\n"===n[a]&&(r+=1);this.linesSinceLastSyncMark+=r}this.haveWeEmittedData=!0}}]),e}();async function Vd(e,t,n){const r=wd.parseStringSync(t,{parseSequences:!0,parseComments:!0,parseDirectives:!1,parseFeatures:!0});if(0===r.length)throw new Error("No features found in GFF3 file");let a=0,o=n.assemblies.get(e);o||(o=n.addAssembly(e,"InMemoryFileDriver"));for(const e of r)if(Array.isArray(e)){const t=Xn.gff3ToAnnotationFeature(e),n=o.refSeqs.get(t.refSeq)??o.addRefSeq(t.refSeq,t.refSeq);n.features.has(t._id)||n.addFeature(t)}else if("comment"in e)o.addComment(e.comment);else{a++;let t=o.refSeqs.get(e.id);t||(t=o.addRefSeq(e.id,e.id,e.description)),e.description&&!t.description&&t.setDescription(e.description),t.addSequence({start:0,stop:e.sequence.length,sequence:e.sequence})}if(0===a)throw new Error("No embedded FASTA section found in GFF3");const i=await Wd(o);return n.addCheckResults(i),o}async function Wd(e){const t=[];for(const n of e.refSeqs.values())for(const e of n.features.values())for(const a of L.checkRegistry.getChecks().values()){const o=await a.checkFeature(r.getSnapshot(e),((e,t)=>Promise.resolve(n.getSequence(e,t))));t.push(...o)}return t}function Jd(e){const{attributes:t}=e,n=t.get("gff_name");return n?n[0]:""}function Yd(e){const{attributes:t}=e,n=t.get("gff_id"),r=t.get("transcript_id"),a=t.get("exon_id"),o=t.get("protein_id");return n?n[0]:r?r[0]:a?a[0]:o?o[0]:""}function Kd(e){const t=Jd(e),n=Yd(e);return t?`: ${t}`:n?`: ${n}`:""}function Zd(e,t,n=!1){const r=[];r.push(e);for(const t of function(e){const t=[];let{parent:n}=e;for(;n;)t.push(n),({parent:n}=n);return t}(e))r.push(t);const a=function(e){const t=[];if(e.children)for(const[,n]of e.children)t.push(n);return t}(e);for(const e of a)e.min<t&&e.max>=t&&r.push(e);if(!n)return r;if(e.parent){const n=e.parent.children;if(n)for(const[,a]of n)a._id!=e._id&&a.min<t&&a.max>=t&&r.push(a)}return r}xd.GFFFormattingTransformer=$d,function(e){var t=M&&M.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=M&&M.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=M&&M.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},e(t)};return function(r){if(r&&r.__esModule)return r;var a={};if(null!=r)for(var o=e(r),i=0;i<o.length;i++)"default"!==o[i]&&t(a,r,o[i]);return n(a,r),a}}(),a=M&&M.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.util=e.defaultExport=void 0;var o=r(xd);a(xd,e);var i=r(Ed);e.defaultExport=$($({},o),{},{util:i}),e.default=e.defaultExport,e.util=r(Ed)}(wd);var Xd=s.createSvgIcon(i.jsx("path",{d:"m7.58 16.89 5.77-4.07c.56-.4.56-1.24 0-1.63L7.58 7.11C6.91 6.65 6 7.12 6 7.93v8.14c0 .81.91 1.28 1.58.82M16 7v10c0 .55.45 1 1 1s1-.45 1-1V7c0-.55-.45-1-1-1s-1 .45-1 1"}),"SkipNextRounded"),Qd=s.createSvgIcon(i.jsx("path",{d:"M7 6c.55 0 1 .45 1 1v10c0 .55-.45 1-1 1s-1-.45-1-1V7c0-.55.45-1 1-1m3.66 6.82 5.77 4.07c.66.47 1.58-.01 1.58-.82V7.93c0-.81-.91-1.28-1.58-.82l-5.77 4.07c-.57.4-.57 1.24 0 1.64"}),"SkipPreviousRounded");function ef(e,t){if(e.apolloDragging)return;e.setSelectedFeature(t);const{session:n}=e,{apolloDataStore:r}=n,{featureTypeOntology:a}=r.ontologyManager;if(!a)throw new Error("featureTypeOntology is undefined");let o=!1;for(const[,e]of t.children??[])if(a.isTypeOf(e.type,"CDS")||a.isTypeOf(e.type,"exon")){o=!0;break}(a.isTypeOf(t.type,"transcript")||a.isTypeOf(t.type,"pseudogenic_transcript"))&&o?e.showFeatureDetailsWidget(t,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(t)}function tf(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")}function nf(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"exon")}function rf(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"CDS")}function af(e,t,r,a){const o=n.getContainingView(t),i=r.bp-o.bpPerPx*r.x,s=i+o.coarseTotalBp;if(!e.parent)return{upstream:void 0,downstream:void 0};const l=e.parent;if(!l.children)throw new Error(`Error getting children of ${l._id}`);const{featureTypeOntology:c}=a.apolloDataStore.ontologyManager;if(!c)throw new Error("featureTypeOntology is undefined");let u=[];for(const[,e]of l.children)c.isTypeOf(e.type,"exon")&&u.push(e);const d={upstream:void 0,downstream:void 0};u=u.sort(((e,t)=>e.min<t.min?-1:1));for(const e of u)if(e.min>s){d.downstream=e;break}u=u.sort(((e,t)=>e.min>t.min?-1:1));for(const e of u)if(e.max<i){d.upstream=e;break}if(-1===l.strand){const e=d.downstream;d.downstream=d.upstream,d.upstream=e}return d}function of(e,t,n){let r=Xd;return-1===e&&(r=Qd),t&&(r=r===Qd?Xd:Qd),n&&(r=r===Qd?Xd:Qd),r}function sf(e,t,n,r){const a=r.bpToPx({refName:t,coord:e.min,regionNumber:n}),o=r.bpToPx({refName:t,coord:e.max,regionNumber:n});if(void 0===a||void 0===o)return;const{offsetPx:i}=r;return[a.offsetPx-i,o.offsetPx-i]}function lf(e,t,n){const[r,a]=n;if(!(Math.abs(a-r)<8))return Math.abs(r-t)<4?{feature:e,edge:"min"}:Math.abs(a-t)<4?{feature:e,edge:"max"}:void 0}function cf(e,t){return Boolean(t&&e._id===t._id)}function uf(e,t){return!!t&&(e._id===t._id||e.hasDescendant(t._id))}function df(e){let t;t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id;const n=`(${(e.min+1).toLocaleString("en")}..${e.max.toLocaleString("en")})`;if(t&&t.length+n.length>65){const e=60-n.length;t=e>0?t.slice(0,e):"",t=`${t}[...]`}return`${t} ${n}`}function ff(e,t){const{apolloInternetAccount:r,changeManager:a,regions:o,selectedFeature:i,session:s}=e,l=[],c=r?r.role:"admin",u="admin"===c,d=!(c&&["admin","user"].includes(c)),[f]=o,p=e.getAssemblyId(f.assemblyName),h=e.getAssemblyId(f.assemblyName);return l.push({label:df(t),type:"subHeader"},{label:"Add child feature",disabled:d,onClick:()=>{s.queueDialog((e=>[FT,{session:s,handleClose:()=>{e()},changeManager:a,sourceFeature:t,sourceAssemblyId:p,internetAccount:r}]))}},{label:"Copy features and annotations",disabled:d,onClick:()=>{s.queueDialog((e=>[GT,{session:s,handleClose:()=>{e()},changeManager:a,sourceFeature:t,sourceAssemblyId:h}]))}},{label:"Delete feature",disabled:!u,onClick:()=>{s.queueDialog((n=>[$T,{session:s,handleClose:()=>{n()},changeManager:a,sourceFeature:t,sourceAssemblyId:h,selectedFeature:i,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),n.isSessionModelWithWidgets(s)&&l.push({label:"Open feature details",onClick:()=>{const e=s.addWidget("ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget",{feature:t,assembly:h,refName:f.refName});s.showWidget(e)}}),l}function pf(e,t,n){const r=(e.max-e.min)*t,a=Math.max(e.min-r,1),o=Math.min(e.max+r,n);return{refName:e.refSeq,start:a,end:o}}function hf(e,t,n){const r=[{featureId:e._id,oldLocation:e[n],newLocation:t}],{parent:a}=e;return a&&("min"===n&&a[n]>t||"max"===n&&a[n]<t)&&r.push(...hf(a,t,n)),r}function mf(e,t,n,r,a){const o=e._id,i=[{featureId:o,oldLocation:e[n],newLocation:t}],{parent:s,children:l}=e;if(l)for(const[,e]of l)e._id!==a&&("min"===n&&e[n]<t||"max"===n&&e[n]>t)&&i.push(...mf(e,t,n,r));if(s&&r){const e=[];if(s.children)for(const[,t]of s.children)t._id!==o&&e.push(t);if(0===e.length)i.push(...mf(s,t,n,r,o));else{const a=s[n],l=Math[n](...e.map((e=>e[n])),t);l!==a&&i.push(...mf(s,l,n,r,o))}}return i}function gf(e,t,n,r=!1){const a=e[n];if(t===a)throw new Error(`New and existing locations are the same: "${t}"`);return"min"===n?t>a?mf(e,t,n,r):hf(e,t,n):t<a?mf(e,t,n,r):hf(e,t,n)}function yf(e){return"feature"in e}function vf(e,t){const n=e.currentTarget,{clientX:r,clientY:a}=e,{left:o,top:i}=n.getBoundingClientRect(),s=r-o,l=a-i,{coord:c,index:u,refName:d}=t.pxToBp(s);return{x:s,y:l,refName:d,bp:c,regionNumber:u}}async function bf(e,t){let n;try{n=await e.text()}catch{n=""}return`${t?`${t}  `:""}${e.status} ${e.statusText}${n?` (${n})`:""}`}var _f=s.createSvgIcon(i.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");const wf=d.makeStyles()((e=>({dialogTitle:{background:e.palette.primary.main,color:e.palette.primary.contrastText,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1.5),color:e.palette.primary.contrastText}}))),xf=h.observer((function(e){const{classes:t}=wf(),{handleClose:n,title:r,...a}=e;return T.default.createElement(p.Dialog,{...a,header:T.default.createElement(T.default.Fragment,null,T.default.createElement(l.DialogTitle,{className:t.dialogTitle},r),T.default.createElement(l.IconButton,{"aria-label":"close",onClick:n,className:t.closeButton},T.default.createElement(_f,null)))})}));var Sf;!function(e){e.GFF3="text/x-gff3",e.FASTA="text/x-fasta",e.BGZIP_FASTA="application/x-bgzip-fasta",e.FAI="text/x-fai",e.GZI="application/x-gzi",e.EXTERNAL="text/x-external"}(Sf||(Sf={}));const Ef=d.makeStyles()((e=>({accordion:{border:`1px solid ${e.palette.divider}`,"&:not(:last-child)":{borderBottom:0}},accordionSummary:{flexDirection:"row-reverse"},accordionDetails:{padding:e.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"},radioIcon:{color:e.palette.tertiary.contrastText},dialog:{minWidth:550,maxWidth:800}})));function kf(e,t,n,r,a,o,i,s,l){return!(!e||!(t&&r||n===Sf.GFF3&&r||r&&a&&o||i&&s&&l))}function Cf({changeManager:e,handleClose:t,session:n}){const{classes:o}=Ef(),{internetAccounts:i}=r.getRoot(n),{notify:s}=n,c=i.filter((e=>"ApolloInternetAccount"===e.type));if(0===c.length)throw new Error("No Apollo internet account found");const[d,f]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(!1),[y,v]=u.useState(Sf.BGZIP_FASTA),[b,_]=u.useState(!0),[w,x]=u.useState(!1),[S,E]=u.useState(!1),[k,C]=u.useState(null),[A,O]=u.useState(null),[N,I]=u.useState(null),[R,F]=u.useState(""),[P,M]=u.useState(""),[D,j]=u.useState(""),[L,q]=u.useState(!1),[B,U]=u.useState(!1),[z,G]=u.useState(!1);async function H(e,t){const{jobsManager:r}=n,a=new AbortController,[{baseURL:o,getFetcher:i}]=c,s=new URL("files",o);s.searchParams.set("type",t);const l=s.href,u=new FormData;let f=e.name;const p=t===Sf.BGZIP_FASTA||t===Sf.FASTA&&(!w||B)||t===Sf.GFF3&&z;p&&!e.name.toLocaleLowerCase().endsWith(".gz")?f=`${f}.gz`:!p&&e.name.toLocaleLowerCase().endsWith(".gz")&&(f=`${f}.txt`),u.append("file",e,f),u.append("type",t);const m=i({locationType:"UriLocation",uri:l});if(m){const t={name:`UploadAssemblyFile for ${d}`,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{a.abort("AddAssembly"),r.abortJob(t.name)}};r.runJob(t),r.update(t.name,`Uploading ${e.name}, this may take awhile`);const{signal:n}=a,o=await m(l,{method:"POST",body:u,signal:n});if(!o.ok){const e=await bf(o,"Error when inserting new assembly (while uploading file)");return r.abortJob(t.name,e),h(e),""}const i=(await o.json())._id;return r.done(t),i}throw new Error("Failed to fetch")}let $=!1;try{const e=new URL(R);"http:"!==e.protocol&&"https:"!==e.protocol||($=!0)}catch{}let V=!1;try{const e=new URL(P);"http:"!==e.protocol&&"https:"!==e.protocol||(V=!0)}catch{}let W=!1;try{const e=new URL(D);"http:"!==e.protocol&&"https:"!==e.protocol||(W=!0)}catch{}const[J,Y]=T.default.useState("panelFastaInput"),K=e=>(t,n)=>{n&&Y(e)};return T.default.createElement(xf,{open:!0,handleClose:t,"data-testid":"add-assembly-dialog",title:"Add new assembly",maxWidth:!1},T.default.createElement("form",{onSubmit:async function(n){let r;if(n.preventDefault(),h(""),E(!0),q(!0),s(`Assembly "${d}" is being added`,"info"),t(),n.preventDefault(),y===Sf.EXTERNAL)r=new Xn.AddAssemblyFromExternalChange({typeName:"AddAssemblyFromExternalChange",assembly:(new Hn).toHexString(),assemblyName:d,externalLocation:{fa:R,fai:P,gzi:D}});else{if(!k)throw new Error("Missing fasta file");if(y===Sf.GFF3&&b){const e=await H(k,Sf.GFF3);r=new Xn.AddAssemblyAndFeaturesFromFileChange({typeName:"AddAssemblyAndFeaturesFromFileChange",assembly:(new Hn).toHexString(),assemblyName:d,fileIds:{fa:e}})}else if(y===Sf.GFF3){const e=await H(k,Sf.GFF3);r=new Xn.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Hn).toHexString(),assemblyName:d,fileIds:{fa:e}})}else if(w){const e=await H(k,Sf.FASTA);r=new Xn.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Hn).toHexString(),assemblyName:d,fileIds:{fa:e}})}else{if(!A||!N)throw new Error("Missing fasta index files");const e=await H(k,Sf.BGZIP_FASTA),t=await H(A,Sf.FAI),n=await H(N,Sf.GZI);r=new Xn.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Hn).toHexString(),assemblyName:d,fileIds:{fa:e,fai:t,gzi:n}})}}const[{internetAccountId:a}]=c;await e.submit(r,{internetAccountId:a,updateJobsManager:!0}),E(!1),q(!1)},"data-testid":"submit-form"},T.default.createElement(l.DialogContent,{className:o.dialog},L?T.default.createElement(l.LinearProgress,null):null,T.default.createElement(l.TextField,{margin:"dense",id:"name",label:"Assembly name",type:"TextField",fullWidth:!0,variant:"outlined",onChange:e=>{E(!1),f(e.target.value),function(e){const{assemblies:t}=n;t.find((t=>a.readConfObject(t,"displayName")===e))?(g(!1),h(`Assembly ${e} already exists.`)):(g(!0),h(""))}(e.target.value)},disabled:S&&!p}),T.default.createElement(l.Accordion,{disableGutters:!0,elevation:0,square:!0,className:o.accordion,expanded:"panelFastaInput"===J,onChange:K("panelFastaInput")},T.default.createElement(l.AccordionSummary,{className:o.accordionSummary,expandIcon:"panelFastaInput"===J?T.default.createElement(bd,{className:o.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):T.default.createElement(_d,{className:o.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelFastaInputd-content",id:"panelFastaInputd-header"},T.default.createElement(l.Typography,{component:"span"},"FASTA input")),T.default.createElement(l.AccordionDetails,{className:o.accordionDetails},T.default.createElement(l.FormGroup,null,T.default.createElement(l.FormControlLabel,{"data-testid":"files-on-url-checkbox",control:T.default.createElement(l.Checkbox,{onChange:()=>{v(y===Sf.EXTERNAL?Sf.BGZIP_FASTA:Sf.EXTERNAL),y===Sf.EXTERNAL&&x(!1)},checked:y===Sf.EXTERNAL,disabled:w&&y!==Sf.GFF3}),label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},"Use external URLs",T.default.createElement(l.Tooltip,{title:"Use external URLs to provide FASTA and index files. Does not copy the files to the Apollo collaboration server, so ensure the URLs are stable.",placement:"top-start"},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))}),T.default.createElement(l.FormControlLabel,{"data-testid":"sequence-is-editable-checkbox",control:T.default.createElement(l.Checkbox,{onChange:()=>{x(!w)}}),checked:w,disabled:y===Sf.EXTERNAL,label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},"Store sequence in database",T.default.createElement(l.Tooltip,{title:"Enables users to edit the genomic sequence, but comes with performance impacts. Use with care.",placement:"top-start"},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))}),T.default.createElement(l.FormControlLabel,{"data-testid":"fasta-is-gzip-checkbox",control:T.default.createElement(l.Checkbox,{checked:!w||B,onChange:()=>{U(!w||!B)},disabled:!w}),label:"FASTA is gzip compressed"}),T.default.createElement(l.Table,{size:"small",sx:{mt:2}},y===Sf.BGZIP_FASTA||y===Sf.GFF3?T.default.createElement(l.TableBody,null,T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement(l.Box,{display:"flex",alignItems:"center"},T.default.createElement("span",null,"FASTA"),T.default.createElement(l.Tooltip,{title:'Unless "Store sequence in database" enabled, FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent). Compression is optional for sequences stored in the database.'},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement("input",{"data-testid":"fasta-input-file",type:"file",onChange:e=>{const t=e.target.files?.item(0);t&&(C(t),t.name.endsWith(".gz")&&U(!0))},disabled:S&&!p}))),T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement("input",{"data-testid":"fai-input-file",type:"file",onChange:e=>{O(e.target.files?.item(0)??null)},disabled:S&&!p||w}))),T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement("input",{"data-testid":"gzi-input-file",type:"file",onChange:e=>{I(e.target.files?.item(0)??null)},disabled:S&&!p||w})))):T.default.createElement(l.TableBody,null,T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement(l.Box,{display:"flex",alignItems:"center"},T.default.createElement("span",null,"FASTA"),T.default.createElement(l.Tooltip,{title:"Remote FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent)"},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement(l.TextField,{"data-testid":"fasta-input-url",variant:"outlined",value:R,error:!$,onChange:e=>{const{value:t}=e.target;F(t),M(t?`${t}.fai`:""),j(t?`${t}.gzi`:"")},disabled:S&&!p,slotProps:{input:{startAdornment:T.default.createElement(l.InputAdornment,{position:"start"},T.default.createElement(vd,null))}}}))),T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement(l.TextField,{"data-testid":"fai-input-url",variant:"outlined",value:P,error:!V,onChange:e=>{M(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:T.default.createElement(l.InputAdornment,{position:"start"},T.default.createElement(vd,null))}}}))),T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),T.default.createElement(l.TableCell,{style:{borderBottomWidth:0}},T.default.createElement(l.TextField,{"data-testid":"gzi-input-url",variant:"outlined",value:D,error:!W,onChange:e=>{j(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:T.default.createElement(l.InputAdornment,{position:"start"},T.default.createElement(vd,null))}}})))))))),T.default.createElement(l.Accordion,{disableGutters:!0,elevation:0,square:!0,className:o.accordion,expanded:"panelGffInput"===J,onChange:K("panelGffInput")},T.default.createElement(l.AccordionSummary,{className:o.accordionSummary,expandIcon:"panelGffInput"===J?T.default.createElement(bd,{className:o.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):T.default.createElement(_d,{className:o.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelGffInputd-content"},T.default.createElement(l.Typography,{component:"span"},"GFF3 input",T.default.createElement(l.Tooltip,{title:"GFF3 must includes FASTA sequences. File can be gzip compressed."},T.default.createElement(yd,{className:o.radioIcon,sx:{fontSize:18}})))),T.default.createElement(l.AccordionDetails,{className:o.accordionDetails},T.default.createElement(l.Box,{style:{marginTop:20}},T.default.createElement("input",{"data-testid":"gff3-input-file",type:"file",disabled:S&&!p,onChange:e=>{const t=e.target.files?.item(0);t&&(C(t),v(Sf.GFF3),t.name.endsWith(".gz")&&G(!0))}}),T.default.createElement(l.FormGroup,{style:{display:"grid"}},T.default.createElement(l.FormControlLabel,{control:T.default.createElement(l.Checkbox,{checked:b,onChange:()=>{_(!b)},disabled:S&&!p}),label:"Load features from GFF3 file"}),T.default.createElement(l.FormControlLabel,{"data-testid":"gff3-is-gzip-checkbox",control:T.default.createElement(l.Checkbox,{checked:z,onChange:()=>{G(!z)},disabled:S&&!p}),label:"GFF3 is gzip compressed"})))))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!kf(m,w,y,k,A,N,$,V,W)||S,variant:"contained",type:"submit","data-testid":"submit-button"},S?"Submitting...":"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},p)):null)}const Af=[{field:"name",headerName:"Assembly Name",width:150,editable:!1},{field:"aliases",headerName:"Aliases",width:300,editable:!0}];function Of({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:r}=n,{collaborationServerDriver:a}=r,o=a.getAssemblies().map((e=>({id:e.name,name:e.displayName,aliases:e.aliases.join(", ")}))),[i,s]=T.default.useState("");return T.default.createElement(xf,{open:!0,title:"Add assembly aliases",handleClose:t,maxWidth:"sm","data-testid":"add-assembly-alias",fullWidth:!0},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.Box,{sx:{height:400,width:"100%"}},T.default.createElement(f.DataGrid,{rows:o,columns:Af,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5],processRowUpdate:(n,r)=>{const a=new Xn.AddAssemblyAliasesChange({typeName:"AddAssemblyAliasesChange",assembly:n.id,aliases:n.aliases.split(",")});return e.submit(a).catch((()=>{s("Error submitting change")})),t(),n},disableRowSelectionOnClick:!0}))),i?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},i)):null)}var Tf,Nf,If=function(e,t){return t.some((function(t){return e instanceof t}))},Rf=new WeakMap,Ff=new WeakMap,Pf=new WeakMap,Mf=new WeakMap,Df=new WeakMap,jf={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Ff.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Pf.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return qf(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Lf(e){jf=e(jf)}function qf(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var r=function(){t.removeEventListener("success",a),t.removeEventListener("error",o)},a=function(){e(qf(t.result)),r()},o=function(){n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&Rf.set(e,t)})).catch((function(){})),Df.set(n,t),n;var t,n;if(Mf.has(e))return Mf.get(e);var r=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Nf||(Nf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(Bf(this),n),qf(Rf.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return qf(t.apply(Bf(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=t.call.apply(t,[Bf(this),e].concat(r));return Pf.set(o,e.sort?e.sort():[e]),qf(o)}:(e instanceof IDBTransaction&&function(e){if(!Ff.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=function(){t(),r()},o=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)}));Ff.set(e,t)}}(e),If(e,Tf||(Tf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,jf):e);var t}(e);return r!==e&&(Mf.set(e,r),Df.set(r,e)),r}var Bf=function(e){return Df.get(e)},Uf=["get","getKey","getAll","getAllKeys","count"],zf=["put","add","delete","clear"],Gf=new Map;function Hf(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Gf.get(t))return Gf.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=zf.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||Uf.includes(n))){var o=function(){var e=Y(V().mark((function e(t){var o,i,s,l,c,u,d=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=this.transaction(t,a?"readwrite":"readonly"),s=i.store,l=d.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=d[u];return r&&(s=s.index(c.shift())),e.next=6,Promise.all([(o=s)[n].apply(o,c),a&&i.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return Gf.set(t,o),o}}}Lf((function(e){return $($({},e),{},{get:function(t,n,r){return Hf(t,n)||e.get(t,n,r)},has:function(t,n){return!!Hf(t,n)||e.has(t,n)}})}));var $f=["continue","continuePrimaryKey","advance"],Vf={},Wf=new WeakMap,Jf=new WeakMap,Yf={get:function(e,t){if(!$f.includes(t))return e[t];var n=Vf[t];return n||(n=Vf[t]=function(){var e;Wf.set(this,(e=Jf.get(this))[t].apply(e,arguments))}),n}};function Kf(){return Zf.apply(this,arguments)}function Zf(){var e;return e=V().mark((function e(){var t,n,r,a=arguments;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)instanceof IDBCursor){e.next=5;break}return e.next=4,G((n=t).openCursor.apply(n,a));case 4:t=e.sent;case 5:if(t){e.next=7;break}return e.abrupt("return");case 7:r=new Proxy(t,Yf),Jf.set(r,t),Df.set(r,Bf(t));case 11:if(!t){e.next=20;break}return e.next=14,r;case 14:return e.next=16,G(Wf.get(r)||t.continue());case 16:t=e.sent,Wf.delete(r),e.next=11;break;case 20:case"end":return e.stop()}}),e,this)})),Zf=function(){return new q(e.apply(this,arguments))},Zf.apply(this,arguments)}function Xf(e,t){return t===Symbol.asyncIterator&&If(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&If(e,[IDBIndex,IDBObjectStore])}Lf((function(e){return $($({},e),{},{get:function(t,n,r){return Xf(t,n)?Kf:e.get(t,n,r)},has:function(t,n){return Xf(t,n)||e.has(t,n)}})}));var Qf={},ep={},tp={},np={},rp={};Object.defineProperty(rp,"__esModule",{value:!0}),rp.isFunction=void 0,rp.isFunction=function(e){return"function"==typeof e};var ap={},op={},ip={};Object.defineProperty(ip,"__esModule",{value:!0}),ip.createErrorClass=void 0,ip.createErrorClass=function(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t},Object.defineProperty(op,"__esModule",{value:!0}),op.UnsubscriptionError=void 0,op.UnsubscriptionError=ip.createErrorClass((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));var sp={};Object.defineProperty(sp,"__esModule",{value:!0}),sp.arrRemove=void 0,sp.arrRemove=function(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}};var lp=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},cp=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},up=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(ap,"__esModule",{value:!0}),ap.isSubscription=ap.EMPTY_SUBSCRIPTION=ap.Subscription=void 0;var dp=rp,fp=op,pp=sp,hp=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=lp(o),s=i.next();!s.done;s=i.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(dp.isFunction(l))try{l()}catch(e){a=e instanceof fp.UnsubscriptionError?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=lp(c),d=u.next();!d.done;d=u.next()){var f=d.value;try{mp(f)}catch(e){a=null!=a?a:[],e instanceof fp.UnsubscriptionError?a=up(up([],cp(a)),cp(e.errors)):a.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(a)throw new fp.UnsubscriptionError(a)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)mp(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&pp.arrRemove(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&pp.arrRemove(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();function mp(e){dp.isFunction(e)?e():e.unsubscribe()}ap.Subscription=hp,ap.EMPTY_SUBSCRIPTION=hp.EMPTY,ap.isSubscription=function(e){return e instanceof hp||e&&"closed"in e&&dp.isFunction(e.remove)&&dp.isFunction(e.add)&&dp.isFunction(e.unsubscribe)};var gp={};Object.defineProperty(gp,"__esModule",{value:!0}),gp.config=void 0,gp.config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var yp={},vp={};!function(e){var t=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.timeoutProvider=void 0,e.timeoutProvider={setTimeout:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.timeoutProvider.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,n([r,a],t(o))):setTimeout.apply(void 0,n([r,a],t(o)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.timeoutProvider.delegate;return((null==n?void 0:n.clearTimeout)||clearTimeout)(t)})),delegate:void 0}}(vp),Object.defineProperty(yp,"__esModule",{value:!0}),yp.reportUnhandledError=void 0;var bp=gp,_p=vp;yp.reportUnhandledError=function(e){_p.timeoutProvider.setTimeout((function(){var t=bp.config.onUnhandledError;if(!t)throw e;t(e)}))};var wp={};Object.defineProperty(wp,"__esModule",{value:!0}),wp.noop=void 0,wp.noop=function(){};var xp={};function Sp(e,t,n){return{kind:e,value:t,error:n}}Object.defineProperty(xp,"__esModule",{value:!0}),xp.createNotification=xp.nextNotification=xp.errorNotification=xp.COMPLETE_NOTIFICATION=void 0,xp.COMPLETE_NOTIFICATION=function(){return Sp("C",void 0,void 0)}(),xp.errorNotification=function(e){return Sp("E",void 0,e)},xp.nextNotification=function(e){return Sp("N",e,void 0)},xp.createNotification=Sp;var Ep={};Object.defineProperty(Ep,"__esModule",{value:!0}),Ep.captureError=Ep.errorContext=void 0;var kp=gp,Cp=null;Ep.errorContext=function(e){if(kp.config.useDeprecatedSynchronousErrorHandling){var t=!Cp;if(t&&(Cp={errorThrown:!1,error:null}),e(),t){var n=Cp;if(Cp=null,n.errorThrown)throw n.error}}else e()},Ep.captureError=function(e){kp.config.useDeprecatedSynchronousErrorHandling&&Cp&&(Cp.errorThrown=!0,Cp.error=e)},function(e){var t=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EMPTY_OBSERVER=e.SafeSubscriber=e.Subscriber=void 0;var n=rp,r=ap,a=gp,o=yp,i=wp,s=xp,l=vp,c=Ep,u=function(n){function a(t){var a=n.call(this)||this;return a.isStopped=!1,t?(a.destination=t,r.isSubscription(t)&&t.add(a)):a.destination=e.EMPTY_OBSERVER,a}return t(a,n),a.create=function(e,t,n){return new h(e,t,n)},a.prototype.next=function(e){this.isStopped?g(s.nextNotification(e),this):this._next(e)},a.prototype.error=function(e){this.isStopped?g(s.errorNotification(e),this):(this.isStopped=!0,this._error(e))},a.prototype.complete=function(){this.isStopped?g(s.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},a.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},a.prototype._next=function(e){this.destination.next(e)},a.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},a.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},a}(r.Subscription);e.Subscriber=u;var d=Function.prototype.bind;function f(e,t){return d.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){m(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){m(e)}else m(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){m(e)}},e}(),h=function(e){function r(t,r,o){var i,s,l=e.call(this)||this;return n.isFunction(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:l&&a.config.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},i={next:t.next&&f(t.next,s),error:t.error&&f(t.error,s),complete:t.complete&&f(t.complete,s)}):i=t,l.destination=new p(i),l}return t(r,e),r}(u);function m(e){a.config.useDeprecatedSynchronousErrorHandling?c.captureError(e):o.reportUnhandledError(e)}function g(e,t){var n=a.config.onStoppedNotification;n&&l.timeoutProvider.setTimeout((function(){return n(e,t)}))}e.SafeSubscriber=h,e.EMPTY_OBSERVER={closed:!0,next:i.noop,error:function(e){throw e},complete:i.noop}}(np);var Ap={};Object.defineProperty(Ap,"__esModule",{value:!0}),Ap.observable=void 0,Ap.observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();var Op={},Tp={};Object.defineProperty(Tp,"__esModule",{value:!0}),Tp.identity=void 0,Tp.identity=function(e){return e},Object.defineProperty(Op,"__esModule",{value:!0}),Op.pipeFromArray=Op.pipe=void 0;var Np=Tp;function Ip(e){return 0===e.length?Np.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}Op.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ip(e)},Op.pipeFromArray=Ip,Object.defineProperty(tp,"__esModule",{value:!0}),tp.Observable=void 0;var Rp=np,Fp=ap,Pp=Ap,Mp=Op,Dp=gp,jp=rp,Lp=Ep,qp=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,a=function(e){return e&&e instanceof Rp.Subscriber||function(e){return e&&jp.isFunction(e.next)&&jp.isFunction(e.error)&&jp.isFunction(e.complete)}(e)&&Fp.isSubscription(e)}(e)?e:new Rp.SafeSubscriber(e,t,n);return Lp.errorContext((function(){var e=r.operator,t=r.source;a.add(e?e.call(a,t):t?r._subscribe(a):r._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Bp(t))((function(t,r){var a=new Rp.SafeSubscriber({next:function(t){try{e(t)}catch(e){r(e),a.unsubscribe()}},error:r,complete:t});n.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Pp.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Mp.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Bp(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Bp(e){var t;return null!==(t=null!=e?e:Dp.config.Promise)&&void 0!==t?t:Promise}tp.Observable=qp;var Up={},zp={},Gp={};Object.defineProperty(Gp,"__esModule",{value:!0}),Gp.operate=Gp.hasLift=void 0;var Hp=rp;function $p(e){return Hp.isFunction(null==e?void 0:e.lift)}Gp.hasLift=$p,Gp.operate=function(e){return function(t){if($p(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}};var Vp={},Wp=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Vp,"__esModule",{value:!0}),Vp.OperatorSubscriber=Vp.createOperatorSubscriber=void 0;var Jp=np;Vp.createOperatorSubscriber=function(e,t,n,r,a){return new Yp(e,t,n,r,a)};var Yp=function(e){function t(t,n,r,a,o,i){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=i,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return Wp(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Jp.Subscriber);Vp.OperatorSubscriber=Yp,Object.defineProperty(zp,"__esModule",{value:!0}),zp.refCount=void 0;var Kp=Gp,Zp=Vp;zp.refCount=function(){return Kp.operate((function(e,t){var n=null;e._refCount++;var r=Zp.createOperatorSubscriber(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,a=n;n=null,!r||a&&r!==a||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))};var Xp=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Up,"__esModule",{value:!0}),Up.ConnectableObservable=void 0;var Qp=ap,eh=zp,th=Vp,nh=Gp,rh=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,nh.hasLift(t)&&(r.lift=t.lift),r}return Xp(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new Qp.Subscription;var n=this.getSubject();t.add(this.source.subscribe(th.createOperatorSubscriber(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=Qp.Subscription.EMPTY)}return t},t.prototype.refCount=function(){return eh.refCount()(this)},t}(tp.Observable);Up.ConnectableObservable=rh;var ah={},oh={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.performanceTimestampProvider=void 0,e.performanceTimestampProvider={now:function(){return(e.performanceTimestampProvider.delegate||performance).now()},delegate:void 0}}(oh);var ih={};!function(e){var t=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrameProvider=void 0;var r=ap;e.animationFrameProvider={schedule:function(t){var n=requestAnimationFrame,a=cancelAnimationFrame,o=e.animationFrameProvider.delegate;o&&(n=o.requestAnimationFrame,a=o.cancelAnimationFrame);var i=n((function(e){a=void 0,t(e)}));return new r.Subscription((function(){return null==a?void 0:a(i)}))},requestAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.requestAnimationFrame)||requestAnimationFrame).apply(void 0,n([],t(r)))})),cancelAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,n([],t(r)))})),delegate:void 0}}(ih),Object.defineProperty(ah,"__esModule",{value:!0}),ah.animationFrames=void 0;var sh=tp,lh=oh,ch=ih;function uh(e){return new sh.Observable((function(t){var n=e||lh.performanceTimestampProvider,r=n.now(),a=0;return function o(){t.closed||(a=ch.animationFrameProvider.requestAnimationFrame((function(i){a=0;var s=n.now();t.next({timestamp:e?s:i,elapsed:s-r}),o()})))}(),function(){a&&ch.animationFrameProvider.cancelAnimationFrame(a)}}))}ah.animationFrames=function(e){return e?uh(e):dh};var dh=uh(),fh={},ph={};Object.defineProperty(ph,"__esModule",{value:!0}),ph.ObjectUnsubscribedError=void 0,ph.ObjectUnsubscribedError=ip.createErrorClass((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}));var hh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mh=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(fh,"__esModule",{value:!0}),fh.AnonymousSubject=fh.Subject=void 0;var gh=tp,yh=ap,vh=ph,bh=sp,_h=Ep,wh=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return hh(t,e),t.prototype.lift=function(e){var t=new xh(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new vh.ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;_h.errorContext((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var a=mh(t.currentObservers),o=a.next();!o.done;o=a.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;_h.errorContext((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;_h.errorContext((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.observers;return n.hasError||n.isStopped?yh.EMPTY_SUBSCRIPTION:(this.currentObservers=null,r.push(e),new yh.Subscription((function(){t.currentObservers=null,bh.arrRemove(r,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.isStopped;t.hasError?e.error(t.thrownError):n&&e.complete()},t.prototype.asObservable=function(){var e=new gh.Observable;return e.source=this,e},t.create=function(e,t){return new xh(e,t)},t}(gh.Observable);fh.Subject=wh;var xh=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return hh(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:yh.EMPTY_SUBSCRIPTION},t}(wh);fh.AnonymousSubject=xh;var Sh={},Eh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.BehaviorSubject=void 0;var kh=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Eh(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e._value;if(e.hasError)throw e.thrownError;return this._throwIfClosed(),t},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(fh.Subject);Sh.BehaviorSubject=kh;var Ch={},Ah={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dateTimestampProvider=void 0,e.dateTimestampProvider={now:function(){return(e.dateTimestampProvider.delegate||Date).now()},delegate:void 0}}(Ah);var Oh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.ReplaySubject=void 0;var Th=Ah,Nh=function(e){function t(t,n,r){void 0===t&&(t=Infinity),void 0===n&&(n=Infinity),void 0===r&&(r=Th.dateTimestampProvider);var a=e.call(this)||this;return a._bufferSize=t,a._windowTime=n,a._timestampProvider=r,a._buffer=[],a._infiniteTimeWindow=!0,a._infiniteTimeWindow=Infinity===n,a._bufferSize=Math.max(1,t),a._windowTime=Math.max(1,n),a}return Oh(t,e),t.prototype.next=function(t){var n=this,r=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,i=n._windowTime;n.isStopped||(r.push(t),!a&&r.push(o.now()+i)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),a=0;a<r.length&&!e.closed;a+=n?1:2)e.next(r[a]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,a=e._infiniteTimeWindow,o=(a?1:2)*t;if(t<Infinity&&o<r.length&&r.splice(0,r.length-o),!a){for(var i=n.now(),s=0,l=1;l<r.length&&r[l]<=i;l+=2)s=l;s&&r.splice(0,s+1)}},t}(fh.Subject);Ch.ReplaySubject=Nh;var Ih={},Rh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.AsyncSubject=void 0;var Fh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return Rh(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t._hasValue,r=t._value,a=t.isStopped,o=t._isComplete;t.hasError?e.error(t.thrownError):(a||o)&&(n&&e.next(r),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this,n=t._hasValue,r=t._value;t._isComplete||(this._isComplete=!0,n&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(fh.Subject);Ih.AsyncSubject=Fh;var Ph={},Mh={},Dh={},jh={},Lh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(jh,"__esModule",{value:!0}),jh.Action=void 0,jh.Action=function(e){function t(t,n){return e.call(this)||this}return Lh(t,e),t.prototype.schedule=function(e,t){return this},t}(ap.Subscription);var qh={};!function(e){var t=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.intervalProvider=void 0,e.intervalProvider={setInterval:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.intervalProvider.delegate;return(null==s?void 0:s.setInterval)?s.setInterval.apply(s,n([r,a],t(o))):setInterval.apply(void 0,n([r,a],t(o)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.intervalProvider.delegate;return((null==n?void 0:n.clearInterval)||clearInterval)(t)})),delegate:void 0}}(qh);var Bh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.AsyncAction=void 0;var Uh=qh,zh=sp,Gh=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Bh(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(a,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Uh.intervalProvider.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Uh.intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,zh.arrRemove(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(jh.Action);Dh.AsyncAction=Gh;var Hh={},$h={};Object.defineProperty($h,"__esModule",{value:!0}),$h.TestTools=$h.Immediate=void 0;var Vh,Wh=1,Jh={};function Yh(e){return e in Jh&&(delete Jh[e],!0)}$h.Immediate={setImmediate:function(e){var t=Wh++;return Jh[t]=!0,Vh||(Vh=Promise.resolve()),Vh.then((function(){return Yh(t)&&e()})),t},clearImmediate:function(e){Yh(e)}},$h.TestTools={pending:function(){return Object.keys(Jh).length}},function(e){var t=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.immediateProvider=void 0;var r=$h.Immediate.setImmediate,a=$h.Immediate.clearImmediate;e.immediateProvider={setImmediate:function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var i=e.immediateProvider.delegate;return((null==i?void 0:i.setImmediate)||r).apply(void 0,n([],t(a)))},clearImmediate:function(t){var n=e.immediateProvider.delegate;return((null==n?void 0:n.clearImmediate)||a)(t)},delegate:void 0}}(Hh);var Kh=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Mh,"__esModule",{value:!0}),Mh.AsapAction=void 0;var Zh=Hh;Mh.AsapAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Kh(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=Zh.immediateProvider.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(Zh.immediateProvider.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(Dh.AsyncAction);var Xh={},Qh={},em={};Object.defineProperty(em,"__esModule",{value:!0}),em.Scheduler=void 0;var tm=Ah;em.Scheduler=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=tm.dateTimestampProvider.now,e}();var nm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Qh,"__esModule",{value:!0}),Qh.AsyncScheduler=void 0;var rm=em;Qh.AsyncScheduler=function(e){function t(t,n){void 0===n&&(n=rm.Scheduler.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return nm(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(rm.Scheduler);var am=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Xh,"__esModule",{value:!0}),Xh.AsapScheduler=void 0;var om=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return am(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(Qh.AsyncScheduler);Xh.AsapScheduler=om,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.asap=e.asapScheduler=void 0,e.asapScheduler=new Xh.AsapScheduler(Mh.AsapAction),e.asap=e.asapScheduler}(Ph);var im={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.async=e.asyncScheduler=void 0,e.asyncScheduler=new Qh.AsyncScheduler(Dh.AsyncAction),e.async=e.asyncScheduler}(im);var sm={},lm={},cm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(lm,"__esModule",{value:!0}),lm.QueueAction=void 0,lm.QueueAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return cm(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(Dh.AsyncAction);var um={},dm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(um,"__esModule",{value:!0}),um.QueueScheduler=void 0;var fm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dm(t,e),t}(Qh.AsyncScheduler);um.QueueScheduler=fm,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.queue=e.queueScheduler=void 0,e.queueScheduler=new um.QueueScheduler(lm.QueueAction),e.queue=e.queueScheduler}(sm);var pm={},hm={},mm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(hm,"__esModule",{value:!0}),hm.AnimationFrameAction=void 0;var gm=ih;hm.AnimationFrameAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return mm(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=gm.animationFrameProvider.requestAnimationFrame((function(){return t.flush(void 0)}))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(gm.animationFrameProvider.cancelAnimationFrame(n),t._scheduled=void 0)},t}(Dh.AsyncAction);var ym={},vm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ym,"__esModule",{value:!0}),ym.AnimationFrameScheduler=void 0;var bm=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vm(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(Qh.AsyncScheduler);ym.AnimationFrameScheduler=bm,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrame=e.animationFrameScheduler=void 0,e.animationFrameScheduler=new ym.AnimationFrameScheduler(hm.AnimationFrameAction),e.animationFrame=e.animationFrameScheduler}(pm);var _m={},wm=M&&M.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(_m,"__esModule",{value:!0}),_m.VirtualAction=_m.VirtualTimeScheduler=void 0;var xm=Dh,Sm=ap;_m.VirtualTimeScheduler=function(e){function t(t,n){void 0===t&&(t=Em),void 0===n&&(n=Infinity);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return wm(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(Qh.AsyncScheduler);var Em=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var a=e.call(this,t,n)||this;return a.scheduler=t,a.work=n,a.index=r,a.active=!0,a.index=t.index=r,a}return wm(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),Number.isFinite(r)){if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var a=new t(this.scheduler,this.work);return this.add(a),a.schedule(n,r)}return Sm.Subscription.EMPTY},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var a=e.actions;return a.push(this),a.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(xm.AsyncAction);_m.VirtualAction=Em;var km={},Cm={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.empty=e.EMPTY=void 0;var t=tp;e.EMPTY=new t.Observable((function(e){return e.complete()})),e.empty=function(n){return n?function(e){return new t.Observable((function(t){return e.schedule((function(){return t.complete()}))}))}(n):e.EMPTY}}(Cm);var Am={},Om={},Tm={};Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.isScheduler=void 0;var Nm=rp;Tm.isScheduler=function(e){return e&&Nm.isFunction(e.schedule)},Object.defineProperty(Om,"__esModule",{value:!0}),Om.popNumber=Om.popScheduler=Om.popResultSelector=void 0;var Im=rp,Rm=Tm;function Fm(e){return e[e.length-1]}Om.popResultSelector=function(e){return Im.isFunction(Fm(e))?e.pop():void 0},Om.popScheduler=function(e){return Rm.isScheduler(Fm(e))?e.pop():void 0},Om.popNumber=function(e,t){return"number"==typeof Fm(e)?e.pop():t};var Pm={},Mm={},Dm={},jm={},Lm={};Object.defineProperty(Lm,"__esModule",{value:!0}),Lm.isArrayLike=void 0,Lm.isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};var qm={};Object.defineProperty(qm,"__esModule",{value:!0}),qm.isPromise=void 0;var Bm=rp;qm.isPromise=function(e){return Bm.isFunction(null==e?void 0:e.then)};var Um={};Object.defineProperty(Um,"__esModule",{value:!0}),Um.isInteropObservable=void 0;var zm=Ap,Gm=rp;Um.isInteropObservable=function(e){return Gm.isFunction(e[zm.observable])};var Hm={};Object.defineProperty(Hm,"__esModule",{value:!0}),Hm.isAsyncIterable=void 0;var $m=rp;Hm.isAsyncIterable=function(e){return Symbol.asyncIterator&&$m.isFunction(null==e?void 0:e[Symbol.asyncIterator])};var Vm={};Object.defineProperty(Vm,"__esModule",{value:!0}),Vm.createInvalidObservableTypeError=void 0,Vm.createInvalidObservableTypeError=function(e){return new TypeError("You provided "+(null!==e&&"object"===W(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")};var Wm={},Jm={};function Ym(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.iterator=Jm.getSymbolIterator=void 0,Jm.getSymbolIterator=Ym,Jm.iterator=Ym(),Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.isIterable=void 0;var Km=Jm,Zm=rp;Wm.isIterable=function(e){return Zm.isFunction(null==e?void 0:e[Km.iterator])};var Xm={},Qm=M&&M.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},eg=M&&M.__await||function(e){return this instanceof eg?(this.v=e,this):new eg(e)},tg=M&&M.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof eg?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}};Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.isReadableStreamLike=Xm.readableStreamLikeToAsyncGenerator=void 0;var ng=rp;Xm.readableStreamLikeToAsyncGenerator=function(e){return tg(this,arguments,(function(){var t,n,r;return Qm(this,(function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,eg(t.read())];case 3:return n=a.sent(),r=n.value,n.done?[4,eg(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,eg(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))},Xm.isReadableStreamLike=function(e){return ng.isFunction(null==e?void 0:e.getReader)};var rg=M&&M.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ag=M&&M.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},og=M&&M.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof ig?ig(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}},ig=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(jm,"__esModule",{value:!0}),jm.fromReadableStreamLike=jm.fromAsyncIterable=jm.fromIterable=jm.fromPromise=jm.fromArrayLike=jm.fromInteropObservable=jm.innerFrom=void 0;var sg=Lm,lg=qm,cg=tp,ug=Um,dg=Hm,fg=Vm,pg=Wm,hg=Xm,mg=rp,gg=yp,yg=Ap;function vg(e){return new cg.Observable((function(t){var n=e[yg.observable]();if(mg.isFunction(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function bg(e){return new cg.Observable((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function _g(e){return new cg.Observable((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,gg.reportUnhandledError)}))}function wg(e){return new cg.Observable((function(t){var n,r;try{for(var a=ig(e),o=a.next();!o.done;o=a.next())if(t.next(o.value),t.closed)return}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()}))}function xg(e){return new cg.Observable((function(t){(function(e,t){var n,r,a,o;return rg(this,void 0,void 0,(function(){var i;return ag(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=og(e),s.label=1;case 1:return[4,n.next()];case 2:if((r=s.sent()).done)return[3,4];if(t.next(r.value),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=s.sent(),a={error:i},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Sg(e){return xg(hg.readableStreamLikeToAsyncGenerator(e))}jm.innerFrom=function(e){if(e instanceof cg.Observable)return e;if(null!=e){if(ug.isInteropObservable(e))return vg(e);if(sg.isArrayLike(e))return bg(e);if(lg.isPromise(e))return _g(e);if(dg.isAsyncIterable(e))return xg(e);if(pg.isIterable(e))return wg(e);if(hg.isReadableStreamLike(e))return Sg(e)}throw fg.createInvalidObservableTypeError(e)},jm.fromInteropObservable=vg,jm.fromArrayLike=bg,jm.fromPromise=_g,jm.fromIterable=wg,jm.fromAsyncIterable=xg,jm.fromReadableStreamLike=Sg;var Eg={},kg={};Object.defineProperty(kg,"__esModule",{value:!0}),kg.executeSchedule=void 0,kg.executeSchedule=function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);var o=t.schedule((function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!a)return o},Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.observeOn=void 0;var Cg=kg,Ag=Gp,Og=Vp;Eg.observeOn=function(e,t){return void 0===t&&(t=0),Ag.operate((function(n,r){n.subscribe(Og.createOperatorSubscriber(r,(function(n){return Cg.executeSchedule(r,e,(function(){return r.next(n)}),t)}),(function(){return Cg.executeSchedule(r,e,(function(){return r.complete()}),t)}),(function(n){return Cg.executeSchedule(r,e,(function(){return r.error(n)}),t)})))}))};var Tg={};Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.subscribeOn=void 0;var Ng=Gp;Tg.subscribeOn=function(e,t){return void 0===t&&(t=0),Ng.operate((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))},Object.defineProperty(Dm,"__esModule",{value:!0}),Dm.scheduleObservable=void 0;var Ig=jm,Rg=Eg,Fg=Tg;Dm.scheduleObservable=function(e,t){return Ig.innerFrom(e).pipe(Fg.subscribeOn(t),Rg.observeOn(t))};var Pg={};Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.schedulePromise=void 0;var Mg=jm,Dg=Eg,jg=Tg;Pg.schedulePromise=function(e,t){return Mg.innerFrom(e).pipe(jg.subscribeOn(t),Dg.observeOn(t))};var Lg={};Object.defineProperty(Lg,"__esModule",{value:!0}),Lg.scheduleArray=void 0;var qg=tp;Lg.scheduleArray=function(e,t){return new qg.Observable((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))};var Bg={};Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.scheduleIterable=void 0;var Ug=tp,zg=Jm,Gg=rp,Hg=kg;Bg.scheduleIterable=function(e,t){return new Ug.Observable((function(n){var r;return Hg.executeSchedule(n,t,(function(){r=e[zg.iterator](),Hg.executeSchedule(n,t,(function(){var e,t,a;try{t=(e=r.next()).value,a=e.done}catch(e){return void n.error(e)}a?n.complete():n.next(t)}),0,!0)})),function(){return Gg.isFunction(null==r?void 0:r.return)&&r.return()}}))};var $g={};Object.defineProperty($g,"__esModule",{value:!0}),$g.scheduleAsyncIterable=void 0;var Vg=tp,Wg=kg;$g.scheduleAsyncIterable=function(e,t){if(!e)throw new Error("Iterable cannot be null");return new Vg.Observable((function(n){Wg.executeSchedule(n,t,(function(){var r=e[Symbol.asyncIterator]();Wg.executeSchedule(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))};var Jg={};Object.defineProperty(Jg,"__esModule",{value:!0}),Jg.scheduleReadableStreamLike=void 0;var Yg=$g,Kg=Xm;Jg.scheduleReadableStreamLike=function(e,t){return Yg.scheduleAsyncIterable(Kg.readableStreamLikeToAsyncGenerator(e),t)},Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.scheduled=void 0;var Zg=Dm,Xg=Pg,Qg=Lg,ey=Bg,ty=$g,ny=Um,ry=qm,ay=Lm,oy=Wm,iy=Hm,sy=Vm,ly=Xm,cy=Jg;Mm.scheduled=function(e,t){if(null!=e){if(ny.isInteropObservable(e))return Zg.scheduleObservable(e,t);if(ay.isArrayLike(e))return Qg.scheduleArray(e,t);if(ry.isPromise(e))return Xg.schedulePromise(e,t);if(iy.isAsyncIterable(e))return ty.scheduleAsyncIterable(e,t);if(oy.isIterable(e))return ey.scheduleIterable(e,t);if(ly.isReadableStreamLike(e))return cy.scheduleReadableStreamLike(e,t)}throw sy.createInvalidObservableTypeError(e)},Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.from=void 0;var uy=Mm,dy=jm;Pm.from=function(e,t){return t?uy.scheduled(e,t):dy.innerFrom(e)},Object.defineProperty(Am,"__esModule",{value:!0}),Am.of=void 0;var fy=Om,py=Pm;Am.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=fy.popScheduler(e);return py.from(e,n)};var hy={};Object.defineProperty(hy,"__esModule",{value:!0}),hy.throwError=void 0;var my=tp,gy=rp;hy.throwError=function(e,t){var n=gy.isFunction(e)?e:function(){return e},r=function(e){return e.error(n())};return new my.Observable(t?function(e){return t.schedule(r,0,e)}:r)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.observeNotification=e.Notification=e.NotificationKind=void 0;var t,n=Cm,r=Am,a=hy,o=rp;(t=e.NotificationKind||(e.NotificationKind={})).NEXT="N",t.ERROR="E",t.COMPLETE="C";var i=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){return s(this,e)},e.prototype.do=function(e,t,n){var r=this,a=r.kind,o=r.error;return"N"===a?null==e?void 0:e(r.value):"E"===a?null==t?void 0:t(o):null==n?void 0:n()},e.prototype.accept=function(e,t,n){var r;return o.isFunction(null===(r=e)||void 0===r?void 0:r.next)?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e=this,t=e.kind,o=e.error,i="N"===t?r.of(e.value):"E"===t?a.throwError((function(){return o})):"C"===t?n.EMPTY:0;if(!i)throw new TypeError("Unexpected notification kind "+t);return i},e.createNext=function(t){return new e("N",t)},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e}();function s(e,t){var n,r,a,o=e.kind,i=e.value,s=e.error;if("string"!=typeof o)throw new TypeError('Invalid notification, missing "kind"');"N"===o?null===(n=t.next)||void 0===n||n.call(t,i):"E"===o?null===(r=t.error)||void 0===r||r.call(t,s):null===(a=t.complete)||void 0===a||a.call(t)}e.Notification=i,e.observeNotification=s}(km);var yy={};Object.defineProperty(yy,"__esModule",{value:!0}),yy.isObservable=void 0;var vy=tp,by=rp;yy.isObservable=function(e){return!!e&&(e instanceof vy.Observable||by.isFunction(e.lift)&&by.isFunction(e.subscribe))};var _y={},wy={};Object.defineProperty(wy,"__esModule",{value:!0}),wy.EmptyError=void 0,wy.EmptyError=ip.createErrorClass((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),Object.defineProperty(_y,"__esModule",{value:!0}),_y.lastValueFrom=void 0;var xy=wy;_y.lastValueFrom=function(e,t){var n="object"===W(t);return new Promise((function(r,a){var o,i=!1;e.subscribe({next:function(e){o=e,i=!0},error:a,complete:function(){i?r(o):n?r(t.defaultValue):a(new xy.EmptyError)}})}))};var Sy={};Object.defineProperty(Sy,"__esModule",{value:!0}),Sy.firstValueFrom=void 0;var Ey=wy,ky=np;Sy.firstValueFrom=function(e,t){var n="object"===W(t);return new Promise((function(r,a){var o=new ky.SafeSubscriber({next:function(e){r(e),o.unsubscribe()},error:a,complete:function(){n?r(t.defaultValue):a(new Ey.EmptyError)}});e.subscribe(o)}))};var Cy={};Object.defineProperty(Cy,"__esModule",{value:!0}),Cy.ArgumentOutOfRangeError=void 0,Cy.ArgumentOutOfRangeError=ip.createErrorClass((function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}));var Ay={};Object.defineProperty(Ay,"__esModule",{value:!0}),Ay.NotFoundError=void 0,Ay.NotFoundError=ip.createErrorClass((function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}}));var Oy={};Object.defineProperty(Oy,"__esModule",{value:!0}),Oy.SequenceError=void 0,Oy.SequenceError=ip.createErrorClass((function(e){return function(t){e(this),this.name="SequenceError",this.message=t}}));var Ty={},Ny={};Object.defineProperty(Ny,"__esModule",{value:!0}),Ny.isValidDate=void 0,Ny.isValidDate=function(e){return e instanceof Date&&!isNaN(e)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.timeout=e.TimeoutError=void 0;var t=im,n=Ny,r=Gp,a=jm,o=Vp,i=kg;function s(t){throw new e.TimeoutError(t)}e.TimeoutError=ip.createErrorClass((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}})),e.timeout=function(e,l){var c=n.isValidDate(e)?{first:e}:"number"==typeof e?{each:e}:e,u=c.first,d=c.each,f=c.with,p=void 0===f?s:f,h=c.scheduler,m=void 0===h?null!=l?l:t.asyncScheduler:h,g=c.meta,y=void 0===g?null:g;if(null==u&&null==d)throw new TypeError("No timeout provided.");return r.operate((function(e,t){var n,r,s=null,l=0,c=function(e){r=i.executeSchedule(t,m,(function(){try{n.unsubscribe(),a.innerFrom(p({meta:y,lastValue:s,seen:l})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(o.createOperatorSubscriber(t,(function(e){null==r||r.unsubscribe(),l++,t.next(s=e),d>0&&c(d)}),void 0,void 0,(function(){(null==r?void 0:r.closed)||null==r||r.unsubscribe(),s=null}))),!l&&c(null!=u?"number"==typeof u?u:+u-m.now():d)}))}}(Ty);var Iy={},Ry={},Fy={},Py={};Object.defineProperty(Py,"__esModule",{value:!0}),Py.map=void 0;var My=Gp,Dy=Vp;Py.map=function(e,t){return My.operate((function(n,r){var a=0;n.subscribe(Dy.createOperatorSubscriber(r,(function(n){r.next(e.call(t,n,a++))})))}))};var jy=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Ly=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Fy,"__esModule",{value:!0}),Fy.mapOneOrManyArgs=void 0;var qy=Py,By=Array.isArray;Fy.mapOneOrManyArgs=function(e){return qy.map((function(t){return function(e,t){return By(t)?e.apply(void 0,Ly([],jy(t))):e(t)}(e,t)}))};var Uy=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},zy=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Ry,"__esModule",{value:!0}),Ry.bindCallbackInternals=void 0;var Gy=Tm,Hy=tp,$y=Tg,Vy=Fy,Wy=Eg,Jy=Ih;Ry.bindCallbackInternals=function e(t,n,r,a){if(r){if(!Gy.isScheduler(r))return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return e(t,n,a).apply(this,o).pipe(Vy.mapOneOrManyArgs(r))};a=r}return a?function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e(t,n).apply(this,r).pipe($y.subscribeOn(a),Wy.observeOn(a))}:function(){for(var e=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=new Jy.AsyncSubject,i=!0;return new Hy.Observable((function(a){var s=o.subscribe(a);if(i){i=!1;var l=!1,c=!1;n.apply(e,zy(zy([],Uy(r)),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=e.shift();if(null!=r)return void o.error(r)}o.next(1<e.length?e:e[0]),c=!0,l&&o.complete()}])),c&&o.complete(),l=!0}return s}))}},Object.defineProperty(Iy,"__esModule",{value:!0}),Iy.bindCallback=void 0;var Yy=Ry;Iy.bindCallback=function(e,t,n){return Yy.bindCallbackInternals(!1,e,t,n)};var Ky={};Object.defineProperty(Ky,"__esModule",{value:!0}),Ky.bindNodeCallback=void 0;var Zy=Ry;Ky.bindNodeCallback=function(e,t,n){return Zy.bindCallbackInternals(!0,e,t,n)};var Xy={},Qy={};Object.defineProperty(Qy,"__esModule",{value:!0}),Qy.argsArgArrayOrObject=void 0;var ev=Array.isArray,tv=Object.getPrototypeOf,nv=Object.prototype,rv=Object.keys;Qy.argsArgArrayOrObject=function(e){if(1===e.length){var t=e[0];if(ev(t))return{args:t,keys:null};if((r=t)&&"object"===W(r)&&tv(r)===nv){var n=rv(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}};var av={};Object.defineProperty(av,"__esModule",{value:!0}),av.createObject=void 0,av.createObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},Object.defineProperty(Xy,"__esModule",{value:!0}),Xy.combineLatestInit=Xy.combineLatest=void 0;var ov=tp,iv=Qy,sv=Pm,lv=Tp,cv=Fy,uv=Om,dv=av,fv=Vp,pv=kg;function hv(e,t,n){return void 0===n&&(n=lv.identity),function(r){mv(t,(function(){for(var a=e.length,o=new Array(a),i=a,s=a,l=function(a){mv(t,(function(){var l=sv.from(e[a],t),c=!1;l.subscribe(fv.createOperatorSubscriber(r,(function(e){o[a]=e,c||(c=!0,s--),s||r.next(n(o.slice()))}),(function(){--i||r.complete()})))}),r)},c=0;c<a;c++)l(c)}),r)}}function mv(e,t,n){e?pv.executeSchedule(n,e,t):t()}Xy.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=uv.popScheduler(e),r=uv.popResultSelector(e),a=iv.argsArgArrayOrObject(e),o=a.args,i=a.keys;if(0===o.length)return sv.from([],n);var s=new ov.Observable(hv(o,n,i?function(e){return dv.createObject(i,e)}:lv.identity));return r?s.pipe(cv.mapOneOrManyArgs(r)):s},Xy.combineLatestInit=hv;var gv={},yv={},vv={},bv={},_v={};Object.defineProperty(_v,"__esModule",{value:!0}),_v.mergeInternals=void 0;var wv=jm,xv=kg,Sv=Vp;_v.mergeInternals=function(e,t,n,r,a,o,i,s){var l=[],c=0,u=0,d=!1,f=function(){!d||l.length||c||t.complete()},p=function(e){return c<r?h(e):l.push(e)},h=function e(s){o&&t.next(s),c++;var d=!1;wv.innerFrom(n(s,u++)).subscribe(Sv.createOperatorSubscriber(t,(function(e){null==a||a(e),o?p(e):t.next(e)}),(function(){d=!0}),void 0,(function(){if(d)try{c--;for(var n=function(){var n=l.shift();i?xv.executeSchedule(t,i,(function(){return e(n)})):e(n)};l.length&&c<r;)n();f()}catch(e){t.error(e)}})))};return e.subscribe(Sv.createOperatorSubscriber(t,p,(function(){d=!0,f()}))),function(){null==s||s()}},Object.defineProperty(bv,"__esModule",{value:!0}),bv.mergeMap=void 0;var Ev=Py,kv=jm,Cv=Gp,Av=_v,Ov=rp;bv.mergeMap=function e(t,n,r){return void 0===r&&(r=Infinity),Ov.isFunction(n)?e((function(e,r){return Ev.map((function(t,a){return n(e,t,r,a)}))(kv.innerFrom(t(e,r)))}),r):("number"==typeof n&&(r=n),Cv.operate((function(e,n){return Av.mergeInternals(e,n,t,r)})))},Object.defineProperty(vv,"__esModule",{value:!0}),vv.mergeAll=void 0;var Tv=bv,Nv=Tp;vv.mergeAll=function(e){return void 0===e&&(e=Infinity),Tv.mergeMap(Nv.identity,e)},Object.defineProperty(yv,"__esModule",{value:!0}),yv.concatAll=void 0;var Iv=vv;yv.concatAll=function(){return Iv.mergeAll(1)},Object.defineProperty(gv,"__esModule",{value:!0}),gv.concat=void 0;var Rv=yv,Fv=Om,Pv=Pm;gv.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Rv.concatAll()(Pv.from(e,Fv.popScheduler(e)))};var Mv={},Dv={};Object.defineProperty(Dv,"__esModule",{value:!0}),Dv.defer=void 0;var jv=tp,Lv=jm;Dv.defer=function(e){return new jv.Observable((function(t){Lv.innerFrom(e()).subscribe(t)}))},Object.defineProperty(Mv,"__esModule",{value:!0}),Mv.connectable=void 0;var qv=fh,Bv=tp,Uv=Dv,zv={connector:function(){return new qv.Subject},resetOnDisconnect:!0};Mv.connectable=function(e,t){void 0===t&&(t=zv);var n=null,r=t.connector,a=t.resetOnDisconnect,o=void 0===a||a,i=r(),s=new Bv.Observable((function(e){return i.subscribe(e)}));return s.connect=function(){return n&&!n.closed||(n=Uv.defer((function(){return e})).subscribe(i),o&&n.add((function(){return i=r()}))),n},s};var Gv={};Object.defineProperty(Gv,"__esModule",{value:!0}),Gv.forkJoin=void 0;var Hv=tp,$v=Qy,Vv=jm,Wv=Om,Jv=Vp,Yv=Fy,Kv=av;Gv.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Wv.popResultSelector(e),r=$v.argsArgArrayOrObject(e),a=r.args,o=r.keys,i=new Hv.Observable((function(e){var t=a.length;if(t)for(var n=new Array(t),r=t,i=t,s=function(t){var s=!1;Vv.innerFrom(a[t]).subscribe(Jv.createOperatorSubscriber(e,(function(e){s||(s=!0,i--),n[t]=e}),(function(){return r--}),void 0,(function(){r&&s||(i||e.next(o?Kv.createObject(o,n):n),e.complete())})))},l=0;l<t;l++)s(l);else e.complete()}));return n?i.pipe(Yv.mapOneOrManyArgs(n)):i};var Zv={},Xv=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(Zv,"__esModule",{value:!0}),Zv.fromEvent=void 0;var Qv=jm,eb=tp,tb=bv,nb=Lm,rb=rp,ab=Fy,ob=["addListener","removeListener"],ib=["addEventListener","removeEventListener"],sb=["on","off"];function lb(e,t){return function(n){return function(r){return e[n](t,r)}}}Zv.fromEvent=function e(t,n,r,a){if(rb.isFunction(r)&&(a=r,r=void 0),a)return e(t,n,r).pipe(ab.mapOneOrManyArgs(a));var o=Xv(function(e){return rb.isFunction(e.addEventListener)&&rb.isFunction(e.removeEventListener)}(t)?ib.map((function(e){return function(a){return t[e](n,a,r)}})):function(e){return rb.isFunction(e.addListener)&&rb.isFunction(e.removeListener)}(t)?ob.map(lb(t,n)):function(e){return rb.isFunction(e.on)&&rb.isFunction(e.off)}(t)?sb.map(lb(t,n)):[],2),i=o[0],s=o[1];if(!i&&nb.isArrayLike(t))return tb.mergeMap((function(t){return e(t,n,r)}))(Qv.innerFrom(t));if(!i)throw new TypeError("Invalid event target");return new eb.Observable((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return i(t),function(){return s(t)}}))};var cb={};Object.defineProperty(cb,"__esModule",{value:!0}),cb.fromEventPattern=void 0;var ub=tp,db=rp,fb=Fy;cb.fromEventPattern=function e(t,n,r){return r?e(t,n).pipe(fb.mapOneOrManyArgs(r)):new ub.Observable((function(e){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1===t.length?t[0]:t)},a=t(r);return db.isFunction(n)?function(){return n(r,a)}:void 0}))};var pb={},hb=M&&M.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(pb,"__esModule",{value:!0}),pb.generate=void 0;var mb=Tp,gb=Tm,yb=Dv,vb=Bg;pb.generate=function(e,t,n,r,a){var o,i,s,l;function c(){var e;return hb(this,(function(r){switch(r.label){case 0:e=l,r.label=1;case 1:return t&&!t(e)?[3,4]:[4,s(e)];case 2:r.sent(),r.label=3;case 3:return e=n(e),[3,1];case 4:return[2]}}))}return 1===arguments.length?(l=(o=e).initialState,t=o.condition,n=o.iterate,s=void 0===(i=o.resultSelector)?mb.identity:i,a=o.scheduler):(l=e,!r||gb.isScheduler(r)?(s=mb.identity,a=r):s=r),yb.defer(a?function(){return vb.scheduleIterable(c(),a)}:c)};var bb={};Object.defineProperty(bb,"__esModule",{value:!0}),bb.iif=void 0;var _b=Dv;bb.iif=function(e,t,n){return _b.defer((function(){return e()?t:n}))};var wb={},xb={};Object.defineProperty(xb,"__esModule",{value:!0}),xb.timer=void 0;var Sb=tp,Eb=im,kb=Tm,Cb=Ny;xb.timer=function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=Eb.async);var r=-1;return null!=t&&(kb.isScheduler(t)?n=t:r=t),new Sb.Observable((function(t){var a=Cb.isValidDate(e)?+e-n.now():e;a<0&&(a=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),a)}))},Object.defineProperty(wb,"__esModule",{value:!0}),wb.interval=void 0;var Ab=im,Ob=xb;wb.interval=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=Ab.asyncScheduler),e<0&&(e=0),Ob.timer(e,e,t)};var Tb={};Object.defineProperty(Tb,"__esModule",{value:!0}),Tb.merge=void 0;var Nb=vv,Ib=jm,Rb=Cm,Fb=Om,Pb=Pm;Tb.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Fb.popScheduler(e),r=Fb.popNumber(e,Infinity),a=e;return a.length?1===a.length?Ib.innerFrom(a[0]):Nb.mergeAll(r)(Pb.from(a,n)):Rb.EMPTY};var Mb={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.never=e.NEVER=void 0,e.NEVER=new tp.Observable(wp.noop),e.never=function(){return e.NEVER}}(Mb);var Db={},jb={};Object.defineProperty(jb,"__esModule",{value:!0}),jb.argsOrArgArray=void 0;var Lb=Array.isArray;jb.argsOrArgArray=function(e){return 1===e.length&&Lb(e[0])?e[0]:e},Object.defineProperty(Db,"__esModule",{value:!0}),Db.onErrorResumeNext=void 0;var qb=tp,Bb=jb,Ub=Vp,zb=wp,Gb=jm;Db.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Bb.argsOrArgArray(e);return new qb.Observable((function(e){var t=0;!function r(){if(t<n.length){var a=void 0;try{a=Gb.innerFrom(n[t++])}catch(e){return void r()}var o=new Ub.OperatorSubscriber(e,void 0,zb.noop,zb.noop);a.subscribe(o),o.add(r)}else e.complete()}()}))};var Hb={};Object.defineProperty(Hb,"__esModule",{value:!0}),Hb.pairs=void 0;var $b=Pm;Hb.pairs=function(e,t){return $b.from(Object.entries(e),t)};var Vb={},Wb={};Object.defineProperty(Wb,"__esModule",{value:!0}),Wb.not=void 0,Wb.not=function(e,t){return function(n,r){return!e.call(t,n,r)}};var Jb={};Object.defineProperty(Jb,"__esModule",{value:!0}),Jb.filter=void 0;var Yb=Gp,Kb=Vp;Jb.filter=function(e,t){return Yb.operate((function(n,r){var a=0;n.subscribe(Kb.createOperatorSubscriber(r,(function(n){return e.call(t,n,a++)&&r.next(n)})))}))},Object.defineProperty(Vb,"__esModule",{value:!0}),Vb.partition=void 0;var Zb=Wb,Xb=Jb,Qb=jm;Vb.partition=function(e,t,n){return[Xb.filter(t,n)(Qb.innerFrom(e)),Xb.filter(Zb.not(t,n))(Qb.innerFrom(e))]};var e_={};Object.defineProperty(e_,"__esModule",{value:!0}),e_.raceInit=e_.race=void 0;var t_=tp,n_=jm,r_=jb,a_=Vp;function o_(e){return function(t){for(var n=[],r=function(r){n.push(n_.innerFrom(e[r]).subscribe(a_.createOperatorSubscriber(t,(function(e){if(n){for(var a=0;a<n.length;a++)a!==r&&n[a].unsubscribe();n=null}t.next(e)}))))},a=0;n&&!t.closed&&a<e.length;a++)r(a)}}e_.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=r_.argsOrArgArray(e)).length?n_.innerFrom(e[0]):new t_.Observable(o_(e))},e_.raceInit=o_;var i_={};Object.defineProperty(i_,"__esModule",{value:!0}),i_.range=void 0;var s_=tp,l_=Cm;i_.range=function(e,t,n){if(null==t&&(t=e,e=0),t<=0)return l_.EMPTY;var r=t+e;return new s_.Observable(n?function(t){var a=e;return n.schedule((function(){a<r?(t.next(a++),this.schedule()):t.complete()}))}:function(t){for(var n=e;n<r&&!t.closed;)t.next(n++);t.complete()})};var c_={};Object.defineProperty(c_,"__esModule",{value:!0}),c_.using=void 0;var u_=tp,d_=jm,f_=Cm;c_.using=function(e,t){return new u_.Observable((function(n){var r=e(),a=t(r);return(a?d_.innerFrom(a):f_.EMPTY).subscribe(n),function(){r&&r.unsubscribe()}}))};var p_={},h_=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},m_=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(p_,"__esModule",{value:!0}),p_.zip=void 0;var g_=tp,y_=jm,v_=jb,b_=Cm,__=Vp,w_=Om;p_.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=w_.popResultSelector(e),r=v_.argsOrArgArray(e);return r.length?new g_.Observable((function(e){var t=r.map((function(){return[]})),a=r.map((function(){return!1}));e.add((function(){t=a=null}));for(var o=function(o){y_.innerFrom(r[o]).subscribe(__.createOperatorSubscriber(e,(function(r){if(t[o].push(r),t.every((function(e){return e.length}))){var i=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,m_([],h_(i))):i),t.some((function(e,t){return!e.length&&a[t]}))&&e.complete()}}),(function(){a[o]=!0,!t[o].length&&e.complete()})))},i=0;!e.closed&&i<r.length;i++)o(i);return function(){t=a=null}})):b_.EMPTY};var x_={};Object.defineProperty(x_,"__esModule",{value:!0});var S_={};Object.defineProperty(S_,"__esModule",{value:!0}),S_.audit=void 0;var E_=Gp,k_=jm,C_=Vp;S_.audit=function(e){return E_.operate((function(t,n){var r=!1,a=null,o=null,i=!1,s=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}i&&n.complete()},l=function(){o=null,i&&n.complete()};t.subscribe(C_.createOperatorSubscriber(n,(function(t){r=!0,a=t,o||k_.innerFrom(e(t)).subscribe(o=C_.createOperatorSubscriber(n,s,l))}),(function(){i=!0,(!r||!o||o.closed)&&n.complete()})))}))};var A_={};Object.defineProperty(A_,"__esModule",{value:!0}),A_.auditTime=void 0;var O_=im,T_=S_,N_=xb;A_.auditTime=function(e,t){return void 0===t&&(t=O_.asyncScheduler),T_.audit((function(){return N_.timer(e,t)}))};var I_={};Object.defineProperty(I_,"__esModule",{value:!0}),I_.buffer=void 0;var R_=Gp,F_=wp,P_=Vp,M_=jm;I_.buffer=function(e){return R_.operate((function(t,n){var r=[];return t.subscribe(P_.createOperatorSubscriber(n,(function(e){return r.push(e)}),(function(){n.next(r),n.complete()}))),M_.innerFrom(e).subscribe(P_.createOperatorSubscriber(n,(function(){var e=r;r=[],n.next(e)}),F_.noop)),function(){r=null}}))};var D_={},j_=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(D_,"__esModule",{value:!0}),D_.bufferCount=void 0;var L_=Gp,q_=Vp,B_=sp;D_.bufferCount=function(e,t){return void 0===t&&(t=null),t=null!=t?t:e,L_.operate((function(n,r){var a=[],o=0;n.subscribe(q_.createOperatorSubscriber(r,(function(n){var i,s,l,c,u=null;o++%t==0&&a.push([]);try{for(var d=j_(a),f=d.next();!f.done;f=d.next())(m=f.value).push(n),e<=m.length&&(u=null!=u?u:[]).push(m)}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}if(u)try{for(var p=j_(u),h=p.next();!h.done;h=p.next()){var m;B_.arrRemove(a,m=h.value),r.next(m)}}catch(e){l={error:e}}finally{try{h&&!h.done&&(c=p.return)&&c.call(p)}finally{if(l)throw l.error}}}),(function(){var e,t;try{for(var n=j_(a),o=n.next();!o.done;o=n.next())r.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){a=null})))}))};var U_={},z_=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(U_,"__esModule",{value:!0}),U_.bufferTime=void 0;var G_=ap,H_=Gp,$_=Vp,V_=sp,W_=im,J_=Om,Y_=kg;U_.bufferTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=J_.popScheduler(r))&&void 0!==t?t:W_.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return H_.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.buffer;e.subs.unsubscribe(),V_.arrRemove(r,e),n.next(t),a&&c()},c=function(){if(r){var t=new G_.Subscription;n.add(t);var a={buffer:[],subs:t};r.push(a),Y_.executeSchedule(t,o,(function(){return l(a)}),e)}};null!==i&&i>=0?Y_.executeSchedule(n,o,c,i,!0):a=!0,c();var u=$_.createOperatorSubscriber(n,(function(e){var t,n,a=r.slice();try{for(var o=z_(a),i=o.next();!i.done;i=o.next()){var c=i.value,u=c.buffer;u.push(e),s<=u.length&&l(c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;null==r?void 0:r.length;)n.next(r.shift().buffer);null==u||u.unsubscribe(),n.complete(),n.unsubscribe()}),void 0,(function(){return r=null}));t.subscribe(u)}))};var K_={},Z_=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(K_,"__esModule",{value:!0}),K_.bufferToggle=void 0;var X_=ap,Q_=Gp,ew=jm,tw=Vp,nw=wp,rw=sp;K_.bufferToggle=function(e,t){return Q_.operate((function(n,r){var a=[];ew.innerFrom(e).subscribe(tw.createOperatorSubscriber(r,(function(e){var n=[];a.push(n);var o=new X_.Subscription;o.add(ew.innerFrom(t(e)).subscribe(tw.createOperatorSubscriber(r,(function(){rw.arrRemove(a,n),r.next(n),o.unsubscribe()}),nw.noop)))}),nw.noop)),n.subscribe(tw.createOperatorSubscriber(r,(function(e){var t,n;try{for(var r=Z_(a),o=r.next();!o.done;o=r.next())o.value.push(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),(function(){for(;a.length>0;)r.next(a.shift());r.complete()})))}))};var aw={};Object.defineProperty(aw,"__esModule",{value:!0}),aw.bufferWhen=void 0;var ow=Gp,iw=wp,sw=Vp,lw=jm;aw.bufferWhen=function(e){return ow.operate((function(t,n){var r=null,a=null;!function t(){null==a||a.unsubscribe();var o=r;r=[],o&&n.next(o),lw.innerFrom(e()).subscribe(a=sw.createOperatorSubscriber(n,t,iw.noop))}(),t.subscribe(sw.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.push(e)}),(function(){r&&n.next(r),n.complete()}),void 0,(function(){return r=a=null})))}))};var cw={};Object.defineProperty(cw,"__esModule",{value:!0}),cw.catchError=void 0;var uw=jm,dw=Vp,fw=Gp;cw.catchError=function e(t){return fw.operate((function(n,r){var a,o=null,i=!1;o=n.subscribe(dw.createOperatorSubscriber(r,void 0,void 0,(function(s){a=uw.innerFrom(t(s,e(t)(n))),o?(o.unsubscribe(),o=null,a.subscribe(r)):i=!0}))),i&&(o.unsubscribe(),o=null,a.subscribe(r))}))};var pw={},hw={},mw={},gw={},yw={},vw={};Object.defineProperty(vw,"__esModule",{value:!0}),vw.scanInternals=void 0;var bw=Vp;vw.scanInternals=function(e,t,n,r,a){return function(o,i){var s=n,l=t,c=0;o.subscribe(bw.createOperatorSubscriber(i,(function(t){var n=c++;l=s?e(l,t,n):(s=!0,t),r&&i.next(l)}),a&&function(){s&&i.next(l),i.complete()}))}},Object.defineProperty(yw,"__esModule",{value:!0}),yw.reduce=void 0;var _w=vw,ww=Gp;yw.reduce=function(e,t){return ww.operate(_w.scanInternals(e,t,arguments.length>=2,!1,!0))},Object.defineProperty(gw,"__esModule",{value:!0}),gw.toArray=void 0;var xw=yw,Sw=Gp,Ew=function(e,t){return e.push(t),e};gw.toArray=function(){return Sw.operate((function(e,t){xw.reduce(Ew,[])(e).subscribe(t)}))},Object.defineProperty(mw,"__esModule",{value:!0}),mw.joinAllInternals=void 0;var kw=Tp,Cw=Fy,Aw=Op,Ow=bv,Tw=gw;mw.joinAllInternals=function(e,t){return Aw.pipe(Tw.toArray(),Ow.mergeMap((function(t){return e(t)})),t?Cw.mapOneOrManyArgs(t):kw.identity)},Object.defineProperty(hw,"__esModule",{value:!0}),hw.combineLatestAll=void 0;var Nw=Xy,Iw=mw;hw.combineLatestAll=function(e){return Iw.joinAllInternals(Nw.combineLatest,e)},Object.defineProperty(pw,"__esModule",{value:!0}),pw.combineAll=void 0,pw.combineAll=hw.combineLatestAll;var Rw={},Fw={},Pw=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Mw=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Fw,"__esModule",{value:!0}),Fw.combineLatest=void 0;var Dw=Xy,jw=Gp,Lw=jb,qw=Fy,Bw=Op,Uw=Om;Fw.combineLatest=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Uw.popResultSelector(t);return r?Bw.pipe(e.apply(void 0,Mw([],Pw(t))),qw.mapOneOrManyArgs(r)):jw.operate((function(e,n){Dw.combineLatestInit(Mw([e],Pw(Lw.argsOrArgArray(t))))(n)}))};var zw=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Gw=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.combineLatestWith=void 0;var Hw=Fw;Rw.combineLatestWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Hw.combineLatest.apply(void 0,Gw([],zw(e)))};var $w={};Object.defineProperty($w,"__esModule",{value:!0}),$w.concatMap=void 0;var Vw=bv,Ww=rp;$w.concatMap=function(e,t){return Ww.isFunction(t)?Vw.mergeMap(e,t,1):Vw.mergeMap(e,1)};var Jw={};Object.defineProperty(Jw,"__esModule",{value:!0}),Jw.concatMapTo=void 0;var Yw=$w,Kw=rp;Jw.concatMapTo=function(e,t){return Kw.isFunction(t)?Yw.concatMap((function(){return e}),t):Yw.concatMap((function(){return e}))};var Zw={},Xw={},Qw=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},ex=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Xw,"__esModule",{value:!0}),Xw.concat=void 0;var tx=Gp,nx=yv,rx=Om,ax=Pm;Xw.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=rx.popScheduler(e);return tx.operate((function(t,r){nx.concatAll()(ax.from(ex([t],Qw(e)),n)).subscribe(r)}))};var ox=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},ix=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Zw,"__esModule",{value:!0}),Zw.concatWith=void 0;var sx=Xw;Zw.concatWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return sx.concat.apply(void 0,ix([],ox(e)))};var lx={},cx={};Object.defineProperty(cx,"__esModule",{value:!0}),cx.fromSubscribable=void 0;var ux=tp;cx.fromSubscribable=function(e){return new ux.Observable((function(t){return e.subscribe(t)}))},Object.defineProperty(lx,"__esModule",{value:!0}),lx.connect=void 0;var dx=fh,fx=jm,px=Gp,hx=cx,mx={connector:function(){return new dx.Subject}};lx.connect=function(e,t){void 0===t&&(t=mx);var n=t.connector;return px.operate((function(t,r){var a=n();fx.innerFrom(e(hx.fromSubscribable(a))).subscribe(r),r.add(t.subscribe(a))}))};var gx={};Object.defineProperty(gx,"__esModule",{value:!0}),gx.count=void 0;var yx=yw;gx.count=function(e){return yx.reduce((function(t,n,r){return!e||e(n,r)?t+1:t}),0)};var vx={};Object.defineProperty(vx,"__esModule",{value:!0}),vx.debounce=void 0;var bx=Gp,_x=wp,wx=Vp,xx=jm;vx.debounce=function(e){return bx.operate((function(t,n){var r=!1,a=null,o=null,i=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}};t.subscribe(wx.createOperatorSubscriber(n,(function(t){null==o||o.unsubscribe(),r=!0,a=t,o=wx.createOperatorSubscriber(n,i,_x.noop),xx.innerFrom(e(t)).subscribe(o)}),(function(){i(),n.complete()}),void 0,(function(){a=o=null})))}))};var Sx={};Object.defineProperty(Sx,"__esModule",{value:!0}),Sx.debounceTime=void 0;var Ex=im,kx=Gp,Cx=Vp;Sx.debounceTime=function(e,t){return void 0===t&&(t=Ex.asyncScheduler),kx.operate((function(n,r){var a=null,o=null,i=null,s=function(){if(a){a.unsubscribe(),a=null;var e=o;o=null,r.next(e)}};function l(){var n=i+e,o=t.now();if(o<n)return a=this.schedule(void 0,n-o),void r.add(a);s()}n.subscribe(Cx.createOperatorSubscriber(r,(function(n){o=n,i=t.now(),a||(a=t.schedule(l,e),r.add(a))}),(function(){s(),r.complete()}),void 0,(function(){o=a=null})))}))};var Ax={};Object.defineProperty(Ax,"__esModule",{value:!0}),Ax.defaultIfEmpty=void 0;var Ox=Gp,Tx=Vp;Ax.defaultIfEmpty=function(e){return Ox.operate((function(t,n){var r=!1;t.subscribe(Tx.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))};var Nx={},Ix={},Rx={};Object.defineProperty(Rx,"__esModule",{value:!0}),Rx.take=void 0;var Fx=Cm,Px=Gp,Mx=Vp;Rx.take=function(e){return e<=0?function(){return Fx.EMPTY}:Px.operate((function(t,n){var r=0;t.subscribe(Mx.createOperatorSubscriber(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))};var Dx={};Object.defineProperty(Dx,"__esModule",{value:!0}),Dx.ignoreElements=void 0;var jx=Gp,Lx=Vp,qx=wp;Dx.ignoreElements=function(){return jx.operate((function(e,t){e.subscribe(Lx.createOperatorSubscriber(t,qx.noop))}))};var Bx={};Object.defineProperty(Bx,"__esModule",{value:!0}),Bx.mapTo=void 0;var Ux=Py;Bx.mapTo=function(e){return Ux.map((function(){return e}))},Object.defineProperty(Ix,"__esModule",{value:!0}),Ix.delayWhen=void 0;var zx=gv,Gx=Rx,Hx=Dx,$x=Bx,Vx=bv,Wx=jm;Ix.delayWhen=function e(t,n){return n?function(r){return zx.concat(n.pipe(Gx.take(1),Hx.ignoreElements()),r.pipe(e(t)))}:Vx.mergeMap((function(e,n){return Wx.innerFrom(t(e,n)).pipe(Gx.take(1),$x.mapTo(e))}))},Object.defineProperty(Nx,"__esModule",{value:!0}),Nx.delay=void 0;var Jx=im,Yx=Ix,Kx=xb;Nx.delay=function(e,t){void 0===t&&(t=Jx.asyncScheduler);var n=Kx.timer(e,t);return Yx.delayWhen((function(){return n}))};var Zx={};Object.defineProperty(Zx,"__esModule",{value:!0}),Zx.dematerialize=void 0;var Xx=km,Qx=Gp,eS=Vp;Zx.dematerialize=function(){return Qx.operate((function(e,t){e.subscribe(eS.createOperatorSubscriber(t,(function(e){return Xx.observeNotification(e,t)})))}))};var tS={};Object.defineProperty(tS,"__esModule",{value:!0}),tS.distinct=void 0;var nS=Gp,rS=Vp,aS=wp,oS=jm;tS.distinct=function(e,t){return nS.operate((function(n,r){var a=new Set;n.subscribe(rS.createOperatorSubscriber(r,(function(t){var n=e?e(t):t;a.has(n)||(a.add(n),r.next(t))}))),t&&oS.innerFrom(t).subscribe(rS.createOperatorSubscriber(r,(function(){return a.clear()}),aS.noop))}))};var iS={};Object.defineProperty(iS,"__esModule",{value:!0}),iS.distinctUntilChanged=void 0;var sS=Tp,lS=Gp,cS=Vp;function uS(e,t){return e===t}iS.distinctUntilChanged=function(e,t){return void 0===t&&(t=sS.identity),e=null!=e?e:uS,lS.operate((function(n,r){var a,o=!0;n.subscribe(cS.createOperatorSubscriber(r,(function(n){var i=t(n);!o&&e(a,i)||(o=!1,a=i,r.next(n))})))}))};var dS={};Object.defineProperty(dS,"__esModule",{value:!0}),dS.distinctUntilKeyChanged=void 0;var fS=iS;dS.distinctUntilKeyChanged=function(e,t){return fS.distinctUntilChanged((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))};var pS={},hS={};Object.defineProperty(hS,"__esModule",{value:!0}),hS.throwIfEmpty=void 0;var mS=wy,gS=Gp,yS=Vp;function vS(){return new mS.EmptyError}hS.throwIfEmpty=function(e){return void 0===e&&(e=vS),gS.operate((function(t,n){var r=!1;t.subscribe(yS.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))},Object.defineProperty(pS,"__esModule",{value:!0}),pS.elementAt=void 0;var bS=Cy,_S=Jb,wS=hS,xS=Ax,SS=Rx;pS.elementAt=function(e,t){if(e<0)throw new bS.ArgumentOutOfRangeError;var n=arguments.length>=2;return function(r){return r.pipe(_S.filter((function(t,n){return n===e})),SS.take(1),n?xS.defaultIfEmpty(t):wS.throwIfEmpty((function(){return new bS.ArgumentOutOfRangeError})))}};var ES={},kS=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},CS=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(ES,"__esModule",{value:!0}),ES.endWith=void 0;var AS=gv,OS=Am;ES.endWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return AS.concat(t,OS.of.apply(void 0,CS([],kS(e))))}};var TS={};Object.defineProperty(TS,"__esModule",{value:!0}),TS.every=void 0;var NS=Gp,IS=Vp;TS.every=function(e,t){return NS.operate((function(n,r){var a=0;n.subscribe(IS.createOperatorSubscriber(r,(function(o){e.call(t,o,a++,n)||(r.next(!1),r.complete())}),(function(){r.next(!0),r.complete()})))}))};var RS={},FS={},PS={};Object.defineProperty(PS,"__esModule",{value:!0}),PS.exhaustMap=void 0;var MS=Py,DS=jm,jS=Gp,LS=Vp;PS.exhaustMap=function e(t,n){return n?function(r){return r.pipe(e((function(e,r){return DS.innerFrom(t(e,r)).pipe(MS.map((function(t,a){return n(e,t,r,a)})))})))}:jS.operate((function(e,n){var r=0,a=null,o=!1;e.subscribe(LS.createOperatorSubscriber(n,(function(e){a||(a=LS.createOperatorSubscriber(n,void 0,(function(){a=null,o&&n.complete()})),DS.innerFrom(t(e,r++)).subscribe(a))}),(function(){o=!0,!a&&n.complete()})))}))},Object.defineProperty(FS,"__esModule",{value:!0}),FS.exhaustAll=void 0;var qS=PS,BS=Tp;FS.exhaustAll=function(){return qS.exhaustMap(BS.identity)},Object.defineProperty(RS,"__esModule",{value:!0}),RS.exhaust=void 0,RS.exhaust=FS.exhaustAll;var US={};Object.defineProperty(US,"__esModule",{value:!0}),US.expand=void 0;var zS=Gp,GS=_v;US.expand=function(e,t,n){return void 0===t&&(t=Infinity),t=(t||0)<1?Infinity:t,zS.operate((function(r,a){return GS.mergeInternals(r,a,e,t,void 0,!0,n)}))};var HS={};Object.defineProperty(HS,"__esModule",{value:!0}),HS.finalize=void 0;var $S=Gp;HS.finalize=function(e){return $S.operate((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))};var VS={};Object.defineProperty(VS,"__esModule",{value:!0}),VS.createFind=VS.find=void 0;var WS=Gp,JS=Vp;function YS(e,t,n){var r="index"===n;return function(n,a){var o=0;n.subscribe(JS.createOperatorSubscriber(a,(function(i){var s=o++;e.call(t,i,s,n)&&(a.next(r?s:i),a.complete())}),(function(){a.next(r?-1:void 0),a.complete()})))}}VS.find=function(e,t){return WS.operate(YS(e,t,"value"))},VS.createFind=YS;var KS={};Object.defineProperty(KS,"__esModule",{value:!0}),KS.findIndex=void 0;var ZS=Gp,XS=VS;KS.findIndex=function(e,t){return ZS.operate(XS.createFind(e,t,"index"))};var QS={};Object.defineProperty(QS,"__esModule",{value:!0}),QS.first=void 0;var eE=wy,tE=Jb,nE=Rx,rE=Ax,aE=hS,oE=Tp;QS.first=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?tE.filter((function(t,n){return e(t,n,r)})):oE.identity,nE.take(1),n?rE.defaultIfEmpty(t):aE.throwIfEmpty((function(){return new eE.EmptyError})))}};var iE={};Object.defineProperty(iE,"__esModule",{value:!0}),iE.groupBy=void 0;var sE=tp,lE=jm,cE=fh,uE=Gp,dE=Vp;iE.groupBy=function(e,t,n,r){return uE.operate((function(a,o){var i;t&&"function"!=typeof t?(n=t.duration,i=t.element,r=t.connector):i=t;var s=new Map,l=function(e){s.forEach(e),e(o)},c=function(e){return l((function(t){return t.error(e)}))},u=0,d=!1,f=new dE.OperatorSubscriber(o,(function(t){try{var a=e(t),l=s.get(a);if(!l){s.set(a,l=r?r():new cE.Subject);var p=(m=a,g=l,(y=new sE.Observable((function(e){u++;var t=g.subscribe(e);return function(){t.unsubscribe(),0==--u&&d&&f.unsubscribe()}}))).key=m,y);if(o.next(p),n){var h=dE.createOperatorSubscriber(l,(function(){l.complete(),null==h||h.unsubscribe()}),void 0,void 0,(function(){return s.delete(a)}));f.add(lE.innerFrom(n(p)).subscribe(h))}}l.next(i?i(t):t)}catch(e){c(e)}var m,g,y}),(function(){return l((function(e){return e.complete()}))}),c,(function(){return s.clear()}),(function(){return d=!0,0===u}));a.subscribe(f)}))};var fE={};Object.defineProperty(fE,"__esModule",{value:!0}),fE.isEmpty=void 0;var pE=Gp,hE=Vp;fE.isEmpty=function(){return pE.operate((function(e,t){e.subscribe(hE.createOperatorSubscriber(t,(function(){t.next(!1),t.complete()}),(function(){t.next(!0),t.complete()})))}))};var mE={},gE={},yE=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(gE,"__esModule",{value:!0}),gE.takeLast=void 0;var vE=Cm,bE=Gp,_E=Vp;gE.takeLast=function(e){return e<=0?function(){return vE.EMPTY}:bE.operate((function(t,n){var r=[];t.subscribe(_E.createOperatorSubscriber(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var a=yE(r),o=a.next();!o.done;o=a.next())n.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))},Object.defineProperty(mE,"__esModule",{value:!0}),mE.last=void 0;var wE=wy,xE=Jb,SE=gE,EE=hS,kE=Ax,CE=Tp;mE.last=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?xE.filter((function(t,n){return e(t,n,r)})):CE.identity,SE.takeLast(1),n?kE.defaultIfEmpty(t):EE.throwIfEmpty((function(){return new wE.EmptyError})))}};var AE={};Object.defineProperty(AE,"__esModule",{value:!0}),AE.materialize=void 0;var OE=km,TE=Gp,NE=Vp;AE.materialize=function(){return TE.operate((function(e,t){e.subscribe(NE.createOperatorSubscriber(t,(function(e){t.next(OE.Notification.createNext(e))}),(function(){t.next(OE.Notification.createComplete()),t.complete()}),(function(e){t.next(OE.Notification.createError(e)),t.complete()})))}))};var IE={};Object.defineProperty(IE,"__esModule",{value:!0}),IE.max=void 0;var RE=yw,FE=rp;IE.max=function(e){return RE.reduce(FE.isFunction(e)?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})};var PE={};Object.defineProperty(PE,"__esModule",{value:!0}),PE.flatMap=void 0,PE.flatMap=bv.mergeMap;var ME={};Object.defineProperty(ME,"__esModule",{value:!0}),ME.mergeMapTo=void 0;var DE=bv,jE=rp;ME.mergeMapTo=function(e,t,n){return void 0===n&&(n=Infinity),jE.isFunction(t)?DE.mergeMap((function(){return e}),t,n):("number"==typeof t&&(n=t),DE.mergeMap((function(){return e}),n))};var LE={};Object.defineProperty(LE,"__esModule",{value:!0}),LE.mergeScan=void 0;var qE=Gp,BE=_v;LE.mergeScan=function(e,t,n){return void 0===n&&(n=Infinity),qE.operate((function(r,a){var o=t;return BE.mergeInternals(r,a,(function(t,n){return e(o,t,n)}),n,(function(e){o=e}),!1,void 0,(function(){return o=null}))}))};var UE={},zE={},GE=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},HE=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(zE,"__esModule",{value:!0}),zE.merge=void 0;var $E=Gp,VE=jb,WE=vv,JE=Om,YE=Pm;zE.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=JE.popScheduler(e),r=JE.popNumber(e,Infinity);return e=VE.argsOrArgArray(e),$E.operate((function(t,a){WE.mergeAll(r)(YE.from(HE([t],GE(e)),n)).subscribe(a)}))};var KE=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},ZE=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(UE,"__esModule",{value:!0}),UE.mergeWith=void 0;var XE=zE;UE.mergeWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return XE.merge.apply(void 0,ZE([],KE(e)))};var QE={};Object.defineProperty(QE,"__esModule",{value:!0}),QE.min=void 0;var ek=yw,tk=rp;QE.min=function(e){return ek.reduce(tk.isFunction(e)?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})};var nk={};Object.defineProperty(nk,"__esModule",{value:!0}),nk.multicast=void 0;var rk=Up,ak=rp,ok=lx;nk.multicast=function(e,t){var n=ak.isFunction(e)?e:function(){return e};return ak.isFunction(t)?ok.connect(t,{connector:n}):function(e){return new rk.ConnectableObservable(e,n)}};var ik={},sk=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},lk=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(ik,"__esModule",{value:!0}),ik.onErrorResumeNext=ik.onErrorResumeNextWith=void 0;var ck=jb,uk=Db;function dk(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ck.argsOrArgArray(e);return function(e){return uk.onErrorResumeNext.apply(void 0,lk([e],sk(n)))}}ik.onErrorResumeNextWith=dk,ik.onErrorResumeNext=dk;var fk={};Object.defineProperty(fk,"__esModule",{value:!0}),fk.pairwise=void 0;var pk=Gp,hk=Vp;fk.pairwise=function(){return pk.operate((function(e,t){var n,r=!1;e.subscribe(hk.createOperatorSubscriber(t,(function(e){var a=n;n=e,r&&t.next([a,e]),r=!0})))}))};var mk={};Object.defineProperty(mk,"__esModule",{value:!0}),mk.pluck=void 0;var gk=Py;mk.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return gk.map((function(t){for(var r=t,a=0;a<n;a++){var o=null==r?void 0:r[e[a]];if(void 0===o)return;r=o}return r}))};var yk={};Object.defineProperty(yk,"__esModule",{value:!0}),yk.publish=void 0;var vk=fh,bk=nk,_k=lx;yk.publish=function(e){return e?function(t){return _k.connect(e)(t)}:function(e){return bk.multicast(new vk.Subject)(e)}};var wk={};Object.defineProperty(wk,"__esModule",{value:!0}),wk.publishBehavior=void 0;var xk=Sh,Sk=Up;wk.publishBehavior=function(e){return function(t){var n=new xk.BehaviorSubject(e);return new Sk.ConnectableObservable(t,(function(){return n}))}};var Ek={};Object.defineProperty(Ek,"__esModule",{value:!0}),Ek.publishLast=void 0;var kk=Ih,Ck=Up;Ek.publishLast=function(){return function(e){var t=new kk.AsyncSubject;return new Ck.ConnectableObservable(e,(function(){return t}))}};var Ak={};Object.defineProperty(Ak,"__esModule",{value:!0}),Ak.publishReplay=void 0;var Ok=Ch,Tk=nk,Nk=rp;Ak.publishReplay=function(e,t,n,r){n&&!Nk.isFunction(n)&&(r=n);var a=Nk.isFunction(n)?n:void 0;return function(n){return Tk.multicast(new Ok.ReplaySubject(e,t,r),a)(n)}};var Ik={},Rk=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Fk=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Ik,"__esModule",{value:!0}),Ik.raceWith=void 0;var Pk=e_,Mk=Gp,Dk=Tp;Ik.raceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?Mk.operate((function(t,n){Pk.raceInit(Fk([t],Rk(e)))(n)})):Dk.identity};var jk={};Object.defineProperty(jk,"__esModule",{value:!0}),jk.repeat=void 0;var Lk=Cm,qk=Gp,Bk=Vp,Uk=jm,zk=xb;jk.repeat=function(e){var t,n,r=Infinity;return null!=e&&("object"===W(e)?(r=void 0===(t=e.count)?Infinity:t,n=e.delay):r=e),r<=0?function(){return Lk.EMPTY}:qk.operate((function(e,t){var a,o=0,i=function(){if(null==a||a.unsubscribe(),a=null,null!=n){var e="number"==typeof n?zk.timer(n):Uk.innerFrom(n(o)),r=Bk.createOperatorSubscriber(t,(function(){r.unsubscribe(),s()}));e.subscribe(r)}else s()},s=function(){var n=!1;a=e.subscribe(Bk.createOperatorSubscriber(t,void 0,(function(){++o<r?a?i():n=!0:t.complete()}))),n&&i()};s()}))};var Gk={};Object.defineProperty(Gk,"__esModule",{value:!0}),Gk.repeatWhen=void 0;var Hk=jm,$k=fh,Vk=Gp,Wk=Vp;Gk.repeatWhen=function(e){return Vk.operate((function(t,n){var r,a,o=!1,i=!1,s=!1,l=function(){return s&&i&&(n.complete(),!0)},c=function(){return a||(a=new $k.Subject,Hk.innerFrom(e(a)).subscribe(Wk.createOperatorSubscriber(n,(function(){r?u():o=!0}),(function(){i=!0,l()})))),a},u=function e(){s=!1,r=t.subscribe(Wk.createOperatorSubscriber(n,void 0,(function(){s=!0,!l()&&c().next()}))),o&&(r.unsubscribe(),r=null,o=!1,e())};u()}))};var Jk={};Object.defineProperty(Jk,"__esModule",{value:!0}),Jk.retry=void 0;var Yk=Gp,Kk=Vp,Zk=Tp,Xk=xb,Qk=jm;Jk.retry=function(e){var t;void 0===e&&(e=Infinity);var n=(t=e&&"object"===W(e)?e:{count:e}).count,r=void 0===n?Infinity:n,a=t.delay,o=t.resetOnSuccess,i=void 0!==o&&o;return r<=0?Zk.identity:Yk.operate((function(e,t){var n,o=0;!function s(){var l=!1;n=e.subscribe(Kk.createOperatorSubscriber(t,(function(e){i&&(o=0),t.next(e)}),void 0,(function(e){if(o++<r){var i=function(){n?(n.unsubscribe(),n=null,s()):l=!0};if(null!=a){var c="number"==typeof a?Xk.timer(a):Qk.innerFrom(a(e,o)),u=Kk.createOperatorSubscriber(t,(function(){u.unsubscribe(),i()}),(function(){t.complete()}));c.subscribe(u)}else i()}else t.error(e)}))),l&&(n.unsubscribe(),n=null,s())}()}))};var eC={};Object.defineProperty(eC,"__esModule",{value:!0}),eC.retryWhen=void 0;var tC=jm,nC=fh,rC=Gp,aC=Vp;eC.retryWhen=function(e){return rC.operate((function(t,n){var r,a,o=!1;!function i(){r=t.subscribe(aC.createOperatorSubscriber(n,void 0,void 0,(function(t){a||(a=new nC.Subject,tC.innerFrom(e(a)).subscribe(aC.createOperatorSubscriber(n,(function(){return r?i():o=!0})))),a&&a.next(t)}))),o&&(r.unsubscribe(),r=null,o=!1,i())}()}))};var oC={};Object.defineProperty(oC,"__esModule",{value:!0}),oC.sample=void 0;var iC=jm,sC=Gp,lC=wp,cC=Vp;oC.sample=function(e){return sC.operate((function(t,n){var r=!1,a=null;t.subscribe(cC.createOperatorSubscriber(n,(function(e){r=!0,a=e}))),iC.innerFrom(e).subscribe(cC.createOperatorSubscriber(n,(function(){if(r){r=!1;var e=a;a=null,n.next(e)}}),lC.noop))}))};var uC={};Object.defineProperty(uC,"__esModule",{value:!0}),uC.sampleTime=void 0;var dC=im,fC=oC,pC=wb;uC.sampleTime=function(e,t){return void 0===t&&(t=dC.asyncScheduler),fC.sample(pC.interval(e,t))};var hC={};Object.defineProperty(hC,"__esModule",{value:!0}),hC.scan=void 0;var mC=Gp,gC=vw;hC.scan=function(e,t){return mC.operate(gC.scanInternals(e,t,arguments.length>=2,!0))};var yC={};Object.defineProperty(yC,"__esModule",{value:!0}),yC.sequenceEqual=void 0;var vC=Gp,bC=Vp,_C=jm;yC.sequenceEqual=function(e,t){return void 0===t&&(t=function(e,t){return e===t}),vC.operate((function(n,r){var a={buffer:[],complete:!1},o={buffer:[],complete:!1},i=function(e){r.next(e),r.complete()},s=function(e,n){var a=bC.createOperatorSubscriber(r,(function(r){var a=n.buffer;0===a.length?n.complete?i(!1):e.buffer.push(r):!t(r,a.shift())&&i(!1)}),(function(){e.complete=!0,n.complete&&i(0===n.buffer.length),null==a||a.unsubscribe()}));return a};n.subscribe(s(a,o)),_C.innerFrom(e).subscribe(s(o,a))}))};var wC={},xC=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},SC=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(wC,"__esModule",{value:!0}),wC.share=void 0;var EC=jm,kC=fh,CC=np,AC=Gp;function OC(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var a=new CC.SafeSubscriber({next:function(){a.unsubscribe(),e()}});return EC.innerFrom(t.apply(void 0,SC([],xC(n)))).subscribe(a)}}else e()}wC.share=function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new kC.Subject}:t,r=e.resetOnError,a=void 0===r||r,o=e.resetOnComplete,i=void 0===o||o,s=e.resetOnRefCountZero,l=void 0===s||s;return function(e){var t,r,o,s=0,c=!1,u=!1,d=function(){null==r||r.unsubscribe(),r=void 0},f=function(){d(),t=o=void 0,c=u=!1},p=function(){var e=t;f(),null==e||e.unsubscribe()};return AC.operate((function(e,h){s++,u||c||d();var m=o=null!=o?o:n();h.add((function(){0!=--s||u||c||(r=OC(p,l))})),m.subscribe(h),!t&&s>0&&(t=new CC.SafeSubscriber({next:function(e){return m.next(e)},error:function(e){u=!0,d(),r=OC(f,a,e),m.error(e)},complete:function(){c=!0,d(),r=OC(f,i),m.complete()}}),EC.innerFrom(e).subscribe(t))}))(e)}};var TC={};Object.defineProperty(TC,"__esModule",{value:!0}),TC.shareReplay=void 0;var NC=Ch,IC=wC;TC.shareReplay=function(e,t,n){var r,a,o,i,s=!1;return e&&"object"===W(e)?(i=void 0===(r=e.bufferSize)?Infinity:r,t=void 0===(a=e.windowTime)?Infinity:a,s=void 0!==(o=e.refCount)&&o,n=e.scheduler):i=null!=e?e:Infinity,IC.share({connector:function(){return new NC.ReplaySubject(i,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})};var RC={};Object.defineProperty(RC,"__esModule",{value:!0}),RC.single=void 0;var FC=wy,PC=Oy,MC=Ay,DC=Gp,jC=Vp;RC.single=function(e){return DC.operate((function(t,n){var r,a=!1,o=!1,i=0;t.subscribe(jC.createOperatorSubscriber(n,(function(s){o=!0,e&&!e(s,i++,t)||(a&&n.error(new PC.SequenceError("Too many matching values")),a=!0,r=s)}),(function(){a?(n.next(r),n.complete()):n.error(o?new MC.NotFoundError("No matching values"):new FC.EmptyError)})))}))};var LC={};Object.defineProperty(LC,"__esModule",{value:!0}),LC.skip=void 0;var qC=Jb;LC.skip=function(e){return qC.filter((function(t,n){return e<=n}))};var BC={};Object.defineProperty(BC,"__esModule",{value:!0}),BC.skipLast=void 0;var UC=Tp,zC=Gp,GC=Vp;BC.skipLast=function(e){return e<=0?UC.identity:zC.operate((function(t,n){var r=new Array(e),a=0;return t.subscribe(GC.createOperatorSubscriber(n,(function(t){var o=a++;if(o<e)r[o]=t;else{var i=o%e,s=r[i];r[i]=t,n.next(s)}}))),function(){r=null}}))};var HC={};Object.defineProperty(HC,"__esModule",{value:!0}),HC.skipUntil=void 0;var $C=Gp,VC=Vp,WC=jm,JC=wp;HC.skipUntil=function(e){return $C.operate((function(t,n){var r=!1,a=VC.createOperatorSubscriber(n,(function(){null==a||a.unsubscribe(),r=!0}),JC.noop);WC.innerFrom(e).subscribe(a),t.subscribe(VC.createOperatorSubscriber(n,(function(e){return r&&n.next(e)})))}))};var YC={};Object.defineProperty(YC,"__esModule",{value:!0}),YC.skipWhile=void 0;var KC=Gp,ZC=Vp;YC.skipWhile=function(e){return KC.operate((function(t,n){var r=!1,a=0;t.subscribe(ZC.createOperatorSubscriber(n,(function(t){return(r||(r=!e(t,a++)))&&n.next(t)})))}))};var XC={};Object.defineProperty(XC,"__esModule",{value:!0}),XC.startWith=void 0;var QC=gv,eA=Om,tA=Gp;XC.startWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=eA.popScheduler(e);return tA.operate((function(t,r){(n?QC.concat(e,t,n):QC.concat(e,t)).subscribe(r)}))};var nA={},rA={};Object.defineProperty(rA,"__esModule",{value:!0}),rA.switchMap=void 0;var aA=jm,oA=Gp,iA=Vp;rA.switchMap=function(e,t){return oA.operate((function(n,r){var a=null,o=0,i=!1,s=function(){return i&&!a&&r.complete()};n.subscribe(iA.createOperatorSubscriber(r,(function(n){null==a||a.unsubscribe();var i=0,l=o++;aA.innerFrom(e(n,l)).subscribe(a=iA.createOperatorSubscriber(r,(function(e){return r.next(t?t(n,e,l,i++):e)}),(function(){a=null,s()})))}),(function(){i=!0,s()})))}))},Object.defineProperty(nA,"__esModule",{value:!0}),nA.switchAll=void 0;var sA=rA,lA=Tp;nA.switchAll=function(){return sA.switchMap(lA.identity)};var cA={};Object.defineProperty(cA,"__esModule",{value:!0}),cA.switchMapTo=void 0;var uA=rA,dA=rp;cA.switchMapTo=function(e,t){return dA.isFunction(t)?uA.switchMap((function(){return e}),t):uA.switchMap((function(){return e}))};var fA={};Object.defineProperty(fA,"__esModule",{value:!0}),fA.switchScan=void 0;var pA=rA,hA=Gp;fA.switchScan=function(e,t){return hA.operate((function(n,r){var a=t;return pA.switchMap((function(t,n){return e(a,t,n)}),(function(e,t){return a=t,t}))(n).subscribe(r),function(){a=null}}))};var mA={};Object.defineProperty(mA,"__esModule",{value:!0}),mA.takeUntil=void 0;var gA=Gp,yA=Vp,vA=jm,bA=wp;mA.takeUntil=function(e){return gA.operate((function(t,n){vA.innerFrom(e).subscribe(yA.createOperatorSubscriber(n,(function(){return n.complete()}),bA.noop)),!n.closed&&t.subscribe(n)}))};var _A={};Object.defineProperty(_A,"__esModule",{value:!0}),_A.takeWhile=void 0;var wA=Gp,xA=Vp;_A.takeWhile=function(e,t){return void 0===t&&(t=!1),wA.operate((function(n,r){var a=0;n.subscribe(xA.createOperatorSubscriber(r,(function(n){var o=e(n,a++);(o||t)&&r.next(n),!o&&r.complete()})))}))};var SA={};Object.defineProperty(SA,"__esModule",{value:!0}),SA.tap=void 0;var EA=rp,kA=Gp,CA=Vp,AA=Tp;SA.tap=function(e,t,n){var r=EA.isFunction(e)||t||n?{next:e,error:t,complete:n}:e;return r?kA.operate((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var a=!0;e.subscribe(CA.createOperatorSubscriber(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;a=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;a=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;a&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):AA.identity};var OA={};Object.defineProperty(OA,"__esModule",{value:!0}),OA.throttle=void 0;var TA=Gp,NA=Vp,IA=jm;OA.throttle=function(e,t){return TA.operate((function(n,r){var a=null!=t?t:{},o=a.leading,i=void 0===o||o,s=a.trailing,l=void 0!==s&&s,c=!1,u=null,d=null,f=!1,p=function(){null==d||d.unsubscribe(),d=null,l&&(g(),f&&r.complete())},h=function(){d=null,f&&r.complete()},m=function(t){return d=IA.innerFrom(e(t)).subscribe(NA.createOperatorSubscriber(r,p,h))},g=function(){if(c){c=!1;var e=u;u=null,r.next(e),!f&&m(e)}};n.subscribe(NA.createOperatorSubscriber(r,(function(e){c=!0,u=e,(!d||d.closed)&&(i?g():m(e))}),(function(){f=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))};var RA={};Object.defineProperty(RA,"__esModule",{value:!0}),RA.throttleTime=void 0;var FA=im,PA=OA,MA=xb;RA.throttleTime=function(e,t,n){void 0===t&&(t=FA.asyncScheduler);var r=MA.timer(e,t);return PA.throttle((function(){return r}),n)};var DA={};Object.defineProperty(DA,"__esModule",{value:!0}),DA.TimeInterval=DA.timeInterval=void 0;var jA=im,LA=Gp,qA=Vp;DA.timeInterval=function(e){return void 0===e&&(e=jA.asyncScheduler),LA.operate((function(t,n){var r=e.now();t.subscribe(qA.createOperatorSubscriber(n,(function(t){var a=e.now(),o=a-r;r=a,n.next(new BA(t,o))})))}))};var BA=function(){return function(e,t){this.value=e,this.interval=t}}();DA.TimeInterval=BA;var UA={};Object.defineProperty(UA,"__esModule",{value:!0}),UA.timeoutWith=void 0;var zA=im,GA=Ny,HA=Ty;UA.timeoutWith=function(e,t,n){var r,a,o;if(n=null!=n?n:zA.async,GA.isValidDate(e)?r=e:"number"==typeof e&&(a=e),!t)throw new TypeError("No observable provided to switch to");if(o=function(){return t},null==r&&null==a)throw new TypeError("No timeout provided.");return HA.timeout({first:r,each:a,scheduler:n,with:o})};var $A={};Object.defineProperty($A,"__esModule",{value:!0}),$A.timestamp=void 0;var VA=Ah,WA=Py;$A.timestamp=function(e){return void 0===e&&(e=VA.dateTimestampProvider),WA.map((function(t){return{value:t,timestamp:e.now()}}))};var JA={};Object.defineProperty(JA,"__esModule",{value:!0}),JA.window=void 0;var YA=fh,KA=Gp,ZA=Vp,XA=wp,QA=jm;JA.window=function(e){return KA.operate((function(t,n){var r=new YA.Subject;n.next(r.asObservable());var a=function(e){r.error(e),n.error(e)};return t.subscribe(ZA.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.next(e)}),(function(){r.complete(),n.complete()}),a)),QA.innerFrom(e).subscribe(ZA.createOperatorSubscriber(n,(function(){r.complete(),n.next(r=new YA.Subject)}),XA.noop,a)),function(){null==r||r.unsubscribe(),r=null}}))};var eO={},tO=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(eO,"__esModule",{value:!0}),eO.windowCount=void 0;var nO=fh,rO=Gp,aO=Vp;eO.windowCount=function(e,t){void 0===t&&(t=0);var n=t>0?t:e;return rO.operate((function(t,r){var a=[new nO.Subject],o=0;r.next(a[0].asObservable()),t.subscribe(aO.createOperatorSubscriber(r,(function(t){var i,s;try{for(var l=tO(a),c=l.next();!c.done;c=l.next())c.value.next(t)}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}var u=o-e+1;if(u>=0&&u%n==0&&a.shift().complete(),++o%n==0){var d=new nO.Subject;a.push(d),r.next(d.asObservable())}}),(function(){for(;a.length>0;)a.shift().complete();r.complete()}),(function(e){for(;a.length>0;)a.shift().error(e);r.error(e)}),(function(){a=null})))}))};var oO={};Object.defineProperty(oO,"__esModule",{value:!0}),oO.windowTime=void 0;var iO=fh,sO=im,lO=ap,cO=Gp,uO=Vp,dO=sp,fO=Om,pO=kg;oO.windowTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=fO.popScheduler(r))&&void 0!==t?t:sO.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return cO.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.subs;e.window.complete(),t.unsubscribe(),dO.arrRemove(r,e),a&&c()},c=function(){if(r){var t=new lO.Subscription;n.add(t);var a=new iO.Subject,i={window:a,subs:t,seen:0};r.push(i),n.next(a.asObservable()),pO.executeSchedule(t,o,(function(){return l(i)}),e)}};null!==i&&i>=0?pO.executeSchedule(n,o,c,i,!0):a=!0,c();var u=function(e){return r.slice().forEach(e)},d=function(e){u((function(t){return e(t.window)})),e(n),n.unsubscribe()};return t.subscribe(uO.createOperatorSubscriber(n,(function(e){u((function(t){t.window.next(e),s<=++t.seen&&l(t)}))}),(function(){return d((function(e){return e.complete()}))}),(function(e){return d((function(t){return t.error(e)}))}))),function(){r=null}}))};var hO={},mO=M&&M.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(hO,"__esModule",{value:!0}),hO.windowToggle=void 0;var gO=fh,yO=ap,vO=Gp,bO=jm,_O=Vp,wO=wp,xO=sp;hO.windowToggle=function(e,t){return vO.operate((function(n,r){var a=[],o=function(e){for(;0<a.length;)a.shift().error(e);r.error(e)};bO.innerFrom(e).subscribe(_O.createOperatorSubscriber(r,(function(e){var n=new gO.Subject;a.push(n);var i,s=new yO.Subscription;try{i=bO.innerFrom(t(e))}catch(e){return void o(e)}r.next(n.asObservable()),s.add(i.subscribe(_O.createOperatorSubscriber(r,(function(){xO.arrRemove(a,n),n.complete(),s.unsubscribe()}),wO.noop,o)))}),wO.noop)),n.subscribe(_O.createOperatorSubscriber(r,(function(e){var t,n,r=a.slice();try{for(var o=mO(r),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;0<a.length;)a.shift().complete();r.complete()}),o,(function(){for(;0<a.length;)a.shift().unsubscribe()})))}))};var SO={};Object.defineProperty(SO,"__esModule",{value:!0}),SO.windowWhen=void 0;var EO=fh,kO=Gp,CO=Vp,AO=jm;SO.windowWhen=function(e){return kO.operate((function(t,n){var r,a,o=function(e){r.error(e),n.error(e)};!function t(){var i;null==a||a.unsubscribe(),null==r||r.complete(),r=new EO.Subject,n.next(r.asObservable());try{i=AO.innerFrom(e())}catch(e){return void o(e)}i.subscribe(a=CO.createOperatorSubscriber(n,t,t,o))}(),t.subscribe(CO.createOperatorSubscriber(n,(function(e){return r.next(e)}),(function(){r.complete(),n.complete()}),o,(function(){null==a||a.unsubscribe(),r=null})))}))};var OO={},TO=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},NO=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(OO,"__esModule",{value:!0}),OO.withLatestFrom=void 0;var IO=Gp,RO=Vp,FO=jm,PO=Tp,MO=wp,DO=Om;OO.withLatestFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=DO.popResultSelector(e);return IO.operate((function(t,r){for(var a=e.length,o=new Array(a),i=e.map((function(){return!1})),s=!1,l=function(t){FO.innerFrom(e[t]).subscribe(RO.createOperatorSubscriber(r,(function(e){o[t]=e,s||i[t]||(i[t]=!0,(s=i.every(PO.identity))&&(i=null))}),MO.noop))},c=0;c<a;c++)l(c);t.subscribe(RO.createOperatorSubscriber(r,(function(e){if(s){var t=NO([e],TO(o));r.next(n?n.apply(void 0,NO([],TO(t))):t)}})))}))};var jO={};Object.defineProperty(jO,"__esModule",{value:!0}),jO.zipAll=void 0;var LO=p_,qO=mw;jO.zipAll=function(e){return qO.joinAllInternals(LO.zip,e)};var BO={},UO={},zO=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},GO=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(UO,"__esModule",{value:!0}),UO.zip=void 0;var HO=p_,$O=Gp;UO.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $O.operate((function(t,n){HO.zip.apply(void 0,GO([t],zO(e))).subscribe(n)}))};var VO=M&&M.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},WO=M&&M.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(BO,"__esModule",{value:!0}),BO.zipWith=void 0;var JO=UO;BO.zipWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return JO.zip.apply(void 0,WO([],VO(e)))},function(e){var t=M&&M.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=M&&M.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.interval=e.iif=e.generate=e.fromEventPattern=e.fromEvent=e.from=e.forkJoin=e.empty=e.defer=e.connectable=e.concat=e.combineLatest=e.bindNodeCallback=e.bindCallback=e.UnsubscriptionError=e.TimeoutError=e.SequenceError=e.ObjectUnsubscribedError=e.NotFoundError=e.EmptyError=e.ArgumentOutOfRangeError=e.firstValueFrom=e.lastValueFrom=e.isObservable=e.identity=e.noop=e.pipe=e.NotificationKind=e.Notification=e.Subscriber=e.Subscription=e.Scheduler=e.VirtualAction=e.VirtualTimeScheduler=e.animationFrameScheduler=e.animationFrame=e.queueScheduler=e.queue=e.asyncScheduler=e.async=e.asapScheduler=e.asap=e.AsyncSubject=e.ReplaySubject=e.BehaviorSubject=e.Subject=e.animationFrames=e.observable=e.ConnectableObservable=e.Observable=void 0,e.filter=e.expand=e.exhaustMap=e.exhaustAll=e.exhaust=e.every=e.endWith=e.elementAt=e.distinctUntilKeyChanged=e.distinctUntilChanged=e.distinct=e.dematerialize=e.delayWhen=e.delay=e.defaultIfEmpty=e.debounceTime=e.debounce=e.count=e.connect=e.concatWith=e.concatMapTo=e.concatMap=e.concatAll=e.combineLatestWith=e.combineLatestAll=e.combineAll=e.catchError=e.bufferWhen=e.bufferToggle=e.bufferTime=e.bufferCount=e.buffer=e.auditTime=e.audit=e.config=e.NEVER=e.EMPTY=e.scheduled=e.zip=e.using=e.timer=e.throwError=e.range=e.race=e.partition=e.pairs=e.onErrorResumeNext=e.of=e.never=e.merge=void 0,e.switchMap=e.switchAll=e.subscribeOn=e.startWith=e.skipWhile=e.skipUntil=e.skipLast=e.skip=e.single=e.shareReplay=e.share=e.sequenceEqual=e.scan=e.sampleTime=e.sample=e.refCount=e.retryWhen=e.retry=e.repeatWhen=e.repeat=e.reduce=e.raceWith=e.publishReplay=e.publishLast=e.publishBehavior=e.publish=e.pluck=e.pairwise=e.onErrorResumeNextWith=e.observeOn=e.multicast=e.min=e.mergeWith=e.mergeScan=e.mergeMapTo=e.mergeMap=e.flatMap=e.mergeAll=e.max=e.materialize=e.mapTo=e.map=e.last=e.isEmpty=e.ignoreElements=e.groupBy=e.first=e.findIndex=e.find=e.finalize=void 0,e.zipWith=e.zipAll=e.withLatestFrom=e.windowWhen=e.windowToggle=e.windowTime=e.windowCount=e.window=e.toArray=e.timestamp=e.timeoutWith=e.timeout=e.timeInterval=e.throwIfEmpty=e.throttleTime=e.throttle=e.tap=e.takeWhile=e.takeUntil=e.takeLast=e.take=e.switchScan=e.switchMapTo=void 0;var r=tp;Object.defineProperty(e,"Observable",{enumerable:!0,get:function(){return r.Observable}});var a=Up;Object.defineProperty(e,"ConnectableObservable",{enumerable:!0,get:function(){return a.ConnectableObservable}});var o=Ap;Object.defineProperty(e,"observable",{enumerable:!0,get:function(){return o.observable}});var i=ah;Object.defineProperty(e,"animationFrames",{enumerable:!0,get:function(){return i.animationFrames}});var s=fh;Object.defineProperty(e,"Subject",{enumerable:!0,get:function(){return s.Subject}});var l=Sh;Object.defineProperty(e,"BehaviorSubject",{enumerable:!0,get:function(){return l.BehaviorSubject}});var c=Ch;Object.defineProperty(e,"ReplaySubject",{enumerable:!0,get:function(){return c.ReplaySubject}});var u=Ih;Object.defineProperty(e,"AsyncSubject",{enumerable:!0,get:function(){return u.AsyncSubject}});var d=Ph;Object.defineProperty(e,"asap",{enumerable:!0,get:function(){return d.asap}}),Object.defineProperty(e,"asapScheduler",{enumerable:!0,get:function(){return d.asapScheduler}});var f=im;Object.defineProperty(e,"async",{enumerable:!0,get:function(){return f.async}}),Object.defineProperty(e,"asyncScheduler",{enumerable:!0,get:function(){return f.asyncScheduler}});var p=sm;Object.defineProperty(e,"queue",{enumerable:!0,get:function(){return p.queue}}),Object.defineProperty(e,"queueScheduler",{enumerable:!0,get:function(){return p.queueScheduler}});var h=pm;Object.defineProperty(e,"animationFrame",{enumerable:!0,get:function(){return h.animationFrame}}),Object.defineProperty(e,"animationFrameScheduler",{enumerable:!0,get:function(){return h.animationFrameScheduler}});var m=_m;Object.defineProperty(e,"VirtualTimeScheduler",{enumerable:!0,get:function(){return m.VirtualTimeScheduler}}),Object.defineProperty(e,"VirtualAction",{enumerable:!0,get:function(){return m.VirtualAction}});var g=em;Object.defineProperty(e,"Scheduler",{enumerable:!0,get:function(){return g.Scheduler}});var y=ap;Object.defineProperty(e,"Subscription",{enumerable:!0,get:function(){return y.Subscription}});var v=np;Object.defineProperty(e,"Subscriber",{enumerable:!0,get:function(){return v.Subscriber}});var b=km;Object.defineProperty(e,"Notification",{enumerable:!0,get:function(){return b.Notification}}),Object.defineProperty(e,"NotificationKind",{enumerable:!0,get:function(){return b.NotificationKind}});var _=Op;Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return _.pipe}});var w=wp;Object.defineProperty(e,"noop",{enumerable:!0,get:function(){return w.noop}});var x=Tp;Object.defineProperty(e,"identity",{enumerable:!0,get:function(){return x.identity}});var S=yy;Object.defineProperty(e,"isObservable",{enumerable:!0,get:function(){return S.isObservable}});var E=_y;Object.defineProperty(e,"lastValueFrom",{enumerable:!0,get:function(){return E.lastValueFrom}});var k=Sy;Object.defineProperty(e,"firstValueFrom",{enumerable:!0,get:function(){return k.firstValueFrom}});var C=Cy;Object.defineProperty(e,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return C.ArgumentOutOfRangeError}});var A=wy;Object.defineProperty(e,"EmptyError",{enumerable:!0,get:function(){return A.EmptyError}});var O=Ay;Object.defineProperty(e,"NotFoundError",{enumerable:!0,get:function(){return O.NotFoundError}});var T=ph;Object.defineProperty(e,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return T.ObjectUnsubscribedError}});var N=Oy;Object.defineProperty(e,"SequenceError",{enumerable:!0,get:function(){return N.SequenceError}});var I=Ty;Object.defineProperty(e,"TimeoutError",{enumerable:!0,get:function(){return I.TimeoutError}});var R=op;Object.defineProperty(e,"UnsubscriptionError",{enumerable:!0,get:function(){return R.UnsubscriptionError}});var F=Iy;Object.defineProperty(e,"bindCallback",{enumerable:!0,get:function(){return F.bindCallback}});var P=Ky;Object.defineProperty(e,"bindNodeCallback",{enumerable:!0,get:function(){return P.bindNodeCallback}});var D=Xy;Object.defineProperty(e,"combineLatest",{enumerable:!0,get:function(){return D.combineLatest}});var j=gv;Object.defineProperty(e,"concat",{enumerable:!0,get:function(){return j.concat}});var L=Mv;Object.defineProperty(e,"connectable",{enumerable:!0,get:function(){return L.connectable}});var q=Dv;Object.defineProperty(e,"defer",{enumerable:!0,get:function(){return q.defer}});var B=Cm;Object.defineProperty(e,"empty",{enumerable:!0,get:function(){return B.empty}});var U=Gv;Object.defineProperty(e,"forkJoin",{enumerable:!0,get:function(){return U.forkJoin}});var z=Pm;Object.defineProperty(e,"from",{enumerable:!0,get:function(){return z.from}});var G=Zv;Object.defineProperty(e,"fromEvent",{enumerable:!0,get:function(){return G.fromEvent}});var H=cb;Object.defineProperty(e,"fromEventPattern",{enumerable:!0,get:function(){return H.fromEventPattern}});var $=pb;Object.defineProperty(e,"generate",{enumerable:!0,get:function(){return $.generate}});var V=bb;Object.defineProperty(e,"iif",{enumerable:!0,get:function(){return V.iif}});var W=wb;Object.defineProperty(e,"interval",{enumerable:!0,get:function(){return W.interval}});var J=Tb;Object.defineProperty(e,"merge",{enumerable:!0,get:function(){return J.merge}});var Y=Mb;Object.defineProperty(e,"never",{enumerable:!0,get:function(){return Y.never}});var K=Am;Object.defineProperty(e,"of",{enumerable:!0,get:function(){return K.of}});var Z=Db;Object.defineProperty(e,"onErrorResumeNext",{enumerable:!0,get:function(){return Z.onErrorResumeNext}});var X=Hb;Object.defineProperty(e,"pairs",{enumerable:!0,get:function(){return X.pairs}});var Q=Vb;Object.defineProperty(e,"partition",{enumerable:!0,get:function(){return Q.partition}});var ee=e_;Object.defineProperty(e,"race",{enumerable:!0,get:function(){return ee.race}});var te=i_;Object.defineProperty(e,"range",{enumerable:!0,get:function(){return te.range}});var ne=hy;Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return ne.throwError}});var re=xb;Object.defineProperty(e,"timer",{enumerable:!0,get:function(){return re.timer}});var ae=c_;Object.defineProperty(e,"using",{enumerable:!0,get:function(){return ae.using}});var oe=p_;Object.defineProperty(e,"zip",{enumerable:!0,get:function(){return oe.zip}});var ie=Mm;Object.defineProperty(e,"scheduled",{enumerable:!0,get:function(){return ie.scheduled}});var se=Cm;Object.defineProperty(e,"EMPTY",{enumerable:!0,get:function(){return se.EMPTY}});var le=Mb;Object.defineProperty(e,"NEVER",{enumerable:!0,get:function(){return le.NEVER}}),n(x_,e);var ce=gp;Object.defineProperty(e,"config",{enumerable:!0,get:function(){return ce.config}});var ue=S_;Object.defineProperty(e,"audit",{enumerable:!0,get:function(){return ue.audit}});var de=A_;Object.defineProperty(e,"auditTime",{enumerable:!0,get:function(){return de.auditTime}});var fe=I_;Object.defineProperty(e,"buffer",{enumerable:!0,get:function(){return fe.buffer}});var pe=D_;Object.defineProperty(e,"bufferCount",{enumerable:!0,get:function(){return pe.bufferCount}});var he=U_;Object.defineProperty(e,"bufferTime",{enumerable:!0,get:function(){return he.bufferTime}});var me=K_;Object.defineProperty(e,"bufferToggle",{enumerable:!0,get:function(){return me.bufferToggle}});var ge=aw;Object.defineProperty(e,"bufferWhen",{enumerable:!0,get:function(){return ge.bufferWhen}});var ye=cw;Object.defineProperty(e,"catchError",{enumerable:!0,get:function(){return ye.catchError}});var ve=pw;Object.defineProperty(e,"combineAll",{enumerable:!0,get:function(){return ve.combineAll}});var be=hw;Object.defineProperty(e,"combineLatestAll",{enumerable:!0,get:function(){return be.combineLatestAll}});var _e=Rw;Object.defineProperty(e,"combineLatestWith",{enumerable:!0,get:function(){return _e.combineLatestWith}});var we=yv;Object.defineProperty(e,"concatAll",{enumerable:!0,get:function(){return we.concatAll}});var xe=$w;Object.defineProperty(e,"concatMap",{enumerable:!0,get:function(){return xe.concatMap}});var Se=Jw;Object.defineProperty(e,"concatMapTo",{enumerable:!0,get:function(){return Se.concatMapTo}});var Ee=Zw;Object.defineProperty(e,"concatWith",{enumerable:!0,get:function(){return Ee.concatWith}});var ke=lx;Object.defineProperty(e,"connect",{enumerable:!0,get:function(){return ke.connect}});var Ce=gx;Object.defineProperty(e,"count",{enumerable:!0,get:function(){return Ce.count}});var Ae=vx;Object.defineProperty(e,"debounce",{enumerable:!0,get:function(){return Ae.debounce}});var Oe=Sx;Object.defineProperty(e,"debounceTime",{enumerable:!0,get:function(){return Oe.debounceTime}});var Te=Ax;Object.defineProperty(e,"defaultIfEmpty",{enumerable:!0,get:function(){return Te.defaultIfEmpty}});var Ne=Nx;Object.defineProperty(e,"delay",{enumerable:!0,get:function(){return Ne.delay}});var Ie=Ix;Object.defineProperty(e,"delayWhen",{enumerable:!0,get:function(){return Ie.delayWhen}});var Re=Zx;Object.defineProperty(e,"dematerialize",{enumerable:!0,get:function(){return Re.dematerialize}});var Fe=tS;Object.defineProperty(e,"distinct",{enumerable:!0,get:function(){return Fe.distinct}});var Pe=iS;Object.defineProperty(e,"distinctUntilChanged",{enumerable:!0,get:function(){return Pe.distinctUntilChanged}});var Me=dS;Object.defineProperty(e,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return Me.distinctUntilKeyChanged}});var De=pS;Object.defineProperty(e,"elementAt",{enumerable:!0,get:function(){return De.elementAt}});var je=ES;Object.defineProperty(e,"endWith",{enumerable:!0,get:function(){return je.endWith}});var Le=TS;Object.defineProperty(e,"every",{enumerable:!0,get:function(){return Le.every}});var qe=RS;Object.defineProperty(e,"exhaust",{enumerable:!0,get:function(){return qe.exhaust}});var Be=FS;Object.defineProperty(e,"exhaustAll",{enumerable:!0,get:function(){return Be.exhaustAll}});var Ue=PS;Object.defineProperty(e,"exhaustMap",{enumerable:!0,get:function(){return Ue.exhaustMap}});var ze=US;Object.defineProperty(e,"expand",{enumerable:!0,get:function(){return ze.expand}});var Ge=Jb;Object.defineProperty(e,"filter",{enumerable:!0,get:function(){return Ge.filter}});var He=HS;Object.defineProperty(e,"finalize",{enumerable:!0,get:function(){return He.finalize}});var $e=VS;Object.defineProperty(e,"find",{enumerable:!0,get:function(){return $e.find}});var Ve=KS;Object.defineProperty(e,"findIndex",{enumerable:!0,get:function(){return Ve.findIndex}});var We=QS;Object.defineProperty(e,"first",{enumerable:!0,get:function(){return We.first}});var Je=iE;Object.defineProperty(e,"groupBy",{enumerable:!0,get:function(){return Je.groupBy}});var Ye=Dx;Object.defineProperty(e,"ignoreElements",{enumerable:!0,get:function(){return Ye.ignoreElements}});var Ke=fE;Object.defineProperty(e,"isEmpty",{enumerable:!0,get:function(){return Ke.isEmpty}});var Ze=mE;Object.defineProperty(e,"last",{enumerable:!0,get:function(){return Ze.last}});var Xe=Py;Object.defineProperty(e,"map",{enumerable:!0,get:function(){return Xe.map}});var Qe=Bx;Object.defineProperty(e,"mapTo",{enumerable:!0,get:function(){return Qe.mapTo}});var et=AE;Object.defineProperty(e,"materialize",{enumerable:!0,get:function(){return et.materialize}});var tt=IE;Object.defineProperty(e,"max",{enumerable:!0,get:function(){return tt.max}});var nt=vv;Object.defineProperty(e,"mergeAll",{enumerable:!0,get:function(){return nt.mergeAll}});var rt=PE;Object.defineProperty(e,"flatMap",{enumerable:!0,get:function(){return rt.flatMap}});var at=bv;Object.defineProperty(e,"mergeMap",{enumerable:!0,get:function(){return at.mergeMap}});var ot=ME;Object.defineProperty(e,"mergeMapTo",{enumerable:!0,get:function(){return ot.mergeMapTo}});var it=LE;Object.defineProperty(e,"mergeScan",{enumerable:!0,get:function(){return it.mergeScan}});var st=UE;Object.defineProperty(e,"mergeWith",{enumerable:!0,get:function(){return st.mergeWith}});var lt=QE;Object.defineProperty(e,"min",{enumerable:!0,get:function(){return lt.min}});var ct=nk;Object.defineProperty(e,"multicast",{enumerable:!0,get:function(){return ct.multicast}});var ut=Eg;Object.defineProperty(e,"observeOn",{enumerable:!0,get:function(){return ut.observeOn}});var dt=ik;Object.defineProperty(e,"onErrorResumeNextWith",{enumerable:!0,get:function(){return dt.onErrorResumeNextWith}});var ft=fk;Object.defineProperty(e,"pairwise",{enumerable:!0,get:function(){return ft.pairwise}});var pt=mk;Object.defineProperty(e,"pluck",{enumerable:!0,get:function(){return pt.pluck}});var ht=yk;Object.defineProperty(e,"publish",{enumerable:!0,get:function(){return ht.publish}});var mt=wk;Object.defineProperty(e,"publishBehavior",{enumerable:!0,get:function(){return mt.publishBehavior}});var gt=Ek;Object.defineProperty(e,"publishLast",{enumerable:!0,get:function(){return gt.publishLast}});var yt=Ak;Object.defineProperty(e,"publishReplay",{enumerable:!0,get:function(){return yt.publishReplay}});var vt=Ik;Object.defineProperty(e,"raceWith",{enumerable:!0,get:function(){return vt.raceWith}});var bt=yw;Object.defineProperty(e,"reduce",{enumerable:!0,get:function(){return bt.reduce}});var _t=jk;Object.defineProperty(e,"repeat",{enumerable:!0,get:function(){return _t.repeat}});var wt=Gk;Object.defineProperty(e,"repeatWhen",{enumerable:!0,get:function(){return wt.repeatWhen}});var xt=Jk;Object.defineProperty(e,"retry",{enumerable:!0,get:function(){return xt.retry}});var St=eC;Object.defineProperty(e,"retryWhen",{enumerable:!0,get:function(){return St.retryWhen}});var Et=zp;Object.defineProperty(e,"refCount",{enumerable:!0,get:function(){return Et.refCount}});var kt=oC;Object.defineProperty(e,"sample",{enumerable:!0,get:function(){return kt.sample}});var Ct=uC;Object.defineProperty(e,"sampleTime",{enumerable:!0,get:function(){return Ct.sampleTime}});var At=hC;Object.defineProperty(e,"scan",{enumerable:!0,get:function(){return At.scan}});var Ot=yC;Object.defineProperty(e,"sequenceEqual",{enumerable:!0,get:function(){return Ot.sequenceEqual}});var Tt=wC;Object.defineProperty(e,"share",{enumerable:!0,get:function(){return Tt.share}});var Nt=TC;Object.defineProperty(e,"shareReplay",{enumerable:!0,get:function(){return Nt.shareReplay}});var It=RC;Object.defineProperty(e,"single",{enumerable:!0,get:function(){return It.single}});var Rt=LC;Object.defineProperty(e,"skip",{enumerable:!0,get:function(){return Rt.skip}});var Ft=BC;Object.defineProperty(e,"skipLast",{enumerable:!0,get:function(){return Ft.skipLast}});var Pt=HC;Object.defineProperty(e,"skipUntil",{enumerable:!0,get:function(){return Pt.skipUntil}});var Mt=YC;Object.defineProperty(e,"skipWhile",{enumerable:!0,get:function(){return Mt.skipWhile}});var Dt=XC;Object.defineProperty(e,"startWith",{enumerable:!0,get:function(){return Dt.startWith}});var jt=Tg;Object.defineProperty(e,"subscribeOn",{enumerable:!0,get:function(){return jt.subscribeOn}});var Lt=nA;Object.defineProperty(e,"switchAll",{enumerable:!0,get:function(){return Lt.switchAll}});var qt=rA;Object.defineProperty(e,"switchMap",{enumerable:!0,get:function(){return qt.switchMap}});var Bt=cA;Object.defineProperty(e,"switchMapTo",{enumerable:!0,get:function(){return Bt.switchMapTo}});var Ut=fA;Object.defineProperty(e,"switchScan",{enumerable:!0,get:function(){return Ut.switchScan}});var zt=Rx;Object.defineProperty(e,"take",{enumerable:!0,get:function(){return zt.take}});var Gt=gE;Object.defineProperty(e,"takeLast",{enumerable:!0,get:function(){return Gt.takeLast}});var Ht=mA;Object.defineProperty(e,"takeUntil",{enumerable:!0,get:function(){return Ht.takeUntil}});var $t=_A;Object.defineProperty(e,"takeWhile",{enumerable:!0,get:function(){return $t.takeWhile}});var Vt=SA;Object.defineProperty(e,"tap",{enumerable:!0,get:function(){return Vt.tap}});var Wt=OA;Object.defineProperty(e,"throttle",{enumerable:!0,get:function(){return Wt.throttle}});var Jt=RA;Object.defineProperty(e,"throttleTime",{enumerable:!0,get:function(){return Jt.throttleTime}});var Yt=hS;Object.defineProperty(e,"throwIfEmpty",{enumerable:!0,get:function(){return Yt.throwIfEmpty}});var Kt=DA;Object.defineProperty(e,"timeInterval",{enumerable:!0,get:function(){return Kt.timeInterval}});var Zt=Ty;Object.defineProperty(e,"timeout",{enumerable:!0,get:function(){return Zt.timeout}});var Xt=UA;Object.defineProperty(e,"timeoutWith",{enumerable:!0,get:function(){return Xt.timeoutWith}});var Qt=$A;Object.defineProperty(e,"timestamp",{enumerable:!0,get:function(){return Qt.timestamp}});var en=gw;Object.defineProperty(e,"toArray",{enumerable:!0,get:function(){return en.toArray}});var tn=JA;Object.defineProperty(e,"window",{enumerable:!0,get:function(){return tn.window}});var nn=eO;Object.defineProperty(e,"windowCount",{enumerable:!0,get:function(){return nn.windowCount}});var rn=oO;Object.defineProperty(e,"windowTime",{enumerable:!0,get:function(){return rn.windowTime}});var an=hO;Object.defineProperty(e,"windowToggle",{enumerable:!0,get:function(){return an.windowToggle}});var on=SO;Object.defineProperty(e,"windowWhen",{enumerable:!0,get:function(){return on.windowWhen}});var sn=OO;Object.defineProperty(e,"withLatestFrom",{enumerable:!0,get:function(){return sn.withLatestFrom}});var ln=jO;Object.defineProperty(e,"zipAll",{enumerable:!0,get:function(){return ln.zipAll}});var cn=BO;Object.defineProperty(e,"zipWith",{enumerable:!0,get:function(){return cn.zipWith}})}(ep),Object.defineProperty(Qf,"__esModule",{value:!0});var YO=Qf.checkAbortSignal=QO;Qf.abortBreakPoint=function(e){return tT.apply(this,arguments)},Qf.makeAbortError=nT,Qf.observeAbortSignal=function(e){return e?(0,ZO.fromEvent)(e,"abort"):new ZO.Observable};var KO=Qf.isAbortException=function(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))},ZO=ep,XO=function(e){ee(n,e);var t=le(n);function n(){return K(this,n),t.apply(this,arguments)}return X(n)}(oe(Error));function QO(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw nT()}}function eT(e){return new Promise((function(t){return setTimeout(t,e)}))}function tT(){return(tT=Y(V().mark((function e(t){return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eT(1);case 2:QO(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nT(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");var e=new XO("aborted");return e.code="ERR_ABORTED",e}var rT={exports:{}};!function(e,t){var n;n=function(){return function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){if(!s&&j)return j(i);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(e){return a(t[i][1][e]||e)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var o=j,i=0;i<r.length;i++)a(r[i]);return a}({"./aesprim":[function(e,t,n){var r;r=function(e){var t,n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function _(e){return e>=48&&e<=57}function w(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function x(e){return"01234567".indexOf(e)>=0}function S(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function E(e){return 10===e||13===e||8232===e||8233===e}function k(e){return 64==e||36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function C(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function A(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function O(e){return"eval"===e||"arguments"===e}function T(e,t,n,r,a){var o;b("number"==typeof n,"Comment must have valid position"),y.lastCommentStart>=n||(y.lastCommentStart=n,o={type:e,value:t},v.range&&(o.range=[n,r]),v.loc&&(o.loc=a),v.comments.push(o),v.attachComment&&(v.leadingComments.push(o),v.trailingComments.push(o)))}function N(e){var t,n,r,a;for(t=d-e,n={start:{line:f,column:d-p-e}};d<h;)if(r=c.charCodeAt(d),++d,E(r))return v.comments&&(a=c.slice(t+e,d-1),n.end={line:f,column:d-p-1},T("Line",a,t,d-1,n)),13===r&&10===c.charCodeAt(d)&&++d,++f,void(p=d);v.comments&&(a=c.slice(t+e,d),n.end={line:f,column:d-p},T("Line",a,t,d,n))}function I(){var e,t,n,r;for(v.comments&&(e=d-2,t={start:{line:f,column:d-p-2}});d<h;)if(E(n=c.charCodeAt(d)))13===n&&10===c.charCodeAt(d+1)&&++d,++f,++d,p=d,d>=h&&V({},i.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(d+1))return++d,++d,void(v.comments&&(r=c.slice(e+2,d-2),t.end={line:f,column:d-p},T("Block",r,e,d,t)));++d}else++d;V({},i.UnexpectedToken,"ILLEGAL")}function R(){var e,t;for(t=0===d;d<h;)if(S(e=c.charCodeAt(d)))++d;else if(E(e))++d,13===e&&10===c.charCodeAt(d)&&++d,++f,p=d,t=!0;else if(47===e)if(47===(e=c.charCodeAt(d+1)))++d,++d,N(2),t=!0;else{if(42!==e)break;++d,++d,I()}else if(t&&45===e){if(45!==c.charCodeAt(d+1)||62!==c.charCodeAt(d+2))break;d+=3,N(3)}else{if(60!==e)break;if("!--"!==c.slice(d+1,d+4))break;++d,++d,++d,++d,N(4)}}function F(e){var t,n,r,a=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(d<h&&w(c[d])))return"";r=c[d++],a=16*a+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(a)}function P(){var e,t;for(e=c.charCodeAt(d++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(d)&&V({},i.UnexpectedToken,"ILLEGAL"),++d,(e=F("u"))&&"\\"!==e&&k(e.charCodeAt(0))||V({},i.UnexpectedToken,"ILLEGAL"),t=e);d<h&&C(e=c.charCodeAt(d));)++d,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(d)&&V({},i.UnexpectedToken,"ILLEGAL"),++d,(e=F("u"))&&"\\"!==e&&C(e.charCodeAt(0))||V({},i.UnexpectedToken,"ILLEGAL"),t+=e);return t}function M(){var e,n,r,a,o=d,s=c.charCodeAt(d),l=c[d];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++d,v.tokenize&&(40===s?v.openParenToken=v.tokens.length:123===s&&(v.openCurlyToken=v.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:f,lineStart:p,start:o,end:d};default:if(61===(e=c.charCodeAt(d+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return d+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:f,lineStart:p,start:o,end:d};case 33:case 61:return 61===c.charCodeAt(d+=2)&&++d,{type:t.Punctuator,value:c.slice(o,d),lineNumber:f,lineStart:p,start:o,end:d}}}return">>>="===(a=c.substr(d,4))?{type:t.Punctuator,value:a,lineNumber:f,lineStart:p,start:o,end:d+=4}:">>>"===(r=a.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:f,lineStart:p,start:o,end:d+=3}:l===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(l)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:f,lineStart:p,start:o,end:d+=2}:"<>=!+-*%&|^/".indexOf(l)>=0?(++d,{type:t.Punctuator,value:l,lineNumber:f,lineStart:p,start:o,end:d}):void V({},i.UnexpectedToken,"ILLEGAL")}function D(){var e,n,r;if(b(_((r=c[d]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=d,e="","."!==r){if(e=c[d++],r=c[d],"0"===e){if("x"===r||"X"===r)return++d,function(e){for(var n="";d<h&&w(c[d]);)n+=c[d++];return 0===n.length&&V({},i.UnexpectedToken,"ILLEGAL"),k(c.charCodeAt(d))&&V({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:f,lineStart:p,start:e,end:d}}(n);if(x(r))return function(e){for(var n="0"+c[d++];d<h&&x(c[d]);)n+=c[d++];return(k(c.charCodeAt(d))||_(c.charCodeAt(d)))&&V({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:f,lineStart:p,start:e,end:d}}(n);r&&_(r.charCodeAt(0))&&V({},i.UnexpectedToken,"ILLEGAL")}for(;_(c.charCodeAt(d));)e+=c[d++];r=c[d]}if("."===r){for(e+=c[d++];_(c.charCodeAt(d));)e+=c[d++];r=c[d]}if("e"===r||"E"===r)if(e+=c[d++],"+"!==(r=c[d])&&"-"!==r||(e+=c[d++]),_(c.charCodeAt(d)))for(;_(c.charCodeAt(d));)e+=c[d++];else V({},i.UnexpectedToken,"ILLEGAL");return k(c.charCodeAt(d))&&V({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:f,lineStart:p,start:n,end:d}}function j(){var e,n,r,a;return g=null,R(),e=d,n=function(){var e,t,n,r;for(b("/"===(e=c[d]),"Regular expression literal must start with a slash"),t=c[d++],n=!1,r=!1;d<h;)if(t+=e=c[d++],"\\"===e)E((e=c[d++]).charCodeAt(0))&&V({},i.UnterminatedRegExp),t+=e;else if(E(e.charCodeAt(0)))V({},i.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||V({},i.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";d<h&&C((e=c[d]).charCodeAt(0));)if(++d,"\\"===e&&d<h)if("u"===(e=c[d])){if(r=++d,e=F("u"))for(n+=e,t+="\\u";r<d;++r)t+=c[r];else d=r,n+="u",t+="\\u";W({},i.UnexpectedToken,"ILLEGAL")}else t+="\\",W({},i.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),a=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){V({},i.InvalidRegExp)}return n}(n.value,r.value),v.tokenize?{type:t.RegularExpression,value:a,lineNumber:f,lineStart:p,start:e,end:d}:{literal:n.literal+r.literal,value:a,start:e,end:d}}function L(){var e,t,n,r;return R(),e=d,t={start:{line:f,column:d-p}},n=j(),t.end={line:f,column:d-p},v.tokenize||(v.tokens.length>0&&(r=v.tokens[v.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||v.tokens.pop()),v.tokens.push({type:"RegularExpression",value:n.literal,range:[e,d],loc:t})),n}function q(){var e,n,a;return R(),d>=h?{type:t.EOF,lineNumber:f,lineStart:p,start:d,end:d}:k(e=c.charCodeAt(d))?(n=d,a=92===c.charCodeAt(d)?P():function(){var e,t;for(e=d++;d<h;){if(92===(t=c.charCodeAt(d)))return d=e,P();if(!C(t))break;++d}return c.slice(e,d)}(),{type:1===a.length?t.Identifier:function(e){if(u&&A(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(a)?t.Keyword:"null"===a?t.NullLiteral:"true"===a||"false"===a?t.BooleanLiteral:t.Identifier,value:a,lineNumber:f,lineStart:p,start:n,end:d}):40===e||41===e||59===e?M():39===e||34===e?function(){var e,n,r,a,o,s,l,u,m="",g=!1;for(l=f,u=p,b("'"===(e=c[d])||'"'===e,"String literal must starts with a quote"),n=d,++d;d<h;){if((r=c[d++])===e){e="";break}if("\\"===r)if((r=c[d++])&&E(r.charCodeAt(0)))++f,"\r"===r&&"\n"===c[d]&&++d,p=d;else switch(r){case"u":case"x":s=d,(o=F(r))?m+=o:(d=s,m+=r);break;case"n":m+="\n";break;case"r":m+="\r";break;case"t":m+="\t";break;case"b":m+="\b";break;case"f":m+="\f";break;case"v":m+="\v";break;default:x(r)?(0!==(a="01234567".indexOf(r))&&(g=!0),d<h&&x(c[d])&&(g=!0,a=8*a+"01234567".indexOf(c[d++]),"0123".indexOf(r)>=0&&d<h&&x(c[d])&&(a=8*a+"01234567".indexOf(c[d++]))),m+=String.fromCharCode(a)):m+=r}else{if(E(r.charCodeAt(0)))break;m+=r}}return""!==e&&V({},i.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:m,octal:g,startLineNumber:l,startLineStart:u,lineNumber:f,lineStart:p,start:n,end:d}}():46===e?_(c.charCodeAt(d+1))?D():M():_(e)?D():v.tokenize&&47===e?function(){var e,t;if(!(e=v.tokens[v.tokens.length-1]))return L();if("Punctuator"===e.type){if("]"===e.value)return M();if(")"===e.value)return!(t=v.tokens[v.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?M():L();if("}"===e.value){if(v.tokens[v.openCurlyToken-3]&&"Keyword"===v.tokens[v.openCurlyToken-3].type){if(!(t=v.tokens[v.openCurlyToken-4]))return M()}else{if(!v.tokens[v.openCurlyToken-4]||"Keyword"!==v.tokens[v.openCurlyToken-4].type)return M();if(!(t=v.tokens[v.openCurlyToken-5]))return L()}return r.indexOf(t.value)>=0?M():L()}return L()}return"Keyword"===e.type?L():M()}():M()}function B(){var e,r,a;return R(),e={start:{line:f,column:d-p}},r=q(),e.end={line:f,column:d-p},r.type!==t.EOF&&(a=c.slice(r.start,r.end),v.tokens.push({type:n[r.type],value:a,range:[r.start,r.end],loc:e})),r}function U(){var e;return d=(e=g).end,f=e.lineNumber,p=e.lineStart,g=void 0!==v.tokens?B():q(),d=e.end,f=e.lineNumber,p=e.lineStart,e}function z(){var e,t,n;e=d,t=f,n=p,g=void 0!==v.tokens?B():q(),d=e,f=t,p=n}function G(e,t){this.line=e,this.column=t}function H(e,t,n,r){this.start=new G(e,t),this.end=new G(n,r)}function $(){var e,t,n,r;return e=d,t=f,n=p,R(),r=f!==t,d=e,f=t,p=n,r}function V(e,t){var n,r=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+a)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-p+1):((n=new Error("Line "+f+": "+a)).index=d,n.lineNumber=f,n.column=d-p+1),n.description=a,n}function W(){try{V.apply(null,arguments)}catch(e){if(!v.errors)throw e;v.errors.push(e)}}function J(e){if(e.type===t.EOF&&V(e,i.UnexpectedEOS),e.type===t.NumericLiteral&&V(e,i.UnexpectedNumber),e.type===t.StringLiteral&&V(e,i.UnexpectedString),e.type===t.Identifier&&V(e,i.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))V(e,i.UnexpectedReserved);else if(u&&A(e.value))return void W(e,i.StrictReservedWord);V(e,i.UnexpectedToken,e.value)}V(e,i.UnexpectedToken,e.value)}function Y(e){var n=U();n.type===t.Punctuator&&n.value===e||J(n)}function K(e){var n=U();n.type===t.Keyword&&n.value===e||J(n)}function Z(e){return g.type===t.Punctuator&&g.value===e}function X(e){return g.type===t.Keyword&&g.value===e}function Q(){var e;59===c.charCodeAt(d)||Z(";")?U():(e=f,R(),f===e&&(g.type===t.EOF||Z("}")||J(g)))}function ee(e){return e.type===a.Identifier||e.type===a.MemberExpression}function te(e,t){var n,r,a;return n=u,a=g,r=_e(),t&&u&&O(e[0].name)&&W(t,i.StrictParamName),u=n,m.markEnd(m.createFunctionExpression(null,e,[],r),a)}function ne(){var e,n;return n=g,(e=U()).type===t.StringLiteral||e.type===t.NumericLiteral?(u&&e.octal&&W(e,i.StrictOctalLiteral),m.markEnd(m.createLiteral(e),n)):m.markEnd(m.createIdentifier(e.value),n)}function re(){var e,n,r,a,o,s;return s=g,(e=g).type===t.Identifier?(r=ne(),"get"!==e.value||Z(":")?"set"!==e.value||Z(":")?(Y(":"),a=fe(),m.markEnd(m.createProperty("init",r,a),s)):(n=ne(),Y("("),(e=g).type!==t.Identifier?(Y(")"),W(e,i.UnexpectedToken,e.value),a=te([])):(o=[me()],Y(")"),a=te(o,e)),m.markEnd(m.createProperty("set",n,a),s)):(n=ne(),Y("("),Y(")"),a=te([]),m.markEnd(m.createProperty("get",n,a),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=ne(),Y(":"),a=fe(),m.markEnd(m.createProperty("init",n,a),s)):void J(e)}function ae(){var e,n,r,s;if(Z("("))return function(){var e;return Y("("),e=pe(),Y(")"),e}();if(Z("["))return function(){var e,t=[];for(e=g,Y("[");!Z("]");)Z(",")?(U(),t.push(null)):(t.push(fe()),Z("]")||Y(","));return U(),m.markEnd(m.createArrayExpression(t),e)}();if(Z("{"))return function(){var e,t,n,r,s,l=[],c={},d=String;for(s=g,Y("{");!Z("}");)t=(e=re()).key.type===a.Identifier?e.key.name:d(e.key.value),r="init"===e.kind?o.Data:"get"===e.kind?o.Get:o.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===o.Data?u&&r===o.Data?W({},i.StrictDuplicateProperty):r!==o.Data&&W({},i.AccessorDataProperty):r===o.Data?W({},i.AccessorDataProperty):c[n]&r&&W({},i.AccessorGetSet),c[n]|=r):c[n]=r,l.push(e),Z("}")||Y(",");return Y("}"),m.markEnd(m.createObjectExpression(l),s)}();if(s=g,(e=g.type)===t.Identifier)r=m.createIdentifier(U().value);else if(e===t.StringLiteral||e===t.NumericLiteral)u&&g.octal&&W(g,i.StrictOctalLiteral),r=m.createLiteral(U());else if(e===t.Keyword){if(X("function"))return function(){var e,t,n,r,a,o,s,l,c,d=null;return l=g,K("function"),Z("(")||(e=g,d=me(),u?O(e.value)&&W(e,i.StrictFunctionName):O(e.value)?(n=e,r=i.StrictFunctionName):A(e.value)&&(n=e,r=i.StrictReservedWord)),c=(a=we(n)).params,t=a.stricted,n=a.firstRestricted,a.message&&(r=a.message),s=u,o=_e(),u&&n&&V(n,r),u&&t&&W(t,r),u=s,m.markEnd(m.createFunctionExpression(d,c,[],o),l)}();X("this")?(U(),r=m.createThisExpression()):J(U())}else e===t.BooleanLiteral?((n=U()).value="true"===n.value,r=m.createLiteral(n)):e===t.NullLiteral?((n=U()).value=null,r=m.createLiteral(n)):Z("/")||Z("/=")?(r=m.createLiteral(void 0!==v.tokens?L():j()),z()):J(U());return m.markEnd(r,s)}function oe(){var e=[];if(Y("("),!Z(")"))for(;d<h&&(e.push(fe()),!Z(")"));)Y(",");return Y(")"),e}function ie(){return Y("."),function(){var e,n;return n=g,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=U())||J(e),m.markEnd(m.createIdentifier(e.value),n)}()}function se(){var e;return Y("["),e=pe(),Y("]"),e}function le(){var e,t,n;return n=g,K("new"),e=function(){var e,t,n,r;for(r=g,e=y.allowIn,t=X("new")?le():ae(),y.allowIn=e;Z(".")||Z("[");)Z("[")?(n=se(),t=m.createMemberExpression("[",t,n)):(n=ie(),t=m.createMemberExpression(".",t,n)),m.markEnd(t,r);return t}(),t=Z("(")?oe():[],m.markEnd(m.createNewExpression(e,t),n)}function ce(){var e,n,r=g;return e=function(){var e,t,n,r,a;for(a=g,e=y.allowIn,y.allowIn=!0,t=X("new")?le():ae(),y.allowIn=e;;){if(Z("."))r=ie(),t=m.createMemberExpression(".",t,r);else if(Z("("))n=oe(),t=m.createCallExpression(t,n);else{if(!Z("["))break;r=se(),t=m.createMemberExpression("[",t,r)}m.markEnd(t,a)}return t}(),g.type===t.Punctuator&&(!Z("++")&&!Z("--")||$()||(u&&e.type===a.Identifier&&O(e.name)&&W({},i.StrictLHSPostfix),ee(e)||W({},i.InvalidLHSInAssignment),n=U(),e=m.markEnd(m.createPostfixExpression(n.value,e),r))),e}function ue(){var e,n,r;return g.type!==t.Punctuator&&g.type!==t.Keyword?n=ce():Z("++")||Z("--")?(r=g,e=U(),n=ue(),u&&n.type===a.Identifier&&O(n.name)&&W({},i.StrictLHSPrefix),ee(n)||W({},i.InvalidLHSInAssignment),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):Z("+")||Z("-")||Z("~")||Z("!")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):X("delete")||X("void")||X("typeof")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r),u&&"delete"===n.operator&&n.argument.type===a.Identifier&&W({},i.StrictDelete)):n=ce(),n}function de(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function fe(){var e,n,r,o,s,l;return e=g,s=g,o=n=function(){var e,t,n,r,a;return a=g,e=function(){var e,t,n,r,a,o,i,s,l,c;if(e=g,l=ue(),0===(a=de(r=g,y.allowIn)))return l;for(r.prec=a,U(),t=[e,g],o=[l,r,i=ue()];(a=de(g,y.allowIn))>0;){for(;o.length>2&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,l=o.pop(),n=m.createBinaryExpression(s,l,i),t.pop(),m.markEnd(n,e=t[t.length-1]),o.push(n);(r=U()).prec=a,o.push(r),t.push(g),n=ue(),o.push(n)}for(n=o[c=o.length-1],t.pop();c>1;)n=m.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,e=t.pop(),m.markEnd(n,e);return n}(),Z("?")&&(U(),t=y.allowIn,y.allowIn=!0,n=fe(),y.allowIn=t,Y(":"),r=fe(),e=m.createConditionalExpression(e,n,r),m.markEnd(e,a)),e}(),g.type!==t.Punctuator||"="!==(l=g.value)&&"*="!==l&&"/="!==l&&"%="!==l&&"+="!==l&&"-="!==l&&"<<="!==l&&">>="!==l&&">>>="!==l&&"&="!==l&&"^="!==l&&"|="!==l||(ee(n)||W({},i.InvalidLHSInAssignment),u&&n.type===a.Identifier&&O(n.name)&&W(e,i.StrictLHSAssignment),e=U(),r=fe(),o=m.markEnd(m.createAssignmentExpression(e.value,n,r),s)),o}function pe(){var e,t=g;if(e=fe(),Z(",")){for(e=m.createSequenceExpression([e]);d<h&&Z(",");)U(),e.expressions.push(fe());m.markEnd(e,t)}return e}function he(){var e,t;return t=g,Y("{"),e=function(){for(var e,t=[];d<h&&!Z("}")&&void 0!==(e=Se());)t.push(e);return t}(),Y("}"),m.markEnd(m.createBlockStatement(e),t)}function me(){var e,n;return n=g,(e=U()).type!==t.Identifier&&J(e),m.markEnd(m.createIdentifier(e.value),n)}function ge(e){var t,n,r=null;return n=g,t=me(),u&&O(t.name)&&W({},i.StrictVarName),"const"===e?(Y("="),r=fe()):Z("=")&&(U(),r=fe()),m.markEnd(m.createVariableDeclarator(t,r),n)}function ye(e){var t=[];do{if(t.push(ge(e)),!Z(","))break;U()}while(d<h);return t}function ve(){var e,t,n,r=[];for(n=g,X("default")?(U(),e=null):(K("case"),e=pe()),Y(":");d<h&&!(Z("}")||X("default")||X("case"));)t=be(),r.push(t);return m.markEnd(m.createSwitchCase(e,r),n)}function be(){var e,n,r,o,s,l,f,p,v,b,_=g.type;if(_===t.EOF&&J(g),_===t.Punctuator&&"{"===g.value)return he();if(o=g,_===t.Punctuator)switch(g.value){case";":return m.markEnd((Y(";"),m.createEmptyStatement()),o);case"(":return m.markEnd(function(){var e=pe();return Q(),m.createExpressionStatement(e)}(),o)}if(_===t.Keyword)switch(g.value){case"break":return m.markEnd((b=null,K("break"),59===c.charCodeAt(d)?(U(),y.inIteration||y.inSwitch||V({},i.IllegalBreak),m.createBreakStatement(null)):$()?(y.inIteration||y.inSwitch||V({},i.IllegalBreak),m.createBreakStatement(null)):(g.type===t.Identifier&&(b=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+b.name)||V({},i.UnknownLabel,b.name)),Q(),null!==b||y.inIteration||y.inSwitch||V({},i.IllegalBreak),m.createBreakStatement(b))),o);case"continue":return m.markEnd(function(){var e=null;return K("continue"),59===c.charCodeAt(d)?(U(),y.inIteration||V({},i.IllegalContinue),m.createContinueStatement(null)):$()?(y.inIteration||V({},i.IllegalContinue),m.createContinueStatement(null)):(g.type===t.Identifier&&(e=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+e.name)||V({},i.UnknownLabel,e.name)),Q(),null!==e||y.inIteration||V({},i.IllegalContinue),m.createContinueStatement(e))}(),o);case"debugger":return m.markEnd((K("debugger"),Q(),m.createDebuggerStatement()),o);case"do":return m.markEnd((K("do"),v=y.inIteration,y.inIteration=!0,f=be(),y.inIteration=v,K("while"),Y("("),p=pe(),Y(")"),Z(";")&&U(),m.createDoWhileStatement(f,p)),o);case"for":return m.markEnd(function(){var e,t,n,r,a,o,s;return e=t=n=null,K("for"),Y("("),Z(";")?U():(X("var")||X("let")?(y.allowIn=!1,e=function(){var e,t,n;return n=g,e=U(),t=ye(),m.markEnd(m.createVariableDeclaration(t,e.value),n)}(),y.allowIn=!0,1===e.declarations.length&&X("in")&&(U(),r=e,a=pe(),e=null)):(y.allowIn=!1,e=pe(),y.allowIn=!0,X("in")&&(ee(e)||W({},i.InvalidLHSInForIn),U(),r=e,a=pe(),e=null)),void 0===r&&Y(";")),void 0===r&&(Z(";")||(t=pe()),Y(";"),Z(")")||(n=pe())),Y(")"),s=y.inIteration,y.inIteration=!0,o=be(),y.inIteration=s,void 0===r?m.createForStatement(e,t,n,o):m.createForInStatement(r,a,o)}(),o);case"function":return m.markEnd(xe(),o);case"if":return m.markEnd(function(){var e,t,n;return K("if"),Y("("),e=pe(),Y(")"),t=be(),X("else")?(U(),n=be()):n=null,m.createIfStatement(e,t,n)}(),o);case"return":return m.markEnd((l=null,K("return"),y.inFunctionBody||W({},i.IllegalReturn),32===c.charCodeAt(d)&&k(c.charCodeAt(d+1))?(l=pe(),Q(),m.createReturnStatement(l)):$()?m.createReturnStatement(null):(Z(";")||Z("}")||g.type===t.EOF||(l=pe()),Q(),m.createReturnStatement(l))),o);case"switch":return m.markEnd(function(){var e,t,n,r,a;if(K("switch"),Y("("),e=pe(),Y(")"),Y("{"),t=[],Z("}"))return U(),m.createSwitchStatement(e,t);for(r=y.inSwitch,y.inSwitch=!0,a=!1;d<h&&!Z("}");)null===(n=ve()).test&&(a&&V({},i.MultipleDefaultsInSwitch),a=!0),t.push(n);return y.inSwitch=r,Y("}"),m.createSwitchStatement(e,t)}(),o);case"throw":return m.markEnd(function(){var e;return K("throw"),$()&&V({},i.NewlineAfterThrow),e=pe(),Q(),m.createThrowStatement(e)}(),o);case"try":return m.markEnd(function(){var e,t,n,r,a=[],o=null;return K("try"),e=he(),X("catch")&&a.push((r=g,K("catch"),Y("("),Z(")")&&J(g),t=me(),u&&O(t.name)&&W({},i.StrictCatchVariable),Y(")"),n=he(),m.markEnd(m.createCatchClause(t,n),r))),X("finally")&&(U(),o=he()),0!==a.length||o||V({},i.NoCatchOrFinally),m.createTryStatement(e,[],a,o)}(),o);case"var":return m.markEnd((K("var"),s=ye(),Q(),m.createVariableDeclaration(s,"var")),o);case"while":return m.markEnd(function(){var e,t,n;return K("while"),Y("("),e=pe(),Y(")"),n=y.inIteration,y.inIteration=!0,t=be(),y.inIteration=n,m.createWhileStatement(e,t)}(),o);case"with":return m.markEnd(function(){var e,t;return u&&(R(),W({},i.StrictModeWith)),K("with"),Y("("),e=pe(),Y(")"),t=be(),m.createWithStatement(e,t)}(),o)}return(e=pe()).type===a.Identifier&&Z(":")?(U(),r="$"+e.name,Object.prototype.hasOwnProperty.call(y.labelSet,r)&&V({},i.Redeclaration,"Label",e.name),y.labelSet[r]=!0,n=be(),delete y.labelSet[r],m.markEnd(m.createLabeledStatement(e,n),o)):(Q(),m.markEnd(m.createExpressionStatement(e),o))}function _e(){var e,n,r,o,s,l,f,p,v=[];for(p=g,Y("{");d<h&&g.type===t.StringLiteral&&(n=g,e=Se(),v.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&W(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(o=y.labelSet,s=y.inIteration,l=y.inSwitch,f=y.inFunctionBody,y.labelSet={},y.inIteration=!1,y.inSwitch=!1,y.inFunctionBody=!0;d<h&&!Z("}")&&void 0!==(e=Se());)v.push(e);return Y("}"),y.labelSet=o,y.inIteration=s,y.inSwitch=l,y.inFunctionBody=f,m.markEnd(m.createBlockStatement(v),p)}function we(e){var t,n,r,a,o,s,l=[];if(Y("("),!Z(")"))for(a={};d<h&&(n=g,t=me(),o="$"+n.value,u?(O(n.value)&&(r=n,s=i.StrictParamName),Object.prototype.hasOwnProperty.call(a,o)&&(r=n,s=i.StrictParamDupe)):e||(O(n.value)?(e=n,s=i.StrictParamName):A(n.value)?(e=n,s=i.StrictReservedWord):Object.prototype.hasOwnProperty.call(a,o)&&(e=n,s=i.StrictParamDupe)),l.push(t),a[o]=!0,!Z(")"));)Y(",");return Y(")"),{params:l,stricted:r,firstRestricted:e,message:s}}function xe(){var e,t,n,r,a,o,s,l,c,d;return d=g,K("function"),r=g,e=me(),u?O(r.value)&&W(r,i.StrictFunctionName):O(r.value)?(s=r,l=i.StrictFunctionName):A(r.value)&&(s=r,l=i.StrictReservedWord),t=(o=we(s)).params,a=o.stricted,s=o.firstRestricted,o.message&&(l=o.message),c=u,n=_e(),u&&s&&V(s,l),u&&a&&W(a,l),u=c,m.markEnd(m.createFunctionDeclaration(e,t,[],n),d)}function Se(){if(g.type===t.Keyword)switch(g.value){case"const":case"let":return r=g,K(e=g.value),n=ye(e),Q(),m.markEnd(m.createVariableDeclaration(n,e),r);case"function":return xe();default:return be()}var e,n,r;if(g.type!==t.EOF)return be()}function Ee(){var e,t,n,r=[];for(e=0;e<v.tokens.length;++e)n={type:(t=v.tokens[e]).type,value:t.value},v.range&&(n.range=t.range),v.loc&&(n.loc=t.loc),r.push(n);v.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],a={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},o={Data:1,Get:2,Set:4},i={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},l={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===a.Program&&e.body.length>0)){for(v.trailingComments.length>0?v.trailingComments[0].range[0]>=e.range[1]?(n=v.trailingComments,v.trailingComments=[]):v.trailingComments.length=0:v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=v.bottomRightStack[v.bottomRightStack.length-1].trailingComments,delete v.bottomRightStack[v.bottomRightStack.length-1].trailingComments);v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].range[0]>=e.range[0];)t=v.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):v.leadingComments.length>0&&v.leadingComments[v.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=v.leadingComments,v.leadingComments=[]),n&&(e.trailingComments=n),v.bottomRightStack.push(e)}},markEnd:function(e,t){return v.range&&(e.range=[t.start,d]),v.loc&&(e.loc=new H(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),f,d-p),this.postProcess(e)),v.attachComment&&this.processComment(e),e},postProcess:function(e){return v.source&&(e.loc.source=v.source),e},createArrayExpression:function(e){return{type:a.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:a.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?a.LogicalExpression:a.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:a.BlockStatement,body:e}},createBreakStatement:function(e){return{type:a.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:a.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:a.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:a.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:a.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:a.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:a.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:a.EmptyStatement}},createExpressionStatement:function(e){return{type:a.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:a.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:a.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:a.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:a.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:a.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:a.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:a.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:a.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:a.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:a.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:a.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:a.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:a.Program,body:e}},createProperty:function(e,t,n){return{type:a.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:a.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:a.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:a.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:a.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:a.ThisExpression}},createThrowStatement:function(e){return{type:a.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:a.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:a.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:a.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:a.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:a.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:a.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:a.WithStatement,object:e,body:t}}},e.version="1.2.2",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),m=l,d=0,f=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},(n=n||{}).tokens=!0,v.tokens=[],v.tokenize=!0,v.openParenToken=-1,v.openCurlyToken=-1,v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]);try{if(z(),g.type===t.EOF)return v.tokens;for(U();g.type!==t.EOF;)try{U()}catch(e){if(v.errors){v.errors.push(e);break}throw e}Ee(),r=v.tokens,void 0!==v.comments&&(r.comments=v.comments),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.parse=function(e,n){var r,o,s,b;o=String,"string"==typeof e||e instanceof String||(e=o(e)),m=l,d=0,f=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},void 0!==n&&(v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,v.attachComment="boolean"==typeof n.attachComment&&n.attachComment,v.loc&&null!=n.source&&(v.source=o(n.source)),"boolean"==typeof n.tokens&&n.tokens&&(v.tokens=[]),"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]),v.attachComment&&(v.range=!0,v.comments=[],v.bottomRightStack=[],v.trailingComments=[],v.leadingComments=[]));try{R(),z(),b=g,u=!1,s=function(){for(var e,n,r,o=[];d<h&&(n=g).type===t.StringLiteral&&(e=Se(),o.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&W(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;d<h&&void 0!==(e=Se());)o.push(e);return o}(),r=m.markEnd(m.createProgram(s),b),void 0!==v.comments&&(r.comments=v.comments),void 0!==v.tokens&&(Ee(),r.tokens=v.tokens),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),a)a.hasOwnProperty(e)&&(t[e]=a[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()},r(void 0!==n?n:this.esprima={})},{}],1:[function(e,t,n){(function(r){var a=function(){var e={trace:function(){},yy:{},symbols_:{error:2,JSON_PATH:3,DOLLAR:4,PATH_COMPONENTS:5,LEADING_CHILD_MEMBER_EXPRESSION:6,PATH_COMPONENT:7,MEMBER_COMPONENT:8,SUBSCRIPT_COMPONENT:9,CHILD_MEMBER_COMPONENT:10,DESCENDANT_MEMBER_COMPONENT:11,DOT:12,MEMBER_EXPRESSION:13,DOT_DOT:14,STAR:15,IDENTIFIER:16,SCRIPT_EXPRESSION:17,INTEGER:18,END:19,CHILD_SUBSCRIPT_COMPONENT:20,DESCENDANT_SUBSCRIPT_COMPONENT:21,"[":22,SUBSCRIPT:23,"]":24,SUBSCRIPT_EXPRESSION:25,SUBSCRIPT_EXPRESSION_LIST:26,SUBSCRIPT_EXPRESSION_LISTABLE:27,",":28,STRING_LITERAL:29,ARRAY_SLICE:30,FILTER_EXPRESSION:31,QQ_STRING:32,Q_STRING:33,$accept:0,$end:1},terminals_:{2:"error",4:"DOLLAR",12:"DOT",14:"DOT_DOT",15:"STAR",16:"IDENTIFIER",17:"SCRIPT_EXPRESSION",18:"INTEGER",19:"END",22:"[",24:"]",28:",",30:"ARRAY_SLICE",31:"FILTER_EXPRESSION",32:"QQ_STRING",33:"Q_STRING"},productions_:[0,[3,1],[3,2],[3,1],[3,2],[5,1],[5,2],[7,1],[7,1],[8,1],[8,1],[10,2],[6,1],[11,2],[13,1],[13,1],[13,1],[13,1],[13,1],[9,1],[9,1],[20,3],[21,4],[23,1],[23,1],[26,1],[26,3],[27,1],[27,1],[27,1],[25,1],[25,1],[25,1],[29,1],[29,1]],performAction:function(e,n,r,a,o,i,s){a.ast||(a.ast=t,t.initialize());var l=i.length-1;switch(o){case 1:return a.ast.set({expression:{type:"root",value:i[l]}}),a.ast.unshift(),a.ast.yield();case 2:return a.ast.set({expression:{type:"root",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 3:return a.ast.unshift(),a.ast.yield();case 4:return a.ast.set({operation:"member",scope:"child",expression:{type:"identifier",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 5:case 6:case 11:case 13:case 18:case 21:case 22:case 23:break;case 7:a.ast.set({operation:"member"}),a.ast.push();break;case 8:a.ast.set({operation:"subscript"}),a.ast.push();break;case 9:case 19:a.ast.set({scope:"child"});break;case 10:case 20:a.ast.set({scope:"descendant"});break;case 12:a.ast.set({scope:"child",operation:"member"});break;case 14:a.ast.set({expression:{type:"wildcard",value:i[l]}});break;case 15:a.ast.set({expression:{type:"identifier",value:i[l]}});break;case 16:a.ast.set({expression:{type:"script_expression",value:i[l]}});break;case 17:a.ast.set({expression:{type:"numeric_literal",value:parseInt(i[l])}});break;case 24:i[l].length>1?a.ast.set({expression:{type:"union",value:i[l]}}):this.$=i[l];break;case 25:this.$=[i[l]];break;case 26:this.$=i[l-2].concat(i[l]);break;case 27:this.$={expression:{type:"numeric_literal",value:parseInt(i[l])}},a.ast.set(this.$);break;case 28:this.$={expression:{type:"string_literal",value:i[l]}},a.ast.set(this.$);break;case 29:this.$={expression:{type:"slice",value:i[l]}},a.ast.set(this.$);break;case 30:this.$={expression:{type:"wildcard",value:i[l]}},a.ast.set(this.$);break;case 31:this.$={expression:{type:"script_expression",value:i[l]}},a.ast.set(this.$);break;case 32:this.$={expression:{type:"filter_expression",value:i[l]}},a.ast.set(this.$);break;case 33:case 34:this.$=i[l]}},table:[{3:1,4:[1,2],6:3,13:4,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{1:[3]},{1:[2,1],5:10,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,3],5:21,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,12],12:[2,12],14:[2,12],22:[2,12]},{1:[2,14],12:[2,14],14:[2,14],22:[2,14]},{1:[2,15],12:[2,15],14:[2,15],22:[2,15]},{1:[2,16],12:[2,16],14:[2,16],22:[2,16]},{1:[2,17],12:[2,17],14:[2,17],22:[2,17]},{1:[2,18],12:[2,18],14:[2,18],22:[2,18]},{1:[2,2],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,5],12:[2,5],14:[2,5],22:[2,5]},{1:[2,7],12:[2,7],14:[2,7],22:[2,7]},{1:[2,8],12:[2,8],14:[2,8],22:[2,8]},{1:[2,9],12:[2,9],14:[2,9],22:[2,9]},{1:[2,10],12:[2,10],14:[2,10],22:[2,10]},{1:[2,19],12:[2,19],14:[2,19],22:[2,19]},{1:[2,20],12:[2,20],14:[2,20],22:[2,20]},{13:23,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{13:24,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9],22:[1,25]},{15:[1,29],17:[1,30],18:[1,33],23:26,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{1:[2,4],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,6],12:[2,6],14:[2,6],22:[2,6]},{1:[2,11],12:[2,11],14:[2,11],22:[2,11]},{1:[2,13],12:[2,13],14:[2,13],22:[2,13]},{15:[1,29],17:[1,30],18:[1,33],23:38,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{24:[1,39]},{24:[2,23]},{24:[2,24],28:[1,40]},{24:[2,30]},{24:[2,31]},{24:[2,32]},{24:[2,25],28:[2,25]},{24:[2,27],28:[2,27]},{24:[2,28],28:[2,28]},{24:[2,29],28:[2,29]},{24:[2,33],28:[2,33]},{24:[2,34],28:[2,34]},{24:[1,41]},{1:[2,21],12:[2,21],14:[2,21],22:[2,21]},{18:[1,33],27:42,29:34,30:[1,35],32:[1,36],33:[1,37]},{1:[2,22],12:[2,22],14:[2,22],22:[2,22]},{24:[2,26],28:[2,26]}],defaultActions:{27:[2,23],29:[2,30],30:[2,31],31:[2,32]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,n=[0],r=[null],a=[],o=this.table,i="",s=0,l=0,c=a.slice.call(arguments,1);this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;a.push(u);var d=this.lexer.options&&this.lexer.options.ranges;function f(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}this.parseError="function"==typeof this.yy.parseError?this.yy.parseError:Object.getPrototypeOf(this).parseError;for(var p,h,m,g,y,v,b,_={};;){if(this.defaultActions[h=n[n.length-1]]?m=this.defaultActions[h]:(null==p&&(p=f()),m=o[h]&&o[h][p]),void 0===m||!m.length||!m[0]){var w;for(y in b=[],o[h])this.terminals_[y]&&y>2&&b.push("'"+this.terminals_[y]+"'");w=this.lexer.showPosition?"Parse error on line "+(s+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(s+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:b})}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+p);switch(m[0]){case 1:n.push(p),r.push(this.lexer.yytext),a.push(this.lexer.yylloc),n.push(m[1]),p=null,l=this.lexer.yyleng,i=this.lexer.yytext,s=this.lexer.yylineno,u=this.lexer.yylloc;break;case 2:if(_.$=r[r.length-(v=this.productions_[m[1]][1])],_._$={first_line:a[a.length-(v||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(v||1)].first_column,last_column:a[a.length-1].last_column},d&&(_._$.range=[a[a.length-(v||1)].range[0],a[a.length-1].range[1]]),void 0!==(g=this.performAction.apply(_,[i,l,s,this.yy,m[1],r,a].concat(c))))return g;v&&(n=n.slice(0,-1*v*2),r=r.slice(0,-1*v),a=a.slice(0,-1*v)),n.push(this.productions_[m[1]][0]),r.push(_.$),a.push(_._$),n.push(o[n[n.length-2]][n[n.length-1]]);break;case 3:return!0}}return!0}},t={initialize:function(){this._nodes=[],this._node={},this._stash=[]},set:function(e){for(var t in e)this._node[t]=e[t];return this._node},node:function(e){return arguments.length&&(this._node=e),this._node},push:function(){this._nodes.push(this._node),this._node={}},unshift:function(){this._nodes.unshift(this._node),this._node={}},yield:function(){var e=this._nodes;return this.initialize(),e}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in a)this[o]=a[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),o=0;o<a.length;o++)if((n=this._input.match(this.rules[a[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,a[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,r){switch(n){case 0:return 4;case 1:return 14;case 2:return 12;case 3:return 15;case 4:return 16;case 5:return 22;case 6:return 24;case 7:return 28;case 8:return 30;case 9:return 18;case 10:return t.yytext=t.yytext.substr(1,t.yyleng-2),32;case 11:return t.yytext=t.yytext.substr(1,t.yyleng-2),33;case 12:return 17;case 13:return 31}},rules:[/^(?:\$)/,/^(?:\.\.)/,/^(?:\.)/,/^(?:\*)/,/^(?:[a-zA-Z_]+[a-zA-Z0-9_]*)/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?:((-?(?:0|[1-9][0-9]*)))?\:((-?(?:0|[1-9][0-9]*)))?(\:((-?(?:0|[1-9][0-9]*)))?)?)/,/^(?:(-?(?:0|[1-9][0-9]*)))/,/^(?:"(?:\\["bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^"\\])*")/,/^(?:'(?:\\['bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^'\\])*')/,/^(?:\(.+?\)(?=\]))/,/^(?:\?\(.+?\)(?=\]))/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return e}();function r(){this.yy={}}return e.lexer=n,r.prototype=e,e.Parser=r,new r}();void 0!==e&&void 0!==n&&(n.parser=a,n.Parser=a.Parser,n.parse=function(){return a.parse.apply(a,arguments)},n.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),r.exit(1));var a=e("fs").readFileSync(e("path").normalize(t[1]),"utf8");return n.parser.parse(a)},void 0!==t&&e.main===t&&n.main(r.argv.slice(1)))}).call(this,e("_process"))},{_process:14,fs:12,path:13}],2:[function(e,t,n){t.exports={identifier:"[a-zA-Z_]+[a-zA-Z0-9_]*",integer:"-?(?:0|[1-9][0-9]*)",qq_string:'"(?:\\\\["bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^"\\\\])*"',q_string:"'(?:\\\\['bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^'\\\\])*'"}},{}],3:[function(e,t,n){var r=e("./dict"),a=e("fs"),o={lex:{macros:{esc:"\\\\",int:r.integer},rules:[["\\$","return 'DOLLAR'"],["\\.\\.","return 'DOT_DOT'"],["\\.","return 'DOT'"],["\\*","return 'STAR'"],[r.identifier,"return 'IDENTIFIER'"],["\\[","return '['"],["\\]","return ']'"],[",","return ','"],["({int})?\\:({int})?(\\:({int})?)?","return 'ARRAY_SLICE'"],["{int}","return 'INTEGER'"],[r.qq_string,"yytext = yytext.substr(1,yyleng-2); return 'QQ_STRING';"],[r.q_string,"yytext = yytext.substr(1,yyleng-2); return 'Q_STRING';"],["\\(.+?\\)(?=\\])","return 'SCRIPT_EXPRESSION'"],["\\?\\(.+?\\)(?=\\])","return 'FILTER_EXPRESSION'"]]},start:"JSON_PATH",bnf:{JSON_PATH:[["DOLLAR",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["DOLLAR PATH_COMPONENTS",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["LEADING_CHILD_MEMBER_EXPRESSION","yy.ast.unshift(); return yy.ast.yield()"],["LEADING_CHILD_MEMBER_EXPRESSION PATH_COMPONENTS",'yy.ast.set({ operation: "member", scope: "child", expression: { type: "identifier", value: $1 }}); yy.ast.unshift(); return yy.ast.yield()']],PATH_COMPONENTS:[["PATH_COMPONENT",""],["PATH_COMPONENTS PATH_COMPONENT",""]],PATH_COMPONENT:[["MEMBER_COMPONENT",'yy.ast.set({ operation: "member" }); yy.ast.push()'],["SUBSCRIPT_COMPONENT",'yy.ast.set({ operation: "subscript" }); yy.ast.push() ']],MEMBER_COMPONENT:[["CHILD_MEMBER_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_MEMBER_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_MEMBER_COMPONENT:[["DOT MEMBER_EXPRESSION",""]],LEADING_CHILD_MEMBER_EXPRESSION:[["MEMBER_EXPRESSION",'yy.ast.set({ scope: "child", operation: "member" })']],DESCENDANT_MEMBER_COMPONENT:[["DOT_DOT MEMBER_EXPRESSION",""]],MEMBER_EXPRESSION:[["STAR",'yy.ast.set({ expression: { type: "wildcard", value: $1 } })'],["IDENTIFIER",'yy.ast.set({ expression: { type: "identifier", value: $1 } })'],["SCRIPT_EXPRESSION",'yy.ast.set({ expression: { type: "script_expression", value: $1 } })'],["INTEGER",'yy.ast.set({ expression: { type: "numeric_literal", value: parseInt($1) } })'],["END",""]],SUBSCRIPT_COMPONENT:[["CHILD_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_SUBSCRIPT_COMPONENT:[["[ SUBSCRIPT ]",""]],DESCENDANT_SUBSCRIPT_COMPONENT:[["DOT_DOT [ SUBSCRIPT ]",""]],SUBSCRIPT:[["SUBSCRIPT_EXPRESSION",""],["SUBSCRIPT_EXPRESSION_LIST",'$1.length > 1? yy.ast.set({ expression: { type: "union", value: $1 } }) : $$ = $1']],SUBSCRIPT_EXPRESSION_LIST:[["SUBSCRIPT_EXPRESSION_LISTABLE","$$ = [$1]"],["SUBSCRIPT_EXPRESSION_LIST , SUBSCRIPT_EXPRESSION_LISTABLE","$$ = $1.concat($3)"]],SUBSCRIPT_EXPRESSION_LISTABLE:[["INTEGER",'$$ = { expression: { type: "numeric_literal", value: parseInt($1) } }; yy.ast.set($$)'],["STRING_LITERAL",'$$ = { expression: { type: "string_literal", value: $1 } }; yy.ast.set($$)'],["ARRAY_SLICE",'$$ = { expression: { type: "slice", value: $1 } }; yy.ast.set($$)']],SUBSCRIPT_EXPRESSION:[["STAR",'$$ = { expression: { type: "wildcard", value: $1 } }; yy.ast.set($$)'],["SCRIPT_EXPRESSION",'$$ = { expression: { type: "script_expression", value: $1 } }; yy.ast.set($$)'],["FILTER_EXPRESSION",'$$ = { expression: { type: "filter_expression", value: $1 } }; yy.ast.set($$)']],STRING_LITERAL:[["QQ_STRING","$$ = $1"],["Q_STRING","$$ = $1"]]}};a.readFileSync&&(o.moduleInclude=a.readFileSync(e.resolve("../include/module.js")),o.actionInclude=a.readFileSync(e.resolve("../include/action.js"))),t.exports=o},{"./dict":2,fs:12}],4:[function(e,t,n){var r=e("./aesprim"),a=e("./slice"),o=e("static-eval"),i=e("underscore").uniq,s=function(){return this.initialize.apply(this,arguments)};function l(t,n,a){var o=e("./index"),i=p(r.parse(n).body[0].expression,{"@":t.value}),s=a.replace(/\{\{\s*value\s*\}\}/g,i),l=o.nodes(t.value,s);return l.forEach((function(e){e.path=t.path.concat(e.path.slice(1))})),l}function c(e){return Array.isArray(e)}function u(e){return function(t,n,r,a){var o=t.value,i=t.path,s=[],l=function(t,o){var i;c(t)?(t.forEach((function(e,t){s.length>=a||r(t,e,n)&&s.push({path:o.concat(t),value:e})})),t.forEach((function(t,n){s.length>=a||e&&l(t,o.concat(n))}))):(i=t)&&!(i instanceof Array)&&i instanceof Object&&(this.keys(t).forEach((function(e){s.length>=a||r(e,t[e],n)&&s.push({path:o.concat(e),value:t[e]})})),this.keys(t).forEach((function(n){s.length>=a||e&&l(t[n],o.concat(n))})))}.bind(this);return l(o,i),s}}function d(e){return function(t,n,r){return this.descend(n,t.expression.value,e,r)}}function f(e){return function(t,n,r){return this.traverse(n,t.expression.value,e,r)}}function p(){try{return o.apply(this,arguments)}catch(e){}}function h(e){return e=e.filter((function(e){return e})),i(e,(function(e){return e.path.map((function(e){return String(e).replace("-","--")})).join("-")}))}function m(e){var t=String(e);return t.match(/^-?[0-9]+$/)?parseInt(t):null}s.prototype.initialize=function(){this.traverse=u(!0),this.descend=u()},s.prototype.keys=Object.keys,s.prototype.resolve=function(e){var t=[e.operation,e.scope,e.expression.type].join("-"),n=this._fns[t];if(!n)throw new Error("couldn't resolve key: "+t);return n.bind(this)},s.prototype.register=function(e,t){if(!t instanceof Function)throw new Error("handler must be a function");this._fns[e]=t},s.prototype._fns={"member-child-identifier":function(e,t){var n=e.expression.value,r=t.value;if(r instanceof Object&&n in r)return[{value:r[n],path:t.path.concat(n)}]},"member-descendant-identifier":f((function(e,t,n){return e==n})),"subscript-child-numeric_literal":d((function(e,t,n){return e===n})),"member-child-numeric_literal":d((function(e,t,n){return String(e)===String(n)})),"subscript-descendant-numeric_literal":f((function(e,t,n){return e===n})),"member-child-wildcard":d((function(){return!0})),"member-descendant-wildcard":f((function(){return!0})),"subscript-descendant-wildcard":f((function(){return!0})),"subscript-child-wildcard":d((function(){return!0})),"subscript-child-slice":function(e,t){if(c(t.value)){var n=e.expression.value.split(":").map(m),r=t.value.map((function(e,n){return{value:e,path:t.path.concat(n)}}));return a.apply(null,[r].concat(n))}},"subscript-child-union":function(e,t){var n=[];return e.expression.value.forEach((function(e){var r={operation:"subscript",scope:"child",expression:e.expression},a=this.resolve(r)(r,t);a&&(n=n.concat(a))}),this),h(n)},"subscript-descendant-union":function(t,n,r){var a=e(".."),o=this,i=[];return a.nodes(n,"$..*").slice(1).forEach((function(e){i.length>=r||t.expression.value.forEach((function(t){var n={operation:"subscript",scope:"child",expression:t.expression},r=o.resolve(n)(n,e);i=i.concat(r)}))})),h(i)},"subscript-child-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.descend(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-descendant-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.traverse(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$[{{value}}]")},"member-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$.{{value}}")},"member-descendant-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$..value")}},s.prototype._fns["subscript-child-string_literal"]=s.prototype._fns["member-child-identifier"],s.prototype._fns["member-descendant-numeric_literal"]=s.prototype._fns["subscript-descendant-string_literal"]=s.prototype._fns["member-descendant-identifier"],t.exports=s},{"..":"jsonpath","./aesprim":"./aesprim","./index":5,"./slice":7,"static-eval":15,underscore:12}],5:[function(e,t,n){var r=e("assert"),a=e("./dict"),o=e("./parser"),i=e("./handlers"),s=function(){this.initialize.apply(this,arguments)};function l(e){return"[object String]"==Object.prototype.toString.call(e)}s.prototype.initialize=function(){this.parser=new o,this.handlers=new i},s.prototype.parse=function(e){return r.ok(l(e),"we need a path"),this.parser.parse(e)},s.prototype.parent=function(e,t){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var n=this.nodes(e,t)[0];return n.path.pop(),this.value(e,n.path)},s.prototype.apply=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),r.equal(W(n),"function","fn needs to be function");var a=this.nodes(e,t).sort((function(e,t){return t.path.length-e.path.length}));return a.forEach((function(t){var r=t.path.pop(),a=this.value(e,this.stringify(t.path)),o=t.value=n.call(e,a[r]);a[r]=o}),this),a},s.prototype.value=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),arguments.length>=3){var a=this.nodes(e,t).shift();if(!a)return this._vivify(e,t,n);var o=a.path.slice(-1).shift();this.parent(e,this.stringify(a.path))[o]=n}return this.query(e,this.stringify(t),1).shift()},s.prototype._vivify=function(e,t,n){var a=this;return r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),function t(n,r){var o=n.pop(),i=a.value(e,n);i||(t(n.concat(),"string"==typeof o?{}:[]),i=a.value(e,n)),i[o]=r}(this.parser.parse(t).map((function(e){return e.expression.value})),n),this.query(e,t)[0]},s.prototype.query=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(l(t),"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.value}));return a},s.prototype.paths=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.path}));return a},s.prototype.nodes=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),0===n)return[];var a=this.parser.parse(t),o=this.handlers,i=[{path:["$"],value:e}],s=[];return a.length&&"root"==a[0].expression.type&&a.shift(),a.length?(a.forEach((function(e,t){if(!(s.length>=n)){var r=o.resolve(e),l=[];i.forEach((function(o){if(!(s.length>=n)){var i=r(e,o,n);t==a.length-1?s=s.concat(i||[]):l=l.concat(i||[])}})),i=l}})),n?s.slice(0,n):s):i},s.prototype.stringify=function(e){r.ok(e,"we need a path");var t="$",n={"descendant-member":"..{{value}}","child-member":".{{value}}","descendant-subscript":"..[{{value}}]","child-subscript":"[{{value}}]"};return(e=this._normalize(e)).forEach((function(e){if("root"!=e.expression.type){var r,a=[e.scope,e.operation].join("-"),o=n[a];if(r="string_literal"==e.expression.type?JSON.stringify(e.expression.value):e.expression.value,!o)throw new Error("couldn't find template "+a);t+=o.replace(/{{value}}/,r)}})),t},s.prototype._normalize=function(e){if(r.ok(e,"we need a path"),"string"==typeof e)return this.parser.parse(e);if(Array.isArray(e)&&"string"==typeof e[0]){var t=[{expression:{type:"root",value:"$"}}];return e.forEach((function(e,n){"$"==e&&0===n||("string"==typeof e&&e.match("^"+a.identifier+"$")?t.push({operation:"member",scope:"child",expression:{value:e,type:"identifier"}}):t.push({operation:"subscript",scope:"child",expression:{value:e,type:"number"==typeof e?"numeric_literal":"string_literal"}}))})),t}if(Array.isArray(e)&&"object"==W(e[0]))return e;throw new Error("couldn't understand path "+e)},s.Handlers=i,s.Parser=o;var c=new s;c.JSONPath=s,t.exports=c},{"./dict":2,"./handlers":4,"./parser":6,assert:8}],6:[function(e,t,n){var r=e("./grammar"),a=e("../generated/parser"),o=function(){var e=new a.Parser,t=e.parseError;return e.yy.parseError=function(){e.yy.ast&&e.yy.ast.initialize(),t.apply(e,arguments)},e};o.grammar=r,t.exports=o},{"../generated/parser":1,"./grammar":3}],7:[function(e,t,n){function r(e){return String(e).match(/^[0-9]+$/)?parseInt(e):Number.isFinite(e)?parseInt(e,10):0}t.exports=function(e,t,n,a){if("string"==typeof t)throw new Error("start cannot be a string");if("string"==typeof n)throw new Error("end cannot be a string");if("string"==typeof a)throw new Error("step cannot be a string");var o=e.length;if(0===a)throw new Error("step cannot be zero");if(a=a?r(a):1,n=n<0?o+n:n,t=r(0===(t=t<0?o+t:t)?0:t||(a>0?0:o-1)),n=r(0===n?0:n||(a>0?o:-1)),t=a>0?Math.max(0,t):Math.min(o,t),n=a>0?Math.min(n,o):Math.max(-1,n),a>0&&n<=t)return[];if(a<0&&t<=n)return[];for(var i=[],s=t;s!=n&&!(a<0&&s<=n||a>0&&s>=n);s+=a)i.push(e[s]);return i}},{}],8:[function(e,t,n){var r=e("util/"),a=Array.prototype.slice,o=Object.prototype.hasOwnProperty,i=t.exports=u;function s(e,t){return r.isUndefined(t)?""+t:r.isNumber(t)&&!isFinite(t)||r.isFunction(t)||r.isRegExp(t)?t.toString():t}function l(e,t){return r.isString(e)?e.length<t?e:e.slice(0,t):e}function c(e,t,n,r,a){throw new i.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:a})}function u(e,t){e||c(e,!0,t,"==",i.ok)}function d(e,t){if(e===t)return!0;if(r.isBuffer(e)&&r.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return r.isDate(e)&&r.isDate(t)?e.getTime()===t.getTime():r.isRegExp(e)&&r.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:r.isObject(e)||r.isObject(t)?function(e,t){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(r.isPrimitive(e)||r.isPrimitive(t))return e===t;var n=f(e),o=f(t);if(n&&!o||!n&&o)return!1;if(n)return d(e=a.call(e),t=a.call(t));var i,s,l=m(e),c=m(t);if(l.length!=c.length)return!1;for(l.sort(),c.sort(),s=l.length-1;s>=0;s--)if(l[s]!=c[s])return!1;for(s=l.length-1;s>=0;s--)if(!d(e[i=l[s]],t[i]))return!1;return!0}(e,t):e==t}function f(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function p(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||!0===t.call({},e))}function h(e,t,n,a){var o;r.isString(n)&&(a=n,n=null);try{t()}catch(e){o=e}if(a=(n&&n.name?" ("+n.name+").":".")+(a?" "+a:"."),e&&!o&&c(o,n,"Missing expected exception"+a),!e&&p(o,n)&&c(o,n,"Got unwanted exception"+a),e&&o&&n&&!p(o,n)||!e&&o)throw o}i.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return l(JSON.stringify(e.actual,s),128)+" "+e.operator+" "+l(JSON.stringify(e.expected,s),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||c;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,a=r.indexOf("\n"+t.name);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},r.inherits(i.AssertionError,Error),i.fail=c,i.ok=u,i.equal=function(e,t,n){e!=t&&c(e,t,n,"==",i.equal)},i.notEqual=function(e,t,n){e==t&&c(e,t,n,"!=",i.notEqual)},i.deepEqual=function(e,t,n){d(e,t)||c(e,t,n,"deepEqual",i.deepEqual)},i.notDeepEqual=function(e,t,n){d(e,t)&&c(e,t,n,"notDeepEqual",i.notDeepEqual)},i.strictEqual=function(e,t,n){e!==t&&c(e,t,n,"===",i.strictEqual)},i.notStrictEqual=function(e,t,n){e===t&&c(e,t,n,"!==",i.notStrictEqual)},i.throws=function(e,t,n){h.apply(this,[!0].concat(a.call(arguments)))},i.doesNotThrow=function(e,t){h.apply(this,[!1].concat(a.call(arguments)))},i.ifError=function(e){if(e)throw e};var m=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}},{"util/":11}],9:[function(e,t,n){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],10:[function(e,t,n){t.exports=function(e){return e&&"object"===W(e)&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],11:[function(e,t,n){(function(t,r){var a=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,i=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<o;l=r[++n])m(l)||!_(l)?i+=" "+l:i+=" "+s(l);return i},n.deprecate=function(e,a){if(v(r.process))return function(){return n.deprecate(e,a).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(a);t.traceDeprecation?console.trace(a):console.error(a),o=!0}return e.apply(this,arguments)}};var o,i={};function s(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(r,e);return y(a)||(a=u(e,a,r)),a}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var i=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),x(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return d(t);if(0===i.length){if(S(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return d(t)}var l,c="",_=!1,E=["{","}"];return p(t)&&(_=!0,E=["[","]"]),S(t)&&(c=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(c=" "+RegExp.prototype.toString.call(t)),w(t)&&(c=" "+Date.prototype.toUTCString.call(t)),x(t)&&(c=" "+d(t)),0!==i.length||_&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=_?function(e,t,n,r,a){for(var o=[],i=0,s=t.length;i<s;++i)A(t,String(i))?o.push(f(e,t,n,r,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(f(e,t,n,r,a,!0))})),o}(e,t,r,s,i):i.map((function(n){return f(e,t,r,s,n,_)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,c,E)):E[0]+c+E[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,a,o){var i,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),A(r,a)||(i="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),v(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=e.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=e.stylize(i,"string"))}return i+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===E(e)}function _(e){return"object"===W(e)&&null!==e}function w(e){return _(e)&&"[object Date]"===E(e)}function x(e){return _(e)&&("[object Error]"===E(e)||e instanceof Error)}function S(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!i[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;i[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else i[e]=function(){};return i[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=g,n.isString=y,n.isSymbol=function(e){return"symbol"===W(e)},n.isUndefined=v,n.isRegExp=b,n.isObject=_,n.isDate=w,n.isError=x,n.isFunction=S,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===W(e)||void 0===e},n.isBuffer=e("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(t=[k((e=new Date).getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),C[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":10,_process:14,inherits:9}],12:[function(e,t,n){},{}],13:[function(e,t,n){(function(e){function t(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}n.resolve=function(){for(var n="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var i=o>=0?arguments[o]:e.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(n=i+"/"+n,a="/"===i.charAt(0))}return(a?"/":"")+(n=t(r(n.split("/"),(function(e){return!!e})),!a).join("/"))||"."},n.normalize=function(e){var o=n.isAbsolute(e),i="/"===a(e,-1);return(e=t(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&i&&(e+="/"),(o?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},n.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var a=r(e.split("/")),o=r(t.split("/")),i=Math.min(a.length,o.length),s=i,l=0;l<i;l++)if(a[l]!==o[l]){s=l;break}var c=[];for(l=s;l<a.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!a){r=o;break}}else a=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},n.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,a=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){n=t+1;break}}else-1===r&&(a=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,a=!0,o=0,i=e.length-1;i>=0;--i){var s=e.charCodeAt(i);if(47!==s)-1===r&&(a=!1,r=i+1),46===s?-1===t?t=i:1!==o&&(o=1):-1!==t&&(o=-1);else if(!a){n=i+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var a="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:14}],14:[function(e,t,n){var r,a,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var c,u=[],d=!1,f=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||l(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],15:[function(e,t,n){var r=e("escodegen").generate;t.exports=function(e,t){t||(t={});var n={},a=function e(a,o){if("Literal"===a.type)return a.value;if("UnaryExpression"===a.type){var i=e(a.argument);return"+"===a.operator?+i:"-"===a.operator?-i:"~"===a.operator?~i:"!"===a.operator?!i:n}if("ArrayExpression"===a.type){for(var s=[],l=0,c=a.elements.length;l<c;l++){if((y=e(a.elements[l]))===n)return n;s.push(y)}return s}if("ObjectExpression"===a.type){var u={};for(l=0;l<a.properties.length;l++){var d=null===(v=a.properties[l]).value?v.value:e(v.value);if(d===n)return n;u[v.key.value||v.key.name]=d}return u}if("BinaryExpression"===a.type||"LogicalExpression"===a.type){if((c=e(a.left))===n)return n;var f=e(a.right);if(f===n)return n;var p=a.operator;return"=="===p?c==f:"==="===p?c===f:"!="===p?c!=f:"!=="===p?c!==f:"+"===p?c+f:"-"===p?c-f:"*"===p?c*f:"/"===p?c/f:"%"===p?c%f:"<"===p?c<f:"<="===p?c<=f:">"===p?c>f:">="===p?c>=f:"|"===p?c|f:"&"===p?c&f:"^"===p?c^f:"&&"===p?c&&f:"||"===p?c||f:n}if("Identifier"===a.type)return{}.hasOwnProperty.call(t,a.name)?t[a.name]:n;if("ThisExpression"===a.type)return{}.hasOwnProperty.call(t,"this")?t.this:n;if("CallExpression"===a.type){var h=e(a.callee);if(h===n)return n;if("function"!=typeof h)return n;var m=a.callee.object?e(a.callee.object):n;m===n&&(m=null);var g=[];for(l=0,c=a.arguments.length;l<c;l++){var y;if((y=e(a.arguments[l]))===n)return n;g.push(y)}return h.apply(m,g)}var v;if("MemberExpression"===a.type)return(u=e(a.object))===n||"function"==typeof u?n:"Identifier"===a.property.type?u[a.property.name]:(v=e(a.property))===n?n:u[v];if("ConditionalExpression"===a.type)return(i=e(a.test))===n?n:e(i?a.consequent:a.alternate);if("ExpressionStatement"===a.type)return(i=e(a.expression))===n?n:i;if("ReturnStatement"===a.type)return e(a.argument);if("FunctionExpression"===a.type){var b=a.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<a.params.length;l++){var w=a.params[l];if("Identifier"!=w.type)return n;t[w.name]=null}for(var l in b)if(e(b[l])===n)return n;t=_;var x=Object.keys(t),S=x.map((function(e){return t[e]}));return Function(x.join(", "),"return "+r(a)).apply(null,S)}if("TemplateLiteral"===a.type){var E="";for(l=0;l<a.expressions.length;l++)E+=e(a.quasis[l]),E+=e(a.expressions[l]);return E+e(a.quasis[l])}if("TaggedTemplateExpression"===a.type){var k=e(a.tag),C=a.quasi,A=C.quasis.map(e),O=C.expressions.map(e);return k.apply(null,[A].concat(O))}return"TemplateElement"===a.type?a.value.cooked:n}(e);return a===n?void 0:a}},{escodegen:12}],jsonpath:[function(e,t,n){t.exports=e("./lib/index")},{"./lib/index":5}]},{},["jsonpath"])("jsonpath")},e.exports=n()}(rT);var aT=rT.exports;const oT=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now","0","1","2","3","4","5","6","7","8","9"]);function iT(e,t){for(const[n,r]of t.entries())if(e.startsWith(r))return e.replace(r,String(n));return e}const sT="$PREFIXED_ID";function lT(e,t,n){return t===sT?[iT(e.id,n)]:aT.query(e,t)}function cT(e){return e.toLowerCase().split(/[^\d:A-Za-z]+/).filter((e=>e&&!oT.has(e)))}function*uT(e){for(const t of e)yield*cT(t)}function*dT(e){for(const t of e)if("string"==typeof t)yield t;else if("object"==typeof t){const e=aT.query(t,"$..*");yield*dT(e)}}function*fT(e,t,n){for(const r of t){const t=lT(e,r,n);if(t.length>0)for(const e of uT(dT(t)))yield[r,e]}}async function pT(e,t,n){const r=await this.db,a=t??r.transaction(["nodes"]);YO(n);const o=[...cT(e)],i=[],s=new Map;i.push(...o.map((async(e,t)=>{YO(n);const r=a.objectStore("nodes").index("full-text-words");for await(const a of r.iterate(IDBKeyRange.bound(e,`${e}`,!1,!1))){YO(n);const e=a.value,r=s.get(e.id)??[e,new Set];r[1].add(t),s.set(e.id,r)}}))),await Promise.all(i),YO(n);const l=[];for(const[,[e,t]]of s)YO(n),l.push(...hT(this.textIndexFields,e,t,o,this.prefixes));return l.sort(((e,t)=>t.score-e.score)),l.slice(0,this.options.maxSearchResults??this.DEFAULT_MAX_SEARCH_RESULTS)}function hT(e,t,n,r,a){const o=[...n].sort().map((e=>r[e])),i=o.map((e=>{const t=e.replaceAll(/[$()*+./?[\\\]^{|}-]/g,String.raw`\$&`);return new RegExp(`\\b${t}`,"gi")}));let s=[],l=0;for(const[n,o]of e.entries()){const c=new Set,u=e.length-n-1,d=[...dT(lT(t,o.jsonPath,a))];for(const e of d){let n=0;const a=[];for(const[t,o]of i.entries())for(const i of e.matchAll(o)){n+=1+1*u,c.add(t);const o=i.index,s=r[t];void 0!==o&&(n+=.01*s.length,n+=s.length/e.length*100*.05,a.push({wordIndex:t,position:o}))}n+=100*c.size,l<n&&(l=n),a.sort(((e,t)=>e.position-t.position)),a.length>0&&s.push({term:t,field:o,str:e,score:n,wordMatches:a})}}s=s.filter((e=>e.score===l));for(const e of s){const{wordMatches:t}=e;for(let n=0;n<t.length-1;n++){const r=t[n],a=t[n+1],i=a.wordIndex-r.wordIndex;if(1===i||-1===i){e.score+=1,1===i&&(e.score+=1);const t=Math.abs(a.position-(r.position+o[r.wordIndex].length))-1;e.score-=.05*t}}}return s}function mT(e){return"string"==typeof e.id}function gT(e){return"string"==typeof e.sub&&"string"==typeof e.pred&&"string"==typeof e.obj}function yT(e){return Boolean(e.meta?.deprecated)}var vT=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==W(t)&&"object"==W(n)){if(t.constructor!==n.constructor)return!1;var r,a,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;var i,s=ve(t.entries());try{for(s.s();!(i=s.n()).done;)if(!n.has((a=i.value)[0]))return!1}catch(e){s.e(e)}finally{s.f()}var l,c=ve(t.entries());try{for(c.s();!(l=c.n()).done;)if(!e((a=l.value)[1],n.get(a[0])))return!1}catch(e){c.e(e)}finally{c.f()}return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;var u,d=ve(t.entries());try{for(d.s();!(u=d.n()).done;)if(!n.has((a=u.value)[0]))return!1}catch(e){d.e(e)}finally{d.f()}return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(t[a]!==n[a])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=r;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=r;0!=a--;){var f=o[a];if(!e(t[f],n[f]))return!1}return!0}return t!=t&&n!=n};async function bT(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,o=n.blocking,i=n.terminated,s=indexedDB.open(e,t),l=qf(s);return a&&s.addEventListener("upgradeneeded",(function(e){a(qf(s.result),e.oldVersion,e.newVersion,qf(s.transaction),e)})),r&&s.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),l.then((function(e){i&&e.addEventListener("close",(function(){return i()})),o&&e.addEventListener("versionchange",(function(e){return o(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),l}(e,2,{upgrade(e,t,n,r,a){if(t<2&&(e.objectStoreNames.contains("meta")&&e.deleteObjectStore("meta"),e.objectStoreNames.contains("nodes")&&e.deleteObjectStore("nodes"),e.objectStoreNames.contains("edges")&&e.deleteObjectStore("edges")),e.objectStoreNames.contains("meta")||e.createObjectStore("meta"),!e.objectStoreNames.contains("nodes")){e.createObjectStore("nodes",{keyPath:"id"});const t=r.objectStore("nodes");t.createIndex("by-label","lbl"),t.createIndex("by-type","type"),t.createIndex("by-synonym",["meta","synonyms","val"]),t.createIndex("full-text-words","fullTextWords",{multiEntry:!0})}if(!e.objectStoreNames.contains("edges")){e.createObjectStore("edges",{autoIncrement:!0});const t=r.objectStore("edges");t.createIndex("by-subject","sub"),t.createIndex("by-object","obj"),t.createIndex("by-predicate","pred")}}})}function _T(e){const t=new Set;for(const[,n]of e)t.add(n);return[...t]}async function wT(e){const t=Date.now();let n,r=1;this.options.update?.("Parsing JSON",r);try{n=JSON.parse(await g.openLocation(this.sourceLocation).readFile("utf8"))}catch{throw new Error("Error in loading ontology")}r+=5,this.options.update?.("Parsing JSON complete",r);const a=Date.now(),[o,...i]=n.graphs??[];if(o){if(i.length>0)throw new Error("multiple graphs not supported");try{const n=e.transaction(["meta","nodes","edges"],"readwrite");await n.objectStore("meta").clear(),await n.objectStore("nodes").clear(),await n.objectStore("edges").clear();const i=n.objectStore("nodes"),s=xT.call(this).map((e=>e.jsonPath));if(o.nodes){let e=Math.round(r);for(const[,t]of o.nodes.entries())r+=1/o.nodes.length*64,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing nodes",r),e=Math.round(r)),mT(t)&&await i.add({...t,fullTextWords:_T(fT(t,s,this.prefixes))})}const l=n.objectStore("edges");if(o.edges){let e=Math.round(r);for(const[,t]of o.edges.entries())r+=1/o.edges.length*30,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing edges",r),e=Math.round(r)),gT(t)&&await l.add(t)}await n.done;const c=e.transaction("meta","readwrite"),{update:u,...d}=this.options;await c.objectStore("meta").add({ontologyRecord:{name:this.ontologyName,version:this.ontologyVersion,sourceLocation:this.sourceLocation},storeOptions:d,graphMeta:o.meta,timestamp:String(new Date),schemaVersion:2,timings:{overall:Date.now()-t,load:Date.now()-a}},"meta"),await c.done}catch(t){throw await e.transaction("meta","readwrite").objectStore("meta").clear(),t}}}function xT(){return[{displayName:"ID",jsonPath:sT},...this.options.textIndexing?.indexFields??AT]}async function ST(e){const[t]=await e.transaction("meta").objectStore("meta").getAll();return!!t&&vT(this.options.prefixes,t.storeOptions.prefixes)&&vT(this.options.textIndexing,t.storeOptions.textIndexing)}class ET{ontologyName;ontologyVersion;sourceLocation;db;options;loadOboGraphJson=wT;getTermsByFulltext=pT;openDatabase=bT;isDatabaseCurrent=ST;get textIndexFields(){return xT.call(this)}get prefixes(){return this.options.prefixes??new Map}DEFAULT_MAX_SEARCH_RESULTS=100;constructor(e,t,n,r){this.ontologyName=e,this.ontologyVersion=t,this.sourceLocation=n,this.options=r??{},this.db=this.prepareDatabase()}validate(){const e=[],{sourceLocation:t,sourceType:n}=this;return n?"obo-graph-json"!==n&&e.push(new Error(`ontology source file ${JSON.stringify(t)} has type ${n}, which is not yet supported`)):e.push(new Error(`unable to determine format of ontology source file ${JSON.stringify(t)}, file name must end with ".json", ".obo", or ".owl"`)),e}get sourceType(){if(n.isUriLocation(this.sourceLocation)){if(this.sourceLocation.uri.endsWith(".json"))return"obo-graph-json"}else if(n.isLocalPathLocation(this.sourceLocation)&&this.sourceLocation.localPath.endsWith(".json"))return"obo-graph-json"}get dbName(){return`Apollo Ontology "${this.ontologyName}" "${this.ontologyVersion}"`}async prepareDatabase(){const e=this.validate();if(e.length>0)throw e;const t=await this.openDatabase(this.dbName);if(await this.isDatabaseCurrent(t))return t;try{const{options:e,sourceLocation:n,sourceType:r}=this;if("obo-graph-json"!==r)throw new Error(`ontology source file ${JSON.stringify(n)} has type ${r}, which is not yet supported`);return e.update?.("",0),await this.loadOboGraphJson(t),e.update?.("",100),t}catch(e){throw t.close(),await function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(function(e){return t(e.oldVersion,e)})),qf(n).then((function(){}))}(this.dbName),e}}async termCount(e){const t=await this.db;return(e??t.transaction("nodes")).objectStore("nodes").count()}unique(e){const t=new Map,n=[];for(const r of e)t.has(r.id)||(t.set(r.id,!0),n.push(r));return n}async getTermsWithLabelOrSynonym(e,t,n){const r=t?.includeSubclasses??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=o.objectStore("nodes"),s=[...await i.index("by-label").getAll(e),...await i.index("by-synonym").getAll(e)];if(r){const e=await this.recurseEdges("by-object",s.map((e=>e.id)),(e=>"is_a"===e.pred),"sub",o);for(const t of e){const e=await i.get(t);e&&s.push(e)}}return s}async getPropertiesByLabel(e,t,n){const r=t?.includeSubProperties??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=(await this.getTermsWithLabelOrSynonym(e,{includeSubclasses:!1},o)).filter((e=>NT(e)));if(r){const e=await this.recurseEdges("by-object",i.map((e=>e.id)),(e=>"subPropertyOf"===e.pred),"sub",o),t=o.objectStore("nodes");for(const n of e){const e=await t.get(n);e&&NT(e)&&i.push(e)}}return i}async recurseEdges(e,t,n,r,a){const o=new Set;return await async function t(i){await Promise.all([...i].map((async i=>{const s=(await a.objectStore("edges").index(e).getAll(i)).filter((e=>n(e))).map((e=>e[r]));if(s.length>0){for(const e of s)o.add(e);await t(s)}})))}(t),o.values()}async*expandNodeSet(e,t="is_a",n,r){const a=await this.db,o=r??a.transaction(["edges"]),i=[...e],s=await this.recurseEdges("subclasses"===n?"by-object":"by-subject",i,(e=>e.pred===t),"subclasses"===n?"sub":"obj",o);for(const e of i)yield e;for(const e of s)yield e}expandSubclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"subclasses",n)}expandSuperclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"superclasses",n)}async getClassesThat(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=await this.getPropertiesByLabel(e,{includeSubProperties:!0},a),i=new Set(o.map((e=>e.id))),s=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.expandSuperclasses(t.map((e=>e.id)),"is_a",a)),l=await this.recurseEdges("by-object",s,(e=>i.has(e.pred)),"sub",a),c=this.expandSubclasses(l,"is_a",a),u=[];for await(const e of c){const t=await a.objectStore("nodes").get(e);t&&TT(t)&&!yT(t)&&u.push(t)}return u}async getClassesWithoutPropertyLabeled(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=a.objectStore("nodes"),i=a.objectStore("edges"),s=(await this.getPropertiesByLabel(e,t,a)).map((e=>e.id)),l=await(async()=>{const e=new Set;for(const t of s)for await(const n of i.index("by-predicate").iterate(t))e.add(n.value.sub);const t=new Set;for await(const n of this.expandSubclasses(e,"is_a",a))t.add(n);return t})(),c=[];for await(const e of o){const t=e.value;TT(t)&&!l.has(t.id)&&c.push(t.id)}const u=[];for(const e of c){const t=await a.objectStore("nodes").get(e);t&&TT(t)&&!yT(t)&&u.push(t)}return u}async getAllClasses(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").index("by-type").getAll("CLASS")).filter((e=>!yT(e)))}async getAllTerms(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").getAll()).filter((e=>!yT(e)))}}const kT=r.types.model("OntologyRecord",{name:r.types.string,version:"unversioned",source:r.types.union(m.LocalPathLocation,m.UriLocation,m.BlobLocation),options:r.types.frozen(),equivalentTypes:r.types.map(r.types.array(r.types.string))}).volatile((e=>({dataStore:void 0,startedEquivalentTypeRequests:new Set}))).actions((e=>({ping(){},initDataStore(){e.dataStore=new ET(e.name,e.version,r.getSnapshot(e.source),e.options)},afterCreate(){r.addDisposer(e,c.autorun((()=>{this.initDataStore()})))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).actions((e=>({loadEquivalentTypes:r.flow((function*(t){if(!e.dataStore)return;if(e.startedEquivalentTypeRequests.has(t))return;e.startedEquivalentTypeRequests.add(t);const n=(yield e.dataStore.getTermsWithLabelOrSynonym(t)).map((e=>e.lbl)).filter((e=>null!=e));r.isAlive(e)&&e.setEquivalentTypes(t,n)}))}))).actions((e=>({afterCreate(){c.autorun((t=>{e.dataStore&&(e.loadEquivalentTypes("gene"),e.loadEquivalentTypes("pseudogene"),e.loadEquivalentTypes("transcript"),e.loadEquivalentTypes("pseudogenic_transcript"),e.loadEquivalentTypes("CDS"),e.loadEquivalentTypes("mRNA"),t.dispose())}))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).views((e=>({isTypeOf(t,n){if(t===n)return!0;if(!e.dataStore)return!1;const r=e.equivalentTypes.get(n);return r?r.includes(t):(e.loadEquivalentTypes(n),!1)}}))),CT=r.types.model("OntologyManager",{ontologies:r.types.array(kT),prefixes:r.types.optional(r.types.map(r.types.string),{"GO:":"http://purl.obolibrary.org/obo/GO_","SO:":"http://purl.obolibrary.org/obo/SO_"})}).views((e=>({get featureTypeOntologyName(){const t=r.getRoot(e).jbrowse.configuration;return a.readConfObject(t.ApolloPlugin,"featureTypeOntologyName")}}))).views((e=>({get featureTypeOntology(){return this.findOntology(e.featureTypeOntologyName)},findOntology:(t,n)=>e.ontologies.find((e=>e.name===t&&(void 0===n||e.version===n))),openOntology(e,t){return this.findOntology(e,t)?.dataStore},applyPrefixes:t=>iT(t,e.prefixes),expandPrefixes:t=>function(e,t){for(const[n,r]of t.entries())if(e.startsWith(String(n)))return e.replace(String(n),r);return e}(t,e.prefixes)}))).actions((e=>({addOntology(t,n,r,a){const o=e.ontologies.push({name:t,version:n,source:r,options:{prefixes:new Map(e.prefixes.entries()),...a}});e.ontologies[o-1].ping()}}))),AT=[{displayName:"Label",jsonPath:"$.lbl"},{displayName:"Synonym",jsonPath:"$.meta.synonyms[*].val"},{displayName:"Definition",jsonPath:"$.meta.definition.val"}],OT=a.ConfigurationSchema("OntologyRecord",{name:{type:"string",description:'the full name of the ontology, e.g. "Gene Ontology"',defaultValue:"My Ontology"},version:{type:"string",description:"the ontology's version string",defaultValue:"unversioned"},source:{type:"fileLocation",description:"the download location for the ontology's source file",defaultValue:{locationType:"UriLocation",uri:"http://example.com/myontology.json"}},textIndexFields:{type:"frozen",description:"JSON paths for text fields that will be indexed for text searching",defaultValue:AT}});function TT(e){return"CLASS"===e.type}function NT(e){return"PROPERTY"===e.type}async function IT(e,t,n){if(!e)return;const r=await t.getTermsWithLabelOrSynonym(e.type,{includeSubclasses:!1}),a=r.filter(TT);if(0===r.length)return;const o=await t.getClassesThat("part_of",a);return 0!==o.length?o:void 0}function RT({fetchValidTerms:e,filterTerms:t,includeDeprecated:n,onChange:r,ontologyName:a,ontologyVersion:o,renderInput:i,session:s,style:c,value:d}){const[f,p]=u.useState(!1),[h,m]=u.useState(),[g,y]=u.useState(""),[v,b]=u.useState(),{ontologyManager:_}=s.apolloDataStore,w=_.findOntology(a,o)?.dataStore,x=w&&f&&!h,S=w&&!v,E=u.useCallback((e=>(n||!yT(e))&&(!t||t(e))),[t,n]);u.useEffect((()=>{const e=new AbortController,{signal:t}=e;return S&&async function(e,t,n,r){if(!t)return;const a=(await e.getTermsWithLabelOrSynonym(t,{includeSubclasses:!1})).find((e=>(n??(()=>!0))(e)));if(!a)throw new Error(`not a valid ${e.ontologyName} term`);return a}(w,d,E).then((e=>{y(""),t.aborted||b(e)}),(e=>{t.aborted||KO(e)||y(String(e))})),()=>{e.abort("OntologyTermAutocomplete matcher")}}),[s,d,E,w,S]),u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return x&&async function(e,t,n,r){let a;if(t){const n=await t(e,r);n&&(a=n)}return a||(a=await e.getAllTerms()),n?a.filter((e=>n(e))):a}(w,e,E,n).then((e=>{e&&!n.aborted&&m(e)}),(e=>{n.aborted||KO(e)||s.notify(e instanceof Error?e.message:String(e),"error")})),()=>{t.abort("OntologyTermAutocomplete loader")}}),[x,E,w,s,e]);const k={};return g&&(k.error=!0,k.helperText=g),T.default.createElement(l.Autocomplete,{style:c,autoComplete:!0,filterSelectedOptions:!0,disableClearable:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,value:d,options:h??[],onOpen:()=>{p(!0)},onClose:()=>{p(!1)},loading:x,renderInput:i??(e=>T.default.createElement(l.TextField,{...e,...k})),getOptionLabel:e=>"string"==typeof e?e:e.lbl??"",isOptionEqualToValue:(e,t)=>e.lbl===t.lbl,onChange:(e,t)=>{t&&("string"==typeof t?(b(void 0),r(d,t)):t.lbl!==d&&(y(""),b(t),r(d,t.lbl)))}})}function FT({changeManager:e,handleClose:t,session:n,sourceAssemblyId:r,sourceFeature:a}){const[o,i]=u.useState(String(a.max)),[s,c]=u.useState(String(a.min+1)),[d,f]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(""),y=Number(o)<=Number(s);return T.default.createElement(xf,{open:!0,title:"Add new child feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},T.default.createElement("form",{onSubmit:function(i){i.preventDefault(),h("");const l=(new Hn).toHexString(),c=new Xn.AddFeatureChange({changedIds:[a._id],typeName:"AddFeatureChange",assembly:r,addedFeature:{_id:l,refSeq:a.refSeq,min:Number(s)-1,max:Number(o),type:d},parentFeatureId:a._id});e.submit(c).then((()=>{n.apolloSetSelectedFeature(l)})),t(),i.preventDefault()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:s,onChange:e=>{c(e.target.value)}}),T.default.createElement(l.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:o,onChange:e=>{i(e.target.value)},error:y,helperText:y?'"End" must be greater than "Start"':null}),T.default.createElement(RT,{session:n,ontologyName:"Sequence Ontology",style:{width:170},value:d,filterTerms:TT,fetchValidTerms:async function(e,t,n){const r=await IT(e,t);if(r)return r;g(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,a),renderInput:e=>T.default.createElement(l.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(m),helperText:m}),onChange:(e,t)=>{var n;t&&(n=t,h(""),f(n))}})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:y||!(s&&o&&d)},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},p)):null)}class PT{clientStore;constructor(e){this.clientStore=e}}class MT{dataStore;constructor(e){this.dataStore=e}recentChanges=[];undoneChanges=[];async submit(e,t={}){const{addToRecents:r=!0,submitToBackend:a=!0,updateJobsManager:o=!1}=t,i=n.getSession(this.dataStore),s=new AbortController,{jobsManager:l,isLocked:c,changeInProgress:u,setChangeInProgress:d}=n.getSession(this.dataStore);if(c)return i.notify("Cannot submit changes in locked mode"),void d(!1);if(u)return void i.notify("Could not submit change, there is another change still in progress");d(!0);const f={name:e.typeName,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{s.abort("ChangeManager")}};o&&l.runJob(f);const p=await Xn.validationRegistry.frontendPreValidate(e);if(!p.ok){const e=`Pre-validation failed: "${p.resultsMessages}"`;return o&&l.abortJob(f.name,e),i.notify(e,"error"),void d(!1)}try{await e.execute(this.dataStore)}catch(e){return o&&l.abortJob(f.name,String(e)),console.error(e),i.notify(`Error encountered in client: ${String(e)}. Data may be out of sync, please refresh the page`,"error"),void d(!1)}if((await Xn.validationRegistry.frontendPostValidate(e,this.dataStore)).ok||await this.undo(e),a){o&&l.update(f.name,"Submitting to driver");const{collaborationServerDriver:n,getBackendDriver:a}=this.dataStore,s=L.isAssemblySpecificChange(e)?a(e.assembly)??n:n;let c;try{c=await s.submitChange(e,t)}catch(t){return o&&l.abortJob(f.name,String(t)),console.error(t),i.notify(String(t),"error"),await this.undo(e,!1),void d(!1)}if(!c.ok){const t=`Post-validation failed: "${p.resultsMessages}"`;return o&&l.abortJob(f.name,t),i.notify(t,"error"),await this.undo(e,!1),void d(!1)}e.notification&&i.notify(e.notification,"success"),r&&(this.recentChanges.push(e),this.undoneChanges=[])}o&&l.done(f),d(!1)}async undo(e,t=!0){const n=e.getInverse();return this.submit(n,{submitToBackend:t,addToRecents:!1})}async redo(e,t=!0){return this.submit(e,{submitToBackend:t,addToRecents:!1})}async undoLastChange(){const e=n.getSession(this.dataStore),t=this.recentChanges.pop();if(t)return this.undoneChanges.push(t),this.undo(t);e.notify("No changes to undo!","info")}async redoLastChange(){const e=n.getSession(this.dataStore),t=this.undoneChanges.pop();if(t)return this.recentChanges.push(t),this.redo(t);e.notify("No changes to redo!","info")}}class DT extends PT{inFlight=new Map;refSeqMaps=new Map;async fetch(e,t,n){return e.getFetcher({locationType:"UriLocation",uri:t.toString()})(t,n)}async searchFeatures(e,t){const n=this.clientStore.getInternetAccount(t[0]),{baseURL:r}=n,a=new URL("features/searchFeatures",r),o=new URLSearchParams({assemblies:t.join(","),term:e});a.search=o.toString();const i=a.toString(),s=await this.fetch(n,i);if(!s.ok){const e=await bf(s,"searchFeatures failed");throw new Error(e)}return s.json()}async getFeatures(e){const{assemblyName:t,end:r,refName:a,start:o}=e,{assemblyManager:i}=n.getSession(this.clientStore);if(!i.get(t))throw new Error(`Could not find assembly with name "${t}"`);const s=(await this.getRefSeqMapping(t)).get(a);if(!s)throw new Error(`Could not find refSeq "${a}"`);const l=s.id,c=this.clientStore.getInternetAccount(t),{baseURL:u}=c,d=new URL("features/getFeatures",u),f=new URLSearchParams({refSeq:l,start:String(o),end:String(r)});d.search=f.toString();const p=d.toString(),h=await this.fetch(c,p);if(!h.ok){const e=await bf(h,"getFeatures failed");throw new Error(e)}return this.checkSocket(t,a,c),h.json()}checkSocket(e,t,n){const{socket:r}=n,a=n.retrieveToken();if(!a)return;const o=Xn.makeUserSessionId(a),i=`${e}-${t}`,s=new MT(this.clientStore);r.hasListeners(i)||r.on(i,(async e=>{if(n.setLastChangeSequenceNumber(Number(e.changeSequence)),e.userSessionId===o)return;const t=L.Change.fromJSON(e.changeInfo);L.isFeatureChange(t)&&this.haveDataForChange(t)&&await s.submit(t,{submitToBackend:!1})}))}haveDataForChange(e){const{assembly:t,changedIds:n}=e;if(!this.clientStore.assemblies.get(t))return!1;for(const e of n)if(this.clientStore.getFeature(e))return!0;return!1}async getSequence(e){const t=`${e.refName}:${e.start}-${e.end}`,r=this.inFlight.get(t),{assemblyName:a,end:o,refName:i,start:s}=e,{assemblyManager:l}=n.getSession(this.clientStore);if(!l.get(a))throw new Error(`Could not find assembly with name "${a}"`);const c=(await this.getRefSeqMapping(a)).get(i);if(!c)throw new Error(`Could not find refSeq "${i}"`);const u=c.id;if(r)return{seq:await r,refSeq:u};let d=this.clientStore.assemblies.get(a);d||(d=this.clientStore.addAssembly(a));let f=d.refSeqs.get(u);f||(f=d.addRefSeq(u,i));const p=f.getSequence(s,o);if(p.length===o-s)return{seq:p,refSeq:u};const h=this.clientStore.getInternetAccount(a),{baseURL:m}=h,g=new URL("sequence",m),y=new URLSearchParams({refSeq:u,start:String(s),end:String(o)});g.search=y.toString();const v=g.toString(),b=this.getSeqFromServer(h,v,f,s,o);this.inFlight.set(t,b);const _=await b;return this.checkSocket(a,i,h),this.inFlight.delete(t),{seq:_,refSeq:u}}async getSeqFromServer(e,t,n,r,a){const o=await this.fetch(e,t);if(!o.ok){let e;try{e=await o.text()}catch{e=""}throw new Error(`getSequence failed: ${o.status} (${o.statusText})${e?` (${e})`:""}`)}const i=await o.text();return n.addSequence({sequence:i,start:r,stop:a}),i}async getRefSeqMapping(e){const t=this.refSeqMaps.get(e);if(t)return t;const{assemblyManager:r}=n.getSession(this.clientStore);if(!r.get(e))throw new Error(`Could not find assembly with name "${e}"`);const a=this.clientStore.getInternetAccount(e),{baseURL:o}=a,i=new URL("refSeqs",o),s=new URLSearchParams({assembly:e});i.search=s.toString();const l=i.toString(),c=await this.fetch(a,l);if(!c.ok){let e;try{e=await c.text()}catch{e=""}throw new Error(`getRefNameAliases failed: ${c.status} (${c.statusText})${e?` (${e})`:""}`)}const u=await c.json(),d=new Map(u.map((e=>[e.name,{refName:e.name,id:e._id,aliases:e.aliases}])));return this.refSeqMaps.set(e,d),d}async getRefNameAliases(e){return[...(await this.getRefSeqMapping(e)).values()].map((e=>({refName:e.refName,aliases:[...new Set([e.id,...e.aliases])],uniqueId:`alias-${e.id}`})))}async getRefSeqId(e,t){const n=await this.getRefSeqMapping(e);if(!n)return;const r=n.get(t);return r?.id}async getRegions(e){const{assemblyManager:t}=n.getSession(this.clientStore);if(!t.get(e))throw new Error(`Could not find assembly with name "${e}"`);const r=this.clientStore.getInternetAccount(e),{baseURL:a}=r,o=new URL("refSeqs",a),i=new URLSearchParams({assembly:e});o.search=i.toString();const s=o.toString(),l=await this.fetch(r,s);if(!l.ok){let e;try{e=await l.text()}catch{e=""}throw new Error(`getRegions failed: ${l.status} (${l.statusText})${e?` (${e})`:""}`)}return(await l.json()).map((e=>({refName:e.name,start:0,end:e.length})))}getAssemblies(e){const{assemblyManager:t}=n.getSession(this.clientStore);return t.assemblies.filter((t=>{const n=a.getConf(t,["sequence","metadata"]);return!(!(n&&n.apollo&&n.internetAccountConfigId)||e&&n.internetAccountConfigId!==e)}))}async submitChange(e,t={}){const{internetAccountId:n}=t,r=this.clientStore.getInternetAccount("assembly"in e?e.assembly:void 0,n),{baseURL:a}=r,o=new URL("changes",a).href,i=await this.fetch(r,o,{method:"POST",body:JSON.stringify(e.toJSON()),headers:{"Content-Type":"application/json"}});if(!i.ok){const e=await bf(i,"submitChange failed");throw new Error(e)}const s=new Xn.ValidationResultSet;return i.ok||(s.ok=!1),s}}class jT extends PT{async getFeatures(){return[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=this.clientStore.assemblies.get(t);if(!o)return{seq:"",refSeq:r};const i=o.refSeqs.get(r);return i?{seq:i.getSequence(a,n),refSeq:r}:{seq:"",refSeq:r}}async getRefNameAliases(e){const t=this.clientStore.assemblies.get(e),n=[];if(!t)return n;for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getRegions(e){const t=this.clientStore.assemblies.get(e);if(!t)return[];const n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=a.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.file&&!t.internetAccountConfigId)}))}async submitChange(e,t={}){const{clientStore:n}=this,{assemblies:r}=n;n.clearCheckResults();for(const[,e]of r)if("InMemoryFileDriver"===e.backendDriverType){const t=await Wd(e);n.addCheckResults(t)}return new Xn.ValidationResultSet}async searchFeatures(e,t){return[]}}class LT extends PT{async loadAssembly(e){const{assemblyManager:t}=n.getSession(this.clientStore),r=t.get(e);if(!r)throw new Error(`Assembly ${e} not found`);const{file:o}=a.getConf(r,["sequence","metadata"]),i=require("node:fs");return Vd(e,await i.promises.readFile(o,"utf8"),this.clientStore)}async getAssembly(e){let t=this.clientStore.assemblies.get(e);return t||(t=await this.loadAssembly(e)),t}async getRefNameAliases(e){const t=await this.getAssembly(e),n=[];for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getFeatures(e){return await this.getAssembly(e.assemblyName),[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=(await this.getAssembly(t)).refSeqs.get(r);if(!o)throw new Error(`refSeq ${r} not found in client data store`);return{seq:o.getSequence(a,n),refSeq:r}}async getRegions(e){const t=await this.getAssembly(e),n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=a.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.internetAccountConfigId&&t.file)}))}async submitChange(e){if(!L.isAssemblySpecificChange(e))throw new Error(`Cannot use this type of change with local file: "${e.typeName}"`);const{assemblyManager:t}=n.getSession(this.clientStore),o=t.get(e.assembly);if(!o)throw new Error(`Could not find assembly with name "${e.assembly}"`);const{file:i}=a.getConf(o,["sequence","metadata"]),s=this.clientStore.assemblies.get(e.assembly);if(!s)throw new Error(`Could not find assembly in client with name "${e.assembly}"`);const l=new Set(...s.refSeqs.keys()),{checkResults:c}=this.clientStore;for(const e of c.values())l.has(e.refSeq)&&c.delete(e._id);const u=await Wd(s);this.clientStore.addCheckResults(u);const d=[{directive:"gff-version",value:"3"}];for(const[,e]of s.refSeqs)d.push({directive:"sequence-region",value:`${e.name} 1 ${e.sequence[0].stop}`});for(const e of s.comments)d.push({comment:e});for(const[,e]of s.refSeqs){const{features:t}=e;for(const[,e]of t)d.push(Xn.annotationFeatureToGFF3(r.getSnapshot(e)))}for(const[,e]of s.refSeqs){const[t]=e.sequence,n=Xn.splitStringIntoChunks(t.sequence,80).join("\n");d.push({id:e.name,description:e.description,sequence:n})}const f=wd.formatSync(d),p=require("node:fs");return await p.promises.writeFile(i,f,"utf8"),new Xn.ValidationResultSet}async searchFeatures(e,t){return[]}}var qT;function BT(e,t,n,r){const a={_id:(new Hn).toHexString(),refSeq:e,type:"CDS",min:n,max:r,strand:t},o={_id:(new Hn).toHexString(),refSeq:e,type:"exon",min:n,max:r,strand:t},i={};return i[a._id]=a,i[o._id]=o,{_id:(new Hn).toHexString(),refSeq:e,type:"mRNA",min:n,max:r,strand:t,children:i}}function UT({changeManager:e,handleClose:t,region:n,session:r}){const[a,o]=u.useState(String(n.end)),[i,s]=u.useState(String(n.start+1)),[c,d]=u.useState(qT.GENE_AND_SUBFEATURES),[f,p]=u.useState(""),[h,m]=u.useState(),[g,y]=u.useState(""),v=Number(a)<=Number(i);let b=Boolean(v)||!(i&&a&&c);return(c===qT.CUSTOM&&!f||!h&&c===qT.GENE_AND_SUBFEATURES||!h&&c===qT.TRANSCRIPT_AND_SUBFEATURES)&&(b=!0),T.default.createElement(xf,{open:!0,title:"Add new feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},T.default.createElement("form",{onSubmit:async function(o){o.preventDefault(),y("");const s=r.apolloDataStore.getBackendDriver(n.assemblyName);if(!s)return void y("No backend driver found");let l=n.refName;if(s instanceof DT){const e=await s.getRefSeqId(n.assemblyName,n.refName);if(!e)return void y(`Could not find refSeq for "${n.refName}"`);l=e}if(c===qT.GENE_AND_SUBFEATURES){const o=BT(l,h,Number(i)-1,Number(a)),s={};s[o._id]=o;const c=(new Hn).toHexString(),u=new Xn.AddFeatureChange({changedIds:[c],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:c,refSeq:l,min:Number(i)-1,max:Number(a),type:"gene",strand:h,children:s}});return e.submit(u).then((()=>{r.apolloSetSelectedFeature(c)})),void t()}if(c===qT.TRANSCRIPT_AND_SUBFEATURES){const o=BT(l,h,Number(i)-1,Number(a)),s=new Xn.AddFeatureChange({changedIds:[o._id],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:o});return e.submit(s).then((()=>{r.apolloSetSelectedFeature(o._id)})),void t()}if(!f)return void y("No type selected");const u=(new Hn).toHexString(),d=new Xn.AddFeatureChange({changedIds:[u],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:u,refSeq:l,min:Number(i)-1,max:Number(a),type:f,strand:h}});e.submit(d).then((()=>{r.apolloSetSelectedFeature(u)})),t()},"data-testid":"submit-form"},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:Number(i),onChange:e=>{s(e.target.value)}}),T.default.createElement(l.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:a,onChange:e=>{o(e.target.value)},error:v,helperText:v?'"End" must be greater than "Start"':null}),T.default.createElement(l.FormControl,null,T.default.createElement(l.InputLabel,{id:"demo-simple-select-label"},"Strand"),T.default.createElement(l.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Strand",value:h?.toString(),onChange:function(e){switch(y(""),Number(e.target.value)){case 1:m(1);break;case-1:m(-1);break;default:m(void 0)}}},T.default.createElement(l.MenuItem,{value:void 0}),T.default.createElement(l.MenuItem,{value:1},"+"),T.default.createElement(l.MenuItem,{value:-1},"-"))),T.default.createElement(l.FormControl,{style:{marginTop:20}},T.default.createElement(l.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:qT.GENE_AND_SUBFEATURES,name:"radio-buttons-group",value:c,onChange:e=>{y("");const{value:t}=e.target;Object.keys(qT).includes(t)&&d(qT[t])}},T.default.createElement(l.FormControlLabel,{value:qT.GENE_AND_SUBFEATURES,control:T.default.createElement(l.Radio,null),label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},"Add gene and sub-features",T.default.createElement(l.Tooltip,{title:"This is a shortcut to create a gene with a single mRNA, exon, and CDS"},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))}),T.default.createElement(l.FormControlLabel,{value:qT.TRANSCRIPT_AND_SUBFEATURES,control:T.default.createElement(l.Radio,null),label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},"Add transcript and sub-features",T.default.createElement(l.Tooltip,{title:"This is a shortcut to create a single mRNA with exon and CDS, but without a parent gene"},T.default.createElement(l.IconButton,{size:"small"},T.default.createElement(yd,{sx:{fontSize:18}}))))}),T.default.createElement(l.FormControlLabel,{value:qT.CUSTOM,checked:c!==qT.GENE_AND_SUBFEATURES&&c!==qT.TRANSCRIPT_AND_SUBFEATURES,control:T.default.createElement(l.Radio,null),label:"Add feature with a sequence ontology type"}))),c===qT.CUSTOM?T.default.createElement(RT,{session:r,ontologyName:"Sequence Ontology",style:{width:170},value:f,filterTerms:TT,renderInput:e=>T.default.createElement(l.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{var n;t&&(n=t,y(""),p(n))}}):null),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:b},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),g?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},g)):null)}function zT(e,t){const n=(new Hn).toHexString();t.push(n);const r={};if(e.children)for(const n of Object.values(e.children)){const e=zT(n,t);r[e._id]=e}const a="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return{...e,refSeq:a,children:e.children&&r,_id:n}}function GT({changeManager:e,handleClose:t,session:n,sourceAssemblyId:o,sourceFeature:i}){const{assemblyManager:s}=n,c=s.assemblyList,[d,f]=u.useState(c.find((e=>e.name!==o))?.name),[p,h]=u.useState([]),[m,g]=u.useState(""),[y,v]=u.useState(i.min),[b,_]=u.useState("");function w(e,t){const n={};if(e.children)for(const r of Object.values(e.children)){const e=w(r,t);e.refSeq=m,e.min=e.min+t,e.max=e.max+t,n[e._id]=e}const r="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString(),a="string"==typeof e._id?e._id:e._id.toHexString();return{...e,refSeq:r,children:e.children&&n,_id:a}}return u.useEffect((()=>{(async function(){if(g(""),!d)return void _("No assemblies to copy to");const e=await s.waitForAssembly(d);if(!e)return;const{refNameAliases:t}=e;if(!t)return;const n=[...Object.entries(t)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t})));h(n),g(n[0]?._id||"")})().catch((e=>{_(String(e))}))}),[d,s]),T.default.createElement(xf,{open:!0,title:"Copy features and annotations",handleClose:t,maxWidth:!1,"data-testid":"copy-feature"},T.default.createElement("form",{onSubmit:async function(a){if(!d)return;a.preventDefault(),_("");const o=i.length,l=await s.waitForAssembly(d);if(!l)return void _(`Assembly not found: ${d}.`);const c=l.getCanonicalRefName(m),u=l.regions?.find((e=>e.refName===c));if(!u)return void _(`RefSeq not found: ${m}.`);const f=y+o;if(f>u.end)return void _(`Feature would extend beyond the bounds of the selected reference sequence. (Feature would end at ${f}, but reference sequence ends at ${u.end})`);if(y<u.start)return void _(`Reference sequence starts at ${u.start}, feature cannot start before that.`);const p=[],h=zT(r.getSnapshot(i),p),g={...h.attributes};"Parent"in g&&delete g.Parent,h.refSeq=m;const v=y-h.min;h.min=y,h.max=y+o;const b=w(h,v),x=new Xn.AddFeatureChange({changedIds:[h._id],typeName:"AddFeatureChange",assembly:d,addedFeature:{_id:h._id,refSeq:h.refSeq,min:h.min,max:h.max,type:h.type,children:b.children,attributes:g,strand:h.strand},copyFeature:!0,allIds:p});e.submit(x).then((()=>{n.apolloSetSelectedFeature(h._id)})),t(),a.preventDefault()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,"Target assembly"),T.default.createElement(l.Select,{labelId:"label",value:d,onChange:function(e){f(e.target.value)}},c.filter((e=>e.name!==o)).map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},a.readConfObject(e,"displayName"))))),T.default.createElement(l.DialogContentText,null,"Target reference sequence"),T.default.createElement(l.Select,{labelId:"label",value:m,onChange:function(e){g(e.target.value)}},p.map((e=>T.default.createElement(l.MenuItem,{key:e._id,value:e._id},e.name)))),T.default.createElement(l.DialogContentText,null,"Start position in target reference sequence"),T.default.createElement(l.TextField,{margin:"dense",type:"number",fullWidth:!0,variant:"outlined",value:y,onChange:e=>{v(Number(e.target.value))}})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!d||!m||!y,variant:"contained",type:"submit"},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),b?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},b)):null)}function HT({changeManager:e,handleClose:t,session:n}){const{internetAccounts:a}=r.getRoot(n),[o,i]=u.useState(""),[s,c]=u.useState(!1),[d,f]=u.useState(!1),p=a.filter((e=>"ApolloInternetAccount"===e.type));if(0===p.length)throw new Error("No Apollo internet account found");const[h,m]=u.useState(p[0]),{collaborationServerDriver:g}=n.apolloDataStore,y=g.getAssemblies(),[v,b]=u.useState(y.at(0));return T.default.createElement(xf,{open:!0,title:"Delete Assembly",handleClose:t,maxWidth:!1,"data-testid":"delete-assembly"},T.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),f(!0),i(""),!v)return void i("Must select assembly!");const r=new Xn.DeleteAssemblyChange({typeName:"DeleteAssemblyChange",assembly:v.name});await e.submit(r,{internetAccountId:h.internetAccountId}),t(),n.preventDefault()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},p.length>1?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.DialogContentText,null,"Select account"),T.default.createElement(l.Select,{value:h.internetAccountId,onChange:function(e){f(!1);const t=p.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);m(t)},disabled:d&&!o},a.map((e=>T.default.createElement(l.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,T.default.createElement(l.DialogContentText,null,"Select assembly"),T.default.createElement(l.Select,{labelId:"label",value:v?.name??"",onChange:function(e){const t=y.find((t=>t.name===e.target.value));b(t)},disabled:0===y.length},y.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName)))),T.default.createElement(l.DialogContentText,null,T.default.createElement("strong",{style:{color:"red"}},"NOTE: All assembly data will be deleted and this operation cannot be undone!")),T.default.createElement(l.FormGroup,null,T.default.createElement(l.FormControlLabel,{control:T.default.createElement(l.Checkbox,{checked:s,onChange:()=>{c(!s)}}),label:"I understand that all assembly data will be deleted"}))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!v||!s,variant:"contained",type:"submit"},"Delete"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),o?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},o)):null)}function $T({changeManager:e,handleClose:t,selectedFeature:n,session:a,setSelectedFeature:o,sourceAssemblyId:i,sourceFeature:s}){const[c,d]=u.useState(""),{ontologyManager:f}=a.apolloDataStore,{featureTypeOntology:p}=f;function h(e){if(!e.parent?.children||1===e.parent.children.size)return;const t=[];for(const n of e.parent.children.values())p?.isTypeOf(n.type,"CDS")||t.push(n);t.sort(((e,t)=>e.min-t.min));const n=[];for(const t of e.parent.children.values())p?.isTypeOf(t.type,"CDS")||n.push(t);if(n.sort(((e,t)=>t.max-e.max)),e.min===t[0].min){let n;for(const r of t)if(r._id!==e._id&&r.min>=e.min){n=r.min;break}if(n&&n!=e.parent.min)return{typeName:"LocationStartChange",changedId:e.parent._id,featureId:e.parent._id,oldLocation:e.parent.min,newLocation:n}}if(e.max===n[0].max){let t;for(const r of n)if(r._id!=e._id&&r.max<=e.max){t=r.max;break}if(t&&t!=e.parent.max)return{typeName:"LocationEndChange",changedId:e.parent._id,featureId:e.parent._id,oldLocation:e.parent.max,newLocation:t}}}return T.default.createElement(xf,{open:!0,title:"Delete feature",handleClose:t,maxWidth:!1,"data-testid":"delete-feature"},T.default.createElement("form",{onSubmit:a=>{!async function(a){a.preventDefault(),d(""),n?._id===s._id&&o();const l=[],c=new Xn.DeleteFeatureChange({changedIds:[s._id],typeName:"DeleteFeatureChange",assembly:i,changes:[{deletedFeature:r.getSnapshot(s),parentFeatureId:s.parent?._id}]});if(p&&(p.isTypeOf(s.type,"transcript")||p.isTypeOf(s.type,"pseudogenic_transcript"))){const e=h(s);e&&l.push(e)}if(p&&p.isTypeOf(s.type,"exon")){const e=function(e){if(!p)return;if(!p.isTypeOf(e.type,"exon"))return;if(!e.parent?.cdsLocations||0===e.parent.cdsLocations.length||0===e.parent.cdsLocations[0].length)return;if(!e.parent.children)throw new Error("Unable to find parent of CDS");if(1!=e.parent.cdsLocations.length)throw new Error("Unable to handle a transcript with multiple CDSs");const t=(e.parent.cdsLocations.at(0)??[]).sort((({min:e},{min:t})=>e-t));let n;for(const r of e.parent.children.values())if(r.type===t[0].type){n=r;break}if(!n)throw new Error("Unable to find CDS");const a=t[0].min,o=t[t.length-1].max;if(!(e.min>a&&e.max<o||e.max<a||e.min>o)){if(e.min<=a&&e.max>=o)return new Xn.DeleteFeatureChange({changedIds:[n._id],typeName:"DeleteFeatureChange",assembly:i,changes:[{deletedFeature:r.getSnapshot(n),parentFeatureId:n.parent?._id}]});if(e.min<=a&&e.max>a){let r;for(const n of t)if(n.min>e.max){r=n.min;break}if(!r)throw new Error("Error setting new CDS start");return{typeName:"LocationStartChange",changedId:n._id,featureId:n._id,oldLocation:n.min,newLocation:r}}if(e.min<o&&e.max>=o){let r;for(const n of t.reverse())if(n.max<e.min){r=n.max;break}if(!r)throw new Error("Error setting new CDS end");return{typeName:"LocationEndChange",changedId:n._id,featureId:n._id,oldLocation:n.max,newLocation:r}}throw new Error("Unexpected relationship between exon and CDS")}}(s);e&&("DeleteFeatureChange"===e.typeName?(c.changedIds.push(...e.changedIds),c.changes.push(...e.changes)):l.push(e));const t=h(s);if(t){l.push(t);const e=s.parent?.parent;if(e?.children)if("LocationStartChange"===t.typeName){let n=t.newLocation;for(const[,r]of e.children)r._id!=t.featureId&&r.min<n&&(n=r.min);n!=e.min&&l.push({typeName:t.typeName,changedId:e._id,featureId:e._id,oldLocation:e.min,newLocation:n})}else{let n=t.newLocation;for(const[,r]of e.children)r._id!=t.featureId&&r.max>n&&(n=r.max);n!=e.max&&l.push({typeName:t.typeName,changedId:e._id,featureId:e._id,oldLocation:e.max,newLocation:n})}}}const u=function(e,t){if(0===e.length)return;const n=new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:t}),r=new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:t});for(const t of e)"LocationStartChange"===t.typeName&&(n.changedIds.push(t.changedId),n.changes.push({featureId:t.featureId,oldStart:t.oldLocation,newStart:t.newLocation})),"LocationEndChange"===t.typeName&&(r.changedIds.push(t.changedId),r.changes.push({featureId:t.featureId,oldEnd:t.oldLocation,newEnd:t.newLocation}));if(n.changedIds.length>0&&0===r.changedIds.length)return n;if(r.changedIds.length>0&&0===n.changedIds.length)return r;throw new Error("Unexpected list of changes")}(l,i);await e.submit(c),u&&await e.submit(u),t(),a.preventDefault()}(a)}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,"Are you sure you want to delete the selected feature?")),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit"},"Yes"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),c?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},c)):null)}!function(e){e.GENE_AND_SUBFEATURES="GENE_AND_SUBFEATURES",e.TRANSCRIPT_AND_SUBFEATURES="TRANSCRIPT_AND_SUBFEATURES",e.CUSTOM="CUSTOM"}(qT||(qT={}));var VT={exports:{}};function WT({handleClose:e,session:t}){const[n,o]=u.useState(!1),[i,s]=u.useState(),[c,d]=u.useState(""),{collaborationServerDriver:f,getInternetAccount:p,inMemoryFileDriver:h}=t.apolloDataStore,m=[...f.getAssemblies(),...h.getAssemblies()];return T.default.createElement(xf,{open:!0,title:"Export GFF3",handleClose:e,maxWidth:!1,"data-testid":"download-gff3"},T.default.createElement("form",{onSubmit:async function(o){if(o.preventDefault(),d(""),!i)return void d("Must select assembly to download");const{internetAccountConfigId:s}=a.getConf(i,["sequence","metadata"]);s?await async function(e){if(!i)return void d("Must select assembly to download");const t=p(i.configuration.name,e),r=new URL("export/getID",t.baseURL),a=new URLSearchParams({assembly:i.name});r.search=a.toString();const o=r.toString(),s=t.getFetcher({locationType:"UriLocation",uri:o}),l=await s(o,{method:"GET"});if(!l.ok){const e=await bf(l,"Error when exporting ID");return void d(e)}const{exportID:c}=await l.json(),u=new URL("export",t.baseURL),f=new URLSearchParams({exportID:c,includeFASTA:n?"true":"false"});u.search=f.toString();const h=u.toString();window.open(h,"_blank")}(s):function(e){if(!i)return void d("Must select assembly to download");const{assemblies:t}=e.apolloDataStore,n=t.get(i.name),o=n?.refSeqs;if(!o)return void d(`No refSeqs found for assembly "${i.name}"`);const s=[{directive:"gff-version",value:"3"}],l=a.getConf(i,["sequence","adapter","features"]);for(const e of l){const{end:t,refName:n,start:r}=e;s.push({directive:"sequence-region",value:`${n} ${r+1} ${t}`})}for(const[,e]of o){const{features:t}=e;if(t)for(const[,e]of t)s.push(Xn.annotationFeatureToGFF3(r.getSnapshot(e)))}for(const e of l){const{refName:t,seq:n}=e;s.push({id:t,description:"",sequence:n})}const c=wd.formatSync(s),u=new Blob([c],{type:"text/plain;charset=utf-8"});VT.exports.saveAs(u,`${i.displayName??i.name}.gff3`)}(t),e()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,"Select assembly"),T.default.createElement(l.Select,{labelId:"label",value:i?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));s(t)},disabled:0===m.length},m.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),T.default.createElement(l.DialogContentText,null,"Select assembly to export to GFF3"),T.default.createElement(l.FormGroup,null,T.default.createElement(l.FormControlLabel,{"data-testid":"include-fasta-checkbox",control:T.default.createElement(l.Checkbox,{checked:n,onChange:()=>{o(!n)}}),label:"Include fasta sequence in GFF output"}))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!i,variant:"contained",type:"submit"},"Download"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),c?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},c)):null)}function JT({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:r}=n,[o,i]=u.useState(),[s,c]=u.useState(),[d,f]=u.useState(""),[p,h]=u.useState(!1),[m,g]=u.useState(),[y,v]=u.useState(!1),[b,_]=u.useState(!1),{collaborationServerDriver:w,getInternetAccount:x}=r,S=w.getAssemblies();return u.useEffect((()=>{s&&(async()=>{const{internetAccountConfigId:e}=a.getConf(s,["sequence","metadata"]),t=x(s.name,e);if(!t)throw new Error("No Apollo internet account found");const{baseURL:n}=t,r=new URL("features/count",n),o=new URLSearchParams({assemblyId:s.name});r.search=o.toString();const i=t.getFetcher({locationType:"UriLocation",uri:r.toString()});_(!0);const l=await i(r.toString(),{method:"GET"});if(!l.ok)throw new Error(await bf(l));{const e=await l.json();g(e.count)}_(!1)})().catch((e=>{console.error(e),f(e.message??e)}))}),[x,n,s]),T.default.createElement(xf,{open:!0,title:"Import Features from GFF3 file",handleClose:t,maxWidth:!1,"data-testid":"import-features-dialog"},b?T.default.createElement(F.default,null):null,T.default.createElement("form",{onSubmit:async function(r){r.preventDefault(),f(""),_(!0),h(!0);let i="";if(!o)return void f("must select a file");if(!s)return void f("Must select assembly to download");const{internetAccountConfigId:l}=a.getConf(s,["sequence","metadata"]),c=x(s.name,l),{baseURL:u}=c,d=new URL("files",u);d.searchParams.set("type","text/x-gff3");const p=d.href,m=new FormData;m.append("file",o),m.append("fileName",o.name),m.append("type","text/x-gff3");const g=c.getFetcher({locationType:"UriLocation",uri:p});t();const{jobsManager:v}=n,b=new AbortController,w={name:`Importing features for ${s.displayName}`,statusMessage:"Uploading file, this may take awhile",progressPct:0,cancelCallback:()=>{b.abort("ImportFeatures"),v.abortJob(w.name)}};if(v.runJob(w),g){const{signal:e}=b,t=await g(p,{method:"POST",body:m,signal:e});if(!t.ok){const e=await bf(t,"Error when inserting new features (while uploading file)");return v.abortJob(w.name,e),void f(e)}i=(await t.json())._id}const S=new Xn.AddFeaturesFromFileChange({typeName:"AddFeaturesFromFileChange",assembly:s.name,fileId:i,deleteExistingFeatures:y});v.done(w),await e.submit(S,{updateJobsManager:!0})}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,"Select assembly"),T.default.createElement(l.Select,{labelId:"label",value:s?.name??"",onChange:function(e){const t=S.find((t=>t.name===e.target.value));c(t),h(!1)},disabled:p&&!d},S.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName??e.name))))),T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,"Upload GFF3 to load features"),T.default.createElement("input",{type:"file",onChange:function(e){h(!1),e.target.files&&i(e.target.files[0])},disabled:p&&!d})),m&&m>0?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,null,"This assembly already has ",m," features, would you like to delete the existing features before importing new ones?"),T.default.createElement(R.default,{label:"Yes, delete existing features",disabled:p&&!d,control:T.default.createElement(I.default,{checked:y,onChange:function(e){v(e.target.checked)},slotProps:{input:{"aria-label":"controlled"}},color:"warning"})})):null,T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!(s&&o&&void 0!==m)||p,variant:"contained",type:"submit"},p?"Submitting...":"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Close"))),d?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},d)):null)}function YT({handleClose:e,session:t}){const{internetAccounts:n}=r.getRoot(t),[a,o]=u.useState(""),i=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===i.length)throw new Error("No Apollo internet account found");const[s,c]=u.useState(i[0]);return T.default.createElement(xf,{open:!0,title:"Log out",handleClose:e,maxWidth:!1,"data-testid":"log-out"},T.default.createElement("form",{onSubmit:function(e){e.preventDefault(),o(""),s.removeToken(),globalThis.location.reload()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},i.length>1?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.DialogContentText,null,"Select account"),T.default.createElement(l.Select,{value:s.internetAccountId,onChange:function(e){const t=i.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);c(t)}},n.map((e=>T.default.createElement(l.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,T.default.createElement(l.DialogContentText,null,"Are you sure you want to log out?")),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!s,variant:"contained",type:"submit"},"Log Out"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),a?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},a)):null)}function KT({handleClose:e,session:t}){const{internetAccounts:n}=r.getRoot(t),[a,o]=u.useState(""),[i,s]=u.useState(!1),c=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===c.length)throw new Error("No Apollo internet account found");const[d,f]=u.useState(c[0]),[p,h]=u.useState([]),[m,g]=u.useState([]),{collaborationServerDriver:y}=t.apolloDataStore,v=y.getAssemblies(),[b,_]=u.useState(v.at(0));function w(e,t){const n=[...m],r=e.target.value;if(t)n.includes(r)||(n.push(r),g(n));else{const e=n.indexOf(r,0);-1!==e&&n.splice(e,1),g(n)}}return u.useEffect((()=>{(async function(){const{baseURL:e,getFetcher:t}=d,n=new URL("checks/types",e).href,r=t({locationType:"UriLocation",uri:n}),a=await r(n,{method:"GET"});if(!a.ok){const e=await bf(a,"Error when retrieving checks from server");return void o(e)}const i=await a.json();h(i)})().catch((e=>{o(String(e))}))}),[d]),u.useEffect((()=>{(async function(){if(!b)return;const{baseURL:e,getFetcher:t}=d,n=new URL(`assemblies/${b.name}`,e).href,r=t({locationType:"UriLocation",uri:n}),a=await r(n,{method:"GET"});if(!a.ok){const e=await bf(a,"Error when retrieving assembly from server");return void o(e)}const i=await a.json();g(i.checks)})().catch((e=>{o(String(e))}))}),[b,d]),T.default.createElement(xf,{open:!0,title:"Manage Checks",handleClose:e,"data-testid":"manage-checks"},T.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),!b)return void o("Must select assembly!");const{notify:r}=t,{baseURL:a,getFetcher:i}=d,s=new URL("assemblies/checks",a).href,l=i({locationType:"UriLocation",uri:s}),c=await l(s,{method:"POST",body:JSON.stringify({_id:b.name,checks:m,name:""}),headers:{"Content-Type":"application/json"}});if(c.ok)r("Assembly checks updated successfully","success"),e();else{const e=await bf(c,"Error when updating assembly checks");o(e)}}},T.default.createElement(l.DialogContent,null,c.length>1?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.DialogContentText,null,"Select account"),T.default.createElement(l.Select,{value:d.internetAccountId,onChange:function(e){s(!1);const t=c.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);f(t)},disabled:i&&!a},n.map((e=>T.default.createElement(l.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,T.default.createElement(l.DialogContentText,null,"Select assembly"),T.default.createElement(l.Select,{style:{width:300},labelId:"label",value:b?.name??"",onChange:function(e){const t=v.find((t=>t.name===e.target.value));_(t)},disabled:0===v.length},v.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName)))),T.default.createElement("br",null),T.default.createElement("br",null),T.default.createElement(l.TableContainer,{component:l.Paper},T.default.createElement(l.Table,null,T.default.createElement(l.TableHead,null,T.default.createElement(l.TableRow,null,T.default.createElement(l.TableCell,null,"Check name"),T.default.createElement(l.TableCell,null,"Use check"))),T.default.createElement(l.TableBody,null,p.map((e=>T.default.createElement(l.TableRow,{key:e._id},T.default.createElement(l.TableCell,null,e.name),T.default.createElement(l.TableCell,null,T.default.createElement(l.Checkbox,{value:e._id,checked:m.includes(e._id),onChange:w}))))))))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit"},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),a?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},a)):null)}function ZT({changeManager:e,handleClose:t,session:n}){const{internetAccounts:a}=r.getRoot(n),o=a.filter((e=>"ApolloInternetAccount"===e.type&&e.role?.includes("admin")));if(0===o.length)throw new Error("No Apollo internet account found");const[i,s]=u.useState(""),[c,d]=u.useState(o[0]),[p,h]=u.useState([]);function m(e){return e===c.getUserId()}u.useEffect((()=>{(async function(){const{baseURL:e}=c,t=new URL("users",e).href,n=c.getFetcher({locationType:"UriLocation",uri:t});if(n){const e=await n(t,{method:"GET"});if(!e.ok){const t=await bf(e,"Error when getting user data from db");return void s(t)}const r=await e.json();h(r.map((e=>void 0===e.role?{...e,role:""}:e)))}})().catch((e=>{s(String(e))}))}),[c]);const g=[{field:"username",headerName:"User",width:140},{field:"email",headerName:"Email",width:160},{field:"role",headerName:"Role",width:140,type:"singleSelect",valueOptions:["readOnly","user","admin","none"],getOptionLabel(e){switch(e){case"readOnly":return"Read-only";case"user":return"User";case"admin":return"Admin";case"none":return"None";default:return"unknown"}},editable:!0},{field:"actions",type:"actions",getActions:t=>[T.default.createElement(f.GridActionsCellItem,{key:`delete-${t.id}`,icon:T.default.createElement(pd,null),onClick:async()=>{globalThis.confirm("Delete this user?")&&await async function(t){const n=new Xn.DeleteUserChange({typeName:"DeleteUserChange",userId:t});await e.submit(n,{internetAccountId:c.internetAccountId}),h((e=>e.filter((e=>e._id!==t))))}(t.id)},disabled:m(t.id),label:"Delete"})]}];return T.default.createElement(xf,{open:!0,fullScreen:!0,title:"Manage users",handleClose:t,"data-testid":"manage-users"},T.default.createElement(l.DialogContent,null,o.length>1?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.DialogContentText,null,"Select account"),T.default.createElement(l.Select,{value:c.internetAccountId,onChange:function(e){const t=o.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);d(t)},disabled:!i},a.map((e=>T.default.createElement(l.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,T.default.createElement("div",{style:{height:"100%",width:"100%"}},T.default.createElement(f.DataGrid,{pagination:!0,rows:p,columns:g,getRowId:e=>e._id,slots:{toolbar:f.GridToolbar},getRowHeight:()=>"auto",isCellEditable:e=>!m(e.id),processRowUpdate:async function(t){const n=new Xn.UserChange({typeName:"UserChange",role:t.role,userId:t._id});return await e.submit(n,{internetAccountId:c.internetAccountId}),t},onProcessRowUpdateError:e=>{s(String(e))}}))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),i?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},i)):null)}function XT(e,t){const n=t[e];let r;if("three_prime"===e)r=`3'end (coords: ${n.min+1}-${n.max})`;else{if("five_prime"!==e)throw new Error(`Unexpected direction: "${e}"`);r=`5'end (coords: ${n.min+1}-${n.max})`}return r}function QT({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:a,sourceAssemblyId:o,sourceFeature:i}){const[s,c]=u.useState(""),[d,f]=u.useState(),p=function(e){const t={},n=e.parent;if(!n)throw new Error("Unable to find parent of reference exon");let r=[];if(n.children)for(const[,e]of n.children)"exon"===e.type&&r.push(e);r=r.sort(((e,t)=>e.min===t.min?e.max-t.max:e.min-t.min)),n.strand&&-1===n.strand&&(r=r.reverse());let a=0;for(const n of r){if(n._id===e._id){r.length>a+1&&(t.three_prime=r[a+1]),a>0&&(t.five_prime=r[a-1]);break}a++}return t}(i);return T.default.createElement(xf,{open:!0,title:"Merge exons",handleClose:t,maxWidth:!1,"data-testid":"merge-exons"},T.default.createElement("form",{onSubmit:function(s){s.preventDefault(),c("");const{parent:l}=i;if(!d||!l)return;n?._id===i._id&&a();const u=new Xn.MergeExonsChange({changedIds:[i._id],typeName:"MergeExonsChange",assembly:o,firstExon:r.getSnapshot(i),secondExon:r.getSnapshot(d),parentFeatureId:l._id});e.submit(u),t(),s.preventDefault()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(p).length?"There are no neighbouring exons to merge with":"Merge with exon on:",T.default.createElement(l.FormControl,{style:{marginTop:5}},T.default.createElement(l.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:d,onChange:e=>{c("");const{value:t}=e.target;f(p[t])}},Object.keys(p).map((e=>T.default.createElement(l.FormControlLabel,{value:e,key:e,control:T.default.createElement(l.Radio,null),label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},XT(e,p))})))))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(p).length||void 0===d},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),s?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},s)):null)}function eN(e){let t;return t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id,`${t} [${e.min+1}-${e.max}]`}function tN({changeManager:e,handleClose:t,selectedFeature:n,session:a,setSelectedFeature:o,sourceAssemblyId:i,sourceFeature:s}){const[c,d]=u.useState(""),f=function(e,t){const n=e.parent;if(!n)throw new Error("Unable to find parent of reference transcript");const{featureTypeOntology:r}=t.apolloDataStore.ontologyManager;if(!r)throw new Error("featureTypeOntology is undefined");const a={};if(n.children)for(const[,t]of n.children)r.isTypeOf(t.type,"transcript")&&t._id!==e._id&&(a[t._id]=t);return a}(s,a),p=Object.keys(f).at(0),[h,m]=u.useState(p);return T.default.createElement(xf,{open:!0,title:"Merge transcripts",handleClose:t,maxWidth:!1,"data-testid":"merge-transcripts"},T.default.createElement("form",{onSubmit:function(a){if(a.preventDefault(),d(""),!h)return;const l=f[h];if(n?._id===s._id&&o(),!s.parent)throw new Error("Cannot find parent");const c=new Xn.MergeTranscriptsChange({changedIds:[s._id],typeName:"MergeTranscriptsChange",assembly:i,firstTranscript:r.getSnapshot(s),secondTranscript:r.getSnapshot(l),parentFeatureId:s.parent._id});e.submit(c),t()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(f).length?"There are no transcripts to merge with":"Merge with transcript:",T.default.createElement(l.FormControl,{style:{marginTop:5}},T.default.createElement(l.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:h,onChange:e=>{d("");const{value:t}=e.target;m(t)}},Object.keys(f).map((e=>T.default.createElement(l.FormControlLabel,{value:e,key:e,control:T.default.createElement(l.Radio,null),label:T.default.createElement(l.Box,{display:"flex",alignItems:"center"},eN(f[e]))})))))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(f).length||void 0===h},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),c?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},c)):null)}!function(e,t){!function(){function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){i(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==("undefined"==typeof window?"undefined":W(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":W(self))&&self.self===self?self:"object"==W(M)&&M.global===M?M:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=a.saveAs||("object"!=("undefined"==typeof window?"undefined":W(window))||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,o,i){var s=a.URL||a.webkitURL,l=document.createElement("a");l.download=o=o||e.name||"download",l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,o,i):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,o){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=W(t)&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),a);else if(n(e))t(e,a,o);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){r(i)}))}}:function(e,n,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var d=a.URL||a.webkitURL,f=d.createObjectURL(e);i?i.location=f:location.href=f,i=null,setTimeout((function(){d.revokeObjectURL(f)}),4e4)}});a.saveAs=i.saveAs=i,e.exports=i}()}(VT);var nN=function(){return crypto.getRandomValues(new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:21)).reduce((function(e,t){return e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")}),"")};function rN({handleClose:e,session:t}){const{apolloDataStore:r}=t,{addAssembly:a,addSessionAssembly:o,assemblyManager:i,notify:s}=t,[c,d]=u.useState(null),[f,p]=u.useState(""),[h,m]=u.useState(""),[g,y]=u.useState(!1),v=l.useTheme();return T.default.createElement(xf,{open:!0,title:"Open local GFF3 file",handleClose:e,maxWidth:!1,"data-testid":"open-local-file"},T.default.createElement("form",{onSubmit:async function(l){if(l.preventDefault(),m(""),y(!0),!c)throw new Error("No file selected");const u=await new Response(c).text(),d=`${f}-${c.name}-${nN(8)}`;try{await Vd(d,u,r)}catch(t){return console.error(t),s(`Error loading GFF3 ${c.name}, ${String(t)}`,"error"),void e()}const p={};if(n.isElectron){const{webUtils:e}=globalThis.require("electron");p.file=e.getPathForFile(c)}const h={name:d,aliases:[f],displayName:f,sequence:{trackId:`sequenceConfigId-${f}`,type:"ReferenceSequenceTrack",adapter:{type:"ApolloSequenceAdapter",assemblyId:d},metadata:{apollo:!0,...p}}};await(n.isElectron?a?.(h):(o||a)(h));const g=await i.waitForAssembly(h.name);g?(t.addApolloTrackConfig(g),s(`Loaded GFF3 ${c.name}`,"success")):s(`Error loading GFF3 ${c.name}`,"error"),e()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.FormControl,null,T.default.createElement("div",{style:{flexDirection:"row"}},T.default.createElement(l.Button,{variant:"contained",component:"label",style:{marginRight:v.spacing()}},"Choose File",T.default.createElement("input",{type:"file",required:!0,hidden:!0,onChange:function(e){const t=e.target.files?.item(0);if(t&&(m(""),d(t),!f)){const e=t.name,n=e.lastIndexOf(".");p(-1===n?e:e.slice(0,n))}}})),c?c.name:"No file chosen"),T.default.createElement(l.FormHelperText,null,"Make sure your GFF3 has an embedded FASTA section")),T.default.createElement(l.TextField,{required:!0,label:"Assembly name",value:f,onChange:function(e){p(e.target.value)}})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{disabled:!1,variant:"contained",type:"submit"},g?"Submitting...":"Submit"),T.default.createElement(l.Button,{disabled:g,variant:"outlined",type:"submit",onClick:e},"Cancel"))),h?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},h)):null)}const aN=d.makeStyles()((e=>({changeTextarea:{fontFamily:"monospace",width:600,resize:"none",border:`1px solid ${e.palette.divider}`,borderRadius:e.shape.borderRadius}})));function oN({handleClose:e,session:t}){const{internetAccounts:n}=r.getRoot(t),a=n.find((e=>"ApolloInternetAccount"===e.type));if(!a)throw new Error("No Apollo internet account found");const{baseURL:o}=a,{classes:i}=aN(),[s,c]=u.useState(),[d,p]=u.useState([]),{collaborationServerDriver:h}=t.apolloDataStore,m=h.getAssemblies(),[g,y]=u.useState(m.at(0)),v=[{field:"sequence"},{field:"typeName",headerName:"Change type",width:200,type:"singleSelect",valueOptions:[...L.changeRegistry.changes.keys()]},{field:"changes",headerName:"Change JSON",width:600,renderCell:({value:e})=>T.default.createElement("textarea",{className:i.changeTextarea,value:JSON.stringify(e),readOnly:!0})},{field:"user",headerName:"User",width:140},{field:"createdAt",headerName:"Time",width:160,type:"dateTime",valueGetter:e=>e&&new Date(e)}];return u.useEffect((()=>{(async function(){if(!g)return;const e=new URL("changes",o),t=new URLSearchParams({assembly:g.name});e.search=t.toString();const n=e.toString(),r=a?.getFetcher({locationType:"UriLocation",uri:n});if(r){const e=await r(n,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await bf(e,"Error when retrieving changes");return void c(t)}const t=await e.json();p(t)}})().catch((e=>{c(String(e))}))}),[a,o,g]),T.default.createElement(xf,{open:!0,fullScreen:!0,title:"View change log",handleClose:e,"data-testid":"view-changelog"},T.default.createElement(l.Select,{style:{width:200,marginLeft:40},value:g?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));y(t)}},m.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName||e.name)))),T.default.createElement(l.DialogContent,null,T.default.createElement(f.DataGrid,{pagination:!0,rows:d,columns:v,getRowId:e=>e._id,slots:{toolbar:f.GridToolbar},initialState:{sorting:{sortModel:[{field:"sequence",sort:"desc"}]},columns:{columnVisibilityModel:{sequence:!1}}}})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:e},"Close")),s?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},s)):null)}const iN=[{field:"refName",headerName:"Ref Name"},{field:"aliases",headerName:"Aliases",editable:!0,flex:1}],sN=e=>/^[\da-f]{24}$/i.test(e),lN=h.observer((function({changeManager:e,handleClose:t,session:n}){const r=u.useRef(null),[a,o]=u.useState(""),[i,s]=u.useState(!1),[c,d]=u.useState(),[p,h]=u.useState([]),[m,g]=u.useState(new Map),{apolloDataStore:y}=n,{collaborationServerDriver:v}=y,b=v.getAssemblies();u.useEffect((()=>{b.length>0&&(d(b[0]),v.getRefNameAliases(b[0].name).then((e=>{_(e)})).catch((()=>{g(new Map),o("Error fetching refName aliases for assembly")})))}),[]);const _=e=>{const t=new Map;for(const n of e){const e=n.refName;sN(e)||t.set(e,n.aliases)}g(t)},w=()=>[...m].map(((e,t)=>({id:t,refName:e[0],aliases:e[1].filter((t=>t!==e[0])).join(", ")})));return T.default.createElement(xf,{open:!0,title:"Add reference sequence aliases",handleClose:t,maxWidth:"sm","data-testid":"add-refseq-alias",fullWidth:!0},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.Grid,{container:!0,spacing:2},T.default.createElement(l.Grid,null,T.default.createElement(l.FormControl,{disabled:i&&!a,fullWidth:!0},T.default.createElement(l.InputLabel,{id:"demo-simple-select-label"},"Assembly"),T.default.createElement(l.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Assembly",value:c?.name??"",onChange:e=>{const t=b.find((t=>t.name===e.target.value));d(t),t?.name&&(v.getRefNameAliases(t.name).then((e=>{_(e),o("")})).catch((()=>{g(new Map),o("Error fetching refName aliases for assembly")})),s(!1),r.current&&(r.current.value=""))},style:{minWidth:150}},b.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName)))))),T.default.createElement(l.Grid,null,T.default.createElement(l.InputLabel,null,"Load RefName alias"),T.default.createElement("input",{type:"file",onChange:e=>{(async e=>{if(!e.target.files)return;const t=e.target.files[0],n=(await t.text()).split("\n"),r=new Map(m);o("");for(const e of n){const t=e.split("\t");for(const e of t)r.has(e)&&r.set(e,[...r.get(e)??[],...t])}g(r)})(e).catch((()=>{o("Error reading file")}))},ref:r,disabled:i&&!a||!c}))),c&&m.size>0?T.default.createElement("div",{style:{height:200,width:"100%",marginTop:20}},T.default.createElement(l.InputLabel,null,"Refname aliases found for selected assembly."),T.default.createElement(f.DataGrid,{rows:w(),columns:iN,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],onRowSelectionModelChange:e=>{const{ids:t}=e;if(t.size>0){s(!0);const e=[...t.values()].flatMap((e=>w().filter((t=>String(t.id)===String(e)))));h(e)}else s(!1),h([])},processRowUpdate:(e,t)=>{const n=new Map(m);return n.set(e.refName,e.aliases.split(",")),g(n),e},checkboxSelection:!0,disableRowSelectionExcludeModel:!0})):null),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:!i,onClick:()=>{const n=[];for(const e of p){const{refName:t}=e,r=e.aliases.split(",").map((e=>e.trim())).filter((e=>e.length>0));n.push({refName:t,aliases:r})}if(o(""),!c)return void o("No assembly selected");const r=new Xn.AddRefSeqAliasesChange({typeName:"AddRefSeqAliasesChange",assembly:c.name,refSeqAliases:n});e.submit(r).catch((()=>{o("Error submitting change")})),t()}},"Submit"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),a?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},a)):null)}));function cN({handleClose:e,session:t}){const{internetAccounts:n}=r.getRoot(t),{collaborationServerDriver:a}=t.apolloDataStore,o=n.find((e=>"ApolloInternetAccount"===e.type));if(!o)throw new Error("No Apollo internet account found");const{baseURL:i}=o,[s,c]=u.useState(),[d,p]=u.useState([]),h=a.getAssemblies(),[m,g]=u.useState(h.at(0));return u.useEffect((()=>{(async function(){const e=m?.name;if(!e)return;const t=new URL("checks",i),n=new URLSearchParams({assembly:e});t.search=n.toString();const r=t.toString(),a=o?.getFetcher({locationType:"UriLocation",uri:r});if(a){const e=await a(r,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await bf(e,"Error when retrieving checks");return void c(t)}const t=await e.json();p(t)}})().catch((e=>{c(String(e))}))}),[m,o,i]),T.default.createElement(xf,{open:!0,fullScreen:!0,title:"View check results",handleClose:e,"data-testid":"view-check-results"},T.default.createElement(l.Select,{style:{width:200,marginLeft:40},value:m?.name??"",onChange:function(e){const t=h.find((t=>t.name===e.target.value));g(t)},disabled:0===h.length},h.map((e=>T.default.createElement(l.MenuItem,{key:e.name,value:e.name},e.displayName)))),T.default.createElement(l.DialogContent,null,T.default.createElement(f.DataGrid,{pagination:!0,rows:d,columns:[{field:"_id",headerName:"id",width:50},{field:"name",headerName:"Check name",width:200},{field:"refSeq",headerName:"Reference sequence ID",width:200},{field:"ids",headerName:"Feature IDs",width:200},{field:"message",headerName:"Message",flex:1}],getRowId:e=>e._id,slots:{toolbar:f.GridToolbar},initialState:{sorting:{sortModel:[{field:"name",sort:"asc"}]},columns:{columnVisibilityModel:{name:!0}}}})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:e},"Close")),s?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},s)):null)}function uN(e){return e.max-e.min<2?{isSplittable:!1,comment:"This exon is too short to be split"}:{isSplittable:!0,comment:""}}function dN({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:a,sourceAssemblyId:o,sourceFeature:i}){const[s,c]=u.useState(""),d=r.getSnapshot(i);return T.default.createElement(xf,{open:!0,title:"Split exon",handleClose:t,maxWidth:!1,"data-testid":"split-exon"},T.default.createElement("form",{onSubmit:function(r){r.preventDefault(),c(""),n?._id===i._id&&a();const s=d.min+(d.max-d.min)/2,l=Math.floor(s),u=Math.ceil(s);if(!i.parent?._id)throw new Error("Splitting an exon without parent is not possible yet");const f=new Xn.SplitExonChange({changedIds:[i._id],typeName:"SplitExonChange",assembly:o,exonToBeSplit:d,parentFeatureId:i.parent._id,upstreamCut:l,downstreamCut:u,leftExonId:(new Hn).toHexString(),rightExonId:(new Hn).toHexString()});e.submit(f),t(),r.preventDefault()}},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column"}},T.default.createElement(l.DialogContentText,null,function(e){const t=uN(e);return t.isSplittable?"Are you sure you want to split the selected exon?":t.comment}(d))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:!uN(d).isSplittable},"Yes"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),s?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},s)):null)}var fN=s.createSvgIcon(i.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle");function pN(e){const{color:t}=e;return T.default.createElement(l.SvgIcon,{viewBox:"0 0 18 18",style:{fontSize:18,marginRight:4},...e},"disabled"===t?T.default.createElement("path",{d:"M9.001,10.71 l0,-3.348 l8.424,0 c0.126,0.567,0.225,1.098,0.225,1.845 c0,5.139,-3.447,8.793,-8.64,8.793 c-4.968,0,-9,-4.032,-9,-9 c0,-4.968,4.032,-9,9,-9 c2.43,0,4.464,0.891,6.021,2.349 l-2.556,2.484 c-0.648,-0.612,-1.782,-1.332,-3.465,-1.332 c-2.979,0,-5.409,2.475,-5.409,5.508 c0,3.033,2.43,5.508,5.409,5.508 c3.447,0,4.716,-2.385,4.95,-3.798 l-4.959,0 l0,-0.009 z"}):T.default.createElement(T.default.Fragment,null,T.default.createElement("path",{d:"M17.64,9.20454545 c0,-0.638,-0.057,-1.252,-0.164,-1.841 l-8.476,0 l0,3.481 l4.844,0 c-0.209,1.125,-0.843,2.079,-1.796,2.717 l0,2.258 l2.908,0 c1.702,-1.567,2.684,-3.874,2.684,-6.615 l0,0 z",fill:"#4285F4"}),T.default.createElement("path",{d:"M9,18 c2.43,0,4.467,-0.806,5.956,-2.18 l-2.908,-2.259 c-0.806,0.54,-1.837,0.859,-3.048,0.859 c-2.344,0,-4.328,-1.583,-5.036,-3.71 l-3.007,0 l0,2.332 c1.481,2.941,4.525,4.958,8.043,4.958 l0,0 z",fill:"#34A853"}),T.default.createElement("path",{d:"M3.96409091,10.71 c-0.18,-0.54,-0.282,-1.117,-0.282,-1.71 c0,-0.593,0.102,-1.17,0.282,-1.71 l0,-2.332 l-3.007,0 c-0.609,1.215,-0.957,2.59,-0.957,4.042 c0,1.452,0.348,2.827,0.957,4.042 l3.007,-2.332 l0,0 z",fill:"#FBBC05"}),T.default.createElement("path",{d:"M9,3.57954545 c1.321,0,2.508,0.454,3.44,1.346 l2.582,-2.581 c-1.559,-1.453,-3.596,-2.345,-6.022,-2.345 c-3.518,0,-6.562,2.017,-8.043,4.959 l3.007,2.331 c0.708,-2.127,2.692,-3.71,5.036,-3.71 l0,0 z",fill:"#EA4335"})))}function hN(e){const{color:t}=e;return T.default.createElement(l.SvgIcon,{viewBox:"0 0 21 21",style:{fontSize:21},...e},T.default.createElement("rect",{x:"1",y:"1",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#F25022"}),T.default.createElement("rect",{x:"1",y:"11",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#00A4EF"}),T.default.createElement("rect",{x:"11",y:"1",width:"9",height:"9",fill:"disabled"===t?"#939393":"#7FBA00"}),T.default.createElement("rect",{x:"11",y:"11",width:"9",height:"9",fill:"disabled"===t?"#B9B9B9":"#FFB900"}))}const mN=d.makeStyles()((e=>({loginButton:{marginBottom:e.spacing(1),width:"220px",height:"40px",fontSize:"16px",textTransform:"none",justifyContent:"left",padding:"3px 12px"}})));function gN(e){const{classes:t}=mN(),{disabled:n}=e;return T.default.createElement(l.Button,{className:t.loginButton,variant:"outlined",startIcon:T.default.createElement(pN,{color:n?"disabled":void 0}),...e},"Sign in with Google")}function yN(e){const{classes:t}=mN(),{disabled:n}=e;return T.default.createElement(l.Button,{className:t.loginButton,variant:"outlined",startIcon:T.default.createElement(hN,{color:n?"disabled":void 0}),...e},"Sign in with Microsoft")}function vN(e){const{classes:t}=mN();return T.default.createElement(l.Button,{className:t.loginButton,variant:"outlined",startIcon:T.default.createElement(fN,{fontSize:"small"}),...e},"Continue as Guest")}const bN=d.makeStyles()((e=>({divider:{marginTop:e.spacing(4),marginBottom:e.spacing(5)}}))),_N=({baseURL:e,handleClose:t,name:n})=>{const{classes:r}=bN(),[a,o]=u.useState(""),[i,s]=u.useState([]);function c(e){t("google"===e?"google":"microsoft"===e?"microsoft":"guest")}u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return async function(){const t=new URL("auth/types",e).href,r=await fetch(t,{method:"GET",signal:n});if(!r.ok){const e=await bf(r,"Error when retrieving auth types from server");return void o(e)}const a=await r.json();s(a)}().catch((e=>{KO(e)||o(String(e))})),()=>{t.abort("AuthTypeSelector")}}),[e]);const d=i.includes("google"),f=i.includes("microsoft"),p=i.includes("guest");return T.default.createElement(xf,{open:!0,title:`Log in to ${n}`,handleClose:t,maxWidth:!1,"data-testid":"login-apollo"},T.default.createElement(l.DialogContent,{style:{display:"flex",flexDirection:"column",paddingTop:8}},d?T.default.createElement(gN,{disabled:!d,onClick:()=>{c("google")}}):null,f?T.default.createElement(yN,{disabled:!f,onClick:()=>{c("microsoft")}}):null,p?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.Divider,{className:r.divider}),T.default.createElement(vN,{onClick:()=>{c("guest")}})):null),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")),a?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},a)):null)},wN="undefined"==typeof sessionStorage,xN=e=>o.InternetAccount.named("ApolloInternetAccount").props({type:r.types.literal("ApolloInternetAccount"),configuration:a.ConfigurationReference(e)}).views((e=>({get baseURL(){return a.getConf(e,"baseURL")},getUserId(){const t=e.retrieveToken();if(t)return Xn.getDecodedToken(t).id}}))).volatile((()=>({role:void 0,controller:new AbortController}))).actions((e=>({setRole(){const t=e.retrieveToken();if(!t)return void(e.role=void 0);const n=Xn.getDecodedToken(t),{role:r}=n;e.role!==r&&(e.role=r)}}))).actions((e=>{let t;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},finishOAuthWindow(t,n,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri.replace("#","?"),o=new URL(a),i=new URLSearchParams(o.search).get("access_token");this.deleteMessageChannel(),i?(e.storeToken(i),e.setRole(),n(i)):r(new Error("Error with token endpoint"))},async openAuthWindow(t,r,a){const o=n.isElectron?"http://localhost/auth":globalThis.location.origin+globalThis.location.pathname,i=new URL("auth/login",e.baseURL),s=new URLSearchParams({type:t,redirect_uri:o});i.search=s.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(n.isElectron){const{ipcRenderer:t}=globalThis.require("electron"),n=await t.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:{redirect_uri:o},url:i.toString()}),s=new MessageEvent("message",{data:{name:l,redirectUri:n}});this.finishOAuthWindow(s,r,a)}else this.addMessageChannel(r,a),window.open(i,l,"width=500,height=600")}}})).actions((e=>({async getTokenFromUser(t,n){const{baseURL:a}=e,o=await new Promise(((t,n)=>{const{session:a}=r.getRoot(e),{baseURL:o,name:i}=e;a.queueDialog((e=>[_N,{name:i,handleClose:r=>{r?r instanceof Error?n(r):t(r):n(new Error("user cancelled entry")),e()},baseURL:o}]))}));if("guest"!==o)return void e.openAuthWindow(o,t,n);const i=new URL("auth/login",a),s=new URLSearchParams({type:o});i.search=s.toString();const l=i.toString(),c=await fetch(l,{signal:e.controller.signal});if(!c.ok){const e=await bf(c,"Error when logging in");return void n(new Error(e))}const{token:u}=await c.json();t(u)}}))).volatile((()=>({lastChangeSequenceNumber:void 0}))).actions((e=>({setLastChangeSequenceNumber(t){e.lastChangeSequenceNumber=t}}))).actions((e=>({updateLastChangeSequenceNumber:r.flow((function*(){const{baseURL:t}=e,n=new URL("changes",t),r=new URLSearchParams({limit:"1"});n.search=r.toString();const a=n.toString(),o=e.getFetcher({locationType:"UriLocation",uri:a});let i;try{i=yield o(a,{method:"GET",signal:e.controller.signal})}catch(t){return void(e.controller.signal.aborted||console.error(t))}if(!i.ok){const e=yield bf(i,"Error when fetching server LastChangeSequence");throw new Error(e)}const s=yield i.json();e.setLastChangeSequenceNumber(s.length>0?s[0].sequence:0)})),getMissingChanges:r.flow((function*(){const{session:t}=r.getRoot(e),{changeManager:n}=t.apolloDataStore;if(!e.lastChangeSequenceNumber)throw new Error("No LastChangeSequence stored in session. Please, refresh you browser to get last updates from server");const{baseURL:a,lastChangeSequenceNumber:o}=e,i=new URL("changes",a),s=new URLSearchParams({since:String(o),sort:"1"});i.search=s.toString();const l=i.toString(),c=e.getFetcher({locationType:"UriLocation",uri:l});let u;try{u=yield c(l,{method:"GET",signal:e.controller.signal})}catch(t){return void(e.controller.signal.aborted||console.error(t))}if(!u.ok)return void console.error(`Error when fetching the last updates to recover socket connection  ${u.status}`);const d=yield u.json();for(const e of d){const t=L.Change.fromJSON(e);n.submit(t,{submitToBackend:!1})}}))}))).volatile((e=>{const{origin:t,pathname:n}=new URL("socket.io/",e.baseURL);return{socket:dd(t,{path:n})}})).actions((e=>({addSocketListeners(){const{session:t}=r.getRoot(e),{notify:n}=t,a=e.retrieveToken();if(!a)throw new Error("No Token found");const o=Xn.getDecodedToken(a),i=Xn.makeUserSessionId(o),{socket:s}=e,{addCheckResult:l,changeManager:c,deleteCheckResult:u}=t.apolloDataStore;s.on("connect",(()=>{e.getMissingChanges()})),s.on("connect_error",(e=>{console.error(e),n("Could not connect to the Apollo server.","error")})),s.on("COMMON",(e=>{if("checkResult"in e)return void(e.deleted?u(e.checkResult._id.toString()):l(e.checkResult));if(sessionStorage.setItem("LastChangeSequence",String(e.changeSequence)),e.userSessionId===i)return;const t=L.Change.fromJSON(e.changeInfo);c.submit(t,{submitToBackend:!1})})),s.on("USER_LOCATION",(e=>{const{channel:n,locations:r,userName:a,userSessionId:o}=e;"USER_LOCATION"===n&&o!==i&&t.addOrUpdateCollaborator({name:a,id:o,locations:r})})),s.on("REQUEST_INFORMATION",(e=>{const{channel:n,userSessionId:r}=e;"REQUEST_INFORMATION"===n&&r!==a&&t.broadcastLocations()}))}}))).actions((e=>({postUserLocation:(t=>{let n;return t=>{clearTimeout(n),n=setTimeout((()=>{!async function(t){if(!r.isAlive(e)||"none"===e.role)return;const{baseURL:n,controller:a}=e,o=new URL("users/userLocation",n).href,i=new URLSearchParams(JSON.stringify(t)),s=e.getFetcher({locationType:"UriLocation",uri:o});try{if(!(await s(o,{method:"POST",body:i,signal:a.signal})).ok)throw new Error("ignore")}catch{console.error("Broadcasting user location failed")}}(t)}),300)}})()}))).volatile((()=>({roleNotificationSent:!1}))).actions((e=>{function t(){e.postUserLocation([])}function a(){if("hidden"===document.visibilityState&&e.postUserLocation([]),"visible"===document.visibilityState){const{session:t}=r.getRoot(e);t.broadcastLocations()}}return{initialize:r.flow((function*(o){if("none"===o){if(!e.roleNotificationSent){const{session:t}=r.getRoot(e);t.notify("You have registered as an Apollo user but have not been given access. Ask your administrator to enable access for your account.","warning"),e.roleNotificationSent=!0}return}if("admin"===o){const t=r.getRoot(e);n.isAbstractMenuManager(t)&&function(e){e.appendToMenu("Apollo",{label:"Admin",type:"subMenu",icon:fd,subMenu:[{label:"Add Assembly",icon:Uc,onClick:e=>{e.queueDialog((t=>[Cf,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Delete Assembly",icon:pd,onClick:e=>{e.queueDialog((t=>[HT,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Import Features",icon:hd,onClick:e=>{e.queueDialog((t=>[JT,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Add reference sequence aliases",onClick:e=>{e.queueDialog((t=>[lN,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Add Assembly aliases",onClick:e=>{e.queueDialog((t=>[Of,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Manage Users",icon:md,onClick:e=>{e.queueDialog((t=>[ZT,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}},{label:"Manage Checks",icon:gd,onClick:e=>{e.queueDialog((t=>[KT,{session:e,handleClose:()=>{t()}}]))}}]})}(t)}yield e.updateLastChangeSequenceNumber(),e.addSocketListeners();const{baseURL:i}=e,s=new URL("users/locations",i).href,l=e.getFetcher({locationType:"UriLocation",uri:s});yield l(s,{method:"GET",signal:e.controller.signal}),window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",a)})),removeBeforeUnloadListener(){window.removeEventListener("beforeunload",t)},removeVisibilityChangeListener(){document.removeEventListener("visibilitychange",a)}}})).actions((e=>({afterAttach(){e.setRole(),c.autorun((async t=>{if(wN)return;const{session:n}=r.getRoot(e);if(n&&e.role)try{await e.initialize(e.role),t.dispose()}catch{}}),{name:"ApolloInternetAccount"})},beforeDestroy(){e.removeBeforeUnloadListener(),e.removeVisibilityChangeListener(),e.controller.abort("internet account beforeDestroy"),e.socket.close()}}))),SN="undefined"==typeof sessionStorage;class EN extends w.BaseAdapter{refNameAliases;async getRefNameAliases(){const e=a.readConfObject(this.config,"assemblyId");if(!SN){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e);if(!n)throw new Error("No backend driver found");return await n.getRefNameAliases(e)}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n(new Error("timeout"))}),2e4),a=nN(),o=e=>{const n=e.data;(function(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo&&"refNameAliases"in e})(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.refNameAliases))};addEventListener("message",o),rpcServer.emit("apollo",{apollo:!0,method:"getRefNameAliases",assembly:e,messageId:a})}));return this.refNameAliases=t,t}freeResources(){}}var kN=a.ConfigurationSchema("ApolloRefNameAliasAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),CN={};function AN(e){return"uniqueId"in e&&"object"!==W(e.data)}Object.defineProperty(CN,"__esModule",{value:!0}),CN.isFeature=function(e){return"object"===W(e)&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id};var ON=function(){function e(t){var n,r=this;K(this,e),AN(t)?this.data=t:(this.data=t.data,this.parentHandle=t.parent);var a=AN(t)?t.uniqueId:t.id;if(null==a)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(a),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(n=this.data.subfeatures)||void 0===n?void 0:n.map((function(t,n){return"function"!=typeof t.get?new e({id:t.uniqueId||"".concat(a,"-").concat(n),data:$({strand:r.data.strand},t),parent:r}):t})))}return X(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=$($({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e($({},t))}}]),e}(),TN=CN.default=ON;function NN(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo}const IN="undefined"==typeof sessionStorage;class RN extends w.BaseSequenceAdapter{regions;async getRefNames(){return(await this.getRegions()).map((e=>e.refName))}async getRegions(){if(this.regions)return this.regions;const e=a.readConfObject(this.config,"assemblyId");if(!IN){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e);if(!n)throw new Error("No backend driver found");const r=await n.getRegions(e);return this.regions=r,r}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n("timeout")}),2e4),a=nN(),o=e=>{const{data:n}=e;NN(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.regions))};addEventListener("message",o),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getRegions",assembly:e,messageId:a})}));return this.regions=t,t}getFeatures(e){const{end:t,refName:n,start:r}=e,o=a.readConfObject(this.config,"assemblyId"),i={...e,assemblyName:o};return x.ObservableCreate((async e=>{if(!IN){const a=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!a)return void e.error("No Apollo data store found");const s=a.getBackendDriver(o);if(!s)return void e.error("No backend driver found");const l=(await s.getRegions(i.assemblyName)).find((e=>e.refName===i.refName));if(!l)return void e.error("Cannot get region");i.end>l.end&&(i.end=l.end);const{seq:c}=await s.getSequence(i);return e.next(new TN({id:`${n} ${r}-${t}`,data:{refName:n,start:r,end:t,seq:c}})),void e.complete()}const a=await new Promise(((e,t)=>{const n=setTimeout((()=>{t("timeout")}),2e4),r=nN(),a=t=>{const{data:o}=t;NN(o)&&o.messageId===r&&(clearTimeout(n),removeEventListener("message",a),e(o.sequence))};addEventListener("message",a),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getSequence",region:i,messageId:r})}));e.next(new TN({id:`${n} ${r}-${t}`,data:{refName:n,start:r,end:t,seq:a}})),e.complete()}))}freeResources(){}}var FN=a.ConfigurationSchema("ApolloSequenceAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),PN={};Object.defineProperty(PN,"__esModule",{value:!0}),PN.RefSequenceResult=void 0;var MN=function(){function e(t){K(this,e),this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}return X(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"hasLocation",value:function(){return!!this.locString}},{key:"getLocation",value:function(){return this.locString}},{key:"getComboResults",value:function(){return this.results}}]),e}(),DN=PN.default=MN,jN=function(e){ee(n,e);var t=le(n);function n(e){var r,a;return K(this,n),(r=t.call(this,e)).refName=null!==(a=e.refName)&&void 0!==a?a:"",r}return X(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(MN);PN.RefSequenceResult=jN;class LN extends w.BaseAdapter{get baseURL(){return a.readConfObject(this.config,"baseURL").uri}get trackId(){return a.readConfObject(this.config,"trackId")}get assemblyNames(){return a.readConfObject(this.config,"assemblyNames")}mapBaseResult(e,t,n){return e.map((e=>{const r=t.getCanonicalRefName(e.refSeq);return new DN({label:n,trackId:this.trackId,locString:`${r}:${e.min+1}..${e.max}`})}))}async searchIndex(e){const t=e.queryString,n=[],r=this.pluginManager?.rootModel?.session;if(!r)return n;const{apolloDataStore:a}=r,{assemblyManager:o}=r;for(const r of this.assemblyNames){const i=a.getBackendDriver(r),s=o.get(r);if(!i||!s)continue;const l=await i.searchFeatures(e.queryString,[r]);n.push(...this.mapBaseResult(l,s,t))}return n}freeResources(){}}var qN=a.ConfigurationSchema("ApolloTextSearchAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"},trackId:{type:"string",defaultValue:""},baseURL:{type:"fileLocation",defaultValue:{uri:"",locationType:"UriLocation"}}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),BN=s.createSvgIcon(i.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),UN=s.createSvgIcon(i.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),zN=s.createSvgIcon(i.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz");const GN=d.makeStyles()((e=>({attributeKey:{fontWeight:"bold",marginRight:e.spacing(2)}})));function HN({attributeKey:e}){const{classes:t}=GN(),n=/^[A-Z]/.test(e);let r,a=e;return Xn.isGFFInternalAttribute(e)?(a=Xn.internalToGFF[e],r=`On GFF3 export, this will be assigned to the GFF3's reserved "${a}" attribute`):Xn.isGFFColumnInternal(e)?(a=Xn.gffInternalToColumn[e],r=`On GFF3 export, this will be placed in the GFF3's "${a}" column`):n&&(r="On GFF3 export, this attribute will be changed to start with a lower-case letter because attributes starting with an upper-case letter are reserved in GFF3"),T.default.createElement("div",{style:{display:"flex"}},T.default.createElement(l.Typography,{className:t.attributeKey},a),r?T.default.createElement(l.Tooltip,{title:r},T.default.createElement(l.Chip,{icon:T.default.createElement(yd,null),label:"GFF3",size:"small",variant:"outlined"})):null)}const $N="Custom",VN={[$N]:"custom"};for(const[e,t]of Object.entries(Xn.gffToInternal))VN[`GFF ${t}`]=e;for(const[e,t]of Object.entries(Xn.gffColumnToInternal))VN[`GFF ${t}`]=e;const WN=h.observer((function({setKey:e,session:t}){const{pluginManager:r}=n.getEnv(t),a=r.evaluateExtensionPoint("Apollo-ReservedAttributeKeys",VN),o=Object.keys(a).at(0)??$N,[i,s]=u.useState(o),[c,d]=u.useState(),f=i===$N;return T.default.createElement("form",{onSubmit:function(t){t.preventDefault(),e(f?c:a[i])}},T.default.createElement("div",{style:{display:"flex",flexDirection:"column",margin:8}},T.default.createElement(l.FormControl,{variant:"outlined"},T.default.createElement(l.InputLabel,{id:"attribute-key-select-label"},"Key"),T.default.createElement(l.Select,{labelId:"attribute-key-select-label",value:i,label:"Key",onChange:e=>{s(e.target.value)}},Object.keys(a).map((e=>T.default.createElement(l.MenuItem,{key:e,value:e},e))))),f?T.default.createElement(l.TextField,{label:"Attribute key",variant:"outlined",id:"attributeKey",onChange:e=>{d(e.target.value)}}):null),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{color:"primary",variant:"contained",type:"submit",disabled:f&&!c},"Add"),T.default.createElement(l.Button,{variant:"outlined",onClick:function(){e()}},"Cancel")))}));var JN=s.createSvgIcon(i.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddBox");const YN=h.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,c]=u.useState(null);return u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),T.default.createElement(l.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{r!==String(t)&&e(r)},inputRef:e=>{c(e)}})})),KN=h.observer((function({attributeValues:e,setAttribute:t,isNew:n=!1}){const[r,a]=u.useState(e&&e.length>0?e:[""]);return T.default.createElement(T.default.Fragment,null,r.map(((e,t)=>T.default.createElement("div",{key:`${t}-${e}`,style:{display:"flex"}},T.default.createElement(YN,{value:e,onChangeCommitted:e=>{!function(e,t){a((n=>{const r=[...n];return r[e]=t,r}))}(t,e)},variant:"outlined",fullWidth:!0}),T.default.createElement(l.IconButton,{"aria-label":"delete",size:"medium",edge:"end",onClick:()=>{!function(e){a((t=>{const n=[...t];return n.splice(e,1),n}))}(t)}},T.default.createElement(pd,{fontSize:"inherit"}))))),T.default.createElement(l.IconButton,{"aria-label":"add",size:"medium",color:"secondary",edge:"start",onClick:function(){a((e=>{const t=[...e];return t.push(""),t}))}},T.default.createElement(JN,{fontSize:"inherit"})),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{color:"primary",variant:"contained",onClick:()=>{t(r.filter(Boolean))}},n?"Add":"Update"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")))}));function ZN({values:e}){return T.default.createElement(T.default.Fragment,null,e?.map(((e,t)=>T.default.createElement(l.Typography,{key:`${t}.${e}`,variant:"body2",color:"textSecondary"},e))))}const XN=d.makeStyles()((e=>({list:{"li:nth-of-type(odd)":{backgroundColor:e.palette.action.focus},"li:nth-of-type(even)":{backgroundColor:e.palette.action.hover}}}))),QN=h.observer((function({assembly:e,editable:t,feature:a,session:o}){const{pluginManager:i}=n.getEnv(o),{classes:s}=XN(),[d,f]=u.useState(null),[p,h]=u.useState(null),[m,g]=u.useState(null),[y,v]=u.useState(!1),[b,_]=u.useState(),w=Boolean(d),{changeManager:x}=o.apolloDataStore,{notify:S}=o;function E(){f(null),h(null)}const{_id:k,attributes:C}=a,A=i.evaluateExtensionPoint("Apollo-AttributeEditorComponent",KN,{key:b});return T.default.createElement(T.default.Fragment,null,T.default.createElement(l.List,{className:s.list},c.entries(C).map((([n,s])=>{const c=i.evaluateExtensionPoint("Apollo-AttributeEditorComponent",KN,{key:n}),u=i.evaluateExtensionPoint("Apollo-AttributeViewerComponent",ZN,{key:n});return T.default.createElement(l.ListItem,{key:n,secondaryAction:t&&!m?T.default.createElement(l.IconButton,{edge:"end",onClick:e=>{!function(e,t){f(e.currentTarget),h(t)}(e,n)}},T.default.createElement(zN,null)):null},T.default.createElement(l.ListItemText,{disableTypography:!0,primary:T.default.createElement(HN,{attributeKey:n}),secondary:m===n?T.default.createElement(c,{session:o,attributeValues:s,setAttribute:t=>{g(null),t&&function(t,n){const o={...r.getSnapshot(C)},i=structuredClone(o);if(!(t in o))return void S(`"${t}" not found in feature attributes`,"error");if(o[t].toString()===n.toString())return;o[t]=n;const s=new Xn.FeatureAttributeChange({changedIds:[a._id],typeName:"FeatureAttributeChange",assembly:e,featureId:a._id,oldAttributes:i,newAttributes:o});x.submit(s)}(n,t)}}):T.default.createElement(u,{values:s})}))})),b?T.default.createElement(l.ListItem,null,T.default.createElement(l.ListItemText,{disableTypography:!0,primary:T.default.createElement(HN,{attributeKey:b}),secondary:T.default.createElement(A,{session:o,attributeValues:[],setAttribute:t=>{t&&function(t,n){const o={...r.getSnapshot(C)},i=structuredClone(o);if(t in o)return void S(`Feature already has attribute "${t}"`,"error");o[t]=n;const s=new Xn.FeatureAttributeChange({changedIds:[a._id],typeName:"FeatureAttributeChange",assembly:e,featureId:a._id,oldAttributes:i,newAttributes:o});x.submit(s)}(b,t),_(void 0)},isNew:!0})})):null),t?T.default.createElement(l.Button,{color:"primary",variant:"contained",disabled:y||Boolean(b),onClick:()=>{v(!0)}},"Add new"):null,y?T.default.createElement(l.Paper,{variant:"outlined",style:{marginTop:8}},T.default.createElement(WN,{session:o,setKey:e=>{_(e),v(!1)}})):null,T.default.createElement(l.Menu,{anchorEl:d,open:w,onClose:E},T.default.createElement(l.MenuItem,{onClick:function(){p&&function(t){const n=r.getSnapshot(C),{[t]:a,...o}=n,i=new Xn.FeatureAttributeChange({changedIds:[k],typeName:"FeatureAttributeChange",assembly:e,featureId:k,oldAttributes:n,newAttributes:o});x.submit(i)}(p),E()}},T.default.createElement(l.ListItemIcon,null,T.default.createElement(pd,{fontSize:"small"})),T.default.createElement(l.Typography,{variant:"inherit"},"Delete")),T.default.createElement(l.MenuItem,{onClick:function(){p&&g(p),E()}},T.default.createElement(l.ListItemIcon,null,T.default.createElement(UN,{fontSize:"small"})),T.default.createElement(l.Typography,{variant:"inherit"},"Edit"))))})),eI=h.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,c]=u.useState(null);u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]);const d=Number.isNaN(Number(r));return T.default.createElement(l.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{const n=Number(r);r!==String(t)&&(Number.isNaN(n)?a(String(t)):e(n)||a(String(t)))},inputRef:e=>{c(e)},error:d,helperText:d?"Not a valid number":void 0})})),tI=h.observer((function({assembly:e,feature:t,session:n}){const[r,a]=u.useState(""),[o,i]=u.useState(""),{_id:s,assemblyId:c,max:d,min:f,strand:p,type:h}=t,m=e=>{n.notify(e.message,"error")},{changeManager:g}=n.apolloDataStore;function y(t){const{value:n}=t.target,r=n?Number(n):void 0,a=new Xn.StrandChange({typeName:"StrandChange",changedIds:[s],featureId:s,oldStrand:p,newStrand:r,assembly:e});return g.submit(a)}return T.default.createElement("div",{"data-testid":"basic_information"},T.default.createElement(eI,{margin:"dense",id:"start",label:"Start",fullWidth:!0,variant:"outlined",value:f+1,onChangeCommitted:function(t){t--;const n=new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[s],featureId:s,oldStart:f,newStart:t,assembly:e});return g.submit(n),!0}}),T.default.createElement(eI,{margin:"dense",id:"end",label:"End",fullWidth:!0,variant:"outlined",value:d,onChangeCommitted:function(t){const n=new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[s],featureId:s,oldEnd:d,newEnd:t,assembly:e});return g.submit(n),!0}}),T.default.createElement(RT,{session:n,ontologyName:"Sequence Ontology",value:h,filterTerms:TT,fetchValidTerms:async function(e,t,n){const r=await IT(e,t);if(r)return r;i(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,t),renderInput:e=>T.default.createElement(l.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(o),helperText:o}),onChange:(e,t)=>{t&&function(e){a("");const t=new Xn.TypeChange({typeName:"TypeChange",changedIds:[s],featureId:s,oldType:h,newType:e,assembly:c});return g.submit(t)}(t).catch(m)}}),T.default.createElement("label",null,T.default.createElement("input",{type:"radio",value:"1",checked:1===p,onChange:y}),"Positive Strand (+)"),T.default.createElement("label",null,T.default.createElement("input",{type:"radio",value:"-1",checked:-1===p,onChange:y}),"Negative Strand (-)"),T.default.createElement("label",null,T.default.createElement("input",{type:"radio",value:"",checked:void 0===p,onChange:y}),"No Strand Information"),r?T.default.createElement(l.Typography,{color:"error"},r):null)})),nI=h.observer((function(e){const{feature:t,model:n}=e,{children:r,parent:a}=t,o=[];if(r)for(const[,e]of r)o.push(e);return a??o.length>0?T.default.createElement("div",{style:{marginTop:10}},a&&T.default.createElement("div",null,T.default.createElement(l.Typography,{variant:"h6"},"Parent:"),T.default.createElement(l.Button,{variant:"contained",onClick:()=>{n.setFeature(a)}},a.type,Kd(a)," (",a.min,"..",a.max,")")),o.length>0&&T.default.createElement("div",null,T.default.createElement(l.Typography,{variant:"h6"},1===o.length?"Child":"Children",":"),o.map((e=>T.default.createElement("div",{key:e._id,style:{marginBottom:5}},T.default.createElement(l.Button,{variant:"contained",onClick:()=>{n.setFeature(e)}},e.type,Kd(e)," (",e.min,"..",e.max,")")))))):null})),rI=d.makeStyles()({sequence:{width:"100%",resize:"vertical"}}),aI=h.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),{classes:o}=rI();if(!t||!a)return null;const i=a.getByRefName(n);if(!i)return null;const{max:s,min:l}=t;let c=i.getSequence(l,s);return c?c=function(e,t,n,r,a){return`>${t}:${n+1}${r}\n${e}`}(c,n,l,s):r.apolloDataStore.loadRefSeq([{assemblyName:e,refName:n,start:l,end:s}]),T.default.createElement("div",null,T.default.createElement("textarea",{readOnly:!0,rows:20,className:o.sequence,value:c}))})),oI=d.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),iI=h.observer((function(e){const{model:t}=e,{assembly:r,feature:a,refName:o}=t,i=n.getSession(t),s=i.apolloDataStore.assemblies.get(r),{classes:c}=oI(),[d,f]=u.useState(["attributes"]);if(u.useEffect((()=>{f(["attributes"])}),[a]),!a||!s)return null;const p=s.getByRefName(o);if(!p)return null;const{max:h,min:m}=a;function g(e,t){f(e?[...d,t]:d.filter((e=>e!==t)))}return p.getSequence(m,h)||i.apolloDataStore.loadRefSeq([{assemblyName:r,refName:o,start:m,end:h}]),T.default.createElement("div",{className:c.root},T.default.createElement(tI,{feature:a,session:i,assembly:s._id}),T.default.createElement(l.Accordion,{style:{marginTop:10},expanded:d.includes("attributes"),onChange:(e,t)=>{g(t,"attributes")}},T.default.createElement(l.AccordionSummary,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},T.default.createElement(l.Typography,{component:"span"},"Attributes")),T.default.createElement(l.AccordionDetails,null,T.default.createElement(QN,{feature:a,session:i,assembly:s._id,editable:!0}))),T.default.createElement(l.Accordion,{style:{marginTop:10},expanded:d.includes("sequence"),onChange:(e,t)=>{g(t,"sequence")}},T.default.createElement(l.AccordionSummary,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},T.default.createElement(l.Typography,{component:"span"},"Sequence")),T.default.createElement(l.AccordionDetails,null,d.includes("sequence")&&T.default.createElement(aI,{feature:a,session:i,assembly:s._id,refName:o}))),T.default.createElement(l.Accordion,{style:{marginTop:10},expanded:d.includes("related_features"),onChange:(e,t)=>{g(t,"related_features")}},T.default.createElement(l.AccordionSummary,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},T.default.createElement(l.Typography,{component:"span"},"Related features")),T.default.createElement(l.AccordionDetails,null,T.default.createElement(nI,{model:t,feature:a}))))}));var sI={},lI={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationFeatureModel=void 0;var t=A.default,n=O.default,r=sI,a=n.types.late((function(){return e.AnnotationFeatureModel}));e.AnnotationFeatureModel=n.types.model("AnnotationFeatureModel",{_id:n.types.identifier,refSeq:n.types.string,type:n.types.string,min:n.types.number,max:n.types.number,strand:n.types.maybe(n.types.union(n.types.literal(1),n.types.literal(-1))),children:n.types.maybe(n.types.map(a)),attributes:n.types.map(n.types.array(n.types.string))}).views((function(e){return{get length(){return e.max-e.min},get featureId(){return e.attributes.get("id")},get minWithChildren(){var t=e.min,n=e.children;if(!n)return t;var r,a=ve(n);try{for(a.s();!(r=a.n()).done;){var o=ue(r.value,2);t=Math.min(t,o[1].min)}}catch(e){a.e(e)}finally{a.f()}return t},get maxWithChildren(){var t=e.max,n=e.children;if(!n)return t;var r,a=ve(n);try{for(a.s();!(r=a.n()).done;){var o=ue(r.value,2);t=Math.max(t,o[1].max)}}catch(e){a.e(e)}finally{a.f()}return t},hasDescendant:function(t){var n=e.children;if(!n)return!1;var r,a=ve(n);try{for(a.s();!(r=a.n()).done;){var o=ue(r.value,2);if(o[0]===t)return!0;if(o[1].hasDescendant(t))return!0}}catch(e){a.e(e)}finally{a.f()}return!1},get transcriptExonParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent, cannot calculate exon locations");var r=e.children;if(!r)throw new Error("No exons in transcript");var a,o=fe(r.values()).filter((function(e){return n.isTypeOf(e.type,"exon")})).sort((function(e,t){return e.min-t.min})),i=e.min,s=[],l=ve(o);try{for(l.s();!(a=l.n()).done;){var c=a.value;c.min>i&&s.push({min:i,max:c.min,type:"intron"}),s.push({min:c.min,max:c.max,type:"exon"}),i=c.max}}catch(e){l.e(e)}finally{l.f()}return i<e.max&&s.push({min:i,max:e.max,type:"intron"}),-1===e.strand&&s.reverse(),s},get transcriptParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error('Only features of type "transcript" or equivalent can calculate CDS locations');var r=e.children;if(!r)throw new Error("no CDS or exons in transcript");var a=fe(r.values()).filter((function(e){return n.isTypeOf(e.type,"CDS")})),o=[];if(0===a.length)return o.push(this.transcriptExonParts),o;var i,s=ve(a);try{var l=function(){var a,s=i.value,l=s.max,c=s.min,u=[],d=!1,f=[],p=ve(r);try{for(p.s();!(a=p.n()).done;){var h=ue(a.value,2)[1];n.isTypeOf(h.type,"exon")&&f.push({min:h.min,max:h.max})}}catch(e){p.e(e)}finally{p.f()}f.sort((function(e,t){return e.min-t.min}));for(var m=0,g=f;m<g.length;m++){var y=g[m],v=u.at(-1);v&&u.push({min:v.max,max:y.min,type:"intron"});var b,_=ue((0,t.intersection2)(c,l,y.min,y.max),2),w=_[0],x=_[1];b=d?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==w&&void 0!==x?(d=!0,w===y.min&&x===y.max?u.push({min:w,max:x,phase:0,type:"CDS"}):w===y.min?u.push({min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:b}):x===y.max?u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"}):u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:"fivePrimeUTR"===b?"threePrimeUTR":"fivePrimeUTR"})):u.push({min:y.min,max:y.max,type:b})}u.sort((function(e,t){return e.min-t.min})),-1===e.strand&&u.reverse();var S=0,E=u.map((function(e){if("CDS"!==e.type)return e;var t=S;return S=(3-(e.max-e.min-t+3)%3)%3,$($({},e),{},{phase:t})}));o.push(E)};for(s.s();!(i=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}return o}}})).views((function(e){return{get cdsLocations(){return e.transcriptParts.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))},get looksLikeGene(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n)return!1;var r=e.children;if(null==r||!r.size)return!1;if(!n.isTypeOf(e.type,"gene")&&!n.isTypeOf(e.type,"pseudogene"))return!1;var a,o=ve(r);try{for(o.s();!(a=o.n()).done;){var i=ue(a.value,2)[1];if(n.isTypeOf(i.type,"transcript")||n.isTypeOf(i.type,"pseudogenic_transcript")){var s=i.children;return!(null==s||!s.size)&&fe(s.values()).some((function(e){return n.isTypeOf(e.type,"exon")}))}}}catch(e){o.e(e)}finally{o.f()}return!1}}})).actions((function(e){return{setAttributes:function(t){e.attributes.clear();var n,r=ve(t.entries());try{for(r.s();!(n=r.n()).done;){var a=ue(n.value,2);e.attributes.set(a[0],a[1])}}catch(e){r.e(e)}finally{r.f()}},setAttribute:function(t,n){e.attributes.merge(Q({},t,n))},setType:function(t){e.type=t},setRefSeq:function(t){e.refSeq=t},setMin:function(t){if(t>e.max)throw new Error('Min "'.concat(t+1,'" is greater than max "').concat(e.max,'"'));e.min!==t&&(e.min=t)},setMax:function(t){if(t<e.min)throw new Error('Max "'.concat(t,'" is less than Min "').concat(e.min,'"'));e.max!==t&&(e.max=t)},setStrand:function(t){e.strand=t},addChild:function(t){if(e.children&&e.children.size>0){var r=(0,n.getSnapshot)(e.children);e.children.clear();var a,o=ve(Object.entries($($({},r),{},Q({},t._id,t))).sort((function(e,t){var n=ue(e,2)[1],r=ue(t,2);return n.min-r[1].min})));try{for(o.s();!(a=o.n()).done;){var i=ue(a.value,2);e.children.put(i[1])}}catch(e){o.e(e)}finally{o.f()}}else{var s;e.children=(0,n.cast)({}),null===(s=e.children)||void 0===s||s.put(t)}},deleteChild:function(t){var n;null===(n=e.children)||void 0===n||n.delete(t)}}})).actions((function(e){return{update:function(t){var r=t.children,a=t.max,o=t.min,i=t.strand;e.setRefSeq(t.refSeq),e.setMin(o),e.setMax(a),e.setStrand(i),r&&(e.children=(0,n.cast)(r))}}})).views((function(t){return{get parent(){var r;try{r=(0,n.getParentOfType)(t,e.AnnotationFeatureModel)}catch(e){}return r},get topLevelFeature(){var r,a=t;do{try{a=r=(0,n.getParentOfType)(a,e.AnnotationFeatureModel)}catch(e){r=void 0}}while(r);return a},get assemblyId(){return(0,n.getParentOfType)(t,r.ApolloAssembly)._id}}}))}(lI);var cI={},uI={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ApolloRefSeq=e.Sequence=void 0;var t=A.default,n=O.default,r=lI;e.Sequence=n.types.model({start:n.types.number,stop:n.types.number,sequence:n.types.string}),e.ApolloRefSeq=n.types.model("ApolloRefSeq",{_id:n.types.identifier,name:n.types.string,description:"",features:n.types.map(r.AnnotationFeatureModel),sequence:n.types.array(e.Sequence)}).actions((function(e){return{addFeature:function(t){e.features.put(t)},deleteFeature:function(t){return e.features.delete(t)},setDescription:function(t){e.description=t},addSequence:function(t){var n;if(t.sequence.length!==t.stop-t.start)throw new Error("sequence does not match declared length: ".concat(JSON.stringify(t)));if(0!==e.sequence.length){var r=e.sequence.map((function(e){return{start:e.start,stop:e.stop,sequence:e.sequence}}));r.push({start:t.start,stop:t.stop,sequence:t.sequence}),r.sort((function(e,t){return e.start===t.start?e.stop-t.stop:e.start-t.start}));var a,o=r.reduce((function(e,t){var n=e.at(-1);if(void 0===n)return[t];if(n.stop>=t.start){if(t.stop>n.stop){var r=n.stop-t.start;n.stop=t.stop,n.sequence+=t.sequence.slice(r)}}else e.push(t);return e}),[]),i=ve(o);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.sequence.length!==s.stop-s.start)throw new Error("Consolidated sequence does not match declared length")}}catch(e){i.e(e)}finally{i.f()}e.sequence.length===o.length&&e.sequence.every((function(e,t){return e.start===o[t].start&&e.stop===o[t].stop}))||(e.sequence.clear(),(n=e.sequence).push.apply(n,fe(o)))}else e.sequence.push(t)}}})).views((function(e){return{getSequence:function(n,r){var a,o=ve(e.sequence);try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.sequence,l=i.start;if((0,t.isContainedWithin)(n,r,l,i.stop))return s.slice(n-l,r-l)}}catch(e){o.e(e)}finally{o.f()}return""},getFeatures:function(n,r){var a,o=[],i=ve(e.features);try{for(i.s();!(a=i.n()).done;){var s=ue(a.value,2)[1];(0,t.doesIntersect2)(s.min,s.max,n,r)&&o.push(s)}}catch(e){i.e(e)}finally{i.f()}return o}}}))}(uI),Object.defineProperty(cI,"__esModule",{value:!0}),cI.ApolloAssembly=void 0;var dI=O.default;cI.ApolloAssembly=dI.types.model("ApolloAssembly",{_id:dI.types.identifier,refSeqs:dI.types.map(uI.ApolloRefSeq),comments:dI.types.array(dI.types.string),backendDriverType:dI.types.optional(dI.types.enumeration("backendDriverType",["CollaborationServerDriver","InMemoryFileDriver","DesktopFileDriver"]),"CollaborationServerDriver")}).views((function(e){return{getByRefName:function(t){return fe(e.refSeqs.values()).find((function(e){return e.name===t}))}}})).actions((function(e){return{addRefSeq:function(t,n,r){return e.refSeqs.put({_id:t,name:n,description:r})},addComment:function(t){return e.comments.push(t)}}}));var fI={};Object.defineProperty(fI,"__esModule",{value:!0}),fI.CheckResult=void 0;var pI=O.default;fI.CheckResult=pI.types.model("CheckResult",{_id:pI.types.identifier,name:pI.types.string,cause:pI.types.string,ids:pI.types.array(pI.types.safeReference(lI.AnnotationFeatureModel)),refSeq:pI.types.string,start:pI.types.number,end:pI.types.number,ignored:!1,message:pI.types.string}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ze;t.__exportStar(lI,e),t.__exportStar(cI,e),t.__exportStar(uI,e),t.__exportStar(fI,e)}(sI);const hI=r.types.model("ApolloFeatureDetailsWidget",{id:m.ElementId,type:r.types.literal("ApolloFeatureDetailsWidget"),feature:r.types.maybe(r.types.reference(sI.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:r.types.string,refName:r.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}}))),mI=r.types.model("ApolloTranscriptDetails",{id:m.ElementId,type:r.types.literal("ApolloTranscriptDetails"),feature:r.types.maybe(r.types.reference(sI.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:r.types.string,refName:r.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}})));function gI(){return gI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},gI.apply(this,arguments)}function yI(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var vI=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,bI=yI((function(e){return vI.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),_I=function(){function e(e){var t=this;this._insertTag=function(e){t.container.insertBefore(e,0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling),t.tags.push(e)},this.isSpeedy=void 0===e.speedy?"production"===Dt.env.NODE_ENV:e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if("production"!==Dt.env.NODE_ENV){var n=64===e.charCodeAt(0)&&105===e.charCodeAt(1);n&&this._alreadyInsertedOrderInsensitiveRule&&console.error("You're attempting to insert the following rule:\n"+e+"\n\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules."),this._alreadyInsertedOrderInsensitiveRule=this._alreadyInsertedOrderInsensitiveRule||!n}if(this.isSpeedy){var r=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{r.insertRule(e,r.cssRules.length)}catch(t){"production"===Dt.env.NODE_ENV||/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(e)||console.error('There was a problem inserting the following rule: "'+e+'"',t)}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0,"production"!==Dt.env.NODE_ENV&&(this._alreadyInsertedOrderInsensitiveRule=!1)},e}(),wI="-ms-",xI="-moz-",SI="-webkit-",EI="comm",kI="rule",CI="decl",AI="@keyframes",OI=Math.abs,TI=String.fromCharCode,NI=Object.assign;function II(e){return e.trim()}function RI(e,t,n){return e.replace(t,n)}function FI(e,t){return e.indexOf(t)}function PI(e,t){return 0|e.charCodeAt(t)}function MI(e,t,n){return e.slice(t,n)}function DI(e){return e.length}function jI(e){return e.length}function LI(e,t){return t.push(e),e}var qI=1,BI=1,UI=0,zI=0,GI=0,HI="";function $I(e,t,n,r,a,o,i){return{value:e,root:t,parent:n,type:r,props:a,children:o,line:qI,column:BI,length:i,return:""}}function VI(e,t){return NI($I("",null,null,"",null,null,0),e,{length:-e.length},t)}function WI(){return GI=zI>0?PI(HI,--zI):0,BI--,10===GI&&(BI=1,qI--),GI}function JI(){return GI=zI<UI?PI(HI,zI++):0,BI++,10===GI&&(BI=1,qI++),GI}function YI(){return PI(HI,zI)}function KI(){return zI}function ZI(e,t){return MI(HI,e,t)}function XI(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function QI(e){return qI=BI=1,UI=DI(HI=e),zI=0,[]}function eR(e){return HI="",e}function tR(e){return II(ZI(zI-1,aR(91===e?e+2:40===e?e+1:e)))}function nR(e){for(;(GI=YI())&&GI<33;)JI();return XI(e)>2||XI(GI)>3?"":" "}function rR(e,t){for(;--t&&JI()&&!(GI<48||GI>102||GI>57&&GI<65||GI>70&&GI<97););return ZI(e,KI()+(t<6&&32==YI()&&32==JI()))}function aR(e){for(;JI();)switch(GI){case e:return zI;case 34:case 39:34!==e&&39!==e&&aR(GI);break;case 40:41===e&&aR(e);break;case 92:JI()}return zI}function oR(e,t){for(;JI()&&e+GI!==57&&(e+GI!==84||47!==YI()););return"/*"+ZI(t,zI-1)+"*"+TI(47===e?e:JI())}function iR(e){for(;!XI(YI());)JI();return ZI(e,zI)}function sR(e){return eR(lR("",null,null,null,[""],e=QI(e),0,[0],e))}function lR(e,t,n,r,a,o,i,s,l){for(var c=0,u=0,d=i,f=0,p=0,h=0,m=1,g=1,y=1,v=0,b="",_=a,w=o,x=r,S=b;g;)switch(h=v,v=JI()){case 40:if(108!=h&&58==PI(S,d-1)){-1!=FI(S+=RI(tR(v),"&","&\f"),"&\f")&&(y=-1);break}case 34:case 39:case 91:S+=tR(v);break;case 9:case 10:case 13:case 32:S+=nR(h);break;case 92:S+=rR(KI()-1,7);continue;case 47:switch(YI()){case 42:case 47:LI(uR(oR(JI(),KI()),t,n),l);break;default:S+="/"}break;case 123*m:s[c++]=DI(S)*y;case 125*m:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:-1==y&&(S=RI(S,/\f/g,"")),p>0&&DI(S)-d&&LI(p>32?dR(S+";",r,n,d-1):dR(RI(S," ","")+";",r,n,d-2),l);break;case 59:S+=";";default:if(LI(x=cR(S,t,n,c,u,a,s,b,_=[],w=[],d),o),123===v)if(0===u)lR(S,t,x,x,_,o,d,s,w);else switch(99===f&&110===PI(S,3)?100:f){case 100:case 108:case 109:case 115:lR(e,x,x,r&&LI(cR(e,x,x,0,0,a,s,b,a,_=[],d),w),a,w,d,s,r?_:w);break;default:lR(S,x,x,x,[""],w,0,s,w)}}c=u=p=0,m=y=1,b=S="",d=i;break;case 58:d=1+DI(S),p=h;default:if(m<1)if(123==v)--m;else if(125==v&&0==m++&&125==WI())continue;switch(S+=TI(v),v*m){case 38:y=u>0?1:(S+="\f",-1);break;case 44:s[c++]=(DI(S)-1)*y,y=1;break;case 64:45===YI()&&(S+=tR(JI())),f=YI(),u=d=DI(b=S+=iR(KI())),v++;break;case 45:45===h&&2==DI(S)&&(m=0)}}return o}function cR(e,t,n,r,a,o,i,s,l,c,u){for(var d=a-1,f=0===a?o:[""],p=jI(f),h=0,m=0,g=0;h<r;++h)for(var y=0,v=MI(e,d+1,d=OI(m=i[h])),b=e;y<p;++y)(b=II(m>0?f[y]+" "+v:RI(v,/&\f/g,f[y])))&&(l[g++]=b);return $I(e,t,n,0===a?kI:s,l,c,u)}function uR(e,t,n){return $I(e,t,n,EI,TI(GI),MI(e,2,-2),0)}function dR(e,t,n,r){return $I(e,t,n,CI,MI(e,0,r),MI(e,r+1,-1),r)}function fR(e,t){for(var n="",r=jI(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function pR(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case CI:return e.return=e.return||e.value;case EI:return"";case AI:return e.return=e.value+"{"+fR(e.children,r)+"}";case kI:e.value=e.props.join(",")}return DI(n=fR(e.children,r))?e.return=e.value+"{"+n+"}":""}var hR=function(e,t,n){for(var r=0,a=0;r=a,a=YI(),38===r&&12===a&&(t[n]=1),!XI(a);)JI();return ZI(e,zI)},mR=new WeakMap,gR=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||mR.get(n))&&!r){mR.set(e,!0);for(var a=[],o=function(e,t){return eR(function(e,t){var n=-1,r=44;do{switch(XI(r)){case 0:38===r&&12===YI()&&(t[n]=1),e[n]+=hR(zI-1,t,n);break;case 2:e[n]+=tR(r);break;case 4:if(44===r){e[++n]=58===YI()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=TI(r)}}while(r=JI());return e}(QI(e),t))}(t,a),i=n.props,s=0,l=0;s<o.length;s++)for(var c=0;c<i.length;c++,l++)e.props[l]=a[s]?o[s].replace(/&\f/g,i[c]):i[c]+" "+o[s]}}},yR=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},vR=function(e){return"comm"===e.type&&e.children.indexOf("emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason")>-1},bR=function(e){return 105===e.type.charCodeAt(1)&&64===e.type.charCodeAt(0)},_R=function(e){e.type="",e.value="",e.return="",e.children="",e.props=""},wR=function(e,t,n){bR(e)&&(e.parent?(console.error("`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles."),_R(e)):function(e,t){for(var n=e-1;n>=0;n--)if(!bR(t[n]))return!0;return!1}(t,n)&&(console.error("`@import` rules can't be after other rules. Please put your `@import` rules before your other rules."),_R(e)))};function xR(e,t){switch(function(e,t){return 45^PI(e,0)?(((t<<2^PI(e,0))<<2^PI(e,1))<<2^PI(e,2))<<2^PI(e,3):0}(e,t)){case 5103:return SI+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return SI+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return SI+e+xI+e+wI+e+e;case 6828:case 4268:return SI+e+wI+e+e;case 6165:return SI+e+wI+"flex-"+e+e;case 5187:return SI+e+RI(e,/(\w+).+(:[^]+)/,SI+"box-$1$2"+wI+"flex-$1$2")+e;case 5443:return SI+e+wI+"flex-item-"+RI(e,/flex-|-self/,"")+e;case 4675:return SI+e+wI+"flex-line-pack"+RI(e,/align-content|flex-|-self/,"")+e;case 5548:return SI+e+wI+RI(e,"shrink","negative")+e;case 5292:return SI+e+wI+RI(e,"basis","preferred-size")+e;case 6060:return SI+"box-"+RI(e,"-grow","")+SI+e+wI+RI(e,"grow","positive")+e;case 4554:return SI+RI(e,/([^-])(transform)/g,"$1"+SI+"$2")+e;case 6187:return RI(RI(RI(e,/(zoom-|grab)/,SI+"$1"),/(image-set)/,SI+"$1"),e,"")+e;case 5495:case 3959:return RI(e,/(image-set\([^]*)/,SI+"$1$`$1");case 4968:return RI(RI(e,/(.+:)(flex-)?(.*)/,SI+"box-pack:$3"+wI+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+SI+e+e;case 4095:case 3583:case 4068:case 2532:return RI(e,/(.+)-inline(.+)/,SI+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(DI(e)-1-t>6)switch(PI(e,t+1)){case 109:if(45!==PI(e,t+4))break;case 102:return RI(e,/(.+:)(.+)-([^]+)/,"$1"+SI+"$2-$3$1"+xI+(108==PI(e,t+3)?"$3":"$2-$3"))+e;case 115:return~FI(e,"stretch")?xR(RI(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==PI(e,t+1))break;case 6444:switch(PI(e,DI(e)-3-(~FI(e,"!important")&&10))){case 107:return RI(e,":",":"+SI)+e;case 101:return RI(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+SI+(45===PI(e,14)?"inline-":"")+"box$3$1"+SI+"$2$3$1"+wI+"$2box$3")+e}break;case 5936:switch(PI(e,t+11)){case 114:return SI+e+wI+RI(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return SI+e+wI+RI(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return SI+e+wI+RI(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return SI+e+wI+e+e}return e}var SR=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case CI:e.return=xR(e.value,e.length);break;case AI:return fR([VI(e,{value:RI(e.value,"@","@"+SI)})],r);case kI:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=/(::plac\w+|:read-\w+)/.exec(e))?e[0]:e}(t)){case":read-only":case":read-write":return fR([VI(e,{props:[RI(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return fR([VI(e,{props:[RI(t,/:(plac\w+)/,":"+SI+"input-$1")]}),VI(e,{props:[RI(t,/:(plac\w+)/,":-moz-$1")]}),VI(e,{props:[RI(t,/:(plac\w+)/,wI+"input-$1")]})],r)}return""}))}}],ER=function(e){var t=e.key;if("production"!==Dt.env.NODE_ENV&&!t)throw new Error("You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\nIf multiple caches share the same key they might \"fight\" for each other's style elements.");if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||SR;if("production"!==Dt.env.NODE_ENV&&/[^a-z-]/.test(t))throw new Error('Emotion key must only contain lower case alphabetical characters and - but "'+t+'" was passed');var a,o,i={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)i[t[n]]=!0;s.push(e)}));var l=[gR,yR];"production"!==Dt.env.NODE_ENV&&l.push(function(e){return function(t,n,r){if("rule"===t.type&&!e.compat){var a=t.value.match(/(:first|:nth|:nth-last)-child/g);if(a){for(var o=t.parent?t.parent.children:r,i=o.length-1;i>=0;i--){var s=o[i];if(s.line<t.line)break;if(s.column<t.column){if(vR(s))return;break}}a.forEach((function(e){console.error('The pseudo class "'+e+'" is potentially unsafe when doing server-side rendering. Try changing it to "'+e.split("-child")[0]+'-of-type".')}))}}}}({get compat(){return p.compat}}),wR);var c,u,d=[pR,"production"!==Dt.env.NODE_ENV?function(e){e.root||(e.return?c.insert(e.return):e.value&&e.type!==EI&&c.insert(e.value+"{}"))}:(u=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],f=function(e){var t=jI(e);return function(n,r,a,o){for(var i="",s=0;s<t;s++)i+=e[s](n,r,a,o)||"";return i}}(l.concat(r,d));o=function(e,t,n,r){c=n,"production"!==Dt.env.NODE_ENV&&void 0!==t.map&&(c={insert:function(e){n.insert(e+t.map)}}),fR(sR(e?e+"{"+t.styles+"}":t.styles),f),r&&(p.inserted[t.name]=!0)};var p={key:t,sheet:new _I({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:i,registered:{},insert:o};return p.sheet.hydrate(s),p};function kR(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var CR=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},AR=function(e,t,n){CR(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}},OR={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},TR="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",NR=/[A-Z]|^ms/g,IR=/_EMO_([^_]+?)_([^]*?)_EMO_/g,RR=function(e){return 45===e.charCodeAt(1)},FR=function(e){return null!=e&&"boolean"!=typeof e},PR=yI((function(e){return RR(e)?e:e.replace(NR,"-$&").toLowerCase()})),MR=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(IR,(function(e,t,n){return $R={name:t,styles:n,next:$R},t}))}return 1===OR[e]||RR(e)||"number"!=typeof t||0===t?t:t+"px"};if("production"!==Dt.env.NODE_ENV){var DR=/(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\(|(no-)?(open|close)-quote/,jR=["normal","none","initial","inherit","unset"],LR=MR,qR=/^-ms-/,BR=/-(.)/g,UR={};MR=function(e,t){if("content"===e&&("string"!=typeof t||-1===jR.indexOf(t)&&!DR.test(t)&&(t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0))))throw new Error("You seem to be using a value for 'content' without quotes, try replacing it with `content: '\""+t+"\"'`");var n=LR(e,t);return""===n||RR(e)||-1===e.indexOf("-")||void 0!==UR[e]||(UR[e]=!0,console.error("Using kebab-case for css properties in objects is not supported. Did you mean "+e.replace(qR,"ms-").replace(BR,(function(e,t){return t.toUpperCase()}))+"?")),n}}var zR="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function GR(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles){if("production"!==Dt.env.NODE_ENV&&"NO_COMPONENT_SELECTOR"===n.toString())throw new Error(zR);return n}switch(W(n)){case"boolean":return"";case"object":if(1===n.anim)return $R={name:n.name,styles:n.styles,next:$R},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)$R={name:r.name,styles:r.styles,next:$R},r=r.next;var a=n.styles+";";return"production"!==Dt.env.NODE_ENV&&void 0!==n.map&&(a+=n.map),a}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=GR(e,t,n[a])+";";else for(var o in n){var i=n[o];if("object"!==W(i))null!=t&&void 0!==t[i]?r+=o+"{"+t[i]+"}":FR(i)&&(r+=PR(o)+":"+MR(o,i)+";");else{if("NO_COMPONENT_SELECTOR"===o&&"production"!==Dt.env.NODE_ENV)throw new Error(zR);if(!Array.isArray(i)||"string"!=typeof i[0]||null!=t&&void 0!==t[i[0]]){var s=GR(e,t,i);switch(o){case"animation":case"animationName":r+=PR(o)+":"+s+";";break;default:"production"!==Dt.env.NODE_ENV&&"undefined"===o&&console.error("You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key)."),r+=o+"{"+s+"}"}}else for(var l=0;l<i.length;l++)FR(i[l])&&(r+=PR(o)+":"+MR(o,i[l])+";")}}return r}(e,t,n);case"function":if(void 0!==e){var o=$R,i=n(e);return $R=o,GR(e,t,i)}"production"!==Dt.env.NODE_ENV&&console.error("Functions that are interpolated in css calls will be stringified.\nIf you want to have a css call based on props, create a function that returns a css call like this\nlet dynamicStyle = (props) => css`color: ${props.color}`\nIt can be called directly with props or interpolated in a styled call like this\nlet SomeComponent = styled('div')`${dynamicStyle}`");break;case"string":if("production"!==Dt.env.NODE_ENV){var s=[],l=n.replace(IR,(function(e,t,n){var r="animation"+s.length;return s.push("const "+r+" = keyframes`"+n.replace(/^@keyframes animation-\w+/,"")+"`"),"${"+r+"}"}));s.length&&console.error("`keyframes` output got interpolated into plain string, please wrap it with `css`.\n\nInstead of doing this:\n\n"+[].concat(s,["`"+l+"`"]).join("\n")+"\n\nYou should wrap it with `css` like this:\n\ncss`"+l+"`")}}if(null==t)return n;var c=t[n];return void 0!==c?c:n}var HR,$R,VR=/label:\s*([^\s;\n{]+)\s*(;|$)/g;"production"!==Dt.env.NODE_ENV&&(HR=/\/\*#\ssourceMappingURL=data:application\/json;\S+\s+\*\//g);var WR=function(e,t,n){if(1===e.length&&"object"===W(e[0])&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";$R=void 0;var o,i=e[0];null==i||void 0===i.raw?(r=!1,a+=GR(n,t,i)):("production"!==Dt.env.NODE_ENV&&void 0===i[0]&&console.error(TR),a+=i[0]);for(var s=1;s<e.length;s++)a+=GR(n,t,e[s]),r&&("production"!==Dt.env.NODE_ENV&&void 0===i[s]&&console.error(TR),a+=i[s]);"production"!==Dt.env.NODE_ENV&&(a=a.replace(HR,(function(e){return o=e,""}))),VR.lastIndex=0;for(var l,c="";null!==(l=VR.exec(a));)c+="-"+l[1];var u=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(a)+c;return"production"!==Dt.env.NODE_ENV?{name:u,styles:a,map:o,next:$R,toString:function(){return"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop)."}}:{name:u,styles:a,next:$R}},JR=!!N.useInsertionEffect&&N.useInsertionEffect||function(e){return e()},YR={}.hasOwnProperty,KR=N.createContext("undefined"!=typeof HTMLElement?ER({key:"css"}):null);"production"!==Dt.env.NODE_ENV&&(KR.displayName="EmotionCacheContext");var ZR=function(e){return u.forwardRef((function(t,n){var r=u.useContext(KR);return e(t,r,n)}))},XR=N.createContext({});"production"!==Dt.env.NODE_ENV&&(XR.displayName="EmotionThemeContext");var QR="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",eF="__EMOTION_LABEL_PLEASE_DO_NOT_USE__",tF=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return CR(t,n,r),JR((function(){return AR(t,n,r)})),null},nF=ZR((function(e,t,n){var r=e.css;"string"==typeof r&&void 0!==t.registered[r]&&(r=t.registered[r]);var a=e[QR],o=[r],i="";"string"==typeof e.className?i=kR(t.registered,o,e.className):null!=e.className&&(i=e.className+" ");var s=WR(o,void 0,N.useContext(XR));if("production"!==Dt.env.NODE_ENV&&-1===s.name.indexOf("-")){var l=e[eF];l&&(s=WR([s,"label:"+l+";"]))}i+=t.key+"-"+s.name;var c={};for(var u in e)!YR.call(e,u)||"css"===u||u===QR||"production"!==Dt.env.NODE_ENV&&u===eF||(c[u]=e[u]);return c.ref=n,c.className=i,N.createElement(N.Fragment,null,N.createElement(tF,{cache:t,serialized:s,isStringTag:"string"==typeof a}),N.createElement(a,c))}));"production"!==Dt.env.NODE_ENV&&(nF.displayName="EmotionCssPropInternal");var rF=bI,aF=function(e){return"theme"!==e},oF=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?rF:aF},iF=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!=typeof r&&n&&(r=e.__emotion_forwardProp),r},sF="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",lF=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return CR(t,n,r),JR((function(){return AR(t,n,r)})),null},cF=function e(t,n){if("production"!==Dt.env.NODE_ENV&&void 0===t)throw new Error("You are trying to create a styled element with an undefined component.\nYou may have forgotten to import it.");var r,a,o=t.__emotion_real===t,i=o&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var s=iF(t,n,o),l=s||oF(i),c=!l("as");return function(){var u=arguments,d=o&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&d.push("label:"+r+";"),null==u[0]||void 0===u[0].raw)d.push.apply(d,u);else{"production"!==Dt.env.NODE_ENV&&void 0===u[0][0]&&console.error(sF),d.push(u[0][0]);for(var f=u.length,p=1;p<f;p++)"production"!==Dt.env.NODE_ENV&&void 0===u[0][p]&&console.error(sF),d.push(u[p],u[0][p])}var h=ZR((function(e,t,n){var r=c&&e.as||i,o="",u=[],f=e;if(null==e.theme){for(var p in f={},e)f[p]=e[p];f.theme=N.useContext(XR)}"string"==typeof e.className?o=kR(t.registered,u,e.className):null!=e.className&&(o=e.className+" ");var h=WR(d.concat(u),t.registered,f);o+=t.key+"-"+h.name,void 0!==a&&(o+=" "+a);var m=c&&void 0===s?oF(r):l,g={};for(var y in e)c&&"as"===y||m(y)&&(g[y]=e[y]);return g.className=o,g.ref=n,N.createElement(N.Fragment,null,N.createElement(lF,{cache:t,serialized:h,isStringTag:"string"==typeof r}),N.createElement(r,g))}));return h.displayName=void 0!==r?r:"Styled("+("string"==typeof i?i:i.displayName||i.name||"Component")+")",h.defaultProps=t.defaultProps,h.__emotion_real=h,h.__emotion_base=i,h.__emotion_styles=d,h.__emotion_forwardProp=s,Object.defineProperty(h,"toString",{value:function(){return void 0===a&&"production"!==Dt.env.NODE_ENV?"NO_COMPONENT_SELECTOR":"."+a}}),h.withComponent=function(t,r){return e(t,gI({},n,r,{shouldForwardProp:iF(h,r,!0)})).apply(void 0,d)},h}}.bind();async function uF(e){if(isSecureContext){const t=new Blob([e.outerText],{type:"text/plain"}),n=new Blob([e.outerHTML],{type:"text/html"}),r=new ClipboardItem({[t.type]:t,[n.type]:n});return navigator.clipboard.write([r])}const t=t=>{t.clipboardData?.setData("text/plain",e.outerText),t.clipboardData?.setData("text/html",e.outerHTML),t.preventDefault()};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}function dF(e,t,r){const a=[],{cdsLocations:o,strand:i,transcriptParts:s}=t;switch(e){case"genomic":case"cDNA":{const[t]=s;for(const o of t){if("cDNA"===e&&"intron"===o.type)continue;let t=r(o.min,o.max);-1===i&&(t=n.revcom(t));const s="fivePrimeUTR"===o.type||"threePrimeUTR"===o.type?"UTR":o.type,l=a.at(-1);l&&l.type===s?(l.sequence+=t,l.locs.push({min:o.min,max:o.max})):a.push({type:s,sequence:t,locs:[{min:o.min,max:o.max}]})}return a}case"CDS":{let e="";const[t]=o,s=[];for(const a of t){let t=r(a.min,a.max);-1===i&&(t=n.revcom(t)),e+=t,s.push({min:a.min,max:a.max})}return a.push({type:"CDS",sequence:e,locs:s}),a}case"protein":{let e="";const[t]=o,s=[];for(const a of t){let t=r(a.min,a.max);-1===i&&(t=n.revcom(t)),e+=t,s.push({min:a.min,max:a.max})}let l="";for(let t=0;t<e.length;t+=3){const r=e.slice(t,t+3).toUpperCase();l+=n.defaultCodonTable[r]||"&"}return a.push({type:"protein",sequence:l,locs:s}),a}}}function fF(e){switch(e){case"upOrDownstream":return"rgb(255,255,255)";case"exon":case"UTR":return"rgb(194,106,119)";case"CDS":return"rgb(93,168,153)";case"intron":return"rgb(187,187,187)";case"protein":return"rgb(148,203,236)"}}function pF(e){const t=[],n=e.flatMap((e=>e.locs));let[r]=n;for(let e=1;e<n.length;e++)r.min===n[e].max||r.max===n[e].min?r={min:Math.min(r.min,n[e].min),max:Math.max(r.max,n[e].max)}:(t.push(r),r=n[e]);return t.push(r),t}["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){cF[e]=cF(e)}));const hF=h.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),o=a?.getByRefName(n),{featureTypeOntology:i}=r.apolloDataStore.ontologyManager,s="genomic",c=["genomic","cDNA"],[d,f]=u.useState(c),[p,h]=u.useState(s),[m,g]=u.useState((()=>o?dF(s,t,((e,t)=>o.getSequence(e,t))):[])),[y,v]=u.useState((()=>pF(m))),b=l.useTheme(),_=u.useRef(null);if(u.useEffect((()=>{const{cdsLocations:e}=t,[n]=e;f(n.length>0?[...c,"CDS","protein"]:c)}),[t]),!a||!o)return null;const w=a.getByRefName(n);if(!w)return null;if(!i)throw new Error("featureTypeOntology is undefined");return i.isTypeOf(t.type,"transcript")?T.default.createElement(T.default.Fragment,null,T.default.createElement(l.Select,{defaultValue:"genomic",value:p,onChange:function(e){const n=e.target.value;h(n);const r=o?dF(n,t,((e,t)=>o.getSequence(e,t))):[],a=pF(r);g(r),v(a)},size:"small","data-testid":"sequenceOptionSelector"},d.map((e=>T.default.createElement(l.MenuItem,{key:e,value:e,"data-testid":`sequenceOption-${e}`},e)))),T.default.createElement(l.Button,{variant:"contained",onClick:()=>{const e=_.current;e&&uF(e)},style:{marginLeft:10},size:"medium"},"Copy sequence"),T.default.createElement(l.Paper,{style:{fontFamily:"monospace",padding:b.spacing(),overflowX:"auto"},ref:_},">",w.name,":",y.map((e=>1===t.strand?`${e.min+1}-${e.max}`:`${e.max}-${e.min+1}`)).join(";"),"(strand=",1===t.strand?"+":"-",";length=",function(e){let t=0;for(const n of e)t+=n.sequence.length;return t}(m),")",T.default.createElement("br",null),function(e,t){const n=[];let r=0;for(const[t,a]of e.entries()){const e=r%60,o=r>0&&0===e?"\n":"";r+=a.sequence.length;const i=o+a.sequence.slice(0,60-e),s=[i,...Xn.splitStringIntoChunks(a.sequence.slice(i.length),60)],l=T.default.createElement("span",{key:`${a.type}-${t}`,style:{background:fF(a.type),color:b.palette.getContrastText(fF(a.type)),whiteSpace:"pre-line"}},s.join("\n"));n.push(l)}return n}(m))):null}));var mF=s.createSvgIcon(i.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),gF=s.createSvgIcon(i.jsx("path",{d:"M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2m0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2m6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5M19 3l-6 6 2 2 7-7V3z"}),"ContentCut"),yF=s.createSvgIcon(i.jsx("path",{d:"M19 13H5v-2h14z"}),"Remove");const vF=cF(eI)((()=>({"&.MuiFormControl-root":{marginTop:0,marginBottom:0,width:"100%"},"& .MuiInputBase-input":{fontSize:12,height:20,padding:1,paddingLeft:10}}))),bF=cF("div")({display:"flex",justifyContent:"center",alignItems:"center",textAlign:"left",width:"100%",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-all","& span":{fontSize:12}}),_F=e=>{const{strand:t}=e;return T.default.createElement("div",null,1===t?T.default.createElement(Uc,null):-1===t?T.default.createElement(yF,null):T.default.createElement(l.Typography,{component:"span"},"N/A"))},wF=h.observer((function({assembly:e,feature:t,refName:r,session:a}){const{notify:o}=a,i=a.apolloDataStore.assemblies.get(e),s=i?.getByRefName(r),{changeManager:c}=a.apolloDataStore,d=u.useRef(null),{changeInProgress:f}=a;if(!s)return null;const{apolloDataStore:p}=a,{featureTypeOntology:h}=p.ontologyManager;if(!h.isTypeOf(t.type,"transcript")&&!h.isTypeOf(t.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent");const{cdsLocations:m,transcriptExonParts:g,strand:y}=t,[v]=m,[b,_]=((e,t)=>{const{transcriptExonParts:n}=e,r=n.filter((e=>t.isTypeOf(e.type,"exon"))).sort((({min:e},{min:t})=>e-t)),a=r[0]?.min,o=r[r.length-1]?.max;return[a,o]})(t,h);let w=b,x=_;const S=v.length>0;if(S){const e=v.toSorted((({min:e},{min:t})=>e-t));w=e[0].min,x=e[e.length-1].max}const E=(t,n,r,a,i)=>{if(!r.children)throw new Error("Transcript should have child features");if(t===n)return!0;const s=O(r,h,t,a);if(!s)return o("No matching CDS feature found","error"),!1;if(a&&n>=s.max)return o("Start location should be less than CDS end location","error"),!1;if(!a&&n<=s.min)return o("End location should be greater than CDS start location","error"),!1;if(!F(r,h,n,a))return o("There should be an overlapping exon for the new CDS location","error"),!1;const l=a?new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[s._id],featureId:s._id,oldStart:s.min,newStart:n,assembly:e}):new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[s._id],featureId:s._id,oldEnd:s.max,newEnd:n,assembly:e});return c.submit(l).then((()=>{i&&i()})).catch((()=>{o("Error updating feature CDS position","error")})),!0};function k(t,n,r,a){if(!r.children)throw new Error("Transcript should have child features");const{matchingExon:i,prevExon:s,nextExon:l}=P(r,h,t,a);if(!i)return o("No matching exon found","error"),!1;if(a&&n>=i.max)return o("Start location should be less than end location","error"),!1;if(!a&&n<=i.min)return o("End location should be greater than start location","error"),!1;if(s&&s.max+2>n)return o("Error while changing start location","error"),!1;if(l&&l.min-2<n)return o("Error while changing end location","error"),!1;const u=I(r,i.min,i.max,h);if(!u)return o("No matching exon feature found","error"),!1;const d=N(r,h);if(a&&n!==i.min){const t=new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:e});if(s)A(u,t,n);else{const e=r.min,o=r.parent;if(n<e)o&&n<o.min&&A(o,t,n),A(r,t,n),A(u,t,n);else if(n>e&&(A(u,t,n),A(r,t,n),o)){const[e]=R(o,r,n,h,a);o.min!=e&&A(o,t,e)}}d&&d.min>=i.min&&d.min<=i.max&&n>d.min&&A(d,t,n),c.submit(t).catch((()=>{o("Error updating feature exon start position","error")}))}if(!a&&n!==i.max){const t=new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:e});if(l)C(u,t,n);else{const e=r.max,o=r.parent;if(n>e)o&&n>o.max&&C(o,t,n),C(r,t,n),C(u,t,n);else if(n<e&&(C(u,t,n),C(r,t,n),o)){const[,e]=R(o,r,n,h,a);o.max!=e&&C(o,t,e)}}d&&d.max>=i.min&&d.max<=i.max&&n<d.max&&C(d,t,n),c.submit(t).catch((()=>{o("Error updating feature exon end position","error")}))}return!0}const C=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldEnd:e.max,newEnd:n})},A=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldStart:e.min,newStart:n})},O=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(t.isTypeOf(o.type,"CDS")){if(r&&n===o.min){a=o;break}if(!r&&n===o.max){a=o;break}}return a},N=(e,t)=>{let n;for(const[,r]of e.children??[])if(t.isTypeOf(r.type,"CDS")){n=r;break}return n},I=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(r.isTypeOf(o.type,"exon")&&t===o.min&&n===o.max){a=o;break}return a},R=(e,t,n,r,a)=>{const o=[],i=[];for(const[,s]of e.children?.entries()??[])r.isTypeOf(s.type,"transcript")&&(s._id===t._id?a?(o.push(n),i.push(s.max)):(i.push(n),o.push(s.min)):(o.push(s.min),i.push(s.max)));return[Math.min(...o),Math.max(...i)]},F=(e,t,n,r)=>{const{transcriptExonParts:a}=e;let o;for(const[,e]of a.entries())if(t.isTypeOf(e.type,"exon")){if(!r&&n>=e.min&&n<=e.max){o=e;break}if(r&&n>=e.min&&n<=e.max){o=e;break}}return o},P=(e,t,n,r)=>{const{transcriptExonParts:a,strand:o}=e;let i,s,l,c;for(const[e,o]of a.entries())if(t.isTypeOf(o.type,"exon")){if(r&&o.min===n){i=o,s=e;break}if(!r&&o.max===n){i=o,s=e;break}}if(i&&void 0!==s){if(1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(-1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}if(-1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}}return{matchingExon:i,prevExon:l,nextExon:c}},M=()=>{let e="";const[r]=m,a=r.toSorted((({min:e},{min:t})=>e-t));for(const t of a)e+=s.getSequence(t.min,t.max);-1===y&&(e=n.revcom(e));const o=[];for(let r=0;r<e.length;r+=3){const a=e.slice(r,r+3).toUpperCase(),i=n.defaultCodonTable[a]||"&";"ATG"===a?o.push(T.default.createElement(l.Typography,{component:"span",style:{backgroundColor:f?"lightgray":"yellow",cursor:"pointer",border:"1px solid black"},key:r,onClick:()=>{if(f)return;const e=D(r);e!==w&&1===y&&E(w,e,t,!0),e!==x&&-1===y&&E(x,e,t,!1)}},i)):["TAA","TAG","TGA"].includes(a)?o.push(T.default.createElement(l.Typography,{style:{backgroundColor:"red",color:"white"},component:"span",key:r},i)):o.push(T.default.createElement(l.Typography,{component:"span",key:r},i))}return o},D=e=>{const[t]=m;let n=0;const r=t.toSorted((({min:e},{min:t})=>e-t));if(1===y)for(const t of r){const r=t.max-t.min;if(n+r>e)return t.min+(e-n);n+=r}else if(-1===y)for(let t=r.length-1;t>=0;t--){const a=r[t],o=a.max-a.min;if(n+o>e)return a.max-(e-n);n+=o}return 1===y?w:x};return T.default.createElement("div",null,S&&T.default.createElement("div",null,T.default.createElement(l.Accordion,null,T.default.createElement(kF,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},T.default.createElement(l.Typography,{component:"span",fontWeight:"bold"},"Translation")),T.default.createElement(l.AccordionDetails,null,T.default.createElement(bF,null,T.default.createElement(l.Typography,{component:"span",ref:d,style:{maxHeight:120,overflowY:"scroll"}},M())),T.default.createElement("div",{style:{marginTop:10,display:"flex",flexDirection:"row",alignItems:"center",gap:10}},T.default.createElement(l.Tooltip,{title:"Copy"},T.default.createElement("button",{onClick:()=>{const e=d.current;e&&uF(e)},style:{border:"none",background:"none",padding:0},disabled:f},T.default.createElement(mF,{style:{fontSize:15}}))),T.default.createElement(l.Tooltip,{title:"Trim"},T.default.createElement("button",{onClick:()=>{const e=M(),n=e.map((e=>e.props.children)).join("");if(n.startsWith("M")&&n.endsWith("*"))return;const r=[];for(const t of e)r.push({codonGenomicPos:t.key,sequenceLetter:t.props.children});if(0===r.length)return;const a=n.indexOf("M"),i=n.indexOf("*"),s=r[a].codonGenomicPos,l=r[i].codonGenomicPos;if(!s||!l)return;const c=D(s);let u=D(l);if(1===y){if(c>u)return void o("Start codon genomic location should be less than stop codon genomic location","error");let e;u+=3,c!==w&&(e=new Promise((e=>{E(w,c,t,!0,(()=>{e(!0)}))}))),u!==x&&(e?e.then((()=>{E(x,u,t,!1)})):E(x,u,t,!1))}if(-1===y){if(c<u)return void o("Start codon genomic location should be less than stop codon genomic location","error");let e;u-=3,c!==x&&(e=new Promise((e=>{E(x,c,t,!1,(()=>{e(!0)}))}))),u!==w&&(e?e.then((()=>{E(w,u,t,!0)})):E(w,u,t,!0))}o("Translation sequence trimmed to start and stop codons","success")},style:{border:"none",background:"none",padding:0},disabled:f},T.default.createElement(gF,{style:{fontSize:15}})))))),T.default.createElement(l.Grid,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center",marginTop:10}},T.default.createElement(l.Grid,{size:1}),T.default.createElement(l.Grid,{size:4},T.default.createElement(vF,1===y?{margin:"dense",variant:"outlined",value:w+1,onChangeCommitted:e=>E(w,e-1,t,!0),style:{border:"1px solid black",borderRadius:5},disabled:f}:{margin:"dense",variant:"outlined",value:x,onChangeCommitted:e=>E(x,e,t,!1),style:{border:"1px solid black",borderRadius:5},disabled:f})),T.default.createElement(l.Grid,{size:2},T.default.createElement(l.Typography,{component:"span"},"CDS")),T.default.createElement(l.Grid,{size:4},T.default.createElement(vF,1===y?{margin:"dense",variant:"outlined",value:x,onChangeCommitted:e=>E(x,e,t,!1),style:{border:"1px solid black",borderRadius:5},disabled:f}:{margin:"dense",variant:"outlined",value:w+1,onChangeCommitted:e=>E(w,e-1,t,!0),style:{border:"1px solid black",borderRadius:5},disabled:f})),T.default.createElement(l.Grid,{size:1}))),T.default.createElement("div",{style:{marginTop:5}},g.map(((e,r)=>T.default.createElement("div",{key:r},"exon"===e.type&&T.default.createElement(l.Grid,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center"}},T.default.createElement(l.Grid,{size:1},0!==r&&((e,t)=>{let r="";if(t>0){const a=g[t-1];1===y?"intron"===a.type&&(r=s.getSequence(e.min-2,e.min)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.max,e.max+2)))}return r=r.toUpperCase(),[{spliceSite:r,color:"AG"===r?"green":"red"}]})(e,r).map(((e,t)=>T.default.createElement(l.Typography,{key:t,component:"span",color:e.color},e.spliceSite)))),T.default.createElement(l.Grid,{size:4,style:{padding:0}},T.default.createElement(vF,1===y?{margin:"dense",variant:"outlined",value:e.min+1,onChangeCommitted:n=>k(e.min,n-1,t,!0),disabled:f}:{margin:"dense",variant:"outlined",value:e.max,onChangeCommitted:n=>k(e.max,n,t,!1),disabled:f})),T.default.createElement(l.Grid,{size:2},T.default.createElement(_F,{strand:t.strand})),T.default.createElement(l.Grid,{size:4,style:{padding:0}},T.default.createElement(vF,1===y?{margin:"dense",variant:"outlined",value:e.max,onChangeCommitted:n=>k(e.max,n,t,!1),disabled:f}:{margin:"dense",variant:"outlined",value:e.min+1,onChangeCommitted:n=>k(e.min,n-1,t,!0),disabled:f})),T.default.createElement(l.Grid,{size:1},r!==g.length-1&&((e,t)=>{let r="";if(t<g.length-1){const a=g[t+1];1===y?"intron"===a.type&&(r=s.getSequence(e.max,e.max+2)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.min-2,e.min)))}return r=r.toUpperCase(),[{spliceSite:r,color:"GT"===r?"green":"red"}]})(e,r).map(((e,t)=>T.default.createElement(l.Typography,{key:t,component:"span",color:e.color},e.spliceSite))))))))))})),xF=cF(l.TableCell)((()=>({fontWeight:"bold"}))),SF=h.observer((function(e){const{feature:t}=e,n=Jd(t),r=Yd(t);return T.default.createElement(l.Table,{size:"small",sx:{fontSize:"0.75rem","& .MuiTableCell-root":{padding:"4px"}}},T.default.createElement(l.TableBody,null,""!==n&&T.default.createElement(l.TableRow,null,T.default.createElement(xF,null,"Name"),T.default.createElement(l.TableCell,null,Jd(t))),""!==r&&T.default.createElement(l.TableRow,null,T.default.createElement(xF,null,"ID"),T.default.createElement(l.TableCell,null,Yd(t))),T.default.createElement(l.TableRow,null,T.default.createElement(xF,null,"Type"),T.default.createElement(l.TableCell,null,t.type)),T.default.createElement(l.TableRow,null,T.default.createElement(xF,null,"Location"),T.default.createElement(l.TableCell,null,e.refName,":",t.min,"..",t.max)),T.default.createElement(l.TableRow,null,T.default.createElement(xF,null,"Strand"),T.default.createElement(l.TableCell,null,1===(a=t.strand)?"Forward":-1===a?"Reverse":""))));var a})),EF=d.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),kF=cF(l.AccordionSummary)((()=>({minHeight:30,maxHeight:30,"&.Mui-expanded":{minHeight:30,maxHeight:30}})));function CF(e){return null}const AF=h.observer((function(e){const{classes:t}=EF(),a=["summary","location"],[o,i]=u.useState(a),{model:s}=e,{assembly:c,feature:d,refName:f}=s;u.useEffect((()=>{i(a)}),[d]);const p=n.getSession(s),{pluginManager:h}=n.getEnv(p),m=n.getSession(s),g=m.apolloDataStore.assemblies.get(c),{internetAccounts:y}=r.getRoot(p),v=y.find((e=>"ApolloInternetAccount"===e.type)),b=["admin","user"].includes((v?v.role:"admin")??"");if(!d||!g)return null;const _=g.getByRefName(f);if(!_)return null;const{max:w,min:x}=d;function S(e,t){i(e?[...o,t]:o.filter((e=>e!==t)))}_.getSequence(x,w)||m.apolloDataStore.loadRefSeq([{assemblyName:c,refName:f,start:x,end:w}]);const E=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-InsideSummary",CF,{feature:d,session:p}),k=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-AfterSummary",CF,{feature:d,session:p}),C=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-InsideLocation",CF,{feature:d,session:p}),A=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-AfterLocation",CF,{feature:d,session:p}),O=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-InsideAttributes",CF,{feature:d,session:p}),N=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-AfterAttributes",CF,{feature:d,session:p}),I=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-InsideSequence",CF,{feature:d,session:p}),R=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent-AfterSequence",CF,{feature:d,session:p});return T.default.createElement("div",{className:t.root},T.default.createElement(l.Accordion,{expanded:o.includes("summary"),onChange:(e,t)=>{S(t,"summary")}},T.default.createElement(kF,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},T.default.createElement(l.Typography,{component:"span",fontWeight:"bold"},"Summary")),T.default.createElement(l.AccordionDetails,null,T.default.createElement(SF,{feature:d,refName:f}),T.default.createElement(E,{session:p,feature:d}))),T.default.createElement(k,{session:p,feature:d}),T.default.createElement(l.Accordion,{style:{marginTop:5},expanded:o.includes("location"),onChange:(e,t)=>{S(t,"location")}},T.default.createElement(kF,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},T.default.createElement(l.Typography,{component:"span",fontWeight:"bold"},"Location")),T.default.createElement(l.AccordionDetails,null,T.default.createElement(wF,{feature:d,refName:f,session:m,assembly:g._id||""}),T.default.createElement(C,{session:p,feature:d}))),T.default.createElement(A,{session:p,feature:d}),T.default.createElement(l.Accordion,{style:{marginTop:5},expanded:o.includes("attrs"),onChange:(e,t)=>{S(t,"attrs")}},T.default.createElement(kF,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},T.default.createElement("div",{style:{display:"flex",alignItems:"center"}},T.default.createElement(l.Typography,{component:"span",fontWeight:"bold"},"Attributes"," "),T.default.createElement(l.Tooltip,{title:"Separate multiple values for the attribute with commas"},T.default.createElement(yd,{style:{color:"white",fontSize:15,marginLeft:10}})))),T.default.createElement(l.AccordionDetails,null,T.default.createElement(QN,{feature:d,session:m,assembly:g._id||"",editable:b}),T.default.createElement(O,{session:p,feature:d}))),T.default.createElement(N,{session:p,feature:d}),T.default.createElement(l.Accordion,{style:{marginTop:5},expanded:o.includes("sequence"),onChange:(e,t)=>{S(t,"sequence")}},T.default.createElement(kF,{expandIcon:T.default.createElement(BN,{style:{color:"white"}}),"aria-controls":"panel4-content",id:"panel4-header"},T.default.createElement(l.Typography,{component:"span",fontWeight:"bold"},"Sequence")),T.default.createElement(l.AccordionDetails,null,o.includes("sequence")&&T.default.createElement(hF,{feature:d,session:m,assembly:g._id||"",refName:f}),T.default.createElement(I,{session:p,feature:d}))),T.default.createElement(R,{feature:d,session:p}))})),OF=a.ConfigurationSchema("LinearApolloDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),TF=d.makeStyles()({highlighted:{background:"orange"}}),NF=({highlight:e,text:t})=>{const{classes:n}=TF();if(!e)return T.default.createElement(T.default.Fragment,null,t);const r=t.split(e);if(1===r.length)return T.default.createElement(T.default.Fragment,null,t);const a=[];for(let t=0;t<r.length-1;t++)a.push(r[t],T.default.createElement("span",{className:n.highlighted},e));return T.default.createElement(T.default.Fragment,null,a,r.at(-1))},IF=h.observer((function({feature:e,filterText:t}){const n=[...e.attributes.entries()].map((([e,t])=>{if(e.startsWith("gff_")){const n=e.slice(4);return[n.charAt(0).toUpperCase()+n.slice(1),r.getSnapshot(t)]}return"_id"===e?["ID",r.getSnapshot(t)]:[e,r.getSnapshot(t)]})).filter((([e])=>e)).map((([e,t])=>`${e}=${Array.isArray(t)?t.join(", "):t}`)).join(", ");return T.default.createElement(NF,{text:n,highlight:t})})),RF=d.makeStyles()((e=>({inputWrapper:{position:"relative"},hiddenWidthSpan:{padding:e.spacing(.5),color:"transparent"},numberTextInput:{border:"none",background:"inherit",font:"inherit",position:"absolute",width:"100%",left:0}}))),FF=h.observer((function({initialValue:e,notifyError:t,onChangeCommitted:n}){const[r,a]=u.useState(e),[o,i]=u.useState(!1),[s,l]=u.useState(null),{classes:c}=RF();return u.useEffect((()=>{e!==r&&a(e)}),[e]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),T.default.createElement("span",{className:c.inputWrapper},T.default.createElement("span",{className:c.hiddenWidthSpan,"aria-hidden":!0},r),T.default.createElement("input",{type:"text",value:r,className:c.numberTextInput,onChange:function(e){const t=Number(e.target.value);Number.isNaN(t)||a(t)},onKeyDown:t=>{"Enter"===t.key?s?.blur():"Escape"===t.key&&(a(e),i(!0))},onBlur:()=>{r!==e&&n(r).catch(t)},ref:e=>{l(e)}}))})),PF=d.makeStyles()((e=>({typeContent:{display:"inline-block",width:"174px",height:"100%",cursor:"text"},feature:{td:{position:"relative",verticalAlign:"top",paddingLeft:"0.5em"}},arrow:{display:"inline-block",width:"1.6em",textAlign:"center",cursor:"pointer"},arrowExpanded:{transform:"rotate(90deg)"},hoveredFeature:{backgroundColor:e.palette.action.hover},typeInputElement:{border:"none",background:"none"},typeErrorMessage:{color:"red"}})));function MF(e,t){const{changeManager:a,getAssemblyId:o,regions:i,selectedFeature:s,session:l,setSelectedFeature:c,filteredTranscripts:u,updateFilteredTranscripts:d}=e;return function(e,t,a,o,i,s,l,c,u){const d=function(e){const{internetAccounts:t}=r.getParent(e);return t.find((e=>"ApolloInternetAccount"===e.type))}(s),f=d?d.role:"admin",p="admin"===f,h=!(f&&["admin","user"].includes(f)),m=[];if(e){const r=e.attributes.get("gff_id")?.toString(),f=a(t.assemblyName),g=a(t.assemblyName);m.push({label:"Edit feature details",onClick:()=>{const n=s.addWidget("ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget",{feature:e,assembly:g,refName:t.refName});s.showWidget(n)}},{label:"Add child feature",disabled:h,onClick:()=>{s.queueDialog((t=>[FT,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:f,internetAccount:d}]))}},{label:"Copy features and annotations",disabled:h,onClick:()=>{s.queueDialog((t=>[GT,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:g}]))}},{label:"Delete feature",disabled:!p,onClick:()=>{s.queueDialog((t=>[$T,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:g,selectedFeature:o,setSelectedFeature:i}]))}},{label:"Merge transcripts",disabled:!p,onClick:()=>{s.queueDialog((t=>[tN,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:g,selectedFeature:o,setSelectedFeature:i}]))}},{label:"Merge exons",disabled:!p,onClick:()=>{s.queueDialog((t=>[QT,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:g,selectedFeature:o,setSelectedFeature:i}]))}},{label:"Split exon",disabled:!p,onClick:()=>{s.queueDialog((t=>[dN,{session:s,handleClose:()=>{t()},changeManager:l,sourceFeature:e,sourceAssemblyId:g,selectedFeature:o,setSelectedFeature:i}]))}});const{featureTypeOntology:y}=s.apolloDataStore.ontologyManager;if(!y)throw new Error("featureTypeOntology is undefined");(y.isTypeOf(e.type,"transcript")||y.isTypeOf(e.type,"pseudogenic_transcript"))&&n.isSessionModelWithWidgets(s)&&m.push({label:"Edit transcript details",onClick:()=>{const n=s.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:e,assembly:g,changeManager:l,refName:t.refName});s.showWidget(n)}},{label:"Visible",type:"checkbox",checked:!r||!c.includes(r),onClick:()=>{if(r){const e=c.includes(r)?c.filter((e=>e!==r)):[...c,r];u(e)}}})}return m}(t,i[0],o,s,c,l,a,u,d)}const DF=h.observer((function e({depth:t,feature:n,isHovered:r,isSelected:a,model:o,selectedFeatureClass:i,setContextMenu:s}){const{classes:l}=PF(),{changeManager:c,hoveredFeature:u,selectedFeature:d,session:f,tabularEditor:p}=o,{featureCollapsed:h,filterText:m}=p,{_id:g,children:y,max:v,min:b,strand:_,type:w}=n,x=!h.get(g),S=e=>{f.notify(e.message,"error")};return T.default.createElement(T.default.Fragment,null,T.default.createElement("tr",{onMouseEnter:e=>{o.setHoveredFeature({feature:n,bp:b})},className:l.feature+(a?` ${i}`:r?` ${l.hoveredFeature}`:""),onClick:e=>{e.stopPropagation(),o.setSelectedFeature(n)},onDoubleClick:()=>{o.setSelectedFeature(n),function(e,t){e.lgv.navTo(pf(t,.1,e.lgv.totalBp))}(o,n)},onContextMenu:e=>(e.preventDefault(),s({position:{left:e.clientX+2,top:e.clientY-6},items:MF(o,n)}),!1)},T.default.createElement("td",{style:{whiteSpace:"nowrap",borderLeft:2*t+"em solid transparent"}},y?.size?T.default.createElement("div",{onClick:e=>{e.stopPropagation(),p.setFeatureCollapsed(g,x)},className:l.arrow+(x?` ${l.arrowExpanded}`:"")},""):null,T.default.createElement("div",{className:l.typeContent},T.default.createElement(RT,{session:f,ontologyName:"Sequence Ontology",style:{width:170},value:w,filterTerms:TT,fetchValidTerms:jF.bind(null,n),renderInput:e=>T.default.createElement("div",{ref:e.InputProps.ref},T.default.createElement("input",{type:"text",...e.inputProps,className:l.typeInputElement,style:{width:170}}),e.error?T.default.createElement("div",{className:l.typeErrorMessage},e.errorMessage??"unknown error"):null),onChange:(e,t)=>{t&&function(e,t,n,r){const a=t._id,o=new Xn.TypeChange({typeName:"TypeChange",changedIds:[a],featureId:a,oldType:String(n),newType:String(r),assembly:t.assemblyId});return e.submit(o)}(c,n,e,t).catch(S)}}))),T.default.createElement("td",null,T.default.createElement(FF,{initialValue:b+1,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[a],featureId:a,oldStart:n,newStart:r,assembly:t.assemblyId});return e.submit(o)}(c,n,b,e-1)})),T.default.createElement("td",null,T.default.createElement(FF,{initialValue:v,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[a],featureId:a,oldEnd:n,newEnd:r,assembly:t.assemblyId});return e.submit(o)}(c,n,v,e)})),T.default.createElement("td",null,1===_?"+":-1===_?"-":void 0),T.default.createElement("td",null,T.default.createElement(IF,{filterText:m,feature:n}))),x&&y?[...y.entries()].filter((e=>{if(!m)return!0;const[,t]=e;return JSON.stringify(t).includes(m)})).map((([n,r])=>T.default.createElement(e,{isHovered:u?.feature._id===r._id,isSelected:d?._id===r._id,selectedFeatureClass:i,key:n,depth:(t||0)+1,feature:r,model:o,setContextMenu:s}))):null)}));async function jF(e,t,n){const{parent:r}=e;if(r){const e=(await t.getTermsWithLabelOrSynonym(r.type,{includeSubclasses:!1})).filter(TT);if(e.length>0)return await t.getClassesThat("part_of",e)}}const LF=d.makeStyles()((e=>({scrollableTable:{width:"100%",height:"100%",th:{position:"sticky",top:0,zIndex:2,textAlign:"left",background:e.palette.background.paper,paddingTop:"3.2em"},td:{whiteSpace:"normal"}},selectedFeature:{backgroundColor:e.palette.action.selected}}))),qF=h.observer((function({model:e}){const{hoveredFeature:t,seenFeatures:n,selectedFeature:r,tabularEditor:a}=e,o=l.useTheme(),{classes:i}=LF(),s=u.useRef(null),[c,d]=u.useState(null),{filterText:f}=a;return u.useEffect((()=>{const e=s.current;if(e&&r){const t=e.querySelector(`.${i.selectedFeature}`);if(t){const n=e.scrollTop,r=t.offsetTop-25;r>n&&r<n+e.offsetHeight||e.scroll({top:r-40,behavior:"smooth"})}}}),[r,n,i.selectedFeature]),T.default.createElement("div",{ref:s,style:{width:"100%",overflowY:"auto",height:"100%"}},T.default.createElement("table",{className:i.scrollableTable},T.default.createElement("thead",null,T.default.createElement("tr",null,T.default.createElement("th",null,"Type"),T.default.createElement("th",null,"Start"),T.default.createElement("th",null,"End"),T.default.createElement("th",null,"Strand"),T.default.createElement("th",null,"Attributes"))),T.default.createElement("tbody",null,[...n.entries()].filter((e=>{if(!f)return!0;const[,t]=e;return JSON.stringify(t).includes(f)})).sort(((e,t)=>e[1].min-t[1].min)).map((([n,a])=>T.default.createElement(DF,{key:n,isSelected:r?._id===n,isHovered:t?.feature._id===n,selectedFeatureClass:i.selectedFeature,feature:a,model:e,depth:0,setContextMenu:d}))))),T.default.createElement(p.Menu,{open:Boolean(c),onMenuItemClick:(e,t)=>{t(),d(null)},onClose:()=>{d(null)},slotProps:{transition:{onExit:()=>{d(null)}}},style:{zIndex:o.zIndex.tooltip},menuItems:c?.items??[],anchorReference:"anchorPosition",anchorPosition:c?.position}))}));var BF=s.createSvgIcon(i.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),UF=s.createSvgIcon(i.jsx("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10z"}),"UnfoldLess");const zF=d.makeStyles()({toolbar:{width:"100%",display:"flex",paddingRight:"2em",flexDirection:"row",justifyContent:"space-between",position:"absolute",zIndex:4},filterText:{}}),GF=h.observer((function({model:e}){const t=e.tabularEditor,{classes:n}=zF();return T.default.createElement("div",{className:n.toolbar},T.default.createElement(l.Tooltip,{title:"Collapse all"},T.default.createElement(l.IconButton,{"aria-label":"collapse",sx:{marginTop:0},onClick:t.collapseAllFeatures},T.default.createElement(UF,null))),T.default.createElement(l.TextField,{className:n.filterText,label:"Filter features",value:t.filterText,sx:{marginTop:0},variant:"outlined",onChange:e=>{t.setFilterText(e.target.value)},slotProps:{input:{endAdornment:T.default.createElement(l.InputAdornment,{position:"end"},T.default.createElement(l.IconButton,{onClick:()=>{t.clearFilterText()}},T.default.createElement(BF,null)))}}}))}));function HF(e){e.stopPropagation()}const $F=h.observer((function({model:e}){return e.tabularEditor.isShown?T.default.createElement("div",{onMouseDown:HF,onClick:HF,style:{width:"100%",height:"100%",position:"relative"}},T.default.createElement(GF,{model:e}),T.default.createElement(qF,{model:e})):null})),VF=r.types.model("TabularEditor",{isShown:!0,featureCollapsed:r.types.map(r.types.boolean),filterText:""}).actions((e=>({setFeatureCollapsed(t,n){e.featureCollapsed.set(t,n)},setFilterText(t){e.filterText=t},clearFilterText(){e.filterText=""},collapseAllFeatures(){const t=r.getParent(e);for(const[n]of t.seenFeatures.entries())e.featureCollapsed.set(n,!0)},togglePane(){e.isShown=!e.isShown},hidePane(){e.isShown=!1},showPane(){e.isShown=!0}})));function WF(e,t,n,r=!1){const{apolloRowHeight:a,lgv:o,theme:i}=e,s=e.getFeatureLayoutPosition(n);if(!s)return;const{bpPerPx:l,displayedRegions:c,offsetPx:u}=o,{layoutIndex:d,layoutRow:f}=s,p=c[d],{refName:h,reversed:m}=p,{length:g,max:y,min:v}=n,b=(o.bpToPx({refName:h,coord:m?y:v,regionNumber:d})?.offsetPx??0)-u,_=f*a,w=g/l;t.fillStyle=r?i.palette.action.disabled:i.palette.action.focus,t.fillRect(b,_,w,a)}function JF(e,t,n,r,a,o){e.fillStyle=o,e.fillRect(t,n,r,a)}function YF(e,t,n){const{refName:r,regionNumber:a,x:o}=e,{lgv:i}=n,{offsetPx:s}=i,l=i.bpToPx({refName:r,coord:t.min,regionNumber:a}),c=i.bpToPx({refName:r,coord:t.max,regionNumber:a});if(void 0!==l&&void 0!==c){const e=l.offsetPx-s,t=c.offsetPx-s;if(Math.abs(t-e)<8)return;if(Math.abs(e-o)<4)return"min";if(Math.abs(t-o)<4)return"max"}}const KF={draw:function(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,selectedFeature:s,theme:l}=r,{bpPerPx:c,displayedRegions:u,offsetPx:d}=i,f=u[a],p=(i.bpToPx({refName:f.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-d,{reversed:h}=f,m=t.length/c,g=h?p-m:p,y=n*o,v=l.palette.background.default;!function(e,t,n,r,a,o){JF(e,t,n,r,a,o),r<=2||e.clearRect(t+1,n+1,r-2,a-2)}(e,g,y,m,o,l.palette.text.primary),m<=2||(function(e,t,n,r,a,o){JF(e,t+1,n+1,r-2,a-2,o)}(e,g,y,m,o,v),cf(t,s)&&WF(r,e,t,!0))},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:c}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-c,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o.palette.info.main,t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=l.alpha(o.palette.info.main,.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{hoveredFeature:n}=e;n&&WF(e,t,n.feature)},drawTooltip:function(e,t){const{hoveredFeature:n,apolloRowHeight:r,lgv:a,theme:o}=e;if(!n)return;const{feature:i}=n,s=e.getFeatureLayoutPosition(i);if(!s)return;const{featureRow:c,layoutIndex:u,layoutRow:d}=s,{bpPerPx:f,displayedRegions:p,offsetPx:h}=a,m=p[u],{refName:g,reversed:y}=m;let v="Loc: ";const{length:b,max:_,min:w}=i;v+=`${w+1}${_}`;let x=(a.bpToPx({refName:g,coord:y?_:w,regionNumber:u})?.offsetPx??0)-h;const S=(d+c)*r,E=b/f,k=`Type: ${i.type}`,{attributes:C}=i,A=C.get("gff_name")?.find((e=>""!==e)),O=[t.measureText(k).width,t.measureText(v).width];A&&O.push(t.measureText(`Name: ${A}`).width);const T=Math.max(...O);x=x+E+5,t.fillStyle=l.alpha(o.palette.text.primary,.7),t.fillRect(x,S,T+4,3===O.length?45:35),t.beginPath(),t.moveTo(x,S),t.lineTo(x-5,S+5),t.lineTo(x,S+10),t.fill(),t.fillStyle=o.palette.background.default;let N=S+12;t.fillText(k,x+2,N),A&&(N+=12,t.fillText(`Name: ${A}`,x+2,N)),N+=12,t.fillText(v,x+2,N)},getContextMenuItemsForFeature:ff,getContextMenuItems:function(e){const{hoveredFeature:t}=e;return t?ff(e,t.feature):[]},getFeatureFromLayout:function(e,t,n){return e},getRowCount:function(e){return 1},getRowForFeature:function(e,t){return 0},onMouseDown:function(e,t,n){const{feature:r}=t,a=YF(t,r,e);a&&(n.stopPropagation(),e.startDrag(t,r,a))},onMouseLeave:function(){},onMouseMove:function(e,t){if(yf(t)){const{feature:n,bp:r}=t;if(e.setHoveredFeature({feature:n,bp:r}),YF(t,n,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{feature:n}=t;n&&(e.setSelectedFeature(n),e.showFeatureDetailsWidget(n))}};let ZF=null,XF=null,QF=null,eP=null;const tP=globalThis.document.createElement("canvas");if(tP?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?ZF=a.createPattern(n,"repeat"):QF=a.createPattern(n,"repeat"):"light"===t?XF=a.createPattern(n,"repeat"):eP=a.createPattern(n,"repeat")}}function nP(e,t,n,r,a,o,i,s,l){const{apolloRowHeight:c,lgv:u,theme:d}=t,{bpPerPx:f,displayedRegions:p,offsetPx:h}=u,m=p[n],{refName:g,reversed:y}=m,v=(u.bpToPx({refName:g,coord:a.min,regionNumber:n})?.offsetPx??0)-h,b=a.length/f,_=y?v-b:v,w=(r+o)*c,x=Math.round(.6*c),S=w+(c-x)/2;if(e.fillStyle=d.palette.text.primary,e.fillRect(_,S,b,x),b>2&&(e.clearRect(_+1,S+1,b-2,x-2),e.fillStyle="rgb(211,211,211)",e.fillRect(_+1,S+1,b-2,x-2),s&&l&&i)){const t=y?-1:1,[n,r]=i*t==1?[s,l]:[l,s];e.fillStyle=n,e.fillRect(_+1,S+1,b-2,(x-2)/2),e.fillStyle=r,e.fillRect(_+1,S+1+(x-2)/2,b-2,(x-2)/2)}}function*rP(e,t,n=1){if(e!==t)if(e<t)for(let r=e;r<t;r+=n)yield r;else for(let r=e;r>t;r-=n)yield r}function aP(e,t,n,r,a,o){const{apolloRowHeight:i,lgv:s,theme:l}=t,{bpPerPx:c,displayedRegions:u,offsetPx:d}=s,f=u[n],{refName:p,reversed:h}=f,m=(s.bpToPx({refName:p,coord:a.min,regionNumber:n})?.offsetPx??0)-d,g=Math.round(a.length/c),y=h?m-g:m,v=Math.round((o+.5)*i)+r*i;e.strokeStyle=l.palette.text.primary;const{strand:b=1}=a;e.beginPath();const _=b*(h?-1:1),w=y-(-1===_?5:0),x=y+g+(-1===_?0:5);e.moveTo(w,v),e.lineTo(x,v);const S=w+(-1===_?0:3),E=x-(-1===_?3:0),k=-1===_?3:-3,C=-1===_?rP(S,E,20):rP(E,S,20);for(const t of C)e.moveTo(t+k,v+k),e.lineTo(t,v),e.lineTo(t+k,v-k);e.stroke()}function oP(e,t,n,r=!1){const{apolloRowHeight:a,lgv:o,session:i,theme:s}=e,{featureTypeOntology:l}=i.apolloDataStore.ontologyManager,c=e.getFeatureLayoutPosition(n);if(!c)return;const{bpPerPx:u,displayedRegions:d,offsetPx:f}=o,{featureRow:p,layoutIndex:h,layoutRow:m}=c,g=d[h],{refName:y,reversed:v}=g,{length:b,max:_,min:w}=n,x=(o.bpToPx({refName:y,coord:v?_:w,regionNumber:h})?.offsetPx??0)-f,S=(m+p)*a,E=b/u;if(t.fillStyle=r?s.palette.action.disabled:s.palette.action.focus,!l)throw new Error("featureTypeOntology is undefined");t.fillRect(x,S,E,a*sP(n,l))}function iP(e,t){const{children:n,type:r}=e;if(!n)return 0;let a=0;if(t.isTypeOf(r,"transcript"))for(const[,e]of n)t.isTypeOf(e.type,"CDS")&&(a+=1);return a}function sP(e,t,n){const{children:r,type:a}=e;if(!r)return 1;let o=0;if(t.isTypeOf(a,"transcript")||t.isTypeOf(a,"pseudogenic_transcript")){for(const[,e]of r)t.isTypeOf(e.type,"CDS")&&(o+=1);return 0===o?1:o}for(const[,e]of r)o+=sP(e,t);return o}function lP(e,t){if(!t.isTypeOf(e.type,"gene")&&!t.isTypeOf(e.type,"pseudogene"))throw new Error('Top level feature for GeneGlyph must have type "gene"');const{children:n}=e;if(!n)return[[e]];const r=[];for(const[,a]of n){if(!t.isTypeOf(a.type,"transcript")&&!t.isTypeOf(a.type,"pseudogenic_transcript")){r.push([a,e]);continue}if(!a.children)continue;const n=[],o=[];for(const[,e]of a.children)t.isTypeOf(e.type,"CDS")?n.push(e):t.isTypeOf(e.type,"exon")&&o.push(e);for(const t of n)r.push([t,...o,a,e]);0===n.length&&r.push([...o,a,e])}return r}function cP(e,t,r){const{session:a}=r,{apolloDataStore:o}=a,{featureTypeOntology:i}=o.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");const s=i.isTypeOf(t.type,"gene")||i.isTypeOf(t.type,"pseudogene"),l=i.isTypeOf(t.type,"transcript")||i.isTypeOf(t.type,"pseudogenic_transcript"),c=i.isTypeOf(t.type,"CDS");if(s||l)return;const{bp:u,refName:d,regionNumber:f,x:p}=e,{lgv:h}=r;if(c){const e=t.parent;if(!e?.children)return;const r=[];for(const t of e.children.values())i.isTypeOf(t.type,"exon")&&r.push(t);const a=r.find((e=>{const[t,r]=n.intersection2(u-1,u,e.min,e.max);return void 0!==t&&void 0!==r}));if(a){const e=sf(a,d,f,h);if(e){const t=lf(a,p,e);if(t)return t}}}const m=sf(t,d,f,h);if(m){const e=lf(t,p,m);if(e)return e}}const{drawTooltip:uP,getContextMenuItemsForFeature:dP,onMouseLeave:fP}=KF,pP={draw:function(e,t,r,o,i){const{apolloRowHeight:s,lgv:c,selectedFeature:u,session:d,theme:f}=o,{bpPerPx:p,displayedRegions:h,offsetPx:m}=c,g=h[i],{refName:y,reversed:v}=g,b=s,_=Math.round(.9*b),{children:w,strand:x}=t;if(!w)return;const{apolloDataStore:S}=d,{featureTypeOntology:E}=S.ontologyManager;if(!E)throw new Error("featureTypeOntology is undefined");!function(e,t,n,r,o,i){const{apolloRowHeight:s,lgv:c,session:u,theme:d}=n,{bpPerPx:f,displayedRegions:p,offsetPx:h}=c,m=p[r],{refName:g,reversed:y}=m,{apolloDataStore:v}=u,{featureTypeOntology:b}=v.ontologyManager;if(!b)throw new Error("featureTypeOntology is undefined");const _=(c.bpToPx({refName:g,coord:t.min,regionNumber:r})?.offsetPx??0)-h,w=t.length/f,x=y?_-w:_,S=o*s,E=sP(t,b)*s;let k;k=a.readConfObject(u.getPluginConfiguration(),"geneBackgroundColor",{featureType:t.type}),k||(k=l.alpha(d.palette.background.paper,.6)),e.fillStyle=k,e.fillRect(x,S,w,E)}(e,t,o,i,r);let k=0;for(const[,t]of w){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){k+=1;continue}const{children:n}=t;if(!n)continue;const a=iP(t,E);for(const[,a]of n)E.isTypeOf(a.type,"CDS")&&(aP(e,o,i,r,t,k),k+=1);0===a&&(aP(e,o,i,r,t,k),k+=1)}const C="dark"===f.palette.mode?QF:ZF,A="dark"===f.palette.mode?eP:XF;k=0;for(const[,t]of w){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){KF.draw(e,t,r,o,i),k+=1;continue}const a=iP(t,E);if(0!=a)for(const a of t.cdsLocations){const{children:s}=t;if(s){for(const[,t]of s)E.isTypeOf(t.type,"exon")&&nP(e,o,i,r,t,k,x,C,A);for(const o of a){const a=(o.max-o.min)/p,s=(c.bpToPx({refName:y,coord:o.min,regionNumber:i})?.offsetPx??0)-m,l=v?s-a:s;e.fillStyle=f.palette.text.primary;const u=(r+k)*b+(b-_)/2;if(e.fillRect(l,u,a,_),a>2){e.clearRect(l+1,u+1,a-2,_-2);const r=n.getFrame(o.min,o.max,t.strand??1,o.phase),i=f.palette.framesCDS.at(r)?.main;if(e.fillStyle=i??"black",e.fillRect(l+1,u+1,a-2,_-2),C&&A&&x){const t=v?-1:1,[n,r]=x*t==1?[C,A]:[A,C];e.fillStyle=n,e.fillRect(l+1,u+1,a-2,(_-2)/2),e.fillStyle=r,e.fillRect(l+1,u+(_-2)/2,a-2,(_-2)/2)}}}k+=1}}const{children:s}=t;if(0===a&&s){for(const[,t]of s)E.isTypeOf(t.type,"exon")&&nP(e,o,i,r,t,k,x,C,A);k+=1}}u&&uf(t,u)&&oP(o,e,u,!0)},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:c}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-c,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o.palette.info.main,t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=l.alpha(o.palette.info.main,.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{hoveredFeature:n}=e;n&&oP(e,t,n.feature)},drawTooltip:uP,getContextMenuItems:function(e,t){const{apolloInternetAccount:r,hoveredFeature:a,changeManager:o,regions:i,selectedFeature:s,session:l}=e,[c]=i,u=e.getAssemblyId(c.assemblyName),d=[],f="admin"===(r?r.role:"admin");if(!a)return d;if(yf(t)){const{bp:r,feature:a}=t;let i=Zd(a,r);rf(a,l)&&(i=Zd(a,r,!0));for(const r of i){const a=KF.getContextMenuItemsForFeature(e,r);if(nf(r,l)){const i=af(r,e,t,l),c=n.getContainingView(e);if(i.upstream){const t=i.upstream;a.push({label:"Go to upstream exon",icon:of(r.strand,!0,c.displayedRegions.at(0)?.reversed),onClick:()=>{c.navTo(pf(t,.1,c.totalBp)),ef(e,t)}})}if(i.downstream){const t=i.downstream;a.push({label:"Go to downstream exon",icon:of(r.strand,!1,c.displayedRegions.at(0)?.reversed),onClick:()=>{c.navTo(pf(t,.1,c.totalBp)),ef(e,t)}})}a.push({label:"Merge exons",disabled:!f,onClick:()=>{l.queueDialog((t=>[QT,{session:l,handleClose:()=>{t()},changeManager:o,sourceFeature:r,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}},{label:"Split exon",disabled:!f,onClick:()=>{l.queueDialog((t=>[dN,{session:l,handleClose:()=>{t()},changeManager:o,sourceFeature:r,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}})}tf(r,l)&&(a.push({label:"Merge transcript",onClick:()=>{l.queueDialog((t=>[tN,{session:l,handleClose:()=>{t()},changeManager:o,sourceFeature:r,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),n.isSessionModelWithWidgets(l)&&a.splice(1,0,{label:"Open transcript editor",onClick:()=>{const e=l.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:r,assembly:u,changeManager:o,refName:c.refName});l.showWidget(e)}})),d.push({label:r.type,subMenu:a})}}return d},getContextMenuItemsForFeature:dP,getFeatureFromLayout:function(e,t,n,r){const a=lP(e,r)[n]||[];for(const e of a){let n;if(t>=e.min&&t<=e.max&&e.parent&&(n=e),n){if(r.isTypeOf(n.type,"CDS")&&n.parent&&(r.isTypeOf(n.parent.type,"transcript")||r.isTypeOf(n.parent.type,"pseudogenic_transcript"))){const{cdsLocations:e}=n.parent;for(const r of e)for(const e of r)if(t>=e.min&&t<=e.max)return n;return n.parent}return n}}return e},getRowCount:sP,getRowForFeature:function(e,t,n){const r=lP(e,n);for(const[e,n]of r.entries())if(n.some((e=>e._id===t._id)))return e},onMouseDown:function(e,t,n){const{feature:r}=t,a=cP(t,r,e);a&&(n.stopPropagation(),e.startDrag(t,a.feature,a.edge,!0))},onMouseLeave:fP,onMouseMove:function(e,t){if(yf(t)){const{feature:n,bp:r}=t;if(e.setHoveredFeature({feature:n,bp:r}),cP(t,n,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{feature:n}=t;n&&ef(e,n)}};function hP(e){const t=[[e]];if(e.children)for(const[,n]of e.children)t.push(...hP(n));return t}function mP(e){return hP(e).length}function gP(e,t,n,r,a,o){const i=hP(t)[n-r];for(const t of i)yP(e,t,n,a,o)}function yP(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,theme:s}=r,{bpPerPx:c,displayedRegions:u,offsetPx:d}=i,f=u[a],p=(i.bpToPx({refName:f.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-d,{reversed:h}=f,m=t.length/c,g=h?p-m:p,y=n*o,v=mP(t),b=l.alpha(s.palette.background.paper,.6);v>1&&JF(e,g,y,m,v*o,b),KF.draw(e,t,n,r,a)}function vP(e,t,n,r=!1){const{apolloRowHeight:a,lgv:o,theme:i}=e,s=e.getFeatureLayoutPosition(n);if(!s)return;const{featureRow:l,layoutIndex:c,layoutRow:u}=s,{bpPerPx:d,displayedRegions:f,offsetPx:p}=o,h=f[c],{refName:m,reversed:g}=h,{length:y,max:v,min:b}=n,_=(o.bpToPx({refName:m,coord:g?v:b,regionNumber:c})?.offsetPx??0)-p,w=(u+l)*a,x=y/d;t.fillStyle=r?i.palette.action.disabled:i.palette.action.focus,t.fillRect(_,w,x,a*mP(n))}const{drawDragPreview:bP,drawTooltip:_P,getContextMenuItemsForFeature:wP,onMouseDown:xP,onMouseLeave:SP,onMouseMove:EP,onMouseUp:kP}=KF,CP={draw:function(e,t,n,r,a){const{selectedFeature:o}=r;for(let o=0;o<mP(t);o++)gP(e,t,n+o,n,r,a);o&&uf(t,o)&&vP(r,e,o)},drawDragPreview:bP,drawHover:function(e,t){const{hoveredFeature:n}=e;n&&vP(e,t,n.feature)},drawTooltip:_P,getContextMenuItemsForFeature:wP,getContextMenuItems:function(e,t){const{hoveredFeature:n,session:r}=e,a=[];if(!n)return a;const{featureTypeOntology:o}=r.apolloDataStore.ontologyManager;if(!o)throw new Error("featureTypeOntology is undefined");const i=KF.getContextMenuItems(e,t);if(a.push({label:n.feature.type,subMenu:i}),yf(t)){const{bp:r,feature:o}=t;for(const t of Zd(o,r)){if(t._id===n.feature._id)continue;const r=KF.getContextMenuItemsForFeature(e,t);a.push({label:t.type,subMenu:r})}}return a},getFeatureFromLayout:function(e,t,n){return hP(e)[n].find((e=>t>=e.min&&t<=e.max))},getRowCount:mP,getRowForFeature:function(e,t){const n=hP(e);for(const[e,r]of n.entries())if(r.some((e=>e._id===t._id)))return e},onMouseDown:xP,onMouseLeave:SP,onMouseMove:EP,onMouseUp:kP},AP=h.observer((function({featureTypes:e,handleClose:t,onUpdate:n,session:r}){const[a,o]=u.useState(""),[i,s]=u.useState(e);return T.default.createElement(xf,{open:!0,maxWidth:!1,"data-testid":"filter-features-dialog",title:"Filter features by type",handleClose:t},T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,null,"Select the feature types you want to display in the apollo track"),T.default.createElement(l.Grid,{container:!0,spacing:2},T.default.createElement(l.Grid,{size:8},T.default.createElement(RT,{session:r,ontologyName:"Sequence Ontology",style:{width:"100%"},value:a,filterTerms:TT,renderInput:e=>T.default.createElement(l.TextField,{...e,label:"Feature type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{t&&(e=>{o(e)})(t)}})),T.default.createElement(l.Grid,{size:4},T.default.createElement(l.Button,{variant:"contained",onClick:()=>{if(a){if(i.includes(a))return;n([...i,a]),s([...i,a])}},disabled:!a,style:{marginTop:9},size:"medium"},"Add"))),i.length>0&&T.default.createElement("div",null,T.default.createElement("hr",null),T.default.createElement("div",{style:{width:300}},T.default.createElement(l.DialogContentText,null,"Selected feature types:"),T.default.createElement(l.Box,{sx:{display:"flex",flexWrap:"wrap",gap:.5}},i.map((e=>T.default.createElement(l.Chip,{key:e,label:e,onDelete:()=>{(e=>{const t=i.filter((t=>t!==e));n(t),s(t)})(e)}}))))))))})),OP=h.observer((function({model:e,handleClose:t}){const[n,r]=u.useState(`${e.zoomThresholdSetting}`);return T.default.createElement(p.Dialog,{open:!0,onClose:t,title:"Edit zoom threshold setting"},T.default.createElement(l.DialogContent,null,T.default.createElement(l.Typography,null,"The zoom level in base pairs (bp) per pixel at which features are rendered in this Annotations track. Increasing the value will allow features to render when zooming out, but might impact performance."),T.default.createElement(l.TextField,{label:"Threshold value (bpPerPx)",value:n,onChange:e=>{r(e.target.value)}}),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",onClick:()=>{e.setZoomThresholdSetting({zoomThreshold:+n}),t()}},"Submit"),T.default.createElement(l.Button,{variant:"contained",color:"secondary",onClick:()=>{t()}},"Cancel"))))})),TP=d.makeStyles()((e=>({canvasContainer:{position:"relative",left:0},canvas:{position:"absolute",left:0},center:{display:"flex",justifyContent:"center"},ellipses:{textOverflow:"ellipsis",overflow:"hidden"},avatar:{position:"static",height:"100%",width:"100%",overflow:"visible",color:e.palette.warning.light,backgroundColor:e.palette.warning.contrastText},box:{position:"absolute",overflow:"visible"},badge:{display:"inline-block"},loading:{position:"absolute",right:e.spacing(3),zIndex:10,pointerEvents:"none",textAlign:"right"},locked:{position:"absolute",right:e.spacing(3),top:e.spacing(6),zIndex:1,pointerEvents:"none",textAlign:"right"}})));function NP(e,t,n){const r=new Map;for(const t of e)(r.get(t.message)??r.set(t.message,[]).get(t.message)).push(t);const a=[];for(const[e,s]of r.entries()){if(0===s.length)continue;s.sort(((e,t)=>e.start-t.start));let r=[s[0]],l=s[0].start,c=s[0].start+t;const u=()=>{const t=r.map((e=>e.start)).sort(((e,t)=>e-t)),n=Math.floor(t.length/2),o=r[0].ids;a.push({_id:r[0]._id,message:e,start:t.length%2?t[n]:(t[n-1]+t[n])/2,count:r.length,members:[...r],range:{min:l,max:c},featureIds:o})};for(let e=1;e<s.length;e++){const a=s[e],d=a.start,f=d+t;o=c,i=d,(n?i<=o:i<o)?(r.push(a),d<l&&(l=d),f>c&&(c=f)):(u(),r=[a],l=d,c=f)}u()}var o,i;return a.sort(((e,t)=>e.message.localeCompare(t.message)||e.start-t.start)),a}function IP(e,t,n){return"M"===e?t.palette.startCodon:"*"===e?n?t.palette.text.primary:t.palette.stopCodon:void 0}function RP(e,t){const n=e.toUpperCase();return"A"===n||"C"===n||"G"===n||"T"===n?t.palette.bases[n].main.toString():"lightgray"}function FP(e,t,n){const r=[];for(let a=e;a<e+t;a++){const e=n.get(a);e&&r.push(e)}return r}function PP(e,t){for(const r of e)for(const[e,a]of r)if(n.doesIntersect2(t.min,t.max,e,a)||n.doesIntersect2(e,a,t.min,t.max))return!1;return!0}function MP(e,t){return function(e,t){return function(e,t){const i=function(e,t){return function(e,t){const i=function(e,t){return o.BaseDisplay.named("BaseLinearApolloDisplay").props({type:r.types.literal("LinearApolloDisplay"),configuration:a.ConfigurationReference(t),graphical:!0,table:!1,showCheckResults:!0,zoomThreshold:200,heightPreConfig:r.types.maybe(r.types.refinement("displayHeight",r.types.number,(e=>e>=20))),filteredFeatureTypes:r.types.array(r.types.string),loadingState:!1}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...S.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?400:e.graphical?100:200},get loading(){return e.loadingState},get zoomThresholdSetting(){return e.zoomThreshold??a.getConf(e,"zoomThreshold")}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=e.zoomThreshold)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=r.getRoot(e),{assemblyName:o}=t,{assemblyManager:i}=e.session,s=i.get(o);if(!s)throw new Error(`No assembly found with name ${o}`);const{internetAccountConfigId:l}=a.getConf(s,["sequence","metadata"]);return n.find((e=>a.getConf(e,"internetAccountId")===l))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature},get hoveredFeature(){return e.session.apolloHoveredFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowCheckResults(){e.showCheckResults=!e.showCheckResults},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=r.cast(t)},setLoading(t){e.loadingState=t},setZoomThresholdSetting({zoomThreshold:t}){e.zoomThreshold=t}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:a}=e;return{trackMenuItems(){const{graphical:o,table:i,showCheckResults:s}=e;return[...a(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:o&&!i,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:i&&!o,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:i&&o,onClick:()=>{e.showGraphicalAndTable()}},{label:"Check Results",type:"checkbox",checked:s,onClick:()=>{e.toggleShowCheckResults()}},{label:"Change zoom threshold",onClick:()=>{n.getSession(e).queueDialog((t=>[OP,{model:e,handleClose:t}]))}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((a=>[AP,{session:n,handleClose:()=>{a()},featureTypes:r.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},setHoveredFeature(t){e.session.apolloSetHoveredFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],d=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(d)},afterAttach(){r.addDisposer(e,c.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.setLoading(!0),e.session.apolloDataStore.loadFeatures(e.regions).then((()=>{setTimeout((()=>{e.setLoading(!1)}),1e3)})))}),{name:"LinearApolloDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return i.named("LinearApolloDisplayLayouts").props({cleanupBoundary:2e5}).volatile((()=>({seenFeatures:c.observable.map()}))).views((e=>({getAnnotationFeatureById:t=>e.seenFeatures.get(t),getGlyph(e){const{topLevelFeature:t}=e;return t.looksLikeGene?pP:t.children?.size?CP:KF}}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((a=>{const o=t.get(a.assemblyName),i=new Map,s=new Map,{end:l,refName:c,start:u}=a;for(const[t,a]of e.seenFeatures.entries()){if(!r.isAlive(a)){e.deleteSeenFeature(t);continue}if(c!==o?.getCanonicalRefName(a.refSeq)||!n.doesIntersect2(u,l,a.min,a.max)||e.filteredFeatureTypes.length>0&&!e.filteredFeatureTypes.includes(a.type))continue;const{featureTypeOntology:d}=e.session.apolloDataStore.ontologyManager;if(!d)throw new Error("featureTypeOntology is undefined");const f=e.getGlyph(a).getRowCount(a,d,e.lgv.bpPerPx);let p=0,h=!1;for(;!h;){let e=FP(p,f,s);if(e.length<f){for(let t=0;t<f-e.length;t++){const e=s.size;s.set(e,[]),i.set(e,[])}e=FP(p,f,s)}if(PP(e,a)){for(let e=p;e<p+f;e++){s.get(e)?.push([a.min,a.max]);const t=i.get(e);t?.push([e-p,a._id])}h=!0}else p+=1}}return i}))},getFeatureLayoutPosition(t){const{featureLayouts:n}=this,{featureTypeOntology:r}=e.session.apolloDataStore.ontologyManager;for(const[a,o]of n.entries())for(const[n,i]of o)for(const[o,s]of i){if(0!==o)continue;const i=e.getAnnotationFeatureById(s);if(i){if(t._id===i._id)return{layoutIndex:a,layoutRow:n,featureRow:o};if(i.hasDescendant(t._id)){if(!r)throw new Error("featureTypeOntology is undefined");const o=e.getGlyph(i).getRowForFeature(i,t,r);if(void 0!==o)return{layoutIndex:a,layoutRow:n,featureRow:o}}}}}}))).views((e=>({get highestRow(){return Math.max(0,...e.featureLayouts.map((e=>Math.max(...e.keys()))))}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered()){for(const[t,r]of e.seenFeatures.entries()){let a=!1;for(const t of e.regions)if(n.doesIntersect2(t.start-e.cleanupBoundary,t.end+e.cleanupBoundary,r.min,r.max)){a=!0;break}a||e.deleteSeenFeature(t)}for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}}),{name:"LinearApolloDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloDisplayRendering").props({apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:40,isShown:!0,filteredTranscripts:r.types.array(r.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,theme:l.createTheme()}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setTheme(t){e.theme=t}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,d=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,d,100),t.fillStyle="black",t.fillText(n.name,u+1,11,d-2)}a++}}}}),{name:"LinearApolloDisplayRenderCollaborators"})),r.addDisposer(e,c.autorun((()=>{const{canvas:t,featureLayouts:r,featuresHeight:a,lgv:o}=e;if(!o.initialized||e.regionCannotBeRendered())return;const{displayedRegions:i,dynamicBlocks:s}=o,l=t?.getContext("2d");if(l){l.clearRect(0,0,s.totalWidthPx,a);for(const[t,a]of r.entries()){const r=i[t];for(const[o,i]of a.entries())for(const[a,s]of i){const i=e.getAnnotationFeatureById(s);a>0||!i||n.doesIntersect2(r.start,r.end,i.min,i.max)&&e.getGlyph(i).draw(l,i,o,e,t)}}}}),{name:"LinearApolloDisplayRenderFeatures"}))}})))}(0,t);return i.named("LinearApolloDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0}))).views((e=>({getMousePosition(t){const n=vf(t,e.lgv),{bp:r,regionNumber:a,y:o}=n,i=Math.floor(o/e.apolloRowHeight),s=e.featureLayouts[a].get(i);if(!s)return n;const l=s.find((t=>{const n=e.getAnnotationFeatureById(t[1]);return n&&r>=n.min&&r<=n.max}));if(!l)return n;const[c,u]=l,d=e.getAnnotationFeatureById(u);if(!d)return n;const f=e.getGlyph(d),{featureTypeOntology:p}=e.session.apolloDataStore.ontologyManager;if(!p)throw new Error("featureTypeOntology is undefined");const h=f.getFeatureFromLayout(d,r,c,p);return h?{...n,feature:h}:n}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(e){}}))).actions((()=>({onClick(){}})))}(0,t).views((e=>({contextMenuItems(t){const{hoveredFeature:n}=e;if(!n)return[];const r=e.getMousePosition(t),{topLevelFeature:a}=n.feature,o=e.getGlyph(a);return yf(r)?o.getContextMenuItems(e,r):[]}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=gf(r,t.bp,n,o),c="max"===n?new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);yf(n)&&e.getGlyph(n.feature).onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);yf(n)?e.getGlyph(n.feature).onMouseMove(e,n,t):(e.setHoveredFeature(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setHoveredFeature();const n=e.getMousePosition(t);yf(n)&&e.getGlyph(n.feature).onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);yf(n)?e.getGlyph(n.feature).onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,hoveredFeature:r}=e;if(!r)return;const a=e.getGlyph(r.feature);a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:r.types.optional(VF,{})}).named("LinearApolloDisplay")}const DP=a.ConfigurationSchema("LinearApolloReferenceSequenceDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0});function jP(e,t,n){const r=t<=1?[2,1,0,7,6,5]:[2,1,0,5,4,3];n&&r.reverse(),r.unshift(0);const a=r.at(e);if(void 0===a)throw new Error("could not find row");return a}function LP(e,t,n,r){return r.offsetPx-n+(r.reversed?r.end-e.max:e.min-r.start)/t}function qP(e,t,n,r,a,o,i=!1){e.fillStyle=i?o.palette.action.disabled:o.palette.action.focus,e.fillRect(t,n,r,a),e.strokeStyle=i?o.palette.text.secondary:o.palette.text.primary,e.strokeStyle=o.palette.text.primary,e.strokeRect(t,n,r,a)}function BP(e,t,n,r,a,o,i,s=!1){const l=function(e,t,n){if(!(t>1||void 0===e))return n?1===e?4:3:1===e?3:4}(t.strand,n,o.reversed);l&&qP(e,LP(t,n,r,o),l*a,t.length/n,a,i,s)}function UP(e,t,r,a,o,i,s,l=!1){const c=t.parent;if(!c)return;const u=c.cdsLocations.find((e=>{const n=e.at(1===t.strand?0:-1)?.min,r=e.at(1===t.strand?-1:0)?.max;return t.min===n&&t.max===r}));if(u)for(const c of u){const u=jP(n.getFrame(c.min,c.max,t.strand??1,c.phase),r,i.reversed);qP(e,LP(c,r,a,i),u*o,(c.max-c.min)/r,o,s,l)}}function zP(e,t,n,r,a,o){e.strokeStyle=o,e.lineWidth=1,e.strokeRect(t+.5,n+.5,r-1,a-1)}function GP(e,t,n,r,a){const o=Math.min(r,10);e.fillStyle="#000",e.font=`${o}px`;const i=e.measureText(a).width,s=Math.round(t+(r-i)/2);e.fillText(a,s,n+10)}function HP(e,t,n,r,a,o,i,s){const l=t<=1?[3,2,1,0,0,-1,-2,-3]:[3,2,1,-1,-2,-3];s&&l.reverse();for(const[t,s]of l.entries()){const l=n.palette.framesCDS.at(s)?.main;if(!l)continue;const c=t*i;e.fillStyle=r?n.palette.background.default:l,e.fillRect(a,c,o,i),r&&zP(e,a,c,o,i,n.palette.grey[200])}}function $P(e,t,r,a,o,i,s){if(1/o<1)return;const l=Math.round(a+r/o),c=Math.round(a+(r+1)/o)-l,u=[-1,1];for(const r of u){const a=(1===r?3:4)*i,u=1===r?t:n.revcom(t);e.fillStyle=RP(u,s),e.fillRect(l,a,c,i),1/o>=12&&(zP(e,l,a,c,i,s.palette.text.disabled),GP(e,l,a,c,u))}}function VP(e,t,r,a,o,i,s,l,c,u,d){const f=(s<=1?[0,2,1,0,7,6,5]:[0,2,1,0,5,4,3]).map((e=>e*c)),p=[-1,1];for(const h of p){const p=n.getFrame(l,l+3,h,0),m=f.at(p);if(void 0===m)continue;const g=Math.round(r+a/s),y=Math.round(r+(a+3)/s)-g,v=1===h?t:n.revcom(t),b=n.defaultCodonTable[v],_=IP(b,o,i);_&&(d&&"*"==b||u&&"*"!=b)&&(e.fillStyle=_,e.fillRect(g,m,y,c)),1/s>=4&&(zP(e,g,m,y,c,o.palette.text.disabled),GP(e,g,m,y,b))}}function WP(e,t){return function(e,t){const i=function(e,t){return o.BaseDisplay.named("BaseLinearApolloReferenceSequenceDisplay").props({type:r.types.literal("LinearApolloReferenceSequenceDisplay"),configuration:a.ConfigurationReference(t),showStartCodons:!1,showStopCodons:!0,highContrast:!1,heightPreConfig:r.types.maybe(r.types.refinement("displayHeight",r.types.number,(e=>e>=20))),sequenceRowHeight:15}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...S.getParentRenderProps(e),config:t.renderer})}})).views((e=>({get lgv(){return n.getContainingView(e)}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=3)return"Zoom in to see sequence"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=r.getRoot(e),{assemblyName:o}=t,{assemblyManager:i}=e.session,s=i.get(o);if(!s)throw new Error(`No assembly found with name ${o}`);const{internetAccountConfigId:l}=a.getConf(s,["sequence","metadata"]);return n.find((e=>a.getConf(e,"internetAccountId")===l))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature},get hoveredFeature(){return e.session.apolloHoveredFeature},get height(){const{sequenceRowHeight:t}=e;return e.lgv.bpPerPx<=1?8*t:6*t}}))).volatile((()=>({scrollTop:0}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},toggleShowStartCodons(){e.showStartCodons=!e.showStartCodons},toggleShowStopCodons(){e.showStopCodons=!e.showStopCodons},toggleHighContrast(){e.highContrast=!e.highContrast}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems(){const{showStartCodons:n,showStopCodons:r,highContrast:a}=e;return[...t(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show start codons",type:"checkbox",checked:n,onClick:()=>{e.toggleShowStartCodons()}},{label:"Show stop codons",type:"checkbox",checked:r,onClick:()=>{e.toggleShowStopCodons()}},{label:"Use high contrast colors",type:"checkbox",checked:a,onClick:()=>{e.toggleHighContrast()}}]}]}}})).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&e.lgv.bpPerPx<=3&&e.session.apolloDataStore.loadRefSeq(e.regions)}),{name:"LinearApolloReferenceSequenceDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return i.named("LinearApolloReferenceSequenceDisplayRendering").volatile((()=>({seqTrackCanvas:null,seqTrackOverlayCanvas:null,theme:l.createTheme()}))).actions((e=>({setSeqTrackCanvas(t){e.seqTrackCanvas=t},setSeqTrackOverlayCanvas(t){e.seqTrackOverlayCanvas=t},setTheme(t){e.theme=t},afterAttach(){r.addDisposer(e,c.autorun((()=>{const{lgv:t,seqTrackCanvas:r,theme:a,highContrast:o,showStartCodons:i,showStopCodons:s,sequenceRowHeight:l,session:c}=e;if(!t.initialized||e.regionCannotBeRendered()||!r)return;if(3/t.bpPerPx<1)return;const{bpPerPx:u,offsetPx:d,dynamicBlocks:f}=t;!function(e,t,r,a,o,i,s,l,c,u){const d=e.getContext("2d");if(!d)return;d.clearRect(0,0,e.width,e.height);const{apolloDataStore:f}=u;for(const e of o.contentBlocks){const o=e.offsetPx-a;HP(d,r,t,i,o,e.widthPx,c,e.reversed);const u=f.assemblies.get(e.assemblyName),p=u?.getByRefName(e.refName),h=Math.floor(e.start),m=Math.ceil(e.end);let g=p?.getSequence(h,m);if(!g)return;g=g.toUpperCase(),e.reversed&&(g=n.revcom(g));const y=o-(e.reversed?m-e.end:e.start-h)/r;for(let n=0;n<g.length;n++){const a=e.reversed?m-n:h+n,o=g.slice(n,n+3);$P(d,g[n],n,y,r,c,t),3===o.length&&VP(d,o,y,n,t,i,r,a,c,s,l)}}}(r,a,u,d,f,o,i,s,l,c)}),{name:"LinearApolloReferenceSequenceDisplayRenderSequence"})),r.addDisposer(e,c.autorun((()=>{const{seqTrackOverlayCanvas:t}=e;if(!e.lgv.initialized||e.regionCannotBeRendered()||!t)return;const n=t.getContext("2d");if(!n)return;n.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.height);const{hoveredFeature:r,selectedFeature:a,lgv:o,sequenceRowHeight:i,session:s,theme:l}=e;if(!r&&!a)return;const{bpPerPx:c,dynamicBlocks:u,offsetPx:d}=o;!function(e,t,n,r,a,o,i,s,l,c){const{featureTypeOntology:u}=i.apolloDataStore.ontologyManager;if(!u)throw new Error("featureTypeOntology is undefined");for(const i of c.contentBlocks){t.save(),t.beginPath(),t.rect(i.offsetPx-l,0,i.widthPx,e.height),t.clip();for(const e of[r,n?.feature].filter((e=>void 0!==e)))u.isTypeOf(e.type,"CDS")?UP(t,e,s,l,a,i,o,e._id===r?._id):BP(t,e,s,l,a,i,o,e._id===r?._id);t.restore()}}(t,n,r,a,i,l,s,c,d,u)}),{name:"LinearApolloReferenceSequenceDisplayRenderSequenceHighlight"}))}})))}(0,t).named("LinearApolloReferenceSequenceDisplay")}const JP=h.observer((function(e){const t=l.useTheme(),{model:r}=e,{height:a,regionCannotBeRendered:o,setSeqTrackCanvas:i,setSeqTrackOverlayCanvas:s,setTheme:c}=r,{classes:d}=TP();u.useEffect((()=>{c(t)}),[t,c]);const f=n.getContainingView(r),p=o();return p?T.default.createElement(l.Alert,{severity:"warning",classes:{message:d.ellipses},slotProps:{root:{className:d.center}}},T.default.createElement(l.Tooltip,{title:p},T.default.createElement("div",null,p))):T.default.createElement(T.default.Fragment,null,3/f.bpPerPx>=1?T.default.createElement("div",{className:d.canvasContainer,style:{width:f.dynamicBlocks.totalWidthPx,height:a}},T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),i(e)},width:f.dynamicBlocks.totalWidthPx,height:a,className:d.canvas,"data-testid":"seqTrackCanvas"}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),s(e)},width:f.dynamicBlocks.totalWidthPx,height:a,className:d.canvas,"data-testid":"seqTrackOverlayCanvas"})):null)})),YP=a.ConfigurationSchema("LinearApolloSixFrameDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),KP=h.observer((function({sourceFeature:e,filteredTranscripts:t,handleClose:n,onUpdate:r}){const a=[];if(e.children)for(const[,t]of e.children){const e=t.attributes.get("gff_id")?.toString();e&&a.push(e)}const[o,i]=u.useState(t);return T.default.createElement(xf,{open:!0,maxWidth:!1,"data-testid":"filter-transcripts-dialog",title:"Filter transcripts by ID",handleClose:n},T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,null,"Select the alternate transcripts you want to display in the apollo track"),T.default.createElement(l.Grid,{container:!0,spacing:2},T.default.createElement(l.Grid,{size:8},T.default.createElement(l.FormGroup,null,a.map((e=>T.default.createElement(l.FormControlLabel,{control:T.default.createElement(l.Checkbox,{checked:!o.includes(e),onChange:()=>{(e=>{const t=o.includes(e)?o.filter((t=>t!==e)):[...o,e];r(t),i(t)})(e)},slotProps:{input:{"aria-label":"controlled"}}}),label:e}))))))))}));let ZP=null,XP=null,QP=null,eM=null;const tM=globalThis.document.createElement("canvas");if(tM?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?ZP=a.createPattern(n,"repeat"):QP=a.createPattern(n,"repeat"):"light"===t?XP=a.createPattern(n,"repeat"):eM=a.createPattern(n,"repeat")}}function nM(e,t){for(const n of e)if(vT(n,t))return!0;return!1}function rM(e,t,r){const{filteredTranscripts:a,session:o}=r,{apolloDataStore:i}=o,{featureTypeOntology:s}=i.ontologyManager;if(!s)throw new Error("featureTypeOntology is undefined");const l=s.isTypeOf(t.type,"transcript"),c=t.attributes.get("gff_id")?.toString();if(c&&a.includes(c))return;const{bp:u,refName:d,regionNumber:f,x:p}=e,{lgv:h}=r;if(l){const e=t;if(!e.children)return;const r=[],a=[];for(const t of e.children.values()){const e=s.isTypeOf(t.type,"exon"),n=s.isTypeOf(t.type,"CDS");e?r.push(t):n&&a.push(t)}const o=r.find((e=>{const[t,r]=n.intersection2(u,u+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(o){const e=sf(o,d,f,h);if(e){const t=lf(o,p,e);if(t)return t}}for(const t of e.cdsLocations)for(const e of t){const t=sf(e,d,f,h);if(t){const e=a.find((e=>{const[t,r]=n.intersection2(u,u+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(e){const n=lf(e,p,t);if(n)return n}}}}}const aM={draw:function(e,t,r,a,o){const{apolloRowHeight:i,lgv:s,session:c,theme:u,highestRow:d,filteredTranscripts:f,selectedFeature:p,showFeatureLabels:h}=a,{bpPerPx:m,displayedRegions:g,offsetPx:y}=s,v=g[o],{refName:b,reversed:_}=v,w=i,x=w,S=w,E=w,k=h?2:1,C=u.palette.text.primary,{attributes:A,children:O,min:T,strand:N}=t;if(!O)return;const{apolloDataStore:I}=c,{featureTypeOntology:R}=I.ontologyManager;if(!R)throw new Error("featureTypeOntology is undefined");const F=[],P=(s.bpToPx({refName:b,coord:T,regionNumber:o})?.offsetPx??0)-y,M=t.length/m,D=_?P-M:P,j=(1==N?3:4)*k*w;e.fillStyle=u.palette.text.primary,e.fillRect(D,j,M,E),e.fillStyle=cf(t,p)?l.alpha("rgb(0,0,0)",.7):l.alpha(u.palette.background.paper,.7),e.fillRect(D+1,j+1,M-2,E-2);const L=cf(t,p),q={x:D,y:j,h:E,text:A.get("gff_id")?.toString(),color:C,isSelected:L};L?F.unshift(q):F.push(q);const B="dark"===u.palette.mode?QP:ZP,U="dark"===u.palette.mode?eM:XP,z=_?-1:1;let G=null,H=null;N&&([G,H]=N*z==1?[B,U]:[U,B]),G&&H&&(e.fillStyle=G,e.fillRect(D+1,j+1,M-2,(E-2)/2),e.fillStyle=H,e.fillRect(D+1,j+(E-2)/2,M-2,(E-2)/2));const $=new Set;for(const[,t]of O){if(!R.isTypeOf(t.type,"transcript")&&!R.isTypeOf(t.type,"pseudogenic_transcript"))continue;const{children:r,cdsLocations:a}=t;if(!r)continue;const i=t.attributes.get("gff_id")?.toString();if(i&&f.includes(i))continue;for(const[,t]of r){if(!R.isTypeOf(t.type,"exon"))continue;const n=(s.bpToPx({refName:b,coord:t.min,regionNumber:o})?.offsetPx??0)-y,r=t.length/m,a=_?n-r:n,i=j+(E-x)/2,c=cf(t,p);if(e.fillStyle=u.palette.text.primary,e.fillRect(a,i,r,x),r>2){e.clearRect(a+1,i+1,r-2,x-2),e.fillStyle=c?"rgb(0,0,0)":l.alpha("#f5f500",.6),e.fillRect(a+1,i+1,r-2,x-2),G&&H&&(e.fillStyle=G,e.fillRect(a+1,i+1,r-2,(x-2)/2),e.fillStyle=H,e.fillRect(a+1,i+1+(x-2)/2,r-2,(x-2)/2));const n={x:a,y:i,h:x,text:t.attributes.get("gff_id")?.toString(),color:C,isSelected:c};c?F.unshift(n):F.push(n)}}const c=cf(t,p?.parent);let h=0,g=0;for(const r of a){let a=0,i=0,l=1;for(const f of r.sort(((e,t)=>e.max-t.max)))if(p&&c&&R.isTypeOf(p.type,"CDS")||!nM($,f)){const r=(f.max-f.min)/m,v=(s.bpToPx({refName:b,coord:f.min,regionNumber:o})?.offsetPx??0)-y;h=_?v-r:v,e.fillStyle=u.palette.text.primary;const x=n.getFrame(f.min,f.max,t.strand??1,f.phase);if(g=((x<0?-1*x+5:x)*k-k)*w,e.fillRect(h,g,r,S),l>1){const t=[(h-i)/2+i,Math.max(x<0?w*k*d+1:1,Math.min(a,g)-w/2)];e.strokeStyle="rgb(0, 128, 128)",e.beginPath(),e.moveTo(i,a),e.lineTo(...t),e.stroke(),e.moveTo(...t),e.lineTo(h,g+w/2),e.stroke()}if(i=h+r,a=g+w/2,l+=1,r>2){e.clearRect(h+1,g+1,r-2,S-2);const t=u.palette.framesCDS.at(x)?.main,n=t??"rgb(171,71,188)";e.fillStyle=n,e.fillStyle=p&&c&&R.isTypeOf(p.type,"CDS")?"rgb(0,0,0)":n,e.fillRect(h+1,g+1,r-2,S-2),G&&H&&(e.fillStyle=G,e.fillRect(h+1,g+1,r-2,(S-2)/2),e.fillStyle=H,e.fillRect(h+1,g+(S-2)/2,r-2,(S-2)/2))}$.add(f)}}const v={x:h,y:g,h:S,text:t.attributes.get("gff_id")?.toString(),color:C,isSelected:c};c?F.unshift(v):F.push(v)}h&&function(e,t,r="10px sans-serif"){for(let a=t.length-1;a>=0;--a){const o=t[a];e.fillStyle=o.color;const i=o.x+1,s=o.y+o.h,l=n.measureText(o.text,10);o.isSelected&&(e.font="bold ".concat(r)),o.text&&(e.clearRect(i-5,s,l+10,o.h),e.fillText(o.text,i,s+11,l),e.font=r)}}(e,F)},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:c}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-c,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o.palette.info.main,t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=l.alpha(o.palette.info.main,.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{hoveredFeature:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,highestRow:s,session:l,showFeatureLabels:c}=e;if(!r)return;const{feature:u}=r,{apolloDataStore:d}=l,{featureTypeOntology:f}=d.ontologyManager;if(!f)throw new Error("featureTypeOntology is undefined");if(!f.isTypeOf(u.type,"transcript"))return;const p=u.attributes.get("gff_id")?.toString();if(p&&o.includes(p))return;const h=e.getFeatureLayoutPosition(u);if(!h)return;const{bpPerPx:m,displayedRegions:g,offsetPx:y}=i,{layoutIndex:v}=h,b=g[v],{refName:_,reversed:w}=b,x=a,S=x,E=c?2:1,{cdsLocations:k,strand:C}=u;for(const e of k){let r=0,a=0,o=1;for(const l of e.sort(((e,t)=>e.max-t.max))){const e=(l.max-l.min)/m,c=(i.bpToPx({refName:_,coord:l.min,regionNumber:v})?.offsetPx??0)-y,u=w?c-e:c,d=n.getFrame(l.min,l.max,C??1,l.phase),f=((d<0?-1*d+5:d)*E-E)*x;if(o>1){const e=[(u-a)/2+a,Math.max(d<0?x*E*s+1:1,Math.min(r,f)-x/2)];t.strokeStyle="rgb(0, 0, 0)",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(...e),t.stroke(),t.moveTo(...e),t.lineTo(u,f+x/2),t.stroke()}a=u+e,r=f+x/2,o+=1,e>2&&(t.fillStyle="rgba(255,0,0,0.6)",t.fillRect(u,f,e,S))}}},drawTooltip:function(e,t){const{hoveredFeature:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,session:s,showFeatureLabels:c,theme:u}=e;if(!r)return;const{feature:d,bp:f}=r,{featureTypeOntology:p}=s.apolloDataStore.ontologyManager;if(!p)throw new Error("featureTypeOntology is undefined");if(!p.isTypeOf(d.type,"transcript"))return;const{attributes:h,strand:m,type:g}=d,y=e.getFeatureLayoutPosition(d);if(!y)return;const v=h.get("gff_id")?.toString();if(v&&o.includes(v))return;const{layoutIndex:b}=y,{bpPerPx:_,displayedRegions:w,offsetPx:x}=i,S=w[b],{refName:E,reversed:k}=S,C=a,A=Math.round(.7*C),O=c?2:1;let T,N="Loc: ";for(const e of d.cdsLocations)for(const t of e)if(f>=t.min&&f<=t.max){T=t;break}if(!T)return;const{max:I,min:R,phase:F}=T;N+=`${R+1}${I}`;let P=(i.bpToPx({refName:E,coord:k?I:R,regionNumber:b})?.offsetPx??0)-x;const M=n.getFrame(R,I,m??1,F),D=((M<0?-1*M+5:M)*O-O)*C+(C-A)/2,j=(I-R)/_,L=`Type: ${T.type}`,q=h.get("gff_name")?.find((e=>""!==e)),B=[t.measureText(L).width,t.measureText(N).width];q&&B.push(t.measureText(`Parent Type: ${g}`).width,t.measureText(`Parent Name: ${q}`).width);const U=Math.max(...B);P=P+j+5,t.fillStyle=l.alpha(u.palette.text.primary,.7),t.fillRect(P,D,U+4,4===B.length?55:35),t.beginPath(),t.moveTo(P,D),t.lineTo(P-5,D+5),t.lineTo(P,D+10),t.fill(),t.fillStyle=u.palette.background.default;let z=D+12;t.fillText(L,P+2,z),q&&(z+=12,t.fillText(`Parent Type: ${g}`,P+2,z),z+=12,t.fillText(`Parent Name: ${q}`,P+2,z)),z+=12,t.fillText(N,P+2,z)},getContextMenuItems:function(e,t){const{apolloInternetAccount:a,hoveredFeature:o,changeManager:i,filteredTranscripts:s,regions:l,selectedFeature:c,session:u}=e,[d]=l,f=e.getAssemblyId(d.assemblyName),p=[],h="admin"===(a?a.role:"admin");if(!o)return p;const{featureTypeOntology:m}=u.apolloDataStore.ontologyManager;if(!m)throw new Error("featureTypeOntology is undefined");if(yf(t)){const{bp:a,feature:o}=t;let l=Zd(o,a);rf(o,u)&&(l=Zd(o,a,!0));for(const a of l){const o=a.attributes.get("gff_id")?.toString();if(o&&s.includes(o))continue;const l=ff(e,a);if(nf(a,u)){const r=af(a,e,t,u),o=n.getContainingView(e);if(r.upstream){const t=r.upstream;l.push({label:"Go to upstream exon",icon:of(a.strand,!0,o.displayedRegions.at(0)?.reversed),onClick:()=>{o.navTo(pf(t,.1,o.totalBp)),ef(e,t)}})}if(r.downstream){const t=r.downstream;l.push({label:"Go to downstream exon",icon:of(a.strand,!1,o.displayedRegions.at(0)?.reversed),onClick:()=>{o.navTo(pf(t,.1,o.totalBp)),ef(e,t)}})}l.push({label:"Merge exons",disabled:!h,onClick:()=>{u.queueDialog((t=>[QT,{session:u,handleClose:()=>{t()},changeManager:i,sourceFeature:a,sourceAssemblyId:f,selectedFeature:c,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}},{label:"Split exon",disabled:!h,onClick:()=>{u.queueDialog((t=>[dN,{session:u,handleClose:()=>{t()},changeManager:i,sourceFeature:a,sourceAssemblyId:f,selectedFeature:c,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}})}m.isTypeOf(a.type,"gene")&&l.push({label:"Filter alternate transcripts",onClick:()=>{u.queueDialog((t=>[KP,{handleClose:()=>{t()},sourceFeature:a,filteredTranscripts:r.getSnapshot(s),onUpdate:t=>{e.updateFilteredTranscripts(t)}}]))}}),p.push({label:a.type,subMenu:l})}}return p},getContextMenuItemsForFeature:ff,onMouseDown:function(e,t,n){const{feature:r}=t,a=rM(t,r,e);a&&(n.stopPropagation(),e.startDrag(t,a.feature,a.edge,!0))},onMouseLeave:function(){},onMouseMove:function(e,t){if(yf(t)){const{feature:n,bp:r}=t;if(e.setHoveredFeature({feature:n,bp:r}),rM(t,n,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(!e.apolloDragging&&yf(t)){const{feature:n}=t,{session:r}=e,{apolloDataStore:a}=r,{featureTypeOntology:o}=a.ontologyManager;if(e.setSelectedFeature(n),!o)throw new Error("featureTypeOntology is undefined");let i=!1;for(const[,e]of n.children??[])if(o.isTypeOf(e.type,"CDS")||o.isTypeOf(e.type,"exon")){i=!0;break}(o.isTypeOf(n.type,"transcript")||o.isTypeOf(n.type,"pseudogenic_transcript"))&&i?e.showFeatureDetailsWidget(n,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(n)}}};function oM(e,t,r,a,o,i,s,l,c,u,d,f){const p=(u?[0,4,2,0,14,12,10]:[0,2,1,0,7,6,5]).map((e=>e*c)),h=[-1,1];for(const u of h){const h=n.getFrame(l,l+3,u,0),m=p.at(h);if(void 0===m)continue;const g=Math.round(r+a/s),y=0===Math.round(3/s)?1:Math.round(3/s),v=1===u?t:n.revcom(t),b=n.defaultCodonTable[v],_=IP(b,o,i);_&&(f&&"*"==b||d&&"*"!=b)&&(e.fillStyle=_,e.fillRect(g,m,y,c))}}function iM(e,t){return function(e,t){return function(e,t){const i=function(e,t){return function(e,t){const i=function(e,t){return o.BaseDisplay.named("BaseLinearApolloSixFrameDisplay").props({type:r.types.literal("LinearApolloSixFrameDisplay"),configuration:a.ConfigurationReference(t),graphical:!0,table:!1,showFeatureLabels:!0,showStartCodons:!1,showStopCodons:!0,showCheckResults:!0,zoomThreshold:200,heightPreConfig:r.types.maybe(r.types.refinement("displayHeight",r.types.number,(e=>e>=20))),filteredFeatureTypes:r.types.array(r.types.string)}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...S.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?500:e.graphical?e.showFeatureLabels?400:200:300},get zoomThresholdSetting(){return e.zoomThreshold??a.getConf(e,"zoomThreshold")}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=e.zoomThreshold)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=r.getRoot(e),{assemblyName:o}=t,{assemblyManager:i}=e.session,s=i.get(o);if(!s)throw new Error(`No assembly found with name ${o}`);const{internetAccountConfigId:l}=a.getConf(s,["sequence","metadata"]);return n.find((e=>a.getConf(e,"internetAccountId")===l))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature},get hoveredFeature(){return e.session.apolloHoveredFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowFeatureLabels(){e.showFeatureLabels=!e.showFeatureLabels},toggleShowStartCodons(){e.showStartCodons=!e.showStartCodons},toggleShowStopCodons(){e.showStopCodons=!e.showStopCodons},toggleShowCheckResults(){e.showCheckResults=!e.showCheckResults},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=r.cast(t)},setZoomThresholdSetting({zoomThreshold:t}){e.zoomThreshold=t}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:a}=e;return{trackMenuItems(){const{graphical:o,table:i,showFeatureLabels:s,showStartCodons:l,showStopCodons:c,showCheckResults:u}=e;return[...a(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:o&&!i,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:i&&!o,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:i&&o,onClick:()=>{e.showGraphicalAndTable()}},{label:"Feature Labels",type:"checkbox",checked:s,onClick:()=>{e.toggleShowFeatureLabels()}},{label:"Show start codons",type:"checkbox",checked:l,onClick:()=>{e.toggleShowStartCodons()}},{label:"Show stop codons",type:"checkbox",checked:c,onClick:()=>{e.toggleShowStopCodons()}},{label:"Check Results",type:"checkbox",checked:u,onClick:()=>{e.toggleShowCheckResults()}},{label:"Change zoom threshold",onClick:()=>{n.getSession(e).queueDialog((t=>[OP,{model:e,handleClose:t}]))}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((a=>[AP,{session:n,handleClose:()=>{a()},featureTypes:r.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},setHoveredFeature(t){e.session.apolloSetHoveredFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],d=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(d)},afterAttach(){r.addDisposer(e,c.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.session.apolloDataStore.loadFeatures(e.regions),e.lgv.bpPerPx<=e.zoomThreshold&&e.session.apolloDataStore.loadRefSeq(e.regions))}),{name:"LinearApolloSixFrameDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return i.named("LinearApolloSixFrameDisplayLayouts").props({featuresMinMaxLimit:5e5}).volatile((()=>({seenFeatures:c.observable.map()}))).views((e=>({get featuresMinMax(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((r=>{const a=t.get(r.assemblyName);let o,i;const{end:s,refName:l,start:c}=r;for(const[,t]of e.seenFeatures)l!==a?.getCanonicalRefName(t.refSeq)||!n.doesIntersect2(c,s,t.min,t.max)||t.length>e.featuresMinMaxLimit||(void 0===o&&({min:o}=t),void 0===i&&({max:i}=t),t.minWithChildren<o&&({min:o}=t),t.maxWithChildren>i&&({max:i}=t));if(void 0!==o&&void 0!==i)return[o,i]}))},getGlyph:e=>aM,featureLabelSpacer:t=>e.showFeatureLabels?2*t-1:t}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get geneTrackRowNums(){return[4,5].map((t=>e.featureLabelSpacer(t)))}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map(((a,o)=>{const i=t.get(a.assemblyName),s=new Map;if(!e.featuresMinMax[o])return s;const{end:l,refName:c,start:u}=a;for(const[t,a]of e.seenFeatures.entries()){if(!r.isAlive(a)){e.deleteSeenFeature(t);continue}if(c!==i?.getCanonicalRefName(a.refSeq)||!n.doesIntersect2(u,l,a.min,a.max))continue;const{featureTypeOntology:o}=e.session.apolloDataStore.ontologyManager;if(!o)throw new Error("featureTypeOntology is undefined");if(a.looksLikeGene){const t=1==a.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1];s.get(t)||s.set(t,[]);const r=s.get(t);r?.push({rowNum:t,feature:a});const{children:i}=a;if(!i)continue;for(const[,t]of i)if(o.isTypeOf(t.type,"transcript")){const{cdsLocations:r,strand:a,children:i}=t;if(i)for(const[,t]of i){if(!o.isTypeOf(t.type,"exon"))continue;const n=1==t.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1],r=s.get(n);r?.push({rowNum:n,feature:t})}for(const o of r)for(const r of o){let o=n.getFrame(r.min,r.max,a??1,r.phase);o=e.featureLabelSpacer(o<0?-1*o+5:o),s.get(o)||s.set(o,[]);const i=s.get(o);i?.push({rowNum:o,feature:t})}}}}return s}))},getFeatureLayoutPosition(e){const{featureLayouts:t}=this;for(const[n,r]of t.entries())for(const[,t]of r)for(const{feature:r}of t)if(e._id===r._id)return{layoutIndex:n,layoutRow:0,featureRow:0}}}))).views((e=>({get highestRow(){return 5}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered())for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}),{name:"LinearApolloSixFrameDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloSixFrameDisplayRendering").props({apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:120,isShown:!0,filteredTranscripts:r.types.array(r.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,theme:l.createTheme()}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight*(e.showFeatureLabels?2:1)+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setTheme(t){e.theme=t}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,d=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,d,100),t.fillStyle="black",t.fillText(n.name,u+1,11,d-2)}a++}}}}),{name:"LinearApolloSixFrameDisplayRenderCollaborators"})),r.addDisposer(e,c.autorun((()=>{const{apolloRowHeight:t,canvas:r,featureLayouts:a,featuresHeight:o,lgv:i,session:s,theme:l,showFeatureLabels:c,showStartCodons:u,showStopCodons:d}=e;if(!i.initialized||e.regionCannotBeRendered())return;const{bpPerPx:f,offsetPx:p,displayedRegions:h,dynamicBlocks:m}=i,g=r?.getContext("2d");if(g){g.clearRect(0,0,m.totalWidthPx,o);for(const[t,r]of a.entries()){const a=h[t];for(const[o,i]of r.entries())for(const{feature:r}of i){if(!r.looksLikeGene)continue;if(!n.doesIntersect2(a.start,a.end,r.min,r.max))continue;const{topLevelFeature:i}=r,s=e.getGlyph(i);void 0!==s&&s.draw(g,i,o,e,t)}}if(u||d){const{apolloDataStore:e}=s;for(const n of m.contentBlocks){const r=e.assemblies.get(n.assemblyName),a=r?.getByRefName(n.refName),o=Math.floor(n.start),i=Math.ceil(n.end);let s=a?.getSequence(o,i);if(!s)break;s=s.toUpperCase();const h=Math.round(n.offsetPx-p-(n.start-o)/f);for(let e=0;e<s.length;e++){const n=o+e;oM(g,s.slice(e,e+3),h,e,l,!0,f,n,t,c,u,d)}}}}}),{name:"LinearApolloSixFrameDisplayRenderFeatures"}))}})))}(0,t);return i.named("LinearApolloSixFrameDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0}))).views((e=>({getMousePosition(t){const r=vf(t,e.lgv),{bp:a,regionNumber:o,y:i}=r,s=Math.floor(i/e.apolloRowHeight)+1,l=e.featureLayouts[o].get(s);if(!l)return r;const{featureTypeOntology:c}=e.session.apolloDataStore.ontologyManager;if(!c)throw new Error("featureTypeOntology is undefined");let u;if(e.geneTrackRowNums.includes(s)?(u=l.find((e=>"exon"==e.feature.type&&a>=e.feature.min&&a<=e.feature.max)),u||(u=l.find((e=>a>=e.feature.min&&a<=e.feature.max)))):u=l.find((t=>{const{feature:r}=t,o=r.attributes.get("gff_id")?.toString();if(!c.isTypeOf(r.type,"transcript"))return!1;for(const t of r.cdsLocations)for(const i of t){let t=n.getFrame(i.min,i.max,r.strand??1,i.phase);if(t=e.featureLabelSpacer(t<0?-1*t+5:t),s===t&&a>=i.min&&a<=i.max)return void 0===o||!e.filteredTranscripts.includes(o)}return!1})),!u)return r;const{feature:d}=u;return{...r,feature:d}}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(t){e.filteredTranscripts=r.cast(t)}}))).actions((()=>({onClick(){}})))}(0,t).views((e=>({contextMenuItems(t){const{hoveredFeature:n}=e;if(!n)return[];const r=e.getMousePosition(t),{topLevelFeature:a}=n.feature,o=e.getGlyph(a);return yf(r)?o.getContextMenuItems(e,r):[]}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=gf(r,t.bp,n,o),c="max"===n?new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);yf(n)&&e.getGlyph(n.feature).onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);yf(n)?e.getGlyph(n.feature).onMouseMove(e,n,t):(e.setHoveredFeature(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setHoveredFeature();const n=e.getMousePosition(t);yf(n)&&e.getGlyph(n.feature).onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);yf(n)?e.getGlyph(n.feature).onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){r.addDisposer(e,c.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,hoveredFeature:r}=e;if(!r)return;const a=e.getGlyph(r.feature);a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloSixFrameDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:r.types.optional(VF,{})}).named("LinearApolloSixFrameDisplay")}const sM=a.ConfigurationSchema("ApolloPlugin",{ontologies:r.types.array(OT),featureTypeOntologyName:{description:"Name of the feature type ontology",type:"string",defaultValue:"Sequence Ontology"},hasRole:{description:"Flag used internally by jbrowse-plugin-apollo",type:"boolean",defaultValue:!1},geneBackgroundColor:{description:"Color for feature background",type:"string",defaultValue:"jexl:geneBackgroundColor(featureType)",contextVariable:["featureType"]}}),lM=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogene")||n.isTypeOf(e.type,"pseudogenic_transcript")},cM=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"pseudogene")},uM=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")};function dM(e){const{attributes:t}=e,n=["gene_name","gene_id","gene_stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}const fM=e=>{const t=function(e){const{attributes:t}=e,n=["name","gff_name","transcript_name","gene_name"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e),n=function(e){const{attributes:t}=e,n=["id","gff_id","transcript_id","gene_id","gene_stable_id","stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e);return t?`${e.type} - ${t}`:n?`${e.type} - ${n}`:e.type};function pM({annotationFeature:e,assembly:t,handleClose:n,refSeqId:a,session:o,region:i}){const s=o,{featureTypeOntology:c}=s.apolloDataStore.ontologyManager,d=u.useMemo((()=>Object.keys(e.children??{})),[e]),[f,p]=u.useState(!0),[h,m]=u.useState(d),[g,y]=u.useState(""),[v,b]=u.useState([]),[_,w]=u.useState(!1),[x,S]=u.useState(),E=s.apolloDataStore.assemblies.get(t.name),k=E?.refSeqs.get(a),C=k?.getFeatures(i.start,i.end),A=()=>{const e=[];for(const t of C??[])if(!(t.min>i.end||t.max<i.start)&&c?.isTypeOf(t.type,"gene")){const n=r.getSnapshot(t);e.push(n)}return e};u.useEffect((()=>{y("");const e=A();b(e),S(e[0])}),[h,f,i]);const O=async e=>{if(x)for(const n of Object.keys(e)){const r=e[n];if(r.strand=x.strand,r.children)for(const e of Object.keys(r.children))r.children[e].strand=x.strand;const a=new Xn.AddFeatureChange({parentFeatureId:x._id,changedIds:[x._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:r});await R(a,n)}},N=async n=>{const r=(new Hn).toHexString(),o=Math.min(...Object.values(n).map((e=>e.min))),i=Math.max(...Object.values(n).map((e=>e.max))),s=new Xn.AddFeatureChange({changedIds:[r],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{_id:r,refSeq:a,min:o,max:i,strand:e.strand,type:"gene",children:n,attributes:{name:[dM(e)],gene_name:[dM(e)]}}});await R(s,r)},I=async(e,n)=>{if(!x)return;const r=[];e!==x.min&&r.push(new Xn.LocationStartChange({typeName:"LocationStartChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldStart:x.min,newStart:e})),n!==x.max&&r.push(new Xn.LocationEndChange({typeName:"LocationEndChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldEnd:x.max,newEnd:n}));for(const e of r)await R(e)},R=async(e,t)=>{await s.apolloDataStore.changeManager.submit(e).then((()=>{s.apolloSetSelectedFeature(t)}))};return T.default.createElement(xf,{open:!0,title:"Create Apollo Annotation",handleClose:n,fullWidth:!0,maxWidth:"sm"},T.default.createElement(l.DialogTitle,{fontSize:15},"Select the feature to be copied to apollo track"),T.default.createElement(l.DialogContent,null,T.default.createElement(l.Box,{sx:{ml:3}},lM(e,s)&&T.default.createElement(l.FormControlLabel,{control:T.default.createElement(l.Checkbox,{size:"small",checked:f,onChange:e=>{const t=e.target.checked;p(t),m(t?d:[])}}),label:`${fM(e)} (${e.min+1}..${e.max})`}),e.children&&T.default.createElement(l.Box,{sx:{display:"flex",flexDirection:"column",ml:3}},Object.values(e.children).filter((e=>uM(e,s))).map((e=>T.default.createElement(l.FormControlLabel,{key:e._id,control:T.default.createElement(l.Checkbox,{size:"small",checked:h.includes(e._id),onChange:t=>{((e,t)=>{m((n=>e.target.checked?[...n,t._id]:n.filter((e=>e!==t._id))))})(t,e)}}),label:`${fM(e)} (${e.min+1}..${e.max})`}))))),v.length>0&&(!f&&h.length>0||f&&uM(e,s))&&T.default.createElement("div",{style:{border:"1px solid #ccc",marginTop:20,padding:10,borderRadius:5}},T.default.createElement(l.Box,{sx:{ml:3}},T.default.createElement(l.Typography,{variant:"caption",fontSize:12},"Select the destination feature to copy the selected features"),T.default.createElement(l.Box,{sx:{mt:1}},T.default.createElement(l.Select,{labelId:"label",style:{width:"100%"},value:x?._id??"",onChange:e=>{const t=v.find((t=>t._id===e.target.value));S(t)},disabled:_},v.map((e=>T.default.createElement(l.MenuItem,{key:e._id,value:e._id},`${fM(e)} (${e.min+1}..${e.max})`)))))),T.default.createElement(l.Box,{sx:{ml:3}},T.default.createElement(l.FormGroup,null,T.default.createElement(l.FormControlLabel,{control:T.default.createElement(l.Checkbox,{checked:_,onChange:e=>{w(e.target.checked)}}),label:"Create new gene"}))))),T.default.createElement(l.DialogActions,null,T.default.createElement(l.Button,{variant:"contained",type:"submit",disabled:0===h.length||!f&&h.length>0&&!x,onClick:async()=>{if(f){if(cM(e,s)&&(await(async()=>{let n;if(e.children&&h.length!==Object.values(e.children).length){const r={};for(const t of h)r[t]=e.children[t];n=new Xn.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{...e,children:r}})}else n=new Xn.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:e});await R(n,e._id)})(),o.notify("Successfully copied selected gene and transcript(s)","success")),uM(e,s))if(x&&!_){const t={};if(t[e._id]=e,x.max<e.max||x.min>e.min){const n=Math.min(x.min,e.min),r=Math.max(x.max,e.max);await I(n,r),await O(t)}else await O(t);o.notify("Successfully copied selected transcripts to destination gene","success")}else{const t={};t[e._id]=e,await N(t),o.notify("Successfully created a new gene with selected transcripts","success")}}else{if(!e.children)return;if(x&&!_){const t={};for(const n of h)t[n]=e.children[n];const n=Math.min(...Object.values(t).map((e=>e.min))),r=Math.max(...Object.values(t).map((e=>e.max)));if(x.min>n||x.max<r){const e=Math.min(x.min,n),a=Math.max(x.max,r);await I(e,a),await O(t)}else await O(t);o.notify("Successfully copied transcript to destination gene","success")}else{const t={};for(const n of h)t[n]=e.children[n];await N(t),o.notify("Successfully created a new gene with selected transcript","success")}}n()}},"Create"),T.default.createElement(l.Button,{variant:"outlined",type:"submit",onClick:n},"Cancel")),g?T.default.createElement(l.DialogContent,null,T.default.createElement(l.DialogContentText,{color:"error"},g)):null)}function hM(e){if("LinearPileupDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(){const t=e.contextMenuFeature,n=e.getAssembly(),r=e.getRefSeqId(n),a=t.get("start"),o=t.get("end"),i=t.get("strand"),s=t.get("name"),l=function(e){const t=/(\d+)([MIDNSHPX=])/g,n=[];let r;for(;null!==(r=t.exec(e));)n.push([r[2],Number.parseInt(r[1],10)]);return n}(t.get("CIGAR"));let c,u=a;const d=[];for(const[e,t]of l)switch(e){case"M":case"=":case"X":void 0===c&&(c=u),u+=t;break;case"N":void 0!==c&&(d.push({start:c,end:u}),c=void 0),u+=t;break;case"D":u+=t;break;case"I":case"S":case"H":case"P":break;default:throw new Error(`Unknown CIGAR operation: ${e}`)}void 0!==c&&d.push({start:c,end:u});const f={_id:Hn().toHexString(),refSeq:r,min:a,max:o,type:"mRNA",strand:i,attributes:{name:[s]}};if(0===d.length)return f;f.children={};for(const e of d){const t={_id:Hn().toHexString(),refSeq:r,min:e.start,max:e.end,type:"exon",strand:i};f.children[t._id]=t}return f}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:Uc,onClick:()=>{r.queueDialog((t=>[pM,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}function mM(e,t){const n=JSON.parse(JSON.stringify(e)),r=n.subfeatures;return[{start:n.start+1,end:n.end,seq_id:t,source:n.source??null,type:n.type??null,score:n.score??null,strand:n.strand?1===n.strand?"+":"-":null,phase:null!==n.phase||void 0!==n.phase?n.phase:null,attributes:yM(n),derived_features:[],child_features:r?r.map((e=>mM(e,t))):[]}]}function gM(e,t){return Xn.gff3ToAnnotationFeature(mM(e,t))}function yM(e){const t={},n=new Set(["start","end","type","strand","refName","subfeatures","derived_features","phase","source","score"]);for(const[r,a]of Object.entries(e))n.has(r)||(t[r]=Array.isArray(a)?a.map(String):[String(a)]);return t}function vM(e){if("LinearBasicDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(t){const n=e.getRefSeqId(t);return gM(e.contextMenuFeature.data,n)}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:Uc,onClick:()=>{r.queueDialog((t=>[pM,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}var bM=s.createSvgIcon(i.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),_M=s.createSvgIcon(i.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"}),"Lock"),wM=s.createSvgIcon(i.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error");const xM=h.observer((function({display:e}){const{classes:t}=TP(),{apolloDragging:r,apolloRowHeight:a,lgv:o,session:i,showCheckResults:s}=e,{assemblyManager:c}=i;return s?o.dynamicBlocks.contentBlocks.map((s=>{const u=o.bpPerPx*a,d=c.get(s.assemblyName);return d?NP([...i.apolloDataStore.checkResults.values()].filter((e=>d.isValidRefName(e.refSeq)&&d.getCanonicalRefName(e.refSeq)===s.refName&&n.doesIntersect2(s.start,s.end,e.start,e.end))),u,!0).map((n=>{const o=Math.round(function(e,t,n){const{lgv:r}=e,{bpPerPx:a,offsetPx:o}=r;return n.offsetPx-o+(n.reversed?n.end-t.max:t.min-n.start)/a}(e,n.range,s)),[i]=n.featureIds;if(!i)return null;let c=0;const u=e.getFeatureLayoutPosition(i);return u&&(c=u.layoutRow+u.featureRow),T.default.createElement(l.Tooltip,{key:n._id,title:n.message},T.default.createElement(l.Box,{className:t.box,style:{top:c*a,left:o,height:a,width:a,pointerEvents:r?"none":"auto"}},T.default.createElement(l.Badge,{className:t.badge,badgeContent:n.count,color:"primary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},invisible:n.count<=1},T.default.createElement(l.Avatar,{className:t.avatar},T.default.createElement(wM,{"data-testid":`ErrorIcon-${n.start}`})))))})):null})):null})),SM=h.observer((function(e){const t=l.useTheme(),{model:r}=e,{loading:a,contextMenuItems:o,cursor:i,featuresHeight:s,isShown:c,onMouseDown:d,onMouseLeave:f,onMouseMove:h,onMouseUp:m,regionCannotBeRendered:g,session:y,setCanvas:v,setCollaboratorCanvas:b,setOverlayCanvas:_,setTheme:w}=r,{classes:x}=TP(),S=n.getContainingView(r);u.useEffect((()=>{w(t)}),[t,w]);const[E,k]=u.useState(),[C,A]=u.useState([]),O=g();return c?T.default.createElement(T.default.Fragment,null,T.default.createElement("div",{className:x.canvasContainer,style:{width:S.dynamicBlocks.totalWidthPx,height:s},onContextMenu:e=>{e.preventDefault(),C.length>0?A([]):(k([e.clientX,e.clientY]),A(o(e)))}},y.isLocked?T.default.createElement("div",{className:x.locked,"data-testid":"lock-icon"},T.default.createElement(_M,null)):null,a?T.default.createElement("div",{className:x.loading},T.default.createElement(l.CircularProgress,{size:"18px"})):null,O?T.default.createElement(l.Alert,{severity:"warning",classes:{message:x.ellipses},slotProps:{root:{className:x.center}}},T.default.createElement(l.Tooltip,{title:O},T.default.createElement("div",null,O))):T.default.createElement(T.default.Fragment,null,T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),b(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"collaboratorCanvas"}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),v(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"canvas"}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),_(e)},width:S.dynamicBlocks.totalWidthPx,height:s,onMouseMove:h,onMouseLeave:f,onMouseDown:d,onMouseUp:m,className:x.canvas,style:{cursor:i??"default"},"data-testid":"overlayCanvas"}),T.default.createElement(xM,{display:r}),T.default.createElement(p.Menu,{open:C.length>0,onMenuItemClick:(e,t)=>{t(),A([])},onClose:()=>{A([])},slotProps:{transition:{onExit:()=>{A([])}}},anchorReference:"anchorPosition",anchorPosition:E?{top:E[1],left:E[0]}:void 0,style:{zIndex:t.zIndex.tooltip},menuItems:C})))):null})),EM=h.observer((function({model:e,hrStyle:t={margin:0,top:0,color:"black"},idx:n=0}){const{apolloRowHeight:r,highestRow:a,showFeatureLabels:o}=e,i=o?2:1;return T.default.createElement("div",{style:{position:"absolute",left:0,top:r*i*(a+1)/2+n*i*r,width:"100%"}},T.default.createElement("hr",{style:t}))})),kM=h.observer((function(e,t){const r=l.useTheme(),{model:a}=e,{apolloRowHeight:o,contextMenuItems:i,cursor:s,featuresHeight:c,featureLabelSpacer:d,geneTrackRowNums:f,isShown:h,onMouseDown:m,onMouseLeave:g,onMouseMove:y,onMouseUp:v,regionCannotBeRendered:b,session:_,setCanvas:w,setCollaboratorCanvas:x,setOverlayCanvas:S,setTheme:E,showCheckResults:k}=a,{classes:C}=TP(),A=n.getContainingView(a);u.useEffect((()=>{E(r)}),[r,E]);const[O,N]=u.useState(),[I,R]=u.useState([]),F=b();if(!h)return null;const{assemblyManager:P}=_;return T.default.createElement(T.default.Fragment,null,T.default.createElement("div",{className:C.canvasContainer,style:{width:A.dynamicBlocks.totalWidthPx,height:c},onContextMenu:e=>{e.preventDefault(),I.length>0?R([]):(N([e.clientX,e.clientY]),R(i(e)))}},_.isLocked?T.default.createElement("div",{className:C.locked,"data-testid":"lock-icon"},T.default.createElement(_M,null)):null,F?T.default.createElement(l.Alert,{severity:"warning",classes:{message:C.ellipses},slotProps:{root:{className:C.center}}},T.default.createElement(l.Tooltip,{title:F},T.default.createElement("div",null,F))):T.default.createElement(T.default.Fragment,null,T.default.createElement(EM,{model:a,idx:0}),T.default.createElement(EM,{model:a,hrStyle:{margin:0,top:0,color:"grey",opacity:.4},idx:1}),T.default.createElement(EM,{model:a,idx:2}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),x(e)},width:A.dynamicBlocks.totalWidthPx,height:c,className:C.canvas,"data-testid":"collaboratorCanvas"}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),w(e)},width:A.dynamicBlocks.totalWidthPx,height:c,className:C.canvas,"data-testid":"canvas"}),T.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),S(e)},width:A.dynamicBlocks.totalWidthPx,height:c,onMouseMove:y,onMouseLeave:g,onMouseDown:m,onMouseUp:v,className:C.canvas,style:{cursor:s??"default"},"data-testid":"overlayCanvas"}),A.displayedRegions.flatMap(((e,r)=>{const a=A.bpPerPx*o,i=P.get(e.assemblyName);return k?NP([..._.apolloDataStore.checkResults.values()].filter((t=>i?.isValidRefName(t.refSeq)&&i.getCanonicalRefName(t.refSeq)===e.refName&&n.doesIntersect2(e.start,e.end,t.start,t.end))),a,!0).map((a=>{const i=(A.bpToPx({refName:e.refName,coord:a.start,regionNumber:r})?.offsetPx??0)-A.offsetPx,[s]=a.featureIds;if(!s||!s.parent?.looksLikeGene)return null;let c;for(const e of s.cdsLocations)for(const t of e){let e=n.getFrame(t.min,t.max,s.strand??1,t.phase);if(e=d(e<0?-1*e+5:e),a.start>=t.min&&a.start<=t.max){c=e-1;break}}return void 0===c&&(c=(1==s.strand?f[0]:f[1])-1),T.default.createElement(l.Tooltip,{key:a._id,title:a.message},T.default.createElement(l.Box,{className:C.box,style:{top:c*o,left:i,height:o,width:o,pointerEvents:t?"none":"auto"}},T.default.createElement(l.Badge,{className:C.badge,badgeContent:a.count,color:"primary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},invisible:a.count<=1},T.default.createElement(l.Avatar,{className:C.avatar},T.default.createElement(wM,{"data-testid":`ErrorIcon-${a.start}`})))))})):null})),T.default.createElement(p.Menu,{open:I.length>0,onMenuItemClick:(e,t)=>{t(),R([])},onClose:()=>{R([])},slotProps:{transition:{onExit:()=>{R([])}}},anchorReference:"anchorPosition",anchorPosition:O?{top:O[1],left:O[0]}:void 0,style:{zIndex:r.zIndex.tooltip},menuItems:I}))))})),CM=d.makeStyles()((e=>({shading:{background:l.alpha(e.palette.primary.main,.2),overflowX:"hidden"},details:{background:e.palette.background.paper},accordionControl:{height:12,width:"100%","&:hover":{background:e.palette.action.hover},display:"flex",alignItems:"center",justifyContent:"center"},accordionRoot:{background:e.palette.divider},resizeHandle:{width:"100%",height:4,position:"absolute",cursor:"row-resize",zIndex:100},expandIcon:{},title:{userSelect:"none"},alertContainer:{display:"flex",alignItems:"center",justifyContent:"center"}})));function AM(e,t){const{apolloRowHeight:n,selectedFeature:r}=e;if(t.current&&r){const a=e.getFeatureLayoutPosition(r);a&&t.current.scroll({top:(a.layoutRow+a.featureRow)*n,behavior:"smooth"})}}const OM=({onResize:e})=>{const{classes:t}=CM(),n=u.useCallback((t=>{t.stopPropagation(),t.preventDefault(),e(t.movementY)}),[e]);return T.default.createElement("div",{onMouseDown:e=>{e.stopPropagation();const t=new AbortController,{signal:r}=t;function a(){t.abort("makeDisplayComponent")}globalThis.addEventListener("mousemove",n,{signal:r}),globalThis.addEventListener("mouseup",a,{signal:r}),globalThis.addEventListener("mouseleave",a,{signal:r})},onClick:e=>{e.stopPropagation(),e.preventDefault()},className:t.resizeHandle})},TM=h.observer((function({onClick:e,onResize:t,open:n,title:r}){const{classes:a}=CM();return T.default.createElement("div",{className:a.accordionRoot},n&&t?T.default.createElement(OM,{onResize:t}):null,T.default.createElement("div",{className:a.accordionControl,onClick:e},T.default.createElement(n?bM:BN,{className:a.expandIcon}),r?T.default.createElement(l.Typography,{className:a.title,variant:"caption",component:"span"},r):null))})),NM=h.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=CM(),{graphical:c,height:d,isShown:f,selectedFeature:p,table:h,tabularEditor:m,toggleShown:g}=e,y=u.useRef(null);u.useEffect((()=>{AM(e,y)}),[e,p]);const v=t=>{e.setDetailsHeight(e.detailsHeight-t)};if(!i)return T.default.createElement("div",{className:s.alertContainer},T.default.createElement(l.Alert,{severity:"error"},"Could not load feature type ontology."));if(c&&h){const n=m.isShown?e.detailsHeight:0,r=f?d-e.detailsHeight-24:0;return T.default.createElement("div",{style:{height:d}},T.default.createElement(TM,{open:f,title:"Graphical",onClick:g}),T.default.createElement("div",{className:s.shading,ref:y,style:{height:r}},T.default.createElement(SM,{model:e,...t})),T.default.createElement(TM,{title:"Table",open:m.isShown,onClick:m.togglePane,onResize:v}),T.default.createElement("div",{className:s.details,style:{height:n}},T.default.createElement($F,{model:e})))}return c?T.default.createElement("div",{className:s.shading,ref:y,style:{height:d}},T.default.createElement(SM,{model:e,...t})):T.default.createElement("div",{className:s.details,style:{height:d}},T.default.createElement($F,{model:e}))})),IM=h.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=CM(),{detailsHeight:c,graphical:d,height:f,isShown:p,selectedFeature:h,table:m,tabularEditor:g,toggleShown:y}=e,v=u.useRef(null);u.useEffect((()=>{AM(e,v)}),[e,h]);const b=t=>{e.setDetailsHeight(c-t)};if(!i)return T.default.createElement("div",{className:s.alertContainer},T.default.createElement(l.Alert,{severity:"error"},"Could not load feature type ontology."));if(d&&m){const n=g.isShown?c:0,r=p?f-c-24:0;return T.default.createElement("div",{style:{height:f}},T.default.createElement(TM,{open:p,title:"Graphical",onClick:y}),T.default.createElement("div",{className:s.shading,ref:v,style:{height:r}},T.default.createElement(kM,{model:e,...t})),T.default.createElement(TM,{title:"Table",open:g.isShown,onClick:g.togglePane,onResize:b}),T.default.createElement("div",{className:s.details,style:{height:n}},T.default.createElement($F,{model:e})))}return d?T.default.createElement("div",{className:s.shading,ref:v,style:{height:f}},T.default.createElement(kM,{model:e,...t})):T.default.createElement("div",{className:s.details,style:{height:f}},T.default.createElement($F,{model:e}))}));var RM=s.createSvgIcon(i.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),FM=s.createSvgIcon(i.jsx("path",{fillRule:"evenodd",d:"M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M10 17H5v-2h5zm0-4H5v-2h5zm0-4H5V7h5zm4.82 6L12 12.16l1.41-1.41 1.41 1.42L17.99 9l1.42 1.42z"}),"FactCheck"),PM=s.createSvgIcon(i.jsx("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H15v-8h5V8zm-1 7V3.5L18.5 9zm4 12.66V16h5.66v2h-2.24l2.95 2.95-1.41 1.41L19 19.41v2.24h-2z"}),"FileOpen"),MM=s.createSvgIcon(i.jsx("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),DM=s.createSvgIcon(i.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo"),jM=s.createSvgIcon(i.jsx("path",{d:"m19.07 4.93-1.41 1.41C19.1 7.79 20 9.79 20 12c0 4.42-3.58 8-8 8s-8-3.58-8-8c0-4.08 3.05-7.44 7-7.93v2.02C8.16 6.57 6 9.03 6 12c0 3.31 2.69 6 6 6s6-2.69 6-6c0-1.66-.67-3.16-1.76-4.24l-1.41 1.41C15.55 9.9 16 10.9 16 12c0 2.21-1.79 4-4 4s-4-1.79-4-4c0-1.86 1.28-3.41 3-3.86v2.14c-.6.35-1 .98-1 1.72 0 1.1.9 2 2 2s2-.9 2-2c0-.74-.4-1.38-1-1.72V2h-1C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-2.76-1.12-5.26-2.93-7.07"}),"TrackChanges"),LM=s.createSvgIcon(i.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),qM=s.createSvgIcon(i.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");const BM=r.types.model("JobsManager",{}).views((e=>({get jobStatusWidget(){const{widgets:t}=n.getSession(e);let r=t.get("JobsList");return r||(r=n.getSession(e).addWidget("JobsListWidget","JobsList")),r}}))).actions((e=>({update(t,n,r){e.jobStatusWidget.updateJobStatusMessage(t,n),r&&e.jobStatusWidget.updateJobProgressPct(t,r)},abortJob(t,r){const a=n.getSession(e);if(n.isSessionModelWithWidgets(a)){a.showWidget(e.jobStatusWidget),e.jobStatusWidget.updateJobStatusMessage(t,r??"Aborted unexpectedly");const n=e.jobStatusWidget.jobs.findIndex((e=>e.name===t));e.jobStatusWidget.addAbortedJob({...e.jobStatusWidget.jobs[n]}),e.jobStatusWidget.removeJob(t),a.notify("Job aborted","info")}},runJob(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.addJob(t))},done(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.removeJob(t.name),e.jobStatusWidget.addFinishedJob({name:t.name,statusMessage:"All operations successful",progressPct:100,cancelCallback:t.cancelCallback}))}})));function UM(e,t){const o=e.evaluateExtensionPoint("Apollo-extendAnnotationFeature",sI.AnnotationFeatureModel),i=function(e){return r.types.model("ClientDataStore",{typeName:r.types.optional(r.types.literal("Client"),"Client"),assemblies:r.types.map(sI.ApolloAssembly),checkResults:r.types.map(sI.CheckResult),ontologyManager:r.types.optional(CT,{})}).views((t=>({get internetAccounts(){return r.getRoot(t).internetAccounts},get pluginConfiguration(){return r.getRoot(t).jbrowse.configuration.ApolloPlugin},getFeature:n=>r.resolveIdentifier(e,t.assemblies,n)}))).actions((e=>({addAssembly(t,n){const r={_id:t,refSeqs:{}};return n&&(r.backendDriverType=n),e.assemblies.put(r)}}))).actions((e=>({addFeature(t,r){const a=n.getSession(e),{assemblyManager:o}=a;let i=e.assemblies.get(t);if(!i){if(!o.get(t))throw new Error(`Could not find assembly "${t}" to add feature "${r._id}"`);i=e.addAssembly(t)}let s=i.refSeqs.get(r.refSeq);if(!s){const e=o.get(t);if(!e)throw new Error(`Could not find assembly "${t}" to add feature "${r._id}"`);const n=e.getCanonicalRefName(r.refSeq);if(!n)throw new Error(`Could not find refSeq "${r.refSeq}" to add feature "${r._id}"`);s=i.addRefSeq(r.refSeq,n)}s.features.put(r)},deleteFeature(t){const n=e.getFeature(t);if(!n)throw new Error(`Could not find feature "${t}" to delete`);const{_id:a,parent:o}=n;o?o.deleteChild(t):r.getParentOfType(n,sI.ApolloRefSeq).deleteFeature(a)},deleteAssembly(t){e.assemblies.delete(t)},addCheckResult(t){e.checkResults.put(t)},addCheckResults(t){for(const n of t)e.checkResults.has(n._id)||e.checkResults.put(n)},deleteCheckResult(t){e.checkResults.delete(t)},clearCheckResults(){e.checkResults.clear()}}))).volatile((e=>({changeManager:new MT(e),collaborationServerDriver:new DT(e),inMemoryFileDriver:new jT(e),desktopFileDriver:n.isElectron?new LT(e):void 0}))).actions((e=>({afterCreate(){r.addDisposer(e,c.autorun((()=>{const{ontologyManager:t,pluginConfiguration:r}=e,o=r.ontologies;for(const r of o||[]){const[o,i,s,l]=[a.readConfObject(r,"name"),a.readConfObject(r,"version"),a.readConfObject(r,"source"),a.readConfObject(r,"textIndexFields")];if(!t.findOntology(o)){const r=n.getSession(e),{jobsManager:a}=r,c=new AbortController,u=`Loading ontology "${o}"`,d={name:u,statusMessage:`Loading ontology "${o}", version "${i}", this may take a while`,progressPct:0,cancelCallback:()=>{c.abort("ClientDataStore"),a.abortJob(d.name)}};t.addOntology(o,i,s,{textIndexing:{indexFields:l},update:(e,t)=>{0!==t?100!==t?a.update(u,e,t):a.done(d):a.runJob(d)}})}}})))}}))).views((e=>({getBackendDriver(t){const r=n.getSession(e),{assemblyManager:o}=r,i=o.get(t);if(!i)return;const{file:s,internetAccountConfigId:l}=a.getConf(i,["sequence","metadata"]);return n.isElectron&&s?e.desktopFileDriver:l?e.collaborationServerDriver:e.inMemoryFileDriver},getInternetAccount(t,r){if(!(t??r))throw new Error("Must provide either assemblyName or internetAccountId");let o=r;if(t&&!o){const{assemblyManager:r}=n.getSession(e),i=r.get(t);if(!i)throw new Error(`No assembly found with name ${t}`);({internetAccountConfigId:o}=a.getConf(i,["sequence","metadata"]))}const{internetAccounts:i}=e,s=i.find((e=>e.internetAccountId===o));if(!s)throw new Error(`No InternetAccount found with config id ${r}`);return s}}))).actions((e=>({loadFeatures:r.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const[r,a]=yield t.getFeatures(n);if(0===r.length)continue;const{assemblyName:o,refName:i}=n;let s=e.assemblies.get(o);s||(s=e.assemblies.put({_id:o,refSeqs:{}}));const[l]=r;let c=s.refSeqs.get(l.refSeq);c||(c=s.refSeqs.put({_id:l.refSeq,name:i,features:{}}));for(const e of r)c.features.has(e._id)||c.features.put(e);e.addCheckResults(a)}})),loadRefSeq:r.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const{refSeq:r,seq:a}=yield t.getSequence(n),{assemblyName:o,end:i,refName:s,start:l}=n;let c=e.assemblies.get(o);c||(c=e.assemblies.put({_id:o,refSeqs:{}}));let u=c.refSeqs.get(r);u||(u=c.refSeqs.put({_id:r,name:s,sequence:[]})),u.addSequence({start:l,stop:i,sequence:a})}}))})))}(o),s=t.props({apolloDataStore:r.types.optional(i,{typeName:"Client"}),apolloSelectedFeature:r.types.safeReference(o),jobsManager:r.types.optional(BM,{}),isLocked:r.types.optional(r.types.boolean,!1),changeInProgress:r.types.optional(r.types.boolean,!1)}).volatile((()=>({apolloHoveredFeature:void 0,abortController:new AbortController}))).extend((()=>{const e=c.observable.array([]);return{views:{get collaborators(){return e}},actions:{addOrUpdateCollaborator(t){const n=e.find((e=>e.id===t.id));n?n.locations=t.locations:e.push(t)}}}})).actions((e=>({apolloSetSelectedFeature(t){e.apolloSelectedFeature=t},apolloSetHoveredFeature(t){e.apolloHoveredFeature=t},addApolloTrackConfig(t,n){const r=`apollo_track_${t.name}`;e.tracks.some((e=>e.trackId===r))||e.addTrackConf({type:"ApolloTrack",trackId:r,name:`Annotations (${a.getConf(t,"displayName")||t.name})`,assemblyNames:[t.name],textSearching:{textSearchAdapter:{type:"ApolloTextSearchAdapter",trackId:r,assemblyNames:[t.name],textSearchAdapterId:`apollo_search_${t.name}`,...n?{baseURL:{uri:n,locationType:"UriLocation"}}:{}}}})},toggleLocked(){e.isLocked=!e.isLocked},setChangeInProgress(t){e.changeInProgress=t},getPluginConfiguration(){const{jbrowse:t}=r.getRoot(e);return t.configuration.ApolloPlugin},broadcastLocations(){const{internetAccounts:t}=r.getRoot(e),n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;for(const r of t.contentBlocks){const{assemblyName:t,end:a,refName:o,start:i}=r,s=e.apolloDataStore.assemblies.get(t);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:t,refName:o,start:i,end:a})}}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const a=[];for(const e of t)if("baseURL"in e){for(const e of n)a.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(a)}}}))).volatile((e=>({previousSnapshot:r.getSnapshot(e)}))).actions((e=>({afterCreate(){r.applySnapshot(e,{name:e.name,id:e.id});const{internetAccounts:t,jbrowse:n,reloadPluginManagerCallback:o}=r.getRoot(e);r.addDisposer(e,c.autorun((()=>{const n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;for(const r of t.contentBlocks){const{assemblyName:t,end:a,refName:o,start:i}=r,s=e.apolloDataStore.assemblies.get(t);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:t,refName:o,start:i,end:a})}}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const r=[];for(const e of t)if("baseURL"in e){for(const e of n)r.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(r)}}),{name:"ApolloSessionBroadcastLocations"})),r.addDisposer(e,c.autorun((async i=>{if(a.readConfObject(n.configuration.ApolloPlugin,"hasRole"))return r.applySnapshot(e,e.previousSnapshot),void i.dispose();const{signal:s}=e.abortController;for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const{baseURL:t}=n,r=new URL("jbrowse/config.json",t).href,a=n.getFetcher({locationType:"UriLocation",uri:r});let l,c;try{l=await a(r,{signal:s})}catch(t){e.abortController.signal.aborted||console.error(t);continue}if(l.ok){try{c=await l.json()}catch(e){console.error(e);continue}o(c,e.previousSnapshot),i.dispose()}else{const e=await bf(l,"Failed to fetch assemblies");console.error(e)}}}),{name:"ApolloSessionLoadConfig"}))},beforeDestroy(){e.abortController.abort("destroying session model")}}))).views((e=>{const t=e.getTrackActionMenuItems;return{getTrackActionMenuItems(n){if("ApolloTrack"===n.type||"ReferenceSequenceTrack"===n.type)return t?.(n);const o=a.readConfObject(n,"trackId");return o.endsWith("-sessionTrack")?[...t?.(n)??[],{label:"Save track to Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:a}=r.getRoot(e),i=r.getSnapshot(a);let s;s=Xn.filterJBrowseConfig(i),0===Object.keys(s).length&&(s=void 0);const l={...r.getSnapshot(n),trackId:o.slice(0,o.length-13)};for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new Xn.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:s,newJBrowseConfig:{...s,tracks:s?.tracks&&[...s.tracks,l]}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track added","success")}e.deleteTrackConf(n),a.addTrackConf(l)},icon:qM}]:[...t?.(n)??[],{label:"Remove track from Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:a}=r.getRoot(e),i=r.getSnapshot(a);let s;s=Xn.filterJBrowseConfig(i),0===Object.keys(s).length&&(s=void 0);const l=s?.tracks?.filter((e=>e.trackId!==o));for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new Xn.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:s,newJBrowseConfig:{...s,tracks:l}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track removed","success")}e.deleteTrackConf(n),a.deleteTrackConf(n)},icon:qM}]}}}));return r.types.snapshotProcessor(s,{postProcessor(e,t){e.apolloSelectedFeature=void 0;const n=Object.fromEntries(Object.entries(e.apolloDataStore.assemblies).filter((([,e])=>"InMemoryFileDriver"===e.backendDriverType)));if(e.apolloDataStore={typeName:"Client",assemblies:n,checkResults:{}},!t)return e;const{apolloDataStore:a}=t,{checkResults:o}=a;for(const[,t]of o){const[n]=t.ids;if(!n)continue;const o=a.assemblies.get(n.assemblyId);o&&"InMemoryFileDriver"===o.backendDriverType&&(e.apolloDataStore.checkResults[t._id]=r.getSnapshot(t))}return e}})}const zM="WorkerGlobalScope"in globalThis;for(const[e,t]of Object.entries(Xn.changes))L.changeRegistry.registerChange(e,t);const GM=new Xn.CDSCheck;L.checkRegistry.registerCheck(GM.name,GM);const HM=new Xn.TranscriptCheck;L.checkRegistry.registerCheck(HM.name,HM),Xn.validationRegistry.registerValidation(new Xn.CoreValidation),Xn.validationRegistry.registerValidation(new Xn.ParentChildValidation),e.default=class extends C.default{name="ApolloPlugin";version="0.3.9";configurationSchema=sM;install(e){!function(e){e.addAdapterType((()=>new P.default({name:"ApolloSequenceAdapter",configSchema:FN,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:RN})))}(e),function(e){e.addAdapterType((()=>new P.default({name:"ApolloRefNameAliasAdapter",configSchema:kN,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:EN})))}(e),function(e){e.addTextSearchAdapterType((()=>new o.TextSearchAdapterType({name:"ApolloTextSearchAdapter",displayName:"Apollo text search adapter",configSchema:qN,AdapterClass:LN,description:"Apollo Text Search adapter"})))}(e),e.addWidgetType((()=>{const e=a.ConfigurationSchema("ApolloFeatureDetailsWidget",{});return new o.WidgetType({name:"ApolloFeatureDetailsWidget",heading:"Apollo feature details",configSchema:e,stateModel:hI,ReactComponent:iI})})),e.addWidgetType((()=>{const e=a.ConfigurationSchema("ApolloTranscriptDetails",{});return new o.WidgetType({name:"ApolloTranscriptDetails",heading:"Apollo transcript details",configSchema:e,stateModel:mI,ReactComponent:AF})})),e.addTrackType((()=>{const t=a.ConfigurationSchema("ApolloTrack",{adapter:""},{baseConfiguration:o.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new o.TrackType({name:"ApolloTrack",configSchema:t,stateModel:o.createBaseTrackModel(e,"ApolloTrack",t)})})),e.addInternetAccountType((()=>new o.InternetAccountType({name:"ApolloInternetAccount",configSchema:zc,stateModel:xN(zc)}))),e.addDisplayType((()=>new o.DisplayType({name:"LinearApolloDisplay",configSchema:OF,stateModel:MP(0,OF),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:NM}))),e.addDisplayType((()=>new o.DisplayType({name:"LinearApolloSixFrameDisplay",configSchema:YP,stateModel:iM(0,YP),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:IM}))),e.addDisplayType((()=>new o.DisplayType({name:"LinearApolloReferenceSequenceDisplay",configSchema:DP,stateModel:WP(0,DP),displayName:"Apollo reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:JP}))),e.addToExtensionPoint("Core-extendSession",UM.bind(this,e)),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,r=t.views((e=>{const t=e.rubberBandMenuItems;return{rubberBandMenuItems:()=>[...t(),{label:"Add new feature",icon:Uc,onClick:()=>{const t=n.getSession(e),{leftOffset:r,rightOffset:a}=e,o=e.getSelectedRegions(r,a);t.queueDialog((e=>[UT,{session:t,handleClose:()=>{e()},region:o[0],changeManager:t.apolloDataStore.changeManager}]))}}]}}));e.stateModel=r}return e})),e.addToExtensionPoint("Core-extendPluggableElement",hM),e.addToExtensionPoint("Core-extendPluggableElement",vM),zM||e.addToExtensionPoint("Core-extendWorker",(t=>"on"in t&&t.on?(t.on("apollo",(async n=>{if("object"!=typeof(r=n)||null===r||!("apollo"in r)||!0!==r.apollo)return;var r;const{apollo:a,messageId:o,method:i}=n;switch(i){case"getSequence":{const{region:r}=n,{assemblyName:i}=r,s=e.rootModel?.session?.apolloDataStore;if(!s)break;const l=s.getBackendDriver(i);if(!l)break;const{seq:c}=await l.getSequence(r);t.workers[0].postMessage({apollo:a,messageId:o,sequence:c});break}case"getRegions":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r);if(!s)break;const l=await s.getRegions(r);t.workers[0].postMessage({apollo:a,messageId:o,regions:l});break}case"getRefNameAliases":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r);if(!s)break;const l=await s.getRefNameAliases(r);t.workers[0].postMessage({apollo:a,messageId:o,refNameAliases:l});break}}})),t):t))}configure(e){var t;n.isAbstractMenuManager(e.rootModel)&&(e.jexl.addFunction("geneBackgroundColor",(e=>"pseudogene"===e?l.alpha("rgb(148, 203, 236)",.6):"ncRNA_gene"===e?l.alpha("rgb(194, 106, 119)",.6):void 0)),(t=e.rootModel).insertInMenu("Apollo",{label:"Redo",icon:DM,onClick(e){const{apolloDataStore:t}=e;t.changeManager.redoLastChange()}},0),t.insertInMenu("Apollo",{label:"Undo",icon:LM,onClick(e){const{apolloDataStore:t}=e;t.changeManager.undoLastChange()}},0),t.appendToMenu("Apollo",{label:"Download GFF3",icon:RM,onClick:e=>{e.queueDialog((t=>[WT,{session:e,handleClose:()=>{t()}}]))}}),t.appendToMenu("Apollo",{label:"View Change Log",icon:jM,onClick:e=>{e.queueDialog((t=>[oN,{session:e,handleClose:()=>{t()}}]))}}),t.appendToMenu("Apollo",{label:"Open local GFF3 file",icon:PM,onClick:e=>{e.queueDialog((t=>[rN,{session:e,handleClose:()=>{t()},inMemoryFileDriver:e.apolloDataStore.inMemoryFileDriver}]))}}),t.appendToMenu("Apollo",{label:"View check results",icon:FM,onClick:e=>{e.queueDialog((t=>[cN,{session:e,handleClose:()=>{t()}}]))}}),t.appendToMenu("Apollo",{label:"Lock/Unlock session",onClick:e=>{e.toggleLocked()}}),t.appendToMenu("Apollo",{label:"Log out",icon:MM,onClick:e=>{e.queueDialog((t=>[YT,{session:e,handleClose:()=>{t()}}]))}}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=jbrowse-plugin-apollo.umd.production.min.js.map
