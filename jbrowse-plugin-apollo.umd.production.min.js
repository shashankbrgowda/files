!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jbrowse/core/Plugin"),require("@jbrowse/core/util"),require("@jbrowse/core/configuration"),require("@jbrowse/core/pluggableElementTypes"),require("@mui/material/utils"),require("react/jsx-runtime"),require("mobx"),require("mobx-state-tree"),require("@mui/material"),require("react"),require("tss-react/mui"),require("@jbrowse/core/ui"),require("mobx-react"),require("@jbrowse/core/util/types/mst"),require("@jbrowse/core/util/io"),require("@mui/material/Checkbox"),require("@mui/material/FormControlLabel"),require("@mui/material/LinearProgress"),require("@mui/x-data-grid"),require("@mui/material/Box"),require("@mui/material/Collapse"),require("@mui/material/IconButton"),require("@mui/material/Paper"),require("@mui/material/Table"),require("@mui/material/TableBody"),require("@mui/material/TableCell"),require("@mui/material/TableContainer"),require("@mui/material/TableFooter"),require("@mui/material/TableHead"),require("@mui/material/TablePagination"),require("@mui/material/TableRow"),require("@mui/material/Typography"),require("@mui/material/styles"),require("@jbrowse/core/pluggableElementTypes/AdapterType"),require("@jbrowse/core/data_adapters/BaseAdapter"),require("@jbrowse/core/util/rxjs"),require("@jbrowse/core/util/tracks")):"function"==typeof define&&define.amd?define(["exports","@jbrowse/core/Plugin","@jbrowse/core/util","@jbrowse/core/configuration","@jbrowse/core/pluggableElementTypes","@mui/material/utils","react/jsx-runtime","mobx","mobx-state-tree","@mui/material","react","tss-react/mui","@jbrowse/core/ui","mobx-react","@jbrowse/core/util/types/mst","@jbrowse/core/util/io","@mui/material/Checkbox","@mui/material/FormControlLabel","@mui/material/LinearProgress","@mui/x-data-grid","@mui/material/Box","@mui/material/Collapse","@mui/material/IconButton","@mui/material/Paper","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/Typography","@mui/material/styles","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/data_adapters/BaseAdapter","@jbrowse/core/util/rxjs","@jbrowse/core/util/tracks"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JBrowsePluginApollo={},e.JBrowseExports["@jbrowse/core/Plugin"],e.JBrowseExports["@jbrowse/core/util"],e.JBrowseExports["@jbrowse/core/configuration"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes"],e.JBrowseExports["@mui/material/utils"],e.JBrowseExports["react/jsx-runtime"],e.JBrowseExports.mobx,e.JBrowseExports["mobx-state-tree"],e.JBrowseExports["@mui/material"],e.JBrowseExports.react,e.JBrowseExports["tss-react/mui"],e.JBrowseExports["@jbrowse/core/ui"],e.JBrowseExports["mobx-react"],e.JBrowseExports["@jbrowse/core/util/types/mst"],e.JBrowseExports["@jbrowse/core/util/io"],e.JBrowseExports["@mui/material/Checkbox"],e.JBrowseExports["@mui/material/FormControlLabel"],e.JBrowseExports["@mui/material/LinearProgress"],e.JBrowseExports["@mui/x-data-grid"],e.JBrowseExports["@mui/material/Box"],e.JBrowseExports["@mui/material/Collapse"],e.JBrowseExports["@mui/material/IconButton"],e.JBrowseExports["@mui/material/Paper"],e.JBrowseExports["@mui/material/Table"],e.JBrowseExports["@mui/material/TableBody"],e.JBrowseExports["@mui/material/TableCell"],e.JBrowseExports["@mui/material/TableContainer"],e.JBrowseExports["@mui/material/TableFooter"],e.JBrowseExports["@mui/material/TableHead"],e.JBrowseExports["@mui/material/TablePagination"],e.JBrowseExports["@mui/material/TableRow"],e.JBrowseExports["@mui/material/Typography"],e.JBrowseExports["@mui/material/styles"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/AdapterType"],e.JBrowseExports["@jbrowse/core/data_adapters/BaseAdapter"],e.JBrowseExports["@jbrowse/core/util/rxjs"],e.JBrowseExports["@jbrowse/core/util/tracks"])}(this,(function(e,t,n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,R,I,P,F,M,j,D){"use strict";function L(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function B(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,t}var q=L(t),U=L(n),z=L(o),G=L(i),H=L(l),$=L(u),W=B(u),V=L(g),J=L(y),Y=L(v),K=L(_),Z=L(w),X=L(x),Q=L(S),ee=L(E),te=L(k),ne=L(C),re=L(A),ae=L(O),oe=L(T),ie=L(N),se=L(R),le=L(I),ce=L(F),ue="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function de(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}function fe(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pe={};function he(e){var t,n;function r(t,n){try{var o=e[t](n),i=o.value,s=i instanceof me;Promise.resolve(s?i.v:i).then((function(n){if(s){var l="return"===t?"return":"next";if(!i.k||n.done)return r(l,n);n=e[l](n).value}a(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise((function(o,i){var s={key:e,arg:a,resolve:o,reject:i,next:null};n?n=n.next=s:(t=n=s,r(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function me(e,t){this.v=e,this.k=t}function ge(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new ye(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ye(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ye=function(e){this.s=e,this.n=e.next},ye.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new ye(e)}function ve(e){return new me(e,0)}function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){Oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function we(){we=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=Object.create((t&&t.prototype instanceof y?t:y).prototype),i=new N(r||[]);return a(o,"_invoke",{value:C(e,n,i)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var f="suspendedStart",p="suspendedYield",h="executing",m="completed",g={};function y(){}function v(){}function b(){}var _={};c(_,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(R([])));x&&x!==n&&r.call(x,i)&&(_=x);var S=b.prototype=y.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,o,i,s){var l=d(e[a],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(u).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function C(t,n,r){var a=f;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var l=A(s,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===f)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var c=d(t,n,r);if("normal"===c.type){if(a=r.done?m:p,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}function A(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=d(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=b,a(S,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new k(u(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(S),c(S,l,"Generator"),c(S,i,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Se(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function Ee(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Se(o,r,a,i,s,"next",e)}function s(e){Se(o,r,a,i,s,"throw",e)}i(void 0)}))}}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Je(r.key),r)}}function Ae(e,t,n){return t&&Ce(e.prototype,t),n&&Ce(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Oe(e,t,n){return(t=Je(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Re(e,t)}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}function Re(e,t){return Re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Re(e,t)}function Ie(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Pe(e,t,n){return Pe=Ie()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&Re(a,n.prototype),a},Pe.apply(null,arguments)}function Fe(e){var t="function"==typeof Map?new Map:void 0;return Fe=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Pe(e,arguments,Ne(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Re(n,e)},Fe(e)}function Me(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function De(e){var t=Ie();return function(){var n,r=Ne(e);if(t){var a=Ne(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return je(e)}(this,n)}}function Le(){return Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ne(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Le.apply(this,arguments)}function Be(e,t){return ze(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(e,t)||He(e,t)||We()}function qe(e){return ze(e)||Ge(e)||He(e)||We()}function Ue(e){return function(e){if(Array.isArray(e))return $e(e)}(e)||Ge(e)||He(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e){if(Array.isArray(e))return e}function Ge(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function He(e,t){if(e){if("string"==typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$e(e,t):void 0}}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ve(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=He(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Je(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}he.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},he.prototype.next=function(e){return this._invoke("next",e)},he.prototype.throw=function(e){return this._invoke("throw",e)},he.prototype.return=function(e){return this._invoke("return",e)};var Ye=function(e,t){return Ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ye(e,t)};function Ke(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ye(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Ze=function(){return Ze=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ze.apply(this,arguments)};function Xe(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function Qe(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":xe(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function et(e,t){return function(n,r){t(n,r,e)}}function tt(e,t){if("object"===("undefined"==typeof Reflect?"undefined":xe(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function nt(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function rt(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var at=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function ot(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||at(t,e,n)}function it(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function st(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function lt(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(st(arguments[t]));return e}function ct(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}function ut(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}function dt(e){return this instanceof dt?(this.v=e,this):new dt(e)}function ft(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof dt?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function pt(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:dt(e[r](t)),done:!1}:a?a(t):t}:a}}function ht(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=it(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}}function mt(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var gt=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function yt(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&at(t,e,n);return gt(t,e),t}function vt(e){return e&&e.__esModule?e:{default:e}}function bt(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function _t(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n}function wt(e,t){if(null===t||"object"!==xe(t)&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function xt(e,t,n){if(null!=t){if("object"!==xe(t)&&"function"!=typeof t)throw new TypeError("Object expected.");var r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose]}if("function"!=typeof r)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var St="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function Et(e){function t(t){e.error=e.hasError?new St(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var r=e.stack.pop();try{var a=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(a).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}var kt={__proto__:null,__extends:Ke,get __assign(){return Ze},__rest:Xe,__decorate:Qe,__param:et,__esDecorate:function(e,t,n,r,a,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),f=!1,p=n.length-1;p>=0;p--){var h={};for(var m in r)h[m]="access"===m?{}:r[m];for(var m in r.access)h.access[m]=r.access[m];h.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var g=(0,n[p])("accessor"===l?{get:d.get,set:d.set}:d[c],h);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!==xe(g))throw new TypeError("Object expected");(s=i(g.get))&&(d.get=s),(s=i(g.set))&&(d.set=s),(s=i(g.init))&&a.unshift(s)}else(s=i(g))&&("field"===l?a.unshift(s):d[c]=s)}u&&Object.defineProperty(u,r.name,d),f=!0},__runInitializers:function(e,t,n){for(var r=arguments.length>2,a=0;a<t.length;a++)n=r?t[a].call(e,n):t[a].call(e);return r?n:void 0},__propKey:function(e){return"symbol"===xe(e)?e:"".concat(e)},__setFunctionName:function(e,t,n){return"symbol"===xe(t)&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})},__metadata:tt,__awaiter:nt,__generator:rt,__createBinding:at,__exportStar:ot,__values:it,__read:st,__spread:lt,__spreadArrays:ct,__spreadArray:ut,__await:dt,__asyncGenerator:ft,__asyncDelegator:pt,__asyncValues:ht,__makeTemplateObject:mt,__importStar:yt,__importDefault:vt,__classPrivateFieldGet:bt,__classPrivateFieldSet:_t,__classPrivateFieldIn:wt,__addDisposableResource:xt,__disposeResources:Et,default:{__extends:Ke,__assign:Ze,__rest:Xe,__decorate:Qe,__param:et,__metadata:tt,__awaiter:nt,__generator:rt,__createBinding:at,__exportStar:ot,__values:it,__read:st,__spread:lt,__spreadArrays:ct,__spreadArray:ut,__await:dt,__asyncGenerator:ft,__asyncDelegator:pt,__asyncValues:ht,__makeTemplateObject:mt,__importStar:yt,__importDefault:vt,__classPrivateFieldGet:bt,__classPrivateFieldSet:_t,__classPrivateFieldIn:wt,__addDisposableResource:xt,__disposeResources:Et}},Ct=de(kt),At={};Object.defineProperty(At,"__esModule",{value:!0}),At.ApolloPlugin=void 0;var Ot=function(e){Te(n,e);var t=De(n);function n(){return ke(this,n),t.apply(this,arguments)}return Ae(n,[{key:"apolloInstall",value:function(e){}}]),n}(Ct.__importDefault(q.default).default);At.ApolloPlugin=Ot;var Tt={},Nt={},Rt={};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.changeRegistry=void 0,Rt.changeRegistry=new(function(){function e(){ke(this,e),this.changes=new Map}return Ae(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var It={};Object.defineProperty(It,"__esModule",{value:!0}),It.Operation=void 0;var Pt=function(){function e(t,n){var r;ke(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return Ae(e,[{key:"execute",value:(t=Ee(we().mark((function e(t){var n,r;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();It.Operation=Pt,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.Change=void 0,Nt.isChange=function(e){return void 0!==e.executeOnClient};var Ft=Rt,Mt=function(e){Te(r,e);var t,n=De(r);function r(){return ke(this,r),n.apply(this,arguments)}return Ae(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Ee(we().mark((function e(t){var n;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",Le(Ne(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(Ft.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(It.Operation);Nt.Change=Mt,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.AssemblySpecificChange=void 0,Tt.isAssemblySpecificChange=function(e){return(0,jt.isChange)(e)&&void 0!==e.assembly};var jt=Nt;Tt.AssemblySpecificChange=function(e){Te(n,e);var t=De(n);function n(e,r){var a;return ke(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return Ae(n)}(jt.Change);var Dt={};Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.Check=void 0,Dt.Check=Ae((function e(){ke(this,e)}));var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.checkRegistry=void 0,Lt.checkRegistry=new(function(){function e(){ke(this,e),this.checks=new Map}return Ae(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var Bt={},qt="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function Ut(){throw new Error("setTimeout has not been defined")}function zt(){throw new Error("clearTimeout has not been defined")}var Gt=Ut,Ht=zt;function $t(e){if(Gt===setTimeout)return setTimeout(e,0);if((Gt===Ut||!Gt)&&setTimeout)return Gt=setTimeout,setTimeout(e,0);try{return Gt(e,0)}catch(t){try{return Gt.call(null,e,0)}catch(t){return Gt.call(this,e,0)}}}"function"==typeof qt.setTimeout&&(Gt=setTimeout),"function"==typeof qt.clearTimeout&&(Ht=clearTimeout);var Wt,Vt=[],Jt=!1,Yt=-1;function Kt(){Jt&&Wt&&(Jt=!1,Wt.length?Vt=Wt.concat(Vt):Yt=-1,Vt.length&&Zt())}function Zt(){if(!Jt){var e=$t(Kt);Jt=!0;for(var t=Vt.length;t;){for(Wt=Vt,Vt=[];++Yt<t;)Wt&&Wt[Yt].run();Yt=-1,t=Vt.length}Wt=null,Jt=!1,function(e){if(Ht===clearTimeout)return clearTimeout(e);if((Ht===zt||!Ht)&&clearTimeout)return Ht=clearTimeout,clearTimeout(e);try{return Ht(e)}catch(t){try{return Ht.call(null,e)}catch(t){return Ht.call(this,e)}}}(e)}}function Xt(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Vt.push(new Qt(e,t)),1!==Vt.length||Jt||$t(Zt)}function Qt(e,t){this.fun=e,this.array=t}function en(){}Qt.prototype.run=function(){this.fun.apply(null,this.array)};var tn=en,nn=en,rn=en,an=en,on=en,sn=en,ln=en,cn=qt.performance||{},un=cn.now||cn.mozNow||cn.msNow||cn.oNow||cn.webkitNow||function(){return(new Date).getTime()},dn=new Date,fn={nextTick:Xt,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:tn,addListener:nn,once:rn,off:an,removeListener:on,removeAllListeners:sn,emit:ln,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*un.call(cn),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-dn)/1e3}},pn=[],hn=[],mn="undefined"!=typeof Uint8Array?Uint8Array:Array,gn=!1;function yn(){gn=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)pn[t]=e[t],hn[e.charCodeAt(t)]=t;hn["-".charCodeAt(0)]=62,hn["_".charCodeAt(0)]=63}function vn(e,t,n){for(var r,a=[],o=t;o<n;o+=3)a.push(pn[(r=(e[o]<<16)+(e[o+1]<<8)+e[o+2])>>18&63]+pn[r>>12&63]+pn[r>>6&63]+pn[63&r]);return a.join("")}function bn(e,t,n,r,a){var o,i,s=8*a-r-1,l=(1<<s)-1,c=l>>1,u=-7,d=n?a-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+d],d+=f,u-=8);for(i=o&(1<<-u)-1,o>>=-u,u+=r;u>0;i=256*i+e[t+d],d+=f,u-=8);if(0===o)o=1-c;else{if(o===l)return i?NaN:Infinity*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function _n(e,t,n,r,a,o){var i,s,l,c=8*o-a-1,u=(1<<c)-1,d=u>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||Infinity===t?(s=isNaN(t)?1:0,i=u):(i=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-i))<1&&(i--,l*=2),(t+=i+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(i++,l/=2),i+d>=u?(s=0,i=u):i+d>=1?(s=(t*l-1)*Math.pow(2,a),i+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),i=0));a>=8;e[n+p]=255&s,p+=h,s/=256,a-=8);for(i=i<<a|s,c+=a;c>0;e[n+p]=255&i,p+=h,i/=256,c-=8);e[n+p-h]|=128*m}var wn={}.toString,xn=Array.isArray||function(e){return"[object Array]"==wn.call(e)};function Sn(){return kn.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function En(e,t){if(Sn()<t)throw new RangeError("Invalid typed array length");return kn.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=kn.prototype:(null===e&&(e=new kn(t)),e.length=t),e}function kn(e,t,n){if(!(kn.TYPED_ARRAY_SUPPORT||this instanceof kn))return new kn(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return On(this,e)}return Cn(this,e,t,n)}function Cn(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),kn.TYPED_ARRAY_SUPPORT?(e=t).__proto__=kn.prototype:e=Tn(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!kn.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|In(t,n),a=(e=En(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(Rn(t)){var n=0|Nn(t.length);return 0===(e=En(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?En(e,0):Tn(e,t);if("Buffer"===t.type&&xn(t.data))return Tn(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function An(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function On(e,t){if(An(t),e=En(e,t<0?0:0|Nn(t)),!kn.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function Tn(e,t){var n=t.length<0?0:0|Nn(t.length);e=En(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function Nn(e){if(e>=Sn())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Sn().toString(16)+" bytes");return 0|e}function Rn(e){return!(null==e||!e._isBuffer)}function In(e,t){if(Rn(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return or(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return ir(e).length;default:if(r)return or(e).length;t=(""+t).toLowerCase(),r=!0}}function Pn(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Jn(this,t,n);case"utf8":case"utf-8":return Hn(this,t,n);case"ascii":return Wn(this,t,n);case"latin1":case"binary":return Vn(this,t,n);case"base64":return Gn(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yn(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function Fn(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Mn(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=kn.from(t,r)),Rn(t))return 0===t.length?-1:jn(e,t,n,r,a);if("number"==typeof t)return t&=255,kn.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):jn(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function jn(e,t,n,r,a){var o,i=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;i=2,s/=2,l/=2,n/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(a){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*i}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var d=!0,f=0;f<l;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function Dn(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[n+i]=s}return i}function Ln(e,t,n,r){return sr(or(t,e.length-n),e,n,r)}function Bn(e,t,n,r){return sr(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function qn(e,t,n,r){return Bn(e,t,n,r)}function Un(e,t,n,r){return sr(ir(t),e,n,r)}function zn(e,t,n,r){return sr(function(e,t){for(var n,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a.push(n%256),a.push(r);return a}(t,e.length-n),e,n,r)}function Gn(e,t,n){return function(e){var t;gn||yn();for(var n=e.length,r=n%3,a="",o=[],i=16383,s=0,l=n-r;s<l;s+=i)o.push(vn(e,s,s+i>l?l:s+i));return 1===r?(a+=pn[(t=e[n-1])>>2],a+=pn[t<<4&63],a+="=="):2===r&&(a+=pn[(t=(e[n-2]<<8)+e[n-1])>>10],a+=pn[t>>4&63],a+=pn[t<<2&63],a+="="),o.push(a),o.join("")}(0===t&&n===e.length?e:e.slice(t,n))}function Hn(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var o,i,s,l,c=e[a],u=null,d=c>239?4:c>223?3:c>191?2:1;if(a+d<=n)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[a+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:i=e[a+2],128==(192&(o=e[a+1]))&&128==(192&i)&&(l=(15&c)<<12|(63&o)<<6|63&i)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:i=e[a+2],s=e[a+3],128==(192&(o=e[a+1]))&&128==(192&i)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(r.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),r.push(u),a+=d}return function(e){var t=e.length;if(t<=$n)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=$n));return n}(r)}kn.TYPED_ARRAY_SUPPORT=void 0===qt.TYPED_ARRAY_SUPPORT||qt.TYPED_ARRAY_SUPPORT,kn.poolSize=8192,kn._augment=function(e){return e.__proto__=kn.prototype,e},kn.from=function(e,t,n){return Cn(null,e,t,n)},kn.TYPED_ARRAY_SUPPORT&&(kn.prototype.__proto__=Uint8Array.prototype,kn.__proto__=Uint8Array),kn.alloc=function(e,t,n){return function(e,t,n,r){return An(t),t<=0?En(e,t):void 0!==n?"string"==typeof r?En(e,t).fill(n,r):En(e,t).fill(n):En(e,t)}(null,e,t,n)},kn.allocUnsafe=function(e){return On(null,e)},kn.allocUnsafeSlow=function(e){return On(null,e)},kn.isBuffer=lr,kn.compare=function(e,t){if(!Rn(e)||!Rn(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=Math.min(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},kn.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},kn.concat=function(e,t){if(!xn(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return kn.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=kn.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!Rn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},kn.byteLength=In,kn.prototype._isBuffer=!0,kn.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Fn(this,t,t+1);return this},kn.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Fn(this,t,t+3),Fn(this,t+1,t+2);return this},kn.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Fn(this,t,t+7),Fn(this,t+1,t+6),Fn(this,t+2,t+5),Fn(this,t+3,t+4);return this},kn.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Hn(this,0,e):Pn.apply(this,arguments)},kn.prototype.equals=function(e){if(!Rn(e))throw new TypeError("Argument must be a Buffer");return this===e||0===kn.compare(this,e)},kn.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},kn.prototype.compare=function(e,t,n,r,a){if(!Rn(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),i=(n>>>=0)-(t>>>=0),s=Math.min(o,i),l=this.slice(r,a),c=e.slice(t,n),u=0;u<s;++u)if(l[u]!==c[u]){o=l[u],i=c[u];break}return o<i?-1:i<o?1:0},kn.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},kn.prototype.indexOf=function(e,t,n){return Mn(this,e,t,n,!0)},kn.prototype.lastIndexOf=function(e,t,n){return Mn(this,e,t,n,!1)},kn.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Dn(this,e,t,n);case"utf8":case"utf-8":return Ln(this,e,t,n);case"ascii":return Bn(this,e,t,n);case"latin1":case"binary":return qn(this,e,t,n);case"base64":return Un(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return zn(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},kn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $n=4096;function Wn(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function Vn(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function Jn(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",o=t;o<n;++o)a+=ar(e[o]);return a}function Yn(e,t,n){for(var r=e.slice(t,n),a="",o=0;o<r.length;o+=2)a+=String.fromCharCode(r[o]+256*r[o+1]);return a}function Kn(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Zn(e,t,n,r,a,o){if(!Rn(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Xn(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function Qn(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-n,4);a<o;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function er(e,t,n,r,a,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function tr(e,t,n,r,a){return a||er(e,0,n,4),_n(e,t,n,r,23,4),n+4}function nr(e,t,n,r,a){return a||er(e,0,n,8),_n(e,t,n,r,52,8),n+8}kn.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),kn.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=kn.prototype;else{var a=t-e;n=new kn(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+e]}return n},kn.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Kn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r},kn.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Kn(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},kn.prototype.readUInt8=function(e,t){return t||Kn(e,1,this.length),this[e]},kn.prototype.readUInt16LE=function(e,t){return t||Kn(e,2,this.length),this[e]|this[e+1]<<8},kn.prototype.readUInt16BE=function(e,t){return t||Kn(e,2,this.length),this[e]<<8|this[e+1]},kn.prototype.readUInt32LE=function(e,t){return t||Kn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},kn.prototype.readUInt32BE=function(e,t){return t||Kn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},kn.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Kn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},kn.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Kn(e,t,this.length);for(var r=t,a=1,o=this[e+--r];r>0&&(a*=256);)o+=this[e+--r]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},kn.prototype.readInt8=function(e,t){return t||Kn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},kn.prototype.readInt16LE=function(e,t){t||Kn(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},kn.prototype.readInt16BE=function(e,t){t||Kn(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},kn.prototype.readInt32LE=function(e,t){return t||Kn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},kn.prototype.readInt32BE=function(e,t){return t||Kn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},kn.prototype.readFloatLE=function(e,t){return t||Kn(e,4,this.length),bn(this,e,!0,23,4)},kn.prototype.readFloatBE=function(e,t){return t||Kn(e,4,this.length),bn(this,e,!1,23,4)},kn.prototype.readDoubleLE=function(e,t){return t||Kn(e,8,this.length),bn(this,e,!0,52,8)},kn.prototype.readDoubleBE=function(e,t){return t||Kn(e,8,this.length),bn(this,e,!1,52,8)},kn.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Zn(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},kn.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Zn(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},kn.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,1,255,0),kn.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},kn.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,2,65535,0),kn.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Xn(this,e,t,!0),t+2},kn.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,2,65535,0),kn.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Xn(this,e,t,!1),t+2},kn.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,4,4294967295,0),kn.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Qn(this,e,t,!0),t+4},kn.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,4,4294967295,0),kn.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qn(this,e,t,!1),t+4},kn.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Zn(this,e,t,n,a-1,-a)}var o=0,i=1,s=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},kn.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Zn(this,e,t,n,a-1,-a)}var o=n-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},kn.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,1,127,-128),kn.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},kn.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,2,32767,-32768),kn.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Xn(this,e,t,!0),t+2},kn.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,2,32767,-32768),kn.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Xn(this,e,t,!1),t+2},kn.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,4,2147483647,-2147483648),kn.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Qn(this,e,t,!0),t+4},kn.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Zn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),kn.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Qn(this,e,t,!1),t+4},kn.prototype.writeFloatLE=function(e,t,n){return tr(this,e,t,!0,n)},kn.prototype.writeFloatBE=function(e,t,n){return tr(this,e,t,!1,n)},kn.prototype.writeDoubleLE=function(e,t,n){return nr(this,e,t,!0,n)},kn.prototype.writeDoubleBE=function(e,t,n){return nr(this,e,t,!1,n)},kn.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,o=r-n;if(this===e&&n<t&&t<r)for(a=o-1;a>=0;--a)e[a+t]=this[a+n];else if(o<1e3||!kn.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},kn.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!kn.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var i=Rn(e)?e:or(new kn(e,r).toString()),s=i.length;for(o=0;o<n-t;++o)this[o+t]=i[o%s]}return this};var rr=/[^+\/0-9A-Za-z-_]/g;function ar(e){return e<16?"0"+e.toString(16):e.toString(16)}function or(e,t){var n;t=t||Infinity;for(var r=e.length,a=null,o=[],i=0;i<r;++i){if((n=e.charCodeAt(i))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(t-=3)>-1&&o.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function ir(e){return function(e){var t,n,r,a,o,i;gn||yn();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=new mn(3*s/4-(o="="===e[s-2]?2:"="===e[s-1]?1:0)),r=o>0?s-4:s;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)a=hn[e.charCodeAt(t)]<<18|hn[e.charCodeAt(t+1)]<<12|hn[e.charCodeAt(t+2)]<<6|hn[e.charCodeAt(t+3)],i[l++]=a>>16&255,i[l++]=a>>8&255,i[l++]=255&a;return 2===o?(a=hn[e.charCodeAt(t)]<<2|hn[e.charCodeAt(t+1)]>>4,i[l++]=255&a):1===o&&(a=hn[e.charCodeAt(t)]<<10|hn[e.charCodeAt(t+1)]<<4|hn[e.charCodeAt(t+2)]>>2,i[l++]=a>>8&255,i[l++]=255&a),i}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(rr,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function sr(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function lr(e){return null!=e&&(!!e._isBuffer||cr(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&cr(e.slice(0,0))}(e))}function cr(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}for(var ur=Math.floor(16777215*Math.random()),dr=br.index=parseInt(16777215*Math.random(),10),fr=(void 0===fn||"number"!=typeof fn.pid?Math.floor(1e5*Math.random()):fn.pid)%65535,pr=function(){try{return _Buffer}catch(e){try{return kn}catch(e){return null}}}(),hr=function(e){return!(null==e||!e.constructor||"function"!=typeof e.constructor.isBuffer||!e.constructor.isBuffer(e))},mr=[],gr=0;gr<256;gr++)mr[gr]=(gr<=15?"0":"")+gr.toString(16);var yr=new RegExp("^[0-9a-fA-F]{24}$"),vr=[];for(gr=0;gr<10;)vr[48+gr]=gr++;for(;gr<16;)vr[55+gr]=vr[87+gr]=gr++;function br(e){if(!(this instanceof br))return new br(e);if(e&&(e instanceof br||"ObjectID"===e._bsontype))return e;if(this._bsontype="ObjectID",null!=e&&"number"!=typeof e){var t=br.isValid(e);if(!t&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(t&&"string"==typeof e&&24===e.length)return br.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&"function"==typeof e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e}else this.id=this.generate(e)}var _r=br;br.default=br,br.createFromTime=function(e){return new br(function(e,t){return 8===(t=t.toString(16)).length?t:"00000000".substring(t.length,8)+t}(0,e=parseInt(e,10)%4294967295)+"0000000000000000")},br.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var t="",n=0;n<24;)t+=String.fromCharCode(vr[e.charCodeAt(n++)]<<4|vr[e.charCodeAt(n++)]);return new br(t)},br.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&yr.test(e):e instanceof br||(hr(e)?br.isValid(e.toString("hex")):!("function"!=typeof e.toHexString||!pr||!(e.id instanceof pr||"string"==typeof e.id))&&(12===e.id.length||24===e.id.length&&yr.test(e.id)))))},br.prototype={constructor:br,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(24===this.id.length)return this.id;if(hr(this.id))return this.id.toString("hex");for(var e="",t=0;t<this.id.length;t++)e+=mr[this.id.charCodeAt(t)];return e},equals:function(e){return e instanceof br?this.toString()===e.toString():"string"==typeof e&&br.isValid(e)&&12===e.length&&hr(this.id)?e===this.id.toString("binary"):"string"==typeof e&&br.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&br.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof br||e.toHexString))&&e.toHexString()===this.toHexString()},getTimestamp:function(){var e,t=new Date;return e=hr(this.id)?this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,t.setTime(1e3*Math.floor(e)),t},generate:function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3)),e=parseInt(e,10)%4294967295;var t=dr=(dr+1)%16777215;return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e,ur>>16&255,ur>>8&255,255&ur,fr>>8&255,255&fr,t>>16&255,t>>8&255,255&t)}};var wr=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";br.prototype[wr]=function(){return"ObjectID("+this+")"},br.prototype.toJSON=br.prototype.toHexString,br.prototype.toString=br.prototype.toHexString,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.FeatureChange=void 0,Bt.isFeatureChange=function(e){return(0,Sr.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var xr=Ct.__importDefault(_r),Sr=Tt,Er=function(e){Te(n,e);var t=De(n);function n(e,r){var a;return ke(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return Ae(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=Ve(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=Be(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=Ve((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=Be(t.value,2);n.push.apply(n,[a[0]].concat(Ue(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new xr.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return _e(_e({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=_e({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,_e(_e({allIds:[]},t),{},{_id:a})),e.children=new Map(Ue(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=Ve(r);try{for(s.s();!(i=s.n()).done;){var l=Be(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(Sr.AssemblySpecificChange);Bt.FeatureChange=Er;var kr={};Object.defineProperty(kr,"__esModule",{value:!0}),kr.operationRegistry=void 0,kr.operationRegistry=new(function(){function e(){ke(this,e),this.operations=new Map}return Ae(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var Cr={};Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.Validation=void 0,Cr.isContext=function(e){return"context"in e&&"reflector"in e};var Ar=function(){function e(){ke(this,e)}var t,n,r,a,o;return Ae(e,[{key:"frontendPreValidate",value:(o=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Cr.Validation=Ar,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(At,e),t.__exportStar(Tt,e),t.__exportStar(Nt,e),t.__exportStar(Rt,e),t.__exportStar(Dt,e),t.__exportStar(Lt,e),t.__exportStar(Bt,e),t.__exportStar(It,e),t.__exportStar(kr,e),t.__exportStar(Cr,e)}(pe);var Or={},Tr={},Nr={},Rr={},Ir={};Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.ApolloPlugin=void 0;var Pr=function(e){Te(n,e);var t=De(n);function n(){return ke(this,n),t.apply(this,arguments)}return Ae(n,[{key:"apolloInstall",value:function(e){}}]),n}(Ct.__importDefault(q.default).default);Ir.ApolloPlugin=Pr;var Fr={},Mr={},jr={};Object.defineProperty(jr,"__esModule",{value:!0}),jr.changeRegistry=void 0,jr.changeRegistry=new(function(){function e(){ke(this,e),this.changes=new Map}return Ae(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var Dr={};Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.Operation=void 0;var Lr=function(){function e(t,n){var r;ke(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return Ae(e,[{key:"execute",value:(t=Ee(we().mark((function e(t){var n,r;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();Dr.Operation=Lr,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.Change=void 0,Mr.isChange=function(e){return void 0!==e.executeOnClient};var Br=jr,qr=function(e){Te(r,e);var t,n=De(r);function r(){return ke(this,r),n.apply(this,arguments)}return Ae(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Ee(we().mark((function e(t){var n;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",Le(Ne(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(Br.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(Dr.Operation);Mr.Change=qr,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.AssemblySpecificChange=void 0,Fr.isAssemblySpecificChange=function(e){return(0,Ur.isChange)(e)&&void 0!==e.assembly};var Ur=Mr;Fr.AssemblySpecificChange=function(e){Te(n,e);var t=De(n);function n(e,r){var a;return ke(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return Ae(n)}(Ur.Change);var zr={};Object.defineProperty(zr,"__esModule",{value:!0}),zr.Check=void 0,zr.Check=Ae((function e(){ke(this,e)}));var Gr={};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.checkRegistry=void 0,Gr.checkRegistry=new(function(){function e(){ke(this,e),this.checks=new Map}return Ae(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var Hr={};Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.FeatureChange=void 0,Hr.isFeatureChange=function(e){return(0,Wr.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var $r=Ct.__importDefault(_r),Wr=Fr,Vr=function(e){Te(n,e);var t=De(n);function n(e,r){var a;return ke(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return Ae(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=Ve(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=Be(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=Ve((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=Be(t.value,2);n.push.apply(n,[a[0]].concat(Ue(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new $r.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return _e(_e({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=_e({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,_e(_e({allIds:[]},t),{},{_id:a})),e.children=new Map(Ue(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=Ve(r);try{for(s.s();!(i=s.n()).done;){var l=Be(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(Wr.AssemblySpecificChange);Hr.FeatureChange=Vr;var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.operationRegistry=void 0,Jr.operationRegistry=new(function(){function e(){ke(this,e),this.operations=new Map}return Ae(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var Yr={};Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.Validation=void 0,Yr.isContext=function(e){return"context"in e&&"reflector"in e};var Kr=function(){function e(){ke(this,e)}var t,n,r,a,o;return Ae(e,[{key:"frontendPreValidate",value:(o=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Yr.Validation=Kr,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(Ir,e),t.__exportStar(Fr,e),t.__exportStar(Mr,e),t.__exportStar(jr,e),t.__exportStar(zr,e),t.__exportStar(Gr,e),t.__exportStar(Hr,e),t.__exportStar(Dr,e),t.__exportStar(Jr,e),t.__exportStar(Yr,e)}(Rr),Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.AddAssemblyAliasesChange=void 0;var Zr=U.default,Xr=function(e){Te(r,e);var t,n=De(r);function r(e,t){var a;return ke(this,r),Oe(je(a=n.call(this,e,t)),"typeName","AddAssemblyAliasesChange"),Oe(je(a),"aliases",void 0),a.aliases=e.aliases,a}return Ae(r,[{key:"executeOnClient",value:function(e){var t=(0,Zr.getSession)(e).assemblyManager.get(this.assembly);if(!t)throw new Error("assembly ".concat(this.assembly," not found"));return t.configuration.aliases.set(this.aliases),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,aliases:this.aliases}}},{key:"executeOnServer",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=this.assembly,i=this.aliases,null===(n=(o=this.logger).debug)||void 0===n||n.call(o,"Updating assembly aliases for assembly: ".concat(a,", aliases: ").concat(JSON.stringify(i))),e.next=5,r.findById(a);case 5:if(s=e.sent){e.next=8;break}throw new Error("Assembly with ID ".concat(a," not found"));case 8:return s.aliases=i,e.next=11,s.save();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"Assembly aliases have been added."}}]),r}(Rr.AssemblySpecificChange);Nr.AddAssemblyAliasesChange=Xr;var Qr={},ea={},ta={},na={};Object.defineProperty(na,"__esModule",{value:!0}),na.annotationFeatureToGFF3=aa;var ra=U.default;function aa(e,t,n){var r,a,o,i,s=JSON.parse(JSON.stringify(null!==(r=e.attributes)&&void 0!==r?r:{})),l=[],c=null!==(a=null===(o=e.attributes)||void 0===o||null===(o=o.gff_source)||void 0===o?void 0:o[0])&&void 0!==a?a:null;delete s.gff_source,t&&(s.Parent=[t]),s.gff_id?(s.ID=s.gff_id,delete s.gff_id):e.children&&(s.ID=[e._id]),s.gff_name&&(s.Name=s.gff_name,delete s.gff_name),s.gff_alias&&(s.Alias=s.gff_alias,delete s.gff_alias),s.gff_target&&(s.Target=s.gff_target,delete s.gff_target),s.gff_gap&&(s.Gap=s.gff_gap,delete s.gff_gap),s.gff_derives_from&&(s.Derives_from=s.gff_derives_from,delete s.gff_derives_from),s.gff_note&&(s.Note=s.gff_note,delete s.gff_note),s.gff_dbxref&&(s.Dbxref=s.gff_dbxref,delete s.gff_dbxref),s.gff_is_circular&&(s.Is_circular=s.gff_is_circular,delete s.gff_is_circular),s.gff_ontology_term&&(l.push.apply(l,Ue(s.gff_ontology_term)),delete s.gff_ontology_term),s["Gene Ontology"]&&(l.push.apply(l,Ue(s["Gene Ontology"])),delete s["Gene Ontology"]),s["Sequence Ontology"]&&(l.push.apply(l,Ue(s["Sequence Ontology"])),delete s["Sequence Ontology"]),l.length>0&&(s.Ontology_term=l);var u=null===(i=e.attributes)||void 0===i?void 0:i.gff_score,d=null;return u&&u.length>0&&(u[0]&&(d=Number(u[0]),Number.isNaN(d)&&(d=null)),delete s.gff_score),[{start:e.min,end:e.max}].map((function(t){var r,a;return{start:Number(t.start)+1,end:Number(t.end),seq_id:n?null!==(r=n[e.refSeq])&&void 0!==r?r:null:e.refSeq,source:c,type:e.type,score:d,strand:e.strand?1===e.strand?"+":"-":null,phase:null,attributes:Object.keys(s).length>0?s:null,derived_features:[],child_features:oa(e,null===(a=s.ID)||void 0===a?void 0:a[0],n)}}))}function oa(e,t,n){if(!e.children)return[];if("mRNA"===e.type){for(var r=[],a=function(e){var t=[];try{t=function(e){if("mRNA"!==e.type)throw new Error('Only features of type "mRNA" or equivalent can calculate CDS locations');if(!e.children)throw new Error("no CDS or exons in mRNA");var t=Object.values(e.children),n=t.filter((function(e){return"CDS"===e.type}));if(0===n.length)throw new Error("no CDS in mRNA");var r,a=[],o=Ve(n);try{var i=function(){for(var n=r.value,o=n.max,i=n.min,s=[],l=!1,c=[],u=0,d=t;u<d.length;u++){var f=d[u];"exon"===f.type&&c.push({min:f.min,max:f.max})}c.sort((function(e,t){return e.min-t.min}));for(var p=0,h=c;p<h.length;p++){var m=h[p],g=s.at(-1);g&&s.push({min:g.max,max:m.min,type:"intron"});var y,v=Be((0,ra.intersection2)(i,o,m.min,m.max),2),b=v[0],_=v[1];y=l?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==b&&void 0!==_?(l=!0,b===m.min&&_===m.max?s.push({min:b,max:_,phase:0,type:"CDS"}):b===m.min?s.push({min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:y}):_===m.max?s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"}):s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:"fivePrimeUTR"===y?"threePrimeUTR":"fivePrimeUTR"})):s.push({min:m.min,max:m.max,type:y})}s.sort((function(e,t){return e.min-t.min})),-1===e.strand&&s.reverse();var w=0,x=s.map((function(e){if("CDS"!==e.type)return e;var t=w;return w=(3-(e.max-e.min-t+3)%3)%3,_e(_e({},e),{},{phase:t})}));a.push(x)};for(o.s();!(r=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return a}(e)}catch(e){return[]}return t.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))}(e),o=0,i=0,s=Object.values(e.children);i<s.length;i++){var l=s[i],c=aa(l,t,n);if("CDS"===l.type){var u,d=Ve(a[o]);try{for(d.s();!(u=d.n()).done;){var f=u.value,p=JSON.parse(JSON.stringify(c));if(1!=p.length)throw new Error("Unexpected CDS: ".concat(JSON.stringify(p,null,2)));p[0].start=f.min+1,p[0].end=f.max,p[0].phase=f.phase.toString(),p[0].type=f.type,r.push(p)}}catch(e){d.e(e)}finally{d.f()}o++}else r.push(c)}return r}return Object.values(e.children).map((function(e){return aa(e,t,n)}))}var ia={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.gffInternalToColumn=e.gffColumnToInternal=e.internalToGFF=e.gffToInternal=void 0,e.isGFFReservedAttribute=function(t){return t in e.gffToInternal},e.isGFFInternalAttribute=function(t){return t in e.internalToGFF},e.isGFFColumn=function(t){return t in e.gffColumnToInternal},e.isGFFColumnInternal=function(t){return t in e.gffInternalToColumn},e.gffToInternal={ID:"gff_id",Name:"gff_name",Alias:"gff_alias",Parent:"gff_parent",Target:"gff_target",Gap:"gff_gap",Derives_from:"gff_derives_from",Note:"gff_note",Dbxref:"gff_dbxref",Ontology_term:"gff_ontology_term",Is_circular:"gff_is_circular"},e.internalToGFF={gff_id:"ID",gff_name:"Name",gff_alias:"Alias",gff_parent:"Parent",gff_target:"Target",gff_gap:"Gap",gff_derives_from:"Derives_from",gff_note:"Note",gff_dbxref:"Dbxref",gff_ontology_term:"Ontology_term",gff_is_circular:"Is_circular"},e.gffColumnToInternal={score:"gff_score",source:"gff_source"},e.gffInternalToColumn={gff_score:"score",gff_source:"source"}}(ia);var sa={};Object.defineProperty(sa,"__esModule",{value:!0}),sa.gff3ToAnnotationFeature=function e(t,n,r){var a=Be(t,1)[0],o=a.end,i=a.seq_id,s=a.start,l=a.strand,c=a.type;if(!i)throw new Error("feature does not have seq_id: ".concat(JSON.stringify(a)));if(!c)throw new Error("feature does not have type: ".concat(JSON.stringify(a)));if(null===s)throw new Error("feature does not have start: ".concat(JSON.stringify(a)));if(null===o)throw new Error("feature does not have end: ".concat(JSON.stringify(a)));var u=Be(function(e){if(e.length>1&&!e.every((function(e){return"CDS"===e.type})))throw new Error("GFF3 features has multiple locations but is not a CDS");var t=e.map((function(e){return e.start})).filter((function(e){return null!==e})),n=e.map((function(e){return e.end})).filter((function(e){return null!==e}));return[Math.min.apply(Math,Ue(t))-1,Math.max.apply(Math,Ue(n))]}(t),2),d=u[0],f=u[1],p=function(t,n,r){var a={},o=t.filter((function(e){return e.child_features.length>0}));if(o.length>1)throw new Error("Features with multiple locations may not have children");if(0!==o.length){var i,s=[],l=[],c=[],u=Ve(Be(o,1)[0].child_features);try{for(u.s();!(i=u.n()).done;){var d=i.value,f=Be(d,1)[0];if("exon"===f.type&&l.push(d),"three_prime_UTR"!==f.type&&"five_prime_UTR"!==f.type||c.push(d),"three_prime_UTR"!==f.type&&"five_prime_UTR"!==f.type&&"intron"!==f.type&&"start_codon"!==f.type&&"stop_codon"!==f.type)if("CDS"===f.type)s.push(d);else{var p=e(d,n,r);a[p._id]=p}}}catch(e){u.e(e)}finally{u.f()}if(s.length>0){var h,m=function(t,n,r){var a=t.map((function(e){return e.length}));if(a.some((function(e){return e>1})))return t.map((function(t){return e(t,n,r)}));var o=t.map((function(e){return e[0]})).filter((function(e){return null!==e.start&&null!==e.end})).sort((function(e,t){return e.start-t.start}));if(!o.some((function(e,t){var n=o.at(t+1);return!!n&&(0,la.doesIntersect2)(e.start,e.end,n.start,n.end)})))return[e(o,n,r)];var i,s=t.map((function(e){return e[0]})),l=[],c=Ve(s);try{var u=function(){var e=i.value,t=l.at(-1);if(!t)return l.push([e]),1;t.some((function(t){return(0,la.doesIntersect2)(t.start,t.end,e.start,e.end)}))?l.push([e]):t.push(e)};for(c.s();!(i=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}return l.map((function(t){return e(t,n,r)}))}(s,n,r),g=Ve(m);try{for(g.s();!(h=g.n()).done;){var y=h.value;a[y._id]=y}}catch(e){g.e(e)}finally{g.f()}var v,b=function(e,t,n,r,a){var o,i=[],s=Ve(n);try{for(s.s();!(o=s.n()).done;){var l,c=Ve(o.value);try{for(c.s();!(l=c.n()).done;){var u=l.value;if(!u.start||!u.end)throw new Error("UTR has undefined start and/or end\n: ".concat(JSON.stringify(u,null,2)));var d=void 0;"+"===u.strand?d=1:"-"===u.strand&&(d=-1),i.push({_id:(new ca.default).toHexString(),refSeq:r,type:"exon",min:u.start-1,max:u.end,strand:d})}}catch(e){c.e(e)}finally{c.f()}}}catch(e){s.e(e)}finally{s.f()}i.sort((function(e,t){return e.min-t.min}));var f,p=[],h=Ve(e);try{for(h.s();!(f=h.n()).done;){var m=f.value;m.sort((function(e,t){if(!e.start||!t.start)throw new Error("CDS has undefined start");return e.start-t.start}));for(var g=0;g<m.length;g++){var y,v=m[g],b=!1,_=Ve(t);try{for(_.s();!(y=_.n()).done;){var w=y.value;if(1!=w.length)throw new Error("Unexpected number of exons");var x=Be(w,1)[0];if(x.start&&x.end&&v.start&&v.end&&x.start<=v.start&&x.end>=v.end){b=!0;break}}}catch(e){_.e(e)}finally{_.f()}if(!b){if(!v.start||!v.end)throw new Error("CDS has undefined start and/or end: ".concat(JSON.stringify(v,null,2)));var S=void 0;"+"===v.strand?S=1:"-"===v.strand&&(S=-1);var E={_id:(new ca.default).toHexString(),refSeq:r,type:"exon",min:v.start-1,max:v.end,strand:S};if(0===g){var k,C=Ve(i);try{for(C.s();!(k=C.n()).done;){var A=k.value;if(A.max>E.min)break;A.max===E.min?E.min=A.min:p.push(A)}}catch(e){C.e(e)}finally{C.f()}}if(g===m.length-1){var O,T=Ve(i);try{for(T.s();!(O=T.n()).done;){var N=O.value;N.min<E.max||(N.min===E.max?E.max=N.max:p.push(N))}}catch(e){T.e(e)}finally{T.f()}}p.push(E)}}}}catch(e){h.e(e)}finally{h.f()}var R=function(e){if(0===e.length)return[];e.sort((function(e,t){return e.min-t.min}));var t=[];t.push(e[0]);for(var n=1;n<e.length;n++){var r=t.at(-1),a=e[n];r&&a.min<=r.max?r.max=Math.max(r.max,a.max):t.push(a)}return t}(p);if(a){var I,P=Ve(R);try{for(P.s();!(I=P.n()).done;){var F=I.value;a.includes(F._id)||a.push(F._id)}}catch(e){P.e(e)}finally{P.f()}}return R}(s,l,c,m[0].refSeq,r),_=Ve(b);try{for(_.s();!(v=_.n()).done;){var w=v.value;a[w._id]=w}}catch(e){_.e(e)}finally{_.f()}}return Object.keys(a).length>0?a:void 0}}(t,n,r),h=function(e){var t={},n=e.map((function(e){return e.score})).filter((function(e){return null!==e})),r=e.map((function(e){return e.source})).filter((function(e){return null!==e})),a=e.map((function(e){return e.attributes})).filter((function(e){return null!==e}));if(n.length>0){var o=Be(n,1)[0];n.length>1&&(o=n.reduce((function(e,t){return e+t}),0)/n.length),t.gff_score=[String(o)]}if(r.length>0){var i=Be(r,1)[0];r.length>1&&(i=Ue(new Set(r)).join(",")),t.gff_source=[i]}if(a.length>0){var s,l=Ve(a);try{for(l.s();!(s=l.n()).done;)for(var c=0,u=Object.entries(s.value);c<u.length;c++){var d=Be(u[c],2),f=d[0],p=d[1];if(p&&"Parent"!==f){var h=(0,ua.isGFFReservedAttribute)(f)?ua.gffToInternal[f]:f,m=t[h];if(m){var g=new Set([].concat(Ue(m),Ue(p)));t[h]=Ue(g)}else t[h]=p}}}catch(e){l.e(e)}finally{l.f()}}if(Object.keys(t).length>0)return t}(t),m={_id:(new ca.default).toHexString(),refSeq:null!=n?n:i,type:c,min:d,max:f};if(l)if("+"===l)m.strand=1;else{if("-"!==l)throw new Error('Unknown strand: "'.concat(l,'"'));m.strand=-1}return p&&(m.children=p),h&&(m.attributes=h),r&&r.push(m._id),m};var la=U.default,ca=Ct.__importDefault(_r),ua=ia;!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(na,e),t.__exportStar(ia,e),t.__exportStar(sa,e)}(ta),Object.defineProperty(ea,"__esModule",{value:!0}),ea.FromFileBaseChange=void 0;var da=ta,fa=function(e){Te(o,e);var t,n,r,a=De(o);function o(){var e;ke(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Oe(je(e=a.call.apply(a,[this].concat(n))),"refSeqCache",new Map),e}return Ae(o,[{key:"addRefSeqIntoDb",value:(r=Ee(we().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,R,I,P,F,M,j,D,L,B,q,U,z,G,H,$,W,V,J,Y;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.logger,i=r.filesService,s=r.refSeqChunkModel,l=r.refSeqModel,c=r.user,d=(u=fn.env.CHUNK_SIZE)&&Number(u),f=0,p=0,m="text/x-gff3"!==t.type,g=i.getFileStream(t),y="",v="",b=!0,_=!1,null===(a=o.debug)||void 0===a||a.call(o,"starting sequence stream"),w=0,x=!1,S=!1,e.prev=16,k=ge(g);case 18:return e.next=20,k.next();case 20:if(!(x=!(C=e.sent).done)){e.next=102;break}A=C.value.toString(),b=!A.endsWith("\n"),O=A.split(/\r?\n/),v&&(O[0]="".concat(v).concat(O[0]),v=""),b&&(v=O.pop()||""),T=!1,N=!1,e.prev=29,I=ge(O);case 31:return e.next=33,I.next();case 33:if(!(T=!(P=e.sent).done)){e.next=83;break}if(F=P.value,++w%1e6==0&&(null===(M=o.debug)||void 0===M||M.call(o,"Processed ".concat(w," lines"))),m){e.next=40;break}return"##FASTA"===F.trim()&&(m=!0),e.abrupt("continue",80);case 40:if(!(j=/^>\s*(\S+)\s*(.*)/.exec(F))){e.next=66;break}if(_=!0,null===(D=o.debug)||void 0===D||D.call(o,'Reference sequence information line "'.concat(j[0],'"')),""===y){e.next=51;break}if(h){e.next=47;break}throw new Error("No refSeq document found");case 47:return p+=y.length,e.next=50,s.create([{refSeq:h._id,n:f,sequence:y,user:c,status:-1}]);case 50:y="";case 51:return e.next=53,null===(L=h)||void 0===L?void 0:L.updateOne({length:p});case 53:return p=0,f=0,q=j[1].trim(),U=j[2]?j[2].trim():"",e.next=59,l.create([_e(_e({name:q,description:U,assembly:n,length:0},d?{chunkSize:d}:null),{},{user:c,status:-1})]);case 59:z=Be(e.sent,1),G=z[0],null===(B=o.debug)||void 0===B||B.call(o,'Added new refSeq "'.concat(q,'", desc "').concat(U,'", docId "').concat(G._id,'"')),h=G,e.next=80;break;case 66:if(!/\S/.test(F)){e.next=80;break}if(h){e.next=69;break}throw new Error("No refSeq document found");case 69:$=(H=h)._id,W=H.chunkSize,y+=F.replaceAll(/\s/g,"");case 71:if(!(y.length>=W)){e.next=80;break}return V=y.slice(0,W),p+=V.length,e.next=76,s.create([{refSeq:$,n:f,sequence:V,user:c,status:-1}]);case 76:f++,y=y.slice(W),e.next=71;break;case 80:T=!1,e.next=31;break;case 83:e.next=89;break;case 85:e.prev=85,e.t0=e.catch(29),N=!0,R=e.t0;case 89:if(e.prev=89,e.prev=90,!T||null==I.return){e.next=94;break}return e.next=94,I.return();case 94:if(e.prev=94,!N){e.next=97;break}throw R;case 97:return e.finish(94);case 98:return e.finish(89);case 99:x=!1,e.next=18;break;case 102:e.next=108;break;case 104:e.prev=104,e.t1=e.catch(16),S=!0,E=e.t1;case 108:if(e.prev=108,e.prev=109,!x||null==k.return){e.next=113;break}return e.next=113,k.return();case 113:if(e.prev=113,!S){e.next=116;break}throw E;case 116:return e.finish(113);case 117:return e.finish(108);case 118:if(_){e.next=120;break}throw new Error("No reference sequences found in file");case 120:if(!y&&!b){e.next=131;break}if(h){e.next=123;break}throw new Error("No refSeq document found");case 123:return b&&(y+=v),p+=y.length,null===(J=o.verbose)||void 0===J||J.call(o,'*** Add the very last chunk to ref seq ("'.concat(h._id,'", index ').concat(f," and total length for ref seq is ").concat(p,'): "').concat(y,'"')),null===(Y=o.debug)||void 0===Y||Y.call(o,"Creating refSeq chunk number ".concat(f,' of "').concat(h._id,'"')),e.next=129,s.create([{refSeq:h._id,n:f,sequence:y,user:c,status:-1}]);case 129:return e.next=131,h.updateOne({length:p});case 131:case"end":return e.stop()}}),e,this,[[16,104,108,118],[29,85,89,99],[90,,94,98],[109,,113,117]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"removeExistingFeatures",value:(n=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.featureModel,a=t.refSeqModel,o=this.assembly,null===(n=(i=this.logger).debug)||void 0===n||n.call(i,"Removing existing features for assembly = ".concat(o)),e.next=5,a.find({assembly:o}).exec();case 5:s=Ve(e.sent),e.prev=7,s.s();case 9:if((l=s.n()).done){e.next=15;break}return c=l.value,e.next=13,r.deleteMany({refSeq:c._id});case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s.e(e.t0);case 20:return e.prev=20,s.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[7,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"addFeatureIntoDb",value:(t=Ee(we().mark((function e(t,n){var r,a,o,i,s,l,c,u,d,f,p;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.featureModel,a=n.refSeqModel,o=n.user,i=this.assembly,s=this.refSeqCache,l=Be(t,1),c=l[0].seq_id){e.next=5;break}throw new Error("Valid seq_id not found in feature ".concat(JSON.stringify(t)));case 5:if(u=s.get(c)){e.next=20;break}return e.next=9,a.findOne({assembly:i,name:c}).exec();case 9:if(e.t1=d=e.sent,e.t0=null!==e.t1,!e.t0){e.next=13;break}e.t0=void 0!==d;case 13:if(!e.t0){e.next=17;break}e.t2=d,e.next=18;break;case 17:e.t2=void 0;case 18:(u=e.t2)&&s.set(c,u);case 20:if(u){e.next=22;break}throw new Error('RefSeq was not found by assembly "'.concat(i,'" and seq_id "').concat(c,'" not found'));case 22:return p=(0,da.gff3ToAnnotationFeature)(t,u._id,f=[]),e.next=26,r.create([_e(_e({allIds:f},p),{},{user:o,status:-1})]);case 26:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),o}(Rr.AssemblySpecificChange);ea.FromFileBaseChange=fa,Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.AddAssemblyAndFeaturesFromFileChange=void 0;var pa=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","AddAssemblyAndFeaturesFromFileChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=Be(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.fileModel,o=t.filesService,i=t.user,s=this.assembly,l=this.logger,c=Ve(this.changes),e.prev=3,c.s();case 5:if((u=c.n()).done){e.next=71;break}if(g=(m=u.value).assemblyName,y=m.fileIds.fa,fn.env.FILE_UPLOAD_FOLDER){e.next=12;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 12:return e.next=14,a.findById(y).exec();case 14:if(v=e.sent){e.next=17;break}throw new Error('File "'.concat(y,'" not found in Mongo'));case 17:return null===(d=l.debug)||void 0===d||d.call(l,'FileId "'.concat(y,'", checksum "').concat(v.checksum,'"')),e.next=20,n.findOne({name:g}).exec();case 20:if(!e.sent){e.next=23;break}throw new Error('Assembly "'.concat(g,'" already exists'));case 23:return e.next=25,r.find({default:!0}).exec();case 25:return b=e.sent.map((function(e){return e._id.toHexString()})),e.next=29,n.create([{_id:s,name:g,user:i,status:-1,fileId:y,checks:b}]);case 29:return _=Be(e.sent,1),w=_[0],null===(f=l.debug)||void 0===f||f.call(l,'Added new assembly "'.concat(g,'", docId "').concat(w._id.toHexString(),'"')),null===(p=l.debug)||void 0===p||p.call(l,'File type: "'.concat(v.type,'"')),e.next=36,this.addRefSeqIntoDb(v,w._id.toString(),t);case 36:null===(h=l.debug)||void 0===h||h.call(l,'**************** LOOPATAAN KAIKKI FEATURET SEURAAVAKSI File type: "'.concat(v.type,'"')),x=o.parseGFF3(o.getFileStream(v)),S=!1,E=!1,e.prev=40,C=ge(x);case 42:return e.next=44,C.next();case 44:if(!(S=!(A=e.sent).done)){e.next=53;break}return T=A.value,null===(O=l.verbose)||void 0===O||O.call(l,"ENTRY=".concat(JSON.stringify(T))),e.next=50,this.addFeatureIntoDb(T,t);case 50:S=!1,e.next=42;break;case 53:e.next=59;break;case 55:e.prev=55,e.t0=e.catch(40),E=!0,k=e.t0;case 59:if(e.prev=59,e.prev=60,!S||null==C.return){e.next=64;break}return e.next=64,C.return();case 64:if(e.prev=64,!E){e.next=67;break}throw k;case 67:return e.finish(64);case 68:return e.finish(59);case 69:e.next=5;break;case 71:e.next=76;break;case 73:e.prev=73,e.t1=e.catch(3),c.e(e.t1);case 76:return e.prev=76,c.f(),e.finish(76);case 79:case"end":return e.stop()}}),e,this,[[3,73,76,79],[40,55,59,69],[60,,64,68]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(ea.FromFileBaseChange);Qr.AddAssemblyAndFeaturesFromFileChange=pa;var ha={},ma={},ga=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ke(this,e),this.baseOverrides={},this.url=t;var r=n.fetch||globalThis.fetch.bind(globalThis);if(!r)throw new TypeError("no fetch function supplied, and none found in global environment");n.overrides&&(this.baseOverrides=n.overrides),this.fetchImplementation=r}var t,n,r,a,o,i;return Ae(e,[{key:"getBufferFromResponse",value:(i=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.buffer){e.next=4;break}return e.abrupt("return",t.buffer());case 4:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.next=7,t.arrayBuffer();case 7:return e.abrupt("return",kn.from(e.sent));case 11:throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method");case 12:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"fetch",value:(o=Ee(we().mark((function e(t,n){var r;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchImplementation(t,n);case 3:case 12:r=e.sent,e.next=16;break;case 6:if(e.prev=6,e.t0=e.catch(0),!"".concat(e.t0).includes("Failed to fetch")){e.next=15;break}return console.warn("generic-filehandle: refetching ".concat(t," to attempt to work around chrome CORS header caching bug")),e.next=12,this.fetchImplementation(t,_e(_e({},n),{},{cache:"reload"}));case 15:throw e.t0;case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e,t){return o.apply(this,arguments)})},{key:"read",value:(a=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:0,a=y.length>3&&void 0!==y[3]?y[3]:0,s=void 0===(i=(o=y.length>4&&void 0!==y[4]?y[4]:{}).headers)?{}:i,l=o.signal,u=void 0===(c=o.overrides)?{}:c,(r=y.length>2?y[2]:void 0)<Infinity?s.range="bytes=".concat(a,"-").concat(a+r):Infinity===r&&0!==a&&(s.range="bytes=".concat(a,"-")),d=_e(_e(_e({},this.baseOverrides),u),{},{headers:_e(_e(_e({},s),u.headers),this.baseOverrides.headers),method:"GET",redirect:"follow",mode:"cors",signal:l}),e.next=9,this.fetch(this.url,d);case 9:if((f=e.sent).ok){e.next=12;break}throw new Error("HTTP ".concat(f.status," ").concat(f.statusText," ").concat(this.url));case 12:if((200!==f.status||0!==a)&&206!==f.status){e.next=21;break}return e.next=15,this.getBufferFromResponse(f);case 15:return h=(p=e.sent).copy(t,n,0,Math.min(r,p.length)),m=f.headers.get("content-range"),(g=/\/(\d+)$/.exec(m||""))&&g[1]&&(this._stat={size:parseInt(g[1],10)}),e.abrupt("return",{bytesRead:h,buffer:t});case 21:if(200!==f.status){e.next=23;break}throw new Error("${this.url} fetch returned status 200, expected 206");case 23:throw new Error("HTTP ".concat(f.status," fetching ").concat(this.url));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Ee(we().mark((function e(){var t,n,r,a,o,i,s,l,c,u=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof(t=u.length>0&&void 0!==u[0]?u[0]:{})?(n=t,r={}):(n=t.encoding,delete(r=t).encoding),s=void 0===(i=(a=r).overrides)?{}:i,l=_e(_e({headers:void 0===(o=a.headers)?{}:o,method:"GET",redirect:"follow",mode:"cors",signal:a.signal},this.baseOverrides),s),e.next=6,this.fetch(this.url,l);case 6:if(c=e.sent){e.next=9;break}throw new Error("generic-filehandle failed to fetch");case 9:if(200===c.status){e.next=11;break}throw Object.assign(new Error("HTTP ".concat(c.status," fetching ").concat(this.url)),{status:c.status});case 11:if("utf8"!==n){e.next=13;break}return e.abrupt("return",c.text());case 13:if(!n){e.next=15;break}throw new Error("unsupported encoding: ".concat(n));case 15:return e.abrupt("return",this.getBufferFromResponse(c));case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stat",value:(n=Ee(we().mark((function e(){var t;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._stat){e.next=6;break}return t=kn.allocUnsafe(10),e.next=4,this.read(t,0,10,0);case 4:if(this._stat){e.next=6;break}throw new Error("unable to determine size of file at ".concat(this.url));case 6:return e.abrupt("return",this._stat);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ee(we().mark((function e(){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function ya(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"!=typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsArrayBuffer(e)}))}function va(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"==typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsText(e)}))}var ba=function(){function e(t){ke(this,e),this.blob=t,this.size=t.size}var t,n,r,a;return Ae(e,[{key:"read",value:(a=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,a=c.length>3&&void 0!==c[3]?c[3]:0,r=c.length>2?c[2]:void 0){e.next=5;break}return e.abrupt("return",{bytesRead:0,buffer:t});case 5:return i=(o=a)+r,e.next=9,ya(this.blob.slice(o,i));case 9:return s=kn.from(e.sent),l=s.copy(t,n),e.abrupt("return",{bytesRead:l,buffer:s});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Ee(we().mark((function e(t){var n;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("utf8"!==(n="string"==typeof t?t:t&&t.encoding)){e.next=3;break}return e.abrupt("return",va(this.blob));case 3:if(!n){e.next=5;break}throw new Error("unsupported encoding: ".concat(n));case 5:return e.next=7,ya(this.blob);case 7:return e.abrupt("return",kn.from(e.sent));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stat",value:(n=Ee(we().mark((function e(){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{size:this.size});case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ee(we().mark((function e(){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function _a(e){return new ga(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}var wa={__proto__:null,open:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0!==n)return n;if(void 0!==e)return _a(e,r);if(void 0!==t)return new ma(t,r);throw new Error("no url, path, or filehandle provided, cannot open")},fromUrl:_a,RemoteFile:ga,LocalFile:ma,BlobFile:ba},xa={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==xe(r))throw new TypeError(r+"must be non-object");for(var a in r)n(r,a)&&(e[a]=r[a])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,r,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),a);else for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){var t,n,r,a,o,i;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(i=new Uint8Array(r),a=0,t=0,n=e.length;t<n;t++)i.set(o=e[t],a),a+=o.length;return i}},a={arraySet:function(e,t,n,r,a){for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(t)}(xa);var Sa={},Ea={},ka={},Ca=xa;function Aa(e){for(var t=e.length;--t>=0;)e[t]=0}var Oa=15,Ta=16,Na=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ra=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ia=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Pa=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Fa=new Array(576);Aa(Fa);var Ma=new Array(60);Aa(Ma);var ja=new Array(512);Aa(ja);var Da=new Array(256);Aa(Da);var La=new Array(29);Aa(La);var Ba,qa,Ua,za=new Array(30);function Ga(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function Ha(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function $a(e){return e<256?ja[e]:ja[256+(e>>>7)]}function Wa(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function Va(e,t,n){e.bi_valid>Ta-n?(e.bi_buf|=t<<e.bi_valid&65535,Wa(e,e.bi_buf),e.bi_buf=t>>Ta-e.bi_valid,e.bi_valid+=n-Ta):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Ja(e,t,n){Va(e,n[2*t],n[2*t+1])}function Ya(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Ka(e,t,n){var r,a,o=new Array(Oa+1),i=0;for(r=1;r<=Oa;r++)o[r]=i=i+n[r-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=Ya(o[s]++,s))}}function Za(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Xa(e){e.bi_valid>8?Wa(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Qa(e,t,n,r){var a=2*t,o=2*n;return e[a]<e[o]||e[a]===e[o]&&r[t]<=r[n]}function eo(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Qa(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Qa(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r}function to(e,t,n){var r,a,o,i,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===r?Ja(e,a,t):(Ja(e,(o=Da[a])+256+1,t),0!==(i=Na[o])&&Va(e,a-=La[o],i),Ja(e,o=$a(--r),n),0!==(i=Ra[o])&&Va(e,r-=za[o],i))}while(s<e.last_lit);Ja(e,256,t)}function no(e,t){var n,r,a,o=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=i[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)eo(e,o,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],eo(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*a]=o[2*n]+o[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=a,e.heap[1]=a++,eo(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,a,o,i,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(o=0;o<=Oa;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(r=e.heap[n])+1]+1]+1)>h&&(o=h,m++),l[2*r+1]=o,r>c||(e.bl_count[o]++,i=0,r>=p&&(i=f[r-p]),e.opt_len+=(s=l[2*r])*(o+i),d&&(e.static_len+=s*(u[2*r+1]+i)));if(0!==m){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(o=h;0!==o;o--)for(r=e.bl_count[o];0!==r;)(a=e.heap[--n])>c||(l[2*a+1]!==o&&(e.opt_len+=(o-l[2*a+1])*l[2*a],l[2*a+1]=o),r--)}}(e,t),Ka(o,c,e.bl_count)}function ro(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=i,i=t[2*(r+1)+1],++s<l&&a===i||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4))}function ao(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),r=0;r<=n;r++)if(a=i,i=t[2*(r+1)+1],!(++s<l&&a===i)){if(s<c)do{Ja(e,a,e.bl_tree)}while(0!=--s);else 0!==a?(a!==o&&(Ja(e,a,e.bl_tree),s--),Ja(e,16,e.bl_tree),Va(e,s-3,2)):s<=10?(Ja(e,17,e.bl_tree),Va(e,s-3,3)):(Ja(e,18,e.bl_tree),Va(e,s-11,7));s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4)}}Aa(za);var oo=!1;function io(e,t,n,r){Va(e,0+(r?1:0),3),function(e,t,n,r){Xa(e),Wa(e,n),Wa(e,~n),Ca.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}ka._tr_init=function(e){oo||(function(){var e,t,n,r,a,o=new Array(Oa+1);for(n=0,r=0;r<28;r++)for(La[r]=n,e=0;e<1<<Na[r];e++)Da[n++]=r;for(Da[n-1]=r,a=0,r=0;r<16;r++)for(za[r]=a,e=0;e<1<<Ra[r];e++)ja[a++]=r;for(a>>=7;r<30;r++)for(za[r]=a<<7,e=0;e<1<<Ra[r]-7;e++)ja[256+a++]=r;for(t=0;t<=Oa;t++)o[t]=0;for(e=0;e<=143;)Fa[2*e+1]=8,e++,o[8]++;for(;e<=255;)Fa[2*e+1]=9,e++,o[9]++;for(;e<=279;)Fa[2*e+1]=7,e++,o[7]++;for(;e<=287;)Fa[2*e+1]=8,e++,o[8]++;for(Ka(Fa,287,o),e=0;e<30;e++)Ma[2*e+1]=5,Ma[2*e]=Ya(e,5);Ba=new Ga(Fa,Na,257,286,Oa),qa=new Ga(Ma,Ra,0,30,Oa),Ua=new Ga(new Array(0),Ia,0,19,7)}(),oo=!0),e.l_desc=new Ha(e.dyn_ltree,Ba),e.d_desc=new Ha(e.dyn_dtree,qa),e.bl_desc=new Ha(e.bl_tree,Ua),e.bi_buf=0,e.bi_valid=0,Za(e)},ka._tr_stored_block=io,ka._tr_flush_block=function(e,t,n,r){var a,o,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),no(e,e.l_desc),no(e,e.d_desc),i=function(e){var t;for(ro(e,e.dyn_ltree,e.l_desc.max_code),ro(e,e.dyn_dtree,e.d_desc.max_code),no(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Pa[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(o=e.static_len+3+7>>>3)<=(a=e.opt_len+3+7>>>3)&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?io(e,t,n,r):4===e.strategy||o===a?(Va(e,2+(r?1:0),3),to(e,Fa,Ma)):(Va(e,4+(r?1:0),3),function(e,t,n,r){var a;for(Va(e,t-257,5),Va(e,n-1,5),Va(e,r-4,4),a=0;a<r;a++)Va(e,e.bl_tree[2*Pa[a]+1],3);ao(e,e.dyn_ltree,t-1),ao(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),to(e,e.dyn_ltree,e.dyn_dtree)),Za(e),r&&Xa(e)},ka._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Da[n]+256+1)]++,e.dyn_dtree[2*$a(t)]++),e.last_lit===e.lit_bufsize-1},ka._tr_align=function(e){Va(e,2,3),Ja(e,256,Fa),function(e){16===e.bi_valid?(Wa(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var so=function(e,t,n,r){for(var a=65535&e|0,o=e>>>16&65535|0,i=0;0!==n;){n-=i=n>2e3?2e3:n;do{o=o+(a=a+t[r++]|0)|0}while(--i);a%=65521,o%=65521}return a|o<<16|0};function lo(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var co,uo=lo(),fo=function(e,t,n,r){var a=uo,o=r+n;e^=-1;for(var i=r;i<o;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},po={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ho=xa,mo=ka,go=so,yo=fo,vo=po,bo=0,_o=0,wo=-2,xo=2,So=8,Eo=286,ko=30,Co=19,Ao=2*Eo+1,Oo=15,To=3,No=258,Ro=No+To+1,Io=42,Po=103,Fo=113,Mo=666;function jo(e,t){return e.msg=vo[t],t}function Do(e){return(e<<1)-(e>4?9:0)}function Lo(e){for(var t=e.length;--t>=0;)e[t]=0}function Bo(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(ho.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function qo(e,t){mo._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Bo(e.strm)}function Uo(e,t){e.pending_buf[e.pending++]=t}function zo(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Go(e,t){var n,r,a=e.max_chain_length,o=e.strstart,i=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-Ro?e.strstart-(e.w_size-Ro):0,c=e.window,u=e.w_mask,d=e.prev,f=e.strstart+No,p=c[o+i-1],h=c[o+i];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+i]===h&&c[n+i-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<f);if(r=No-(f-o),o=f-No,r>i){if(e.match_start=t,i=r,r>=s)break;p=c[o+i-1],h=c[o+i]}}}while((t=d[t&u])>l&&0!=--a);return i<=e.lookahead?i:e.lookahead}function Ho(e){var t,n,r,a,o,i,s,l,c,u,d=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-Ro)){ho.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=d?r-d:0}while(--n);t=n=d;do{r=e.prev[--t],e.prev[t]=r>=d?r-d:0}while(--n);a+=d}if(0===e.strm.avail_in)break;if(s=e.window,l=e.strstart+e.lookahead,u=void 0,(u=(i=e.strm).avail_in)>(c=a)&&(u=c),n=0===u?0:(i.avail_in-=u,ho.arraySet(s,i.input,i.next_in,u,l),1===i.state.wrap?i.adler=go(i.adler,s,u,l):2===i.state.wrap&&(i.adler=yo(i.adler,s,u,l)),i.next_in+=u,i.total_in+=u,u),e.lookahead+=n,e.lookahead+e.insert>=To)for(e.ins_h=e.window[o=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+To-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<To)););}while(e.lookahead<Ro&&0!==e.strm.avail_in)}function $o(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ho(e),0===e.lookahead&&t===bo)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,qo(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Ro&&(qo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(qo(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&qo(e,!1),1)}function Wo(e,t){for(var n,r;;){if(e.lookahead<Ro){if(Ho(e),e.lookahead<Ro&&t===bo)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=To&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+To-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Ro&&(e.match_length=Go(e,n)),e.match_length>=To)if(r=mo._tr_tally(e,e.strstart-e.match_start,e.match_length-To),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=To){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+To-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=mo._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(qo(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<To-1?e.strstart:To-1,4===t?(qo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(qo(e,!1),0===e.strm.avail_out)?1:2}function Vo(e,t){for(var n,r,a;;){if(e.lookahead<Ro){if(Ho(e),e.lookahead<Ro&&t===bo)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=To&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+To-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=To-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Ro&&(e.match_length=Go(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===To&&e.strstart-e.match_start>4096)&&(e.match_length=To-1)),e.prev_length>=To&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-To,r=mo._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-To),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+To-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=To-1,e.strstart++,r&&(qo(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=mo._tr_tally(e,0,e.window[e.strstart-1]))&&qo(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=mo._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<To-1?e.strstart:To-1,4===t?(qo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(qo(e,!1),0===e.strm.avail_out)?1:2}function Jo(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}function Yo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=So,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ho.Buf16(2*Ao),this.dyn_dtree=new ho.Buf16(2*(2*ko+1)),this.bl_tree=new ho.Buf16(2*(2*Co+1)),Lo(this.dyn_ltree),Lo(this.dyn_dtree),Lo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ho.Buf16(Oo+1),this.heap=new ho.Buf16(2*Eo+1),Lo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ho.Buf16(2*Eo+1),Lo(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ko(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=xo,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?Io:Fo,e.adler=2===t.wrap?0:1,t.last_flush=bo,mo._tr_init(t),_o):jo(e,wo)}function Zo(e){var t,n=Ko(e);return n===_o&&((t=e.state).window_size=2*t.w_size,Lo(t.head),t.max_lazy_match=co[t.level].max_lazy,t.good_match=co[t.level].good_length,t.nice_match=co[t.level].nice_length,t.max_chain_length=co[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=To-1,t.match_available=0,t.ins_h=0),n}function Xo(e,t,n,r,a,o){if(!e)return wo;var i=1;if(-1===t&&(t=6),r<0?(i=0,r=-r):r>15&&(i=2,r-=16),a<1||a>9||n!==So||r<8||r>15||t<0||t>9||o<0||o>4)return jo(e,wo);8===r&&(r=9);var s=new Yo;return e.state=s,s.strm=e,s.wrap=i,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=a+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+To-1)/To),s.window=new ho.Buf8(2*s.w_size),s.head=new ho.Buf16(s.hash_size),s.prev=new ho.Buf16(s.w_size),s.lit_bufsize=1<<a+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new ho.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,Zo(e)}co=[new Jo(0,0,0,0,$o),new Jo(4,4,8,4,Wo),new Jo(4,5,16,8,Wo),new Jo(4,6,32,32,Wo),new Jo(4,4,16,16,Vo),new Jo(8,16,32,32,Vo),new Jo(8,16,128,128,Vo),new Jo(8,32,128,256,Vo),new Jo(32,128,258,1024,Vo),new Jo(32,258,258,4096,Vo)],Ea.deflateInit=function(e,t){return Xo(e,t,So,15,8,0)},Ea.deflateInit2=Xo,Ea.deflateReset=Zo,Ea.deflateResetKeep=Ko,Ea.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?wo:(e.state.gzhead=t,_o):wo},Ea.deflate=function(e,t){var n,r,a,o;if(!e||!e.state||t>5||t<0)return e?jo(e,wo):wo;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===Mo&&4!==t)return jo(e,0===e.avail_out?-5:wo);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===Io)if(2===r.wrap)e.adler=0,Uo(r,31),Uo(r,139),Uo(r,8),r.gzhead?(Uo(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Uo(r,255&r.gzhead.time),Uo(r,r.gzhead.time>>8&255),Uo(r,r.gzhead.time>>16&255),Uo(r,r.gzhead.time>>24&255),Uo(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Uo(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Uo(r,255&r.gzhead.extra.length),Uo(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=yo(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Uo(r,0),Uo(r,0),Uo(r,0),Uo(r,0),Uo(r,0),Uo(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),Uo(r,3),r.status=Fo);else{var i=So+(r.w_bits-8<<4)<<8;i|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(i|=32),i+=31-i%31,r.status=Fo,zo(r,i),0!==r.strstart&&(zo(r,e.adler>>>16),zo(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),Bo(e),a=r.pending,r.pending!==r.pending_buf_size));)Uo(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),Bo(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Uo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),Bo(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Uo(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=yo(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.status=Po)}else r.status=Po;if(r.status===Po&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Bo(e),r.pending+2<=r.pending_buf_size&&(Uo(r,255&e.adler),Uo(r,e.adler>>8&255),e.adler=0,r.status=Fo)):r.status=Fo),0!==r.pending){if(Bo(e),0===e.avail_out)return r.last_flush=-1,_o}else if(0===e.avail_in&&Do(t)<=Do(n)&&4!==t)return jo(e,-5);if(r.status===Mo&&0!==e.avail_in)return jo(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==bo&&r.status!==Mo){var s=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(Ho(e),0===e.lookahead)){if(t===bo)return 1;break}if(e.match_length=0,n=mo._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(qo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(qo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(qo(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,r,a,o,i=e.window;;){if(e.lookahead<=No){if(Ho(e),e.lookahead<=No&&t===bo)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=To&&e.strstart>0&&(r=i[a=e.strstart-1])===i[++a]&&r===i[++a]&&r===i[++a]){o=e.strstart+No;do{}while(r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&a<o);e.match_length=No-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=To?(n=mo._tr_tally(e,1,e.match_length-To),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=mo._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(qo(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(qo(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(qo(e,!1),0===e.strm.avail_out)?1:2}(r,t):co[r.level].func(r,t);if(3!==s&&4!==s||(r.status=Mo),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),_o;if(2===s&&(1===t?mo._tr_align(r):5!==t&&(mo._tr_stored_block(r,0,0,!1),3===t&&(Lo(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Bo(e),0===e.avail_out))return r.last_flush=-1,_o}return 4!==t?_o:r.wrap<=0?1:(2===r.wrap?(Uo(r,255&e.adler),Uo(r,e.adler>>8&255),Uo(r,e.adler>>16&255),Uo(r,e.adler>>24&255),Uo(r,255&e.total_in),Uo(r,e.total_in>>8&255),Uo(r,e.total_in>>16&255),Uo(r,e.total_in>>24&255)):(zo(r,e.adler>>>16),zo(r,65535&e.adler)),Bo(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?_o:1)},Ea.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==Io&&69!==t&&73!==t&&91!==t&&t!==Po&&t!==Fo&&t!==Mo?jo(e,wo):(e.state=null,t===Fo?jo(e,-3):_o):wo},Ea.deflateSetDictionary=function(e,t){var n,r,a,o,i,s,l,c,u=t.length;if(!e||!e.state)return wo;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==Io||n.lookahead)return wo;for(1===o&&(e.adler=go(e.adler,t,u,0)),n.wrap=0,u>=n.w_size&&(0===o&&(Lo(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new ho.Buf8(n.w_size),ho.arraySet(c,t,u-n.w_size,n.w_size,0),t=c,u=n.w_size),i=e.avail_in,s=e.next_in,l=e.input,e.avail_in=u,e.next_in=0,e.input=t,Ho(n);n.lookahead>=To;){r=n.strstart,a=n.lookahead-(To-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+To-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=To-1,Ho(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=To-1,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=i,n.wrap=o,_o},Ea.deflateInfo="pako deflate (from Nodeca project)";var Qo={},ei=xa,ti=!0,ni=!0;try{String.fromCharCode.apply(null,[0])}catch(e){ti=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){ni=!1}for(var ri=new ei.Buf8(256),ai=0;ai<256;ai++)ri[ai]=ai>=252?6:ai>=248?5:ai>=240?4:ai>=224?3:ai>=192?2:1;function oi(e,t){if(t<65534&&(e.subarray&&ni||!e.subarray&&ti))return String.fromCharCode.apply(null,ei.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}ri[254]=ri[254]=1,Qo.string2buf=function(e){var t,n,r,a,o,i=e.length,s=0;for(a=0;a<i;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new ei.Buf8(s),o=0,a=0;o<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},Qo.buf2binstring=function(e){return oi(e,e.length)},Qo.binstring2buf=function(e){for(var t=new ei.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},Qo.buf2string=function(e,t){var n,r,a,o,i=t||e.length,s=new Array(2*i);for(r=0,n=0;n<i;)if((a=e[n++])<128)s[r++]=a;else if((o=ri[a])>4)s[r++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<i;)a=a<<6|63&e[n++],o--;o>1?s[r++]=65533:a<65536?s[r++]=a:(s[r++]=55296|(a-=65536)>>10&1023,s[r++]=56320|1023&a)}return oi(s,r)},Qo.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+ri[e[n]]>t?n:t};var ii=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},si=Ea,li=xa,ci=Qo,ui=po,di=ii,fi=Object.prototype.toString,pi=0,hi=-1,mi=0,gi=8;function yi(e){if(!(this instanceof yi))return new yi(e);this.options=li.assign({level:hi,method:gi,chunkSize:16384,windowBits:15,memLevel:8,strategy:mi,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new di,this.strm.avail_out=0;var n=si.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==pi)throw new Error(ui[n]);if(t.header&&si.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?ci.string2buf(t.dictionary):"[object ArrayBuffer]"===fi.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=si.deflateSetDictionary(this.strm,r))!==pi)throw new Error(ui[n]);this._dict_set=!0}}function vi(e,t){var n=new yi(t);if(n.push(e,!0),n.err)throw n.msg||ui[n.err];return n.result}yi.prototype.push=function(e,t){var n,r,a=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,a.input="string"==typeof e?ci.string2buf(e):"[object ArrayBuffer]"===fi.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new li.Buf8(o),a.next_out=0,a.avail_out=o),1!==(n=si.deflate(a,r))&&n!==pi)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?ci.buf2binstring(li.shrinkBuf(a.output,a.next_out)):li.shrinkBuf(a.output,a.next_out))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===r?(n=si.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===pi):2!==r||(this.onEnd(pi),a.avail_out=0,!0)},yi.prototype.onData=function(e){this.chunks.push(e)},yi.prototype.onEnd=function(e){e===pi&&(this.result="string"===this.options.to?this.chunks.join(""):li.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Sa.Deflate=yi,Sa.deflate=vi,Sa.deflateRaw=function(e,t){return(t=t||{}).raw=!0,vi(e,t)},Sa.gzip=function(e,t){return(t=t||{}).gzip=!0,vi(e,t)};var bi={},_i={},wi=xa,xi=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Si=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Ei=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],ki=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Ci=xa,Ai=so,Oi=fo,Ti=function(e,t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C;k=e.input,a=(r=e.next_in)+(e.avail_in-5),C=e.output,i=(o=e.next_out)-(t-e.avail_out),s=o+(e.avail_out-257),l=(n=e.state).dmax,c=n.wsize,u=n.whave,d=n.wnext,f=n.window,p=n.hold,h=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=m[p&y];t:for(;;){if(p>>>=_=b>>>24,h-=_,0==(_=b>>>16&255))C[o++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(p&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(_&=15)&&(h<_&&(p+=k[r++]<<h,h+=8),w+=p&(1<<_)-1,p>>>=_,h-=_),h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=g[p&v];n:for(;;){if(p>>>=_=b>>>24,h-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=g[(65535&b)+(p&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(x=65535&b,h<(_&=15)&&(p+=k[r++]<<h,(h+=8)<_&&(p+=k[r++]<<h,h+=8)),(x+=p&(1<<_)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=_,h-=_,x>(_=o-i)){if((_=x-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,E=f,0===d){if(S+=c-_,_<w){w-=_;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}}else if(d<_){if(S+=c+d-_,(_-=d)<w){w-=_;do{C[o++]=f[S++]}while(--_);if(S=0,d<w){w-=_=d;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}}}else if(S+=d-_,_<w){w-=_;do{C[o++]=f[S++]}while(--_);S=o-x,E=C}for(;w>2;)C[o++]=E[S++],C[o++]=E[S++],C[o++]=E[S++],w-=3;w&&(C[o++]=E[S++],w>1&&(C[o++]=E[S++]))}else{S=o-x;do{C[o++]=C[S++],C[o++]=C[S++],C[o++]=C[S++],w-=3}while(w>2);w&&(C[o++]=C[S++],w>1&&(C[o++]=C[S++]))}break}}break}}while(r<a&&o<s);p&=(1<<(h-=(w=h>>3)<<3))-1,e.next_in=r-=w,e.next_out=o,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=h},Ni=function(e,t,n,r,a,o,i,s){var l,c,u,d,f,p,h,m,g,y=s.bits,v=0,b=0,_=0,w=0,x=0,S=0,E=0,k=0,C=0,A=0,O=null,T=0,N=new wi.Buf16(16),R=new wi.Buf16(16),I=null,P=0;for(v=0;v<=15;v++)N[v]=0;for(b=0;b<r;b++)N[t[n+b]]++;for(x=y,w=15;w>=1&&0===N[w];w--);if(x>w&&(x=w),0===w)return a[o++]=20971520,a[o++]=20971520,s.bits=1,0;for(_=1;_<w&&0===N[_];_++);for(x<_&&(x=_),k=1,v=1;v<=15;v++)if(k<<=1,(k-=N[v])<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(R[1]=0,v=1;v<15;v++)R[v+1]=R[v]+N[v];for(b=0;b<r;b++)0!==t[n+b]&&(i[R[t[n+b]]++]=b);if(0===e?(O=I=i,p=19):1===e?(O=xi,T-=257,I=Si,P-=257,p=256):(O=Ei,I=ki,p=-1),A=0,b=0,v=_,f=o,S=x,E=0,u=-1,d=(C=1<<x)-1,1===e&&C>852||2===e&&C>592)return 1;for(;;){h=v-E,i[b]<p?(m=0,g=i[b]):i[b]>p?(m=I[P+i[b]],g=O[T+i[b]]):(m=96,g=0),l=1<<v-E,_=c=1<<S;do{a[f+(A>>E)+(c-=l)]=h<<24|m<<16|g|0}while(0!==c);for(l=1<<v-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,b++,0==--N[v]){if(v===w)break;v=t[n+i[b]]}if(v>x&&(A&d)!==u){for(0===E&&(E=x),f+=_,k=1<<(S=v-E);S+E<w&&!((k-=N[S+E])<=0);)S++,k<<=1;if(C+=1<<S,1===e&&C>852||2===e&&C>592)return 1;a[u=A&d]=x<<24|S<<16|f-o|0}}return 0!==A&&(a[f+A]=v-E<<24|64<<16|0),s.bits=x,0},Ri=0,Ii=-2,Pi=1,Fi=12,Mi=30,ji=852,Di=592;function Li(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Bi(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Ci.Buf16(320),this.work=new Ci.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function qi(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Pi,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Ci.Buf32(ji),t.distcode=t.distdyn=new Ci.Buf32(Di),t.sane=1,t.back=-1,Ri):Ii}function Ui(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,qi(e)):Ii}function zi(e,t){var n,r;return e&&e.state?(t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ii:(null!==(r=e.state).window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Ui(e))):Ii}function Gi(e,t){var n,r;return e?(r=new Bi,e.state=r,r.window=null,(n=zi(e,t))!==Ri&&(e.state=null),n):Ii}var Hi,$i,Wi=!0;function Vi(e){if(Wi){var t;for(Hi=new Ci.Buf32(512),$i=new Ci.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ni(1,e.lens,0,288,Hi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ni(2,e.lens,0,32,$i,0,e.work,{bits:5}),Wi=!1}e.lencode=Hi,e.lenbits=9,e.distcode=$i,e.distbits=5}function Ji(e,t,n,r){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Ci.Buf8(o.wsize)),r>=o.wsize?(Ci.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>r&&(a=r),Ci.arraySet(o.window,t,n-r,a,o.wnext),(r-=a)?(Ci.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}_i.inflateReset=Ui,_i.inflateReset2=zi,_i.inflateResetKeep=qi,_i.inflateInit=function(e){return Gi(e,15)},_i.inflateInit2=Gi,_i.inflate=function(e,t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C=0,A=new Ci.Buf8(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Ii;(n=e.state).mode===Fi&&(n.mode=13),i=e.next_out,a=e.output,o=e.next_in,r=e.input,c=n.hold,u=n.bits,d=s=e.avail_in,f=l=e.avail_out,S=Ri;e:for(;;)switch(n.mode){case Pi:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,A[0]=255&c,A[1]=c>>>8&255,n.check=Oi(n.check,A,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Mi;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=Mi;break}if(u-=4,x=8+(15&(c>>>=4)),0===n.wbits)n.wbits=x;else if(x>n.wbits){e.msg="invalid window size",n.mode=Mi;break}n.dmax=1<<x,e.adler=n.check=1,n.mode=512&c?10:Fi,c=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=Mi;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Mi;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Oi(n.check,A,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,n.check=Oi(n.check,A,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Oi(n.check,A,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(A[0]=255&c,A[1]=c>>>8&255,n.check=Oi(n.check,A,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Ci.arraySet(n.head.extra,r,o,p,x)),512&n.flags&&(n.check=Oi(n.check,r,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=Oi(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=Oi(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Mi;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Fi;break;case 10:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}e.adler=n.check=Li(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,2;e.adler=n.check=1,n.mode=Fi;case Fi:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(Vi(n),n.mode=20,6===t){c>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=Mi}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Mi;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>s&&(p=s),p>l&&(p=l),0===p)break e;Ci.arraySet(a,r,o,p,i),s-=p,o+=p,l-=p,i+=p,n.length-=p;break}n.mode=Fi;break;case 17:for(;u<14;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.nlen=257+(31&c),u-=5,n.ndist=1+(31&(c>>>=5)),u-=5,n.ncode=4+(15&(c>>>=5)),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Mi;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.lens[O[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S=Ni(0,n.lens,0,19,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid code lengths set",n.mode=Mi;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(k=g+2;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=Mi;break}x=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(k=g+3;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(k=g+7;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Mi;break}for(;p--;)n.lens[n.have++]=x}}if(n.mode===Mi)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Mi;break}if(n.lenbits=9,S=Ni(1,n.lens,0,n.nlen,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid literal/lengths set",n.mode=Mi;break}if(n.distbits=6,n.distcode=n.distdyn,S=Ni(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E={bits:n.distbits}),n.distbits=E.bits,S){e.msg="invalid distances set",n.mode=Mi;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&l>=258){e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,Ti(e,f),i=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,c=n.hold,u=n.bits,n.mode===Fi&&(n.back=-1);break}for(n.back=0;y=(C=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(y&&0==(240&y)){for(b=g,_=y,w=v;y=(C=n.lencode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===y){n.mode=26;break}if(32&y){n.back=-1,n.mode=Fi;break}if(64&y){e.msg="invalid literal/length code",n.mode=Mi;break}n.extra=15&y,n.mode=22;case 22:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;y=(C=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&C,!((g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(0==(240&y)){for(b=g,_=y,w=v;y=(C=n.distcode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&C,!(b+(g=C>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,64&y){e.msg="invalid distance code",n.mode=Mi;break}n.offset=v,n.extra=15&y,n.mode=24;case 24:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Mi;break}n.mode=25;case 25:if(0===l)break e;if(n.offset>(p=f-l)){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Mi;break}h=p>n.wnext?n.wsize-(p-=n.wnext):n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=a,h=i-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{a[i++]=m[h++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;a[i++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===s)break e;s--,c|=r[o++]<<u,u+=8}if(e.total_out+=f-=l,n.total+=f,f&&(e.adler=n.check=n.flags?Oi(n.check,a,f,i-f):Ai(n.check,a,f,i-f)),f=l,(n.flags?c:Li(c))!==n.check){e.msg="incorrect data check",n.mode=Mi;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Mi;break}c=0,u=0}n.mode=29;case 29:S=1;break e;case Mi:S=-3;break e;case 31:return-4;default:return Ii}return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,(n.wsize||f!==e.avail_out&&n.mode<Mi&&(n.mode<27||4!==t))&&Ji(e,e.output,e.next_out,f-e.avail_out),f-=e.avail_out,e.total_in+=d-=e.avail_in,e.total_out+=f,n.total+=f,n.wrap&&f&&(e.adler=n.check=n.flags?Oi(n.check,a,f,e.next_out-f):Ai(n.check,a,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Fi?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===f||4===t)&&S===Ri&&(S=-5),S},_i.inflateEnd=function(e){if(!e||!e.state)return Ii;var t=e.state;return t.window&&(t.window=null),e.state=null,Ri},_i.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?Ii:(n.head=t,t.done=!1,Ri):Ii},_i.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?Ii:11===n.mode&&Ai(1,t,r,0)!==n.check?-3:Ji(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,Ri):Ii},_i.inflateInfo="pako inflate (from Nodeca project)";var Yi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ki=_i,Zi=xa,Xi=Qo,Qi=Yi,es=po,ts=ii,ns=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},rs=Object.prototype.toString;function as(e){if(!(this instanceof as))return new as(e);this.options=Zi.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ts,this.strm.avail_out=0;var n=Ki.inflateInit2(this.strm,t.windowBits);if(n!==Qi.Z_OK)throw new Error(es[n]);if(this.header=new ns,Ki.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Xi.string2buf(t.dictionary):"[object ArrayBuffer]"===rs.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ki.inflateSetDictionary(this.strm,t.dictionary))!==Qi.Z_OK))throw new Error(es[n])}function os(e,t){var n=new as(t);if(n.push(e,!0),n.err)throw n.msg||es[n.err];return n.result}as.prototype.push=function(e,t){var n,r,a,o,i,s=this.strm,l=this.options.chunkSize,c=this.options.dictionary,u=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?Qi.Z_FINISH:Qi.Z_NO_FLUSH,s.input="string"==typeof e?Xi.binstring2buf(e):"[object ArrayBuffer]"===rs.call(e)?new Uint8Array(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new Zi.Buf8(l),s.next_out=0,s.avail_out=l),(n=Ki.inflate(s,Qi.Z_NO_FLUSH))===Qi.Z_NEED_DICT&&c&&(n=Ki.inflateSetDictionary(this.strm,c)),n===Qi.Z_BUF_ERROR&&!0===u&&(n=Qi.Z_OK,u=!1),n!==Qi.Z_STREAM_END&&n!==Qi.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==Qi.Z_STREAM_END&&(0!==s.avail_in||r!==Qi.Z_FINISH&&r!==Qi.Z_SYNC_FLUSH)||("string"===this.options.to?(a=Xi.utf8border(s.output,s.next_out),o=s.next_out-a,i=Xi.buf2string(s.output,a),s.next_out=o,s.avail_out=l-o,o&&Zi.arraySet(s.output,s.output,a,o,0),this.onData(i)):this.onData(Zi.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==Qi.Z_STREAM_END);return n===Qi.Z_STREAM_END&&(r=Qi.Z_FINISH),r===Qi.Z_FINISH?(n=Ki.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qi.Z_OK):r!==Qi.Z_SYNC_FLUSH||(this.onEnd(Qi.Z_OK),s.avail_out=0,!0)},as.prototype.onData=function(e){this.chunks.push(e)},as.prototype.onEnd=function(e){e===Qi.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):Zi.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},bi.Inflate=as,bi.inflate=os,bi.inflateRaw=function(e,t){return(t=t||{}).raw=!0,os(e,t)},bi.ungzip=os;var is={};(0,xa.assign)(is,Sa,bi,Yi);var ss=is;function ls(e){return cs.apply(this,arguments)}function cs(){return cs=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,a=0,o=[],i=0;case 5:if(l=t.subarray(r),s=new ss.Inflate,n=s.strm,s.push(l,ss.Z_SYNC_FLUSH),!s.err){e.next=12;break}throw new Error(s.msg);case 12:r+=n.next_in,o[a]=s.result,i+=o[a].length,a+=1;case 16:if(n.avail_in){e.next=5;break}case 17:for(c=new Uint8Array(i),u=0,d=0;u<o.length;u++)c.set(o[u],d),d+=o[u].length;return e.abrupt("return",kn.from(c));case 22:if(e.prev=22,e.t0=e.catch(0),!"".concat(e.t0).match(/incorrect header check/)){e.next=26;break}throw new Error("problem decompressing block: incorrect gzip header check");case 26:throw e.t0;case 27:case"end":return e.stop()}}),e,null,[[0,22]])}))),cs.apply(this,arguments)}var us=null;try{us=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(kc){}function ds(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function fs(e){return!0===(e&&e.__isLong__)}function ps(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(ds.prototype,"__isLong__",{value:!0}),ds.isLong=fs;var hs={},ms={};function gs(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=ms[e])?r:(n=vs(e,0,!0),a&&(ms[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=hs[e])?r:(n=vs(e,e<0?-1:0,!1),a&&(hs[e]=n),n)}function ys(e,t){if(isNaN(e))return t?As:Cs;if(t){if(e<0)return As;if(e>=Ss)return Is}else{if(e<=-Es)return Ps;if(e+1>=Es)return Rs}return e<0?ys(-e,t).neg():vs(e%xs|0,e/xs|0,t)}function vs(e,t,n){return new ds(e,t,n)}ds.fromInt=gs,ds.fromNumber=ys,ds.fromBits=vs;var bs=Math.pow;function _s(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?As:Cs;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return _s(e.substring(1),t,n).neg();for(var a=ys(bs(n,8)),o=Cs,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),l=parseInt(e.substring(i,i+s),n);if(s<8){var c=ys(bs(n,s));o=o.mul(c).add(ys(l))}else o=(o=o.mul(a)).add(ys(l))}return o.unsigned=t,o}function ws(e,t){return"number"==typeof e?ys(e,t):"string"==typeof e?_s(e,t):vs(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}ds.fromString=_s,ds.fromValue=ws;var xs=4294967296,Ss=xs*xs,Es=Ss/2,ks=gs(16777216),Cs=gs(0);ds.ZERO=Cs;var As=gs(0,!0);ds.UZERO=As;var Os=gs(1);ds.ONE=Os;var Ts=gs(1,!0);ds.UONE=Ts;var Ns=gs(-1);ds.NEG_ONE=Ns;var Rs=vs(-1,2147483647,!1);ds.MAX_VALUE=Rs;var Is=vs(-1,-1,!0);ds.MAX_UNSIGNED_VALUE=Is;var Ps=vs(0,-2147483648,!1);ds.MIN_VALUE=Ps;var Fs=ds.prototype;Fs.toInt=function(){return this.unsigned?this.low>>>0:this.low},Fs.toNumber=function(){return this.unsigned?(this.high>>>0)*xs+(this.low>>>0):this.high*xs+(this.low>>>0)},Fs.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ps)){var t=ys(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=ys(bs(e,6),this.unsigned),o=this,i="";;){var s=o.div(a),l=(o.sub(s.mul(a)).toInt()>>>0).toString(e);if((o=s).isZero())return l+i;for(;l.length<6;)l="0"+l;i=""+l+i}},Fs.getHighBits=function(){return this.high},Fs.getHighBitsUnsigned=function(){return this.high>>>0},Fs.getLowBits=function(){return this.low},Fs.getLowBitsUnsigned=function(){return this.low>>>0},Fs.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ps)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},Fs.isZero=function(){return 0===this.high&&0===this.low},Fs.eqz=Fs.isZero,Fs.isNegative=function(){return!this.unsigned&&this.high<0},Fs.isPositive=function(){return this.unsigned||this.high>=0},Fs.isOdd=function(){return 1==(1&this.low)},Fs.isEven=function(){return 0==(1&this.low)},Fs.equals=function(e){return fs(e)||(e=ws(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},Fs.eq=Fs.equals,Fs.notEquals=function(e){return!this.eq(e)},Fs.neq=Fs.notEquals,Fs.ne=Fs.notEquals,Fs.lessThan=function(e){return this.comp(e)<0},Fs.lt=Fs.lessThan,Fs.lessThanOrEqual=function(e){return this.comp(e)<=0},Fs.lte=Fs.lessThanOrEqual,Fs.le=Fs.lessThanOrEqual,Fs.greaterThan=function(e){return this.comp(e)>0},Fs.gt=Fs.greaterThan,Fs.greaterThanOrEqual=function(e){return this.comp(e)>=0},Fs.gte=Fs.greaterThanOrEqual,Fs.ge=Fs.greaterThanOrEqual,Fs.compare=function(e){if(fs(e)||(e=ws(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Fs.comp=Fs.compare,Fs.negate=function(){return!this.unsigned&&this.eq(Ps)?Ps:this.not().add(Os)},Fs.neg=Fs.negate,Fs.add=function(e){fs(e)||(e=ws(e));var t=0,n=0,r=0,a=0;return r+=(a+=(65535&this.low)+(65535&e.low))>>>16,n+=(r+=(this.low>>>16)+(e.low>>>16))>>>16,t+=(n+=(65535&this.high)+(65535&e.high))>>>16,t+=(this.high>>>16)+(e.high>>>16),vs((r&=65535)<<16|(a&=65535),(t&=65535)<<16|(n&=65535),this.unsigned)},Fs.subtract=function(e){return fs(e)||(e=ws(e)),this.add(e.neg())},Fs.sub=Fs.subtract,Fs.multiply=function(e){if(this.isZero())return this;if(fs(e)||(e=ws(e)),us)return vs(us.mul(this.low,this.high,e.low,e.high),us.get_high(),this.unsigned);if(e.isZero())return this.unsigned?As:Cs;if(this.eq(Ps))return e.isOdd()?Ps:Cs;if(e.eq(Ps))return this.isOdd()?Ps:Cs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(ks)&&e.lt(ks))return ys(this.toNumber()*e.toNumber(),this.unsigned);var t=65535&this.high,n=this.low>>>16,r=65535&this.low,a=65535&e.high,o=e.low>>>16,i=65535&e.low,s=0,l=0,c=0,u=0;return c+=(u+=r*i)>>>16,l+=(c+=n*i)>>>16,c&=65535,l+=(c+=r*o)>>>16,s+=(l+=t*i)>>>16,l&=65535,s+=(l+=n*o)>>>16,l&=65535,s+=(l+=r*a)>>>16,s+=(this.high>>>16)*i+t*o+n*a+r*(e.high>>>16),vs((c&=65535)<<16|(u&=65535),(s&=65535)<<16|(l&=65535),this.unsigned)},Fs.mul=Fs.multiply,Fs.divide=function(e){if(fs(e)||(e=ws(e)),e.isZero())throw Error("division by zero");var t,n,r;if(us)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?vs((this.unsigned?us.div_u:us.div_s)(this.low,this.high,e.low,e.high),us.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?As:Cs;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return As;if(e.gt(this.shru(1)))return Ts;r=As}else{if(this.eq(Ps))return e.eq(Os)||e.eq(Ns)?Ps:e.eq(Ps)?Os:(t=this.shr(1).div(e).shl(1)).eq(Cs)?e.isNegative()?Os:Ns:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(Ps))return this.unsigned?As:Cs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Cs}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:bs(2,a-48),i=ys(t),s=i.mul(e);s.isNegative()||s.gt(n);)s=(i=ys(t-=o,this.unsigned)).mul(e);i.isZero()&&(i=Os),r=r.add(i),n=n.sub(s)}return r},Fs.div=Fs.divide,Fs.modulo=function(e){return fs(e)||(e=ws(e)),us?vs((this.unsigned?us.rem_u:us.rem_s)(this.low,this.high,e.low,e.high),us.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},Fs.mod=Fs.modulo,Fs.rem=Fs.modulo,Fs.not=function(){return vs(~this.low,~this.high,this.unsigned)},Fs.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Fs.clz=Fs.countLeadingZeros,Fs.countTrailingZeros=function(){return this.low?ps(this.low):ps(this.high)+32},Fs.ctz=Fs.countTrailingZeros,Fs.and=function(e){return fs(e)||(e=ws(e)),vs(this.low&e.low,this.high&e.high,this.unsigned)},Fs.or=function(e){return fs(e)||(e=ws(e)),vs(this.low|e.low,this.high|e.high,this.unsigned)},Fs.xor=function(e){return fs(e)||(e=ws(e)),vs(this.low^e.low,this.high^e.high,this.unsigned)},Fs.shiftLeft=function(e){return fs(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?vs(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):vs(0,this.low<<e-32,this.unsigned)},Fs.shl=Fs.shiftLeft,Fs.shiftRight=function(e){return fs(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?vs(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):vs(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Fs.shr=Fs.shiftRight,Fs.shiftRightUnsigned=function(e){return fs(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?vs(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):vs(32===e?this.high:this.high>>>e-32,0,this.unsigned)},Fs.shru=Fs.shiftRightUnsigned,Fs.shr_u=Fs.shiftRightUnsigned,Fs.rotateLeft=function(e){var t;return fs(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?vs(this.high,this.low,this.unsigned):e<32?vs(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):vs(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},Fs.rotl=Fs.rotateLeft,Fs.rotateRight=function(e){var t;return fs(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?vs(this.high,this.low,this.unsigned):e<32?vs(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):vs(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},Fs.rotr=Fs.rotateRight,Fs.toSigned=function(){return this.unsigned?vs(this.low,this.high,!1):this},Fs.toUnsigned=function(){return this.unsigned?this:vs(this.low,this.high,!0)},Fs.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Fs.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},Fs.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},ds.fromBytes=function(e,t,n){return n?ds.fromBytesLE(e,t):ds.fromBytesBE(e,t)},ds.fromBytesLE=function(e,t){return new ds(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ds.fromBytesBE=function(e,t){return new ds(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Ms=function(){function e(t){var n=t.filehandle,r=t.path;if(ke(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new ma(r)}}var t,n,r;return Ae(e,[{key:"_readLongWithOverflow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=ds.fromBytesLE(e.slice(t,t+8),n);if(r.greaterThan(Number.MAX_SAFE_INTEGER)||r.lessThan(Number.MIN_SAFE_INTEGER))throw new TypeError("integer overflow");return r.toNumber()}},{key:"_getIndex",value:function(){return this.index||(this.index=this._readIndex()),this.index}},{key:"_readIndex",value:(r=Ee(we().mark((function e(){var t,n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=kn.allocUnsafe(8),e.next=3,this.filehandle.read(t,0,8,0);case 3:if(n=this._readLongWithOverflow(t,0,!0)){e.next=6;break}return e.abrupt("return",[[0,0]]);case 6:if((r=new Array(n+1))[0]=[0,0],!((a=16*n)>Number.MAX_SAFE_INTEGER)){e.next=11;break}throw new TypeError("integer overflow");case 11:return t=kn.allocUnsafe(a),e.next=14,this.filehandle.read(t,0,a,8);case 14:for(o=0;o<n;o+=1)i=this._readLongWithOverflow(t,16*o),s=this._readLongWithOverflow(t,16*o+8),r[o+1]=[i,s];return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getLastBlock",value:(n=Ee(we().mark((function e(){var t;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndex();case 2:if((t=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",t[t.length-1]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getRelevantBlocksForRead",value:(t=Ee(we().mark((function e(t,n){var r,a,o,i,s,l,c,u,d;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n+t,0!==t){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this._getIndex();case 5:for(o=[],i=function(e,t){var r=e[1];return r<=n&&(t?t[1]:Infinity)>n?0:r<n?-1:1},s=0,l=(a=e.sent).length-1,c=Math.floor(a.length/2),u=i(a[c],a[c+1]);0!==u;)u>0?l=c-1:u<0&&(s=c+1),c=Math.ceil((l-s)/2)+s,u=i(a[c],a[c+1]);o.push(a[c]),d=c+1;case 15:if(!(d<a.length)){e.next=22;break}if(o.push(a[d]),!(a[d][1]>=r)){e.next=19;break}return e.abrupt("break",22);case 19:d+=1,e.next=15;break;case 22:return o[o.length-1][1]<r&&o.push([]),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),js=function(){function e(t){var n=t.filehandle,r=t.path,a=t.gziFilehandle,o=t.gziPath;if(ke(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new ma(r)}if(!a&&!o&&!r)throw new TypeError("either gziFilehandle or gziPath must be defined");this.gzi=new Ms({filehandle:a,path:a||o||!r?"".concat(r,".gzi"):o})}var t,n,r,a;return Ae(e,[{key:"stat",value:(a=Ee(we().mark((function e(){var t;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.filehandle.stat();case 2:return t=e.sent,e.t0=Object,e.t1=t,e.next=7,this.getUncompressedFileSize();case 7:return e.t2=e.sent,e.t3=void 0,e.t4=void 0,e.t5={size:e.t2,blocks:e.t3,blksize:e.t4},e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t5));case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUncompressedFileSize",value:(r=Ee(we().mark((function e(){var t,n,r,a,o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getLastBlock();case 2:return t=Be(e.sent,2),n=t[1],e.next=7,this.filehandle.stat();case 7:return r=e.sent.size,a=kn.allocUnsafe(4),e.next=12,this.filehandle.read(a,0,4,r-28-4);case 12:if(4===e.sent.bytesRead){e.next=16;break}throw new Error("read error");case 16:return o=a.readUInt32LE(0),e.abrupt("return",n+o);case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_readAndUncompressBlock",value:(n=Ee(we().mark((function e(t,n,r){var a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Be(n,1)[0],o=Be(r,1)[0]){e.next=7;break}return e.next=6,this.filehandle.stat();case 6:o=e.sent.size;case 7:return i=o-a,e.next=10,this.filehandle.read(t,0,i,a);case 10:return e.next=12,ls(t.slice(0,i));case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"read",value:(t=Ee(we().mark((function e(t,n,r,a){var o,i,s,l,c,u,d,f,p,h;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getRelevantBlocksForRead(r,a);case 2:o=e.sent,i=kn.allocUnsafe(65536),s=n,l=0,c=0;case 7:if(!(c<o.length-1)){e.next=18;break}return e.next=10,this._readAndUncompressBlock(i,o[c],o[c+1]);case 10:u=e.sent,d=Be(o[c],2),p=(f=d[1])>=a?0:a-f,h=Math.min(a+r,f+u.length)-f,p>=0&&p<u.length&&(u.copy(t,s,p,h),s+=h-p,l+=h-p);case 15:c+=1,e.next=7;break;case 18:return e.abrupt("return",{bytesRead:l,buffer:t});case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a){return t.apply(this,arguments)})}]),e}();function Ds(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}function Ls(e,t){return Bs.apply(this,arguments)}function Bs(){return Bs=Ee(we().mark((function e(t,n){var r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if((r=e.sent)&&r.length){e.next=5;break}throw new Error("No data read from FASTA index (FAI) file");case 5:return a=0,i=r.toString("utf8").split(/\r?\n/).filter((function(e){return/\S/.test(e)})).map((function(e){return e.split("\t")})).filter((function(e){return""!==e[0]})).map((function(e){return o&&o.name===e[0]||(o={name:e[0],id:a},a+=1),{id:o.id,name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}})),e.abrupt("return",{name:Object.fromEntries(i.map((function(e){return[e.name,e]}))),id:Object.fromEntries(i.map((function(e){return[e.id,e]})))});case 8:case"end":return e.stop()}}),e)}))),Bs.apply(this,arguments)}var qs=function(){function e(t){var n=t.fasta,r=t.fai,a=t.path,o=t.faiPath;if(ke(this,e),n)this.fasta=n;else{if(!a)throw new Error("Need to pass filehandle for fasta or path to localfile");this.fasta=new ma(a)}if(r)this.fai=r;else if(o)this.fai=new ma(o);else{if(!a)throw new Error("Need to pass filehandle for  or path to localfile");this.fai=new ma("".concat(a,".fai"))}}var t,n,r,a,o,i,s,l,c;return Ae(e,[{key:"_getIndexes",value:(c=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.indexes||(this.indexes=Ls(this.fai,t)),e.abrupt("return",this.indexes);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getSequenceNames",value:(l=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,this._getIndexes(t);case 3:return e.t1=e.sent.name,e.abrupt("return",e.t0.keys.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getSequenceSizes",value:(s=Ee(we().mark((function e(t){var n,r,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,this._getIndexes(t);case 3:for(r=Object.values(e.sent.id),a=0;a<r.length;a+=1)n[r[a].name]=r[a].length;return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSequenceSize",value:(i=Ee(we().mark((function e(t,n){var r;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.abrupt("return",null===(r=e.sent.name[t])||void 0===r?void 0:r.length);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"hasReferenceSequence",value:(o=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.t0=t,e.abrupt("return",!!e.sent.name[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getResiduesById",value:(a=Ee(we().mark((function e(t,n,r,a){var o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.id[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"getResiduesByName",value:(r=Ee(we().mark((function e(t,n,r,a){var o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.name[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,a){return r.apply(this,arguments)})},{key:"getSequence",value:(n=Ee(we().mark((function e(t,n,r,a){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getResiduesByName(t,n,r,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"_fetchFromIndexEntry",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>3?l[3]:void 0,a=l.length>2?l[2]:void 0,!((n=l.length>1&&void 0!==l[1]?l[1]:0)<0)){e.next=6;break}throw new TypeError("regionStart cannot be less than 0");case 6:if((void 0===a||a>t.length)&&(a=t.length),!(n>=a)){e.next=9;break}return e.abrupt("return","");case 9:return o=Ds(t,n),i=Ds(t,a)-o,s=kn.allocUnsafe(i),e.next=14,this.fasta.read(s,0,i,o,r);case 14:return e.abrupt("return",s.toString("utf8").replace(/\s+/g,""));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Us=function(e){Te(n,e);var t=De(n);function n(e){var r,a=e.fasta,o=e.path,i=e.fai,s=e.faiPath,l=e.gzi,c=e.gziPath;return ke(this,n),r=t.call(this,{fasta:a,path:o,fai:i,faiPath:s}),a&&l?r.fasta=new js({filehandle:a,gziFilehandle:l}):o&&c&&(r.fasta=new js({path:o,gziPath:c})),r}return Ae(n)}(qs);function zs(e){return e.split(">").filter((function(e){return/\S/.test(e)})).map((function(e){var t=qe(e.split("\n")),n=t[0],r=t.slice(1),a=qe(n.split(" ")),o=a[0],i=a.slice(1),s=r.join("").replace(/\s/g,"");return{id:o,description:i.join(" "),sequence:s}}))}var Gs=function(){function e(t){var n=t.fasta,r=t.path;if(ke(this,e),n)this.fasta=n;else{if(!r)throw new Error("Need to pass fasta or path");this.fasta=new ma(r)}this.data=this.fasta.readFile().then((function(e){return zs(e.toString("utf8"))}))}var t,n;return Ae(e,[{key:"fetch",value:(n=Ee(we().mark((function e(t,n,r){var a,o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:if(a=e.sent.find((function(e){return e.id===t})),o=r-n,a){e.next=7;break}throw new Error("no sequence with id ".concat(t," exists"));case 7:return e.abrupt("return",a.sequence.substr(n,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getSequenceNames",value:(t=Ee(we().mark((function e(){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:return e.abrupt("return",e.sent.map((function(e){return e.id})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Hs=de({__proto__:null,parseSmallFasta:zs,FetchableSmallFasta:Gs,IndexedFasta:qs,BgzipIndexedFasta:Us}),$s=de(wa);Object.defineProperty(ha,"__esModule",{value:!0}),ha.AddAssemblyFromExternalChange=void 0;var Ws=Hs,Vs=$s,Js=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","AddAssemblyFromExternalChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=Be(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,externalLocation:r.externalLocation}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.refSeqModel,o=t.user,i=this.assembly,s=this.changes,l=this.logger,u=(c=fn.env.CHUNK_SIZE)&&Number(c),d=Ve(s),e.prev=5,d.s();case 7:if((f=d.n()).done){e.next=45;break}return m=(h=f.value).assemblyName,y=(g=h.externalLocation).fa,v=g.fai,_=(b=g.gzi)?new Ws.BgzipIndexedFasta({fasta:new Vs.RemoteFile(y,{fetch:fetch}),fai:new Vs.RemoteFile(v,{fetch:fetch}),gzi:new Vs.RemoteFile(b,{fetch:fetch})}):new Ws.IndexedFasta({fasta:new Vs.RemoteFile(y,{fetch:fetch}),fai:new Vs.RemoteFile(v,{fetch:fetch})}),e.next=14,_.getSequenceSizes();case 14:if(w=e.sent){e.next=17;break}throw new Error("No data read from indexed fasta getSequenceSizes");case 17:return e.next=19,n.findOne({name:m}).exec();case 19:if(!e.sent){e.next=22;break}throw new Error('Assembly "'.concat(m,'" already exists'));case 22:return e.next=24,r.find({default:!0}).exec();case 24:return x=e.sent.map((function(e){return e._id.toHexString()})),e.next=28,n.create([{_id:i,name:m,user:o,status:-1,externalLocation:g,checks:x}]);case 28:S=Be(e.sent,1),E=S[0],null===(p=l.debug)||void 0===p||p.call(l,'Added new assembly "'.concat(m,'", docId "').concat(E._id,'"')),e.t0=we().keys(w);case 33:if((e.t1=e.t0()).done){e.next=43;break}return k=e.t1.value,e.next=37,a.create([_e(_e({name:k,assembly:E._id,length:w[k]},u?{chunkSize:u}:null),{},{user:o,status:-1})]);case 37:A=Be(e.sent,1),O=A[0],null===(C=l.debug)||void 0===C||C.call(l,'Added new refSeq "'.concat(k,'", docId "').concat(O._id,'"')),e.next=33;break;case 43:e.next=7;break;case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(5),d.e(e.t2);case 50:return e.prev=50,d.f(),e.finish(50);case 53:case"end":return e.stop()}}),e,this,[[5,47,50,53]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(Rr.AssemblySpecificChange);ha.AddAssemblyFromExternalChange=Js;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.AddAssemblyFromFileChange=void 0;var Ks=Hs,Zs=function(e){Te(s,e);var t,n,r,a,o,i=De(s);function s(e,t){var n;return ke(this,s),Oe(je(n=i.call(this,e,t)),"typeName","AddAssemblyFromFileChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(s,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=Be(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(o=Ee(we().mark((function e(t){var n,r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ve(this.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=11;break}return o=(a=r.value).assemblyName,i=a.fileIds,e.next=9,"gzi"in i?this.executeOnServerIndexed(t,o,i):this.executeOnServerFasta(t,o,i.fa);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return o.apply(this,arguments)})},{key:"executeOnServerIndexed",value:(a=Ee(we().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,R,I;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(i=fn.env.CHUNK_SIZE)&&Number(i),fn.env.FILE_UPLOAD_FOLDER){e.next=5;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 5:return l=r.fa,c=r.fai,u=r.gzi,d=t.assemblyModel,f=t.checkModel,p=t.fileModel,h=t.filesService,m=t.refSeqModel,g=t.user,e.next=9,p.findById(l);case 9:if(null==(y=e.sent)?void 0:y.checksum){e.next=13;break}throw new Error("No checksum for file document ".concat(null==y?void 0:y.id));case 13:return e.next=15,p.findById(c);case 15:if(null==(v=e.sent)?void 0:v.checksum){e.next=19;break}throw new Error("No checksum for file document ".concat(null==v?void 0:v.id));case 19:return e.next=21,p.findById(u);case 21:if(null==(b=e.sent)?void 0:b.checksum){e.next=25;break}throw new Error("No checksum for file document ".concat(null==b?void 0:b.id));case 25:return _=h.getFileHandle(y),w=h.getFileHandle(v),x=h.getFileHandle(b),S=new Ks.BgzipIndexedFasta({fasta:_,fai:w,gzi:x}),e.next=31,S.getSequenceSizes();case 31:return E=e.sent,e.next=34,Promise.all([_.close(),w.close(),x.close()]);case 34:return e.next=36,d.findOne({name:n}).exec();case 36:if(!e.sent){e.next=39;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 39:return e.next=41,f.find({default:!0}).exec();case 41:return k=e.sent.map((function(e){return e._id.toHexString()})),e.next=45,d.create([{_id:this.assembly,name:n,user:g,status:-1,fileIds:r,checks:k}]);case 45:C=Be(e.sent,1),A=C[0],null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'Added new assembly "'.concat(n,'", docId "').concat(A._id,'"')),e.t0=we().keys(E);case 50:if((e.t1=e.t0()).done){e.next=60;break}return O=e.t1.value,e.next=54,m.create([_e(_e({name:O,assembly:A._id,length:E[O]},s?{chunkSize:s}:null),{},{user:g,status:-1})]);case 54:R=Be(e.sent,1),I=R[0],null===(T=(N=this.logger).debug)||void 0===T||T.call(N,'Added new refSeq "'.concat(O,'", docId "').concat(I._id,'"')),e.next=50;break;case 60:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"executeOnServerFasta",value:(r=Ee(we().mark((function e(t,n,r){var a,o,i,s,l,c,u,d,f,p,h,m,g,y;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.assemblyModel,d=t.checkModel,f=t.fileModel,p=t.user,e.next=3,f.findById(r).exec();case 3:if(h=e.sent){e.next=6;break}throw new Error('File "'.concat(r,'" not found in Mongo'));case 6:return null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'FileId "'.concat(r,'", checksum "').concat(h.checksum,'"')),e.next=9,u.findOne({name:n}).exec();case 9:if(!e.sent){e.next=12;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 12:return e.next=14,d.find({default:!0}).exec();case 14:return m=e.sent.map((function(e){return e._id.toHexString()})),e.next=18,u.create([{_id:this.assembly,name:n,user:p,status:-1,fileIds:{fa:r},checks:m}]);case 18:return g=Be(e.sent,1),y=g[0],null===(i=(s=this.logger).debug)||void 0===i||i.call(s,'Added new assembly "'.concat(n,'", docId "').concat(y._id,'"')),null===(l=(c=this.logger).debug)||void 0===l||l.call(c,'File type: "'.concat(h.type,'", assemblyId: "').concat(y._id,'"')),e.next=25,this.addRefSeqIntoDb(h,y._id.toString(),t);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new s({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),s}(ea.FromFileBaseChange);Ys.AddAssemblyFromFileChange=Zs;var Xs={},Qs={};Object.defineProperty(Qs,"__esModule",{value:!0}),Qs.DeleteFeatureChange=void 0,Qs.findAndDeleteChildFeature=nl,Qs.isDeleteFeatureChange=function(e){return"DeleteFeatureChange"===e.typeName};var el=Xs,tl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","DeleteFeatureChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return"Feature deleted successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,deletedFeature:a.deletedFeature,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l=this;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=Ve(this.changes),e.prev=3,s=we().mark((function e(){var t,o,s,c,u,d,f,p,h;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(o=i.value).deletedFeature,c=o.parentFeatureId,e.next=4,n.findOne({allIds:s._id}).session(r).exec();case 4:if(u=e.sent){e.next=9;break}throw d="*** ERROR: The following featureId was not found in database ='".concat(s._id,"'"),a.error(d),new Error(d);case 9:if(!u._id.equals(s._id)){e.next=16;break}if(!c){e.next=12;break}throw new Error('Feature "'.concat(s._id,'" is top-level, but received a parent feature ID'));case 12:return e.next=14,n.findByIdAndDelete(u._id);case 14:return null===(f=a.debug)||void 0===f||f.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'". Whole document deleted.')),e.abrupt("return",1);case 16:return(p=nl(u,s._id,l)).push(s._id),u.allIds=u.allIds.filter((function(e){return!p.includes(e)})),u.markModified("children"),e.prev=20,e.next=23,u.save();case 23:e.next=29;break;case 25:throw e.prev=25,e.t0=e.catch(20),null===(h=a.debug)||void 0===h||h.call(a,"*** FAILED: ".concat(e.t0)),e.t0;case 29:null===(t=a.debug)||void 0===t||t.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'"'));case 30:case"end":return e.stop()}}),e,null,[[20,25]])})),o.s();case 6:if((i=o.n()).done){e.next=12;break}return e.delegateYield(s(),"t0",8);case 8:if(!e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(3),o.e(e.t1);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=18;break}if(o=(a=r.value).deletedFeature,!(i=a.parentFeatureId)){e.next=15;break}if(s=t.getFeature(i)){e.next=12;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 12:s.deleteChild(o._id),e.next=16;break;case 15:t.getFeature(o._id)&&t.deleteFeature(o._id);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=Ue(this.changedIds).reverse(),o=Ue(n).reverse().map((function(e){return{addedFeature:e.deletedFeature,parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new el.AddFeatureChange({changedIds:a,typeName:"AddFeatureChange",changes:o,assembly:t},{logger:r})}}]),o}(Rr.FeatureChange);function nl(e,t,n){if(!e.children)throw new Error("Feature ".concat(e._id," has no children"));var r=e._id,a=e.children,o=a.get(t);if(o){var i=n.getChildFeatureIds(o);return a.delete(t),i}var s,l=Ve(a);try{for(l.s();!(s=l.n()).done;){var c=Be(s.value,2)[1];try{return nl(c,t,n)}catch(e){}}}catch(e){l.e(e)}finally{l.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(r))}Qs.DeleteFeatureChange=tl,Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.AddFeatureChange=void 0,Xs.isAddFeatureChange=function(e){return"AddFeatureChange"===e.typeName};var rl=Qs,al=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","AddFeatureChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return"Feature added successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,addedFeature:a.addedFeature,parentFeatureId:a.parentFeatureId,copyFeature:a.copyFeature,allIds:a.allIds}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,R,I,P,F,M;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.assemblyModel,o=t.featureModel,i=t.refSeqModel,s=t.session,l=t.user,c=this.assembly,u=this.changes,d=this.logger,e.next=4,a.findById(c).session(s).exec();case 4:if(e.sent){e.next=9;break}throw f='*** ERROR: Assembly with id "'.concat(c,'" not found'),d.error(f),new Error(f);case 9:p=0,null===(n=d.debug)||void 0===n||n.call(d,"changes: ".concat(JSON.stringify(u))),h=Ve(u),e.prev=12,h.s();case 14:if((m=h.n()).done){e.next=61;break}return y=m.value,null===(g=d.debug)||void 0===g||g.call(d,"change: ".concat(JSON.stringify(y))),b=y.allIds,_=y.copyFeature,w=y.parentFeatureId,x=(v=y.addedFeature)._id,S=v.refSeq,e.next=21,i.findById(S).session(s).exec();case 21:if(e.sent){e.next=24;break}throw new Error('RefSeq was not found by assembly "'.concat(c,'" and seq_id "').concat(S,'" not found'));case 24:if(!_){e.next=34;break}return e.next=27,o.create([_e(_e({},v),{},{allIds:b,status:-1,user:l})],{session:s});case 27:k=Be(e.sent,1),C=k[0],null===(E=d.debug)||void 0===E||E.call(d,'Copied feature, docId "'.concat(C._id,'" to assembly "').concat(c,'"')),p++,e.next=58;break;case 34:if(!w){e.next=50;break}return e.next=37,o.findOne({allIds:w}).session(s).exec();case 37:if(O=e.sent){e.next=40;break}throw new Error('Could not find feature with ID "'.concat(w,'"'));case 40:if(T=this.getFeatureFromId(O,w)){e.next=43;break}throw new Error('Could not find feature with ID "'.concat(w,'" in feature "').concat(O._id,'"'));case 43:return this.addChild(T,v),N=this.getChildFeatureIds(v),(A=O.allIds).push.apply(A,[x].concat(Ue(N))),e.next=48,O.save();case 48:e.next=58;break;case 50:return I=this.getChildFeatureIds(v),P=[x].concat(Ue(I)),e.next=54,o.create([_e({allIds:P,status:0},v)],{session:s});case 54:F=Be(e.sent,1),M=F[0],null===(R=d.verbose)||void 0===R||R.call(d,'Added docId "'.concat(M._id,'"'));case 58:p++;case 59:e.next=14;break;case 61:e.next=66;break;case 63:e.prev=63,e.t0=e.catch(12),h.e(e.t0);case 66:return e.prev=66,h.f(),e.finish(66);case 69:null===(r=d.debug)||void 0===r||r.call(d,"Added ".concat(p," new feature(s) into database."));case 70:case"end":return e.stop()}}),e,this,[[12,63,66,69]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=this.assembly,r=Ve(this.changes),e.prev=4,r.s();case 6:if((a=r.n()).done){e.next=20;break}if(i=(o=a.value).addedFeature,!(s=o.parentFeatureId)){e.next=17;break}if(l=t.getFeature(s)){e.next=13;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 13:l.attributes.get("_id")||l.setAttribute("_id",[l._id]),l.addChild(i),e.next=18;break;case 17:t.addFeature(n,i);case 18:e.next=6;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(4),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[4,22,25,28]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=Ue(this.changedIds).reverse(),a=Ue(t).reverse().map((function(e){return{deletedFeature:e.addedFeature,parentFeatureId:e.parentFeatureId}}));return new rl.DeleteFeatureChange({changedIds:r,typeName:"DeleteFeatureChange",changes:a,assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);Xs.AddFeatureChange=al;var ol={};Object.defineProperty(ol,"__esModule",{value:!0}),ol.AddFeaturesFromFileChange=void 0;var il=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n,r;return ke(this,o),Oe(je(r=a.call(this,e,t)),"typeName","AddFeaturesFromFileChange"),Oe(je(r),"changes",void 0),Oe(je(r),"deleteExistingFeatures",!1),r.deleteExistingFeatures=null!==(n=e.deleteExistingFeatures)&&void 0!==n&&n,r.changes="changes"in e?e.changes:[e],r}return Ae(o,[{key:"notification",get:function(){return"Features have been added. To see them, please refresh the page."}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.deleteExistingFeatures,r=this.typeName;return 1===t.length?{typeName:r,assembly:e,fileId:Be(t,1)[0].fileId,deleteExistingFeatures:n}:{typeName:r,assembly:e,changes:t,deleteExistingFeatures:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.fileModel,a=t.filesService,o=this.changes,i=this.logger,!this.deleteExistingFeatures){e.next=5;break}return e.next=5,this.removeExistingFeatures(t);case 5:s=Ve(o),e.prev=6,s.s();case 8:if((l=s.n()).done){e.next=56;break}if(u=l.value.fileId,fn.env.FILE_UPLOAD_FOLDER){e.next=14;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 14:return e.next=16,r.findById(u).exec();case 16:if(d=e.sent){e.next=19;break}throw new Error('File "'.concat(u,'" not found in Mongo'));case 19:null===(c=i.debug)||void 0===c||c.call(i,'FileId "'.concat(u,'", checksum "').concat(d.checksum,'"')),f=a.parseGFF3(a.getFileStream(d)),p=0,h=!1,m=!1,e.prev=24,y=ge(f);case 26:return e.next=28,y.next();case 28:if(!(h=!(v=e.sent).done)){e.next=38;break}return b=v.value,e.next=33,this.addFeatureIntoDb(b,t);case 33:++p%1e3==0&&(null===(_=i.debug)||void 0===_||_.call(i,"Processed ".concat(p," features")));case 35:h=!1,e.next=26;break;case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(24),m=!0,g=e.t0;case 44:if(e.prev=44,e.prev=45,!h||null==y.return){e.next=49;break}return e.next=49,y.return();case 49:if(e.prev=49,!m){e.next=52;break}throw g;case 52:return e.finish(49);case 53:return e.finish(44);case 54:e.next=8;break;case 56:e.next=61;break;case 58:e.prev=58,e.t1=e.catch(6),s.e(e.t1);case 61:return e.prev=61,s.f(),e.finish(61);case 64:null===(n=i.debug)||void 0===n||n.call(i,"New features added into database!");case 65:case"end":return e.stop()}}),e,this,[[6,58,61,64],[24,40,44,54],[45,,49,53]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(ea.FromFileBaseChange);ol.AddFeaturesFromFileChange=il;var sl={};Object.defineProperty(sl,"__esModule",{value:!0}),sl.AddRefSeqAliasesChange=void 0;var ll=U.default,cl=function(e){Te(r,e);var t,n=De(r);function r(e,t){var a;return ke(this,r),Oe(je(a=n.call(this,e,t)),"typeName","AddRefSeqAliasesChange"),Oe(je(a),"refSeqAliases",void 0),a.refSeqAliases=e.refSeqAliases,a}return Ae(r,[{key:"executeOnClient",value:function(e){var t=(0,ll.getSession)(e).assemblyManager.get(this.assembly);if(!t)throw new Error("assembly ".concat(this.assembly," not found"));var n=t.refNameAliases,r=t.lowerCaseRefNameAliases;if(!n||!r)throw new Error("Session refNameAliases not found in assembly");var a,o=Ve(this.refSeqAliases);try{for(o.s();!(a=o.n()).done;){var i,s=a.value,l=s.refName,c=Ve(s.aliases);try{for(c.s();!(i=c.n()).done;){var u=i.value;n[u]=l,r[u.toLowerCase()]=l}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}return t.setRefNameAliases(n,r),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,refSeqAliases:this.refSeqAliases}}},{key:"executeOnServer",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.refSeqModel,r=t.session,a=this.assembly,o=this.logger,i=Ve(this.refSeqAliases),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=13;break}return c=s.value,null===(l=o.debug)||void 0===l||l.call(o,"Updating Refname alias for assembly: ".concat(a,", refSeqAlias: ").concat(JSON.stringify(c))),u=c.aliases,d=c.refName,e.next=11,n.updateOne({assembly:a,name:d},{$set:{aliases:u}}).session(r);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"RefSeq aliases have been added."}}]),r}(Rr.AssemblySpecificChange);sl.AddRefSeqAliasesChange=cl;var ul={};Object.defineProperty(ul,"__esModule",{value:!0}),ul.DeleteAssemblyChange=void 0;var dl=U.default,fl=function(e){Te(o,e);var t,n,r,a=De(o);function o(){var e;ke(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Oe(je(e=a.call.apply(a,[this].concat(n))),"typeName","DeleteAssemblyChange"),e}return Ae(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.assembly,'" deleted successfully.')}},{key:"toJSON",value:function(){return{typeName:this.typeName,assembly:this.assembly}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=t.featureModel,o=t.refSeqChunkModel,i=t.refSeqModel,s=t.session,l=this.assembly,c=this.logger,e.next=4,r.findById(l).session(s).exec();case 4:if(e.sent){e.next=9;break}throw u='*** ERROR: Assembly with id "'.concat(l,'" not found'),c.error(u),new Error(u);case 9:return e.next=11,i.find({assembly:l}).exec();case 11:return d=e.sent.map((function(e){return e._id})),e.next=15,o.deleteMany({refSeq:d}).exec();case 15:return e.next=17,a.deleteMany({refSeq:d}).exec();case 17:return e.next=19,i.deleteMany({assembly:l}).exec();case 19:return e.next=21,r.findByIdAndDelete(l).exec();case 21:null===(n=c.debug)||void 0===n||n.call(c,'Assembly "'.concat(l,'" deleted from database.'));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.assembly,t){e.next=3;break}throw new Error("No data store");case 3:return o=(0,dl.getSession)(t),t.assemblies.has(a)&&t.deleteAssembly(a),e.next=7,null===(n=o.removeAssembly)||void 0===n?void 0:n.call(o,a);case 7:return e.next=9,null===(r=o.removeSessionAssembly)||void 0===r?void 0:r.call(o,a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"DeleteAssemblyChange",assembly:this.assembly},{logger:this.logger})}}]),o}(Rr.AssemblySpecificChange);ul.DeleteAssemblyChange=fl;var pl={};Object.defineProperty(pl,"__esModule",{value:!0}),pl.DeleteUserChange=void 0;var hl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","DeleteUserChange"),Oe(je(n),"changes",void 0),Oe(je(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return Ae(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,userId:this.userId}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.userModel,a=this.logger,o=this.userId,e.next=4,r.findOneAndDelete({_id:o}).session(n).exec();case 4:if(e.sent){e.next=9;break}throw i='*** ERROR: User with id "'.concat(o,'" not found'),a.error(i),new Error(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,userId:this.userId},{logger:this.logger})}}]),o}(Rr.Change);pl.DeleteUserChange=hl;var ml={};Object.defineProperty(ml,"__esModule",{value:!0}),ml.FeatureAttributeChange=void 0,ml.isFeatureAttributeChange=function(e){return"FeatureAttributeChange"===e.typeName};var gl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","FeatureAttributeChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldAttributes:a.oldAttributes,newAttributes:a.newAttributes}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=Ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=26;break}return d=l.value.featureId,e.next=11,n.findOne({allIds:d}).session(r).exec();case 11:if(f=e.sent){e.next=16;break}throw p="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),o.error(p),new Error(p);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(f))),h=this.getFeatureFromId(f,d)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(h))),i.push({feature:h,topLevelFeature:f});case 24:e.next=6;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(4),s.e(e.t0);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m=Ve(a.entries()),e.prev=35,m.s();case 37:if((g=m.n()).done){e.next=55;break}return v=Be(g.value,2),w=(b=i[v[0]]).topLevelFeature,(_=b.feature).attributes=v[1].newAttributes,w._id.equals(_._id)?w.markModified("attributes"):w.markModified("children"),e.prev=43,e.next=46,w.save();case 46:e.next=52;break;case 48:throw e.prev=48,e.t1=e.catch(43),null===(x=o.debug)||void 0===x||x.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 52:null===(y=o.debug)||void 0===y||y.call(o,"*** Feature attributes modified (added, edited or deleted), docId: ".concat(JSON.stringify(w)));case 53:e.next=37;break;case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(35),m.e(e.t2);case 60:return e.prev=60,m.f(),e.finish(60);case 63:case"end":return e.stop()}}),e,this,[[4,28,31,34],[35,57,60,63],[43,48]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("applyToLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=Be(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setAttributes(new Map(Object.entries(this.changes[o].newAttributes)));case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger;return new o({changedIds:Ue(this.changedIds).reverse(),typeName:"FeatureAttributeChange",changes:Ue(t).reverse().map((function(e){return{featureId:e.featureId,oldAttributes:e.newAttributes,newAttributes:e.oldAttributes}})),assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);ml.FeatureAttributeChange=gl;var yl={},vl=["__v","_id","assemblies","configuration","internetAccounts","plugins","tracks"],bl=["hasRole"];function _l(e){var t,n=e.assemblies,r=e.configuration,a=e.internetAccounts,o=e.plugins,i=e.tracks,s=Me(e,vl);if(n&&(s.assemblies=n.filter((function(e){return"ApolloSequenceAdapter"!==e.sequence.adapter.type}))),null!=r&&null!==(t=r.ApolloPlugin)&&void 0!==t&&t.hasRole){var l=Me(r.ApolloPlugin,bl);s.configuration=_e(_e({},r),{},{ApolloPlugin:l})}return a&&(s.internetAccounts=a.filter((function(e){return"ApolloInternetAccount"!==e.type}))),o&&(s.plugins=o.filter((function(e){return"Apollo"!==e.name}))),i&&(s.tracks=i.filter((function(e){return"ApolloTrack"!==e.type}))),s}Object.defineProperty(yl,"__esModule",{value:!0}),yl.ImportJBrowseConfigChange=void 0,yl.filterJBrowseConfig=_l;var wl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","ImportJBrowseConfigChange"),Oe(je(n),"oldJBrowseConfig",void 0),Oe(je(n),"newJBrowseConfig",void 0),n.oldJBrowseConfig=e.oldJBrowseConfig,n.newJBrowseConfig=e.newJBrowseConfig,n}return Ae(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,oldJBrowseConfig:this.oldJBrowseConfig,newJBrowseConfig:this.newJBrowseConfig}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.jbrowseConfigModel,a=this.logger,o=this.newJBrowseConfig,e.next=4,r.deleteMany();case 4:if(o){e.next=6;break}return e.abrupt("return");case 6:return i=_l(o),e.next=9,r.create(i);case 9:null===(n=a.debug)||void 0===n||n.call(a,"Stored new JBrowse Config");case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:this.newJBrowseConfig,newJBrowseConfig:this.oldJBrowseConfig},{logger:this.logger})}}]),o}(Rr.Change);yl.ImportJBrowseConfigChange=wl;var xl={};Object.defineProperty(xl,"__esModule",{value:!0}),xl.LocationEndChange=void 0,xl.isLocationEndChange=function(e){return"LocationEndChange"===e.typeName};var Sl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","LocationEndChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldEnd:a.oldEnd,newEnd:a.newEnd}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=Ve(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}d=(u=s.value).featureId,f=u.oldEnd,p=u.newEnd,h=void 0,m=void 0,g=Ve(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,d))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:d}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,d)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.max===f){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.max=p,h._id.equals(m._id)?h.markModified("end"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newEnd,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMax(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:Ue(this.changedIds).reverse(),typeName:r,changes:Ue(t).reverse().map((function(e){return{featureId:e.featureId,oldEnd:e.newEnd,newEnd:e.oldEnd}})),assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);xl.LocationEndChange=Sl;var El={};Object.defineProperty(El,"__esModule",{value:!0}),El.LocationStartChange=void 0,El.isLocationStartChange=function(e){return"LocationStartChange"===e.typeName};var kl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","LocationStartChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStart:a.oldStart,newStart:a.newStart}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=Ve(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}d=(u=s.value).featureId,f=u.oldStart,p=u.newStart,h=void 0,m=void 0,g=Ve(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,d))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:d}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,d)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.min===f){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.min=p,h._id.equals(m._id)?h.markModified("start"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newStart,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMin(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:Ue(this.changedIds).reverse(),typeName:r,changes:Ue(t).reverse().map((function(e){return{featureId:e.featureId,oldStart:e.newStart,newStart:e.oldStart}})),assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);El.LocationStartChange=kl;var Cl={},Al={};Object.defineProperty(Al,"__esModule",{value:!0}),Al.UndoMergeExonsChange=void 0;var Ol=Cl,Tl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","UndoMergeExonsChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonsToRestore:a.exonsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=Ve(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.exonsToRestore).length){e.next=10;break}throw new Error("Expected exactly two exons to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),d=Ve(s);try{for(d.s();!(f=d.n()).done;)this.addChild(u,h=f.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(Ue(m)))}catch(e){d.e(e)}finally{d.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).exonsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=Ve(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=Ue(this.changedIds).reverse(),a=Ue(t).reverse().map((function(e){return{firstExon:e.exonsToRestore[0],secondExon:e.exonsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new Ol.MergeExonsChange({changedIds:r,typeName:"MergeExonsChange",changes:a,assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);Al.UndoMergeExonsChange=Tl,Object.defineProperty(Cl,"__esModule",{value:!0}),Cl.MergeExonsChange=void 0;var Nl=Qs,Rl=Al,Il=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","MergeExonsChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return"Exons successfully merged"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstExon:a.firstExon,secondExon:a.secondExon,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l=this;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=Ve(this.changes),e.prev=3,s=we().mark((function e(){var t,o,s,c,u,d,f;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstExon,s=t.secondExon,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(d=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return d.min=Math.min(o.min,s.min),d.max=Math.max(o.max,s.max),d.attributes=l.mergeAttributes(o,s),(f=(0,Nl.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!f.includes(e)})),e.next=22,c.save();case 22:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=19;break}if(s=(o=r.value).secondExon,l=t.getFeature((i=o.firstExon)._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(i._id,'"'));case 11:for(l.setMin(Math.min(i.min,s.min)),l.setMax(Math.max(i.max,s.max)),c=this.mergeAttributes(i,s),l.setAttributes(new Map),u=0,d=Object.keys(c);u<d.length;u++)l.setAttribute(f=d[u],c[f]);null===(a=l.parent)||void 0===a||a.deleteChild(s._id);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=Ue(this.changedIds).reverse(),o=Ue(n).reverse().map((function(e){return{exonsToRestore:[e.firstExon,e.secondExon],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new Rl.UndoMergeExonsChange({changedIds:a,typeName:"UndoMergeExonsChange",changes:o,assembly:t},{logger:r})}},{key:"mergeAttributes",value:function(e,t){var n={};if(e.attributes&&(n=JSON.parse(JSON.stringify(e.attributes))),t.attributes)for(var r=JSON.parse(JSON.stringify(t.attributes)),a=function(){var e=i[o];if("_id"===e||"gff_id"===e)return 1;Object.keys(n).includes(e)||(n[e]=[]),r[e].map((function(t){n[e].includes(t)||n[e].push(t)}))},o=0,i=Object.keys(r);o<i.length;o++)a();return n}}]),o}(Rr.FeatureChange);Cl.MergeExonsChange=Il;var Pl={},Fl={};Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.UndoMergeTranscriptsChange=void 0;var Ml=Pl,jl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","UndoMergeTranscriptsChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,transcriptsToRestore:a.transcriptsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=Ve(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.transcriptsToRestore).length){e.next=10;break}throw new Error("Expected exactly two transcripts to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),d=Ve(s);try{for(d.s();!(f=d.n()).done;)this.addChild(u,h=f.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(Ue(m)))}catch(e){d.e(e)}finally{d.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).transcriptsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=Ve(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=Ue(this.changedIds).reverse(),a=Ue(t).reverse().map((function(e){return{firstTranscript:e.transcriptsToRestore[0],secondTranscript:e.transcriptsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new Ml.MergeTranscriptsChange({changedIds:r,typeName:"MergeTranscriptsChange",changes:a,assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);Fl.UndoMergeTranscriptsChange=jl,Object.defineProperty(Pl,"__esModule",{value:!0}),Pl.MergeTranscriptsChange=void 0;var Dl=U.default,Ll=Qs,Bl=Fl,ql=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","MergeTranscriptsChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstTranscript:a.firstTranscript,secondTranscript:a.secondTranscript,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l=this;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=Ve(this.changes),e.prev=3,s=we().mark((function e(){var t,o,s,c,u,d,f;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstTranscript,s=t.secondTranscript,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(d=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return l.mergeTranscriptsOnServer(d,s),(f=(0,Ll.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!f.includes(e)})),e.next=20,c.save();case 20:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"mergeTranscriptsOnServer",value:function(e,t){if(e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max),this.mergeTranscriptAttributes(e,t),t.children)for(var n=0,r=Object.entries(t.children);n<r.length;n++){var a=Be(r[n],2);this.mergeFeatureIntoTranscriptOnServer(a[1],e)}}},{key:"mergeFeatureIntoTranscriptOnServer",value:function(e,t){var n=this;t.children||(t.children=new Map);var r,a,o=!1,i=Ve(t.children);try{for(i.s();!(a=i.n()).done;){var s=Be(a.value,2),l=s[0],c=s[1];if(o&&r||(r=c),r.type===e.type&&r.type===c.type&&(0,Dl.doesIntersect2)(e.min,e.max,r.min,r.max)&&(0,Dl.doesIntersect2)(c.min,c.max,r.min,r.max)){r.min=Math.min(e.min,r.min,c.min),r.max=Math.max(e.max,r.max,c.max);var u=this.mergeAttributes(r,e);r.attributes=u,t.children.delete(l),o=!0}}}catch(e){i.e(e)}finally{i.f()}o&&r&&e.children&&Object.entries(e.children).map((function(e){var t=Be(e,2);n.addChild(r,t[1])})),this.addChild(t,o&&r?r:e)}},{key:"executeOnClient",value:(n=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=15;break}if(o=Be(r.value,2),i=o[1],l=(s=this.changes[o[0]]).secondTranscript,c=t.getFeature(s.firstTranscript._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 11:this.mergeTranscriptsOnClient(c,l),null===(a=c.parent)||void 0===a||a.deleteChild(l._id);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"mergeTranscriptsOnClient",value:function(e,t){if(e.setMin(Math.min(e.min,t.min)),e.setMax(Math.max(e.max,t.max)),this.mergeTranscriptAttributes(e,t),t.children)for(var n=0,r=Object.entries(t.children);n<r.length;n++){var a=Be(r[n],2);this.mergeFeatureIntoTranscriptOnClient(a[1],e)}}},{key:"mergeFeatureIntoTranscriptOnClient",value:function(e,t){t.children||(t.children=new Map);var n,r,a,o=!1,i=Ve(t.children);try{for(i.s();!(a=i.n()).done;){var s=Be(a.value,2)[1];if(o&&n?r=!0:(r=!1,n=s),n.type===e.type&&n.type===s.type&&(0,Dl.doesIntersect2)(e.min,e.max,n.min,n.max)&&(0,Dl.doesIntersect2)(s.min,s.max,n.min,n.max)){n.setMin(Math.min(e.min,n.min,s.min)),n.setMax(Math.max(e.max,n.max,s.max));var l=this.mergeAttributes(n,e);Object.entries(l).map((function(e){var t=Be(e,2);n&&n.setAttribute(t[0],t[1])})),r&&t.deleteChild(s._id),o=!0}}}catch(e){i.e(e)}finally{i.f()}o&&n&&e.children&&Object.entries(e.children).map((function(e){var t=Be(e,2);n.addChild(t[1])})),o&&n||t.addChild(e)}},{key:"isAnnotationFeature",value:function(e){return"function"==typeof e.setMin&&"function"==typeof e.setMax&&"function"==typeof e.addChild&&"function"==typeof e.deleteChild}},{key:"executeOnLocalGFF3",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"mergeAttributes",value:function(e,t){var n=e.attributes?JSON.parse(JSON.stringify(e.attributes)):{};if(t.attributes){var r=JSON.parse(JSON.stringify(t.attributes));Object.entries(r).map((function(e){var t=Be(e,2),r=t[0],a=t[1];r in n||(n[r]=[]),a.map((function(e){n[r].includes(e)||n[r].push(e)}))}))}return n}},{key:"mergeTranscriptAttributes",value:function(e,t){var n=this.mergeAttributes(e,t);this.isAnnotationFeature(e)?Object.entries(n).map((function(t){var n=Be(t,2);e.setAttribute(n[0],n[1])})):e.attributes=n}},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=Ue(this.changedIds).reverse(),o=Ue(n).reverse().map((function(e){return{transcriptsToRestore:[e.firstTranscript,e.secondTranscript],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new Bl.UndoMergeTranscriptsChange({changedIds:a,typeName:"UndoMergeTranscriptsChange",changes:o,assembly:t},{logger:r})}}]),o}(Rr.FeatureChange);Pl.MergeTranscriptsChange=ql;var Ul={},zl={};Object.defineProperty(zl,"__esModule",{value:!0}),zl.UndoSplitExonChange=void 0;var Gl=Qs,Hl=Ul,$l=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","UndoSplitExonChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToRestore:a.exonToRestore,parentFeatureId:a.parentFeatureId,idsToDelete:a.idsToDelete,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s=this;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=Ve(this.changes),e.prev=3,i=we().mark((function e(){var t,a,i,l,c,u,d,f;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(a=o.value).exonToRestore,l=a.parentFeatureId,c=a.idsToDelete,e.next=4,n.findOne({allIds:l}).session(r).exec();case 4:if(u=e.sent){e.next=7;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 7:if(d=s.getFeatureFromId(u,l)){e.next=10;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(u._id.toString(),'"'));case 10:return d.children||(d.children=new Map),s.addChild(d,i),f=s.getChildFeatureIds(i),(t=u.allIds).push.apply(t,[i._id].concat(Ue(f))),u.allIds=u.allIds.filter((function(e){return!c.includes(e)})),c.map((function(e){return(0,Gl.findAndDeleteChildFeature)(u,e,s)})),e.next=18,u.save();case 18:case"end":return e.stop()}}),e)})),a.s();case 6:if((o=a.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),a.e(e.t1);case 15:return e.prev=15,a.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changes),e.prev=4,a=we().mark((function e(){var n,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=r.value).exonToRestore,i=n.idsToDelete,o=n.parentFeatureId){e.next=4;break}throw new Error("Parent ID is missing");case 4:if(s=t.getFeature(o)){e.next=7;break}throw new Error('Could not find parent feature "'.concat(o,'"'));case 7:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),s.addChild(a),i.map((function(e){s.deleteChild(e)}));case 10:case"end":return e.stop()}}),e)})),n.s();case 7:if((r=n.n()).done){e.next=11;break}return e.delegateYield(a(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),n.e(e.t1);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[4,13,16,19]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=Ue(this.changedIds).reverse(),a=Ue(t).reverse().map((function(e){return{parentFeatureId:e.parentFeatureId,exonToBeSplit:e.exonToRestore,upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return new Hl.SplitExonChange({changedIds:r,typeName:"SplitExonChange",changes:a,assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);zl.UndoSplitExonChange=$l,Object.defineProperty(Ul,"__esModule",{value:!0}),Ul.SplitExonChange=void 0;var Wl=Qs,Vl=zl,Jl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","SplitExonChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"notification",get:function(){return"Exon successfully split"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToBeSplit:a.exonToBeSplit,parentFeatureId:a.parentFeatureId,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l=this;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=Ve(this.changes),e.prev=3,s=we().mark((function e(){var t,o,s,c,u,d,f,p,h,m,g,y,v,b,_;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).exonToBeSplit,s=t.parentFeatureId,c=t.upstreamCut,u=t.downstreamCut,d=t.leftExonId,f=t.rightExonId,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(p=e.sent){e.next=9;break}throw h="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(h),new Error(h);case 9:if(null!=(m=l.getFeatureFromId(p,s))&&m.children){e.next=12;break}throw new Error("ERROR: There should be at least one child (i.e. the exon to be split)");case 12:return g=l.makeSplitExons(o,c,u,d,f),y=Be(g,2),b=y[1],m.children.set((v=y[0])._id,_e(_e({allIds:[]},v),{},{_id:v._id})),m.children.set(b._id,_e(_e({allIds:[]},b),{},{_id:b._id})),m.children=new Map(Ue(m.children.entries()).sort((function(e,t){return e[1].min-t[1].min}))),(_=(0,Wl.findAndDeleteChildFeature)(p,o._id,l)).push(o._id),p.allIds=p.allIds.filter((function(e){return!_.includes(e)})),p.allIds.push(v._id,b._id),e.next=22,p.save();case 22:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=19;break}if(a=Be(r.value,1),i=(o=this.changes[a[0]]).exonToBeSplit,l=o.upstreamCut,c=o.downstreamCut,u=o.leftExonId,d=o.rightExonId,s=o.parentFeatureId){e.next=10;break}throw new Error("TODO: Split exon without parent");case 10:if(f=this.makeSplitExons(i,l,c,u,d),p=Be(f,2),h=p[0],m=p[1],g=t.getFeature(s)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 14:g.addChild(h),g.addChild(m),t.getFeature(i._id)&&t.deleteFeature(i._id);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=Ue(this.changedIds).reverse(),o=Ue(n).reverse().map((function(e){return{exonToRestore:e.exonToBeSplit,parentFeatureId:e.parentFeatureId,idsToDelete:[e.leftExonId,e.rightExonId],upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new Vl.UndoSplitExonChange({changedIds:a,typeName:"UndoSplitExonChange",changes:o,assembly:t},{logger:r})}},{key:"makeSplitExons",value:function(e,t,n,r,a){var o=JSON.parse(JSON.stringify(e));delete o.attributes._id,delete o.attributes.gff_id;var i=structuredClone(o);i._id=r,i.max=t;var s=structuredClone(o);return s.min=n,s._id=a,[i,s]}}]),o}(Rr.FeatureChange);Ul.SplitExonChange=Jl;var Yl={};Object.defineProperty(Yl,"__esModule",{value:!0}),Yl.StrandChange=void 0;var Kl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","StrandChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStrand:a.oldStrand,newStrand:a.newStrand}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=Ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return f=(d=l.value).featureId,p=d.oldStrand,e.next=11,n.findOne({allIds:f}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,f)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.strand===p){e.next=27;break}throw y="*** ERROR: Feature's current strand \"".concat(h.strand,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=Ve(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=Be(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).strand=w[1].newStrand,E._id.equals(S._id)?E.markModified("strand"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=Be(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setStrand(this.changes[o].newStrand);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:Ue(this.changedIds).reverse(),typeName:r,changes:Ue(t).reverse().map((function(e){return{featureId:e.featureId,oldStrand:e.newStrand,newStrand:e.oldStrand}})),assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);Yl.StrandChange=Kl;var Zl={};Object.defineProperty(Zl,"__esModule",{value:!0}),Zl.TypeChange=void 0;var Xl=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","TypeChange"),Oe(je(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return Ae(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=Be(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldType:a.oldType,newType:a.newType}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=Ve(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return f=(d=l.value).featureId,p=d.oldType,e.next=11,n.findOne({allIds:f}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,f)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.type===p){e.next=27;break}throw y="*** ERROR: Feature's current type \"".concat(h.type,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=Ve(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=Be(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).type=w[1].newType,E._id.equals(S._id)?E.markModified("type"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){var n,r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=Ve(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=Be(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setType(this.changes[o].newType);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:Ue(this.changedIds).reverse(),typeName:r,changes:Ue(t).reverse().map((function(e){return{featureId:e.featureId,oldType:e.newType,newType:e.oldType}})),assembly:e},{logger:n})}}]),o}(Rr.FeatureChange);Zl.TypeChange=Xl;var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0}),Ql.UserChange=void 0;var ec=function(e){Te(o,e);var t,n,r,a=De(o);function o(e,t){var n;return ke(this,o),Oe(je(n=a.call(this,e,t)),"typeName","UserChange"),Oe(je(n),"changes",void 0),Oe(je(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return Ae(o,[{key:"toJSON",value:function(){var e=this.changes,t=this.typeName,n=this.userId;return 1===e.length?{typeName:t,userId:n,role:Be(e,1)[0].role}:{typeName:t,userId:n,changes:e}}},{key:"executeOnServer",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i,s,l,c,u,d,f;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.session,r=t.userModel,o=this.logger,i=this.userId,s=Ve(a=this.changes),e.prev=3,s.s();case 5:if((l=s.n()).done){e.next=18;break}return u=l.value,null===(c=o.debug)||void 0===c||c.call(o,"change: ".concat(JSON.stringify(a))),d=u.role,e.next=11,r.findByIdAndUpdate(i,{role:d}).session(n).exec();case 11:if(e.sent){e.next=16;break}throw f='*** ERROR: User with id "'.concat(i,'" not found'),o.error(f),new Error(f);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),s.e(e.t0);case 23:return e.prev=23,s.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,userId:this.userId},{logger:this.logger})}}]),o}(Rr.Change);Ql.UserChange=ec,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.changes=void 0;var t=Ct;e.changes={AddAssemblyAndFeaturesFromFileChange:Qr.AddAssemblyAndFeaturesFromFileChange,AddAssemblyFromFileChange:Ys.AddAssemblyFromFileChange,AddAssemblyFromExternalChange:ha.AddAssemblyFromExternalChange,AddFeatureChange:Xs.AddFeatureChange,AddFeaturesFromFileChange:ol.AddFeaturesFromFileChange,DeleteAssemblyChange:ul.DeleteAssemblyChange,DeleteFeatureChange:Qs.DeleteFeatureChange,DeleteUserChange:pl.DeleteUserChange,FeatureAttributeChange:ml.FeatureAttributeChange,ImportJBrowseConfigChange:yl.ImportJBrowseConfigChange,LocationEndChange:xl.LocationEndChange,LocationStartChange:El.LocationStartChange,MergeExonsChange:Cl.MergeExonsChange,SplitExonChange:Ul.SplitExonChange,MergeTranscriptsChange:Pl.MergeTranscriptsChange,UndoMergeExonsChange:Al.UndoMergeExonsChange,UndoSplitExonChange:zl.UndoSplitExonChange,UndoMergeTranscriptsChange:Fl.UndoMergeTranscriptsChange,StrandChange:Yl.StrandChange,TypeChange:Zl.TypeChange,UserChange:Ql.UserChange,AddRefSeqAliasesChange:sl.AddRefSeqAliasesChange,AddAssemblyAliasesChange:Nr.AddAssemblyAliasesChange},t.__exportStar(Qr,e),t.__exportStar(Ys,e),t.__exportStar(ha,e),t.__exportStar(Xs,e),t.__exportStar(ol,e),t.__exportStar(ul,e),t.__exportStar(Qs,e),t.__exportStar(pl,e),t.__exportStar(ml,e),t.__exportStar(yl,e),t.__exportStar(xl,e),t.__exportStar(El,e),t.__exportStar(Cl,e),t.__exportStar(Ul,e),t.__exportStar(Pl,e),t.__exportStar(Al,e),t.__exportStar(zl,e),t.__exportStar(Fl,e),t.__exportStar(Yl,e),t.__exportStar(Zl,e),t.__exportStar(Ql,e),t.__exportStar(sl,e),t.__exportStar(Nr,e)}(Tr);var tc={},nc={};Object.defineProperty(nc,"__esModule",{value:!0}),nc.GetAssembliesOperation=void 0;var rc=function(e){Te(r,e);var t,n=De(r);function r(){var e;ke(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return Oe(je(e=n.call.apply(n,[this].concat(a))),"typeName","GetAssembliesOperation"),e}return Ae(r,[{key:"toJSON",value:function(){return{typeName:this.typeName}}},{key:"executeOnServer",value:function(e){return e.assemblyModel.find({status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(Rr.Operation);nc.GetAssembliesOperation=rc;var ac={};Object.defineProperty(ac,"__esModule",{value:!0}),ac.GetFeaturesOperation=void 0;var oc=function(e){Te(r,e);var t,n=De(r);function r(e,t){var a;return ke(this,r),Oe(je(a=n.call(this,e,t)),"typeName","GetFeaturesOperation"),Oe(je(a),"refSeq",void 0),Oe(je(a),"start",void 0),Oe(je(a),"end",void 0),a.refSeq=e.refSeq,a.start=e.start,a.end=e.end,a}return Ae(r,[{key:"toJSON",value:function(){return{typeName:this.typeName,refSeq:this.refSeq,start:this.start,end:this.end}}},{key:"executeOnServer",value:function(e){return e.featureModel.find({refSeq:this.refSeq,min:{$lte:this.end},max:{$gte:this.start},status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(Rr.Operation);ac.GetFeaturesOperation=oc,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.operations=void 0;var t=Ct;e.operations={GetAssembliesOperation:nc.GetAssembliesOperation,GetFeaturesOperation:ac.GetFeaturesOperation},t.__exportStar(nc,e),t.__exportStar(ac,e)}(tc);var ic={},sc={};Object.defineProperty(sc,"__esModule",{value:!0}),sc.Validation=void 0,sc.isContext=function(e){return void 0!==e.context&&void 0!==e.reflector};var lc=function(){function e(){ke(this,e)}var t,n,r,a,o;return Ae(e,[{key:"frontendPreValidate",value:(o=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Ee(we().mark((function e(t,n){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();sc.Validation=lc;var cc={};Object.defineProperty(cc,"__esModule",{value:!0}),cc.validationRegistry=cc.ValidationSet=cc.ValidationResultSet=void 0;var uc=function(){function e(){ke(this,e),Oe(this,"results",[]),Oe(this,"ok",!0)}return Ae(e,[{key:"resultsMessages",get:function(){return this.results.map((function(e){var t;return null===(t=e.error)||void 0===t?void 0:t.message})).filter(Boolean).join(", ")}},{key:"add",value:function(e){this.results.push(e),e.error&&(this.ok=!1)}}]),e}();cc.ValidationResultSet=uc;var dc=function(){function e(){ke(this,e),Oe(this,"validations",new Set)}var t,n,r,a,o;return Ae(e,[{key:"registerValidation",value:function(e){this.validations.add(e)}},{key:"frontendPreValidate",value:(o=Ee(we().mark((function e(t){var n,r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new uc,r=Ve(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.frontendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Ee(we().mark((function e(t,n){var r,a,o,i,s;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new uc,a=Ve(this.validations),e.prev=2,a.s();case 4:if((o=a.n()).done){e.next=14;break}return i=o.value,e.next=8,i.frontendPostValidate(t,n);case 8:if(r.add(s=e.sent),!s.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Ee(we().mark((function e(t){var n,r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new uc,r=Ve(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.backendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Ee(we().mark((function e(t,n){var r,a,o,i,s,l,c;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=new uc,i=Ve(this.validations),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=15;break}return l=s.value,e.next=9,l.backendPostValidate(t,{featureModel:r,session:a});case 9:if(o.add(c=e.sent),!c.error){e.next=13;break}return e.abrupt("break",15);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Ee(we().mark((function e(t){var n,r,a,o;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ve(this.validations),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=7,a.possibleValues(t);case 7:if(!(o=e.sent)){e.next=10;break}return e.abrupt("return",o);case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return");case 21:case"end":return e.stop()}}),e,this,[[1,14,17,20]])}))),function(e){return t.apply(this,arguments)})}]),e}();cc.ValidationSet=dc,cc.validationRegistry=new dc;var fc={},pc={};Object.defineProperty(pc,"__esModule",{value:!0}),pc.default=["2A_self_cleaving_peptide_region","4_methylcytosine","5S_SINE_retrotransposon","5_carboxylcytosine","5_formylcytosine","5_hydroxymethylcytosine","5_methylcytosine","7SL_SINE_retrotransposon","8_oxoadenine","8_oxoguanine","AACCCT_box","AFLP_fragment","AP_1_binding_site","ARIA","ARRET","ARS","ARS_consensus_sequence","ASPE_primer","AUG_initiated_uORF","AU_rich_element","A_box","A_box_type_1","A_box_type_2","A_minor_RNA_motif","A_to_C_transversion","A_to_G_transition","A_to_T_transversion","Ace2_UAS","Alu_deletion","Alu_insertion","BAC","BAC_cloned_genomic_insert","BAC_end","BAC_read_contig","BREd_motif","BREu_motif","B_box","Bel_Pao_LTR_retrotransposon","Bruno_response_element","C-D_H_ACA_box_scaRNA","C-D_H_ACA_box_scaRNA_gene","CAAT_signal","CAAX_box","CACTA_TIR_transposon","CAGE_cluster","CAGE_tag","CArG_box","CCAAT_motif","CCA_tail","CDRE_motif","CDS","CDS_extension","CDS_five_prime_extension","CDS_fragment","CDS_independently_known","CDS_predicted","CDS_region","CDS_supported_by_EST_or_cDNA_data","CDS_supported_by_domain_match_data","CDS_supported_by_peptide_spectrum_match","CDS_supported_by_sequence_similarity_data","CDS_three_prime_extension","CRE","CRISPR","CSL_response_element","CTCF_binding_site","CTG_start_codon","C_D_box_scaRNA","C_D_box_scaRNA_gene","C_D_box_snoRNA","C_D_box_snoRNA_gene","C_D_box_snoRNA_primary_transcript","C_box","C_cluster","C_gene_segment","C_region","C_to_A_transversion","C_to_G_transversion","C_to_T_transition","C_to_T_transition_at_pCpG_site","ChIP_seq_region","Copia_LTR_retrotransposon","CpG_island","Crick_strand","Crypton_YR_transposon","CsrB_RsmB_RNA","CuRE","DArT_marker","DCE","DCE_SI","DCE_SII","DCE_SIII","DDB_box","DHU_loop","DIRS_YR_retrotransposon","DJ_C_cluster","DJ_J_C_cluster","DJ_J_cluster","DJ_gene_segment","DMv1_motif","DMv2_motif","DMv3_motif","DMv4_motif","DMv5_motif","DNA_aptamer","DNA_binding_site","DNA_chromosome","DNA_constraint_sequence","DNA_loop","DNA_loop_anchor","DNA_motif","DNA_sequence_secondary_structure","DNA_transposon","DNAzyme","DNaseI_hypersensitive_site","DPE1_motif","DPE_motif","DRE","DRE_motif","DSR_motif","D_DJ_C_cluster","D_DJ_J_C_cluster","D_DJ_J_cluster","D_DJ_cluster","D_J_C_cluster","D_J_cluster","D_cluster","D_gene_recombination_feature","D_gene_segment","D_loop","DsrA_RNA","ER_retention_signal","EST","EST_match","E_box_motif","Endogenous_Retrovirus_LTR_retrotransposon","FLEX_element","FRE","FRT_site","GAGA_motif","GATA_box","GC_rich_promoter_region","GNA_oligo","GTT_trinucleotide_repeat","GT_dinucleotide_repeat","G_box","G_quartet","G_to_A_transition","G_to_C_transversion","G_to_T_transversion","GcvB_RNA","Gypsy_LTR_retrotransposon","H2AK5_acetylation_site","H2AK9_acetylation_site","H2AZK11_acetylation_site","H2AZK13_acetylation_site","H2AZK15_acetylation_site","H2AZK4_acetylation_site","H2AZK7_acetylation_site","H2BK120_acetylation_site","H2BK12_acetylation_site","H2BK15_acetylation_site","H2BK20_acetylation_site","H2BK5_acetylation_site","H2BK5_monomethylation_site","H2B_ubiquitination_site","H3K14_acetylation_site","H3K18_acetylation_site","H3K20_trimethylation_site","H3K23_acetylation_site","H3K23_dimethylation_site","H3K27_acetylation_site","H3K27_dimethylation_site","H3K27_methylation_site","H3K27_monomethylation_site","H3K27_trimethylation_site","H3K36_acetylation_site","H3K36_dimethylation_site","H3K36_methylation_site","H3K36_monomethylation_site","H3K36_trimethylation_site","H3K4_acetylation_site","H3K4_dimethylation_site","H3K4_methylation_site","H3K4_monomethylation_site","H3K4_trimethylation","H3K56_acetylation_site","H3K79_dimethylation_site","H3K79_methylation_site","H3K79_monomethylation_site","H3K79_trimethylation_site","H3K9_acetylation_site","H3K9_dimethylation_site","H3K9_methylation_site","H3K9_monomethylation_site","H3K9_trimethylation_site","H3R2_dimethylation_site","H3R2_monomethylation_site","H4K12_acetylation_site","H4K16_acetylation_site","H4K20_monomethylation_site","H4K4_trimethylation_site","H4K5_acetylation_site","H4K8_acetylation_site","H4K91_acetylation_site","H4K_acylation_region","H4R3_dimethylation_site","HERV_deletion","HERV_insertion","HSE","H_ACA_box_scaRNA","H_ACA_box_scaRNA_gene","H_ACA_box_snoRNA","H_ACA_box_snoRNA_gene","H_ACA_box_snoRNA_primary_transcript","H_pseudoknot","Hoogsteen_base_pair","I-box","IG_C_gene","IG_C_pseudogene","IG_D_gene","IG_J_gene","IG_J_pseudogene","IG_V_gene","IG_V_pseudogene","INR1_motif","INR_motif","IRLinv_site","IRRinv_site","ISRE","I_LINE_retrotransposon","J_C_cluster","J_cluster","J_gene_recombination_feature","J_gene_segment","J_heptamer","J_nonamer","J_spacer","Jockey_LINE_retrotransposon","KEN_box","K_turn_RNA_motif","L1_LINE_retrotransposon","LARD","LINE1_deletion","LINE1_insertion","LINE_element","LNA_oligo","LOZ1_response_element","LTR_component","LTR_retrotransposon","L_box","MCB","MITE","MNP","MNV","MNV_artifact","MTE","Mat2P","Mat3M","Merlin_TIR_transposon","MicF_RNA","Mutator_TIR_transposon","N2_2_prime_O_dimethylguanosine","N2_7_2prirme_O_trimethylguanosine","N2_7_dimethylguanosine","N2_N2_2_prime_O_trimethylguanosine","N2_N2_7_trimethylguanosine","N2_N2_dimethylguanosine","N2_methylguanosine","N4_2_prime_O_dimethylcytidine","N4_N4_2_prime_O_trimethylcytidine","N4_acetyl_2_prime_O_methylcytidine","N4_acetylcytidine","N4_methylcytidine","N6_2_prime_O_dimethyladenosine","N6_N6_2_prime_O_trimethyladenosine","N6_N6_dimethyladenosine","N6_acetyladenosine","N6_cis_hydroxyisopentenyl_adenosine","N6_glycinylcarbamoyladenosine","N6_hydroxynorvalylcarbamoyladenosine","N6_isopentenyladenosine","N6_methyl_N6_threonylcarbamoyladenosine","N6_methyladenine","N6_methyladenosine","N6_threonylcarbamoyladenosine","NDM2_motif","NDM3_motif","NMD_polymorphic_pseudogene_transcript","NMD_transcript","NSD_transcript","N_region","Ngaro_YR_retrotransposon","ORF","Okazaki_fragment","OxyS_RNA","PAC","PAC_end","PCB","PCR_product","PIF_Harbinger_TIR_transposon","PIP_box","PNA_oligo","PSE_motif","P_TIR_transposon","Penelope_retrotransposon","Phage_RNA_Polymerase_Promoter","Pho7_binding_site","QTL","R2_LINE_retrotransposon","RAPD","RFLP_fragment","RH_map","RNA_6S","RNA_7SK","RNA_7SK_gene","RNA_aptamer","RNA_chromosome","RNA_hook_turn","RNA_internal_loop","RNA_junction_loop","RNA_motif","RNA_polymerase_III_TATA_box","RNA_polymerase_II_TATA_box","RNA_sequence_secondary_structure","RNA_stability_element","RNA_thermometer","RNAi_reagent","RNApol_III_promoter","RNApol_III_promoter_type_1","RNApol_III_promoter_type_2","RNApol_III_promoter_type_3","RNApol_II_core_promoter","RNApol_II_promoter","RNApol_I_promoter","RNase_MRP_RNA","RNase_MRP_RNA_gene","RNase_P_RNA","RNase_P_RNA_gene","RRE_RNA","RR_tract","RST","RST_match","RTE_LINE_retrotransposon","R_GNA_oligo","R_LTR_region","R_five_prime_LTR_region","R_three_prime_LTR_region","Retrovirus_LTR_retrotransposon","Robertsonian_fusion","RprA_RNA","SAGE_tag","SECIS_element","SHP_box","SINE_element","SL10_acceptor_site","SL11_acceptor_site","SL12_acceptor_site","SL1_acceptor_site","SL2_acceptor_site","SL3_acceptor_site","SL4_acceptor_site","SL5_acceptor_site","SL6_acceptor_site","SL7_acceptor_site","SL8_acceptor_site","SL9_acceptor_site","SNP","SNV","SNV_artifact","SP6_RNA_Polymerase_Promoter","SRP_RNA","SRP_RNA_gene","SRP_RNA_primary_transcript","STREP_motif","STS","STS_map","SUMO_interaction_motif","SVA_deletion","SVA_insertion","S_GNA_oligo","S_region","Sap1_recognition_motif","Shine_Dalgarno_sequence","T3_RNA_Polymerase_Promoter","T7_RNA_Polymerase_Promoter","TATA_box","TCS_element","TCT_motif","TERRA","TFRS_collection","TFRS_module","TF_binding_site","TNA_oligo","TRIM","TR_C_Gene","TR_D_Gene","TR_J_Gene","TR_J_pseudogene","TR_V_Gene","TR_V_pseudogene","TR_box","TSS","T_cell_receptor_gene","T_cell_receptor_pseudogene","T_loop","T_to_A_transversion","T_to_C_transition","T_to_G_transversion","Tc1_Mariner_TIR_transposon","Transib_TIR_transposon","U11_snRNA","U12_intron","U12_snRNA","U14_snoRNA","U14_snoRNA_gene","U14_snoRNA_primary_transcript","U1_snRNA","U2_intron","U2_snRNA","U3_LTR_region","U3_five_prime_LTR_region","U3_snoRNA","U3_snoRNA_gene","U3_three_prime_LTR_region","U4_snRNA","U4atac_snRNA","U5_LTR_region","U5_five_prime_LTR_region","U5_snRNA","U5_three_prime_LTR_region","U6_snRNA","U6atac_snRNA","U7_snRNA","UAA_stop_codon_signal","UAG_stop_codon_signal","UGA_stop_codon_signal","UNAAAC_motif","UPD","UST","UST_match","UTR","UTR_intron","UTR_region","U_box","VDJ_C_cluster","VDJ_J_C_cluster","VDJ_J_cluster","VDJ_gene_segment","VD_gene_segment","VJ_C_cluster","VJ_J_C_cluster","VJ_J_cluster","VJ_gene_segment","V_DJ_C_cluster","V_DJ_J_C_cluster","V_DJ_J_cluster","V_DJ_cluster","V_D_DJ_C_cluster","V_D_DJ_J_C_cluster","V_D_DJ_J_cluster","V_D_DJ_cluster","V_D_J_C_cluster","V_D_J_cluster","V_J_C_cluster","V_J_cluster","V_VDJ_C_cluster","V_VDJ_J_C_cluster","V_VDJ_J_cluster","V_VDJ_cluster","V_VJ_C_cluster","V_VJ_J_C_cluster","V_VJ_J_cluster","V_VJ_cluster","V_cluster","V_gene_recombination_feature","V_gene_segment","V_heptamer","V_nonamer","V_region","V_spacer","Viper_YR_retrotransposon","WC_base_pair","W_region","Watson_strand","X_element","X_element_combinatorial_repeat","X_region","YAC","YAC_end","YR_retrotransposon","Y_RNA","Y_RNA_gene","Y_RNA_primary_transcript","Y_prime_element","Y_region","Z1_region","Z2_region","Zas1_recognition_motif","aberrant_processed_transcript","accessible_DNA_region","active_peptide","adaptive_island","alanine","alanine_tRNA_primary_transcript","alanyl_tRNA","allelic_pseudogene","allelic_pseudogenic_rRNA","allelic_pseudogenic_tRNA","allelically_excluded_gene","alpha_beta_motif","alpha_helix","alternate_sequence_site","alternatively_spliced_transcript","amber_stop_codon","ambisense_ssRNA_viral_sequence","amino_acid","amplification_origin","anchor_binding_site","anchor_region","androgen_response_element","anti_ARRET","anticodon","anticodon_loop","antiparallel_beta_strand","antisense_RNA","antisense_lncRNA","antisense_lncRNA_gene","antisense_primary_transcript","apicoplast_chromosome","apicoplast_gene","aptamer","archaeal_intron","archaeosine","arginine","arginine_tRNA_primary_transcript","arginyl_tRNA","asparagine","asparagine_tRNA_primary_transcript","asparaginyl_tRNA","aspartic_acid","aspartic_acid_tRNA_primary_transcript","aspartyl_tRNA","assembly","assembly_component","assembly_error_correction","asx_motif","asx_turn","asx_turn_left_handed_type_one","asx_turn_left_handed_type_two","asx_turn_right_handed_type_one","asx_turn_right_handed_type_two","asymmetric_RNA_internal_loop","attB_site","attC_site","attCtn_site","attI_site","attL_site","attP_site","attR_site","attenuator","autocatalytically_spliced_intron","bacterial_RNApol_promoter","bacterial_RNApol_promoter_sigma54_element","bacterial_RNApol_promoter_sigma_70_element","bacterial_RNApol_promoter_sigma_ecf_element","bacterial_terminator","base","base_call_error_correction","base_pair","beta_bulge","beta_bulge_loop","beta_bulge_loop_five","beta_bulge_loop_six","beta_strand","beta_turn","beta_turn_left_handed_type_one","beta_turn_left_handed_type_two","beta_turn_right_handed_type_one","beta_turn_right_handed_type_two","beta_turn_type_eight","beta_turn_type_six","beta_turn_type_six_a","beta_turn_type_six_a_one","beta_turn_type_six_a_two","beta_turn_type_six_b","bidirectional_promoter","bidirectional_promoter_lncRNA","binding_site","biochemical_region_of_peptide","biological_region","biomaterial_region","biosynthetic_gene_cluster","blocked_reading_frame","blunt_end_restriction_enzyme_cleavage_junction","blunt_end_restriction_enzyme_cleavage_site","boundary_element","branch_site","cDNA_clone","cDNA_match","c_terminal_region","candidate_gene","canonical_five_prime_splice_site","canonical_three_prime_splice_site","cap","capped_mRNA","capped_primary_transcript","cassette_pseudogene","catalytic_residue","catmat_left_handed_four","catmat_left_handed_three","catmat_right_handed_four","catmat_right_handed_three","central_hydrophobic_region_of_signal_peptide","centromere","centromere_DNA_Element_I","centromere_DNA_Element_II","centromere_DNA_Element_III","centromeric_repeat","chimeric_cDNA_clone","chloroplast_DNA_read","chloroplast_chromosome","chromatin_regulatory_region","chromoplast_chromosome","chromoplast_gene","chromosomal_regulatory_element","chromosomal_structural_element","chromosomal_translocation","chromosome","chromosome_arm","chromosome_band","chromosome_breakage_sequence","chromosome_breakpoint","chromosome_part","circular_double_stranded_DNA_chromosome","circular_double_stranded_RNA_chromosome","circular_mRNA","circular_ncRNA","circular_plasmid","circular_single_stranded_DNA_chromosome","circular_single_stranded_RNA_chromosome","cis_acting_homologous_chromosome_pairing_region","cis_regulatory_frameshift_element","cis_regulatory_module","cis_splice_site","class_II_RNA","class_I_RNA","cleaved_for_gpi_anchor_region","cleaved_initiator_methionine","cleaved_peptide_region","clip","clone","clone_end","clone_insert","clone_insert_end","clone_insert_start","cloned_cDNA_insert","cloned_genomic_insert","cloned_region","coding_conserved_region","coding_end","coding_exon","coding_region_of_exon","coding_start","coding_transcript_with_retained_intron","codon","coiled_coil","cointegrated_plasmid","common_fragile_site","complex_chromosomal_rearrangement","complex_operon","complex_regulon","complex_structural_alteration","complex_substitution","compositionally_biased_region_of_peptide","conformational_switch","conjugative_transposon","consensus_AFLP_fragment","consensus_gDNA","consensus_mRNA","consensus_region","conserved_region","constitutive_promoter","contig","contig_collection","contig_read","copy_number_gain","copy_number_loss","copy_number_variation","core_eukaryotic_promoter_element","core_prokaryotic_promoter_element","core_promoter_element","core_viral_promoter_element","cosmid","cross_genome_match","cryptic_gene","cryptic_promoter","cryptic_prophage","cryptic_splice_site","cryptogene","ct_gene","cyanelle_chromosome","cyanelle_gene","cyclic_translocation","cysteine","cysteine_tRNA_primary_transcript","cysteinyl_tRNA","cytoplasmic_polypeptide_region","cytosolic_16S_rRNA","cytosolic_18S_rRNA","cytosolic_23S_rRNA","cytosolic_25S_rRNA","cytosolic_28S_rRNA","cytosolic_2S_rRNA","cytosolic_5S_rRNA","cytosolic_5_8S_rRNA","cytosolic_LSU_rRNA","cytosolic_LSU_rRNA_gene","cytosolic_SSU_rRNA","cytosolic_SSU_rRNA_gene","cytosolic_rRNA","cytosolic_rRNA_16S_gene","cytosolic_rRNA_18S_gene","cytosolic_rRNA_23S_gene","cytosolic_rRNA_25S_gene","cytosolic_rRNA_28S_gene","cytosolic_rRNA_2S_gene","cytosolic_rRNA_5S_gene","cytosolic_rRNA_5_8S_gene","cytosolic_rRNA_gene","dCAPS_primer","databank_entry","decayed_exon","defective_conjugative_transposon","deficient_translocation","deletion","deletion_artifact","deletion_breakpoint","deletion_junction","delins","destruction_box","dg_repeat","dh_repeat","dicistronic_mRNA","dicistronic_primary_transcript","dicistronic_transcript","dif_site","dihydrouridine","dinucleotide_repeat_microsatellite_feature","direct_repeat","direct_tandem_duplication","disabled_reading_frame","dispersed_repeat","distal_duplication","distal_promoter_element","distant_three_prime_recoding_signal","double_stranded_DNA_chromosome","double_stranded_RNA_chromosome","ds_DNA_viral_sequence","ds_RNA_viral_sequence","ds_oligo","duplicated_pseudogene","duplication","duplication_artifact","dye_terminator_read","early_origin_of_replication","edited_CDS","edited_mRNA","edited_transcript","edited_transcript_by_A_to_I_substitution","edited_transcript_feature","editing_block","editing_domain","endogenous_retroviral_gene","endonuclease_spliced_intron","endosomal_localization_signal","engineered_episome","engineered_foreign_gene","engineered_foreign_region","engineered_foreign_repetitive_element","engineered_foreign_transposable_element","engineered_foreign_transposable_element_gene","engineered_fusion_gene","engineered_gene","engineered_insert","engineered_plasmid","engineered_region","engineered_rescue_region","engineered_tag","engineered_transposable_element","enhancer","enhancerRNA","enhancer_binding_site","enhancer_blocking_element","enhancer_bound_by_factor","enhancer_trap_construct","enzymatic_RNA","enzymatic_RNA_gene","epigenetically_modified_gene","epigenetically_modified_region","epigenomically_modified_region","episome","epitope","epoxyqueuosine","eukaryotic_promoter","eukaryotic_terminator","exemplar_mRNA","exon","exon_junction","exon_of_single_exon_gene","exon_region","exonic_splice_enhancer","exonic_splicing_silencer","experimental_feature","experimental_result_region","experimentally_defined_binding_region","expressed_sequence_assembly","expressed_sequence_match","extended_cis_splice_site","extended_intronic_splice_region","external_transcribed_spacer_region","extrachromosomal_mobile_genetic_element","extramembrane_polypeptide_region","fingerprint_map","five_aminomethyl_two_thiouridine","five_carbamoylmethyl_two_prime_O_methyluridine","five_carbamoylmethyluridine","five_carboxyhydroxymethyl_uridine","five_carboxyhydroxymethyl_uridine_methyl_ester","five_carboxymethylaminomethyl_two_prime_O_methyluridine","five_carboxymethylaminomethyl_two_thiouridine","five_carboxymethylaminomethyluridine","five_carboxymethyluridine","five_formyl_two_prime_O_methylcytidine","five_formylcytidine","five_hydroxymethylcytidine","five_hydroxyuridine","five_isopentenylaminomethyl_two_prime_O_methyluridine","five_isopentenylaminomethyl_two_thiouridine","five_isopentenylaminomethyl_uridine","five_methoxycarbonylmethyl_two_prime_O_methyluridine","five_methoxycarbonylmethyl_two_thiouridine","five_methoxycarbonylmethyluridine","five_methoxyuridine","five_methyl_2_thiouridine","five_methylaminomethyl_two_selenouridine","five_methylaminomethyl_two_thiouridine","five_methylaminomethyluridine","five_methylcytidine","five_methyldihydrouridine","five_methyluridine","five_prime_D_heptamer","five_prime_D_nonamer","five_prime_D_recombination_signal_sequence","five_prime_D_spacer","five_prime_EST","five_prime_LTR","five_prime_LTR_component","five_prime_RST","five_prime_UST","five_prime_UTR","five_prime_UTR_intron","five_prime_cis_splice_site","five_prime_clip","five_prime_coding_exon","five_prime_coding_exon_coding_region","five_prime_coding_exon_noncoding_region","five_prime_flanking_region","five_prime_intron","five_prime_noncoding_exon","five_prime_open_reading_frame","five_prime_recoding_site","five_prime_restriction_enzyme_junction","five_prime_sticky_end_restriction_enzyme_cleavage_site","five_prime_terminal_inverted_repeat","five_taurinomethyl_two_thiouridine","five_taurinomethyluridine","five_two_prime_O_dimethylcytidine","five_two_prime_O_dimethyluridine","flanking_region","flanking_repeat","flanking_three_prime_quadruplet_recoding_signal","floxed_gene","foldback_element","foreign_gene","foreign_transposable_element","forkhead_motif","forward_primer","fosmid","four_bp_start_codon","four_demethylwyosine","four_thiouridine","fragile_site","fragment_assembly","functional_candidate_gene","functional_gene_region","fusion_gene","gRNA_gene","galactosyl_queuosine","gamma_turn","gamma_turn_classic","gamma_turn_inverse","gap","gene","gene_array","gene_cassette","gene_cassette_array","gene_component_region","gene_fragment","gene_group","gene_member_region","gene_rearranged_at_DNA_level","gene_segment","gene_silenced_by_DNA_methylation","gene_silenced_by_DNA_modification","gene_silenced_by_RNA_interference","gene_silenced_by_histone_deacetylation","gene_silenced_by_histone_methylation","gene_silenced_by_histone_modification","gene_subarray","gene_trap_construct","gene_with_dicistronic_mRNA","gene_with_dicistronic_primary_transcript","gene_with_dicistronic_transcript","gene_with_edited_transcript","gene_with_mRNA_recoded_by_translational_bypass","gene_with_mRNA_with_frameshift","gene_with_non_canonical_start_codon","gene_with_polyadenylated_mRNA","gene_with_polycistronic_transcript","gene_with_recoded_mRNA","gene_with_start_codon_CUG","gene_with_stop_codon_read_through","gene_with_stop_codon_redefined_as_pyrrolysine","gene_with_stop_codon_redefined_as_selenocysteine","gene_with_trans_spliced_transcript","gene_with_transcript_with_translational_frameshift","genetic_marker","genomic_DNA_contig","genomic_DNA_read","genomic_clone","genomic_island","genomically_contaminated_cDNA_clone","glutamic_acid","glutamic_acid_tRNA_primary_transcript","glutamine","glutamine_tRNA_primary_transcript","glutaminyl_tRNA","glutamyl_tRNA","glycine","glycine_tRNA_primary_transcript","glycyl_tRNA","golden_path","golden_path_fragment","group_1_intron_homing_endonuclease_target_region","group_IIA_intron","group_IIB_intron","group_IIC_intron","group_III_intron","group_II_intron","group_I_intron","guide_RNA","guide_RNA_region","hAT_TIR_transposon","hammerhead_ribozyme","haplotype_block","helitron","helix_turn_helix","heptamer_of_recombination_feature_of_vertebrate_immune_system_gene","heritable_phenotypic_marker","high_identity_region","histidine","histidine_tRNA_primary_transcript","histidyl_tRNA","histone_2AZ_acetylation_site","histone_2A_acetylation_site","histone_2B_acetylation_site","histone_3_acetylation_site","histone_4_acetylation_site","histone_acetylation_site","histone_acylation_region","histone_binding_site","histone_methylation_site","histone_modification","histone_ubiqitination_site","homing_endonuclease_binding_site","homol_D_box","homol_E_box","homologous_chromosome_recognition_and_pairing_locus","homologous_region","hpRNA","hpRNA_gene","hydrophobic_region_of_peptide","hydroxywybutosine","iDNA","i_motif","immature_peptide_region","immunoglobulin_gene","immunoglobulin_pseudogene","immunoglobulin_region","imprinting_control_region","indel_artifact","inducible_promoter","inert_DNA_spacer","inosine","insertion","insertion_artifact","insertion_breakpoint","insertion_sequence","insertion_site","insulator","insulator_binding_site","integrated_mobile_genetic_element","integrated_plasmid","integration_excision_site","integron","intein","intein_encoding_region","interband","interchromosomal_breakpoint","interchromosomal_translocation","intergenic_region","interior_coding_exon","interior_exon","interior_intron","intermediate_element","internal_Shine_Dalgarno_sequence","internal_UTR","internal_eliminated_sequence","internal_guide_sequence","internal_ribosome_entry_site","internal_transcribed_spacer_region","intrachromosomal_breakpoint","intrachromosomal_translocation","intramembrane_polypeptide_region","intrinsically_unstructured_polypeptide_region","introgressed_chromosome_region","intron","intron_base_5","intron_domain","intronic_regulatory_region","intronic_splice_enhancer","intronic_splicing_silencer","invalidated_cDNA_clone","inversion","inversion_breakpoint","inversion_cum_translocation","inversion_site","inversion_site_part","inverted_intrachromosomal_transposition","inverted_repeat","inverted_tandem_duplication","iron_repressed_GATA_element","iron_responsive_element","isoleucine","isoleucine_tRNA_primary_transcript","isoleucyl_tRNA","isomiR","isowyosine","junction","kinetoplast_gene","knob","kozak_sequence","lambda_vector","lariat_intron","late_origin_of_replication","left_handed_peptide_helix","leucine","leucine_tRNA_primary_transcript","leucoplast_chromosome","leucoplast_gene","leucyl_tRNA","ligand_binding_site","ligation_based_read","lincRNA","lincRNA_gene","linear_double_stranded_DNA_chromosome","linear_double_stranded_RNA_chromosome","linear_plasmid","linear_single_stranded_DNA_chromosome","linear_single_stranded_RNA_chromosome","linkage_group","lipoprotein_signal_peptide","lncRNA","lncRNA_gene","lncRNA_primary_transcript","lncRNA_with_retained_intron","loR","locus_control_region","long_terminal_repeat","long_terminal_repeat_transcript","loop","low_complexity_region","loxP_site","lysidine","lysine","lysine_tRNA_primary_transcript","lysosomal_localization_signal","lysyl_tRNA","mRNA","mRNA_contig","mRNA_read","mRNA_recoded_by_codon_redefinition","mRNA_recoded_by_translational_bypass","mRNA_region","mRNA_with_frameshift","mRNA_with_minus_1_frameshift","mRNA_with_minus_2_frameshift","mRNA_with_plus_1_frameshift","mRNA_with_plus_2_frameshift","macronuclear_chromosome","macronucleus_destined_segment","major_TSS","mannosyl_queuosine","match","match_part","maternal_uniparental_disomy","maternally_imprinted_gene","mathematically_defined_repeat","mating_type_M_box","mating_type_region","mating_type_region_motif","mating_type_region_replication_fork_barrier","matrix_attachment_site","mature_protein_region","mature_protein_region_of_CDS","mature_transcript","mature_transcript_region","maxicircle","maxicircle_gene","meiotic_recombination_region","membrane_peptide_loop","membrane_structure","metabolic_island","metal_binding_site","methionine","methionine_tRNA_primary_transcript","methionyl_tRNA","methylated_DNA_base_feature","methylated_adenine","methylated_cytosine","methylation_guide_snoRNA","methylation_guide_snoRNA_gene","methylation_guide_snoRNA_primary_transcript","methylinosine","methylwyosine","miRNA","miRNA_antiguide","miRNA_gene","miRNA_loop","miRNA_primary_transcript","miRNA_primary_transcript_region","miRNA_stem","miRNA_target_site","miR_encoding_Y_RNA_primary_transcript","miR_encoding_lncRNA_primary_transcript","miR_encoding_shRNA_primary_transcript","miR_encoding_snoRNA_primary_transcript","miR_encoding_tRNA_primary_transcript","miR_encoding_vaultRNA_primary_transcript","miRtron","microarray_oligo","micronuclear_chromosome","microsatellite","mini_exon_donor_RNA","mini_gene","minicircle","minicircle_gene","minisatellite","minor_TSS","minus_10_signal","minus_12_signal","minus_1_translational_frameshift","minus_24_signal","minus_2_translational_frameshift","minus_35_signal","mitochondrial_DNA_read","mitochondrial_D_loop","mitochondrial_chromosome","mitochondrial_contig","mitochondrial_control_region","mitochondrial_supercontig","mitochondrial_targeting_signal","mitotic_recombination_region","moR","mobile_element_deletion","mobile_element_insertion","mobile_genetic_element","mobile_intron","modified_DNA_base","modified_L_alanine","modified_L_arginine","modified_L_asparagine","modified_L_aspartic_acid","modified_L_cysteine","modified_L_glutamic_acid","modified_L_glutamine","modified_L_histidine","modified_L_isoleucine","modified_L_leucine","modified_L_lysine","modified_L_methionine","modified_L_phenylalanine","modified_L_proline","modified_L_selenocysteine","modified_L_serine","modified_L_threonine","modified_L_tryptophan","modified_L_tyrosine","modified_L_valine","modified_RNA_base_feature","modified_adenine","modified_adenosine","modified_amino_acid_feature","modified_cytidine","modified_cytosine","modified_glycine","modified_guanine","modified_guanosine","modified_inosine","modified_uridine","molecular_contact_region","monocistronic_mRNA","monocistronic_primary_transcript","monocistronic_transcript","monomeric_repeat","morpholino_oligo","mt_LSU_rRNA","mt_LSU_rRNA_gene","mt_SSU_rRNA","mt_SSU_rRNA_gene","mt_gene","mt_rRNA","mt_rRNA_gene","mt_tRNA","multiplexing_sequence_identifier","mutated_variant_site","mutational_hotspot","n_terminal_region","natural_plasmid","natural_transposable_element","natural_variant_site","ncRNA","ncRNA_gene","nc_conserved_region","nc_primary_transcript","negative_sense_ssRNA_viral_sequence","negatively_autoregulated_gene","nested_repeat","nested_tandem_repeat","nested_transposon","no_output","no_sequence_alteration","non_AUG_initiated_uORF","non_LTR_retrotransposon","non_LTR_retrotransposon_polymeric_tract","non_adjacent_residues","non_allelic_homologous_recombination_region","non_canonical_five_prime_splice_site","non_canonical_start_codon","non_canonical_three_prime_splice_site","non_complimentary_stem","non_cytoplasmic_polypeptide_region","non_processed_pseudogene","non_terminal_residue","non_transcribed_region","nonamer_of_recombination_feature_of_vertebrate_immune_system_gene","noncoding_exon","noncoding_region_of_exon","novel_sequence_insertion","nuclear_chromosome","nuclear_export_signal","nuclear_gene","nuclear_localization_signal","nuclear_mt_pseudogene","nuclear_rim_localization_signal","nuclease_binding_site","nuclease_hypersensitive_site","nuclease_sensitive_site","nucleomorph_gene","nucleomorphic_chromosome","nucleotide_binding_site","nucleotide_cleavage_site","nucleotide_match","nucleotide_motif","nucleotide_to_protein_binding_site","ochre_stop_codon","octamer_motif","oligo","oligo_U_tail","one_methyl_three_three_amino_three_carboxypropyl_pseudouridine","one_methyladenosine","one_methylguanosine","one_methylinosine","one_methylpseudouridine","one_two_prime_O_dimethyladenosine","one_two_prime_O_dimethylguanosine","one_two_prime_O_dimethylinosine","opal_stop_codon","open_chromatin_region","operator","operon","oriC","oriT","oriV","origin_of_replication","orphan_CDS","orthologous_region","outron","overlapping_EST_set","overlapping_feature_set","paired_end_fragment","parallel_beta_strand","paralogous_region","partial_genomic_sequence_assembly","partially_processed_cDNA_clone","paternal_uniparental_disomy","paternally_imprinted_gene","pathogenic_island","peptide_coil","peptide_helix","peptide_localization_signal","peroxywybutosine","phage_sequence","phagemid","phenylalanine","phenylalanine_tRNA_primary_transcript","phenylalanyl_tRNA","pheromone_response_element","phosphorylation_site","piRNA","piRNA_gene","pi_helix","piggyBac_TIR_transposon","plasmid","plasmid_gene","plasmid_vector","plastid_LSU_rRNA","plastid_LSU_rRNA_gene","plastid_SSU_rRNA","plastid_SSU_rRNA_gene","plastid_gene","plastid_rRNA","plastid_rRNA_gene","plus_1_translational_frameshift","plus_2_translational_frameshift","point_centromere","point_mutation","polinton","polyA_primed_cDNA_clone","polyA_sequence","polyA_signal_sequence","polyA_site","polyA_site_cluster","polyadenylated_mRNA","polycistronic_mRNA","polycistronic_primary_transcript","polycistronic_transcript","polymerase_synthesis_read","polymorphic_pseudogene","polymorphic_pseudogene_processed_transcript","polymorphic_pseudogene_with_retained_intron","polypeptide","polypeptide_DNA_contact","polypeptide_binding_motif","polypeptide_calcium_ion_contact_site","polypeptide_catalytic_motif","polypeptide_cobalt_ion_contact_site","polypeptide_conserved_motif","polypeptide_conserved_region","polypeptide_copper_ion_contact_site","polypeptide_domain","polypeptide_iron_ion_contact_site","polypeptide_ligand_contact","polypeptide_magnesium_ion_contact_site","polypeptide_manganese_ion_contact_site","polypeptide_metal_contact","polypeptide_molybdenum_ion_contact_site","polypeptide_motif","polypeptide_nest_left_right_motif","polypeptide_nest_motif","polypeptide_nest_right_left_motif","polypeptide_nickel_ion_contact_site","polypeptide_region","polypeptide_repeat","polypeptide_secondary_structure","polypeptide_sequencing_information","polypeptide_structural_motif","polypeptide_structural_region","polypeptide_tungsten_ion_contact_site","polypeptide_turn_motif","polypeptide_variation_site","polypeptide_zinc_ion_contact_site","polypyrimidine_tract","positional_candidate_gene","positive_sense_ssRNA_viral_sequence","positively_autoregulated_gene","possible_assembly_error","possible_base_call_error","post_translationally_modified_region","post_translationally_regulated_gene","pre_edited_mRNA","pre_edited_region","pre_miRNA","predicted_gene","predicted_transcript","presence_absence_variation","priRNA","primary_transcript","primary_transcript_region","primer","primer_binding_site","primer_match","probe","processed_pseudogene","processed_pseudogenic_rRNA","processed_pseudogenic_tRNA","processed_transcript","prokaryotic_promoter","proline","proline_tRNA_primary_transcript","prolyl_tRNA","promoter","promoter_element","promoter_flanking_region","promoter_targeting_sequence","promoter_trap_construct","propeptide","propeptide_cleavage_site","propeptide_region_of_CDS","prophage","proplastid_gene","protease_site","protein_binding_site","protein_coding_gene","protein_coding_primary_transcript","protein_hmm_match","protein_match","protein_protein_contact","protein_stability_element","proviral_gene","proviral_region","proximal_promoter_element","pseudogene","pseudogene_by_unequal_crossing_over","pseudogene_processed_transcript","pseudogenic_CDS","pseudogenic_exon","pseudogenic_gene_segment","pseudogenic_rRNA","pseudogenic_region","pseudogenic_tRNA","pseudogenic_transcript","pseudogenic_transcript_with_retained_intron","pseudoknot","pseudouridine","pseudouridylation_guide_snoRNA","pseudouridylation_guide_snoRNA_gene","pumilio_response_element","purine_to_pyrimidine_transversion","purine_transition","pyrimidine_to_purine_transversion","pyrimidine_transition","pyrosequenced_read","pyrrolysine","pyrrolysine_tRNA_primary_transcript","pyrrolysyl_tRNA","queuosine","rDNA_intergenic_spacer_element","rDNA_replication_fork_barrier","rRNA","rRNA_21S_gene","rRNA_cleavage_RNA","rRNA_cleavage_snoRNA_primary_transcript","rRNA_gene","rRNA_large_subunit_primary_transcript","rRNA_primary_transcript","rRNA_primary_transcript_region","rRNA_small_subunit_primary_transcript","rare_fragile_site","rasiRNA","read","read_pair","reading_frame","reagent","rearrangement_region","reciprocal_chromosomal_translocation","recoded_codon","recoded_mRNA","recoding_pseudoknot","recoding_stimulatory_region","recombination_enhancer","recombination_feature","recombination_feature_of_rearranged_gene","recombination_hotspot","recombination_regulatory_region","recombination_signal_sequence","recombinationally_inverted_gene","recombinationally_rearranged_gene","recombinationally_rearranged_vertebrate_immune_system_gene","recursive_splice_site","ref_miRNA","region","regional_centromere","regional_centromere_central_core","regional_centromere_inner_repeat_region","regional_centromere_outer_repeat_region","regional_centromere_outer_repeat_transcript","regulatory_promoter_element","regulatory_region","regulon","remark","repeat_component","repeat_fragment","repeat_instability_region","repeat_region","repeat_unit","replication_regulatory_region","replication_start_site","replicon","rescue_gene","rescue_mini_gene","rescue_region","resolution_site","response_element","restriction_enzyme_assembly_scar","restriction_enzyme_binding_site","restriction_enzyme_cleavage_junction","restriction_enzyme_five_prime_single_strand_overhang","restriction_enzyme_recognition_site","restriction_enzyme_region","restriction_enzyme_single_strand_overhang","restriction_enzyme_three_prime_single_strand_overhang","restriction_fragment","retinoic_acid_responsive_element","retrogene","retron","retrotransposon","reverse_Hoogsteen_base_pair","reverse_primer","rho_dependent_bacterial_terminator","rho_independent_bacterial_terminator","ribonuclease_site","ribosome_entry_site","riboswitch","ribothymidine","ribozyme","ribozyme_gene","right_handed_peptide_helix","sORF","sarcin_like_RNA_motif","satellite_DNA","sbRNA","sbRNA_gene","scRNA","scRNA_gene","scRNA_primary_transcript","scaRNA","scaRNA_gene","schellmann_loop","schellmann_loop_seven","schellmann_loop_six","selection_marker","selenocysteine","selenocysteine_tRNA_primary_transcript","selenocysteinyl_tRNA","self_cleaving_ribozyme","sense_intronic_ncRNA","sense_intronic_ncRNA_gene","sense_overlap_ncRNA","sense_overlap_ncRNA_gene","sequence_alteration","sequence_alteration_artifact","sequence_assembly","sequence_comparison","sequence_conflict","sequence_difference","sequence_feature","sequence_length_alteration","sequence_motif","sequence_rearrangement_feature","sequence_secondary_structure","sequence_uncertainty","sequencing_primer","serine","serine_tRNA_primary_transcript","serine_threonine_motif","serine_threonine_staple_motif","serine_threonine_turn","seryl_tRNA","seven_aminomethyl_seven_deazaguanosine","seven_cyano_seven_deazaguanosine","seven_deazaguanosine","seven_methylguanine","seven_methylguanosine","sgRNA","shRNA","shRNA_primary_transcript","shadow_enhancer","short_tandem_repeat_variation","siRNA","signal_anchor","signal_peptide","signal_peptide_region_of_CDS","signature","silenced_gene","silencer","silent_mating_type_cassette_array","simple_operon","simple_regulon","simple_sequence_length_variation","single_strand_restriction_enzyme_cleavage_site","single_stranded_DNA_chromosome","single_stranded_RNA_chromosome","sisRNA","site_specific_recombination_target_region","smFISH_probe","small_regulatory_ncRNA","snRNA","snRNA_gene","snRNA_primary_transcript","sncRNA","sncRNA_gene","snoRNA","snoRNA_gene","snoRNA_primary_transcript","solo_LTR","sonicate_fragment","specific_recombination_site","splice_enhancer","splice_junction","splice_region","splice_site","spliced_leader_RNA","spliceosomal_intron","spliceosomal_intron_region","splicing_regulatory_region","spot_42_RNA","spurious_protein","ss_RNA_viral_sequence","ss_oligo","st_turn_left_handed_type_one","st_turn_left_handed_type_two","st_turn_right_handed_type_one","st_turn_right_handed_type_two","start_codon","stem","stem_loop","stem_loop_region","sterol_regulatory_element","sticky_end_restriction_enzyme_cleavage_site","stop_codon","stop_codon_read_through","stop_codon_redefined_as_pyrrolysine","stop_codon_redefined_as_selenocysteine","stop_codon_signal","structural_alteration","substitution","substitution_artifact","subtelomere","sugar_edge_base_pair","supercontig","symbiosis_island","symmetric_RNA_internal_loop","syntenic_region","synthetic_oligo","tRNA","tRNA_SINE_retrotransposon","tRNA_gene","tRNA_intron","tRNA_primary_transcript","tRNA_region","tag","tandem_duplication","tandem_repeat","target_site_duplication","targeting_vector","tasiRNA","tasiRNA_primary_transcript","teb1_recognition_motif","telomerase_RNA","telomerase_RNA_gene","telomere","telomeric_D_loop","telomeric_repeat","telomeric_transcript","template_region","terminal_inverted_repeat","terminal_inverted_repeat_element","terminal_repeat","terminator","terminator_of_type_2_RNApol_III_promoter","tetraloop","tetranucleotide_repeat_microsatellite_feature","three_methylcytidine","three_methylpseudouridine","three_methyluridine","three_prime_D_heptamer","three_prime_D_nonamer","three_prime_D_recombination_signal_sequence","three_prime_D_spacer","three_prime_EST","three_prime_LTR","three_prime_LTR_component","three_prime_RACE_clone","three_prime_RST","three_prime_UST","three_prime_UTR","three_prime_UTR_intron","three_prime_cis_splice_site","three_prime_clip","three_prime_coding_exon","three_prime_coding_exon_coding_region","three_prime_coding_exon_noncoding_region","three_prime_flanking_region","three_prime_intron","three_prime_noncoding_exon","three_prime_overlapping_ncrna","three_prime_recoding_site","three_prime_repeat_recoding_signal","three_prime_restriction_enzyme_junction","three_prime_stem_loop_structure","three_prime_sticky_end_restriction_enzyme_cleavage_site","three_prime_terminal_inverted_repeat","three_ten_helix","three_three_amino_three_carboxypropyl_uridine","three_two_prime_O_dimethyluridine","threonine","threonine_tRNA_primary_transcript","threonyl_tRNA","tiling_path","tiling_path_clone","tiling_path_fragment","tmRNA","tmRNA_acceptor_piece","tmRNA_coding_piece","tmRNA_gene","tmRNA_primary_transcript","tmRNA_region","tnaORF","topologically_associated_domain","topologically_associated_domain_boundary","topologically_defined_region","trans_splice_acceptor_site","trans_splice_donor_site","trans_splice_junction","trans_splice_site","trans_spliced_mRNA","trans_spliced_transcript","transcribed_cluster","transcribed_fragment","transcribed_processed_pseudogene","transcribed_spacer_region","transcribed_unitary_pseudogene","transcribed_unprocessed_pseudogene","transcript","transcript_bound_by_nucleic_acid","transcript_bound_by_protein","transcript_region","transcript_with_translational_frameshift","transcription_end_site","transcription_factor_regulatory_site","transcription_pause_site","transcription_start_cluster","transcription_termination_signal","transcription_unit","transcriptional_cis_regulatory_region","transgene","transgenic_insertion","transgenic_transposable_element","transit_peptide","transit_peptide_region_of_CDS","transition","translated_nucleotide_match","translated_processed_pseudogene","translated_unprocessed_pseudogene","translation_regulatory_region","translational_frameshift","translationally_regulated_gene","translocation","translocation_breakpoint","translocation_element","transmembrane_helix","transmembrane_polypeptide_region","transposable_element","transposable_element_CDS","transposable_element_flanking_region","transposable_element_gene","transposable_element_insertion_site","transposable_element_pseudogene","transposon_fragment","transversion","trinucleotide_repeat_microsatellite_feature","tryptophan","tryptophan_tRNA_primary_transcript","tryptophanyl_tRNA","twintron","two_methyladenosine","two_methylthio_N6_cis_hydroxyisopentenyl_adenosine","two_methylthio_N6_hydroxynorvalyl_carbamoyladenosine","two_methylthio_N6_isopentenyladenosine","two_methylthio_N6_methyladenosine","two_methylthio_N6_threonyl_carbamoyladenosine","two_prime_O_methyladenosine","two_prime_O_methylcytidine","two_prime_O_methylguanosine","two_prime_O_methylinosine","two_prime_O_methylpseudouridine","two_prime_O_methyluridine","two_prime_O_ribosyladenosine_phosphate","two_prime_O_ribosylguanosine_phosphate","two_thio_two_prime_O_methyluridine","two_thiocytidine","two_thiouridine","tyrosine","tyrosine_tRNA_primary_transcript","tyrosyl_tRNA","uORF","ultracontig","unassigned_supercontig","unconfirmed_transcript","undermodified_hydroxywybutosine","unedited_region","unigene_cluster","unit_of_gene_expression","unitary_pseudogene","unitary_pseudogenic_rRNA","unitary_pseudogenic_tRNA","unprocessed_pseudogenic_rRNA","unprocessed_pseudogenic_tRNA","unspecified_indel","untranslated_region_polycistronic_mRNA","upstream_AUG_codon","uridine_five_oxyacetic_acid","uridine_five_oxyacetic_acid_methyl_ester","vacuolar_sorting_signal","validated_cDNA_clone","valine","valine_tRNA_primary_transcript","valyl_tRNA","vaultRNA_primary_transcript","vault_RNA","vault_RNA_gene","vector_replicon","vertebrate_immune_system_gene","vertebrate_immune_system_gene_recombination_feature","vertebrate_immune_system_gene_recombination_signal_feature","vertebrate_immune_system_gene_recombination_spacer","vertebrate_immune_system_pseudogene","vertebrate_immunoglobulin_T_cell_receptor_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_segment","vertebrate_immunoglobulin_T_cell_receptor_segment","viral_promoter","viral_sequence","virtual_sequence","wild_type_rescue_gene","wobble_base_pair","wybutosine","wyosine","zinc_finger_binding_site","zinc_repressed_element"],Object.defineProperty(fc,"__esModule",{value:!0}),fc.CoreValidation=void 0,fc.isTypeChange=gc;var hc=sc,mc=Ct.__importDefault(pc);function gc(e){return"oldType"in e&&"newType"in e}var yc=function(e){Te(a,e);var t,n,r=De(a);function a(){var e;ke(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Oe(je(e=r.call.apply(r,[this].concat(n))),"name","Core"),e}return Ae(a,[{key:"frontendPreValidate",value:(n=Ee(we().mark((function e(t){var n,r,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!gc(t)){e.next=18;break}n=Ve(t.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}if(mc.default.includes((a=r.value).newType)){e.next=8;break}return e.abrupt("return",{validationName:this.name,error:{message:'"'.concat(a.newType,'" is not a valid SO sequence_feature term')}});case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:return e.abrupt("return",{validationName:this.name});case 19:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("type"!==t){e.next=2;break}return e.abrupt("return",mc.default);case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(hc.Validation);fc.CoreValidation=yc;var vc={},bc={};Object.defineProperty(bc,"__esModule",{value:!0}),bc.splitStringIntoChunks=function(e,t){for(var n=[],r=0;r<e.length;r+=t){var a=e.slice(r,r+t);n.push(a)}return n},bc.getPrintableId=function(e){var t,n,r=e,a=null===(t=r.attributes.get("gff_id"))||void 0===t?void 0:t.join(",");if(a)return"ID=".concat(a," (_id: ").concat(e._id.toString(),")");var o=null===(n=r.attributes.get("gff_name"))||void 0===n?void 0:n.join(",");return o?"Name=".concat(o," (_id: ").concat(e._id.toString(),")"):"_id: ".concat(e._id.toString())},Object.defineProperty(vc,"__esModule",{value:!0}),vc.ParentChildValidation=void 0;var _c=Tr,wc=bc,xc=function(e){Te(a,e);var t,n,r=De(a);function a(){var e;ke(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return Oe(je(e=r.call.apply(r,[this].concat(n))),"name","ParentChildValidation"),e}return Ae(a,[{key:"backendPostValidate",value:(n=Ee(we().mark((function e(t,n){var r,a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.featureModel,a=n.session,!(0,_c.isLocationEndChange)(t)&&!(0,_c.isLocationStartChange)(t)){e.next=3;break}return e.abrupt("return",this.validateParentChildRelationships(t,{session:a,featureModel:r}));case 3:return e.abrupt("return",{validationName:this.name});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"validateParentChildRelationships",value:(t=Ee(we().mark((function e(t,n){var r,a,o,i,s,l,c,u,d;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=[],i=Ve(t.changes),e.prev=3,l=we().mark((function e(){var t,n,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value.featureId,e.next=4,r.findOne({allIds:t}).session(a).exec();case 4:if(n=e.sent){e.next=8;break}throw i="ERROR: The following featureId was not found in database ='".concat(t,"'"),new Error(i);case 8:o.some((function(e){return e._id===n._id}))||o.push(n);case 9:case"end":return e.stop()}}),e)})),i.s();case 6:if((s=i.n()).done){e.next=10;break}return e.delegateYield(l(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),i.e(e.t1);case 15:return e.prev=15,i.f(),e.finish(15);case 18:c=0,u=o;case 19:if(!(c<u.length)){e.next=31;break}d=u[c],e.prev=21,this.checkChildFeatureBoundaries(d),e.next=28;break;case 25:return e.prev=25,e.t2=e.catch(21),e.abrupt("return",{validationName:this.name,error:{message:String(e.t2)}});case 28:c++,e.next=19;break;case 31:return e.abrupt("return",{validationName:this.name});case 32:case"end":return e.stop()}}),e,this,[[3,12,15,18],[21,25]])}))),function(e,n){return t.apply(this,arguments)})},{key:"checkChildFeatureBoundaries",value:function(e){if(e.children){var t,n=Ve(e.children||new Map);try{for(n.s();!(t=n.n()).done;){var r=Be(t.value,2)[1];if(null!==e.min&&null!==e.max&&null!==r.min&&null!==r.max&&(r.max>e.max||r.min<e.min))throw new Error("Feature ".concat((0,wc.getPrintableId)(r)," exceeds the bounds of its parent, ").concat((0,wc.getPrintableId)(e)));this.checkChildFeatureBoundaries(r)}}catch(e){n.e(e)}finally{n.f()}}}}]),a}(sc.Validation);vc.ParentChildValidation=xc,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(sc,e),t.__exportStar(cc,e),t.__exportStar(fc,e),t.__exportStar(vc,e)}(ic);var Sc={},Ec={};function kc(e){this.message=e}(kc.prototype=new Error).name="InvalidCharacterError";var Cc="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new kc("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,a=0,o=0,i="";r=t.charAt(o++);~r&&(n=a%4?64*n+r:r,a++%4)?i+=String.fromCharCode(255&n>>(-2*a&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};function Ac(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Cc(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return Cc(t)}}function Oc(e){this.message=e}(Oc.prototype=new Error).name="InvalidTokenError";var Tc={__proto__:null,default:function(e,t){if("string"!=typeof e)throw new Oc("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(Ac(e.split(".")[n]))}catch(e){throw new Oc("Invalid token specified: "+e.message)}},InvalidTokenError:Oc},Nc=de(Tc);Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.makeUserSessionId=function(e){var t="string"==typeof e?(0,Rc.default)(e):e;return"".concat(t.id,"-").concat(t.iat)},Ec.getDecodedToken=function(e){return(0,Rc.default)(e)};var Rc=Ct.__importDefault(Nc);!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Ct.__exportStar(Ec,e)}(Sc);var Ic={},Pc={};Object.defineProperty(Pc,"__esModule",{value:!0}),Pc.CDSCheck=void 0;var Fc,Mc,jc=Rr,Dc=U.default,Lc=Ct.__importDefault(_r);!function(e){e[e.TAG=0]="TAG",e[e.TAA=1]="TAA",e[e.TGA=2]="TGA"}(Fc||(Fc={})),function(e){e[e.ATG=0]="ATG"}(Mc||(Mc={}));var Bc,qc="CDSCheck";!function(e){e[e.InternalStopCodon=0]="InternalStopCodon",e[e.MissingStartCodon=1]="MissingStartCodon",e[e.MissingStopCodon=2]="MissingStopCodon",e[e.MultipleOfThree=3]="MultipleOfThree"}(Bc||(Bc={}));var Uc={G:"C",A:"T",T:"A",C:"G",R:"Y",Y:"R",M:"K",K:"M",S:"S",W:"W",H:"D",B:"V",V:"B",D:"H",N:"N"};function zc(e){var t,n=[],r=Ve(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=Uc[a.toUpperCase()];if(void 0===o)throw new TypeError('Cannot complement nucleotide: "'.concat(a,'"'));a===a.toLowerCase()?n.push(o.toLowerCase()):n.push(o)}}catch(e){r.e(e)}finally{r.f()}return n.reverse().join("")}function Gc(e,t,n){return Hc.apply(this,arguments)}function Hc(){return(Hc=Ee(we().mark((function e(t,n,r){var a;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r(e.min,e.max)})));case 2:return a=e.sent.join(""),-1===n&&(a=zc(a)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $c(e){for(var t=[],n=0;n<=e.length-3;n+=3)t.push(e.slice(n,n+3));return t}function Wc(e,t,n){return-1===n?e>t:e<t}function Vc(e,t,n){var r=structuredClone(e);r.sort(-1===t?function(e,t){return e.min<t.min?1:-1}:function(e,t){return e.min<t.min?-1:1});for(var a=0,o=void 0,i=void 0,s=0;s<r.length;s++)for(var l=r[s],c=l.phase,u=-1===t?l.min:l.max,d=-1===t?l.max-c:l.min+c;Wc(d,u,t);d=-1===t?d-3:d+3){if(o=d,i=-1===t?o-3:o+3,-1===t&&i<l.min?i=r[s+1].max-r[s+1].phase:i>l.max&&(i=r[s+1].min+r[s+1].phase),a===n)return[o,i].sort((function(e,t){return e-t}));a++}}function Jc(e,t){return Yc.apply(this,arguments)}function Yc(){return(Yc=Ee(we().mark((function e(t,n){var r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v,b,_,w,x,S,E,k,C,A,O,T,N,R,I,P,F,M,j;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],a=t._id,o=t.max,i=t.min,s=t.refSeq,l=t.strand,c=Kc(t)){e.next=5;break}return e.abrupt("return",r);case 5:u=[a],d=Ve(c),e.prev=7,d.s();case 9:if((f=d.n()).done){e.next=37;break}return p=f.value,e.next=13,Gc(p,l,n);case 13:m=$c(h=e.sent),h.length%3==0?((g=m.at(0))&&!(g.toUpperCase()in Mc)&&(w=-1===l?null!==(y=null===(v=p.at(-1))||void 0===v?void 0:v.max)&&void 0!==y?y:o:null!==(b=null===(_=p.at(0))||void 0===_?void 0:_.min)&&void 0!==b?b:i,w=-1===l?w-3:w,r.push({_id:(new Lc.default).toHexString(),name:qc,cause:Bc[Bc.MissingStartCodon],ids:u,refSeq:s.toString(),start:w,end:w,message:'Unexpected start codon in feature "'.concat(a,'": ').concat(g)})),(x=m.at(-1))&&!(x.toUpperCase()in Fc)&&(A=-1===l?null!==(S=null===(E=p.at(0))||void 0===E?void 0:E.min)&&void 0!==S?S:i:null!==(k=null===(C=p.at(-1))||void 0===C?void 0:C.max)&&void 0!==k?k:o,r.push({_id:(new Lc.default).toHexString(),name:qc,cause:Bc[Bc.MissingStopCodon],ids:u,refSeq:s.toString(),start:A,end:A,message:'Missing stop codon for feature "'.concat(a,'"')}))):r.push({_id:(new Lc.default).toHexString(),name:qc,cause:Bc[Bc.MultipleOfThree],ids:u,refSeq:s.toString(),start:i,end:o,message:'The coding sequence for feature "'.concat(a,'" is not a multiple of three')}),O=Ve(m.entries()),e.prev=17,O.s();case 19:if((T=O.n()).done){e.next=27;break}if(N=Be(T.value,2),I=N[1],(R=N[0])!==m.length-1){e.next=23;break}return e.abrupt("break",27);case 23:(P=Vc(p,l,R))&&I.toUpperCase()in Fc&&(F=Be(P,2),M=F[0],j=F[1],r.push({_id:(new Lc.default).toHexString(),name:qc,cause:Bc[Bc.InternalStopCodon],ids:u,refSeq:s.toString(),start:M,end:j,message:'The coding sequence for feature "'.concat(a,'" has an internal stop codon')}));case 25:e.next=19;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(17),O.e(e.t0);case 32:return e.prev=32,O.f(),e.finish(32);case 35:e.next=9;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(7),d.e(e.t1);case 42:return e.prev=42,d.f(),e.finish(42);case 45:return e.abrupt("return",r);case 46:case"end":return e.stop()}}),e,null,[[7,39,42,45],[17,29,32,35]])})))).apply(this,arguments)}function Kc(e){if("mRNA"===e.type){var t=e.children,n=e.strand;if(t){var r=Object.values(t).filter((function(e){return"CDS"===e.type}));if(0!==r.length){var a,o=[],i=Ve(r);try{var s=function(){for(var e=a.value,r=e.max,i=e.min,s=[],l=0,c=Object.values(t);l<c.length;l++){var u=c[l];if("exon"===u.type){var d=Be((0,Dc.intersection2)(i,r,u.min,u.max),2),f=d[0],p=d[1];void 0!==f&&void 0!==p&&s.push({min:f,max:p})}}s.sort((function(e,t){return e.min-t.min})),-1===n&&s.reverse();var h=0,m=s.map((function(e){var t=h;return h=(3-(e.max-e.min-t+3)%3)%3,_e(_e({},e),{},{phase:t})}));m.sort((function(e,t){return e.min<t.min?-1:1})),o.push(m)};for(i.s();!(a=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return o.length>1&&o.sort((function(e,t){return e[0].min<t[0].min?-1:1})),o}}}}var Zc=function(e){Te(r,e);var t,n=De(r);function r(){var e;ke(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return Oe(je(e=n.call.apply(n,[this].concat(a))),"name",qc),Oe(je(e),"causes",Object.values(Bc).filter((function(e){return Number.isNaN(Number(e))}))),Oe(je(e),"version",1),Oe(je(e),"default",!0),e}return Ae(r,[{key:"checkFeature",value:(t=Ee(we().mark((function e(t,n){var r,a,o,i;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mRNA"!==t.type){e.next=2;break}return e.abrupt("return",Jc(t,n));case 2:if(t.children){e.next=4;break}return e.abrupt("return",[]);case 4:r=[],a=0,o=Object.values(t.children);case 6:if(!(a<o.length)){e.next=19;break}return i=o[a],e.t0=r.push,e.t1=r,e.t2=Ue,e.next=13,this.checkFeature(i,n);case 13:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 16:a++,e.next=6;break;case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),r}(jc.Check);Pc.CDSCheck=Zc,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Ct.__exportStar(Pc,e)}(Ic);var Xc={};Object.defineProperty(Xc,"__esModule",{value:!0}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(Tr,e),t.__exportStar(tc,e),t.__exportStar(ic,e),t.__exportStar(Sc,e),t.__exportStar(Ic,e),t.__exportStar(bc,e),t.__exportStar(Xc,e),t.__exportStar(ta,e)}(Or);var Qc={},eu={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}(eu);var tu={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=z.default}(tu);var nu=eu.exports;Object.defineProperty(Qc,"__esModule",{value:!0});var ru=Qc.default=void 0;ru=Qc.default=(0,nu(tu).default)((0,G.default.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");const au=r.ConfigurationSchema("ApolloInternetAccount",{baseURL:{description:"Location of Apollo server",type:"string",defaultValue:""},tokenType:{description:"A custom name for a token to include in the header",type:"string",defaultValue:"Bearer"}},{baseConfiguration:a.BaseInternetAccountConfig,explicitlyTyped:!0});var ou=Object.create(null);ou.open="0",ou.close="1",ou.ping="2",ou.pong="3",ou.message="4",ou.upgrade="5",ou.noop="6";var iu=Object.create(null);Object.keys(ou).forEach((function(e){iu[ou[e]]=e}));var su,lu={type:"error",data:"parser error"},cu="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),uu="function"==typeof ArrayBuffer,du=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},fu=function(e,t,n){var r=e.type,a=e.data;return cu&&a instanceof Blob?t?n(a):pu(a,n):uu&&(a instanceof ArrayBuffer||du(a))?t?n(a):pu(new Blob([a]),n):n(ou[r]+(a||""))},pu=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function hu(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var mu="undefined"==typeof Uint8Array?[]:new Uint8Array(256),gu=0;gu<64;gu++)mu["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(gu)]=gu;var yu,vu="function"==typeof ArrayBuffer,bu=function(e,t){if("string"!=typeof e)return{type:"message",data:wu(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:_u(e.substring(1),t)}:iu[n]?e.length>1?{type:iu[n],data:e.substring(1)}:{type:iu[n]}:lu},_u=function(e,t){if(vu){var n=function(e){var t,n,r,a,o,i=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),u=new Uint8Array(c);for(t=0;t<s;t+=4)n=mu[e.charCodeAt(t)],r=mu[e.charCodeAt(t+1)],a=mu[e.charCodeAt(t+2)],o=mu[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&o;return c}(e);return wu(n,t)}return{base64:!0,data:e}},wu=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},xu=String.fromCharCode(30);function Su(e){return e.reduce((function(e,t){return e+t.length}),0)}function Eu(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),r=0,a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function ku(e){if(e)return function(e){for(var t in ku.prototype)e[t]=ku.prototype[t];return e}(e)}ku.prototype.on=ku.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},ku.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},ku.prototype.off=ku.prototype.removeListener=ku.prototype.removeAllListeners=ku.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},ku.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},ku.prototype.emitReserved=ku.prototype.emit,ku.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},ku.prototype.hasListeners=function(e){return!!this.listeners(e).length};var Cu=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()}();function Au(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var Ou=Cu.setTimeout,Tu=Cu.clearTimeout;function Nu(e,t){t.useNativeTimers?(e.setTimeoutFn=Ou.bind(Cu),e.clearTimeoutFn=Tu.bind(Cu)):(e.setTimeoutFn=Cu.setTimeout.bind(Cu),e.clearTimeoutFn=Cu.clearTimeout.bind(Cu))}var Ru,Iu=function(e){Te(n,e);var t=De(n);function n(e,r,a){var o;return ke(this,n),(o=t.call(this,e)).description=r,o.context=a,o.type="TransportError",o}return Ae(n)}(Fe(Error)),Pu=function(e){Te(n,e);var t=De(n);function n(e){var r;return ke(this,n),(r=t.call(this)).writable=!1,Nu(je(r),e),r.opts=e,r.query=e.query,r.socket=e.socket,r}return Ae(n,[{key:"onError",value:function(e,t,r){return Le(Ne(n.prototype),"emitReserved",this).call(this,"error",new Iu(e,t,r)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,Le(Ne(n.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=bu(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){Le(Ne(n.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",Le(Ne(n.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}]),n}(ku),Fu="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Mu=64,ju=0;function Du(e){var t="";do{t=Fu[e%Mu]+t,e=Math.floor(e/Mu)}while(e>0);return t}function Lu(){var e=Du(+new Date);return e!==Ru?(ju=0,Ru=e):e+"."+Du(ju++)}var Bu=!1;try{Bu="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(jo){}var qu=Bu;function Uu(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||qu))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Cu[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function zu(){}var Gu=function(){return null!=new Uu({xdomain:!1}).responseType}(),Hu=function(e){Te(n,e);var t=De(n);function n(e){var r;if(ke(this,n),(r=t.call(this,e)).polling=!1,"undefined"!=typeof location){var a="https:"===location.protocol,o=location.port;o||(o=a?"443":"80"),r.xd="undefined"!=typeof location&&e.hostname!==location.hostname||o!==e.port}return r.supportsBinary=Gu&&!(e&&e.forceBase64),r.opts.withCredentials&&(r.cookieJar=void 0),r}return Ae(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(xu),r=[],a=0;a<n.length;a++){var o=bu(n[a],t);if(r.push(o),"error"===o.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,n){var r=e.length,a=new Array(r),o=0;e.forEach((function(e,n){fu(e,!1,(function(e){var i;a[n]=e,++o===r&&(i=a.join(xu),t.doWrite(i,(function(){t.writable=!0,t.emitReserved("drain")})))}))}))}(e)}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Lu()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new $u(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e,t){n.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t}}]),n}(Pu),$u=function(e){Te(n,e);var t=De(n);function n(e,r){var a;return ke(this,n),Nu(je(a=t.call(this)),r),a.opts=r,a.method=r.method||"GET",a.uri=e,a.data=void 0!==r.data?r.data:null,a.create(),a}return Ae(n,[{key:"create",value:function(){var e,t=this,r=Au(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;var a=this.xhr=new Uu(r);try{a.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var o in a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&a.setRequestHeader(o,this.opts.extraHeaders[o])}catch(e){}if("POST"===this.method)try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{a.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(a),"withCredentials"in a&&(a.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(a.timeout=this.opts.requestTimeout),a.onreadystatechange=function(){var e;3===a.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(a)),4===a.readyState&&(200===a.status||1223===a.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"==typeof a.status?a.status:0)}),0))},a.send(this.data)}catch(e){return void this.setTimeoutFn((function(){t.onError(e)}),0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(null!=this.xhr){if(this.xhr.onreadystatechange=zu,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}(ku);function Wu(){for(var e in $u.requests)$u.requests.hasOwnProperty(e)&&$u.requests[e].abort()}$u.requestsCount=0,$u.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",Wu):"function"==typeof addEventListener&&addEventListener("onpagehide"in Cu?"pagehide":"unload",Wu,!1));var Vu=function(){return"function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)}}(),Ju=Cu.WebSocket||Cu.MozWebSocket,Yu="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Ku=function(e){Te(n,e);var t=De(n);function n(e){var r;return ke(this,n),(r=t.call(this,e)).supportsBinary=!e.forceBase64,r}return Ae(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=Yu?{}:Au(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Yu?new Ju(e,t,n):t?new Ju(e,t):new Ju(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;fu(e[r],t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}n&&Vu((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Lu()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!Ju}}]),n}(Pu),Zu=function(e){Te(n,e);var t=De(n);function n(){return ke(this,n),t.apply(this,arguments)}return Ae(n,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var n=function(e,t){yu||(yu=new TextDecoder);var n=[],r=0,a=-1,o=!1;return new TransformStream({transform:function(i,s){for(n.push(i);;){if(0===r){if(Su(n)<1)break;var l=Eu(n,1);o=128==(128&l[0]),r=(a=127&l[0])<126?3:126===a?1:2}else if(1===r){if(Su(n)<2)break;var c=Eu(n,2);a=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(2===r){if(Su(n)<8)break;var u=Eu(n,8),d=new DataView(u.buffer,u.byteOffset,u.length),f=d.getUint32(0);if(f>Math.pow(2,21)-1){s.enqueue(lu);break}a=f*Math.pow(2,32)+d.getUint32(4),r=3}else{if(Su(n)<a)break;var p=Eu(n,a);s.enqueue(bu(o?p:yu.decode(p),t)),r=0}if(0===a||a>e){s.enqueue(lu);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),a=new TransformStream({transform:function(e,t){!function(e,t){cu&&e.data instanceof Blob?e.data.arrayBuffer().then(hu).then(t):uu&&(e.data instanceof ArrayBuffer||du(e.data))?t(hu(e.data)):fu(e,!1,(function(e){su||(su=new TextEncoder),t(su.encode(e))}))}(e,(function(n){var r,a=n.length;if(a<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,a);else if(a<65536){r=new Uint8Array(3);var o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,a)}else{r=new Uint8Array(9);var i=new DataView(r.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(a))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}});a.readable.pipeTo(t.writable),e.writer=a.writable.getWriter(),function t(){r.read().then((function(n){n.done||(e.onPacket(n.value),t())})).catch((function(e){}))}();var o={type:"open"};e.query.sid&&(o.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(o).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;t.writer.write(e[r]).then((function(){n&&Vu((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),n}(Pu),Xu={websocket:Ku,webtransport:Zu,polling:Hu},Qu=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ed=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function td(e){var t,n,r=e,a=e.indexOf("["),o=e.indexOf("]");-1!=a&&-1!=o&&(e=e.substring(0,a)+e.substring(a,o).replace(/:/g,";")+e.substring(o,e.length));for(var i,s=Qu.exec(e||""),l={},c=14;c--;)l[ed[c]]=s[c]||"";return-1!=a&&-1!=o&&(l.source=r,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(n=(t=l.path).replace(/\/{2,9}/g,"/").split("/"),"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n),l.queryKey=(i={},l.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),l}var nd=function(e){Te(n,e);var t=De(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ke(this,n),(r=t.call(this)).binaryType="arraybuffer",r.writeBuffer=[],e&&"object"===xe(e)&&(a=e,e=null),e?(e=td(e),a.hostname=e.host,a.secure="https"===e.protocol||"wss"===e.protocol,a.port=e.port,e.query&&(a.query=e.query)):a.host&&(a.hostname=td(a.host).host),Nu(je(r),a),r.secure=null!=a.secure?a.secure:"undefined"!=typeof location&&"https:"===location.protocol,a.hostname&&!a.port&&(a.port=r.secure?"443":"80"),r.hostname=a.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=a.port||("undefined"!=typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=a.transports||["polling","websocket","webtransport"],r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),r.opts.path=r.opts.path.replace(/\/$/,"")+(r.opts.addTrailingSlash?"/":""),"string"==typeof r.opts.query&&(r.opts.query=function(e){for(var t={},n=e.split("&"),r=0,a=n.length;r<a;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"==typeof addEventListener&&(r.opts.closeOnBeforeunload&&(r.beforeunloadEventListener=function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())},addEventListener("beforeunload",r.beforeunloadEventListener,!1)),"localhost"!==r.hostname&&(r.offlineEventListener=function(){r.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",r.offlineEventListener,!1))),r.open(),r}return Ae(n,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Xu[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),a=!1;n.priorWebsocketSuccess=!1;var o=function(){a||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(function(e){if(!a)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;n.priorWebsocketSuccess="websocket"===r.name,t.transport.pause((function(){a||"closed"!==t.readyState&&(d(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=r.name,t.emitReserved("upgradeError",o)}})))};function i(){a||(a=!0,d(),r.close(),r=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=r.name,i(),t.emitReserved("upgradeError",n)};function l(){s("transport closed")}function c(){s("socket closed")}function u(e){r&&e.name!==r.name&&i()}var d=function(){r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",l),t.off("close",c),t.off("upgrading",u)};r.once("open",o),r.once("error",s),r.once("close",l),this.once("close",c),this.once("upgrading",u),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){a||r.open()}),200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,n=0;n<this.writeBuffer.length;n++){var r=this.writeBuffer[n].data;if(r&&(t+="string"==typeof(e=r)?function(e){for(var t=0,n=0,r=0,a=e.length;r<a;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(ku);nd.protocol=4;var rd="function"==typeof ArrayBuffer,ad=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},od=Object.prototype.toString,id="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===od.call(Blob),sd="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===od.call(File);function ld(e){return rd&&(e instanceof ArrayBuffer||ad(e))||id&&e instanceof Blob||sd&&e instanceof File}function cd(e,t){if(!e||"object"!==xe(e))return!1;if(Array.isArray(e)){for(var n=0,r=e.length;n<r;n++)if(cd(e[n]))return!0;return!1}if(ld(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return cd(e.toJSON(),!0);for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&cd(e[a]))return!0;return!1}function ud(e){var t=[],n=e;return n.data=dd(e.data,t),n.attachments=t.length,{packet:n,buffers:t}}function dd(e,t){if(!e)return e;if(ld(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var r=new Array(e.length),a=0;a<e.length;a++)r[a]=dd(e[a],t);return r}if("object"===xe(e)&&!(e instanceof Date)){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=dd(e[i],t));return o}return e}function fd(e,t){return e.data=pd(e.data,t),delete e.attachments,e}function pd(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=pd(e[n],t);else if("object"===xe(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=pd(e[r],t));return e}var hd,md=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(hd||(hd={}));var gd=function(){function e(t){ke(this,e),this.replacer=t}return Ae(e,[{key:"encode",value:function(e){return e.type!==hd.EVENT&&e.type!==hd.ACK||!cd(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===hd.EVENT?hd.BINARY_EVENT:hd.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==hd.BINARY_EVENT&&e.type!==hd.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=ud(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}();function yd(e){return"[object Object]"===Object.prototype.toString.call(e)}var vd=function(e){Te(n,e);var t=De(n);function n(e){var r;return ke(this,n),(r=t.call(this)).reviver=e,r}return Ae(n,[{key:"add",value:function(e){var t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===hd.BINARY_EVENT;r||t.type===hd.BINARY_ACK?(t.type=r?hd.EVENT:hd.ACK,this.reconstructor=new bd(t),0===t.attachments&&Le(Ne(n.prototype),"emitReserved",this).call(this,"decoded",t)):Le(Ne(n.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!ld(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,Le(Ne(n.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(void 0===hd[r.type])throw new Error("unknown packet type "+r.type);if(r.type===hd.BINARY_EVENT||r.type===hd.BINARY_ACK){for(var a=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(a,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(i,t)}else r.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var l=t+1;++t;){var c=e.charAt(t);if(null==c||Number(c)!=c){--t;break}if(t===e.length)break}r.id=Number(e.substring(l,t+1))}if(e.charAt(++t)){var u=this.tryParse(e.substr(t));if(!n.isPayloadValid(r.type,u))throw new Error("invalid payload");r.data=u}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case hd.CONNECT:return yd(t);case hd.DISCONNECT:return void 0===t;case hd.CONNECT_ERROR:return"string"==typeof t||yd(t);case hd.EVENT:case hd.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===md.indexOf(t[0]));case hd.ACK:case hd.BINARY_ACK:return Array.isArray(t)}}}]),n}(ku),bd=function(){function e(t){ke(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return Ae(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=fd(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),_d={__proto__:null,protocol:5,get PacketType(){return hd},Encoder:gd,Decoder:vd};function wd(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var xd=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Sd=function(e){Te(n,e);var t=De(n);function n(e,r,a){var o;return ke(this,n),(o=t.call(this)).connected=!1,o.recovered=!1,o.receiveBuffer=[],o.sendBuffer=[],o._queue=[],o._queueSeq=0,o.ids=0,o.acks={},o.flags={},o.io=e,o.nsp=r,a&&a.auth&&(o.auth=a.auth),o._opts=Object.assign({},a),o.io._autoConnect&&o.open(),o}return Ae(n,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[wd(e,"open",this.onopen.bind(this)),wd(e,"packet",this.onpacket.bind(this)),wd(e,"error",this.onerror.bind(this)),wd(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(xd.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;var a={type:hd.EVENT,data:n,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var o=this.ids++,i=n.pop();this._registerAckCallback(o,i),a.id=o}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n,r=this,a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==a){var o=this.io.setTimeoutFn((function(){delete r.acks[e];for(var n=0;n<r.sendBuffer.length;n++)r.sendBuffer[n].id===e&&r.sendBuffer.splice(n,1);t.call(r,new Error("operation has timed out"))}),a);this.acks[e]=function(){r.io.clearTimeoutFn(o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,[null].concat(n))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(n,a){r.push((function(e,t){return o?e?a(e):n(t):n(e)})),t.emit.apply(t,[e].concat(r))}))}},{key:"_addToQueue",value:function(e){var t,n=this;"function"==typeof e[e.length-1]&&(t=e.pop());var r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r===n._queue[0]){if(null!==e)r.tryCount>n._opts.retries&&(n._queue.shift(),t&&t(e));else if(n._queue.shift(),t){for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];t.apply(void 0,[null].concat(o))}return r.pending=!1,n._drainQueue()}})),this._queue.push(r),this._drainQueue()}},{key:"_drainQueue",value:function(){if(this.connected&&0!==this._queue.length){var e=this._queue[0];e.pending&&!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:hd.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case hd.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case hd.EVENT:case hd.BINARY_EVENT:this.onevent(e);break;case hd.ACK:case hd.BINARY_ACK:this.onack(e);break;case hd.DISCONNECT:this.ondisconnect();break;case hd.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=Ve(this._anyListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e)}catch(e){r.e(e)}finally{r.f()}}Le(Ne(n.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t.packet({type:hd.ACK,id:e,data:a})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:hd.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=Ve(this._anyOutgoingListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e.data)}catch(e){n.e(e)}finally{n.f()}}}}]),n}(ku);function Ed(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ed.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Ed.prototype.reset=function(){this.attempts=0},Ed.prototype.setMin=function(e){this.ms=e},Ed.prototype.setMax=function(e){this.max=e},Ed.prototype.setJitter=function(e){this.jitter=e};var kd=function(e){Te(n,e);var t=De(n);function n(e,r){var a,o;ke(this,n),(a=t.call(this)).nsps={},a.subs=[],e&&"object"===xe(e)&&(r=e,e=void 0),(r=r||{}).path=r.path||"/socket.io",a.opts=r,Nu(je(a),r),a.reconnection(!1!==r.reconnection),a.reconnectionAttempts(r.reconnectionAttempts||Infinity),a.reconnectionDelay(r.reconnectionDelay||1e3),a.reconnectionDelayMax(r.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(o=r.randomizationFactor)&&void 0!==o?o:.5),a.backoff=new Ed({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==r.timeout?2e4:r.timeout),a._readyState="closed",a.uri=e;var i=r.parser||_d;return a.encoder=new i.Encoder,a.decoder=new i.Decoder,a._autoConnect=!1!==r.autoConnect,a._autoConnect&&a.open(),a}return Ae(n,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new nd(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var a=wd(n,"open",(function(){r.onopen(),e&&e()})),o=function(n){t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},i=wd(n,"error",o);if(!1!==this._timeout){var s=this.setTimeoutFn((function(){a(),o(new Error("timeout")),n.close()}),this._timeout);this.opts.autoUnref&&s.unref(),this.subs.push((function(){t.clearTimeoutFn(s)}))}return this.subs.push(a),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(wd(e,"ping",this.onping.bind(this)),wd(e,"data",this.ondata.bind(this)),wd(e,"error",this.onerror.bind(this)),wd(e,"close",this.onclose.bind(this)),wd(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}},{key:"ondecoded",value:function(e){var t=this;Vu((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Sd(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++)if(this.nsps[n[t]].active)return;this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){e.clearTimeoutFn(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),n}(ku),Cd={};function Ad(e,t){"object"===xe(e)&&(t=e,e=void 0);var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=td(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),a=r.source,o=r.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||Cd[o]&&r.path in Cd[o].nsps?n=new kd(a,t):(Cd[o]||(Cd[o]=new kd(a,t)),n=Cd[o]),r.query&&!t.query&&(t.query=r.queryKey),n.socket(r.path,t)}function Od(){}function Td(){Td.init.call(this)}function Nd(e){return void 0===e._maxListeners?Td.defaultMaxListeners:e._maxListeners}function Rd(e,t,n,r){var a,o,i;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),i=o[t]):(o=e._events=new Od,e._eventsCount=0),i){if("function"==typeof i?i=o[t]=r?[n,i]:[i,n]:r?i.unshift(n):i.push(n),!i.warned&&(a=Nd(e))&&a>0&&i.length>a){i.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=i.length,function(e){"function"==typeof console.warn?console.warn(e):console.log(e)}(s)}}else i=o[t]=n,++e._eventsCount;return e}function Id(e,t,n){var r=!1;function a(){e.removeListener(t,a),r||(r=!0,n.apply(e,arguments))}return a.listener=n,a}function Pd(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function Fd(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Object.assign(Ad,{Manager:kd,Socket:Sd,io:Ad,connect:Ad}),Od.prototype=Object.create(null),Td.EventEmitter=Td,Td.usingDomains=!1,Td.prototype.domain=void 0,Td.prototype._events=void 0,Td.prototype._maxListeners=void 0,Td.defaultMaxListeners=10,Td.init=function(){this.domain=null,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Od,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Td.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Td.prototype.getMaxListeners=function(){return Nd(this)},Td.prototype.emit=function(e){var t,n,r,a,o,i,s,l="error"===e;if(i=this._events)l=l&&null==i.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=i[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,a=Fd(e,r),o=0;o<r;++o)a[o].call(n)}(n,u,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var a=e.length,o=Fd(e,a),i=0;i<a;++i)o[i].call(n,r)}(n,u,this,arguments[1]);break;case 3:!function(e,t,n,r,a){if(t)e.call(n,r,a);else for(var o=e.length,i=Fd(e,o),s=0;s<o;++s)i[s].call(n,r,a)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,a,o){if(t)e.call(n,r,a,o);else for(var i=e.length,s=Fd(e,i),l=0;l<i;++l)s[l].call(n,r,a,o)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(r-1),o=1;o<r;o++)a[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var a=e.length,o=Fd(e,a),i=0;i<a;++i)o[i].apply(n,r)}(n,u,this,a)}return!0},Td.prototype.on=Td.prototype.addListener=function(e,t){return Rd(this,e,t,!1)},Td.prototype.prependListener=function(e,t){return Rd(this,e,t,!0)},Td.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Id(this,e,t)),this},Td.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Id(this,e,t)),this},Td.prototype.removeListener=function(e,t){var n,r,a,o,i;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new Od:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=n[o].listener,a=o;break}if(a<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new Od,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,a=e.length;r<a;n+=1,r+=1)e[n]=e[r];e.pop()}(n,a);r.removeListener&&this.emit("removeListener",e,i||t)}return this},Td.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new Od,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new Od:delete n[e]),this;if(0===arguments.length){for(var r,a=Object.keys(n),o=0;o<a.length;++o)"removeListener"!==(r=a[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new Od,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Td.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},Td.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Pd.call(e,t)},Td.prototype.listenerCount=Pd,Td.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Md="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},jd=/%[sdj%]/g;function Dd(e){if(!Kd(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(zd(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(jd,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),i=r[n];n<a;i=r[++n])Yd(i)||!Qd(i)?o+=" "+i:o+=" "+zd(i);return o}function Ld(e,t){if(Zd(qt.process))return function(){return Ld(e,t).apply(this,arguments)};if(!0===fn.noDeprecation)return e;var n=!1;return function(){if(!n){if(fn.throwDeprecation)throw new Error(t);fn.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}}var Bd,qd={};function Ud(e){return Zd(Bd)&&(Bd=fn.env.NODE_DEBUG||""),e=e.toUpperCase(),qd[e]||(qd[e]=new RegExp("\\b"+e+"\\b","i").test(Bd)?function(){var t=Dd.apply(null,arguments);console.error("%s %d: %s",e,0,t)}:function(){}),qd[e]}function zd(e,t){var n={seen:[],stylize:Hd};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),Jd(t)?n.showHidden=t:t&&function(e,t){if(!t||!Qd(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]]}(n,t),Zd(n.showHidden)&&(n.showHidden=!1),Zd(n.depth)&&(n.depth=2),Zd(n.colors)&&(n.colors=!1),Zd(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=Gd),$d(n,e,n.depth)}function Gd(e,t){var n=zd.styles[t];return n?"["+zd.colors[n][0]+"m"+e+"["+zd.colors[n][1]+"m":e}function Hd(e,t){return e}function $d(e,t,n){if(e.customInspect&&t&&nf(t.inspect)&&t.inspect!==zd&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return Kd(r)||(r=$d(e,r,n)),r}var a=function(e,t){if(Zd(t))return e.stylize("undefined","undefined");if(Kd(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):Jd(t)?e.stylize(""+t,"boolean"):Yd(t)?e.stylize("null","null"):void 0}(e,t);if(a)return a;var o=Object.keys(t),i=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),tf(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return Wd(t);if(0===o.length){if(nf(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(Xd(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(ef(t))return e.stylize(Date.prototype.toString.call(t),"date");if(tf(t))return Wd(t)}var s,l="",c=!1,u=["{","}"];return Array.isArray(t)&&(c=!0,u=["[","]"]),nf(t)&&(l=" [Function"+(t.name?": "+t.name:"")+"]"),Xd(t)&&(l=" "+RegExp.prototype.toString.call(t)),ef(t)&&(l=" "+Date.prototype.toUTCString.call(t)),tf(t)&&(l=" "+Wd(t)),0!==o.length||c&&0!=t.length?n<0?Xd(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),s=c?function(e,t,n,r,a){for(var o=[],i=0,s=t.length;i<s;++i)af(t,String(i))?o.push(Vd(e,t,n,r,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(Vd(e,t,n,r,a,!0))})),o}(e,t,n,i,o):o.map((function(r){return Vd(e,t,n,i,r,c)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(s,l,u)):u[0]+l+u[1]}function Wd(e){return"["+Error.prototype.toString.call(e)+"]"}function Vd(e,t,n,r,a,o){var i,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),af(r,a)||(i="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=Yd(n)?$d(e,l.value,null):$d(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),Zd(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=e.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=e.stylize(i,"string"))}return i+": "+s}function Jd(e){return"boolean"==typeof e}function Yd(e){return null===e}function Kd(e){return"string"==typeof e}function Zd(e){return void 0===e}function Xd(e){return Qd(e)&&"[object RegExp]"===rf(e)}function Qd(e){return"object"===xe(e)&&null!==e}function ef(e){return Qd(e)&&"[object Date]"===rf(e)}function tf(e){return Qd(e)&&("[object Error]"===rf(e)||e instanceof Error)}function nf(e){return"function"==typeof e}function rf(e){return Object.prototype.toString.call(e)}function af(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function of(){this.head=null,this.tail=null,this.length=0}zd.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},zd.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},of.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},of.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},of.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},of.prototype.clear=function(){this.head=this.tail=null,this.length=0},of.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},of.prototype.concat=function(e){if(0===this.length)return kn.alloc(0);if(1===this.length)return this.head.data;for(var t=kn.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t};var sf=kn.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function lf(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!sf(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=uf;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=df;break;default:return void(this.write=cf)}this.charBuffer=new kn(6),this.charReceived=0,this.charLength=0}function cf(e){return e.toString(this.encoding)}function uf(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function df(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}lf.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,a=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,a),a-=this.charReceived),(r=(t+=e.toString(this.encoding,0,a)).charCodeAt(a=t.length-1))>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,a)}return t},lf.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},lf.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.encoding;t+=this.charBuffer.slice(0,this.charReceived).toString(n)}return t},hf.ReadableState=pf;var ff=Ud("stream");function pf(e,t){this.objectMode=!!(e=e||{}).objectMode,t instanceof zf&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark;this.highWaterMark=n||0===n?n:this.objectMode?16:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=new of,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new lf(e.encoding),this.encoding=e.encoding)}function hf(e){if(!(this instanceof hf))return new hf(e);this._readableState=new pf(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),Td.call(this)}function mf(e,t,n,r,a){var o=function(e,t){var n=null;return lr(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,vf(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!a){var i=new Error("stream.push() after EOF");e.emit("error",i)}else if(t.endEmitted&&a){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var l;!t.decoder||a||r||(n=t.decoder.write(n),l=!t.objectMode&&0===n.length),a||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,a?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&vf(e))),function(e,t){t.readingMore||(t.readingMore=!0,Xt(_f,e,t))}(e,t)}else a||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}Md(hf,Td),hf.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=kn.from(e,t),t=""),mf(this,n,e,t,!1)},hf.prototype.unshift=function(e){return mf(this,this._readableState,e,"",!0)},hf.prototype.isPaused=function(){return!1===this._readableState.flowing},hf.prototype.setEncoding=function(e){return this._readableState.decoder=new lf(e),this._readableState.encoding=e,this};var gf=8388608;function yf(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=gf?e=gf:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function vf(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(ff("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Xt(bf,e):bf(e))}function bf(e){ff("emit readable"),e.emit("readable"),Sf(e)}function _f(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(ff("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function wf(e){ff("readable nexttick read 0"),e.read(0)}function xf(e,t){t.reading||(ff("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Sf(e),t.flowing&&!t.reading&&e.read(0)}function Sf(e){var t=e._readableState;for(ff("flow",t.flowing);t.flowing&&null!==e.read(););}function Ef(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,a=n.data;for(e-=a.length;n=n.next;){var o=n.data,i=e>o.length?o.length:e;if(a+=i===o.length?o:o.slice(0,e),0==(e-=i)){i===o.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=o.slice(i));break}++r}return t.length-=r,a}(e,t):function(e,t){var n=kn.allocUnsafe(e),r=t.head,a=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,i=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,i),0==(e-=i)){i===o.length?(++a,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=o.slice(i));break}++a}return t.length-=a,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function kf(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Xt(Cf,t,e))}function Cf(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function Af(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function Of(){}function Tf(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function Nf(e,t){Object.defineProperty(this,"buffer",{get:Ld((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),this.objectMode=!!(e=e||{}).objectMode,t instanceof zf&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark;this.highWaterMark=n||0===n?n:this.objectMode?16:16384,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,a=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,a){--t.pendingcb,n?Xt(a,r):a(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,n,r,t,a);else{var o=Mf(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||Ff(e,n),r?Xt(Pf,e,n,o,a):Pf(e,n,o,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new Lf(this)}function Rf(e){if(!(this instanceof Rf||this instanceof zf))return new Rf(e);this._writableState=new Nf(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),Td.call(this)}function If(e,t,n,r,a,o,i){t.writelen=r,t.writecb=i,t.writing=!0,t.sync=!0,n?e._writev(a,t.onwrite):e._write(a,o,t.onwrite),t.sync=!1}function Pf(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),Df(e,t)}function Ff(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),a=t.corkedRequestsFree;a.entry=n;for(var o=0;n;)r[o]=n,n=n.next,o+=1;If(e,t,!0,t.length,r,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new Lf(t)}else{for(;n;){var i=n.chunk;if(If(e,t,!1,t.objectMode?1:i.length,i,n.encoding,n.callback),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function Mf(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function jf(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function Df(e,t){var n=Mf(t);return n&&(0===t.pendingcb?(jf(e,t),t.finished=!0,e.emit("finish")):jf(e,t)),n}function Lf(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var a=r.callback;e.pendingcb--,a(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}hf.prototype.read=function(e){ff("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return ff("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?kf(this):vf(this),null;if(0===(e=yf(e,t))&&t.ended)return 0===t.length&&kf(this),null;var r,a=t.needReadable;return ff("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&ff("length less than watermark",a=!0),t.ended||t.reading?ff("reading or ended",a=!1):a&&(ff("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=yf(n,t))),null===(r=e>0?Ef(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&kf(this)),null!==r&&this.emit("data",r),r},hf.prototype._read=function(e){this.emit("error",new Error("not implemented"))},hf.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,ff("pipe count=%d opts=%j",r.pipesCount,t);var a=t&&!1===t.end?c:i;function o(e){ff("onunpipe"),e===n&&c()}function i(){ff("onend"),e.end()}r.endEmitted?Xt(a):n.once("end",a),e.on("unpipe",o);var s=function(e){return function(){var t=e._readableState;ff("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,Sf(e))}}(n);e.on("drain",s);var l=!1;function c(){ff("cleanup"),e.removeListener("close",p),e.removeListener("finish",h),e.removeListener("drain",s),e.removeListener("error",f),e.removeListener("unpipe",o),n.removeListener("end",i),n.removeListener("end",c),n.removeListener("data",d),l=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||s()}var u=!1;function d(t){ff("ondata"),u=!1,!1!==e.write(t)||u||((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==Af(r.pipes,e))&&!l&&(ff("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,u=!0),n.pause())}function f(t){ff("onerror",t),m(),e.removeListener("error",f),0===e.listeners("error").length&&e.emit("error",t)}function p(){e.removeListener("finish",h),m()}function h(){ff("onfinish"),e.removeListener("close",p),m()}function m(){ff("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",f),e.once("close",p),e.once("finish",h),e.emit("pipe",n),r.flowing||(ff("pipe resume"),n.resume()),e},hf.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)n[a].emit("unpipe",this);return this}var o=Af(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},hf.prototype.addListener=hf.prototype.on=function(e,t){var n=Td.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&vf(this):Xt(wf,this))}return n},hf.prototype.resume=function(){var e=this._readableState;return e.flowing||(ff("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,Xt(xf,e,t))}(this,e)),this},hf.prototype.pause=function(){return ff("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(ff("pause"),this._readableState.flowing=!1,this.emit("pause")),this},hf.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var a in e.on("end",(function(){if(ff("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(a){ff("wrapped data"),t.decoder&&(a=t.decoder.write(a)),t.objectMode&&null==a||(t.objectMode||a&&a.length)&&(r.push(a)||(n=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));return function(t,n){for(var a=0,o=t.length;a<o;a++)e.on(i=t[a],r.emit.bind(r,i));var i}(["error","close","destroy","pause","resume"]),r._read=function(t){ff("wrapped _read",t),n&&(n=!1,e.resume())},r},hf._fromList=Ef,Rf.WritableState=Nf,Md(Rf,Td),Nf.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},Rf.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Rf.prototype.write=function(e,t,n){var r=this._writableState,a=!1;return"function"==typeof t&&(n=t,t=null),kn.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=Of),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),Xt(t,n)}(this,n):function(e,t,n,r){var a=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):kn.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),Xt(r,o),a=!1),a}(this,r,e,n)&&(r.pendingcb++,a=function(e,t,n,r,a){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=kn.from(t,n)),t}(t,n,r),kn.isBuffer(n)&&(r="buffer");var o=t.objectMode?1:n.length;t.length+=o;var i=t.length<t.highWaterMark;if(i||(t.needDrain=!0),t.writing||t.corked){var s=t.lastBufferedRequest;t.lastBufferedRequest=new Tf(n,r,a),s?s.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else If(e,t,!1,o,n,r,a);return i}(this,r,e,t,n)),a},Rf.prototype.cork=function(){this._writableState.corked++},Rf.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||Ff(this,e))},Rf.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Rf.prototype._write=function(e,t,n){n(new Error("not implemented"))},Rf.prototype._writev=null,Rf.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,Df(e,t),n&&(t.finished?Xt(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Md(zf,hf);for(var Bf=Object.keys(Rf.prototype),qf=0;qf<Bf.length;qf++){var Uf=Bf[qf];zf.prototype[Uf]||(zf.prototype[Uf]=Rf.prototype[Uf])}function zf(e){if(!(this instanceof zf))return new zf(e);hf.call(this,e),Rf.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",Gf)}function Gf(){this.allowHalfOpen||this._writableState.ended||Xt(Hf,this)}function Hf(e){e.end()}function $f(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var a=r.writecb;if(!a)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),a(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Wf(e){if(!(this instanceof Wf))return new Wf(e);zf.call(this,e),this._transformState=new $f(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Vf(t,e)})):Vf(t)}))}function Vf(e,t){if(t)return e.emit("error",t);var n=e._transformState;if(e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function Jf(e){if(!(this instanceof Jf))return new Jf(e);Wf.call(this,e)}function Yf(){Td.call(this)}function Kf(e){return e.replace(/%([0-9A-Fa-f]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))}function Zf(e,t){return String(t).replace(e,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0");return"%".concat(t)}))}function Xf(e){return Zf(/[\n;\r\t=%&,\x00-\x1f\x7f-\xff]/g,e)}function Qf(e){return Zf(/[\n\r\t%\x00-\x1f\x7f-\xff]/g,e)}function ep(e){if(!e||!e.length||"."===e)return{};var t={};return e.replace(/\r?\n$/,"").split(";").forEach((function(e){var n,r=e.split("=",2);if(r[1]&&r[1].length){r[0]=r[0].trim();var a=t[r[0].trim()];a||(t[r[0]]=a=[]),(n=a).push.apply(n,Ue(r[1].split(",").map((function(e){return e.trim()})).map(Kf)))}})),t}function tp(e){var t=e.split("\t").map((function(e){return"."===e||""===e?null:e}));return{seq_id:t[0]&&Kf(t[0]),source:t[1]&&Kf(t[1]),type:t[2]&&Kf(t[2]),start:null===t[3]?null:parseInt(t[3],10),end:null===t[4]?null:parseInt(t[4],10),score:null===t[5]?null:parseFloat(t[5]),strand:t[6],phase:t[7],attributes:null===t[8]?null:ep(t[8])}}function np(e){var t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;var n=Be(t,2)[1],r=Be(t,3)[2],a={directive:n};if(r.length&&(r=r.replace(/\r?\n$/,""),a.value=r),"sequence-region"===n){var o=r.split(/\s+/,3);return _e(_e({},a),{},{seq_id:o[0],start:o[1]&&o[1].replace(/\D/g,""),end:o[2]&&o[2].replace(/\D/g,"")})}if("genome-build"===n){var i=Be(r.split(/\s+/,2),2),s=i[0],l=i[1];return _e(_e({},a),{},{source:s,buildName:l})}return a}function rp(e){var t=[];return Object.entries(e).forEach((function(e){var n,r=Be(e,2),a=r[0],o=r[1];o&&(n=o.hasOwnProperty("toString")?Xf(o.toString()):Array.isArray(o)?o.map(Xf).join(","):Xf(o),t.push("".concat(Xf(a),"=").concat(n)))})),t.length?t.join(";"):"."}function ap(e,t){var n=null==e.attributes?".":rp(e.attributes),r=[null===e.seq_id?".":Qf(e.seq_id),null===e.source?".":Qf(e.source),null===e.type?".":Qf(e.type),null===e.start?".":Qf(e.start),null===e.end?".":Qf(e.end),null===e.score?".":Qf(e.score),null===e.strand?".":Qf(e.strand),null===e.phase?".":Qf(e.phase),n],a="".concat(r.join("\t"),"\n");return t[a]?"":(t[a]=!0,a)}function op(e,t){if(Array.isArray(e))return e.map((function(e){return op(e,t)})).join("");var n,r=[ap(e,t)];return void 0!==(n=e).child_features&&void 0!==n.derived_features&&r.push.apply(r,Ue(e.child_features.map((function(e){return op(e,t)}))).concat(Ue(e.derived_features.map((function(e){return op(e,t)}))))),r.join("")}function ip(e){return op(e,{})}function sp(e){var t="##".concat(e.directive);return e.value&&(t+=" ".concat(e.value)),t+"\n"}function lp(e){return"# ".concat(e.comment,"\n")}function cp(e){return">".concat(e.id).concat(e.description?" ".concat(e.description):"","\n").concat(e.sequence,"\n")}function up(e){function t(e){return"attributes"in e?ip(e):"directive"in e?sp(e):"sequence"in e?cp(e):"comment"in e?lp(e):"# (invalid item found during format)\n"}return Array.isArray(e)?e.map(t):t(e)}Md(Wf,zf),Wf.prototype.push=function(e,t){return this._transformState.needTransform=!1,zf.prototype.push.call(this,e,t)},Wf.prototype._transform=function(e,t,n){throw new Error("Not implemented")},Wf.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},Wf.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},Md(Jf,Wf),Jf.prototype._transform=function(e,t,n){n(null,e)},Md(Yf,Td),Yf.Readable=hf,Yf.Writable=Rf,Yf.Duplex=zf,Yf.Transform=Wf,Yf.PassThrough=Jf,Yf.Stream=Yf,Yf.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",i),n.on("close",s));var o=!1;function i(){o||(o=!0,e.end())}function s(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(c(),0===Td.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",r),e.removeListener("drain",a),n.removeListener("end",i),n.removeListener("close",s),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",l),e.on("error",l),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e};var dp={__proto__:null,unescape:Kf,escape:Xf,escapeColumn:Qf,parseAttributes:ep,parseFeature:tp,parseDirective:np,formatAttributes:rp,formatFeature:ip,formatDirective:sp,formatComment:lp,formatSequence:cp,formatItem:up},fp=function(){function e(t){ke(this,e),this.seqCallback=t,this.currentSequence=void 0}return Ae(e,[{key:"addLine",value:function(e){var t=/^>\s*(\S+)\s*(.*)/.exec(e);t?(this._flush(),this.currentSequence={id:t[1],sequence:""},t[2]&&(this.currentSequence.description=t[2].trim())):this.currentSequence&&/\S/.test(e)&&(this.currentSequence.sequence+=e.replace(/\s/g,""))}},{key:"_flush",value:function(){this.currentSequence&&this.seqCallback(this.currentSequence)}},{key:"finish",value:function(){this._flush()}}]),e}(),pp=function(){function e(t){ke(this,e),this.fastaParser=void 0,this.eof=!1,this.lineNumber=0,this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},this._underConstructionOrphans={};var n=function(){};this.featureCallback=t.featureCallback||n,this.endCallback=t.endCallback||n,this.commentCallback=t.commentCallback||n,this.errorCallback=t.errorCallback||n,this.directiveCallback=t.directiveCallback||n,this.sequenceCallback=t.sequenceCallback||n,this.bufferSize=void 0===t.bufferSize?1e3:t.bufferSize}return Ae(e,[{key:"addLine",value:function(e){if(this.fastaParser)this.fastaParser.addLine(e);else if(!this.eof)if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))this._bufferLine(e);else{var t=/^\s*(#+)(.*)/.exec(e);if(t){var n=Be(t,2)[1],r=Be(t,3)[2];if(3===n.length)this._emitAllUnderConstructionFeatures();else if(2===n.length){var a=np(e);a&&("FASTA"===a.directive?(this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new fp(this.sequenceCallback)):this._emitItem(a))}else r=r.replace(/\s*/,""),this._emitItem({comment:r})}else if(/^\s*$/.test(e));else{if(!/^\s*>/.test(e)){var o=e.replace(/\r?\n?$/g,"");throw new Error("GFF3 parse error.  Cannot parse '".concat(o,"'."))}this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new fp(this.sequenceCallback),this.fastaParser.addLine(e)}}}},{key:"finish",value:function(){this._emitAllUnderConstructionFeatures(),this.fastaParser&&this.fastaParser.finish(),this.endCallback()}},{key:"_emitItem",value:function(e){Array.isArray(e)?this.featureCallback(e):"directive"in e?this.directiveCallback(e):"comment"in e&&this.commentCallback(e)}},{key:"_enforceBufferSizeLimit",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=function t(n){n&&Array.isArray(n)&&n[0].attributes&&n[0].attributes.ID&&n[0].attributes.ID[0]&&(n[0].attributes.ID.forEach((function(t){delete e._underConstructionById[t],delete e._completedReferences[t]})),n.forEach((function(e){e.child_features&&e.child_features.forEach((function(e){return t(e)})),e.derived_features&&e.derived_features.forEach((function(e){return t(e)}))})))};this._underConstructionTopLevel.length+t>this.bufferSize;){var r=this._underConstructionTopLevel.shift();r&&(this._emitItem(r),n(r))}}},{key:"_emitAllUnderConstructionFeatures",value:function(){if(this._underConstructionTopLevel.forEach(this._emitItem.bind(this)),this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},Array.from(Object.values(this._underConstructionOrphans)).length)throw new Error("some features reference other features that do not exist in the file (or in the same '###' scope). ".concat(JSON.stringify(this._underConstructionOrphans)))}},{key:"_bufferLine",value:function(e){var t,n,r,a=this,o=_e(_e({},tp(e)),{},{child_features:[],derived_features:[]}),i=(null===(t=o.attributes)||void 0===t?void 0:t.ID)||[],s=(null===(n=o.attributes)||void 0===n?void 0:n.Parent)||[],l=(null===(r=o.attributes)||void 0===r?void 0:r.Derives_from)||[];if(i.length||s.length||l.length){var c=void 0;i.forEach((function(e){var t=a._underConstructionById[e];t?(t[t.length-1].type!==o.type&&a._parseError('multi-line feature "'.concat(e,'" has inconsistent types: "').concat(o.type,'", "').concat(t[t.length-1].type,'"')),t.push(o),c=t):(c=[o],a._enforceBufferSizeLimit(1),s.length||l.length||a._underConstructionTopLevel.push(c),a._underConstructionById[e]=c,a._resolveReferencesTo(c,e))})),this._resolveReferencesFrom(c||[o],{Parent:s,Derives_from:l},i)}else this._emitItem([o])}},{key:"_resolveReferencesTo",value:function(e,t){var n=this._underConstructionOrphans[t];n&&(e.forEach((function(e){var t;(t=e.child_features).push.apply(t,Ue(n.Parent))})),e.forEach((function(e){var t;(t=e.derived_features).push.apply(t,Ue(n.Derives_from))})),delete this._underConstructionOrphans[t])}},{key:"_parseError",value:function(e){this.eof=!0,this.errorCallback("".concat(this.lineNumber,": ").concat(e))}},{key:"_resolveReferencesFrom",value:function(e,t,n){var r=this;function a(e,t,n){var r=e[t];r||(e[t]=r={});var a=r[n]||!1;return r[n]=!0,a}t.Parent.forEach((function(t){var o=r._underConstructionById[t];if(o)n.filter((function(e){return a(r._completedReferences,e,"Parent,".concat(t))})).length||o.forEach((function(t){t.child_features.push(e)}));else{var i=r._underConstructionOrphans[t];i||(r._underConstructionOrphans[t]=i={Parent:[],Derives_from:[]}),i.Parent.push(e)}})),t.Derives_from.forEach((function(t){var o=r._underConstructionById[t];if(o)n.filter((function(e){return a(r._completedReferences,e,"Derives_from,".concat(t))})).length||o.forEach((function(t){t.derived_features.push(e)}));else{var i=r._underConstructionOrphans[t];i||(r._underConstructionOrphans[t]=i={Parent:[],Derives_from:[]}),i.Derives_from.push(e)}}))}}]),e}();function hp(e){fn&&Xt?Xt(e):e()}function mp(e){var t=_e({encoding:"utf8",parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1,bufferSize:1e3},e);return e.parseAll&&(t.parseFeatures=!0,t.parseDirectives=!0,t.parseComments=!0,t.parseSequences=!0),t}var gp=function(e){Te(n,e);var t=De(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ke(this,n),(e=t.call(this,{objectMode:!0})).textBuffer="";var a=mp(r);e.encoding=r.encoding||"utf8",e.decoder=new lf;var o=e.push.bind(je(e));return e.parser=new pp({featureCallback:a.parseFeatures?o:void 0,directiveCallback:a.parseDirectives?o:void 0,commentCallback:a.parseComments?o:void 0,sequenceCallback:a.parseSequences?o:void 0,errorCallback:function(t){return e.emit("error",t)},bufferSize:a.bufferSize}),e}return Ae(n,[{key:"_addLine",value:function(e){e&&this.parser.addLine(e)}},{key:"_nextText",value:function(e){var t=this,n=(this.textBuffer+e).split(/\r?\n/);this.textBuffer=n.pop()||"",n.forEach((function(e){return t._addLine(e)}))}},{key:"_transform",value:function(e,t,n){this._nextText(this.decoder.write(e)),hp(n)}},{key:"_flush",value:function(e){this.decoder.end&&this._nextText(this.decoder.end()),null!=this.textBuffer&&this._addLine(this.textBuffer),this.parser.finish(),hp(e)}}]),n}(Wf),yp=function(e){Te(n,e);var t=De(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ke(this,n),(e=t.call(this,Object.assign(r,{objectMode:!0}))).linesSinceLastSyncMark=0,e.haveWeEmittedData=!1,e.fastaMode=!1,e.minLinesBetweenSyncMarks=r.minSyncLines||100,e.insertVersionDirective=r.insertVersionDirective||!1,e}return Ae(n,[{key:"_transform",value:function(e,t,n){var r;if(!this.haveWeEmittedData&&this.insertVersionDirective){var a=Array.isArray(e)?e[0]:e;"directive"in a&&"gff-version"!==a.directive&&this.push("##gff-version 3\n")}if("sequence"in e&&!this.fastaMode&&(this.push("##FASTA\n"),this.fastaMode=!0),r=Array.isArray(e)?e.map(up).join(""):up(e),this.push(r),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)this.push("###\n"),this.linesSinceLastSyncMark=0;else{for(var o=0,i=0;i<r.length;i+=1)"\n"===r[i]&&(o+=1);this.linesSinceLastSyncMark+=o}this.haveWeEmittedData=!0,hp(n)}}]),n}(Wf),vp={parseStream:function(){return new gp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},parseStringSync:function(e){if(!e)return[];var t=mp(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=[],r=n.push.bind(n),a=new pp({featureCallback:t.parseFeatures?r:void 0,directiveCallback:t.parseDirectives?r:void 0,commentCallback:t.parseComments?r:void 0,sequenceCallback:t.parseSequences?r:void 0,bufferSize:Infinity,errorCallback:function(e){throw e}});return e.split(/\r?\n/).forEach(a.addLine.bind(a)),a.finish(),n},formatSync:function(e){var t=[],n=[];e.forEach((function(e){"sequence"in e?n.push(e):t.push(e)}));var r=t.map(up).join("");return n.length&&(r+="##FASTA\n",r+=n.map(cp).join("")),r},formatStream:function(){return new yp(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},formatFile:function(e,t){var n=_e({insertVersionDirective:!0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});return new Promise((function(r,a){e.pipe(new yp(n)).on("end",(function(){return r(null)})).on("error",a).pipe(t)}))},util:dp};async function bp(e,t,n){const r=vp.parseStringSync(t,{parseSequences:!0,parseComments:!0,parseDirectives:!1,parseFeatures:!0});if(0===r.length)throw new Error("No features found in GFF3 file");let a=0,o=n.assemblies.get(e);o||(o=n.addAssembly(e,"InMemoryFileDriver"));for(const e of r)if(Array.isArray(e)){const t=Or.gff3ToAnnotationFeature(e),n=o.refSeqs.get(t.refSeq)??o.addRefSeq(t.refSeq,t.refSeq);n.features.has(t._id)||n.addFeature(t)}else if("comment"in e)o.addComment(e.comment);else{a++;let t=o.refSeqs.get(e.id);t||(t=o.addRefSeq(e.id,e.id,e.description)),e.description&&!t.description&&t.setDescription(e.description),t.addSequence({start:0,stop:e.sequence.length,sequence:e.sequence})}if(0===a)throw new Error("No embedded FASTA section found in GFF3");const i=await _p(o);return n.addCheckResults(i),o}async function _p(e){const t=[];for(const n of e.refSeqs.values())for(const e of n.features.values())for(const r of pe.checkRegistry.getChecks().values()){const a=await r.checkFeature(l.getSnapshot(e),((e,t)=>Promise.resolve(n.getSequence(e,t))));t.push(...a)}return t}function wp(e){const{attributes:t}=e,n=t.get("gff_name");return n?n[0]:""}function xp(e){const{attributes:t}=e,n=t.get("gff_id"),r=t.get("transcript_id"),a=t.get("exon_id"),o=t.get("protein_id");return n?n[0]:r?r[0]:a?a[0]:o?o[0]:""}function Sp(e){const t=wp(e),n=xp(e);return t?`: ${t}`:n?`: ${n}`:""}function Ep(e,t=!1){const n=[];if(!e.featureAndGlyphUnderMouse)return n;n.push(e.featureAndGlyphUnderMouse.feature);for(const t of function(e){const t=[];let{parent:n}=e;for(;n;)t.push(n),({parent:n}=n);return t}(e.featureAndGlyphUnderMouse.feature))n.push(t);const{bp:r}=e,a=function(e){const t=[];if(e.children)for(const[,n]of e.children)t.push(n);return t}(e.featureAndGlyphUnderMouse.feature);for(const e of a)e.min<r&&e.max>=r&&n.push(e);if(!t)return n;if(e.featureAndGlyphUnderMouse.feature.parent){const t=e.featureAndGlyphUnderMouse.feature.parent.children;if(t)for(const[,a]of t)a._id!=e.featureAndGlyphUnderMouse.feature._id&&a.min<r&&a.max>=r&&n.push(a)}return n}function kp(e,t,n,r){const a=r.bpToPx({refName:t,coord:e.min,regionNumber:n}),o=r.bpToPx({refName:t,coord:e.max,regionNumber:n});if(void 0===a||void 0===o)return;const{offsetPx:i}=r;return[a.offsetPx-i,o.offsetPx-i]}function Cp(e,t,n){const[r,a]=n;if(!(Math.abs(a-r)<8))return Math.abs(r-t)<4?{feature:e,edge:"min"}:Math.abs(a-t)<4?{feature:e,edge:"max"}:void 0}function Ap(e,t,n){const r=[{featureId:e._id,oldLocation:e[n],newLocation:t}],{parent:a}=e;return a&&("min"===n&&a[n]>t||"max"===n&&a[n]<t)&&r.push(...Ap(a,t,n)),r}function Op(e,t,n,r,a){const o=e._id,i=[{featureId:o,oldLocation:e[n],newLocation:t}],{parent:s,children:l}=e;if(l)for(const[,e]of l)e._id!==a&&("min"===n&&e[n]<t||"max"===n&&e[n]>t)&&i.push(...Op(e,t,n,r));if(s&&r){const e=[];if(s.children)for(const[,t]of s.children)t._id!==o&&e.push(t);if(0===e.length)i.push(...Op(s,t,n,r,o));else{const a=s[n],l=Math[n](...e.map((e=>e[n])),t);l!==a&&i.push(...Op(s,l,n,r,o))}}return i}function Tp(e,t,n,r=!1){const a=e[n];if(t===a)throw new Error(`New and existing locations are the same: "${t}"`);return"min"===n?t>a?Op(e,t,n,r):Ap(e,t,n):t<a?Op(e,t,n,r):Ap(e,t,n)}async function Np(e,t){let n;try{n=await e.text()}catch{n=""}return`${t?`${t}  `:""}${e.status} ${e.statusText}${n?` (${n})`:""}`}var Rp={},Ip=eu.exports;Object.defineProperty(Rp,"__esModule",{value:!0});var Pp=Rp.default=void 0;Pp=Rp.default=(0,Ip(tu).default)((0,G.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");var Fp={},Mp=eu.exports;Object.defineProperty(Fp,"__esModule",{value:!0});var jp=Fp.default=void 0;jp=Fp.default=(0,Mp(tu).default)((0,G.default.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"Link");var Dp={},Lp=eu.exports;Object.defineProperty(Dp,"__esModule",{value:!0});var Bp=Dp.default=void 0;Bp=Dp.default=(0,Lp(tu).default)((0,G.default.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonChecked");var qp={},Up=eu.exports;Object.defineProperty(qp,"__esModule",{value:!0});var zp=qp.default=void 0;zp=qp.default=(0,Up(tu).default)((0,G.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked");var Gp={},Hp=eu.exports;Object.defineProperty(Gp,"__esModule",{value:!0});var $p=Gp.default=void 0;$p=Gp.default=(0,Hp(tu).default)((0,G.default.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");const Wp=d.makeStyles()((e=>({dialogTitle:{background:e.palette.primary.main,color:e.palette.primary.contrastText,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1.5),color:e.palette.primary.contrastText}}))),Vp=p.observer((function(e){const{classes:t}=Wp(),{handleClose:n,title:r,...a}=e;return $.default.createElement(f.Dialog,{...a,header:$.default.createElement($.default.Fragment,null,$.default.createElement(c.DialogTitle,{className:t.dialogTitle},r),$.default.createElement(c.IconButton,{"aria-label":"close",onClick:n,className:t.closeButton},$.default.createElement($p,null)))})}));var Jp;!function(e){e.GFF3="text/x-gff3",e.FASTA="text/x-fasta",e.BGZIP_FASTA="application/x-bgzip-fasta",e.FAI="text/x-fai",e.GZI="application/x-gzi",e.EXTERNAL="text/x-external"}(Jp||(Jp={}));const Yp=d.makeStyles()((e=>({accordion:{border:`1px solid ${e.palette.divider}`,"&:not(:last-child)":{borderBottom:0}},accordionSummary:{flexDirection:"row-reverse"},accordionDetails:{padding:e.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"},radioIcon:{color:e?.palette?.tertiary?.contrastText},dialog:{minWidth:550,maxWidth:800}})));function Kp(e,t,n,r,a,o,i,s,l){return!(!e||!(t&&r||n===Jp.GFF3&&r||r&&a&&o||i&&s&&l))}function Zp({changeManager:e,handleClose:t,session:n}){const{classes:a}=Yp(),{internetAccounts:o}=l.getRoot(n),{notify:i}=n,s=o.filter((e=>"ApolloInternetAccount"===e.type));if(0===s.length)throw new Error("No Apollo internet account found");const[d,f]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(!1),[y,v]=u.useState(Jp.BGZIP_FASTA),[b,_]=u.useState(!0),[w,x]=u.useState(!1),[S,E]=u.useState(!1),[k,C]=u.useState(null),[A,O]=u.useState(null),[T,N]=u.useState(null),[R,I]=u.useState(""),[P,F]=u.useState(""),[M,j]=u.useState(""),[D,L]=u.useState(!1),[B,q]=u.useState(!1);async function U(e,t){const{jobsManager:r}=n,a=new AbortController,[{baseURL:o,getFetcher:i}]=s,l=new URL("files",o);l.searchParams.set("type",t);const c=l.href,u=new FormData;let f=e.name;t===Jp.FAI||t===Jp.GZI?f=`${f}.txt`:B&&!e.name.toLocaleLowerCase().endsWith(".gz")?f=`${f}.gz`:!B&&e.name.toLocaleLowerCase().endsWith(".gz")&&(f=`${f}.txt`),u.append("file",e,f),u.append("type",t);const p=i({locationType:"UriLocation",uri:c});if(p){const t={name:`UploadAssemblyFile for ${d}`,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{a.abort(),r.abortJob(t.name)}};r.runJob(t),r.update(t.name,`Uploading ${e.name}, this may take awhile`);const{signal:n}=a,o=await p(c,{method:"POST",body:u,signal:n});if(!o.ok){const e=await Np(o,"Error when inserting new assembly (while uploading file)");return r.abortJob(t.name,e),h(e),""}const i=(await o.json())._id;return r.done(t),i}throw new Error("Failed to fetch")}u.useEffect((()=>{F(R?`${R}.fai`:"")}),[R]),u.useEffect((()=>{j(R?`${R}.gzi`:"")}),[R]),u.useEffect((()=>{q(!w&&y!==Jp.GFF3||!!k?.name.toLocaleLowerCase().endsWith(".gz"))}),[k,w,y]);let z=!1;try{const e=new URL(R);"http:"!==e.protocol&&"https:"!==e.protocol||(z=!0)}catch{}let G=!1;try{const e=new URL(P);"http:"!==e.protocol&&"https:"!==e.protocol||(G=!0)}catch{}let H=!1;try{const e=new URL(M);"http:"!==e.protocol&&"https:"!==e.protocol||(H=!0)}catch{}const[W,V]=$.default.useState("panelFastaInput"),J=e=>(t,n)=>{n&&V(e),q("panelGffInput"!==e)};return $.default.createElement(Vp,{open:!0,handleClose:t,"data-testid":"add-assembly-dialog",title:"Add new assembly",maxWidth:!1},$.default.createElement("form",{onSubmit:async function(n){let r;if(n.preventDefault(),h(""),E(!0),L(!0),i(`Assembly "${d}" is being added`,"info"),t(),n.preventDefault(),y===Jp.EXTERNAL)r=new Or.AddAssemblyFromExternalChange({typeName:"AddAssemblyFromExternalChange",assembly:(new _r).toHexString(),assemblyName:d,externalLocation:{fa:R,fai:P,gzi:M}});else{if(!k)throw new Error("Missing fasta file");if(y===Jp.GFF3&&b){const e=await U(k,Jp.GFF3);r=new Or.AddAssemblyAndFeaturesFromFileChange({typeName:"AddAssemblyAndFeaturesFromFileChange",assembly:(new _r).toHexString(),assemblyName:d,fileIds:{fa:e}})}else if(y===Jp.GFF3){const e=await U(k,Jp.GFF3);r=new Or.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new _r).toHexString(),assemblyName:d,fileIds:{fa:e}})}else if(w){const e=await U(k,Jp.FASTA);r=new Or.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new _r).toHexString(),assemblyName:d,fileIds:{fa:e}})}else{if(!A||!T)throw new Error("Missing fasta index files");const e=await U(k,Jp.BGZIP_FASTA),t=await U(A,Jp.FAI),n=await U(T,Jp.GZI);r=new Or.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new _r).toHexString(),assemblyName:d,fileIds:{fa:e,fai:t,gzi:n}})}}const[{internetAccountId:a}]=s;await e.submit(r,{internetAccountId:a,updateJobsManager:!0}),E(!1),L(!1)},"data-testid":"submit-form"},$.default.createElement(c.DialogContent,{className:a.dialog},D?$.default.createElement(c.LinearProgress,null):null,$.default.createElement(c.TextField,{margin:"dense",id:"name",label:"Assembly name",type:"TextField",fullWidth:!0,variant:"outlined",onChange:e=>{E(!1),f(e.target.value),function(e){const{assemblies:t}=n;t.find((t=>r.readConfObject(t,"displayName")===e))?(g(!1),h(`Assembly ${e} already exists.`)):(g(!0),h(""))}(e.target.value)},disabled:S&&!p}),$.default.createElement(c.Accordion,{disableGutters:!0,elevation:0,square:!0,className:a.accordion,expanded:"panelFastaInput"===W,onChange:J("panelFastaInput")},$.default.createElement(c.AccordionSummary,{className:a.accordionSummary,expandIcon:"panelFastaInput"===W?$.default.createElement(Bp,{className:a.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):$.default.createElement(zp,{className:a.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelFastaInputd-content",id:"panelFastaInputd-header"},$.default.createElement(c.Typography,{component:"span"},"FASTA input")),$.default.createElement(c.AccordionDetails,{className:a.accordionDetails},$.default.createElement(c.FormGroup,null,$.default.createElement(c.FormControlLabel,{"data-testid":"files-on-url-checkbox",control:$.default.createElement(c.Checkbox,{onChange:()=>{v(y===Jp.EXTERNAL?Jp.BGZIP_FASTA:Jp.EXTERNAL),y===Jp.EXTERNAL&&x(!1)},checked:y===Jp.EXTERNAL,disabled:w&&y!==Jp.GFF3}),label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Use external URLs",$.default.createElement(c.Tooltip,{title:"Use external URLs to provide FASTA and index files. Does not copy the files to the Apollo collaboration server, so ensure the URLs are stable.",placement:"top-start"},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))}),$.default.createElement(c.FormControlLabel,{"data-testid":"sequence-is-editable-checkbox",control:$.default.createElement(c.Checkbox,{onChange:()=>{x(!w)}}),checked:w,disabled:y===Jp.EXTERNAL,label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Store sequence in database",$.default.createElement(c.Tooltip,{title:"Enables users to edit the genomic sequence, but comes with performance impacts. Use with care.",placement:"top-start"},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))}),$.default.createElement(c.FormControlLabel,{"data-testid":"fasta-is-gzip-checkbox",control:$.default.createElement(c.Checkbox,{checked:B,onChange:()=>{q(!w||!B)},disabled:!w}),label:"FASTA is gzip compressed"}),$.default.createElement(c.Table,{size:"small",sx:{mt:2}},y===Jp.BGZIP_FASTA||y===Jp.GFF3?$.default.createElement(c.TableBody,null,$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement(c.Box,{display:"flex",alignItems:"center"},$.default.createElement("span",null,"FASTA"),$.default.createElement(c.Tooltip,{title:'Unless "Store sequence in database" enabled, FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent). Compression is optional for sequences stored in the database.'},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement("input",{"data-testid":"fasta-input-file",type:"file",onChange:e=>{C(e.target.files?.item(0)??null)},disabled:S&&!p}))),$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement("input",{"data-testid":"fai-input-file",type:"file",onChange:e=>{O(e.target.files?.item(0)??null)},disabled:S&&!p||w}))),$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement("input",{"data-testid":"gzi-input-file",type:"file",onChange:e=>{N(e.target.files?.item(0)??null)},disabled:S&&!p||w})))):$.default.createElement(c.TableBody,null,$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement(c.Box,{display:"flex",alignItems:"center"},$.default.createElement("span",null,"FASTA"),$.default.createElement(c.Tooltip,{title:"Remote FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent)"},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement(c.TextField,{"data-testid":"fasta-input-url",variant:"outlined",value:R,error:!z,onChange:e=>{I(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:$.default.createElement(c.InputAdornment,{position:"start"},$.default.createElement(jp,null))}}}))),$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement(c.TextField,{"data-testid":"fai-input-url",variant:"outlined",value:P,error:!G,onChange:e=>{F(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:$.default.createElement(c.InputAdornment,{position:"start"},$.default.createElement(jp,null))}}}))),$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),$.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},$.default.createElement(c.TextField,{"data-testid":"gzi-input-url",variant:"outlined",value:M,error:!H,onChange:e=>{j(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:$.default.createElement(c.InputAdornment,{position:"start"},$.default.createElement(jp,null))}}})))))))),$.default.createElement(c.Accordion,{disableGutters:!0,elevation:0,square:!0,className:a.accordion,expanded:"panelGffInput"===W,onChange:J("panelGffInput")},$.default.createElement(c.AccordionSummary,{className:a.accordionSummary,expandIcon:"panelGffInput"===W?$.default.createElement(Bp,{className:a.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):$.default.createElement(zp,{className:a.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelGffInputd-content"},$.default.createElement(c.Typography,{component:"span"},"GFF3 input",$.default.createElement(c.Tooltip,{title:"GFF3 must includes FASTA sequences. File can be gzip compressed."},$.default.createElement(Pp,{className:a.radioIcon,sx:{fontSize:18}})))),$.default.createElement(c.AccordionDetails,{className:a.accordionDetails},$.default.createElement(c.Box,{style:{marginTop:20}},$.default.createElement("input",{"data-testid":"gff3-input-file",type:"file",disabled:S&&!p,onChange:e=>{C(e.target.files?.item(0)??null),v(Jp.GFF3)}}),$.default.createElement(c.FormGroup,{style:{display:"grid"}},$.default.createElement(c.FormControlLabel,{control:$.default.createElement(c.Checkbox,{checked:b,onChange:()=>{_(!b)},disabled:S&&!p}),label:"Load features from GFF3 file"}),$.default.createElement(c.FormControlLabel,{"data-testid":"gff3-is-gzip-checkbox",control:$.default.createElement(c.Checkbox,{checked:B,onChange:()=>{q(!B)},disabled:S&&!p}),label:"GFF3 is gzip compressed"})))))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!Kp(m,w,y,k,A,T,z,G,H)||S,variant:"contained",type:"submit","data-testid":"submit-button"},S?"Submitting...":"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},p)):null)}var Xp,Qp,eh=function(e,t){return t.some((function(t){return e instanceof t}))},th=new WeakMap,nh=new WeakMap,rh=new WeakMap,ah=new WeakMap,oh=new WeakMap,ih={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return nh.get(e);if("objectStoreNames"===t)return e.objectStoreNames||rh.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return lh(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function sh(e){ih=e(ih)}function lh(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var r=function(){t.removeEventListener("success",a),t.removeEventListener("error",o)},a=function(){e(lh(t.result)),r()},o=function(){n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&th.set(e,t)})).catch((function(){})),oh.set(n,t),n;var t,n;if(ah.has(e))return ah.get(e);var r=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Qp||(Qp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(ch(this),n),lh(th.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return lh(t.apply(ch(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=t.call.apply(t,[ch(this),e].concat(r));return rh.set(o,e.sort?e.sort():[e]),lh(o)}:(e instanceof IDBTransaction&&function(e){if(!nh.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=function(){t(),r()},o=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)}));nh.set(e,t)}}(e),eh(e,Xp||(Xp=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ih):e);var t}(e);return r!==e&&(ah.set(e,r),oh.set(r,e)),r}var ch=function(e){return oh.get(e)},uh=["get","getKey","getAll","getAllKeys","count"],dh=["put","add","delete","clear"],fh=new Map;function ph(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(fh.get(t))return fh.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=dh.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||uh.includes(n))){var o=function(){var e=Ee(we().mark((function e(t){var o,i,s,l,c,u,d=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=this.transaction(t,a?"readwrite":"readonly"),s=i.store,l=d.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=d[u];return r&&(s=s.index(c.shift())),e.next=6,Promise.all([(o=s)[n].apply(o,c),a&&i.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return fh.set(t,o),o}}}sh((function(e){return _e(_e({},e),{},{get:function(t,n,r){return ph(t,n)||e.get(t,n,r)},has:function(t,n){return!!ph(t,n)||e.has(t,n)}})}));var hh=["continue","continuePrimaryKey","advance"],mh={},gh=new WeakMap,yh=new WeakMap,vh={get:function(e,t){if(!hh.includes(t))return e[t];var n=mh[t];return n||(n=mh[t]=function(){var e;gh.set(this,(e=yh.get(this))[t].apply(e,arguments))}),n}};function bh(){return _h.apply(this,arguments)}function _h(){var e;return e=we().mark((function e(){var t,n,r,a=arguments;return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)instanceof IDBCursor){e.next=5;break}return e.next=4,ve((n=t).openCursor.apply(n,a));case 4:t=e.sent;case 5:if(t){e.next=7;break}return e.abrupt("return");case 7:r=new Proxy(t,vh),yh.set(r,t),oh.set(r,ch(t));case 11:if(!t){e.next=20;break}return e.next=14,r;case 14:return e.next=16,ve(gh.get(r)||t.continue());case 16:t=e.sent,gh.delete(r),e.next=11;break;case 20:case"end":return e.stop()}}),e,this)})),_h=function(){return new he(e.apply(this,arguments))},_h.apply(this,arguments)}function wh(e,t){return t===Symbol.asyncIterator&&eh(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&eh(e,[IDBIndex,IDBObjectStore])}sh((function(e){return _e(_e({},e),{},{get:function(t,n,r){return wh(t,n)?bh:e.get(t,n,r)},has:function(t,n){return wh(t,n)||e.has(t,n)}})}));var xh={},Sh={},Eh={},kh={},Ch={};Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.isFunction=void 0,Ch.isFunction=function(e){return"function"==typeof e};var Ah={},Oh={},Th={};Object.defineProperty(Th,"__esModule",{value:!0}),Th.createErrorClass=void 0,Th.createErrorClass=function(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t},Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.UnsubscriptionError=void 0,Oh.UnsubscriptionError=Th.createErrorClass((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));var Nh={};Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.arrRemove=void 0,Nh.arrRemove=function(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}};var Rh=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ih=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Ph=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.isSubscription=Ah.EMPTY_SUBSCRIPTION=Ah.Subscription=void 0;var Fh=Ch,Mh=Oh,jh=Nh,Dh=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=Rh(o),s=i.next();!s.done;s=i.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(Fh.isFunction(l))try{l()}catch(e){a=e instanceof Mh.UnsubscriptionError?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=Rh(c),d=u.next();!d.done;d=u.next()){var f=d.value;try{Lh(f)}catch(e){a=null!=a?a:[],e instanceof Mh.UnsubscriptionError?a=Ph(Ph([],Ih(a)),Ih(e.errors)):a.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(a)throw new Mh.UnsubscriptionError(a)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Lh(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&jh.arrRemove(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&jh.arrRemove(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();function Lh(e){Fh.isFunction(e)?e():e.unsubscribe()}Ah.Subscription=Dh,Ah.EMPTY_SUBSCRIPTION=Dh.EMPTY,Ah.isSubscription=function(e){return e instanceof Dh||e&&"closed"in e&&Fh.isFunction(e.remove)&&Fh.isFunction(e.add)&&Fh.isFunction(e.unsubscribe)};var Bh={};Object.defineProperty(Bh,"__esModule",{value:!0}),Bh.config=void 0,Bh.config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var qh={},Uh={};!function(e){var t=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.timeoutProvider=void 0,e.timeoutProvider={setTimeout:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.timeoutProvider.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,n([r,a],t(o))):setTimeout.apply(void 0,n([r,a],t(o)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.timeoutProvider.delegate;return((null==n?void 0:n.clearTimeout)||clearTimeout)(t)})),delegate:void 0}}(Uh),Object.defineProperty(qh,"__esModule",{value:!0}),qh.reportUnhandledError=void 0;var zh=Bh,Gh=Uh;qh.reportUnhandledError=function(e){Gh.timeoutProvider.setTimeout((function(){var t=zh.config.onUnhandledError;if(!t)throw e;t(e)}))};var Hh={};Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.noop=void 0,Hh.noop=function(){};var $h={};function Wh(e,t,n){return{kind:e,value:t,error:n}}Object.defineProperty($h,"__esModule",{value:!0}),$h.createNotification=$h.nextNotification=$h.errorNotification=$h.COMPLETE_NOTIFICATION=void 0,$h.COMPLETE_NOTIFICATION=function(){return Wh("C",void 0,void 0)}(),$h.errorNotification=function(e){return Wh("E",void 0,e)},$h.nextNotification=function(e){return Wh("N",e,void 0)},$h.createNotification=Wh;var Vh={};Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.captureError=Vh.errorContext=void 0;var Jh=Bh,Yh=null;Vh.errorContext=function(e){if(Jh.config.useDeprecatedSynchronousErrorHandling){var t=!Yh;if(t&&(Yh={errorThrown:!1,error:null}),e(),t){var n=Yh;if(Yh=null,n.errorThrown)throw n.error}}else e()},Vh.captureError=function(e){Jh.config.useDeprecatedSynchronousErrorHandling&&Yh&&(Yh.errorThrown=!0,Yh.error=e)},function(e){var t=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EMPTY_OBSERVER=e.SafeSubscriber=e.Subscriber=void 0;var n=Ch,r=Ah,a=Bh,o=qh,i=Hh,s=$h,l=Uh,c=Vh,u=function(n){function a(t){var a=n.call(this)||this;return a.isStopped=!1,t?(a.destination=t,r.isSubscription(t)&&t.add(a)):a.destination=e.EMPTY_OBSERVER,a}return t(a,n),a.create=function(e,t,n){return new h(e,t,n)},a.prototype.next=function(e){this.isStopped?g(s.nextNotification(e),this):this._next(e)},a.prototype.error=function(e){this.isStopped?g(s.errorNotification(e),this):(this.isStopped=!0,this._error(e))},a.prototype.complete=function(){this.isStopped?g(s.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},a.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},a.prototype._next=function(e){this.destination.next(e)},a.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},a.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},a}(r.Subscription);e.Subscriber=u;var d=Function.prototype.bind;function f(e,t){return d.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){m(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){m(e)}else m(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){m(e)}},e}(),h=function(e){function r(t,r,o){var i,s,l=e.call(this)||this;return n.isFunction(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:l&&a.config.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},i={next:t.next&&f(t.next,s),error:t.error&&f(t.error,s),complete:t.complete&&f(t.complete,s)}):i=t,l.destination=new p(i),l}return t(r,e),r}(u);function m(e){a.config.useDeprecatedSynchronousErrorHandling?c.captureError(e):o.reportUnhandledError(e)}function g(e,t){var n=a.config.onStoppedNotification;n&&l.timeoutProvider.setTimeout((function(){return n(e,t)}))}e.SafeSubscriber=h,e.EMPTY_OBSERVER={closed:!0,next:i.noop,error:function(e){throw e},complete:i.noop}}(kh);var Kh={};Object.defineProperty(Kh,"__esModule",{value:!0}),Kh.observable=void 0,Kh.observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();var Zh={},Xh={};Object.defineProperty(Xh,"__esModule",{value:!0}),Xh.identity=void 0,Xh.identity=function(e){return e},Object.defineProperty(Zh,"__esModule",{value:!0}),Zh.pipeFromArray=Zh.pipe=void 0;var Qh=Xh;function em(e){return 0===e.length?Qh.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}Zh.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return em(e)},Zh.pipeFromArray=em,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.Observable=void 0;var tm=kh,nm=Ah,rm=Kh,am=Zh,om=Bh,im=Ch,sm=Vh,lm=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,a=function(e){return e&&e instanceof tm.Subscriber||function(e){return e&&im.isFunction(e.next)&&im.isFunction(e.error)&&im.isFunction(e.complete)}(e)&&nm.isSubscription(e)}(e)?e:new tm.SafeSubscriber(e,t,n);return sm.errorContext((function(){var e=r.operator,t=r.source;a.add(e?e.call(a,t):t?r._subscribe(a):r._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=cm(t))((function(t,r){var a=new tm.SafeSubscriber({next:function(t){try{e(t)}catch(e){r(e),a.unsubscribe()}},error:r,complete:t});n.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[rm.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return am.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=cm(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function cm(e){var t;return null!==(t=null!=e?e:om.config.Promise)&&void 0!==t?t:Promise}Eh.Observable=lm;var um={},dm={},fm={};Object.defineProperty(fm,"__esModule",{value:!0}),fm.operate=fm.hasLift=void 0;var pm=Ch;function hm(e){return pm.isFunction(null==e?void 0:e.lift)}fm.hasLift=hm,fm.operate=function(e){return function(t){if(hm(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}};var mm={},gm=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(mm,"__esModule",{value:!0}),mm.OperatorSubscriber=mm.createOperatorSubscriber=void 0;var ym=kh;mm.createOperatorSubscriber=function(e,t,n,r,a){return new vm(e,t,n,r,a)};var vm=function(e){function t(t,n,r,a,o,i){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=i,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return gm(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ym.Subscriber);mm.OperatorSubscriber=vm,Object.defineProperty(dm,"__esModule",{value:!0}),dm.refCount=void 0;var bm=fm,_m=mm;dm.refCount=function(){return bm.operate((function(e,t){var n=null;e._refCount++;var r=_m.createOperatorSubscriber(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,a=n;n=null,!r||a&&r!==a||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))};var wm=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(um,"__esModule",{value:!0}),um.ConnectableObservable=void 0;var xm=Ah,Sm=dm,Em=mm,km=fm,Cm=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,km.hasLift(t)&&(r.lift=t.lift),r}return wm(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new xm.Subscription;var n=this.getSubject();t.add(this.source.subscribe(Em.createOperatorSubscriber(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=xm.Subscription.EMPTY)}return t},t.prototype.refCount=function(){return Sm.refCount()(this)},t}(Eh.Observable);um.ConnectableObservable=Cm;var Am={},Om={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.performanceTimestampProvider=void 0,e.performanceTimestampProvider={now:function(){return(e.performanceTimestampProvider.delegate||performance).now()},delegate:void 0}}(Om);var Tm={};!function(e){var t=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrameProvider=void 0;var r=Ah;e.animationFrameProvider={schedule:function(t){var n=requestAnimationFrame,a=cancelAnimationFrame,o=e.animationFrameProvider.delegate;o&&(n=o.requestAnimationFrame,a=o.cancelAnimationFrame);var i=n((function(e){a=void 0,t(e)}));return new r.Subscription((function(){return null==a?void 0:a(i)}))},requestAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.requestAnimationFrame)||requestAnimationFrame).apply(void 0,n([],t(r)))})),cancelAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,n([],t(r)))})),delegate:void 0}}(Tm),Object.defineProperty(Am,"__esModule",{value:!0}),Am.animationFrames=void 0;var Nm=Eh,Rm=Om,Im=Tm;function Pm(e){return new Nm.Observable((function(t){var n=e||Rm.performanceTimestampProvider,r=n.now(),a=0;return function o(){t.closed||(a=Im.animationFrameProvider.requestAnimationFrame((function(i){a=0;var s=n.now();t.next({timestamp:e?s:i,elapsed:s-r}),o()})))}(),function(){a&&Im.animationFrameProvider.cancelAnimationFrame(a)}}))}Am.animationFrames=function(e){return e?Pm(e):Fm};var Fm=Pm(),Mm={},jm={};Object.defineProperty(jm,"__esModule",{value:!0}),jm.ObjectUnsubscribedError=void 0,jm.ObjectUnsubscribedError=Th.createErrorClass((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}));var Dm=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Lm=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.AnonymousSubject=Mm.Subject=void 0;var Bm=Eh,qm=Ah,Um=jm,zm=Nh,Gm=Vh,Hm=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Dm(t,e),t.prototype.lift=function(e){var t=new $m(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Um.ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;Gm.errorContext((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var a=Lm(t.currentObservers),o=a.next();!o.done;o=a.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Gm.errorContext((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Gm.errorContext((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.observers;return n.hasError||n.isStopped?qm.EMPTY_SUBSCRIPTION:(this.currentObservers=null,r.push(e),new qm.Subscription((function(){t.currentObservers=null,zm.arrRemove(r,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.isStopped;t.hasError?e.error(t.thrownError):n&&e.complete()},t.prototype.asObservable=function(){var e=new Bm.Observable;return e.source=this,e},t.create=function(e,t){return new $m(e,t)},t}(Bm.Observable);Mm.Subject=Hm;var $m=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Dm(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:qm.EMPTY_SUBSCRIPTION},t}(Hm);Mm.AnonymousSubject=$m;var Wm={},Vm=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.BehaviorSubject=void 0;var Jm=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return Vm(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e._value;if(e.hasError)throw e.thrownError;return this._throwIfClosed(),t},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Mm.Subject);Wm.BehaviorSubject=Jm;var Ym={},Km={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dateTimestampProvider=void 0,e.dateTimestampProvider={now:function(){return(e.dateTimestampProvider.delegate||Date).now()},delegate:void 0}}(Km);var Zm=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.ReplaySubject=void 0;var Xm=Km,Qm=function(e){function t(t,n,r){void 0===t&&(t=Infinity),void 0===n&&(n=Infinity),void 0===r&&(r=Xm.dateTimestampProvider);var a=e.call(this)||this;return a._bufferSize=t,a._windowTime=n,a._timestampProvider=r,a._buffer=[],a._infiniteTimeWindow=!0,a._infiniteTimeWindow=Infinity===n,a._bufferSize=Math.max(1,t),a._windowTime=Math.max(1,n),a}return Zm(t,e),t.prototype.next=function(t){var n=this,r=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,i=n._windowTime;n.isStopped||(r.push(t),!a&&r.push(o.now()+i)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),a=0;a<r.length&&!e.closed;a+=n?1:2)e.next(r[a]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,a=e._infiniteTimeWindow,o=(a?1:2)*t;if(t<Infinity&&o<r.length&&r.splice(0,r.length-o),!a){for(var i=n.now(),s=0,l=1;l<r.length&&r[l]<=i;l+=2)s=l;s&&r.splice(0,s+1)}},t}(Mm.Subject);Ym.ReplaySubject=Qm;var eg={},tg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(eg,"__esModule",{value:!0}),eg.AsyncSubject=void 0;var ng=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return tg(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t._hasValue,r=t._value,a=t.isStopped,o=t._isComplete;t.hasError?e.error(t.thrownError):(a||o)&&(n&&e.next(r),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this,n=t._hasValue,r=t._value;t._isComplete||(this._isComplete=!0,n&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(Mm.Subject);eg.AsyncSubject=ng;var rg={},ag={},og={},ig={},sg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ig,"__esModule",{value:!0}),ig.Action=void 0,ig.Action=function(e){function t(t,n){return e.call(this)||this}return sg(t,e),t.prototype.schedule=function(e,t){return this},t}(Ah.Subscription);var lg={};!function(e){var t=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.intervalProvider=void 0,e.intervalProvider={setInterval:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.intervalProvider.delegate;return(null==s?void 0:s.setInterval)?s.setInterval.apply(s,n([r,a],t(o))):setInterval.apply(void 0,n([r,a],t(o)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.intervalProvider.delegate;return((null==n?void 0:n.clearInterval)||clearInterval)(t)})),delegate:void 0}}(lg);var cg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(og,"__esModule",{value:!0}),og.AsyncAction=void 0;var ug=lg,dg=Nh,fg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return cg(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(a,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),ug.intervalProvider.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&ug.intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,dg.arrRemove(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(ig.Action);og.AsyncAction=fg;var pg={},hg={};Object.defineProperty(hg,"__esModule",{value:!0}),hg.TestTools=hg.Immediate=void 0;var mg,gg=1,yg={};function vg(e){return e in yg&&(delete yg[e],!0)}hg.Immediate={setImmediate:function(e){var t=gg++;return yg[t]=!0,mg||(mg=Promise.resolve()),mg.then((function(){return vg(t)&&e()})),t},clearImmediate:function(e){vg(e)}},hg.TestTools={pending:function(){return Object.keys(yg).length}},function(e){var t=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.immediateProvider=void 0;var r=hg.Immediate.setImmediate,a=hg.Immediate.clearImmediate;e.immediateProvider={setImmediate:function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var i=e.immediateProvider.delegate;return((null==i?void 0:i.setImmediate)||r).apply(void 0,n([],t(a)))},clearImmediate:function(t){var n=e.immediateProvider.delegate;return((null==n?void 0:n.clearImmediate)||a)(t)},delegate:void 0}}(pg);var bg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ag,"__esModule",{value:!0}),ag.AsapAction=void 0;var _g=pg;ag.AsapAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return bg(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=_g.immediateProvider.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(_g.immediateProvider.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(og.AsyncAction);var wg={},xg={},Sg={};Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.Scheduler=void 0;var Eg=Km;Sg.Scheduler=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Eg.dateTimestampProvider.now,e}();var kg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(xg,"__esModule",{value:!0}),xg.AsyncScheduler=void 0;var Cg=Sg;xg.AsyncScheduler=function(e){function t(t,n){void 0===n&&(n=Cg.Scheduler.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return kg(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Cg.Scheduler);var Ag=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(wg,"__esModule",{value:!0}),wg.AsapScheduler=void 0;var Og=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ag(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(xg.AsyncScheduler);wg.AsapScheduler=Og,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.asap=e.asapScheduler=void 0,e.asapScheduler=new wg.AsapScheduler(ag.AsapAction),e.asap=e.asapScheduler}(rg);var Tg={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.async=e.asyncScheduler=void 0,e.asyncScheduler=new xg.AsyncScheduler(og.AsyncAction),e.async=e.asyncScheduler}(Tg);var Ng={},Rg={},Ig=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.QueueAction=void 0,Rg.QueueAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Ig(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(og.AsyncAction);var Pg={},Fg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.QueueScheduler=void 0;var Mg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Fg(t,e),t}(xg.AsyncScheduler);Pg.QueueScheduler=Mg,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.queue=e.queueScheduler=void 0,e.queueScheduler=new Pg.QueueScheduler(Rg.QueueAction),e.queue=e.queueScheduler}(Ng);var jg={},Dg={},Lg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.AnimationFrameAction=void 0;var Bg=Tm;Dg.AnimationFrameAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Lg(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=Bg.animationFrameProvider.requestAnimationFrame((function(){return t.flush(void 0)}))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(Bg.animationFrameProvider.cancelAnimationFrame(n),t._scheduled=void 0)},t}(og.AsyncAction);var qg={},Ug=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(qg,"__esModule",{value:!0}),qg.AnimationFrameScheduler=void 0;var zg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ug(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(xg.AsyncScheduler);qg.AnimationFrameScheduler=zg,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrame=e.animationFrameScheduler=void 0,e.animationFrameScheduler=new qg.AnimationFrameScheduler(Dg.AnimationFrameAction),e.animationFrame=e.animationFrameScheduler}(jg);var Gg={},Hg=ue&&ue.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.VirtualAction=Gg.VirtualTimeScheduler=void 0;var $g=og,Wg=Ah;Gg.VirtualTimeScheduler=function(e){function t(t,n){void 0===t&&(t=Vg),void 0===n&&(n=Infinity);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return Hg(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(xg.AsyncScheduler);var Vg=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var a=e.call(this,t,n)||this;return a.scheduler=t,a.work=n,a.index=r,a.active=!0,a.index=t.index=r,a}return Hg(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),Number.isFinite(r)){if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var a=new t(this.scheduler,this.work);return this.add(a),a.schedule(n,r)}return Wg.Subscription.EMPTY},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var a=e.actions;return a.push(this),a.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}($g.AsyncAction);Gg.VirtualAction=Vg;var Jg={},Yg={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.empty=e.EMPTY=void 0;var t=Eh;e.EMPTY=new t.Observable((function(e){return e.complete()})),e.empty=function(n){return n?function(e){return new t.Observable((function(t){return e.schedule((function(){return t.complete()}))}))}(n):e.EMPTY}}(Yg);var Kg={},Zg={},Xg={};Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.isScheduler=void 0;var Qg=Ch;Xg.isScheduler=function(e){return e&&Qg.isFunction(e.schedule)},Object.defineProperty(Zg,"__esModule",{value:!0}),Zg.popNumber=Zg.popScheduler=Zg.popResultSelector=void 0;var ey=Ch,ty=Xg;function ny(e){return e[e.length-1]}Zg.popResultSelector=function(e){return ey.isFunction(ny(e))?e.pop():void 0},Zg.popScheduler=function(e){return ty.isScheduler(ny(e))?e.pop():void 0},Zg.popNumber=function(e,t){return"number"==typeof ny(e)?e.pop():t};var ry={},ay={},oy={},iy={},sy={};Object.defineProperty(sy,"__esModule",{value:!0}),sy.isArrayLike=void 0,sy.isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};var ly={};Object.defineProperty(ly,"__esModule",{value:!0}),ly.isPromise=void 0;var cy=Ch;ly.isPromise=function(e){return cy.isFunction(null==e?void 0:e.then)};var uy={};Object.defineProperty(uy,"__esModule",{value:!0}),uy.isInteropObservable=void 0;var dy=Kh,fy=Ch;uy.isInteropObservable=function(e){return fy.isFunction(e[dy.observable])};var py={};Object.defineProperty(py,"__esModule",{value:!0}),py.isAsyncIterable=void 0;var hy=Ch;py.isAsyncIterable=function(e){return Symbol.asyncIterator&&hy.isFunction(null==e?void 0:e[Symbol.asyncIterator])};var my={};Object.defineProperty(my,"__esModule",{value:!0}),my.createInvalidObservableTypeError=void 0,my.createInvalidObservableTypeError=function(e){return new TypeError("You provided "+(null!==e&&"object"===xe(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")};var gy={},yy={};function vy(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(yy,"__esModule",{value:!0}),yy.iterator=yy.getSymbolIterator=void 0,yy.getSymbolIterator=vy,yy.iterator=vy(),Object.defineProperty(gy,"__esModule",{value:!0}),gy.isIterable=void 0;var by=yy,_y=Ch;gy.isIterable=function(e){return _y.isFunction(null==e?void 0:e[by.iterator])};var wy={},xy=ue&&ue.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Sy=ue&&ue.__await||function(e){return this instanceof Sy?(this.v=e,this):new Sy(e)},Ey=ue&&ue.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof Sy?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}};Object.defineProperty(wy,"__esModule",{value:!0}),wy.isReadableStreamLike=wy.readableStreamLikeToAsyncGenerator=void 0;var ky=Ch;wy.readableStreamLikeToAsyncGenerator=function(e){return Ey(this,arguments,(function(){var t,n,r;return xy(this,(function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Sy(t.read())];case 3:return n=a.sent(),r=n.value,n.done?[4,Sy(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Sy(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))},wy.isReadableStreamLike=function(e){return ky.isFunction(null==e?void 0:e.getReader)};var Cy=ue&&ue.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))},Ay=ue&&ue.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Oy=ue&&ue.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof Ty?Ty(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}},Ty=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(iy,"__esModule",{value:!0}),iy.fromReadableStreamLike=iy.fromAsyncIterable=iy.fromIterable=iy.fromPromise=iy.fromArrayLike=iy.fromInteropObservable=iy.innerFrom=void 0;var Ny=sy,Ry=ly,Iy=Eh,Py=uy,Fy=py,My=my,jy=gy,Dy=wy,Ly=Ch,By=qh,qy=Kh;function Uy(e){return new Iy.Observable((function(t){var n=e[qy.observable]();if(Ly.isFunction(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function zy(e){return new Iy.Observable((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function Gy(e){return new Iy.Observable((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,By.reportUnhandledError)}))}function Hy(e){return new Iy.Observable((function(t){var n,r;try{for(var a=Ty(e),o=a.next();!o.done;o=a.next())if(t.next(o.value),t.closed)return}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()}))}function $y(e){return new Iy.Observable((function(t){(function(e,t){var n,r,a,o;return Cy(this,void 0,void 0,(function(){var i;return Ay(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=Oy(e),s.label=1;case 1:return[4,n.next()];case 2:if((r=s.sent()).done)return[3,4];if(t.next(r.value),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=s.sent(),a={error:i},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Wy(e){return $y(Dy.readableStreamLikeToAsyncGenerator(e))}iy.innerFrom=function(e){if(e instanceof Iy.Observable)return e;if(null!=e){if(Py.isInteropObservable(e))return Uy(e);if(Ny.isArrayLike(e))return zy(e);if(Ry.isPromise(e))return Gy(e);if(Fy.isAsyncIterable(e))return $y(e);if(jy.isIterable(e))return Hy(e);if(Dy.isReadableStreamLike(e))return Wy(e)}throw My.createInvalidObservableTypeError(e)},iy.fromInteropObservable=Uy,iy.fromArrayLike=zy,iy.fromPromise=Gy,iy.fromIterable=Hy,iy.fromAsyncIterable=$y,iy.fromReadableStreamLike=Wy;var Vy={},Jy={};Object.defineProperty(Jy,"__esModule",{value:!0}),Jy.executeSchedule=void 0,Jy.executeSchedule=function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);var o=t.schedule((function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!a)return o},Object.defineProperty(Vy,"__esModule",{value:!0}),Vy.observeOn=void 0;var Yy=Jy,Ky=fm,Zy=mm;Vy.observeOn=function(e,t){return void 0===t&&(t=0),Ky.operate((function(n,r){n.subscribe(Zy.createOperatorSubscriber(r,(function(n){return Yy.executeSchedule(r,e,(function(){return r.next(n)}),t)}),(function(){return Yy.executeSchedule(r,e,(function(){return r.complete()}),t)}),(function(n){return Yy.executeSchedule(r,e,(function(){return r.error(n)}),t)})))}))};var Xy={};Object.defineProperty(Xy,"__esModule",{value:!0}),Xy.subscribeOn=void 0;var Qy=fm;Xy.subscribeOn=function(e,t){return void 0===t&&(t=0),Qy.operate((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))},Object.defineProperty(oy,"__esModule",{value:!0}),oy.scheduleObservable=void 0;var ev=iy,tv=Vy,nv=Xy;oy.scheduleObservable=function(e,t){return ev.innerFrom(e).pipe(nv.subscribeOn(t),tv.observeOn(t))};var rv={};Object.defineProperty(rv,"__esModule",{value:!0}),rv.schedulePromise=void 0;var av=iy,ov=Vy,iv=Xy;rv.schedulePromise=function(e,t){return av.innerFrom(e).pipe(iv.subscribeOn(t),ov.observeOn(t))};var sv={};Object.defineProperty(sv,"__esModule",{value:!0}),sv.scheduleArray=void 0;var lv=Eh;sv.scheduleArray=function(e,t){return new lv.Observable((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))};var cv={};Object.defineProperty(cv,"__esModule",{value:!0}),cv.scheduleIterable=void 0;var uv=Eh,dv=yy,fv=Ch,pv=Jy;cv.scheduleIterable=function(e,t){return new uv.Observable((function(n){var r;return pv.executeSchedule(n,t,(function(){r=e[dv.iterator](),pv.executeSchedule(n,t,(function(){var e,t,a;try{t=(e=r.next()).value,a=e.done}catch(e){return void n.error(e)}a?n.complete():n.next(t)}),0,!0)})),function(){return fv.isFunction(null==r?void 0:r.return)&&r.return()}}))};var hv={};Object.defineProperty(hv,"__esModule",{value:!0}),hv.scheduleAsyncIterable=void 0;var mv=Eh,gv=Jy;hv.scheduleAsyncIterable=function(e,t){if(!e)throw new Error("Iterable cannot be null");return new mv.Observable((function(n){gv.executeSchedule(n,t,(function(){var r=e[Symbol.asyncIterator]();gv.executeSchedule(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))};var yv={};Object.defineProperty(yv,"__esModule",{value:!0}),yv.scheduleReadableStreamLike=void 0;var vv=hv,bv=wy;yv.scheduleReadableStreamLike=function(e,t){return vv.scheduleAsyncIterable(bv.readableStreamLikeToAsyncGenerator(e),t)},Object.defineProperty(ay,"__esModule",{value:!0}),ay.scheduled=void 0;var _v=oy,wv=rv,xv=sv,Sv=cv,Ev=hv,kv=uy,Cv=ly,Av=sy,Ov=gy,Tv=py,Nv=my,Rv=wy,Iv=yv;ay.scheduled=function(e,t){if(null!=e){if(kv.isInteropObservable(e))return _v.scheduleObservable(e,t);if(Av.isArrayLike(e))return xv.scheduleArray(e,t);if(Cv.isPromise(e))return wv.schedulePromise(e,t);if(Tv.isAsyncIterable(e))return Ev.scheduleAsyncIterable(e,t);if(Ov.isIterable(e))return Sv.scheduleIterable(e,t);if(Rv.isReadableStreamLike(e))return Iv.scheduleReadableStreamLike(e,t)}throw Nv.createInvalidObservableTypeError(e)},Object.defineProperty(ry,"__esModule",{value:!0}),ry.from=void 0;var Pv=ay,Fv=iy;ry.from=function(e,t){return t?Pv.scheduled(e,t):Fv.innerFrom(e)},Object.defineProperty(Kg,"__esModule",{value:!0}),Kg.of=void 0;var Mv=Zg,jv=ry;Kg.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Mv.popScheduler(e);return jv.from(e,n)};var Dv={};Object.defineProperty(Dv,"__esModule",{value:!0}),Dv.throwError=void 0;var Lv=Eh,Bv=Ch;Dv.throwError=function(e,t){var n=Bv.isFunction(e)?e:function(){return e},r=function(e){return e.error(n())};return new Lv.Observable(t?function(e){return t.schedule(r,0,e)}:r)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.observeNotification=e.Notification=e.NotificationKind=void 0;var t,n=Yg,r=Kg,a=Dv,o=Ch;(t=e.NotificationKind||(e.NotificationKind={})).NEXT="N",t.ERROR="E",t.COMPLETE="C";var i=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){return s(this,e)},e.prototype.do=function(e,t,n){var r=this,a=r.kind,o=r.error;return"N"===a?null==e?void 0:e(r.value):"E"===a?null==t?void 0:t(o):null==n?void 0:n()},e.prototype.accept=function(e,t,n){var r;return o.isFunction(null===(r=e)||void 0===r?void 0:r.next)?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e=this,t=e.kind,o=e.error,i="N"===t?r.of(e.value):"E"===t?a.throwError((function(){return o})):"C"===t?n.EMPTY:0;if(!i)throw new TypeError("Unexpected notification kind "+t);return i},e.createNext=function(t){return new e("N",t)},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e}();function s(e,t){var n,r,a,o=e.kind,i=e.value,s=e.error;if("string"!=typeof o)throw new TypeError('Invalid notification, missing "kind"');"N"===o?null===(n=t.next)||void 0===n||n.call(t,i):"E"===o?null===(r=t.error)||void 0===r||r.call(t,s):null===(a=t.complete)||void 0===a||a.call(t)}e.Notification=i,e.observeNotification=s}(Jg);var qv={};Object.defineProperty(qv,"__esModule",{value:!0}),qv.isObservable=void 0;var Uv=Eh,zv=Ch;qv.isObservable=function(e){return!!e&&(e instanceof Uv.Observable||zv.isFunction(e.lift)&&zv.isFunction(e.subscribe))};var Gv={},Hv={};Object.defineProperty(Hv,"__esModule",{value:!0}),Hv.EmptyError=void 0,Hv.EmptyError=Th.createErrorClass((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),Object.defineProperty(Gv,"__esModule",{value:!0}),Gv.lastValueFrom=void 0;var $v=Hv;Gv.lastValueFrom=function(e,t){var n="object"===xe(t);return new Promise((function(r,a){var o,i=!1;e.subscribe({next:function(e){o=e,i=!0},error:a,complete:function(){i?r(o):n?r(t.defaultValue):a(new $v.EmptyError)}})}))};var Wv={};Object.defineProperty(Wv,"__esModule",{value:!0}),Wv.firstValueFrom=void 0;var Vv=Hv,Jv=kh;Wv.firstValueFrom=function(e,t){var n="object"===xe(t);return new Promise((function(r,a){var o=new Jv.SafeSubscriber({next:function(e){r(e),o.unsubscribe()},error:a,complete:function(){n?r(t.defaultValue):a(new Vv.EmptyError)}});e.subscribe(o)}))};var Yv={};Object.defineProperty(Yv,"__esModule",{value:!0}),Yv.ArgumentOutOfRangeError=void 0,Yv.ArgumentOutOfRangeError=Th.createErrorClass((function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}));var Kv={};Object.defineProperty(Kv,"__esModule",{value:!0}),Kv.NotFoundError=void 0,Kv.NotFoundError=Th.createErrorClass((function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}}));var Zv={};Object.defineProperty(Zv,"__esModule",{value:!0}),Zv.SequenceError=void 0,Zv.SequenceError=Th.createErrorClass((function(e){return function(t){e(this),this.name="SequenceError",this.message=t}}));var Xv={},Qv={};Object.defineProperty(Qv,"__esModule",{value:!0}),Qv.isValidDate=void 0,Qv.isValidDate=function(e){return e instanceof Date&&!isNaN(e)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.timeout=e.TimeoutError=void 0;var t=Tg,n=Qv,r=fm,a=iy,o=mm,i=Jy;function s(t){throw new e.TimeoutError(t)}e.TimeoutError=Th.createErrorClass((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}})),e.timeout=function(e,l){var c=n.isValidDate(e)?{first:e}:"number"==typeof e?{each:e}:e,u=c.first,d=c.each,f=c.with,p=void 0===f?s:f,h=c.scheduler,m=void 0===h?null!=l?l:t.asyncScheduler:h,g=c.meta,y=void 0===g?null:g;if(null==u&&null==d)throw new TypeError("No timeout provided.");return r.operate((function(e,t){var n,r,s=null,l=0,c=function(e){r=i.executeSchedule(t,m,(function(){try{n.unsubscribe(),a.innerFrom(p({meta:y,lastValue:s,seen:l})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(o.createOperatorSubscriber(t,(function(e){null==r||r.unsubscribe(),l++,t.next(s=e),d>0&&c(d)}),void 0,void 0,(function(){(null==r?void 0:r.closed)||null==r||r.unsubscribe(),s=null}))),!l&&c(null!=u?"number"==typeof u?u:+u-m.now():d)}))}}(Xv);var eb={},tb={},nb={},rb={};Object.defineProperty(rb,"__esModule",{value:!0}),rb.map=void 0;var ab=fm,ob=mm;rb.map=function(e,t){return ab.operate((function(n,r){var a=0;n.subscribe(ob.createOperatorSubscriber(r,(function(n){r.next(e.call(t,n,a++))})))}))};var ib=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},sb=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(nb,"__esModule",{value:!0}),nb.mapOneOrManyArgs=void 0;var lb=rb,cb=Array.isArray;nb.mapOneOrManyArgs=function(e){return lb.map((function(t){return function(e,t){return cb(t)?e.apply(void 0,sb([],ib(t))):e(t)}(e,t)}))};var ub=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},db=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(tb,"__esModule",{value:!0}),tb.bindCallbackInternals=void 0;var fb=Xg,pb=Eh,hb=Xy,mb=nb,gb=Vy,yb=eg;tb.bindCallbackInternals=function e(t,n,r,a){if(r){if(!fb.isScheduler(r))return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return e(t,n,a).apply(this,o).pipe(mb.mapOneOrManyArgs(r))};a=r}return a?function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e(t,n).apply(this,r).pipe(hb.subscribeOn(a),gb.observeOn(a))}:function(){for(var e=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=new yb.AsyncSubject,i=!0;return new pb.Observable((function(a){var s=o.subscribe(a);if(i){i=!1;var l=!1,c=!1;n.apply(e,db(db([],ub(r)),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=e.shift();if(null!=r)return void o.error(r)}o.next(1<e.length?e:e[0]),c=!0,l&&o.complete()}])),c&&o.complete(),l=!0}return s}))}},Object.defineProperty(eb,"__esModule",{value:!0}),eb.bindCallback=void 0;var vb=tb;eb.bindCallback=function(e,t,n){return vb.bindCallbackInternals(!1,e,t,n)};var bb={};Object.defineProperty(bb,"__esModule",{value:!0}),bb.bindNodeCallback=void 0;var _b=tb;bb.bindNodeCallback=function(e,t,n){return _b.bindCallbackInternals(!0,e,t,n)};var wb={},xb={};Object.defineProperty(xb,"__esModule",{value:!0}),xb.argsArgArrayOrObject=void 0;var Sb=Array.isArray,Eb=Object.getPrototypeOf,kb=Object.prototype,Cb=Object.keys;xb.argsArgArrayOrObject=function(e){if(1===e.length){var t=e[0];if(Sb(t))return{args:t,keys:null};if((r=t)&&"object"===xe(r)&&Eb(r)===kb){var n=Cb(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}};var Ab={};Object.defineProperty(Ab,"__esModule",{value:!0}),Ab.createObject=void 0,Ab.createObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},Object.defineProperty(wb,"__esModule",{value:!0}),wb.combineLatestInit=wb.combineLatest=void 0;var Ob=Eh,Tb=xb,Nb=ry,Rb=Xh,Ib=nb,Pb=Zg,Fb=Ab,Mb=mm,jb=Jy;function Db(e,t,n){return void 0===n&&(n=Rb.identity),function(r){Lb(t,(function(){for(var a=e.length,o=new Array(a),i=a,s=a,l=function(a){Lb(t,(function(){var l=Nb.from(e[a],t),c=!1;l.subscribe(Mb.createOperatorSubscriber(r,(function(e){o[a]=e,c||(c=!0,s--),s||r.next(n(o.slice()))}),(function(){--i||r.complete()})))}),r)},c=0;c<a;c++)l(c)}),r)}}function Lb(e,t,n){e?jb.executeSchedule(n,e,t):t()}wb.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Pb.popScheduler(e),r=Pb.popResultSelector(e),a=Tb.argsArgArrayOrObject(e),o=a.args,i=a.keys;if(0===o.length)return Nb.from([],n);var s=new Ob.Observable(Db(o,n,i?function(e){return Fb.createObject(i,e)}:Rb.identity));return r?s.pipe(Ib.mapOneOrManyArgs(r)):s},wb.combineLatestInit=Db;var Bb={},qb={},Ub={},zb={},Gb={};Object.defineProperty(Gb,"__esModule",{value:!0}),Gb.mergeInternals=void 0;var Hb=iy,$b=Jy,Wb=mm;Gb.mergeInternals=function(e,t,n,r,a,o,i,s){var l=[],c=0,u=0,d=!1,f=function(){!d||l.length||c||t.complete()},p=function(e){return c<r?h(e):l.push(e)},h=function e(s){o&&t.next(s),c++;var d=!1;Hb.innerFrom(n(s,u++)).subscribe(Wb.createOperatorSubscriber(t,(function(e){null==a||a(e),o?p(e):t.next(e)}),(function(){d=!0}),void 0,(function(){if(d)try{c--;for(var n=function(){var n=l.shift();i?$b.executeSchedule(t,i,(function(){return e(n)})):e(n)};l.length&&c<r;)n();f()}catch(e){t.error(e)}})))};return e.subscribe(Wb.createOperatorSubscriber(t,p,(function(){d=!0,f()}))),function(){null==s||s()}},Object.defineProperty(zb,"__esModule",{value:!0}),zb.mergeMap=void 0;var Vb=rb,Jb=iy,Yb=fm,Kb=Gb,Zb=Ch;zb.mergeMap=function e(t,n,r){return void 0===r&&(r=Infinity),Zb.isFunction(n)?e((function(e,r){return Vb.map((function(t,a){return n(e,t,r,a)}))(Jb.innerFrom(t(e,r)))}),r):("number"==typeof n&&(r=n),Yb.operate((function(e,n){return Kb.mergeInternals(e,n,t,r)})))},Object.defineProperty(Ub,"__esModule",{value:!0}),Ub.mergeAll=void 0;var Xb=zb,Qb=Xh;Ub.mergeAll=function(e){return void 0===e&&(e=Infinity),Xb.mergeMap(Qb.identity,e)},Object.defineProperty(qb,"__esModule",{value:!0}),qb.concatAll=void 0;var e_=Ub;qb.concatAll=function(){return e_.mergeAll(1)},Object.defineProperty(Bb,"__esModule",{value:!0}),Bb.concat=void 0;var t_=qb,n_=Zg,r_=ry;Bb.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return t_.concatAll()(r_.from(e,n_.popScheduler(e)))};var a_={},o_={};Object.defineProperty(o_,"__esModule",{value:!0}),o_.defer=void 0;var i_=Eh,s_=iy;o_.defer=function(e){return new i_.Observable((function(t){s_.innerFrom(e()).subscribe(t)}))},Object.defineProperty(a_,"__esModule",{value:!0}),a_.connectable=void 0;var l_=Mm,c_=Eh,u_=o_,d_={connector:function(){return new l_.Subject},resetOnDisconnect:!0};a_.connectable=function(e,t){void 0===t&&(t=d_);var n=null,r=t.connector,a=t.resetOnDisconnect,o=void 0===a||a,i=r(),s=new c_.Observable((function(e){return i.subscribe(e)}));return s.connect=function(){return n&&!n.closed||(n=u_.defer((function(){return e})).subscribe(i),o&&n.add((function(){return i=r()}))),n},s};var f_={};Object.defineProperty(f_,"__esModule",{value:!0}),f_.forkJoin=void 0;var p_=Eh,h_=xb,m_=iy,g_=Zg,y_=mm,v_=nb,b_=Ab;f_.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=g_.popResultSelector(e),r=h_.argsArgArrayOrObject(e),a=r.args,o=r.keys,i=new p_.Observable((function(e){var t=a.length;if(t)for(var n=new Array(t),r=t,i=t,s=function(t){var s=!1;m_.innerFrom(a[t]).subscribe(y_.createOperatorSubscriber(e,(function(e){s||(s=!0,i--),n[t]=e}),(function(){return r--}),void 0,(function(){r&&s||(i||e.next(o?b_.createObject(o,n):n),e.complete())})))},l=0;l<t;l++)s(l);else e.complete()}));return n?i.pipe(v_.mapOneOrManyArgs(n)):i};var __={},w_=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(__,"__esModule",{value:!0}),__.fromEvent=void 0;var x_=iy,S_=Eh,E_=zb,k_=sy,C_=Ch,A_=nb,O_=["addListener","removeListener"],T_=["addEventListener","removeEventListener"],N_=["on","off"];function R_(e,t){return function(n){return function(r){return e[n](t,r)}}}__.fromEvent=function e(t,n,r,a){if(C_.isFunction(r)&&(a=r,r=void 0),a)return e(t,n,r).pipe(A_.mapOneOrManyArgs(a));var o=w_(function(e){return C_.isFunction(e.addEventListener)&&C_.isFunction(e.removeEventListener)}(t)?T_.map((function(e){return function(a){return t[e](n,a,r)}})):function(e){return C_.isFunction(e.addListener)&&C_.isFunction(e.removeListener)}(t)?O_.map(R_(t,n)):function(e){return C_.isFunction(e.on)&&C_.isFunction(e.off)}(t)?N_.map(R_(t,n)):[],2),i=o[0],s=o[1];if(!i&&k_.isArrayLike(t))return E_.mergeMap((function(t){return e(t,n,r)}))(x_.innerFrom(t));if(!i)throw new TypeError("Invalid event target");return new S_.Observable((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return i(t),function(){return s(t)}}))};var I_={};Object.defineProperty(I_,"__esModule",{value:!0}),I_.fromEventPattern=void 0;var P_=Eh,F_=Ch,M_=nb;I_.fromEventPattern=function e(t,n,r){return r?e(t,n).pipe(M_.mapOneOrManyArgs(r)):new P_.Observable((function(e){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1===t.length?t[0]:t)},a=t(r);return F_.isFunction(n)?function(){return n(r,a)}:void 0}))};var j_={},D_=ue&&ue.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(j_,"__esModule",{value:!0}),j_.generate=void 0;var L_=Xh,B_=Xg,q_=o_,U_=cv;j_.generate=function(e,t,n,r,a){var o,i,s,l;function c(){var e;return D_(this,(function(r){switch(r.label){case 0:e=l,r.label=1;case 1:return t&&!t(e)?[3,4]:[4,s(e)];case 2:r.sent(),r.label=3;case 3:return e=n(e),[3,1];case 4:return[2]}}))}return 1===arguments.length?(l=(o=e).initialState,t=o.condition,n=o.iterate,s=void 0===(i=o.resultSelector)?L_.identity:i,a=o.scheduler):(l=e,!r||B_.isScheduler(r)?(s=L_.identity,a=r):s=r),q_.defer(a?function(){return U_.scheduleIterable(c(),a)}:c)};var z_={};Object.defineProperty(z_,"__esModule",{value:!0}),z_.iif=void 0;var G_=o_;z_.iif=function(e,t,n){return G_.defer((function(){return e()?t:n}))};var H_={},$_={};Object.defineProperty($_,"__esModule",{value:!0}),$_.timer=void 0;var W_=Eh,V_=Tg,J_=Xg,Y_=Qv;$_.timer=function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=V_.async);var r=-1;return null!=t&&(J_.isScheduler(t)?n=t:r=t),new W_.Observable((function(t){var a=Y_.isValidDate(e)?+e-n.now():e;a<0&&(a=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),a)}))},Object.defineProperty(H_,"__esModule",{value:!0}),H_.interval=void 0;var K_=Tg,Z_=$_;H_.interval=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=K_.asyncScheduler),e<0&&(e=0),Z_.timer(e,e,t)};var X_={};Object.defineProperty(X_,"__esModule",{value:!0}),X_.merge=void 0;var Q_=Ub,ew=iy,tw=Yg,nw=Zg,rw=ry;X_.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=nw.popScheduler(e),r=nw.popNumber(e,Infinity),a=e;return a.length?1===a.length?ew.innerFrom(a[0]):Q_.mergeAll(r)(rw.from(a,n)):tw.EMPTY};var aw={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.never=e.NEVER=void 0,e.NEVER=new Eh.Observable(Hh.noop),e.never=function(){return e.NEVER}}(aw);var ow={},iw={};Object.defineProperty(iw,"__esModule",{value:!0}),iw.argsOrArgArray=void 0;var sw=Array.isArray;iw.argsOrArgArray=function(e){return 1===e.length&&sw(e[0])?e[0]:e},Object.defineProperty(ow,"__esModule",{value:!0}),ow.onErrorResumeNext=void 0;var lw=Eh,cw=iw,uw=mm,dw=Hh,fw=iy;ow.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=cw.argsOrArgArray(e);return new lw.Observable((function(e){var t=0;!function r(){if(t<n.length){var a=void 0;try{a=fw.innerFrom(n[t++])}catch(e){return void r()}var o=new uw.OperatorSubscriber(e,void 0,dw.noop,dw.noop);a.subscribe(o),o.add(r)}else e.complete()}()}))};var pw={};Object.defineProperty(pw,"__esModule",{value:!0}),pw.pairs=void 0;var hw=ry;pw.pairs=function(e,t){return hw.from(Object.entries(e),t)};var mw={},gw={};Object.defineProperty(gw,"__esModule",{value:!0}),gw.not=void 0,gw.not=function(e,t){return function(n,r){return!e.call(t,n,r)}};var yw={};Object.defineProperty(yw,"__esModule",{value:!0}),yw.filter=void 0;var vw=fm,bw=mm;yw.filter=function(e,t){return vw.operate((function(n,r){var a=0;n.subscribe(bw.createOperatorSubscriber(r,(function(n){return e.call(t,n,a++)&&r.next(n)})))}))},Object.defineProperty(mw,"__esModule",{value:!0}),mw.partition=void 0;var _w=gw,ww=yw,xw=iy;mw.partition=function(e,t,n){return[ww.filter(t,n)(xw.innerFrom(e)),ww.filter(_w.not(t,n))(xw.innerFrom(e))]};var Sw={};Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.raceInit=Sw.race=void 0;var Ew=Eh,kw=iy,Cw=iw,Aw=mm;function Ow(e){return function(t){for(var n=[],r=function(r){n.push(kw.innerFrom(e[r]).subscribe(Aw.createOperatorSubscriber(t,(function(e){if(n){for(var a=0;a<n.length;a++)a!==r&&n[a].unsubscribe();n=null}t.next(e)}))))},a=0;n&&!t.closed&&a<e.length;a++)r(a)}}Sw.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=Cw.argsOrArgArray(e)).length?kw.innerFrom(e[0]):new Ew.Observable(Ow(e))},Sw.raceInit=Ow;var Tw={};Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.range=void 0;var Nw=Eh,Rw=Yg;Tw.range=function(e,t,n){if(null==t&&(t=e,e=0),t<=0)return Rw.EMPTY;var r=t+e;return new Nw.Observable(n?function(t){var a=e;return n.schedule((function(){a<r?(t.next(a++),this.schedule()):t.complete()}))}:function(t){for(var n=e;n<r&&!t.closed;)t.next(n++);t.complete()})};var Iw={};Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.using=void 0;var Pw=Eh,Fw=iy,Mw=Yg;Iw.using=function(e,t){return new Pw.Observable((function(n){var r=e(),a=t(r);return(a?Fw.innerFrom(a):Mw.EMPTY).subscribe(n),function(){r&&r.unsubscribe()}}))};var jw={},Dw=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Lw=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(jw,"__esModule",{value:!0}),jw.zip=void 0;var Bw=Eh,qw=iy,Uw=iw,zw=Yg,Gw=mm,Hw=Zg;jw.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Hw.popResultSelector(e),r=Uw.argsOrArgArray(e);return r.length?new Bw.Observable((function(e){var t=r.map((function(){return[]})),a=r.map((function(){return!1}));e.add((function(){t=a=null}));for(var o=function(o){qw.innerFrom(r[o]).subscribe(Gw.createOperatorSubscriber(e,(function(r){if(t[o].push(r),t.every((function(e){return e.length}))){var i=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,Lw([],Dw(i))):i),t.some((function(e,t){return!e.length&&a[t]}))&&e.complete()}}),(function(){a[o]=!0,!t[o].length&&e.complete()})))},i=0;!e.closed&&i<r.length;i++)o(i);return function(){t=a=null}})):zw.EMPTY};var $w={};Object.defineProperty($w,"__esModule",{value:!0});var Ww={};Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.audit=void 0;var Vw=fm,Jw=iy,Yw=mm;Ww.audit=function(e){return Vw.operate((function(t,n){var r=!1,a=null,o=null,i=!1,s=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}i&&n.complete()},l=function(){o=null,i&&n.complete()};t.subscribe(Yw.createOperatorSubscriber(n,(function(t){r=!0,a=t,o||Jw.innerFrom(e(t)).subscribe(o=Yw.createOperatorSubscriber(n,s,l))}),(function(){i=!0,(!r||!o||o.closed)&&n.complete()})))}))};var Kw={};Object.defineProperty(Kw,"__esModule",{value:!0}),Kw.auditTime=void 0;var Zw=Tg,Xw=Ww,Qw=$_;Kw.auditTime=function(e,t){return void 0===t&&(t=Zw.asyncScheduler),Xw.audit((function(){return Qw.timer(e,t)}))};var ex={};Object.defineProperty(ex,"__esModule",{value:!0}),ex.buffer=void 0;var tx=fm,nx=Hh,rx=mm,ax=iy;ex.buffer=function(e){return tx.operate((function(t,n){var r=[];return t.subscribe(rx.createOperatorSubscriber(n,(function(e){return r.push(e)}),(function(){n.next(r),n.complete()}))),ax.innerFrom(e).subscribe(rx.createOperatorSubscriber(n,(function(){var e=r;r=[],n.next(e)}),nx.noop)),function(){r=null}}))};var ox={},ix=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ox,"__esModule",{value:!0}),ox.bufferCount=void 0;var sx=fm,lx=mm,cx=Nh;ox.bufferCount=function(e,t){return void 0===t&&(t=null),t=null!=t?t:e,sx.operate((function(n,r){var a=[],o=0;n.subscribe(lx.createOperatorSubscriber(r,(function(n){var i,s,l,c,u=null;o++%t==0&&a.push([]);try{for(var d=ix(a),f=d.next();!f.done;f=d.next())(m=f.value).push(n),e<=m.length&&(u=null!=u?u:[]).push(m)}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}if(u)try{for(var p=ix(u),h=p.next();!h.done;h=p.next()){var m;cx.arrRemove(a,m=h.value),r.next(m)}}catch(e){l={error:e}}finally{try{h&&!h.done&&(c=p.return)&&c.call(p)}finally{if(l)throw l.error}}}),(function(){var e,t;try{for(var n=ix(a),o=n.next();!o.done;o=n.next())r.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){a=null})))}))};var ux={},dx=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ux,"__esModule",{value:!0}),ux.bufferTime=void 0;var fx=Ah,px=fm,hx=mm,mx=Nh,gx=Tg,yx=Zg,vx=Jy;ux.bufferTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=yx.popScheduler(r))&&void 0!==t?t:gx.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return px.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.buffer;e.subs.unsubscribe(),mx.arrRemove(r,e),n.next(t),a&&c()},c=function(){if(r){var t=new fx.Subscription;n.add(t);var a={buffer:[],subs:t};r.push(a),vx.executeSchedule(t,o,(function(){return l(a)}),e)}};null!==i&&i>=0?vx.executeSchedule(n,o,c,i,!0):a=!0,c();var u=hx.createOperatorSubscriber(n,(function(e){var t,n,a=r.slice();try{for(var o=dx(a),i=o.next();!i.done;i=o.next()){var c=i.value,u=c.buffer;u.push(e),s<=u.length&&l(c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;null==r?void 0:r.length;)n.next(r.shift().buffer);null==u||u.unsubscribe(),n.complete(),n.unsubscribe()}),void 0,(function(){return r=null}));t.subscribe(u)}))};var bx={},_x=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(bx,"__esModule",{value:!0}),bx.bufferToggle=void 0;var wx=Ah,xx=fm,Sx=iy,Ex=mm,kx=Hh,Cx=Nh;bx.bufferToggle=function(e,t){return xx.operate((function(n,r){var a=[];Sx.innerFrom(e).subscribe(Ex.createOperatorSubscriber(r,(function(e){var n=[];a.push(n);var o=new wx.Subscription;o.add(Sx.innerFrom(t(e)).subscribe(Ex.createOperatorSubscriber(r,(function(){Cx.arrRemove(a,n),r.next(n),o.unsubscribe()}),kx.noop)))}),kx.noop)),n.subscribe(Ex.createOperatorSubscriber(r,(function(e){var t,n;try{for(var r=_x(a),o=r.next();!o.done;o=r.next())o.value.push(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),(function(){for(;a.length>0;)r.next(a.shift());r.complete()})))}))};var Ax={};Object.defineProperty(Ax,"__esModule",{value:!0}),Ax.bufferWhen=void 0;var Ox=fm,Tx=Hh,Nx=mm,Rx=iy;Ax.bufferWhen=function(e){return Ox.operate((function(t,n){var r=null,a=null;!function t(){null==a||a.unsubscribe();var o=r;r=[],o&&n.next(o),Rx.innerFrom(e()).subscribe(a=Nx.createOperatorSubscriber(n,t,Tx.noop))}(),t.subscribe(Nx.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.push(e)}),(function(){r&&n.next(r),n.complete()}),void 0,(function(){return r=a=null})))}))};var Ix={};Object.defineProperty(Ix,"__esModule",{value:!0}),Ix.catchError=void 0;var Px=iy,Fx=mm,Mx=fm;Ix.catchError=function e(t){return Mx.operate((function(n,r){var a,o=null,i=!1;o=n.subscribe(Fx.createOperatorSubscriber(r,void 0,void 0,(function(s){a=Px.innerFrom(t(s,e(t)(n))),o?(o.unsubscribe(),o=null,a.subscribe(r)):i=!0}))),i&&(o.unsubscribe(),o=null,a.subscribe(r))}))};var jx={},Dx={},Lx={},Bx={},qx={},Ux={};Object.defineProperty(Ux,"__esModule",{value:!0}),Ux.scanInternals=void 0;var zx=mm;Ux.scanInternals=function(e,t,n,r,a){return function(o,i){var s=n,l=t,c=0;o.subscribe(zx.createOperatorSubscriber(i,(function(t){var n=c++;l=s?e(l,t,n):(s=!0,t),r&&i.next(l)}),a&&function(){s&&i.next(l),i.complete()}))}},Object.defineProperty(qx,"__esModule",{value:!0}),qx.reduce=void 0;var Gx=Ux,Hx=fm;qx.reduce=function(e,t){return Hx.operate(Gx.scanInternals(e,t,arguments.length>=2,!1,!0))},Object.defineProperty(Bx,"__esModule",{value:!0}),Bx.toArray=void 0;var $x=qx,Wx=fm,Vx=function(e,t){return e.push(t),e};Bx.toArray=function(){return Wx.operate((function(e,t){$x.reduce(Vx,[])(e).subscribe(t)}))},Object.defineProperty(Lx,"__esModule",{value:!0}),Lx.joinAllInternals=void 0;var Jx=Xh,Yx=nb,Kx=Zh,Zx=zb,Xx=Bx;Lx.joinAllInternals=function(e,t){return Kx.pipe(Xx.toArray(),Zx.mergeMap((function(t){return e(t)})),t?Yx.mapOneOrManyArgs(t):Jx.identity)},Object.defineProperty(Dx,"__esModule",{value:!0}),Dx.combineLatestAll=void 0;var Qx=wb,eS=Lx;Dx.combineLatestAll=function(e){return eS.joinAllInternals(Qx.combineLatest,e)},Object.defineProperty(jx,"__esModule",{value:!0}),jx.combineAll=void 0,jx.combineAll=Dx.combineLatestAll;var tS={},nS={},rS=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},aS=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(nS,"__esModule",{value:!0}),nS.combineLatest=void 0;var oS=wb,iS=fm,sS=iw,lS=nb,cS=Zh,uS=Zg;nS.combineLatest=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=uS.popResultSelector(t);return r?cS.pipe(e.apply(void 0,aS([],rS(t))),lS.mapOneOrManyArgs(r)):iS.operate((function(e,n){oS.combineLatestInit(aS([e],rS(sS.argsOrArgArray(t))))(n)}))};var dS=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},fS=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(tS,"__esModule",{value:!0}),tS.combineLatestWith=void 0;var pS=nS;tS.combineLatestWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return pS.combineLatest.apply(void 0,fS([],dS(e)))};var hS={};Object.defineProperty(hS,"__esModule",{value:!0}),hS.concatMap=void 0;var mS=zb,gS=Ch;hS.concatMap=function(e,t){return gS.isFunction(t)?mS.mergeMap(e,t,1):mS.mergeMap(e,1)};var yS={};Object.defineProperty(yS,"__esModule",{value:!0}),yS.concatMapTo=void 0;var vS=hS,bS=Ch;yS.concatMapTo=function(e,t){return bS.isFunction(t)?vS.concatMap((function(){return e}),t):vS.concatMap((function(){return e}))};var _S={},wS={},xS=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},SS=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(wS,"__esModule",{value:!0}),wS.concat=void 0;var ES=fm,kS=qb,CS=Zg,AS=ry;wS.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=CS.popScheduler(e);return ES.operate((function(t,r){kS.concatAll()(AS.from(SS([t],xS(e)),n)).subscribe(r)}))};var OS=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},TS=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(_S,"__esModule",{value:!0}),_S.concatWith=void 0;var NS=wS;_S.concatWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return NS.concat.apply(void 0,TS([],OS(e)))};var RS={},IS={};Object.defineProperty(IS,"__esModule",{value:!0}),IS.fromSubscribable=void 0;var PS=Eh;IS.fromSubscribable=function(e){return new PS.Observable((function(t){return e.subscribe(t)}))},Object.defineProperty(RS,"__esModule",{value:!0}),RS.connect=void 0;var FS=Mm,MS=iy,jS=fm,DS=IS,LS={connector:function(){return new FS.Subject}};RS.connect=function(e,t){void 0===t&&(t=LS);var n=t.connector;return jS.operate((function(t,r){var a=n();MS.innerFrom(e(DS.fromSubscribable(a))).subscribe(r),r.add(t.subscribe(a))}))};var BS={};Object.defineProperty(BS,"__esModule",{value:!0}),BS.count=void 0;var qS=qx;BS.count=function(e){return qS.reduce((function(t,n,r){return!e||e(n,r)?t+1:t}),0)};var US={};Object.defineProperty(US,"__esModule",{value:!0}),US.debounce=void 0;var zS=fm,GS=Hh,HS=mm,$S=iy;US.debounce=function(e){return zS.operate((function(t,n){var r=!1,a=null,o=null,i=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}};t.subscribe(HS.createOperatorSubscriber(n,(function(t){null==o||o.unsubscribe(),r=!0,a=t,o=HS.createOperatorSubscriber(n,i,GS.noop),$S.innerFrom(e(t)).subscribe(o)}),(function(){i(),n.complete()}),void 0,(function(){a=o=null})))}))};var WS={};Object.defineProperty(WS,"__esModule",{value:!0}),WS.debounceTime=void 0;var VS=Tg,JS=fm,YS=mm;WS.debounceTime=function(e,t){return void 0===t&&(t=VS.asyncScheduler),JS.operate((function(n,r){var a=null,o=null,i=null,s=function(){if(a){a.unsubscribe(),a=null;var e=o;o=null,r.next(e)}};function l(){var n=i+e,o=t.now();if(o<n)return a=this.schedule(void 0,n-o),void r.add(a);s()}n.subscribe(YS.createOperatorSubscriber(r,(function(n){o=n,i=t.now(),a||(a=t.schedule(l,e),r.add(a))}),(function(){s(),r.complete()}),void 0,(function(){o=a=null})))}))};var KS={};Object.defineProperty(KS,"__esModule",{value:!0}),KS.defaultIfEmpty=void 0;var ZS=fm,XS=mm;KS.defaultIfEmpty=function(e){return ZS.operate((function(t,n){var r=!1;t.subscribe(XS.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))};var QS={},eE={},tE={};Object.defineProperty(tE,"__esModule",{value:!0}),tE.take=void 0;var nE=Yg,rE=fm,aE=mm;tE.take=function(e){return e<=0?function(){return nE.EMPTY}:rE.operate((function(t,n){var r=0;t.subscribe(aE.createOperatorSubscriber(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))};var oE={};Object.defineProperty(oE,"__esModule",{value:!0}),oE.ignoreElements=void 0;var iE=fm,sE=mm,lE=Hh;oE.ignoreElements=function(){return iE.operate((function(e,t){e.subscribe(sE.createOperatorSubscriber(t,lE.noop))}))};var cE={};Object.defineProperty(cE,"__esModule",{value:!0}),cE.mapTo=void 0;var uE=rb;cE.mapTo=function(e){return uE.map((function(){return e}))},Object.defineProperty(eE,"__esModule",{value:!0}),eE.delayWhen=void 0;var dE=Bb,fE=tE,pE=oE,hE=cE,mE=zb,gE=iy;eE.delayWhen=function e(t,n){return n?function(r){return dE.concat(n.pipe(fE.take(1),pE.ignoreElements()),r.pipe(e(t)))}:mE.mergeMap((function(e,n){return gE.innerFrom(t(e,n)).pipe(fE.take(1),hE.mapTo(e))}))},Object.defineProperty(QS,"__esModule",{value:!0}),QS.delay=void 0;var yE=Tg,vE=eE,bE=$_;QS.delay=function(e,t){void 0===t&&(t=yE.asyncScheduler);var n=bE.timer(e,t);return vE.delayWhen((function(){return n}))};var _E={};Object.defineProperty(_E,"__esModule",{value:!0}),_E.dematerialize=void 0;var wE=Jg,xE=fm,SE=mm;_E.dematerialize=function(){return xE.operate((function(e,t){e.subscribe(SE.createOperatorSubscriber(t,(function(e){return wE.observeNotification(e,t)})))}))};var EE={};Object.defineProperty(EE,"__esModule",{value:!0}),EE.distinct=void 0;var kE=fm,CE=mm,AE=Hh,OE=iy;EE.distinct=function(e,t){return kE.operate((function(n,r){var a=new Set;n.subscribe(CE.createOperatorSubscriber(r,(function(t){var n=e?e(t):t;a.has(n)||(a.add(n),r.next(t))}))),t&&OE.innerFrom(t).subscribe(CE.createOperatorSubscriber(r,(function(){return a.clear()}),AE.noop))}))};var TE={};Object.defineProperty(TE,"__esModule",{value:!0}),TE.distinctUntilChanged=void 0;var NE=Xh,RE=fm,IE=mm;function PE(e,t){return e===t}TE.distinctUntilChanged=function(e,t){return void 0===t&&(t=NE.identity),e=null!=e?e:PE,RE.operate((function(n,r){var a,o=!0;n.subscribe(IE.createOperatorSubscriber(r,(function(n){var i=t(n);!o&&e(a,i)||(o=!1,a=i,r.next(n))})))}))};var FE={};Object.defineProperty(FE,"__esModule",{value:!0}),FE.distinctUntilKeyChanged=void 0;var ME=TE;FE.distinctUntilKeyChanged=function(e,t){return ME.distinctUntilChanged((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))};var jE={},DE={};Object.defineProperty(DE,"__esModule",{value:!0}),DE.throwIfEmpty=void 0;var LE=Hv,BE=fm,qE=mm;function UE(){return new LE.EmptyError}DE.throwIfEmpty=function(e){return void 0===e&&(e=UE),BE.operate((function(t,n){var r=!1;t.subscribe(qE.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))},Object.defineProperty(jE,"__esModule",{value:!0}),jE.elementAt=void 0;var zE=Yv,GE=yw,HE=DE,$E=KS,WE=tE;jE.elementAt=function(e,t){if(e<0)throw new zE.ArgumentOutOfRangeError;var n=arguments.length>=2;return function(r){return r.pipe(GE.filter((function(t,n){return n===e})),WE.take(1),n?$E.defaultIfEmpty(t):HE.throwIfEmpty((function(){return new zE.ArgumentOutOfRangeError})))}};var VE={},JE=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},YE=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(VE,"__esModule",{value:!0}),VE.endWith=void 0;var KE=Bb,ZE=Kg;VE.endWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return KE.concat(t,ZE.of.apply(void 0,YE([],JE(e))))}};var XE={};Object.defineProperty(XE,"__esModule",{value:!0}),XE.every=void 0;var QE=fm,ek=mm;XE.every=function(e,t){return QE.operate((function(n,r){var a=0;n.subscribe(ek.createOperatorSubscriber(r,(function(o){e.call(t,o,a++,n)||(r.next(!1),r.complete())}),(function(){r.next(!0),r.complete()})))}))};var tk={},nk={},rk={};Object.defineProperty(rk,"__esModule",{value:!0}),rk.exhaustMap=void 0;var ak=rb,ok=iy,ik=fm,sk=mm;rk.exhaustMap=function e(t,n){return n?function(r){return r.pipe(e((function(e,r){return ok.innerFrom(t(e,r)).pipe(ak.map((function(t,a){return n(e,t,r,a)})))})))}:ik.operate((function(e,n){var r=0,a=null,o=!1;e.subscribe(sk.createOperatorSubscriber(n,(function(e){a||(a=sk.createOperatorSubscriber(n,void 0,(function(){a=null,o&&n.complete()})),ok.innerFrom(t(e,r++)).subscribe(a))}),(function(){o=!0,!a&&n.complete()})))}))},Object.defineProperty(nk,"__esModule",{value:!0}),nk.exhaustAll=void 0;var lk=rk,ck=Xh;nk.exhaustAll=function(){return lk.exhaustMap(ck.identity)},Object.defineProperty(tk,"__esModule",{value:!0}),tk.exhaust=void 0,tk.exhaust=nk.exhaustAll;var uk={};Object.defineProperty(uk,"__esModule",{value:!0}),uk.expand=void 0;var dk=fm,fk=Gb;uk.expand=function(e,t,n){return void 0===t&&(t=Infinity),t=(t||0)<1?Infinity:t,dk.operate((function(r,a){return fk.mergeInternals(r,a,e,t,void 0,!0,n)}))};var pk={};Object.defineProperty(pk,"__esModule",{value:!0}),pk.finalize=void 0;var hk=fm;pk.finalize=function(e){return hk.operate((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))};var mk={};Object.defineProperty(mk,"__esModule",{value:!0}),mk.createFind=mk.find=void 0;var gk=fm,yk=mm;function vk(e,t,n){var r="index"===n;return function(n,a){var o=0;n.subscribe(yk.createOperatorSubscriber(a,(function(i){var s=o++;e.call(t,i,s,n)&&(a.next(r?s:i),a.complete())}),(function(){a.next(r?-1:void 0),a.complete()})))}}mk.find=function(e,t){return gk.operate(vk(e,t,"value"))},mk.createFind=vk;var bk={};Object.defineProperty(bk,"__esModule",{value:!0}),bk.findIndex=void 0;var _k=fm,wk=mk;bk.findIndex=function(e,t){return _k.operate(wk.createFind(e,t,"index"))};var xk={};Object.defineProperty(xk,"__esModule",{value:!0}),xk.first=void 0;var Sk=Hv,Ek=yw,kk=tE,Ck=KS,Ak=DE,Ok=Xh;xk.first=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Ek.filter((function(t,n){return e(t,n,r)})):Ok.identity,kk.take(1),n?Ck.defaultIfEmpty(t):Ak.throwIfEmpty((function(){return new Sk.EmptyError})))}};var Tk={};Object.defineProperty(Tk,"__esModule",{value:!0}),Tk.groupBy=void 0;var Nk=Eh,Rk=iy,Ik=Mm,Pk=fm,Fk=mm;Tk.groupBy=function(e,t,n,r){return Pk.operate((function(a,o){var i;t&&"function"!=typeof t?(n=t.duration,i=t.element,r=t.connector):i=t;var s=new Map,l=function(e){s.forEach(e),e(o)},c=function(e){return l((function(t){return t.error(e)}))},u=0,d=!1,f=new Fk.OperatorSubscriber(o,(function(t){try{var a=e(t),l=s.get(a);if(!l){s.set(a,l=r?r():new Ik.Subject);var p=(m=a,g=l,(y=new Nk.Observable((function(e){u++;var t=g.subscribe(e);return function(){t.unsubscribe(),0==--u&&d&&f.unsubscribe()}}))).key=m,y);if(o.next(p),n){var h=Fk.createOperatorSubscriber(l,(function(){l.complete(),null==h||h.unsubscribe()}),void 0,void 0,(function(){return s.delete(a)}));f.add(Rk.innerFrom(n(p)).subscribe(h))}}l.next(i?i(t):t)}catch(e){c(e)}var m,g,y}),(function(){return l((function(e){return e.complete()}))}),c,(function(){return s.clear()}),(function(){return d=!0,0===u}));a.subscribe(f)}))};var Mk={};Object.defineProperty(Mk,"__esModule",{value:!0}),Mk.isEmpty=void 0;var jk=fm,Dk=mm;Mk.isEmpty=function(){return jk.operate((function(e,t){e.subscribe(Dk.createOperatorSubscriber(t,(function(){t.next(!1),t.complete()}),(function(){t.next(!0),t.complete()})))}))};var Lk={},Bk={},qk=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Bk,"__esModule",{value:!0}),Bk.takeLast=void 0;var Uk=Yg,zk=fm,Gk=mm;Bk.takeLast=function(e){return e<=0?function(){return Uk.EMPTY}:zk.operate((function(t,n){var r=[];t.subscribe(Gk.createOperatorSubscriber(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var a=qk(r),o=a.next();!o.done;o=a.next())n.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))},Object.defineProperty(Lk,"__esModule",{value:!0}),Lk.last=void 0;var Hk=Hv,$k=yw,Wk=Bk,Vk=DE,Jk=KS,Yk=Xh;Lk.last=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?$k.filter((function(t,n){return e(t,n,r)})):Yk.identity,Wk.takeLast(1),n?Jk.defaultIfEmpty(t):Vk.throwIfEmpty((function(){return new Hk.EmptyError})))}};var Kk={};Object.defineProperty(Kk,"__esModule",{value:!0}),Kk.materialize=void 0;var Zk=Jg,Xk=fm,Qk=mm;Kk.materialize=function(){return Xk.operate((function(e,t){e.subscribe(Qk.createOperatorSubscriber(t,(function(e){t.next(Zk.Notification.createNext(e))}),(function(){t.next(Zk.Notification.createComplete()),t.complete()}),(function(e){t.next(Zk.Notification.createError(e)),t.complete()})))}))};var eC={};Object.defineProperty(eC,"__esModule",{value:!0}),eC.max=void 0;var tC=qx,nC=Ch;eC.max=function(e){return tC.reduce(nC.isFunction(e)?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})};var rC={};Object.defineProperty(rC,"__esModule",{value:!0}),rC.flatMap=void 0,rC.flatMap=zb.mergeMap;var aC={};Object.defineProperty(aC,"__esModule",{value:!0}),aC.mergeMapTo=void 0;var oC=zb,iC=Ch;aC.mergeMapTo=function(e,t,n){return void 0===n&&(n=Infinity),iC.isFunction(t)?oC.mergeMap((function(){return e}),t,n):("number"==typeof t&&(n=t),oC.mergeMap((function(){return e}),n))};var sC={};Object.defineProperty(sC,"__esModule",{value:!0}),sC.mergeScan=void 0;var lC=fm,cC=Gb;sC.mergeScan=function(e,t,n){return void 0===n&&(n=Infinity),lC.operate((function(r,a){var o=t;return cC.mergeInternals(r,a,(function(t,n){return e(o,t,n)}),n,(function(e){o=e}),!1,void 0,(function(){return o=null}))}))};var uC={},dC={},fC=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},pC=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(dC,"__esModule",{value:!0}),dC.merge=void 0;var hC=fm,mC=iw,gC=Ub,yC=Zg,vC=ry;dC.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yC.popScheduler(e),r=yC.popNumber(e,Infinity);return e=mC.argsOrArgArray(e),hC.operate((function(t,a){gC.mergeAll(r)(vC.from(pC([t],fC(e)),n)).subscribe(a)}))};var bC=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},_C=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(uC,"__esModule",{value:!0}),uC.mergeWith=void 0;var wC=dC;uC.mergeWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return wC.merge.apply(void 0,_C([],bC(e)))};var xC={};Object.defineProperty(xC,"__esModule",{value:!0}),xC.min=void 0;var SC=qx,EC=Ch;xC.min=function(e){return SC.reduce(EC.isFunction(e)?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})};var kC={};Object.defineProperty(kC,"__esModule",{value:!0}),kC.multicast=void 0;var CC=um,AC=Ch,OC=RS;kC.multicast=function(e,t){var n=AC.isFunction(e)?e:function(){return e};return AC.isFunction(t)?OC.connect(t,{connector:n}):function(e){return new CC.ConnectableObservable(e,n)}};var TC={},NC=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},RC=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(TC,"__esModule",{value:!0}),TC.onErrorResumeNext=TC.onErrorResumeNextWith=void 0;var IC=iw,PC=ow;function FC(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=IC.argsOrArgArray(e);return function(e){return PC.onErrorResumeNext.apply(void 0,RC([e],NC(n)))}}TC.onErrorResumeNextWith=FC,TC.onErrorResumeNext=FC;var MC={};Object.defineProperty(MC,"__esModule",{value:!0}),MC.pairwise=void 0;var jC=fm,DC=mm;MC.pairwise=function(){return jC.operate((function(e,t){var n,r=!1;e.subscribe(DC.createOperatorSubscriber(t,(function(e){var a=n;n=e,r&&t.next([a,e]),r=!0})))}))};var LC={};Object.defineProperty(LC,"__esModule",{value:!0}),LC.pluck=void 0;var BC=rb;LC.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return BC.map((function(t){for(var r=t,a=0;a<n;a++){var o=null==r?void 0:r[e[a]];if(void 0===o)return;r=o}return r}))};var qC={};Object.defineProperty(qC,"__esModule",{value:!0}),qC.publish=void 0;var UC=Mm,zC=kC,GC=RS;qC.publish=function(e){return e?function(t){return GC.connect(e)(t)}:function(e){return zC.multicast(new UC.Subject)(e)}};var HC={};Object.defineProperty(HC,"__esModule",{value:!0}),HC.publishBehavior=void 0;var $C=Wm,WC=um;HC.publishBehavior=function(e){return function(t){var n=new $C.BehaviorSubject(e);return new WC.ConnectableObservable(t,(function(){return n}))}};var VC={};Object.defineProperty(VC,"__esModule",{value:!0}),VC.publishLast=void 0;var JC=eg,YC=um;VC.publishLast=function(){return function(e){var t=new JC.AsyncSubject;return new YC.ConnectableObservable(e,(function(){return t}))}};var KC={};Object.defineProperty(KC,"__esModule",{value:!0}),KC.publishReplay=void 0;var ZC=Ym,XC=kC,QC=Ch;KC.publishReplay=function(e,t,n,r){n&&!QC.isFunction(n)&&(r=n);var a=QC.isFunction(n)?n:void 0;return function(n){return XC.multicast(new ZC.ReplaySubject(e,t,r),a)(n)}};var eA={},tA=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},nA=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(eA,"__esModule",{value:!0}),eA.raceWith=void 0;var rA=Sw,aA=fm,oA=Xh;eA.raceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?aA.operate((function(t,n){rA.raceInit(nA([t],tA(e)))(n)})):oA.identity};var iA={};Object.defineProperty(iA,"__esModule",{value:!0}),iA.repeat=void 0;var sA=Yg,lA=fm,cA=mm,uA=iy,dA=$_;iA.repeat=function(e){var t,n,r=Infinity;return null!=e&&("object"===xe(e)?(r=void 0===(t=e.count)?Infinity:t,n=e.delay):r=e),r<=0?function(){return sA.EMPTY}:lA.operate((function(e,t){var a,o=0,i=function(){if(null==a||a.unsubscribe(),a=null,null!=n){var e="number"==typeof n?dA.timer(n):uA.innerFrom(n(o)),r=cA.createOperatorSubscriber(t,(function(){r.unsubscribe(),s()}));e.subscribe(r)}else s()},s=function(){var n=!1;a=e.subscribe(cA.createOperatorSubscriber(t,void 0,(function(){++o<r?a?i():n=!0:t.complete()}))),n&&i()};s()}))};var fA={};Object.defineProperty(fA,"__esModule",{value:!0}),fA.repeatWhen=void 0;var pA=iy,hA=Mm,mA=fm,gA=mm;fA.repeatWhen=function(e){return mA.operate((function(t,n){var r,a,o=!1,i=!1,s=!1,l=function(){return s&&i&&(n.complete(),!0)},c=function(){return a||(a=new hA.Subject,pA.innerFrom(e(a)).subscribe(gA.createOperatorSubscriber(n,(function(){r?u():o=!0}),(function(){i=!0,l()})))),a},u=function e(){s=!1,r=t.subscribe(gA.createOperatorSubscriber(n,void 0,(function(){s=!0,!l()&&c().next()}))),o&&(r.unsubscribe(),r=null,o=!1,e())};u()}))};var yA={};Object.defineProperty(yA,"__esModule",{value:!0}),yA.retry=void 0;var vA=fm,bA=mm,_A=Xh,wA=$_,xA=iy;yA.retry=function(e){var t;void 0===e&&(e=Infinity);var n=(t=e&&"object"===xe(e)?e:{count:e}).count,r=void 0===n?Infinity:n,a=t.delay,o=t.resetOnSuccess,i=void 0!==o&&o;return r<=0?_A.identity:vA.operate((function(e,t){var n,o=0;!function s(){var l=!1;n=e.subscribe(bA.createOperatorSubscriber(t,(function(e){i&&(o=0),t.next(e)}),void 0,(function(e){if(o++<r){var i=function(){n?(n.unsubscribe(),n=null,s()):l=!0};if(null!=a){var c="number"==typeof a?wA.timer(a):xA.innerFrom(a(e,o)),u=bA.createOperatorSubscriber(t,(function(){u.unsubscribe(),i()}),(function(){t.complete()}));c.subscribe(u)}else i()}else t.error(e)}))),l&&(n.unsubscribe(),n=null,s())}()}))};var SA={};Object.defineProperty(SA,"__esModule",{value:!0}),SA.retryWhen=void 0;var EA=iy,kA=Mm,CA=fm,AA=mm;SA.retryWhen=function(e){return CA.operate((function(t,n){var r,a,o=!1;!function i(){r=t.subscribe(AA.createOperatorSubscriber(n,void 0,void 0,(function(t){a||(a=new kA.Subject,EA.innerFrom(e(a)).subscribe(AA.createOperatorSubscriber(n,(function(){return r?i():o=!0})))),a&&a.next(t)}))),o&&(r.unsubscribe(),r=null,o=!1,i())}()}))};var OA={};Object.defineProperty(OA,"__esModule",{value:!0}),OA.sample=void 0;var TA=iy,NA=fm,RA=Hh,IA=mm;OA.sample=function(e){return NA.operate((function(t,n){var r=!1,a=null;t.subscribe(IA.createOperatorSubscriber(n,(function(e){r=!0,a=e}))),TA.innerFrom(e).subscribe(IA.createOperatorSubscriber(n,(function(){if(r){r=!1;var e=a;a=null,n.next(e)}}),RA.noop))}))};var PA={};Object.defineProperty(PA,"__esModule",{value:!0}),PA.sampleTime=void 0;var FA=Tg,MA=OA,jA=H_;PA.sampleTime=function(e,t){return void 0===t&&(t=FA.asyncScheduler),MA.sample(jA.interval(e,t))};var DA={};Object.defineProperty(DA,"__esModule",{value:!0}),DA.scan=void 0;var LA=fm,BA=Ux;DA.scan=function(e,t){return LA.operate(BA.scanInternals(e,t,arguments.length>=2,!0))};var qA={};Object.defineProperty(qA,"__esModule",{value:!0}),qA.sequenceEqual=void 0;var UA=fm,zA=mm,GA=iy;qA.sequenceEqual=function(e,t){return void 0===t&&(t=function(e,t){return e===t}),UA.operate((function(n,r){var a={buffer:[],complete:!1},o={buffer:[],complete:!1},i=function(e){r.next(e),r.complete()},s=function(e,n){var a=zA.createOperatorSubscriber(r,(function(r){var a=n.buffer;0===a.length?n.complete?i(!1):e.buffer.push(r):!t(r,a.shift())&&i(!1)}),(function(){e.complete=!0,n.complete&&i(0===n.buffer.length),null==a||a.unsubscribe()}));return a};n.subscribe(s(a,o)),GA.innerFrom(e).subscribe(s(o,a))}))};var HA={},$A=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},WA=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(HA,"__esModule",{value:!0}),HA.share=void 0;var VA=iy,JA=Mm,YA=kh,KA=fm;function ZA(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var a=new YA.SafeSubscriber({next:function(){a.unsubscribe(),e()}});return VA.innerFrom(t.apply(void 0,WA([],$A(n)))).subscribe(a)}}else e()}HA.share=function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new JA.Subject}:t,r=e.resetOnError,a=void 0===r||r,o=e.resetOnComplete,i=void 0===o||o,s=e.resetOnRefCountZero,l=void 0===s||s;return function(e){var t,r,o,s=0,c=!1,u=!1,d=function(){null==r||r.unsubscribe(),r=void 0},f=function(){d(),t=o=void 0,c=u=!1},p=function(){var e=t;f(),null==e||e.unsubscribe()};return KA.operate((function(e,h){s++,u||c||d();var m=o=null!=o?o:n();h.add((function(){0!=--s||u||c||(r=ZA(p,l))})),m.subscribe(h),!t&&s>0&&(t=new YA.SafeSubscriber({next:function(e){return m.next(e)},error:function(e){u=!0,d(),r=ZA(f,a,e),m.error(e)},complete:function(){c=!0,d(),r=ZA(f,i),m.complete()}}),VA.innerFrom(e).subscribe(t))}))(e)}};var XA={};Object.defineProperty(XA,"__esModule",{value:!0}),XA.shareReplay=void 0;var QA=Ym,eO=HA;XA.shareReplay=function(e,t,n){var r,a,o,i,s=!1;return e&&"object"===xe(e)?(i=void 0===(r=e.bufferSize)?Infinity:r,t=void 0===(a=e.windowTime)?Infinity:a,s=void 0!==(o=e.refCount)&&o,n=e.scheduler):i=null!=e?e:Infinity,eO.share({connector:function(){return new QA.ReplaySubject(i,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})};var tO={};Object.defineProperty(tO,"__esModule",{value:!0}),tO.single=void 0;var nO=Hv,rO=Zv,aO=Kv,oO=fm,iO=mm;tO.single=function(e){return oO.operate((function(t,n){var r,a=!1,o=!1,i=0;t.subscribe(iO.createOperatorSubscriber(n,(function(s){o=!0,e&&!e(s,i++,t)||(a&&n.error(new rO.SequenceError("Too many matching values")),a=!0,r=s)}),(function(){a?(n.next(r),n.complete()):n.error(o?new aO.NotFoundError("No matching values"):new nO.EmptyError)})))}))};var sO={};Object.defineProperty(sO,"__esModule",{value:!0}),sO.skip=void 0;var lO=yw;sO.skip=function(e){return lO.filter((function(t,n){return e<=n}))};var cO={};Object.defineProperty(cO,"__esModule",{value:!0}),cO.skipLast=void 0;var uO=Xh,dO=fm,fO=mm;cO.skipLast=function(e){return e<=0?uO.identity:dO.operate((function(t,n){var r=new Array(e),a=0;return t.subscribe(fO.createOperatorSubscriber(n,(function(t){var o=a++;if(o<e)r[o]=t;else{var i=o%e,s=r[i];r[i]=t,n.next(s)}}))),function(){r=null}}))};var pO={};Object.defineProperty(pO,"__esModule",{value:!0}),pO.skipUntil=void 0;var hO=fm,mO=mm,gO=iy,yO=Hh;pO.skipUntil=function(e){return hO.operate((function(t,n){var r=!1,a=mO.createOperatorSubscriber(n,(function(){null==a||a.unsubscribe(),r=!0}),yO.noop);gO.innerFrom(e).subscribe(a),t.subscribe(mO.createOperatorSubscriber(n,(function(e){return r&&n.next(e)})))}))};var vO={};Object.defineProperty(vO,"__esModule",{value:!0}),vO.skipWhile=void 0;var bO=fm,_O=mm;vO.skipWhile=function(e){return bO.operate((function(t,n){var r=!1,a=0;t.subscribe(_O.createOperatorSubscriber(n,(function(t){return(r||(r=!e(t,a++)))&&n.next(t)})))}))};var wO={};Object.defineProperty(wO,"__esModule",{value:!0}),wO.startWith=void 0;var xO=Bb,SO=Zg,EO=fm;wO.startWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=SO.popScheduler(e);return EO.operate((function(t,r){(n?xO.concat(e,t,n):xO.concat(e,t)).subscribe(r)}))};var kO={},CO={};Object.defineProperty(CO,"__esModule",{value:!0}),CO.switchMap=void 0;var AO=iy,OO=fm,TO=mm;CO.switchMap=function(e,t){return OO.operate((function(n,r){var a=null,o=0,i=!1,s=function(){return i&&!a&&r.complete()};n.subscribe(TO.createOperatorSubscriber(r,(function(n){null==a||a.unsubscribe();var i=0,l=o++;AO.innerFrom(e(n,l)).subscribe(a=TO.createOperatorSubscriber(r,(function(e){return r.next(t?t(n,e,l,i++):e)}),(function(){a=null,s()})))}),(function(){i=!0,s()})))}))},Object.defineProperty(kO,"__esModule",{value:!0}),kO.switchAll=void 0;var NO=CO,RO=Xh;kO.switchAll=function(){return NO.switchMap(RO.identity)};var IO={};Object.defineProperty(IO,"__esModule",{value:!0}),IO.switchMapTo=void 0;var PO=CO,FO=Ch;IO.switchMapTo=function(e,t){return FO.isFunction(t)?PO.switchMap((function(){return e}),t):PO.switchMap((function(){return e}))};var MO={};Object.defineProperty(MO,"__esModule",{value:!0}),MO.switchScan=void 0;var jO=CO,DO=fm;MO.switchScan=function(e,t){return DO.operate((function(n,r){var a=t;return jO.switchMap((function(t,n){return e(a,t,n)}),(function(e,t){return a=t,t}))(n).subscribe(r),function(){a=null}}))};var LO={};Object.defineProperty(LO,"__esModule",{value:!0}),LO.takeUntil=void 0;var BO=fm,qO=mm,UO=iy,zO=Hh;LO.takeUntil=function(e){return BO.operate((function(t,n){UO.innerFrom(e).subscribe(qO.createOperatorSubscriber(n,(function(){return n.complete()}),zO.noop)),!n.closed&&t.subscribe(n)}))};var GO={};Object.defineProperty(GO,"__esModule",{value:!0}),GO.takeWhile=void 0;var HO=fm,$O=mm;GO.takeWhile=function(e,t){return void 0===t&&(t=!1),HO.operate((function(n,r){var a=0;n.subscribe($O.createOperatorSubscriber(r,(function(n){var o=e(n,a++);(o||t)&&r.next(n),!o&&r.complete()})))}))};var WO={};Object.defineProperty(WO,"__esModule",{value:!0}),WO.tap=void 0;var VO=Ch,JO=fm,YO=mm,KO=Xh;WO.tap=function(e,t,n){var r=VO.isFunction(e)||t||n?{next:e,error:t,complete:n}:e;return r?JO.operate((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var a=!0;e.subscribe(YO.createOperatorSubscriber(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;a=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;a=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;a&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):KO.identity};var ZO={};Object.defineProperty(ZO,"__esModule",{value:!0}),ZO.throttle=void 0;var XO=fm,QO=mm,eT=iy;ZO.throttle=function(e,t){return XO.operate((function(n,r){var a=null!=t?t:{},o=a.leading,i=void 0===o||o,s=a.trailing,l=void 0!==s&&s,c=!1,u=null,d=null,f=!1,p=function(){null==d||d.unsubscribe(),d=null,l&&(g(),f&&r.complete())},h=function(){d=null,f&&r.complete()},m=function(t){return d=eT.innerFrom(e(t)).subscribe(QO.createOperatorSubscriber(r,p,h))},g=function(){if(c){c=!1;var e=u;u=null,r.next(e),!f&&m(e)}};n.subscribe(QO.createOperatorSubscriber(r,(function(e){c=!0,u=e,(!d||d.closed)&&(i?g():m(e))}),(function(){f=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))};var tT={};Object.defineProperty(tT,"__esModule",{value:!0}),tT.throttleTime=void 0;var nT=Tg,rT=ZO,aT=$_;tT.throttleTime=function(e,t,n){void 0===t&&(t=nT.asyncScheduler);var r=aT.timer(e,t);return rT.throttle((function(){return r}),n)};var oT={};Object.defineProperty(oT,"__esModule",{value:!0}),oT.TimeInterval=oT.timeInterval=void 0;var iT=Tg,sT=fm,lT=mm;oT.timeInterval=function(e){return void 0===e&&(e=iT.asyncScheduler),sT.operate((function(t,n){var r=e.now();t.subscribe(lT.createOperatorSubscriber(n,(function(t){var a=e.now(),o=a-r;r=a,n.next(new cT(t,o))})))}))};var cT=function(){return function(e,t){this.value=e,this.interval=t}}();oT.TimeInterval=cT;var uT={};Object.defineProperty(uT,"__esModule",{value:!0}),uT.timeoutWith=void 0;var dT=Tg,fT=Qv,pT=Xv;uT.timeoutWith=function(e,t,n){var r,a,o;if(n=null!=n?n:dT.async,fT.isValidDate(e)?r=e:"number"==typeof e&&(a=e),!t)throw new TypeError("No observable provided to switch to");if(o=function(){return t},null==r&&null==a)throw new TypeError("No timeout provided.");return pT.timeout({first:r,each:a,scheduler:n,with:o})};var hT={};Object.defineProperty(hT,"__esModule",{value:!0}),hT.timestamp=void 0;var mT=Km,gT=rb;hT.timestamp=function(e){return void 0===e&&(e=mT.dateTimestampProvider),gT.map((function(t){return{value:t,timestamp:e.now()}}))};var yT={};Object.defineProperty(yT,"__esModule",{value:!0}),yT.window=void 0;var vT=Mm,bT=fm,_T=mm,wT=Hh,xT=iy;yT.window=function(e){return bT.operate((function(t,n){var r=new vT.Subject;n.next(r.asObservable());var a=function(e){r.error(e),n.error(e)};return t.subscribe(_T.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.next(e)}),(function(){r.complete(),n.complete()}),a)),xT.innerFrom(e).subscribe(_T.createOperatorSubscriber(n,(function(){r.complete(),n.next(r=new vT.Subject)}),wT.noop,a)),function(){null==r||r.unsubscribe(),r=null}}))};var ST={},ET=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(ST,"__esModule",{value:!0}),ST.windowCount=void 0;var kT=Mm,CT=fm,AT=mm;ST.windowCount=function(e,t){void 0===t&&(t=0);var n=t>0?t:e;return CT.operate((function(t,r){var a=[new kT.Subject],o=0;r.next(a[0].asObservable()),t.subscribe(AT.createOperatorSubscriber(r,(function(t){var i,s;try{for(var l=ET(a),c=l.next();!c.done;c=l.next())c.value.next(t)}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}var u=o-e+1;if(u>=0&&u%n==0&&a.shift().complete(),++o%n==0){var d=new kT.Subject;a.push(d),r.next(d.asObservable())}}),(function(){for(;a.length>0;)a.shift().complete();r.complete()}),(function(e){for(;a.length>0;)a.shift().error(e);r.error(e)}),(function(){a=null})))}))};var OT={};Object.defineProperty(OT,"__esModule",{value:!0}),OT.windowTime=void 0;var TT=Mm,NT=Tg,RT=Ah,IT=fm,PT=mm,FT=Nh,MT=Zg,jT=Jy;OT.windowTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=MT.popScheduler(r))&&void 0!==t?t:NT.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return IT.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.subs;e.window.complete(),t.unsubscribe(),FT.arrRemove(r,e),a&&c()},c=function(){if(r){var t=new RT.Subscription;n.add(t);var a=new TT.Subject,i={window:a,subs:t,seen:0};r.push(i),n.next(a.asObservable()),jT.executeSchedule(t,o,(function(){return l(i)}),e)}};null!==i&&i>=0?jT.executeSchedule(n,o,c,i,!0):a=!0,c();var u=function(e){return r.slice().forEach(e)},d=function(e){u((function(t){return e(t.window)})),e(n),n.unsubscribe()};return t.subscribe(PT.createOperatorSubscriber(n,(function(e){u((function(t){t.window.next(e),s<=++t.seen&&l(t)}))}),(function(){return d((function(e){return e.complete()}))}),(function(e){return d((function(t){return t.error(e)}))}))),function(){r=null}}))};var DT={},LT=ue&&ue.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(DT,"__esModule",{value:!0}),DT.windowToggle=void 0;var BT=Mm,qT=Ah,UT=fm,zT=iy,GT=mm,HT=Hh,$T=Nh;DT.windowToggle=function(e,t){return UT.operate((function(n,r){var a=[],o=function(e){for(;0<a.length;)a.shift().error(e);r.error(e)};zT.innerFrom(e).subscribe(GT.createOperatorSubscriber(r,(function(e){var n=new BT.Subject;a.push(n);var i,s=new qT.Subscription;try{i=zT.innerFrom(t(e))}catch(e){return void o(e)}r.next(n.asObservable()),s.add(i.subscribe(GT.createOperatorSubscriber(r,(function(){$T.arrRemove(a,n),n.complete(),s.unsubscribe()}),HT.noop,o)))}),HT.noop)),n.subscribe(GT.createOperatorSubscriber(r,(function(e){var t,n,r=a.slice();try{for(var o=LT(r),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;0<a.length;)a.shift().complete();r.complete()}),o,(function(){for(;0<a.length;)a.shift().unsubscribe()})))}))};var WT={};Object.defineProperty(WT,"__esModule",{value:!0}),WT.windowWhen=void 0;var VT=Mm,JT=fm,YT=mm,KT=iy;WT.windowWhen=function(e){return JT.operate((function(t,n){var r,a,o=function(e){r.error(e),n.error(e)};!function t(){var i;null==a||a.unsubscribe(),null==r||r.complete(),r=new VT.Subject,n.next(r.asObservable());try{i=KT.innerFrom(e())}catch(e){return void o(e)}i.subscribe(a=YT.createOperatorSubscriber(n,t,t,o))}(),t.subscribe(YT.createOperatorSubscriber(n,(function(e){return r.next(e)}),(function(){r.complete(),n.complete()}),o,(function(){null==a||a.unsubscribe(),r=null})))}))};var ZT={},XT=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},QT=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(ZT,"__esModule",{value:!0}),ZT.withLatestFrom=void 0;var eN=fm,tN=mm,nN=iy,rN=Xh,aN=Hh,oN=Zg;ZT.withLatestFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=oN.popResultSelector(e);return eN.operate((function(t,r){for(var a=e.length,o=new Array(a),i=e.map((function(){return!1})),s=!1,l=function(t){nN.innerFrom(e[t]).subscribe(tN.createOperatorSubscriber(r,(function(e){o[t]=e,s||i[t]||(i[t]=!0,(s=i.every(rN.identity))&&(i=null))}),aN.noop))},c=0;c<a;c++)l(c);t.subscribe(tN.createOperatorSubscriber(r,(function(e){if(s){var t=QT([e],XT(o));r.next(n?n.apply(void 0,QT([],XT(t))):t)}})))}))};var iN={};Object.defineProperty(iN,"__esModule",{value:!0}),iN.zipAll=void 0;var sN=jw,lN=Lx;iN.zipAll=function(e){return lN.joinAllInternals(sN.zip,e)};var cN={},uN={},dN=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},fN=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(uN,"__esModule",{value:!0}),uN.zip=void 0;var pN=jw,hN=fm;uN.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hN.operate((function(t,n){pN.zip.apply(void 0,fN([t],dN(e))).subscribe(n)}))};var mN=ue&&ue.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},gN=ue&&ue.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(cN,"__esModule",{value:!0}),cN.zipWith=void 0;var yN=uN;cN.zipWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return yN.zip.apply(void 0,gN([],mN(e)))},function(e){var t=ue&&ue.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=ue&&ue.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.interval=e.iif=e.generate=e.fromEventPattern=e.fromEvent=e.from=e.forkJoin=e.empty=e.defer=e.connectable=e.concat=e.combineLatest=e.bindNodeCallback=e.bindCallback=e.UnsubscriptionError=e.TimeoutError=e.SequenceError=e.ObjectUnsubscribedError=e.NotFoundError=e.EmptyError=e.ArgumentOutOfRangeError=e.firstValueFrom=e.lastValueFrom=e.isObservable=e.identity=e.noop=e.pipe=e.NotificationKind=e.Notification=e.Subscriber=e.Subscription=e.Scheduler=e.VirtualAction=e.VirtualTimeScheduler=e.animationFrameScheduler=e.animationFrame=e.queueScheduler=e.queue=e.asyncScheduler=e.async=e.asapScheduler=e.asap=e.AsyncSubject=e.ReplaySubject=e.BehaviorSubject=e.Subject=e.animationFrames=e.observable=e.ConnectableObservable=e.Observable=void 0,e.filter=e.expand=e.exhaustMap=e.exhaustAll=e.exhaust=e.every=e.endWith=e.elementAt=e.distinctUntilKeyChanged=e.distinctUntilChanged=e.distinct=e.dematerialize=e.delayWhen=e.delay=e.defaultIfEmpty=e.debounceTime=e.debounce=e.count=e.connect=e.concatWith=e.concatMapTo=e.concatMap=e.concatAll=e.combineLatestWith=e.combineLatestAll=e.combineAll=e.catchError=e.bufferWhen=e.bufferToggle=e.bufferTime=e.bufferCount=e.buffer=e.auditTime=e.audit=e.config=e.NEVER=e.EMPTY=e.scheduled=e.zip=e.using=e.timer=e.throwError=e.range=e.race=e.partition=e.pairs=e.onErrorResumeNext=e.of=e.never=e.merge=void 0,e.switchMap=e.switchAll=e.subscribeOn=e.startWith=e.skipWhile=e.skipUntil=e.skipLast=e.skip=e.single=e.shareReplay=e.share=e.sequenceEqual=e.scan=e.sampleTime=e.sample=e.refCount=e.retryWhen=e.retry=e.repeatWhen=e.repeat=e.reduce=e.raceWith=e.publishReplay=e.publishLast=e.publishBehavior=e.publish=e.pluck=e.pairwise=e.onErrorResumeNextWith=e.observeOn=e.multicast=e.min=e.mergeWith=e.mergeScan=e.mergeMapTo=e.mergeMap=e.flatMap=e.mergeAll=e.max=e.materialize=e.mapTo=e.map=e.last=e.isEmpty=e.ignoreElements=e.groupBy=e.first=e.findIndex=e.find=e.finalize=void 0,e.zipWith=e.zipAll=e.withLatestFrom=e.windowWhen=e.windowToggle=e.windowTime=e.windowCount=e.window=e.toArray=e.timestamp=e.timeoutWith=e.timeout=e.timeInterval=e.throwIfEmpty=e.throttleTime=e.throttle=e.tap=e.takeWhile=e.takeUntil=e.takeLast=e.take=e.switchScan=e.switchMapTo=void 0;var r=Eh;Object.defineProperty(e,"Observable",{enumerable:!0,get:function(){return r.Observable}});var a=um;Object.defineProperty(e,"ConnectableObservable",{enumerable:!0,get:function(){return a.ConnectableObservable}});var o=Kh;Object.defineProperty(e,"observable",{enumerable:!0,get:function(){return o.observable}});var i=Am;Object.defineProperty(e,"animationFrames",{enumerable:!0,get:function(){return i.animationFrames}});var s=Mm;Object.defineProperty(e,"Subject",{enumerable:!0,get:function(){return s.Subject}});var l=Wm;Object.defineProperty(e,"BehaviorSubject",{enumerable:!0,get:function(){return l.BehaviorSubject}});var c=Ym;Object.defineProperty(e,"ReplaySubject",{enumerable:!0,get:function(){return c.ReplaySubject}});var u=eg;Object.defineProperty(e,"AsyncSubject",{enumerable:!0,get:function(){return u.AsyncSubject}});var d=rg;Object.defineProperty(e,"asap",{enumerable:!0,get:function(){return d.asap}}),Object.defineProperty(e,"asapScheduler",{enumerable:!0,get:function(){return d.asapScheduler}});var f=Tg;Object.defineProperty(e,"async",{enumerable:!0,get:function(){return f.async}}),Object.defineProperty(e,"asyncScheduler",{enumerable:!0,get:function(){return f.asyncScheduler}});var p=Ng;Object.defineProperty(e,"queue",{enumerable:!0,get:function(){return p.queue}}),Object.defineProperty(e,"queueScheduler",{enumerable:!0,get:function(){return p.queueScheduler}});var h=jg;Object.defineProperty(e,"animationFrame",{enumerable:!0,get:function(){return h.animationFrame}}),Object.defineProperty(e,"animationFrameScheduler",{enumerable:!0,get:function(){return h.animationFrameScheduler}});var m=Gg;Object.defineProperty(e,"VirtualTimeScheduler",{enumerable:!0,get:function(){return m.VirtualTimeScheduler}}),Object.defineProperty(e,"VirtualAction",{enumerable:!0,get:function(){return m.VirtualAction}});var g=Sg;Object.defineProperty(e,"Scheduler",{enumerable:!0,get:function(){return g.Scheduler}});var y=Ah;Object.defineProperty(e,"Subscription",{enumerable:!0,get:function(){return y.Subscription}});var v=kh;Object.defineProperty(e,"Subscriber",{enumerable:!0,get:function(){return v.Subscriber}});var b=Jg;Object.defineProperty(e,"Notification",{enumerable:!0,get:function(){return b.Notification}}),Object.defineProperty(e,"NotificationKind",{enumerable:!0,get:function(){return b.NotificationKind}});var _=Zh;Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return _.pipe}});var w=Hh;Object.defineProperty(e,"noop",{enumerable:!0,get:function(){return w.noop}});var x=Xh;Object.defineProperty(e,"identity",{enumerable:!0,get:function(){return x.identity}});var S=qv;Object.defineProperty(e,"isObservable",{enumerable:!0,get:function(){return S.isObservable}});var E=Gv;Object.defineProperty(e,"lastValueFrom",{enumerable:!0,get:function(){return E.lastValueFrom}});var k=Wv;Object.defineProperty(e,"firstValueFrom",{enumerable:!0,get:function(){return k.firstValueFrom}});var C=Yv;Object.defineProperty(e,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return C.ArgumentOutOfRangeError}});var A=Hv;Object.defineProperty(e,"EmptyError",{enumerable:!0,get:function(){return A.EmptyError}});var O=Kv;Object.defineProperty(e,"NotFoundError",{enumerable:!0,get:function(){return O.NotFoundError}});var T=jm;Object.defineProperty(e,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return T.ObjectUnsubscribedError}});var N=Zv;Object.defineProperty(e,"SequenceError",{enumerable:!0,get:function(){return N.SequenceError}});var R=Xv;Object.defineProperty(e,"TimeoutError",{enumerable:!0,get:function(){return R.TimeoutError}});var I=Oh;Object.defineProperty(e,"UnsubscriptionError",{enumerable:!0,get:function(){return I.UnsubscriptionError}});var P=eb;Object.defineProperty(e,"bindCallback",{enumerable:!0,get:function(){return P.bindCallback}});var F=bb;Object.defineProperty(e,"bindNodeCallback",{enumerable:!0,get:function(){return F.bindNodeCallback}});var M=wb;Object.defineProperty(e,"combineLatest",{enumerable:!0,get:function(){return M.combineLatest}});var j=Bb;Object.defineProperty(e,"concat",{enumerable:!0,get:function(){return j.concat}});var D=a_;Object.defineProperty(e,"connectable",{enumerable:!0,get:function(){return D.connectable}});var L=o_;Object.defineProperty(e,"defer",{enumerable:!0,get:function(){return L.defer}});var B=Yg;Object.defineProperty(e,"empty",{enumerable:!0,get:function(){return B.empty}});var q=f_;Object.defineProperty(e,"forkJoin",{enumerable:!0,get:function(){return q.forkJoin}});var U=ry;Object.defineProperty(e,"from",{enumerable:!0,get:function(){return U.from}});var z=__;Object.defineProperty(e,"fromEvent",{enumerable:!0,get:function(){return z.fromEvent}});var G=I_;Object.defineProperty(e,"fromEventPattern",{enumerable:!0,get:function(){return G.fromEventPattern}});var H=j_;Object.defineProperty(e,"generate",{enumerable:!0,get:function(){return H.generate}});var $=z_;Object.defineProperty(e,"iif",{enumerable:!0,get:function(){return $.iif}});var W=H_;Object.defineProperty(e,"interval",{enumerable:!0,get:function(){return W.interval}});var V=X_;Object.defineProperty(e,"merge",{enumerable:!0,get:function(){return V.merge}});var J=aw;Object.defineProperty(e,"never",{enumerable:!0,get:function(){return J.never}});var Y=Kg;Object.defineProperty(e,"of",{enumerable:!0,get:function(){return Y.of}});var K=ow;Object.defineProperty(e,"onErrorResumeNext",{enumerable:!0,get:function(){return K.onErrorResumeNext}});var Z=pw;Object.defineProperty(e,"pairs",{enumerable:!0,get:function(){return Z.pairs}});var X=mw;Object.defineProperty(e,"partition",{enumerable:!0,get:function(){return X.partition}});var Q=Sw;Object.defineProperty(e,"race",{enumerable:!0,get:function(){return Q.race}});var ee=Tw;Object.defineProperty(e,"range",{enumerable:!0,get:function(){return ee.range}});var te=Dv;Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return te.throwError}});var ne=$_;Object.defineProperty(e,"timer",{enumerable:!0,get:function(){return ne.timer}});var re=Iw;Object.defineProperty(e,"using",{enumerable:!0,get:function(){return re.using}});var ae=jw;Object.defineProperty(e,"zip",{enumerable:!0,get:function(){return ae.zip}});var oe=ay;Object.defineProperty(e,"scheduled",{enumerable:!0,get:function(){return oe.scheduled}});var ie=Yg;Object.defineProperty(e,"EMPTY",{enumerable:!0,get:function(){return ie.EMPTY}});var se=aw;Object.defineProperty(e,"NEVER",{enumerable:!0,get:function(){return se.NEVER}}),n($w,e);var le=Bh;Object.defineProperty(e,"config",{enumerable:!0,get:function(){return le.config}});var ce=Ww;Object.defineProperty(e,"audit",{enumerable:!0,get:function(){return ce.audit}});var de=Kw;Object.defineProperty(e,"auditTime",{enumerable:!0,get:function(){return de.auditTime}});var fe=ex;Object.defineProperty(e,"buffer",{enumerable:!0,get:function(){return fe.buffer}});var pe=ox;Object.defineProperty(e,"bufferCount",{enumerable:!0,get:function(){return pe.bufferCount}});var he=ux;Object.defineProperty(e,"bufferTime",{enumerable:!0,get:function(){return he.bufferTime}});var me=bx;Object.defineProperty(e,"bufferToggle",{enumerable:!0,get:function(){return me.bufferToggle}});var ge=Ax;Object.defineProperty(e,"bufferWhen",{enumerable:!0,get:function(){return ge.bufferWhen}});var ye=Ix;Object.defineProperty(e,"catchError",{enumerable:!0,get:function(){return ye.catchError}});var ve=jx;Object.defineProperty(e,"combineAll",{enumerable:!0,get:function(){return ve.combineAll}});var be=Dx;Object.defineProperty(e,"combineLatestAll",{enumerable:!0,get:function(){return be.combineLatestAll}});var _e=tS;Object.defineProperty(e,"combineLatestWith",{enumerable:!0,get:function(){return _e.combineLatestWith}});var we=qb;Object.defineProperty(e,"concatAll",{enumerable:!0,get:function(){return we.concatAll}});var xe=hS;Object.defineProperty(e,"concatMap",{enumerable:!0,get:function(){return xe.concatMap}});var Se=yS;Object.defineProperty(e,"concatMapTo",{enumerable:!0,get:function(){return Se.concatMapTo}});var Ee=_S;Object.defineProperty(e,"concatWith",{enumerable:!0,get:function(){return Ee.concatWith}});var ke=RS;Object.defineProperty(e,"connect",{enumerable:!0,get:function(){return ke.connect}});var Ce=BS;Object.defineProperty(e,"count",{enumerable:!0,get:function(){return Ce.count}});var Ae=US;Object.defineProperty(e,"debounce",{enumerable:!0,get:function(){return Ae.debounce}});var Oe=WS;Object.defineProperty(e,"debounceTime",{enumerable:!0,get:function(){return Oe.debounceTime}});var Te=KS;Object.defineProperty(e,"defaultIfEmpty",{enumerable:!0,get:function(){return Te.defaultIfEmpty}});var Ne=QS;Object.defineProperty(e,"delay",{enumerable:!0,get:function(){return Ne.delay}});var Re=eE;Object.defineProperty(e,"delayWhen",{enumerable:!0,get:function(){return Re.delayWhen}});var Ie=_E;Object.defineProperty(e,"dematerialize",{enumerable:!0,get:function(){return Ie.dematerialize}});var Pe=EE;Object.defineProperty(e,"distinct",{enumerable:!0,get:function(){return Pe.distinct}});var Fe=TE;Object.defineProperty(e,"distinctUntilChanged",{enumerable:!0,get:function(){return Fe.distinctUntilChanged}});var Me=FE;Object.defineProperty(e,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return Me.distinctUntilKeyChanged}});var je=jE;Object.defineProperty(e,"elementAt",{enumerable:!0,get:function(){return je.elementAt}});var De=VE;Object.defineProperty(e,"endWith",{enumerable:!0,get:function(){return De.endWith}});var Le=XE;Object.defineProperty(e,"every",{enumerable:!0,get:function(){return Le.every}});var Be=tk;Object.defineProperty(e,"exhaust",{enumerable:!0,get:function(){return Be.exhaust}});var qe=nk;Object.defineProperty(e,"exhaustAll",{enumerable:!0,get:function(){return qe.exhaustAll}});var Ue=rk;Object.defineProperty(e,"exhaustMap",{enumerable:!0,get:function(){return Ue.exhaustMap}});var ze=uk;Object.defineProperty(e,"expand",{enumerable:!0,get:function(){return ze.expand}});var Ge=yw;Object.defineProperty(e,"filter",{enumerable:!0,get:function(){return Ge.filter}});var He=pk;Object.defineProperty(e,"finalize",{enumerable:!0,get:function(){return He.finalize}});var $e=mk;Object.defineProperty(e,"find",{enumerable:!0,get:function(){return $e.find}});var We=bk;Object.defineProperty(e,"findIndex",{enumerable:!0,get:function(){return We.findIndex}});var Ve=xk;Object.defineProperty(e,"first",{enumerable:!0,get:function(){return Ve.first}});var Je=Tk;Object.defineProperty(e,"groupBy",{enumerable:!0,get:function(){return Je.groupBy}});var Ye=oE;Object.defineProperty(e,"ignoreElements",{enumerable:!0,get:function(){return Ye.ignoreElements}});var Ke=Mk;Object.defineProperty(e,"isEmpty",{enumerable:!0,get:function(){return Ke.isEmpty}});var Ze=Lk;Object.defineProperty(e,"last",{enumerable:!0,get:function(){return Ze.last}});var Xe=rb;Object.defineProperty(e,"map",{enumerable:!0,get:function(){return Xe.map}});var Qe=cE;Object.defineProperty(e,"mapTo",{enumerable:!0,get:function(){return Qe.mapTo}});var et=Kk;Object.defineProperty(e,"materialize",{enumerable:!0,get:function(){return et.materialize}});var tt=eC;Object.defineProperty(e,"max",{enumerable:!0,get:function(){return tt.max}});var nt=Ub;Object.defineProperty(e,"mergeAll",{enumerable:!0,get:function(){return nt.mergeAll}});var rt=rC;Object.defineProperty(e,"flatMap",{enumerable:!0,get:function(){return rt.flatMap}});var at=zb;Object.defineProperty(e,"mergeMap",{enumerable:!0,get:function(){return at.mergeMap}});var ot=aC;Object.defineProperty(e,"mergeMapTo",{enumerable:!0,get:function(){return ot.mergeMapTo}});var it=sC;Object.defineProperty(e,"mergeScan",{enumerable:!0,get:function(){return it.mergeScan}});var st=uC;Object.defineProperty(e,"mergeWith",{enumerable:!0,get:function(){return st.mergeWith}});var lt=xC;Object.defineProperty(e,"min",{enumerable:!0,get:function(){return lt.min}});var ct=kC;Object.defineProperty(e,"multicast",{enumerable:!0,get:function(){return ct.multicast}});var ut=Vy;Object.defineProperty(e,"observeOn",{enumerable:!0,get:function(){return ut.observeOn}});var dt=TC;Object.defineProperty(e,"onErrorResumeNextWith",{enumerable:!0,get:function(){return dt.onErrorResumeNextWith}});var ft=MC;Object.defineProperty(e,"pairwise",{enumerable:!0,get:function(){return ft.pairwise}});var pt=LC;Object.defineProperty(e,"pluck",{enumerable:!0,get:function(){return pt.pluck}});var ht=qC;Object.defineProperty(e,"publish",{enumerable:!0,get:function(){return ht.publish}});var mt=HC;Object.defineProperty(e,"publishBehavior",{enumerable:!0,get:function(){return mt.publishBehavior}});var gt=VC;Object.defineProperty(e,"publishLast",{enumerable:!0,get:function(){return gt.publishLast}});var yt=KC;Object.defineProperty(e,"publishReplay",{enumerable:!0,get:function(){return yt.publishReplay}});var vt=eA;Object.defineProperty(e,"raceWith",{enumerable:!0,get:function(){return vt.raceWith}});var bt=qx;Object.defineProperty(e,"reduce",{enumerable:!0,get:function(){return bt.reduce}});var _t=iA;Object.defineProperty(e,"repeat",{enumerable:!0,get:function(){return _t.repeat}});var wt=fA;Object.defineProperty(e,"repeatWhen",{enumerable:!0,get:function(){return wt.repeatWhen}});var xt=yA;Object.defineProperty(e,"retry",{enumerable:!0,get:function(){return xt.retry}});var St=SA;Object.defineProperty(e,"retryWhen",{enumerable:!0,get:function(){return St.retryWhen}});var Et=dm;Object.defineProperty(e,"refCount",{enumerable:!0,get:function(){return Et.refCount}});var kt=OA;Object.defineProperty(e,"sample",{enumerable:!0,get:function(){return kt.sample}});var Ct=PA;Object.defineProperty(e,"sampleTime",{enumerable:!0,get:function(){return Ct.sampleTime}});var At=DA;Object.defineProperty(e,"scan",{enumerable:!0,get:function(){return At.scan}});var Ot=qA;Object.defineProperty(e,"sequenceEqual",{enumerable:!0,get:function(){return Ot.sequenceEqual}});var Tt=HA;Object.defineProperty(e,"share",{enumerable:!0,get:function(){return Tt.share}});var Nt=XA;Object.defineProperty(e,"shareReplay",{enumerable:!0,get:function(){return Nt.shareReplay}});var Rt=tO;Object.defineProperty(e,"single",{enumerable:!0,get:function(){return Rt.single}});var It=sO;Object.defineProperty(e,"skip",{enumerable:!0,get:function(){return It.skip}});var Pt=cO;Object.defineProperty(e,"skipLast",{enumerable:!0,get:function(){return Pt.skipLast}});var Ft=pO;Object.defineProperty(e,"skipUntil",{enumerable:!0,get:function(){return Ft.skipUntil}});var Mt=vO;Object.defineProperty(e,"skipWhile",{enumerable:!0,get:function(){return Mt.skipWhile}});var jt=wO;Object.defineProperty(e,"startWith",{enumerable:!0,get:function(){return jt.startWith}});var Dt=Xy;Object.defineProperty(e,"subscribeOn",{enumerable:!0,get:function(){return Dt.subscribeOn}});var Lt=kO;Object.defineProperty(e,"switchAll",{enumerable:!0,get:function(){return Lt.switchAll}});var Bt=CO;Object.defineProperty(e,"switchMap",{enumerable:!0,get:function(){return Bt.switchMap}});var qt=IO;Object.defineProperty(e,"switchMapTo",{enumerable:!0,get:function(){return qt.switchMapTo}});var Ut=MO;Object.defineProperty(e,"switchScan",{enumerable:!0,get:function(){return Ut.switchScan}});var zt=tE;Object.defineProperty(e,"take",{enumerable:!0,get:function(){return zt.take}});var Gt=Bk;Object.defineProperty(e,"takeLast",{enumerable:!0,get:function(){return Gt.takeLast}});var Ht=LO;Object.defineProperty(e,"takeUntil",{enumerable:!0,get:function(){return Ht.takeUntil}});var $t=GO;Object.defineProperty(e,"takeWhile",{enumerable:!0,get:function(){return $t.takeWhile}});var Wt=WO;Object.defineProperty(e,"tap",{enumerable:!0,get:function(){return Wt.tap}});var Vt=ZO;Object.defineProperty(e,"throttle",{enumerable:!0,get:function(){return Vt.throttle}});var Jt=tT;Object.defineProperty(e,"throttleTime",{enumerable:!0,get:function(){return Jt.throttleTime}});var Yt=DE;Object.defineProperty(e,"throwIfEmpty",{enumerable:!0,get:function(){return Yt.throwIfEmpty}});var Kt=oT;Object.defineProperty(e,"timeInterval",{enumerable:!0,get:function(){return Kt.timeInterval}});var Zt=Xv;Object.defineProperty(e,"timeout",{enumerable:!0,get:function(){return Zt.timeout}});var Xt=uT;Object.defineProperty(e,"timeoutWith",{enumerable:!0,get:function(){return Xt.timeoutWith}});var Qt=hT;Object.defineProperty(e,"timestamp",{enumerable:!0,get:function(){return Qt.timestamp}});var en=Bx;Object.defineProperty(e,"toArray",{enumerable:!0,get:function(){return en.toArray}});var tn=yT;Object.defineProperty(e,"window",{enumerable:!0,get:function(){return tn.window}});var nn=ST;Object.defineProperty(e,"windowCount",{enumerable:!0,get:function(){return nn.windowCount}});var rn=OT;Object.defineProperty(e,"windowTime",{enumerable:!0,get:function(){return rn.windowTime}});var an=DT;Object.defineProperty(e,"windowToggle",{enumerable:!0,get:function(){return an.windowToggle}});var on=WT;Object.defineProperty(e,"windowWhen",{enumerable:!0,get:function(){return on.windowWhen}});var sn=ZT;Object.defineProperty(e,"withLatestFrom",{enumerable:!0,get:function(){return sn.withLatestFrom}});var ln=iN;Object.defineProperty(e,"zipAll",{enumerable:!0,get:function(){return ln.zipAll}});var cn=cN;Object.defineProperty(e,"zipWith",{enumerable:!0,get:function(){return cn.zipWith}})}(Sh),Object.defineProperty(xh,"__esModule",{value:!0});var vN=xh.checkAbortSignal=xN;xh.abortBreakPoint=function(e){return EN.apply(this,arguments)},xh.makeAbortError=kN,xh.observeAbortSignal=function(e){return e?(0,_N.fromEvent)(e,"abort"):new _N.Observable};var bN=xh.isAbortException=function(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))},_N=Sh,wN=function(e){Te(n,e);var t=De(n);function n(){return ke(this,n),t.apply(this,arguments)}return Ae(n)}(Fe(Error));function xN(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw kN()}}function SN(e){return new Promise((function(t){return setTimeout(t,e)}))}function EN(){return(EN=Ee(we().mark((function e(t){return we().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,SN(1);case 2:xN(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kN(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");var e=new wN("aborted");return e.code="ERR_ABORTED",e}var CN={exports:{}};!function(e,t){var n;n=function(){return function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){if(!s&&fe)return fe(i);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(e){return a(t[i][1][e]||e)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var o=fe,i=0;i<r.length;i++)a(r[i]);return a}({"./aesprim":[function(e,t,n){var r;r=function(e){var t,n,r,a,o,i,s,l,c,u,d,f,p,h,m,g,y,v;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function _(e){return e>=48&&e<=57}function w(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function x(e){return"01234567".indexOf(e)>=0}function S(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function E(e){return 10===e||13===e||8232===e||8233===e}function k(e){return 64==e||36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function C(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function A(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function O(e){return"eval"===e||"arguments"===e}function T(e,t,n,r,a){var o;b("number"==typeof n,"Comment must have valid position"),y.lastCommentStart>=n||(y.lastCommentStart=n,o={type:e,value:t},v.range&&(o.range=[n,r]),v.loc&&(o.loc=a),v.comments.push(o),v.attachComment&&(v.leadingComments.push(o),v.trailingComments.push(o)))}function N(e){var t,n,r,a;for(t=d-e,n={start:{line:f,column:d-p-e}};d<h;)if(r=c.charCodeAt(d),++d,E(r))return v.comments&&(a=c.slice(t+e,d-1),n.end={line:f,column:d-p-1},T("Line",a,t,d-1,n)),13===r&&10===c.charCodeAt(d)&&++d,++f,void(p=d);v.comments&&(a=c.slice(t+e,d),n.end={line:f,column:d-p},T("Line",a,t,d,n))}function R(){var e,t,n,r;for(v.comments&&(e=d-2,t={start:{line:f,column:d-p-2}});d<h;)if(E(n=c.charCodeAt(d)))13===n&&10===c.charCodeAt(d+1)&&++d,++f,++d,p=d,d>=h&&W({},i.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(d+1))return++d,++d,void(v.comments&&(r=c.slice(e+2,d-2),t.end={line:f,column:d-p},T("Block",r,e,d,t)));++d}else++d;W({},i.UnexpectedToken,"ILLEGAL")}function I(){var e,t;for(t=0===d;d<h;)if(S(e=c.charCodeAt(d)))++d;else if(E(e))++d,13===e&&10===c.charCodeAt(d)&&++d,++f,p=d,t=!0;else if(47===e)if(47===(e=c.charCodeAt(d+1)))++d,++d,N(2),t=!0;else{if(42!==e)break;++d,++d,R()}else if(t&&45===e){if(45!==c.charCodeAt(d+1)||62!==c.charCodeAt(d+2))break;d+=3,N(3)}else{if(60!==e)break;if("!--"!==c.slice(d+1,d+4))break;++d,++d,++d,++d,N(4)}}function P(e){var t,n,r,a=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(d<h&&w(c[d])))return"";r=c[d++],a=16*a+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(a)}function F(){var e,t;for(e=c.charCodeAt(d++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(d)&&W({},i.UnexpectedToken,"ILLEGAL"),++d,(e=P("u"))&&"\\"!==e&&k(e.charCodeAt(0))||W({},i.UnexpectedToken,"ILLEGAL"),t=e);d<h&&C(e=c.charCodeAt(d));)++d,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(d)&&W({},i.UnexpectedToken,"ILLEGAL"),++d,(e=P("u"))&&"\\"!==e&&C(e.charCodeAt(0))||W({},i.UnexpectedToken,"ILLEGAL"),t+=e);return t}function M(){var e,n,r,a,o=d,s=c.charCodeAt(d),l=c[d];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++d,v.tokenize&&(40===s?v.openParenToken=v.tokens.length:123===s&&(v.openCurlyToken=v.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:f,lineStart:p,start:o,end:d};default:if(61===(e=c.charCodeAt(d+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return d+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:f,lineStart:p,start:o,end:d};case 33:case 61:return 61===c.charCodeAt(d+=2)&&++d,{type:t.Punctuator,value:c.slice(o,d),lineNumber:f,lineStart:p,start:o,end:d}}}return">>>="===(a=c.substr(d,4))?{type:t.Punctuator,value:a,lineNumber:f,lineStart:p,start:o,end:d+=4}:">>>"===(r=a.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:f,lineStart:p,start:o,end:d+=3}:l===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(l)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:f,lineStart:p,start:o,end:d+=2}:"<>=!+-*%&|^/".indexOf(l)>=0?(++d,{type:t.Punctuator,value:l,lineNumber:f,lineStart:p,start:o,end:d}):void W({},i.UnexpectedToken,"ILLEGAL")}function j(){var e,n,r;if(b(_((r=c[d]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=d,e="","."!==r){if(e=c[d++],r=c[d],"0"===e){if("x"===r||"X"===r)return++d,function(e){for(var n="";d<h&&w(c[d]);)n+=c[d++];return 0===n.length&&W({},i.UnexpectedToken,"ILLEGAL"),k(c.charCodeAt(d))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:f,lineStart:p,start:e,end:d}}(n);if(x(r))return function(e){for(var n="0"+c[d++];d<h&&x(c[d]);)n+=c[d++];return(k(c.charCodeAt(d))||_(c.charCodeAt(d)))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:f,lineStart:p,start:e,end:d}}(n);r&&_(r.charCodeAt(0))&&W({},i.UnexpectedToken,"ILLEGAL")}for(;_(c.charCodeAt(d));)e+=c[d++];r=c[d]}if("."===r){for(e+=c[d++];_(c.charCodeAt(d));)e+=c[d++];r=c[d]}if("e"===r||"E"===r)if(e+=c[d++],"+"!==(r=c[d])&&"-"!==r||(e+=c[d++]),_(c.charCodeAt(d)))for(;_(c.charCodeAt(d));)e+=c[d++];else W({},i.UnexpectedToken,"ILLEGAL");return k(c.charCodeAt(d))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:f,lineStart:p,start:n,end:d}}function D(){var e,n,r,a;return g=null,I(),e=d,n=function(){var e,t,n,r;for(b("/"===(e=c[d]),"Regular expression literal must start with a slash"),t=c[d++],n=!1,r=!1;d<h;)if(t+=e=c[d++],"\\"===e)E((e=c[d++]).charCodeAt(0))&&W({},i.UnterminatedRegExp),t+=e;else if(E(e.charCodeAt(0)))W({},i.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||W({},i.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";d<h&&C((e=c[d]).charCodeAt(0));)if(++d,"\\"===e&&d<h)if("u"===(e=c[d])){if(r=++d,e=P("u"))for(n+=e,t+="\\u";r<d;++r)t+=c[r];else d=r,n+="u",t+="\\u";V({},i.UnexpectedToken,"ILLEGAL")}else t+="\\",V({},i.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),a=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){W({},i.InvalidRegExp)}return n}(n.value,r.value),v.tokenize?{type:t.RegularExpression,value:a,lineNumber:f,lineStart:p,start:e,end:d}:{literal:n.literal+r.literal,value:a,start:e,end:d}}function L(){var e,t,n,r;return I(),e=d,t={start:{line:f,column:d-p}},n=D(),t.end={line:f,column:d-p},v.tokenize||(v.tokens.length>0&&(r=v.tokens[v.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||v.tokens.pop()),v.tokens.push({type:"RegularExpression",value:n.literal,range:[e,d],loc:t})),n}function B(){var e,n,a;return I(),d>=h?{type:t.EOF,lineNumber:f,lineStart:p,start:d,end:d}:k(e=c.charCodeAt(d))?(n=d,a=92===c.charCodeAt(d)?F():function(){var e,t;for(e=d++;d<h;){if(92===(t=c.charCodeAt(d)))return d=e,F();if(!C(t))break;++d}return c.slice(e,d)}(),{type:1===a.length?t.Identifier:function(e){if(u&&A(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(a)?t.Keyword:"null"===a?t.NullLiteral:"true"===a||"false"===a?t.BooleanLiteral:t.Identifier,value:a,lineNumber:f,lineStart:p,start:n,end:d}):40===e||41===e||59===e?M():39===e||34===e?function(){var e,n,r,a,o,s,l,u,m="",g=!1;for(l=f,u=p,b("'"===(e=c[d])||'"'===e,"String literal must starts with a quote"),n=d,++d;d<h;){if((r=c[d++])===e){e="";break}if("\\"===r)if((r=c[d++])&&E(r.charCodeAt(0)))++f,"\r"===r&&"\n"===c[d]&&++d,p=d;else switch(r){case"u":case"x":s=d,(o=P(r))?m+=o:(d=s,m+=r);break;case"n":m+="\n";break;case"r":m+="\r";break;case"t":m+="\t";break;case"b":m+="\b";break;case"f":m+="\f";break;case"v":m+="\v";break;default:x(r)?(0!==(a="01234567".indexOf(r))&&(g=!0),d<h&&x(c[d])&&(g=!0,a=8*a+"01234567".indexOf(c[d++]),"0123".indexOf(r)>=0&&d<h&&x(c[d])&&(a=8*a+"01234567".indexOf(c[d++]))),m+=String.fromCharCode(a)):m+=r}else{if(E(r.charCodeAt(0)))break;m+=r}}return""!==e&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:m,octal:g,startLineNumber:l,startLineStart:u,lineNumber:f,lineStart:p,start:n,end:d}}():46===e?_(c.charCodeAt(d+1))?j():M():_(e)?j():v.tokenize&&47===e?function(){var e,t;if(!(e=v.tokens[v.tokens.length-1]))return L();if("Punctuator"===e.type){if("]"===e.value)return M();if(")"===e.value)return!(t=v.tokens[v.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?M():L();if("}"===e.value){if(v.tokens[v.openCurlyToken-3]&&"Keyword"===v.tokens[v.openCurlyToken-3].type){if(!(t=v.tokens[v.openCurlyToken-4]))return M()}else{if(!v.tokens[v.openCurlyToken-4]||"Keyword"!==v.tokens[v.openCurlyToken-4].type)return M();if(!(t=v.tokens[v.openCurlyToken-5]))return L()}return r.indexOf(t.value)>=0?M():L()}return L()}return"Keyword"===e.type?L():M()}():M()}function q(){var e,r,a;return I(),e={start:{line:f,column:d-p}},r=B(),e.end={line:f,column:d-p},r.type!==t.EOF&&(a=c.slice(r.start,r.end),v.tokens.push({type:n[r.type],value:a,range:[r.start,r.end],loc:e})),r}function U(){var e;return d=(e=g).end,f=e.lineNumber,p=e.lineStart,g=void 0!==v.tokens?q():B(),d=e.end,f=e.lineNumber,p=e.lineStart,e}function z(){var e,t,n;e=d,t=f,n=p,g=void 0!==v.tokens?q():B(),d=e,f=t,p=n}function G(e,t){this.line=e,this.column=t}function H(e,t,n,r){this.start=new G(e,t),this.end=new G(n,r)}function $(){var e,t,n,r;return e=d,t=f,n=p,I(),r=f!==t,d=e,f=t,p=n,r}function W(e,t){var n,r=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+a)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-p+1):((n=new Error("Line "+f+": "+a)).index=d,n.lineNumber=f,n.column=d-p+1),n.description=a,n}function V(){try{W.apply(null,arguments)}catch(e){if(!v.errors)throw e;v.errors.push(e)}}function J(e){if(e.type===t.EOF&&W(e,i.UnexpectedEOS),e.type===t.NumericLiteral&&W(e,i.UnexpectedNumber),e.type===t.StringLiteral&&W(e,i.UnexpectedString),e.type===t.Identifier&&W(e,i.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))W(e,i.UnexpectedReserved);else if(u&&A(e.value))return void V(e,i.StrictReservedWord);W(e,i.UnexpectedToken,e.value)}W(e,i.UnexpectedToken,e.value)}function Y(e){var n=U();n.type===t.Punctuator&&n.value===e||J(n)}function K(e){var n=U();n.type===t.Keyword&&n.value===e||J(n)}function Z(e){return g.type===t.Punctuator&&g.value===e}function X(e){return g.type===t.Keyword&&g.value===e}function Q(){var e;59===c.charCodeAt(d)||Z(";")?U():(e=f,I(),f===e&&(g.type===t.EOF||Z("}")||J(g)))}function ee(e){return e.type===a.Identifier||e.type===a.MemberExpression}function te(e,t){var n,r,a;return n=u,a=g,r=_e(),t&&u&&O(e[0].name)&&V(t,i.StrictParamName),u=n,m.markEnd(m.createFunctionExpression(null,e,[],r),a)}function ne(){var e,n;return n=g,(e=U()).type===t.StringLiteral||e.type===t.NumericLiteral?(u&&e.octal&&V(e,i.StrictOctalLiteral),m.markEnd(m.createLiteral(e),n)):m.markEnd(m.createIdentifier(e.value),n)}function re(){var e,n,r,a,o,s;return s=g,(e=g).type===t.Identifier?(r=ne(),"get"!==e.value||Z(":")?"set"!==e.value||Z(":")?(Y(":"),a=fe(),m.markEnd(m.createProperty("init",r,a),s)):(n=ne(),Y("("),(e=g).type!==t.Identifier?(Y(")"),V(e,i.UnexpectedToken,e.value),a=te([])):(o=[me()],Y(")"),a=te(o,e)),m.markEnd(m.createProperty("set",n,a),s)):(n=ne(),Y("("),Y(")"),a=te([]),m.markEnd(m.createProperty("get",n,a),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=ne(),Y(":"),a=fe(),m.markEnd(m.createProperty("init",n,a),s)):void J(e)}function ae(){var e,n,r,s;if(Z("("))return function(){var e;return Y("("),e=pe(),Y(")"),e}();if(Z("["))return function(){var e,t=[];for(e=g,Y("[");!Z("]");)Z(",")?(U(),t.push(null)):(t.push(fe()),Z("]")||Y(","));return U(),m.markEnd(m.createArrayExpression(t),e)}();if(Z("{"))return function(){var e,t,n,r,s,l=[],c={},d=String;for(s=g,Y("{");!Z("}");)t=(e=re()).key.type===a.Identifier?e.key.name:d(e.key.value),r="init"===e.kind?o.Data:"get"===e.kind?o.Get:o.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===o.Data?u&&r===o.Data?V({},i.StrictDuplicateProperty):r!==o.Data&&V({},i.AccessorDataProperty):r===o.Data?V({},i.AccessorDataProperty):c[n]&r&&V({},i.AccessorGetSet),c[n]|=r):c[n]=r,l.push(e),Z("}")||Y(",");return Y("}"),m.markEnd(m.createObjectExpression(l),s)}();if(s=g,(e=g.type)===t.Identifier)r=m.createIdentifier(U().value);else if(e===t.StringLiteral||e===t.NumericLiteral)u&&g.octal&&V(g,i.StrictOctalLiteral),r=m.createLiteral(U());else if(e===t.Keyword){if(X("function"))return function(){var e,t,n,r,a,o,s,l,c,d=null;return l=g,K("function"),Z("(")||(e=g,d=me(),u?O(e.value)&&V(e,i.StrictFunctionName):O(e.value)?(n=e,r=i.StrictFunctionName):A(e.value)&&(n=e,r=i.StrictReservedWord)),c=(a=we(n)).params,t=a.stricted,n=a.firstRestricted,a.message&&(r=a.message),s=u,o=_e(),u&&n&&W(n,r),u&&t&&V(t,r),u=s,m.markEnd(m.createFunctionExpression(d,c,[],o),l)}();X("this")?(U(),r=m.createThisExpression()):J(U())}else e===t.BooleanLiteral?((n=U()).value="true"===n.value,r=m.createLiteral(n)):e===t.NullLiteral?((n=U()).value=null,r=m.createLiteral(n)):Z("/")||Z("/=")?(r=m.createLiteral(void 0!==v.tokens?L():D()),z()):J(U());return m.markEnd(r,s)}function oe(){var e=[];if(Y("("),!Z(")"))for(;d<h&&(e.push(fe()),!Z(")"));)Y(",");return Y(")"),e}function ie(){return Y("."),function(){var e,n;return n=g,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=U())||J(e),m.markEnd(m.createIdentifier(e.value),n)}()}function se(){var e;return Y("["),e=pe(),Y("]"),e}function le(){var e,t,n;return n=g,K("new"),e=function(){var e,t,n,r;for(r=g,e=y.allowIn,t=X("new")?le():ae(),y.allowIn=e;Z(".")||Z("[");)Z("[")?(n=se(),t=m.createMemberExpression("[",t,n)):(n=ie(),t=m.createMemberExpression(".",t,n)),m.markEnd(t,r);return t}(),t=Z("(")?oe():[],m.markEnd(m.createNewExpression(e,t),n)}function ce(){var e,n,r=g;return e=function(){var e,t,n,r,a;for(a=g,e=y.allowIn,y.allowIn=!0,t=X("new")?le():ae(),y.allowIn=e;;){if(Z("."))r=ie(),t=m.createMemberExpression(".",t,r);else if(Z("("))n=oe(),t=m.createCallExpression(t,n);else{if(!Z("["))break;r=se(),t=m.createMemberExpression("[",t,r)}m.markEnd(t,a)}return t}(),g.type===t.Punctuator&&(!Z("++")&&!Z("--")||$()||(u&&e.type===a.Identifier&&O(e.name)&&V({},i.StrictLHSPostfix),ee(e)||V({},i.InvalidLHSInAssignment),n=U(),e=m.markEnd(m.createPostfixExpression(n.value,e),r))),e}function ue(){var e,n,r;return g.type!==t.Punctuator&&g.type!==t.Keyword?n=ce():Z("++")||Z("--")?(r=g,e=U(),n=ue(),u&&n.type===a.Identifier&&O(n.name)&&V({},i.StrictLHSPrefix),ee(n)||V({},i.InvalidLHSInAssignment),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):Z("+")||Z("-")||Z("~")||Z("!")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):X("delete")||X("void")||X("typeof")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r),u&&"delete"===n.operator&&n.argument.type===a.Identifier&&V({},i.StrictDelete)):n=ce(),n}function de(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function fe(){var e,n,r,o,s,l;return e=g,s=g,o=n=function(){var e,t,n,r,a;return a=g,e=function(){var e,t,n,r,a,o,i,s,l,c;if(e=g,l=ue(),0===(a=de(r=g,y.allowIn)))return l;for(r.prec=a,U(),t=[e,g],o=[l,r,i=ue()];(a=de(g,y.allowIn))>0;){for(;o.length>2&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,l=o.pop(),n=m.createBinaryExpression(s,l,i),t.pop(),m.markEnd(n,e=t[t.length-1]),o.push(n);(r=U()).prec=a,o.push(r),t.push(g),n=ue(),o.push(n)}for(n=o[c=o.length-1],t.pop();c>1;)n=m.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,e=t.pop(),m.markEnd(n,e);return n}(),Z("?")&&(U(),t=y.allowIn,y.allowIn=!0,n=fe(),y.allowIn=t,Y(":"),r=fe(),e=m.createConditionalExpression(e,n,r),m.markEnd(e,a)),e}(),g.type!==t.Punctuator||"="!==(l=g.value)&&"*="!==l&&"/="!==l&&"%="!==l&&"+="!==l&&"-="!==l&&"<<="!==l&&">>="!==l&&">>>="!==l&&"&="!==l&&"^="!==l&&"|="!==l||(ee(n)||V({},i.InvalidLHSInAssignment),u&&n.type===a.Identifier&&O(n.name)&&V(e,i.StrictLHSAssignment),e=U(),r=fe(),o=m.markEnd(m.createAssignmentExpression(e.value,n,r),s)),o}function pe(){var e,t=g;if(e=fe(),Z(",")){for(e=m.createSequenceExpression([e]);d<h&&Z(",");)U(),e.expressions.push(fe());m.markEnd(e,t)}return e}function he(){var e,t;return t=g,Y("{"),e=function(){for(var e,t=[];d<h&&!Z("}")&&void 0!==(e=Se());)t.push(e);return t}(),Y("}"),m.markEnd(m.createBlockStatement(e),t)}function me(){var e,n;return n=g,(e=U()).type!==t.Identifier&&J(e),m.markEnd(m.createIdentifier(e.value),n)}function ge(e){var t,n,r=null;return n=g,t=me(),u&&O(t.name)&&V({},i.StrictVarName),"const"===e?(Y("="),r=fe()):Z("=")&&(U(),r=fe()),m.markEnd(m.createVariableDeclarator(t,r),n)}function ye(e){var t=[];do{if(t.push(ge(e)),!Z(","))break;U()}while(d<h);return t}function ve(){var e,t,n,r=[];for(n=g,X("default")?(U(),e=null):(K("case"),e=pe()),Y(":");d<h&&!(Z("}")||X("default")||X("case"));)t=be(),r.push(t);return m.markEnd(m.createSwitchCase(e,r),n)}function be(){var e,n,r,o,s,l,f,p,v,b,_=g.type;if(_===t.EOF&&J(g),_===t.Punctuator&&"{"===g.value)return he();if(o=g,_===t.Punctuator)switch(g.value){case";":return m.markEnd((Y(";"),m.createEmptyStatement()),o);case"(":return m.markEnd(function(){var e=pe();return Q(),m.createExpressionStatement(e)}(),o)}if(_===t.Keyword)switch(g.value){case"break":return m.markEnd((b=null,K("break"),59===c.charCodeAt(d)?(U(),y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(null)):$()?(y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(null)):(g.type===t.Identifier&&(b=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+b.name)||W({},i.UnknownLabel,b.name)),Q(),null!==b||y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(b))),o);case"continue":return m.markEnd(function(){var e=null;return K("continue"),59===c.charCodeAt(d)?(U(),y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(null)):$()?(y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(null)):(g.type===t.Identifier&&(e=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+e.name)||W({},i.UnknownLabel,e.name)),Q(),null!==e||y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(e))}(),o);case"debugger":return m.markEnd((K("debugger"),Q(),m.createDebuggerStatement()),o);case"do":return m.markEnd((K("do"),v=y.inIteration,y.inIteration=!0,f=be(),y.inIteration=v,K("while"),Y("("),p=pe(),Y(")"),Z(";")&&U(),m.createDoWhileStatement(f,p)),o);case"for":return m.markEnd(function(){var e,t,n,r,a,o,s;return e=t=n=null,K("for"),Y("("),Z(";")?U():(X("var")||X("let")?(y.allowIn=!1,e=function(){var e,t,n;return n=g,e=U(),t=ye(),m.markEnd(m.createVariableDeclaration(t,e.value),n)}(),y.allowIn=!0,1===e.declarations.length&&X("in")&&(U(),r=e,a=pe(),e=null)):(y.allowIn=!1,e=pe(),y.allowIn=!0,X("in")&&(ee(e)||V({},i.InvalidLHSInForIn),U(),r=e,a=pe(),e=null)),void 0===r&&Y(";")),void 0===r&&(Z(";")||(t=pe()),Y(";"),Z(")")||(n=pe())),Y(")"),s=y.inIteration,y.inIteration=!0,o=be(),y.inIteration=s,void 0===r?m.createForStatement(e,t,n,o):m.createForInStatement(r,a,o)}(),o);case"function":return m.markEnd(xe(),o);case"if":return m.markEnd(function(){var e,t,n;return K("if"),Y("("),e=pe(),Y(")"),t=be(),X("else")?(U(),n=be()):n=null,m.createIfStatement(e,t,n)}(),o);case"return":return m.markEnd((l=null,K("return"),y.inFunctionBody||V({},i.IllegalReturn),32===c.charCodeAt(d)&&k(c.charCodeAt(d+1))?(l=pe(),Q(),m.createReturnStatement(l)):$()?m.createReturnStatement(null):(Z(";")||Z("}")||g.type===t.EOF||(l=pe()),Q(),m.createReturnStatement(l))),o);case"switch":return m.markEnd(function(){var e,t,n,r,a;if(K("switch"),Y("("),e=pe(),Y(")"),Y("{"),t=[],Z("}"))return U(),m.createSwitchStatement(e,t);for(r=y.inSwitch,y.inSwitch=!0,a=!1;d<h&&!Z("}");)null===(n=ve()).test&&(a&&W({},i.MultipleDefaultsInSwitch),a=!0),t.push(n);return y.inSwitch=r,Y("}"),m.createSwitchStatement(e,t)}(),o);case"throw":return m.markEnd(function(){var e;return K("throw"),$()&&W({},i.NewlineAfterThrow),e=pe(),Q(),m.createThrowStatement(e)}(),o);case"try":return m.markEnd(function(){var e,t,n,r,a=[],o=null;return K("try"),e=he(),X("catch")&&a.push((r=g,K("catch"),Y("("),Z(")")&&J(g),t=me(),u&&O(t.name)&&V({},i.StrictCatchVariable),Y(")"),n=he(),m.markEnd(m.createCatchClause(t,n),r))),X("finally")&&(U(),o=he()),0!==a.length||o||W({},i.NoCatchOrFinally),m.createTryStatement(e,[],a,o)}(),o);case"var":return m.markEnd((K("var"),s=ye(),Q(),m.createVariableDeclaration(s,"var")),o);case"while":return m.markEnd(function(){var e,t,n;return K("while"),Y("("),e=pe(),Y(")"),n=y.inIteration,y.inIteration=!0,t=be(),y.inIteration=n,m.createWhileStatement(e,t)}(),o);case"with":return m.markEnd(function(){var e,t;return u&&(I(),V({},i.StrictModeWith)),K("with"),Y("("),e=pe(),Y(")"),t=be(),m.createWithStatement(e,t)}(),o)}return(e=pe()).type===a.Identifier&&Z(":")?(U(),r="$"+e.name,Object.prototype.hasOwnProperty.call(y.labelSet,r)&&W({},i.Redeclaration,"Label",e.name),y.labelSet[r]=!0,n=be(),delete y.labelSet[r],m.markEnd(m.createLabeledStatement(e,n),o)):(Q(),m.markEnd(m.createExpressionStatement(e),o))}function _e(){var e,n,r,o,s,l,f,p,v=[];for(p=g,Y("{");d<h&&g.type===t.StringLiteral&&(n=g,e=Se(),v.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&V(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(o=y.labelSet,s=y.inIteration,l=y.inSwitch,f=y.inFunctionBody,y.labelSet={},y.inIteration=!1,y.inSwitch=!1,y.inFunctionBody=!0;d<h&&!Z("}")&&void 0!==(e=Se());)v.push(e);return Y("}"),y.labelSet=o,y.inIteration=s,y.inSwitch=l,y.inFunctionBody=f,m.markEnd(m.createBlockStatement(v),p)}function we(e){var t,n,r,a,o,s,l=[];if(Y("("),!Z(")"))for(a={};d<h&&(n=g,t=me(),o="$"+n.value,u?(O(n.value)&&(r=n,s=i.StrictParamName),Object.prototype.hasOwnProperty.call(a,o)&&(r=n,s=i.StrictParamDupe)):e||(O(n.value)?(e=n,s=i.StrictParamName):A(n.value)?(e=n,s=i.StrictReservedWord):Object.prototype.hasOwnProperty.call(a,o)&&(e=n,s=i.StrictParamDupe)),l.push(t),a[o]=!0,!Z(")"));)Y(",");return Y(")"),{params:l,stricted:r,firstRestricted:e,message:s}}function xe(){var e,t,n,r,a,o,s,l,c,d;return d=g,K("function"),r=g,e=me(),u?O(r.value)&&V(r,i.StrictFunctionName):O(r.value)?(s=r,l=i.StrictFunctionName):A(r.value)&&(s=r,l=i.StrictReservedWord),t=(o=we(s)).params,a=o.stricted,s=o.firstRestricted,o.message&&(l=o.message),c=u,n=_e(),u&&s&&W(s,l),u&&a&&V(a,l),u=c,m.markEnd(m.createFunctionDeclaration(e,t,[],n),d)}function Se(){if(g.type===t.Keyword)switch(g.value){case"const":case"let":return r=g,K(e=g.value),n=ye(e),Q(),m.markEnd(m.createVariableDeclaration(n,e),r);case"function":return xe();default:return be()}var e,n,r;if(g.type!==t.EOF)return be()}function Ee(){var e,t,n,r=[];for(e=0;e<v.tokens.length;++e)n={type:(t=v.tokens[e]).type,value:t.value},v.range&&(n.range=t.range),v.loc&&(n.loc=t.loc),r.push(n);v.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],a={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},o={Data:1,Get:2,Set:4},i={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},l={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===a.Program&&e.body.length>0)){for(v.trailingComments.length>0?v.trailingComments[0].range[0]>=e.range[1]?(n=v.trailingComments,v.trailingComments=[]):v.trailingComments.length=0:v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=v.bottomRightStack[v.bottomRightStack.length-1].trailingComments,delete v.bottomRightStack[v.bottomRightStack.length-1].trailingComments);v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].range[0]>=e.range[0];)t=v.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):v.leadingComments.length>0&&v.leadingComments[v.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=v.leadingComments,v.leadingComments=[]),n&&(e.trailingComments=n),v.bottomRightStack.push(e)}},markEnd:function(e,t){return v.range&&(e.range=[t.start,d]),v.loc&&(e.loc=new H(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),f,d-p),this.postProcess(e)),v.attachComment&&this.processComment(e),e},postProcess:function(e){return v.source&&(e.loc.source=v.source),e},createArrayExpression:function(e){return{type:a.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:a.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?a.LogicalExpression:a.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:a.BlockStatement,body:e}},createBreakStatement:function(e){return{type:a.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:a.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:a.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:a.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:a.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:a.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:a.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:a.EmptyStatement}},createExpressionStatement:function(e){return{type:a.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:a.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:a.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:a.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:a.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:a.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:a.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:a.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:a.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:a.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:a.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:a.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:a.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:a.Program,body:e}},createProperty:function(e,t,n){return{type:a.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:a.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:a.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:a.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:a.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:a.ThisExpression}},createThrowStatement:function(e){return{type:a.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:a.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:a.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:a.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:a.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:a.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:a.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:a.WithStatement,object:e,body:t}}},e.version="1.2.2",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),m=l,d=0,f=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},(n=n||{}).tokens=!0,v.tokens=[],v.tokenize=!0,v.openParenToken=-1,v.openCurlyToken=-1,v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]);try{if(z(),g.type===t.EOF)return v.tokens;for(U();g.type!==t.EOF;)try{U()}catch(e){if(v.errors){v.errors.push(e);break}throw e}Ee(),r=v.tokens,void 0!==v.comments&&(r.comments=v.comments),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.parse=function(e,n){var r,o,s,b;o=String,"string"==typeof e||e instanceof String||(e=o(e)),m=l,d=0,f=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},void 0!==n&&(v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,v.attachComment="boolean"==typeof n.attachComment&&n.attachComment,v.loc&&null!=n.source&&(v.source=o(n.source)),"boolean"==typeof n.tokens&&n.tokens&&(v.tokens=[]),"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]),v.attachComment&&(v.range=!0,v.comments=[],v.bottomRightStack=[],v.trailingComments=[],v.leadingComments=[]));try{I(),z(),b=g,u=!1,s=function(){for(var e,n,r,o=[];d<h&&(n=g).type===t.StringLiteral&&(e=Se(),o.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&V(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;d<h&&void 0!==(e=Se());)o.push(e);return o}(),r=m.markEnd(m.createProgram(s),b),void 0!==v.comments&&(r.comments=v.comments),void 0!==v.tokens&&(Ee(),r.tokens=v.tokens),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),a)a.hasOwnProperty(e)&&(t[e]=a[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()},r(void 0!==n?n:this.esprima={})},{}],1:[function(e,t,n){(function(r){var a=function(){var e={trace:function(){},yy:{},symbols_:{error:2,JSON_PATH:3,DOLLAR:4,PATH_COMPONENTS:5,LEADING_CHILD_MEMBER_EXPRESSION:6,PATH_COMPONENT:7,MEMBER_COMPONENT:8,SUBSCRIPT_COMPONENT:9,CHILD_MEMBER_COMPONENT:10,DESCENDANT_MEMBER_COMPONENT:11,DOT:12,MEMBER_EXPRESSION:13,DOT_DOT:14,STAR:15,IDENTIFIER:16,SCRIPT_EXPRESSION:17,INTEGER:18,END:19,CHILD_SUBSCRIPT_COMPONENT:20,DESCENDANT_SUBSCRIPT_COMPONENT:21,"[":22,SUBSCRIPT:23,"]":24,SUBSCRIPT_EXPRESSION:25,SUBSCRIPT_EXPRESSION_LIST:26,SUBSCRIPT_EXPRESSION_LISTABLE:27,",":28,STRING_LITERAL:29,ARRAY_SLICE:30,FILTER_EXPRESSION:31,QQ_STRING:32,Q_STRING:33,$accept:0,$end:1},terminals_:{2:"error",4:"DOLLAR",12:"DOT",14:"DOT_DOT",15:"STAR",16:"IDENTIFIER",17:"SCRIPT_EXPRESSION",18:"INTEGER",19:"END",22:"[",24:"]",28:",",30:"ARRAY_SLICE",31:"FILTER_EXPRESSION",32:"QQ_STRING",33:"Q_STRING"},productions_:[0,[3,1],[3,2],[3,1],[3,2],[5,1],[5,2],[7,1],[7,1],[8,1],[8,1],[10,2],[6,1],[11,2],[13,1],[13,1],[13,1],[13,1],[13,1],[9,1],[9,1],[20,3],[21,4],[23,1],[23,1],[26,1],[26,3],[27,1],[27,1],[27,1],[25,1],[25,1],[25,1],[29,1],[29,1]],performAction:function(e,n,r,a,o,i,s){a.ast||(a.ast=t,t.initialize());var l=i.length-1;switch(o){case 1:return a.ast.set({expression:{type:"root",value:i[l]}}),a.ast.unshift(),a.ast.yield();case 2:return a.ast.set({expression:{type:"root",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 3:return a.ast.unshift(),a.ast.yield();case 4:return a.ast.set({operation:"member",scope:"child",expression:{type:"identifier",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 5:case 6:case 11:case 13:case 18:case 21:case 22:case 23:break;case 7:a.ast.set({operation:"member"}),a.ast.push();break;case 8:a.ast.set({operation:"subscript"}),a.ast.push();break;case 9:case 19:a.ast.set({scope:"child"});break;case 10:case 20:a.ast.set({scope:"descendant"});break;case 12:a.ast.set({scope:"child",operation:"member"});break;case 14:a.ast.set({expression:{type:"wildcard",value:i[l]}});break;case 15:a.ast.set({expression:{type:"identifier",value:i[l]}});break;case 16:a.ast.set({expression:{type:"script_expression",value:i[l]}});break;case 17:a.ast.set({expression:{type:"numeric_literal",value:parseInt(i[l])}});break;case 24:i[l].length>1?a.ast.set({expression:{type:"union",value:i[l]}}):this.$=i[l];break;case 25:this.$=[i[l]];break;case 26:this.$=i[l-2].concat(i[l]);break;case 27:this.$={expression:{type:"numeric_literal",value:parseInt(i[l])}},a.ast.set(this.$);break;case 28:this.$={expression:{type:"string_literal",value:i[l]}},a.ast.set(this.$);break;case 29:this.$={expression:{type:"slice",value:i[l]}},a.ast.set(this.$);break;case 30:this.$={expression:{type:"wildcard",value:i[l]}},a.ast.set(this.$);break;case 31:this.$={expression:{type:"script_expression",value:i[l]}},a.ast.set(this.$);break;case 32:this.$={expression:{type:"filter_expression",value:i[l]}},a.ast.set(this.$);break;case 33:case 34:this.$=i[l]}},table:[{3:1,4:[1,2],6:3,13:4,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{1:[3]},{1:[2,1],5:10,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,3],5:21,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,12],12:[2,12],14:[2,12],22:[2,12]},{1:[2,14],12:[2,14],14:[2,14],22:[2,14]},{1:[2,15],12:[2,15],14:[2,15],22:[2,15]},{1:[2,16],12:[2,16],14:[2,16],22:[2,16]},{1:[2,17],12:[2,17],14:[2,17],22:[2,17]},{1:[2,18],12:[2,18],14:[2,18],22:[2,18]},{1:[2,2],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,5],12:[2,5],14:[2,5],22:[2,5]},{1:[2,7],12:[2,7],14:[2,7],22:[2,7]},{1:[2,8],12:[2,8],14:[2,8],22:[2,8]},{1:[2,9],12:[2,9],14:[2,9],22:[2,9]},{1:[2,10],12:[2,10],14:[2,10],22:[2,10]},{1:[2,19],12:[2,19],14:[2,19],22:[2,19]},{1:[2,20],12:[2,20],14:[2,20],22:[2,20]},{13:23,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{13:24,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9],22:[1,25]},{15:[1,29],17:[1,30],18:[1,33],23:26,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{1:[2,4],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,6],12:[2,6],14:[2,6],22:[2,6]},{1:[2,11],12:[2,11],14:[2,11],22:[2,11]},{1:[2,13],12:[2,13],14:[2,13],22:[2,13]},{15:[1,29],17:[1,30],18:[1,33],23:38,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{24:[1,39]},{24:[2,23]},{24:[2,24],28:[1,40]},{24:[2,30]},{24:[2,31]},{24:[2,32]},{24:[2,25],28:[2,25]},{24:[2,27],28:[2,27]},{24:[2,28],28:[2,28]},{24:[2,29],28:[2,29]},{24:[2,33],28:[2,33]},{24:[2,34],28:[2,34]},{24:[1,41]},{1:[2,21],12:[2,21],14:[2,21],22:[2,21]},{18:[1,33],27:42,29:34,30:[1,35],32:[1,36],33:[1,37]},{1:[2,22],12:[2,22],14:[2,22],22:[2,22]},{24:[2,26],28:[2,26]}],defaultActions:{27:[2,23],29:[2,30],30:[2,31],31:[2,32]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,n=[0],r=[null],a=[],o=this.table,i="",s=0,l=0,c=a.slice.call(arguments,1);this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;a.push(u);var d=this.lexer.options&&this.lexer.options.ranges;function f(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}this.parseError="function"==typeof this.yy.parseError?this.yy.parseError:Object.getPrototypeOf(this).parseError;for(var p,h,m,g,y,v,b,_={};;){if(this.defaultActions[h=n[n.length-1]]?m=this.defaultActions[h]:(null==p&&(p=f()),m=o[h]&&o[h][p]),void 0===m||!m.length||!m[0]){var w;for(y in b=[],o[h])this.terminals_[y]&&y>2&&b.push("'"+this.terminals_[y]+"'");w=this.lexer.showPosition?"Parse error on line "+(s+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(s+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:b})}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+p);switch(m[0]){case 1:n.push(p),r.push(this.lexer.yytext),a.push(this.lexer.yylloc),n.push(m[1]),p=null,l=this.lexer.yyleng,i=this.lexer.yytext,s=this.lexer.yylineno,u=this.lexer.yylloc;break;case 2:if(_.$=r[r.length-(v=this.productions_[m[1]][1])],_._$={first_line:a[a.length-(v||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(v||1)].first_column,last_column:a[a.length-1].last_column},d&&(_._$.range=[a[a.length-(v||1)].range[0],a[a.length-1].range[1]]),void 0!==(g=this.performAction.apply(_,[i,l,s,this.yy,m[1],r,a].concat(c))))return g;v&&(n=n.slice(0,-1*v*2),r=r.slice(0,-1*v),a=a.slice(0,-1*v)),n.push(this.productions_[m[1]][0]),r.push(_.$),a.push(_._$),n.push(o[n[n.length-2]][n[n.length-1]]);break;case 3:return!0}}return!0}},t={initialize:function(){this._nodes=[],this._node={},this._stash=[]},set:function(e){for(var t in e)this._node[t]=e[t];return this._node},node:function(e){return arguments.length&&(this._node=e),this._node},push:function(){this._nodes.push(this._node),this._node={}},unshift:function(){this._nodes.unshift(this._node),this._node={}},yield:function(){var e=this._nodes;return this.initialize(),e}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in a)this[o]=a[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),o=0;o<a.length;o++)if((n=this._input.match(this.rules[a[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,a[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,r){switch(n){case 0:return 4;case 1:return 14;case 2:return 12;case 3:return 15;case 4:return 16;case 5:return 22;case 6:return 24;case 7:return 28;case 8:return 30;case 9:return 18;case 10:return t.yytext=t.yytext.substr(1,t.yyleng-2),32;case 11:return t.yytext=t.yytext.substr(1,t.yyleng-2),33;case 12:return 17;case 13:return 31}},rules:[/^(?:\$)/,/^(?:\.\.)/,/^(?:\.)/,/^(?:\*)/,/^(?:[a-zA-Z_]+[a-zA-Z0-9_]*)/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?:((-?(?:0|[1-9][0-9]*)))?\:((-?(?:0|[1-9][0-9]*)))?(\:((-?(?:0|[1-9][0-9]*)))?)?)/,/^(?:(-?(?:0|[1-9][0-9]*)))/,/^(?:"(?:\\["bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^"\\])*")/,/^(?:'(?:\\['bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^'\\])*')/,/^(?:\(.+?\)(?=\]))/,/^(?:\?\(.+?\)(?=\]))/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return e}();function r(){this.yy={}}return e.lexer=n,r.prototype=e,e.Parser=r,new r}();void 0!==e&&void 0!==n&&(n.parser=a,n.Parser=a.Parser,n.parse=function(){return a.parse.apply(a,arguments)},n.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),r.exit(1));var a=e("fs").readFileSync(e("path").normalize(t[1]),"utf8");return n.parser.parse(a)},void 0!==t&&e.main===t&&n.main(r.argv.slice(1)))}).call(this,e("_process"))},{_process:14,fs:12,path:13}],2:[function(e,t,n){t.exports={identifier:"[a-zA-Z_]+[a-zA-Z0-9_]*",integer:"-?(?:0|[1-9][0-9]*)",qq_string:'"(?:\\\\["bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^"\\\\])*"',q_string:"'(?:\\\\['bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^'\\\\])*'"}},{}],3:[function(e,t,n){var r=e("./dict"),a=e("fs"),o={lex:{macros:{esc:"\\\\",int:r.integer},rules:[["\\$","return 'DOLLAR'"],["\\.\\.","return 'DOT_DOT'"],["\\.","return 'DOT'"],["\\*","return 'STAR'"],[r.identifier,"return 'IDENTIFIER'"],["\\[","return '['"],["\\]","return ']'"],[",","return ','"],["({int})?\\:({int})?(\\:({int})?)?","return 'ARRAY_SLICE'"],["{int}","return 'INTEGER'"],[r.qq_string,"yytext = yytext.substr(1,yyleng-2); return 'QQ_STRING';"],[r.q_string,"yytext = yytext.substr(1,yyleng-2); return 'Q_STRING';"],["\\(.+?\\)(?=\\])","return 'SCRIPT_EXPRESSION'"],["\\?\\(.+?\\)(?=\\])","return 'FILTER_EXPRESSION'"]]},start:"JSON_PATH",bnf:{JSON_PATH:[["DOLLAR",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["DOLLAR PATH_COMPONENTS",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["LEADING_CHILD_MEMBER_EXPRESSION","yy.ast.unshift(); return yy.ast.yield()"],["LEADING_CHILD_MEMBER_EXPRESSION PATH_COMPONENTS",'yy.ast.set({ operation: "member", scope: "child", expression: { type: "identifier", value: $1 }}); yy.ast.unshift(); return yy.ast.yield()']],PATH_COMPONENTS:[["PATH_COMPONENT",""],["PATH_COMPONENTS PATH_COMPONENT",""]],PATH_COMPONENT:[["MEMBER_COMPONENT",'yy.ast.set({ operation: "member" }); yy.ast.push()'],["SUBSCRIPT_COMPONENT",'yy.ast.set({ operation: "subscript" }); yy.ast.push() ']],MEMBER_COMPONENT:[["CHILD_MEMBER_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_MEMBER_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_MEMBER_COMPONENT:[["DOT MEMBER_EXPRESSION",""]],LEADING_CHILD_MEMBER_EXPRESSION:[["MEMBER_EXPRESSION",'yy.ast.set({ scope: "child", operation: "member" })']],DESCENDANT_MEMBER_COMPONENT:[["DOT_DOT MEMBER_EXPRESSION",""]],MEMBER_EXPRESSION:[["STAR",'yy.ast.set({ expression: { type: "wildcard", value: $1 } })'],["IDENTIFIER",'yy.ast.set({ expression: { type: "identifier", value: $1 } })'],["SCRIPT_EXPRESSION",'yy.ast.set({ expression: { type: "script_expression", value: $1 } })'],["INTEGER",'yy.ast.set({ expression: { type: "numeric_literal", value: parseInt($1) } })'],["END",""]],SUBSCRIPT_COMPONENT:[["CHILD_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_SUBSCRIPT_COMPONENT:[["[ SUBSCRIPT ]",""]],DESCENDANT_SUBSCRIPT_COMPONENT:[["DOT_DOT [ SUBSCRIPT ]",""]],SUBSCRIPT:[["SUBSCRIPT_EXPRESSION",""],["SUBSCRIPT_EXPRESSION_LIST",'$1.length > 1? yy.ast.set({ expression: { type: "union", value: $1 } }) : $$ = $1']],SUBSCRIPT_EXPRESSION_LIST:[["SUBSCRIPT_EXPRESSION_LISTABLE","$$ = [$1]"],["SUBSCRIPT_EXPRESSION_LIST , SUBSCRIPT_EXPRESSION_LISTABLE","$$ = $1.concat($3)"]],SUBSCRIPT_EXPRESSION_LISTABLE:[["INTEGER",'$$ = { expression: { type: "numeric_literal", value: parseInt($1) } }; yy.ast.set($$)'],["STRING_LITERAL",'$$ = { expression: { type: "string_literal", value: $1 } }; yy.ast.set($$)'],["ARRAY_SLICE",'$$ = { expression: { type: "slice", value: $1 } }; yy.ast.set($$)']],SUBSCRIPT_EXPRESSION:[["STAR",'$$ = { expression: { type: "wildcard", value: $1 } }; yy.ast.set($$)'],["SCRIPT_EXPRESSION",'$$ = { expression: { type: "script_expression", value: $1 } }; yy.ast.set($$)'],["FILTER_EXPRESSION",'$$ = { expression: { type: "filter_expression", value: $1 } }; yy.ast.set($$)']],STRING_LITERAL:[["QQ_STRING","$$ = $1"],["Q_STRING","$$ = $1"]]}};a.readFileSync&&(o.moduleInclude=a.readFileSync(e.resolve("../include/module.js")),o.actionInclude=a.readFileSync(e.resolve("../include/action.js"))),t.exports=o},{"./dict":2,fs:12}],4:[function(e,t,n){var r=e("./aesprim"),a=e("./slice"),o=e("static-eval"),i=e("underscore").uniq,s=function(){return this.initialize.apply(this,arguments)};function l(t,n,a){var o=e("./index"),i=p(r.parse(n).body[0].expression,{"@":t.value}),s=a.replace(/\{\{\s*value\s*\}\}/g,i),l=o.nodes(t.value,s);return l.forEach((function(e){e.path=t.path.concat(e.path.slice(1))})),l}function c(e){return Array.isArray(e)}function u(e){return function(t,n,r,a){var o=t.value,i=t.path,s=[],l=function(t,o){var i;c(t)?(t.forEach((function(e,t){s.length>=a||r(t,e,n)&&s.push({path:o.concat(t),value:e})})),t.forEach((function(t,n){s.length>=a||e&&l(t,o.concat(n))}))):(i=t)&&!(i instanceof Array)&&i instanceof Object&&(this.keys(t).forEach((function(e){s.length>=a||r(e,t[e],n)&&s.push({path:o.concat(e),value:t[e]})})),this.keys(t).forEach((function(n){s.length>=a||e&&l(t[n],o.concat(n))})))}.bind(this);return l(o,i),s}}function d(e){return function(t,n,r){return this.descend(n,t.expression.value,e,r)}}function f(e){return function(t,n,r){return this.traverse(n,t.expression.value,e,r)}}function p(){try{return o.apply(this,arguments)}catch(e){}}function h(e){return e=e.filter((function(e){return e})),i(e,(function(e){return e.path.map((function(e){return String(e).replace("-","--")})).join("-")}))}function m(e){var t=String(e);return t.match(/^-?[0-9]+$/)?parseInt(t):null}s.prototype.initialize=function(){this.traverse=u(!0),this.descend=u()},s.prototype.keys=Object.keys,s.prototype.resolve=function(e){var t=[e.operation,e.scope,e.expression.type].join("-"),n=this._fns[t];if(!n)throw new Error("couldn't resolve key: "+t);return n.bind(this)},s.prototype.register=function(e,t){if(!t instanceof Function)throw new Error("handler must be a function");this._fns[e]=t},s.prototype._fns={"member-child-identifier":function(e,t){var n=e.expression.value,r=t.value;if(r instanceof Object&&n in r)return[{value:r[n],path:t.path.concat(n)}]},"member-descendant-identifier":f((function(e,t,n){return e==n})),"subscript-child-numeric_literal":d((function(e,t,n){return e===n})),"member-child-numeric_literal":d((function(e,t,n){return String(e)===String(n)})),"subscript-descendant-numeric_literal":f((function(e,t,n){return e===n})),"member-child-wildcard":d((function(){return!0})),"member-descendant-wildcard":f((function(){return!0})),"subscript-descendant-wildcard":f((function(){return!0})),"subscript-child-wildcard":d((function(){return!0})),"subscript-child-slice":function(e,t){if(c(t.value)){var n=e.expression.value.split(":").map(m),r=t.value.map((function(e,n){return{value:e,path:t.path.concat(n)}}));return a.apply(null,[r].concat(n))}},"subscript-child-union":function(e,t){var n=[];return e.expression.value.forEach((function(e){var r={operation:"subscript",scope:"child",expression:e.expression},a=this.resolve(r)(r,t);a&&(n=n.concat(a))}),this),h(n)},"subscript-descendant-union":function(t,n,r){var a=e(".."),o=this,i=[];return a.nodes(n,"$..*").slice(1).forEach((function(e){i.length>=r||t.expression.value.forEach((function(t){var n={operation:"subscript",scope:"child",expression:t.expression},r=o.resolve(n)(n,e);i=i.concat(r)}))})),h(i)},"subscript-child-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.descend(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-descendant-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.traverse(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$[{{value}}]")},"member-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$.{{value}}")},"member-descendant-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$..value")}},s.prototype._fns["subscript-child-string_literal"]=s.prototype._fns["member-child-identifier"],s.prototype._fns["member-descendant-numeric_literal"]=s.prototype._fns["subscript-descendant-string_literal"]=s.prototype._fns["member-descendant-identifier"],t.exports=s},{"..":"jsonpath","./aesprim":"./aesprim","./index":5,"./slice":7,"static-eval":15,underscore:12}],5:[function(e,t,n){var r=e("assert"),a=e("./dict"),o=e("./parser"),i=e("./handlers"),s=function(){this.initialize.apply(this,arguments)};function l(e){return"[object String]"==Object.prototype.toString.call(e)}s.prototype.initialize=function(){this.parser=new o,this.handlers=new i},s.prototype.parse=function(e){return r.ok(l(e),"we need a path"),this.parser.parse(e)},s.prototype.parent=function(e,t){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var n=this.nodes(e,t)[0];return n.path.pop(),this.value(e,n.path)},s.prototype.apply=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),r.equal(xe(n),"function","fn needs to be function");var a=this.nodes(e,t).sort((function(e,t){return t.path.length-e.path.length}));return a.forEach((function(t){var r=t.path.pop(),a=this.value(e,this.stringify(t.path)),o=t.value=n.call(e,a[r]);a[r]=o}),this),a},s.prototype.value=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),arguments.length>=3){var a=this.nodes(e,t).shift();if(!a)return this._vivify(e,t,n);var o=a.path.slice(-1).shift();this.parent(e,this.stringify(a.path))[o]=n}return this.query(e,this.stringify(t),1).shift()},s.prototype._vivify=function(e,t,n){var a=this;return r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),function t(n,r){var o=n.pop(),i=a.value(e,n);i||(t(n.concat(),"string"==typeof o?{}:[]),i=a.value(e,n)),i[o]=r}(this.parser.parse(t).map((function(e){return e.expression.value})),n),this.query(e,t)[0]},s.prototype.query=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(l(t),"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.value}));return a},s.prototype.paths=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.path}));return a},s.prototype.nodes=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),0===n)return[];var a=this.parser.parse(t),o=this.handlers,i=[{path:["$"],value:e}],s=[];return a.length&&"root"==a[0].expression.type&&a.shift(),a.length?(a.forEach((function(e,t){if(!(s.length>=n)){var r=o.resolve(e),l=[];i.forEach((function(o){if(!(s.length>=n)){var i=r(e,o,n);t==a.length-1?s=s.concat(i||[]):l=l.concat(i||[])}})),i=l}})),n?s.slice(0,n):s):i},s.prototype.stringify=function(e){r.ok(e,"we need a path");var t="$",n={"descendant-member":"..{{value}}","child-member":".{{value}}","descendant-subscript":"..[{{value}}]","child-subscript":"[{{value}}]"};return(e=this._normalize(e)).forEach((function(e){if("root"!=e.expression.type){var r,a=[e.scope,e.operation].join("-"),o=n[a];if(r="string_literal"==e.expression.type?JSON.stringify(e.expression.value):e.expression.value,!o)throw new Error("couldn't find template "+a);t+=o.replace(/{{value}}/,r)}})),t},s.prototype._normalize=function(e){if(r.ok(e,"we need a path"),"string"==typeof e)return this.parser.parse(e);if(Array.isArray(e)&&"string"==typeof e[0]){var t=[{expression:{type:"root",value:"$"}}];return e.forEach((function(e,n){"$"==e&&0===n||("string"==typeof e&&e.match("^"+a.identifier+"$")?t.push({operation:"member",scope:"child",expression:{value:e,type:"identifier"}}):t.push({operation:"subscript",scope:"child",expression:{value:e,type:"number"==typeof e?"numeric_literal":"string_literal"}}))})),t}if(Array.isArray(e)&&"object"==xe(e[0]))return e;throw new Error("couldn't understand path "+e)},s.Handlers=i,s.Parser=o;var c=new s;c.JSONPath=s,t.exports=c},{"./dict":2,"./handlers":4,"./parser":6,assert:8}],6:[function(e,t,n){var r=e("./grammar"),a=e("../generated/parser"),o=function(){var e=new a.Parser,t=e.parseError;return e.yy.parseError=function(){e.yy.ast&&e.yy.ast.initialize(),t.apply(e,arguments)},e};o.grammar=r,t.exports=o},{"../generated/parser":1,"./grammar":3}],7:[function(e,t,n){function r(e){return String(e).match(/^[0-9]+$/)?parseInt(e):Number.isFinite(e)?parseInt(e,10):0}t.exports=function(e,t,n,a){if("string"==typeof t)throw new Error("start cannot be a string");if("string"==typeof n)throw new Error("end cannot be a string");if("string"==typeof a)throw new Error("step cannot be a string");var o=e.length;if(0===a)throw new Error("step cannot be zero");if(a=a?r(a):1,n=n<0?o+n:n,t=r(0===(t=t<0?o+t:t)?0:t||(a>0?0:o-1)),n=r(0===n?0:n||(a>0?o:-1)),t=a>0?Math.max(0,t):Math.min(o,t),n=a>0?Math.min(n,o):Math.max(-1,n),a>0&&n<=t)return[];if(a<0&&t<=n)return[];for(var i=[],s=t;s!=n&&!(a<0&&s<=n||a>0&&s>=n);s+=a)i.push(e[s]);return i}},{}],8:[function(e,t,n){var r=e("util/"),a=Array.prototype.slice,o=Object.prototype.hasOwnProperty,i=t.exports=u;function s(e,t){return r.isUndefined(t)?""+t:r.isNumber(t)&&!isFinite(t)||r.isFunction(t)||r.isRegExp(t)?t.toString():t}function l(e,t){return r.isString(e)?e.length<t?e:e.slice(0,t):e}function c(e,t,n,r,a){throw new i.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:a})}function u(e,t){e||c(e,!0,t,"==",i.ok)}function d(e,t){if(e===t)return!0;if(r.isBuffer(e)&&r.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return r.isDate(e)&&r.isDate(t)?e.getTime()===t.getTime():r.isRegExp(e)&&r.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:r.isObject(e)||r.isObject(t)?function(e,t){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(r.isPrimitive(e)||r.isPrimitive(t))return e===t;var n=f(e),o=f(t);if(n&&!o||!n&&o)return!1;if(n)return d(e=a.call(e),t=a.call(t));var i,s,l=m(e),c=m(t);if(l.length!=c.length)return!1;for(l.sort(),c.sort(),s=l.length-1;s>=0;s--)if(l[s]!=c[s])return!1;for(s=l.length-1;s>=0;s--)if(!d(e[i=l[s]],t[i]))return!1;return!0}(e,t):e==t}function f(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function p(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||!0===t.call({},e))}function h(e,t,n,a){var o;r.isString(n)&&(a=n,n=null);try{t()}catch(e){o=e}if(a=(n&&n.name?" ("+n.name+").":".")+(a?" "+a:"."),e&&!o&&c(o,n,"Missing expected exception"+a),!e&&p(o,n)&&c(o,n,"Got unwanted exception"+a),e&&o&&n&&!p(o,n)||!e&&o)throw o}i.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return l(JSON.stringify(e.actual,s),128)+" "+e.operator+" "+l(JSON.stringify(e.expected,s),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||c;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,a=r.indexOf("\n"+t.name);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},r.inherits(i.AssertionError,Error),i.fail=c,i.ok=u,i.equal=function(e,t,n){e!=t&&c(e,t,n,"==",i.equal)},i.notEqual=function(e,t,n){e==t&&c(e,t,n,"!=",i.notEqual)},i.deepEqual=function(e,t,n){d(e,t)||c(e,t,n,"deepEqual",i.deepEqual)},i.notDeepEqual=function(e,t,n){d(e,t)&&c(e,t,n,"notDeepEqual",i.notDeepEqual)},i.strictEqual=function(e,t,n){e!==t&&c(e,t,n,"===",i.strictEqual)},i.notStrictEqual=function(e,t,n){e===t&&c(e,t,n,"!==",i.notStrictEqual)},i.throws=function(e,t,n){h.apply(this,[!0].concat(a.call(arguments)))},i.doesNotThrow=function(e,t){h.apply(this,[!1].concat(a.call(arguments)))},i.ifError=function(e){if(e)throw e};var m=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}},{"util/":11}],9:[function(e,t,n){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],10:[function(e,t,n){t.exports=function(e){return e&&"object"===xe(e)&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],11:[function(e,t,n){(function(t,r){var a=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,i=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<o;l=r[++n])m(l)||!_(l)?i+=" "+l:i+=" "+s(l);return i},n.deprecate=function(e,a){if(v(r.process))return function(){return n.deprecate(e,a).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(a);t.traceDeprecation?console.trace(a):console.error(a),o=!0}return e.apply(this,arguments)}};var o,i={};function s(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(r,e);return y(a)||(a=u(e,a,r)),a}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var i=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),x(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return d(t);if(0===i.length){if(S(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return d(t)}var l,c="",_=!1,E=["{","}"];return p(t)&&(_=!0,E=["[","]"]),S(t)&&(c=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(c=" "+RegExp.prototype.toString.call(t)),w(t)&&(c=" "+Date.prototype.toUTCString.call(t)),x(t)&&(c=" "+d(t)),0!==i.length||_&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=_?function(e,t,n,r,a){for(var o=[],i=0,s=t.length;i<s;++i)A(t,String(i))?o.push(f(e,t,n,r,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(f(e,t,n,r,a,!0))})),o}(e,t,r,s,i):i.map((function(n){return f(e,t,r,s,n,_)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,c,E)):E[0]+c+E[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,a,o){var i,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),A(r,a)||(i="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),v(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=e.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=e.stylize(i,"string"))}return i+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===E(e)}function _(e){return"object"===xe(e)&&null!==e}function w(e){return _(e)&&"[object Date]"===E(e)}function x(e){return _(e)&&("[object Error]"===E(e)||e instanceof Error)}function S(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!i[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;i[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else i[e]=function(){};return i[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=g,n.isString=y,n.isSymbol=function(e){return"symbol"===xe(e)},n.isUndefined=v,n.isRegExp=b,n.isObject=_,n.isDate=w,n.isError=x,n.isFunction=S,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===xe(e)||void 0===e},n.isBuffer=e("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(t=[k((e=new Date).getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),C[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==ue?ue:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":10,_process:14,inherits:9}],12:[function(e,t,n){},{}],13:[function(e,t,n){(function(e){function t(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}n.resolve=function(){for(var n="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var i=o>=0?arguments[o]:e.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(n=i+"/"+n,a="/"===i.charAt(0))}return(a?"/":"")+(n=t(r(n.split("/"),(function(e){return!!e})),!a).join("/"))||"."},n.normalize=function(e){var o=n.isAbsolute(e),i="/"===a(e,-1);return(e=t(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&i&&(e+="/"),(o?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},n.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var a=r(e.split("/")),o=r(t.split("/")),i=Math.min(a.length,o.length),s=i,l=0;l<i;l++)if(a[l]!==o[l]){s=l;break}var c=[];for(l=s;l<a.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!a){r=o;break}}else a=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},n.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,a=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){n=t+1;break}}else-1===r&&(a=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,a=!0,o=0,i=e.length-1;i>=0;--i){var s=e.charCodeAt(i);if(47!==s)-1===r&&(a=!1,r=i+1),46===s?-1===t?t=i:1!==o&&(o=1):-1!==t&&(o=-1);else if(!a){n=i+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var a="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:14}],14:[function(e,t,n){var r,a,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var c,u=[],d=!1,f=-1;function p(){d&&c&&(d=!1,c.length?u=c.concat(u):f=-1,u.length&&h())}function h(){if(!d){var e=l(p);d=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||d||l(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],15:[function(e,t,n){var r=e("escodegen").generate;t.exports=function(e,t){t||(t={});var n={},a=function e(a,o){if("Literal"===a.type)return a.value;if("UnaryExpression"===a.type){var i=e(a.argument);return"+"===a.operator?+i:"-"===a.operator?-i:"~"===a.operator?~i:"!"===a.operator?!i:n}if("ArrayExpression"===a.type){for(var s=[],l=0,c=a.elements.length;l<c;l++){if((y=e(a.elements[l]))===n)return n;s.push(y)}return s}if("ObjectExpression"===a.type){var u={};for(l=0;l<a.properties.length;l++){var d=null===(v=a.properties[l]).value?v.value:e(v.value);if(d===n)return n;u[v.key.value||v.key.name]=d}return u}if("BinaryExpression"===a.type||"LogicalExpression"===a.type){if((c=e(a.left))===n)return n;var f=e(a.right);if(f===n)return n;var p=a.operator;return"=="===p?c==f:"==="===p?c===f:"!="===p?c!=f:"!=="===p?c!==f:"+"===p?c+f:"-"===p?c-f:"*"===p?c*f:"/"===p?c/f:"%"===p?c%f:"<"===p?c<f:"<="===p?c<=f:">"===p?c>f:">="===p?c>=f:"|"===p?c|f:"&"===p?c&f:"^"===p?c^f:"&&"===p?c&&f:"||"===p?c||f:n}if("Identifier"===a.type)return{}.hasOwnProperty.call(t,a.name)?t[a.name]:n;if("ThisExpression"===a.type)return{}.hasOwnProperty.call(t,"this")?t.this:n;if("CallExpression"===a.type){var h=e(a.callee);if(h===n)return n;if("function"!=typeof h)return n;var m=a.callee.object?e(a.callee.object):n;m===n&&(m=null);var g=[];for(l=0,c=a.arguments.length;l<c;l++){var y;if((y=e(a.arguments[l]))===n)return n;g.push(y)}return h.apply(m,g)}var v;if("MemberExpression"===a.type)return(u=e(a.object))===n||"function"==typeof u?n:"Identifier"===a.property.type?u[a.property.name]:(v=e(a.property))===n?n:u[v];if("ConditionalExpression"===a.type)return(i=e(a.test))===n?n:e(i?a.consequent:a.alternate);if("ExpressionStatement"===a.type)return(i=e(a.expression))===n?n:i;if("ReturnStatement"===a.type)return e(a.argument);if("FunctionExpression"===a.type){var b=a.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<a.params.length;l++){var w=a.params[l];if("Identifier"!=w.type)return n;t[w.name]=null}for(var l in b)if(e(b[l])===n)return n;t=_;var x=Object.keys(t),S=x.map((function(e){return t[e]}));return Function(x.join(", "),"return "+r(a)).apply(null,S)}if("TemplateLiteral"===a.type){var E="";for(l=0;l<a.expressions.length;l++)E+=e(a.quasis[l]),E+=e(a.expressions[l]);return E+e(a.quasis[l])}if("TaggedTemplateExpression"===a.type){var k=e(a.tag),C=a.quasi,A=C.quasis.map(e),O=C.expressions.map(e);return k.apply(null,[A].concat(O))}return"TemplateElement"===a.type?a.value.cooked:n}(e);return a===n?void 0:a}},{escodegen:12}],jsonpath:[function(e,t,n){t.exports=e("./lib/index")},{"./lib/index":5}]},{},["jsonpath"])("jsonpath")},e.exports=n()}(CN);var AN=CN.exports;const ON=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now","0","1","2","3","4","5","6","7","8","9"]);function TN(e,t){for(const[n,r]of t.entries())if(e.startsWith(r))return e.replace(r,String(n));return e}const NN="$PREFIXED_ID";function RN(e,t,n){return t===NN?[TN(e.id,n)]:AN.query(e,t)}function IN(e){return e.toLowerCase().split(/[^\d:A-Za-z]+/).filter((e=>e&&!ON.has(e)))}function*PN(e){for(const t of e)yield*IN(t)}function*FN(e){for(const t of e)if("string"==typeof t)yield t;else if("object"==typeof t){const e=AN.query(t,"$..*");yield*FN(e)}}function*MN(e,t,n){for(const r of t){const t=RN(e,r,n);if(t.length>0)for(const e of PN(FN(t)))yield[r,e]}}async function jN(e,t,n){const r=await this.db,a=t??r.transaction(["nodes"]);vN(n);const o=[...IN(e)],i=[],s=new Map;i.push(...o.map((async(e,t)=>{vN(n);const r=a.objectStore("nodes").index("full-text-words");for await(const a of r.iterate(IDBKeyRange.bound(e,`${e}`,!1,!1))){vN(n);const e=a.value,r=s.get(e.id)??[e,new Set];r[1].add(t),s.set(e.id,r)}}))),await Promise.all(i),vN(n);const l=[];for(const[,[e,t]]of s)vN(n),l.push(...DN(this.textIndexFields,e,t,o,this.prefixes));return l.sort(((e,t)=>t.score-e.score)),l.slice(0,this.options.maxSearchResults??this.DEFAULT_MAX_SEARCH_RESULTS)}function DN(e,t,n,r,a){const o=[...n].sort().map((e=>r[e])),i=o.map((e=>{const t=e.replaceAll(/[$()*+./?[\\\]^{|}-]/g,String.raw`\$&`);return new RegExp(`\\b${t}`,"gi")}));let s=[],l=0;for(const[n,o]of e.entries()){const c=new Set,u=e.length-n-1,d=[...FN(RN(t,o.jsonPath,a))];for(const e of d){let n=0;const a=[];for(const[t,o]of i.entries())for(const i of e.matchAll(o)){n+=1+1*u,c.add(t);const o=i.index,s=r[t];void 0!==o&&(n+=.01*s.length,n+=s.length/e.length*100*.05,a.push({wordIndex:t,position:o}))}n+=100*c.size,l<n&&(l=n),a.sort(((e,t)=>e.position-t.position)),a.length>0&&s.push({term:t,field:o,str:e,score:n,wordMatches:a})}}s=s.filter((e=>e.score===l));for(const e of s){const{wordMatches:t}=e;for(let n=0;n<t.length-1;n++){const r=t[n],a=t[n+1],i=a.wordIndex-r.wordIndex;if(1===i||-1===i){e.score+=1,1===i&&(e.score+=1);const t=Math.abs(a.position-(r.position+o[r.wordIndex].length))-1;e.score-=.05*t}}}return s}function LN(e){return"string"==typeof e.id}function BN(e){return"string"==typeof e.sub&&"string"==typeof e.pred&&"string"==typeof e.obj}function qN(e){return Boolean(e.meta?.deprecated)}var UN=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==xe(t)&&"object"==xe(n)){if(t.constructor!==n.constructor)return!1;var r,a,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;var i,s=Ve(t.entries());try{for(s.s();!(i=s.n()).done;)if(!n.has((a=i.value)[0]))return!1}catch(e){s.e(e)}finally{s.f()}var l,c=Ve(t.entries());try{for(c.s();!(l=c.n()).done;)if(!e((a=l.value)[1],n.get(a[0])))return!1}catch(e){c.e(e)}finally{c.f()}return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;var u,d=Ve(t.entries());try{for(d.s();!(u=d.n()).done;)if(!n.has((a=u.value)[0]))return!1}catch(e){d.e(e)}finally{d.f()}return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(t[a]!==n[a])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=r;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=r;0!=a--;){var f=o[a];if(!e(t[f],n[f]))return!1}return!0}return t!=t&&n!=n};async function zN(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,o=n.blocking,i=n.terminated,s=indexedDB.open(e,t),l=lh(s);return a&&s.addEventListener("upgradeneeded",(function(e){a(lh(s.result),e.oldVersion,e.newVersion,lh(s.transaction),e)})),r&&s.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),l.then((function(e){i&&e.addEventListener("close",(function(){return i()})),o&&e.addEventListener("versionchange",(function(e){return o(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),l}(e,2,{upgrade(e,t,n,r,a){if(t<2&&(e.objectStoreNames.contains("meta")&&e.deleteObjectStore("meta"),e.objectStoreNames.contains("nodes")&&e.deleteObjectStore("nodes"),e.objectStoreNames.contains("edges")&&e.deleteObjectStore("edges")),e.objectStoreNames.contains("meta")||e.createObjectStore("meta"),!e.objectStoreNames.contains("nodes")){e.createObjectStore("nodes",{keyPath:"id"});const t=r.objectStore("nodes");t.createIndex("by-label","lbl"),t.createIndex("by-type","type"),t.createIndex("by-synonym",["meta","synonyms","val"]),t.createIndex("full-text-words","fullTextWords",{multiEntry:!0})}if(!e.objectStoreNames.contains("edges")){e.createObjectStore("edges",{autoIncrement:!0});const t=r.objectStore("edges");t.createIndex("by-subject","sub"),t.createIndex("by-object","obj"),t.createIndex("by-predicate","pred")}}})}function GN(e){const t=new Set;for(const[,n]of e)t.add(n);return[...t]}async function HN(e){const t=Date.now();let n,r=1;this.options.update?.("Parsing JSON",r);try{n=JSON.parse(await m.openLocation(this.sourceLocation).readFile("utf8"))}catch{throw new Error("Error in loading ontology")}r+=5,this.options.update?.("Parsing JSON complete",r);const a=Date.now(),[o,...i]=n.graphs??[];if(o){if(i.length>0)throw new Error("multiple graphs not supported");try{const n=e.transaction(["meta","nodes","edges"],"readwrite");await n.objectStore("meta").clear(),await n.objectStore("nodes").clear(),await n.objectStore("edges").clear();const i=n.objectStore("nodes"),s=$N.call(this).map((e=>e.jsonPath));if(o.nodes){let e=Math.round(r);for(const[,t]of o.nodes.entries())r+=1/o.nodes.length*64,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing nodes",r),e=Math.round(r)),LN(t)&&await i.add({...t,fullTextWords:GN(MN(t,s,this.prefixes))})}const l=n.objectStore("edges");if(o.edges){let e=Math.round(r);for(const[,t]of o.edges.entries())r+=1/o.edges.length*30,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing edges",r),e=Math.round(r)),BN(t)&&await l.add(t)}await n.done;const c=e.transaction("meta","readwrite"),{update:u,...d}=this.options;await c.objectStore("meta").add({ontologyRecord:{name:this.ontologyName,version:this.ontologyVersion,sourceLocation:this.sourceLocation},storeOptions:d,graphMeta:o.meta,timestamp:String(new Date),schemaVersion:2,timings:{overall:Date.now()-t,load:Date.now()-a}},"meta"),await c.done}catch(t){throw await e.transaction("meta","readwrite").objectStore("meta").clear(),t}}}function $N(){return[{displayName:"ID",jsonPath:NN},...this.options.textIndexing?.indexFields??KN]}async function WN(e){const[t]=await e.transaction("meta").objectStore("meta").getAll();return!!t&&UN(this.options.prefixes,t.storeOptions.prefixes)&&UN(this.options.textIndexing,t.storeOptions.textIndexing)}class VN{ontologyName;ontologyVersion;sourceLocation;db;options;loadOboGraphJson=HN;getTermsByFulltext=jN;openDatabase=zN;isDatabaseCurrent=WN;get textIndexFields(){return $N.call(this)}get prefixes(){return this.options.prefixes??new Map}DEFAULT_MAX_SEARCH_RESULTS=100;constructor(e,t,n,r){this.ontologyName=e,this.ontologyVersion=t,this.sourceLocation=n,this.options=r??{},this.db=this.prepareDatabase()}validate(){const e=[],{sourceLocation:t,sourceType:n}=this;return n?"obo-graph-json"!==n&&e.push(new Error(`ontology source file ${JSON.stringify(t)} has type ${n}, which is not yet supported`)):e.push(new Error(`unable to determine format of ontology source file ${JSON.stringify(t)}, file name must end with ".json", ".obo", or ".owl"`)),e}get sourceType(){if(n.isUriLocation(this.sourceLocation)){if(this.sourceLocation.uri.endsWith(".json"))return"obo-graph-json"}else if(n.isLocalPathLocation(this.sourceLocation)&&this.sourceLocation.localPath.endsWith(".json"))return"obo-graph-json"}get dbName(){return`Apollo Ontology "${this.ontologyName}" "${this.ontologyVersion}"`}async prepareDatabase(){const e=this.validate();if(e.length>0)throw e;const t=await this.openDatabase(this.dbName);if(await this.isDatabaseCurrent(t))return t;try{const{options:e,sourceLocation:n,sourceType:r}=this;if("obo-graph-json"!==r)throw new Error(`ontology source file ${JSON.stringify(n)} has type ${r}, which is not yet supported`);return e.update?.("",0),await this.loadOboGraphJson(t),e.update?.("",100),t}catch(e){throw t.close(),await function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(function(e){return t(e.oldVersion,e)})),lh(n).then((function(){}))}(this.dbName),e}}async termCount(e){const t=await this.db;return(e??t.transaction("nodes")).objectStore("nodes").count()}unique(e){const t=new Map,n=[];for(const r of e)t.has(r.id)||(t.set(r.id,!0),n.push(r));return n}async getTermsWithLabelOrSynonym(e,t,n){const r=t?.includeSubclasses??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=o.objectStore("nodes"),s=[...await i.index("by-label").getAll(e),...await i.index("by-synonym").getAll(e)];if(r){const e=await this.recurseEdges("by-object",s.map((e=>e.id)),(e=>"is_a"===e.pred),"sub",o);for(const t of e){const e=await i.get(t);e&&s.push(e)}}return s}async getPropertiesByLabel(e,t,n){const r=t?.includeSubProperties??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=(await this.getTermsWithLabelOrSynonym(e,{includeSubclasses:!1},o)).filter((e=>QN(e)));if(r){const e=await this.recurseEdges("by-object",i.map((e=>e.id)),(e=>"subPropertyOf"===e.pred),"sub",o),t=o.objectStore("nodes");for(const n of e){const e=await t.get(n);e&&QN(e)&&i.push(e)}}return i}async recurseEdges(e,t,n,r,a){const o=new Set;return await async function t(i){await Promise.all([...i].map((async i=>{const s=(await a.objectStore("edges").index(e).getAll(i)).filter((e=>n(e))).map((e=>e[r]));if(s.length>0){for(const e of s)o.add(e);await t(s)}})))}(t),o.values()}async*expandNodeSet(e,t="is_a",n,r){const a=await this.db,o=r??a.transaction(["edges"]),i=[...e],s=await this.recurseEdges("subclasses"===n?"by-object":"by-subject",i,(e=>e.pred===t),"subclasses"===n?"sub":"obj",o);for(const e of i)yield e;for(const e of s)yield e}expandSubclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"subclasses",n)}expandSuperclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"superclasses",n)}async getClassesThat(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=await this.getPropertiesByLabel(e,{includeSubProperties:!0},a),i=new Set(o.map((e=>e.id))),s=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.expandSuperclasses(t.map((e=>e.id)),"is_a",a)),l=await this.recurseEdges("by-object",s,(e=>i.has(e.pred)),"sub",a),c=this.expandSubclasses(l,"is_a",a),u=[];for await(const e of c){const t=await a.objectStore("nodes").get(e);t&&XN(t)&&!qN(t)&&u.push(t)}return u}async getClassesWithoutPropertyLabeled(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=a.objectStore("nodes"),i=a.objectStore("edges"),s=(await this.getPropertiesByLabel(e,t,a)).map((e=>e.id)),l=await(async()=>{const e=new Set;for(const t of s)for await(const n of i.index("by-predicate").iterate(t))e.add(n.value.sub);const t=new Set;for await(const n of this.expandSubclasses(e,"is_a",a))t.add(n);return t})(),c=[];for await(const e of o){const t=e.value;XN(t)&&!l.has(t.id)&&c.push(t.id)}const u=[];for(const e of c){const t=await a.objectStore("nodes").get(e);t&&XN(t)&&!qN(t)&&u.push(t)}return u}async getAllClasses(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").index("by-type").getAll("CLASS")).filter((e=>!qN(e)))}async getAllTerms(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").getAll()).filter((e=>!qN(e)))}}const JN=l.types.model("OntologyRecord",{name:l.types.string,version:"unversioned",source:l.types.union(h.LocalPathLocation,h.UriLocation,h.BlobLocation),options:l.types.frozen(),equivalentTypes:l.types.map(l.types.array(l.types.string))}).volatile((e=>({dataStore:void 0,startedEquivalentTypeRequests:new Set}))).actions((e=>({ping(){},initDataStore(){e.dataStore=new VN(e.name,e.version,l.getSnapshot(e.source),e.options)},afterCreate(){l.addDisposer(e,s.autorun((()=>{this.initDataStore()})))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).actions((e=>({loadEquivalentTypes:l.flow((function*(t){if(!e.dataStore)return;if(e.startedEquivalentTypeRequests.has(t))return;e.startedEquivalentTypeRequests.add(t);const n=(yield e.dataStore.getTermsWithLabelOrSynonym(t)).map((e=>e.lbl)).filter((e=>null!=e));l.isAlive(e)&&e.setEquivalentTypes(t,n)}))}))).actions((e=>({afterCreate(){s.autorun((t=>{e.dataStore&&(e.loadEquivalentTypes("gene"),e.loadEquivalentTypes("pseudogene"),e.loadEquivalentTypes("transcript"),e.loadEquivalentTypes("pseudogenic_transcript"),e.loadEquivalentTypes("CDS"),e.loadEquivalentTypes("mRNA"),t.dispose())}))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).views((e=>({isTypeOf(t,n){if(t===n)return!0;if(!e.dataStore)return!1;const r=e.equivalentTypes.get(n);return r?r.includes(t):(e.loadEquivalentTypes(n),!1)}}))),YN=l.types.model("OntologyManager",{ontologies:l.types.array(JN),prefixes:l.types.optional(l.types.map(l.types.string),{"GO:":"http://purl.obolibrary.org/obo/GO_","SO:":"http://purl.obolibrary.org/obo/SO_"})}).views((e=>({get featureTypeOntologyName(){const t=l.getRoot(e).jbrowse.configuration;return r.readConfObject(t.ApolloPlugin,"featureTypeOntologyName")}}))).views((e=>({get featureTypeOntology(){return this.findOntology(e.featureTypeOntologyName)},findOntology:(t,n)=>e.ontologies.find((e=>e.name===t&&(void 0===n||e.version===n))),openOntology(e,t){return this.findOntology(e,t)?.dataStore},applyPrefixes:t=>TN(t,e.prefixes),expandPrefixes:t=>function(e,t){for(const[n,r]of t.entries())if(e.startsWith(String(n)))return e.replace(String(n),r);return e}(t,e.prefixes)}))).actions((e=>({addOntology(t,n,r,a){const o=e.ontologies.push({name:t,version:n,source:r,options:{prefixes:new Map(e.prefixes.entries()),...a}});e.ontologies[o-1].ping()}}))),KN=[{displayName:"Label",jsonPath:"$.lbl"},{displayName:"Synonym",jsonPath:"$.meta.synonyms[*].val"},{displayName:"Definition",jsonPath:"$.meta.definition.val"}],ZN=r.ConfigurationSchema("OntologyRecord",{name:{type:"string",description:'the full name of the ontology, e.g. "Gene Ontology"',defaultValue:"My Ontology"},version:{type:"string",description:"the ontology's version string",defaultValue:"unversioned"},source:{type:"fileLocation",description:"the download location for the ontology's source file",defaultValue:{locationType:"UriLocation",uri:"http://example.com/myontology.json"}},textIndexFields:{type:"frozen",description:"JSON paths for text fields that will be indexed for text searching",defaultValue:KN}});function XN(e){return"CLASS"===e.type}function QN(e){return"PROPERTY"===e.type}async function eR(e,t,n){if(!e)return;const r=await t.getTermsWithLabelOrSynonym(e.type,{includeSubclasses:!1}),a=r.filter(XN);if(0===r.length)return;const o=await t.getClassesThat("part_of",a);return 0!==o.length?o:void 0}function tR({fetchValidTerms:e,filterTerms:t,includeDeprecated:n,onChange:r,ontologyName:a,ontologyVersion:o,renderInput:i,session:s,style:l,value:d}){const[f,p]=u.useState(!1),[h,m]=u.useState(),[g,y]=u.useState(""),[v,b]=u.useState(),{ontologyManager:_}=s.apolloDataStore,w=_.findOntology(a,o)?.dataStore,x=w&&f&&!h,S=w&&!v,E=u.useCallback((e=>(n||!qN(e))&&(!t||t(e))),[t,n]);u.useEffect((()=>{f||m(void 0)}),[f]),u.useEffect((()=>{const e=new AbortController,{signal:t}=e;return S&&(y(""),async function(e,t,n,r){if(!t)return;const a=(await e.getTermsWithLabelOrSynonym(t,{includeSubclasses:!1})).find((e=>(n??(()=>!0))(e)));if(!a)throw new Error(`not a valid ${e.ontologyName} term`);return a}(w,d,E).then((e=>{t.aborted||b(e)}),(e=>{t.aborted||bN(e)||y(String(e))}))),()=>{e.abort()}}),[s,d,E,w,S]),u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return x&&async function(e,t,n,r){let a;if(t){const n=await t(e,r);n&&(a=n)}return a||(a=await e.getAllTerms()),n?a.filter((e=>n(e))):a}(w,e,E,n).then((e=>{e&&!n.aborted&&m(e)}),(e=>{n.aborted||bN(e)||s.notify(e instanceof Error?e.message:String(e),"error")})),()=>{t.abort()}}),[x,E,w,s,e]);const k={};return g&&(k.error=!0,k.helperText=g),$.default.createElement(c.Autocomplete,{style:l,autoComplete:!0,filterSelectedOptions:!0,disableClearable:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,value:d,options:h??[],onOpen:()=>{p(!0)},onClose:()=>{p(!1)},loading:x,renderInput:i??(e=>$.default.createElement(c.TextField,{...e,...k})),getOptionLabel:e=>"string"==typeof e?e:e.lbl??"",isOptionEqualToValue:(e,t)=>e.lbl===t.lbl,onChange:(e,t)=>{t&&("string"==typeof t?(b(void 0),r(d,t)):t.lbl!==d&&(y(""),b(t),r(d,t.lbl)))}})}function nR({changeManager:e,handleClose:t,session:n,sourceAssemblyId:r,sourceFeature:a}){const[o,i]=u.useState(String(a.max)),[s,l]=u.useState(String(a.min+1)),[d,f]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(""),y=Number(o)<=Number(s);return $.default.createElement(Vp,{open:!0,title:"Add new child feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},$.default.createElement("form",{onSubmit:function(n){n.preventDefault(),h("");const i=new Or.AddFeatureChange({changedIds:[a._id],typeName:"AddFeatureChange",assembly:r,addedFeature:{_id:(new _r).toHexString(),refSeq:a.refSeq,min:Number(s)-1,max:Number(o),type:d},parentFeatureId:a._id});e.submit(i),t(),n.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:s,onChange:e=>{l(e.target.value)}}),$.default.createElement(c.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:o,onChange:e=>{i(e.target.value)},error:y,helperText:y?'"End" must be greater than "Start"':null}),$.default.createElement(tR,{session:n,ontologyName:"Sequence Ontology",style:{width:170},value:d,filterTerms:XN,fetchValidTerms:async function(e,t,n){const r=await eR(e,t);if(r)return r;g(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,a),renderInput:e=>$.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(m),helperText:m}),onChange:(e,t)=>{var n;t&&(n=t,h(""),f(n))}})),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:y||!(s&&o&&d)},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},p)):null)}var rR;function aR(e,t,n,r){const a={_id:(new _r).toHexString(),refSeq:e,type:"CDS",min:n,max:r,strand:t},o={_id:(new _r).toHexString(),refSeq:e,type:"exon",min:n,max:r,strand:t},i={};return i[a._id]=a,i[o._id]=o,{_id:(new _r).toHexString(),refSeq:e,type:"mRNA",min:n,max:r,strand:t,children:i}}function oR({changeManager:e,handleClose:t,region:n,session:r}){const[a,o]=u.useState(String(n.end)),[i,s]=u.useState(String(n.start+1)),[l,d]=u.useState(rR.GENE_AND_SUBFEATURES),[f,p]=u.useState(),[h,m]=u.useState(),[g,y]=u.useState(""),v=Number(a)<=Number(i);let b=Boolean(v)||!(i&&a&&l);return(l===rR.CUSTOM&&!f||!h&&l===rR.GENE_AND_SUBFEATURES||!h&&l===rR.TRANSCRIPT_AND_SUBFEATURES)&&(b=!0),$.default.createElement(Vp,{open:!0,title:"Add new feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},$.default.createElement("form",{onSubmit:function(o){let s;o.preventDefault(),y("");for(const[,e]of r.apolloDataStore.assemblies??new Map)if(e._id===n.assemblyName)for(const[,t]of e.refSeqs??new Map)t.name===n.refName&&(s=t._id);if(!s)return void y("Invalid refseq id. Make sure you have the Apollo annotation track open");if(l===rR.GENE_AND_SUBFEATURES){const r=aR(s,h,Number(i)-1,Number(a)),o={};o[r._id]=r;const l=(new _r).toHexString(),c=new Or.AddFeatureChange({changedIds:[l],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:l,refSeq:s,min:Number(i)-1,max:Number(a),type:"gene",strand:h,children:o}});return e.submit(c),void t()}if(l===rR.TRANSCRIPT_AND_SUBFEATURES){const r=aR(s,h,Number(i)-1,Number(a)),o=new Or.AddFeatureChange({changedIds:[r._id],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:r});return e.submit(o),void t()}if(!f)return void y("No type selected");const c=(new _r).toHexString(),u=new Or.AddFeatureChange({changedIds:[c],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:c,refSeq:s,min:Number(i)-1,max:Number(a),type:f,strand:h}});e.submit(u),t()},"data-testid":"submit-form"},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:Number(i),onChange:e=>{s(e.target.value)}}),$.default.createElement(c.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:a,onChange:e=>{o(e.target.value)},error:v,helperText:v?'"End" must be greater than "Start"':null}),$.default.createElement(c.FormControl,null,$.default.createElement(c.InputLabel,{id:"demo-simple-select-label"},"Strand"),$.default.createElement(c.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Strand",value:h?.toString(),onChange:function(e){switch(y(""),Number(e.target.value)){case 1:m(1);break;case-1:m(-1);break;default:m(void 0)}}},$.default.createElement(c.MenuItem,{value:void 0}),$.default.createElement(c.MenuItem,{value:1},"+"),$.default.createElement(c.MenuItem,{value:-1},"-"))),$.default.createElement(c.FormControl,{style:{marginTop:20}},$.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:rR.GENE_AND_SUBFEATURES,name:"radio-buttons-group",value:l,onChange:e=>{y("");const{value:t}=e.target;Object.keys(rR).includes(t)&&d(rR[t])}},$.default.createElement(c.FormControlLabel,{value:rR.GENE_AND_SUBFEATURES,control:$.default.createElement(c.Radio,null),label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Add gene and sub-features",$.default.createElement(c.Tooltip,{title:"This is a shortcut to create a gene with a single mRNA, exon, and CDS"},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))}),$.default.createElement(c.FormControlLabel,{value:rR.TRANSCRIPT_AND_SUBFEATURES,control:$.default.createElement(c.Radio,null),label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Add transcript and sub-features",$.default.createElement(c.Tooltip,{title:"This is a shortcut to create a single mRNA with exon and CDS, but without a parent gene"},$.default.createElement(c.IconButton,{size:"small"},$.default.createElement(Pp,{sx:{fontSize:18}}))))}),$.default.createElement(c.FormControlLabel,{value:rR.CUSTOM,checked:l!==rR.GENE_AND_SUBFEATURES&&l!==rR.TRANSCRIPT_AND_SUBFEATURES,control:$.default.createElement(c.Radio,null),label:"Add feature with a sequence ontology type"}))),l===rR.CUSTOM?$.default.createElement(tR,{session:r,ontologyName:"Sequence Ontology",style:{width:170},value:"",filterTerms:XN,renderInput:e=>$.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{var n;t&&(n=t,y(""),p(n))}}):null),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:b},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),g?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},g)):null)}function iR(e,t){const n=(new _r).toHexString();t.push(n);const r={};if(e.children)for(const n of Object.values(e.children)){const e=iR(n,t);r[e._id]=e}const a="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return{...e,refSeq:a,children:e.children&&r,_id:n}}function sR({changeManager:e,handleClose:t,session:n,sourceAssemblyId:a,sourceFeature:o}){const{assemblyManager:i}=n,s=i.assemblyList,[d,f]=u.useState(s.find((e=>e.name!==a))?.name),[p,h]=u.useState([]),[m,g]=u.useState(""),[y,v]=u.useState(o.min),[b,_]=u.useState("");function w(e,t){const n={};if(e.children)for(const r of Object.values(e.children)){const e=w(r,t);e.refSeq=m,e.min=e.min+t,e.max=e.max+t,n[e._id]=e}const r="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString(),a="string"==typeof e._id?e._id:e._id.toHexString();return{...e,refSeq:r,children:e.children&&n,_id:a}}return u.useEffect((()=>{g(""),async function(){if(!d)return void _("No assemblies to copy to");const e=await i.waitForAssembly(d);if(!e)return;const{refNameAliases:t}=e;if(!t)return;const n=[...Object.entries(t)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t})));h(n),g(n[0]?._id||"")}().catch((e=>{_(String(e))}))}),[d,i]),$.default.createElement(Vp,{open:!0,title:"Copy features and annotations",handleClose:t,maxWidth:!1,"data-testid":"copy-feature"},$.default.createElement("form",{onSubmit:async function(n){if(!d)return;n.preventDefault(),_("");const r=o.length,a=await i.waitForAssembly(d);if(!a)return void _(`Assembly not found: ${d}.`);const s=a.getCanonicalRefName(m),c=a.regions?.find((e=>e.refName===s));if(!c)return void _(`RefSeq not found: ${m}.`);const u=y+r;if(u>c.end)return void _(`Feature would extend beyond the bounds of the selected reference sequence. (Feature would end at ${u}, but reference sequence ends at ${c.end})`);if(y<c.start)return void _(`Reference sequence starts at ${c.start}, feature cannot start before that.`);const f=[],p=iR(l.getSnapshot(o),f),h={...p.attributes};"Parent"in h&&delete h.Parent,p.refSeq=m;const g=y-p.min;p.min=y,p.max=y+r;const v=w(p,g),b=new Or.AddFeatureChange({changedIds:[p._id],typeName:"AddFeatureChange",assembly:d,addedFeature:{_id:p._id,refSeq:p.refSeq,min:p.min,max:p.max,type:p.type,children:v.children,attributes:h,strand:p.strand},copyFeature:!0,allIds:f});e.submit(b),t(),n.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,"Target assembly"),$.default.createElement(c.Select,{labelId:"label",value:d,onChange:function(e){f(e.target.value)}},s.filter((e=>e.name!==a)).map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},r.readConfObject(e,"displayName"))))),$.default.createElement(c.DialogContentText,null,"Target reference sequence"),$.default.createElement(c.Select,{labelId:"label",value:m,onChange:function(e){g(e.target.value)}},p.map((e=>$.default.createElement(c.MenuItem,{key:e._id,value:e._id},e.name)))),$.default.createElement(c.DialogContentText,null,"Start position in target reference sequence"),$.default.createElement(c.TextField,{margin:"dense",type:"number",fullWidth:!0,variant:"outlined",value:y,onChange:e=>{v(Number(e.target.value))}})),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!d||!m||!y,variant:"contained",type:"submit"},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),b?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},b)):null)}function lR({changeManager:e,handleClose:t,session:n}){const{internetAccounts:r}=l.getRoot(n),[a,o]=u.useState(),[i,s]=u.useState(""),[d,f]=u.useState(!1),[p,h]=u.useState(!1),m=r.filter((e=>"ApolloInternetAccount"===e.type));if(0===m.length)throw new Error("No Apollo internet account found");const[g,y]=u.useState(m[0]),{collaborationServerDriver:v}=n.apolloDataStore,b=v.getAssemblies();return u.useEffect((()=>{b.length>0&&void 0===a&&o(b[0])}),[b,a]),$.default.createElement(Vp,{open:!0,title:"Delete Assembly",handleClose:t,maxWidth:!1,"data-testid":"delete-assembly"},$.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),h(!0),s(""),!a)return void s("Must select assembly!");const r=new Or.DeleteAssemblyChange({typeName:"DeleteAssemblyChange",assembly:a.name});await e.submit(r,{internetAccountId:g.internetAccountId}),t(),n.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},m.length>1?$.default.createElement($.default.Fragment,null,$.default.createElement(c.DialogContentText,null,"Select account"),$.default.createElement(c.Select,{value:g.internetAccountId,onChange:function(e){h(!1);const t=m.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);y(t)},disabled:p&&!i},r.map((e=>$.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,$.default.createElement(c.DialogContentText,null,"Select assembly"),$.default.createElement(c.Select,{labelId:"label",value:a?.name??"",onChange:function(e){const t=b.find((t=>t.name===e.target.value));o(t)},disabled:0===b.length},b.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),$.default.createElement(c.DialogContentText,null,$.default.createElement("strong",{style:{color:"red"}},"NOTE: All assembly data will be deleted and this operation cannot be undone!")),$.default.createElement(c.FormGroup,null,$.default.createElement(c.FormControlLabel,{control:$.default.createElement(c.Checkbox,{checked:d,onChange:()=>{f(!d)}}),label:"I understand that all assembly data will be deleted"}))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!a||!d,variant:"contained",type:"submit"},"Delete"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function cR({changeManager:e,handleClose:t,selectedFeature:n,session:r,setSelectedFeature:a,sourceAssemblyId:o,sourceFeature:i}){const[s,d]=u.useState(""),{ontologyManager:f}=r.apolloDataStore,{featureTypeOntology:p}=f;function h(e){if(!e.parent?.children||1===e.parent.children.size)return;const t=[];for(const n of e.parent.children.values())p?.isTypeOf(n.type,"CDS")||t.push(n);t.sort(((e,t)=>e.min-t.min));const n=[];for(const t of e.parent.children.values())p?.isTypeOf(t.type,"CDS")||n.push(t);if(n.sort(((e,t)=>t.max-e.max)),e.min===t[0].min){let n;for(const r of t)if(r._id!==e._id&&r.min>=e.min){n=r.min;break}if(n&&n!=e.parent.min)return{typeName:"LocationStartChange",changedId:e.parent._id,featureId:e.parent._id,oldLocation:e.parent.min,newLocation:n}}if(e.max===n[0].max){let t;for(const r of n)if(r._id!=e._id&&r.max<=e.max){t=r.max;break}if(t&&t!=e.parent.max)return{typeName:"LocationEndChange",changedId:e.parent._id,featureId:e.parent._id,oldLocation:e.parent.max,newLocation:t}}}return $.default.createElement(Vp,{open:!0,title:"Delete feature",handleClose:t,maxWidth:!1,"data-testid":"delete-feature"},$.default.createElement("form",{onSubmit:r=>{!async function(r){r.preventDefault(),d(""),n?._id===i._id&&a();const s=[],c=new Or.DeleteFeatureChange({changedIds:[i._id],typeName:"DeleteFeatureChange",assembly:o,changes:[{deletedFeature:l.getSnapshot(i),parentFeatureId:i.parent?._id}]});if(p&&(p.isTypeOf(i.type,"transcript")||p.isTypeOf(i.type,"pseudogenic_transcript"))){const e=h(i);e&&s.push(e)}if(p&&p.isTypeOf(i.type,"exon")){const e=function(e){if(!p)return;if(!p.isTypeOf(e.type,"exon"))return;if(!e.parent?.cdsLocations||0===e.parent.cdsLocations.length||0===e.parent.cdsLocations[0].length)return;if(!e.parent.children)throw new Error("Unable to find parent of CDS");if(1!=e.parent.cdsLocations.length)throw new Error("Unable to handle a transcript with multiple CDSs");const t=(e.parent.cdsLocations.at(0)??[]).sort((({min:e},{min:t})=>e-t));let n;for(const r of e.parent.children.values())if(r.type===t[0].type){n=r;break}if(!n)throw new Error("Unable to find CDS");const r=t[0].min,a=t[t.length-1].max;if(!(e.min>r&&e.max<a||e.max<r||e.min>a)){if(e.min<=r&&e.max>=a)return new Or.DeleteFeatureChange({changedIds:[n._id],typeName:"DeleteFeatureChange",assembly:o,changes:[{deletedFeature:l.getSnapshot(n),parentFeatureId:n.parent?._id}]});if(e.min<=r&&e.max>r){let r;for(const n of t)if(n.min>e.max){r=n.min;break}if(!r)throw new Error("Error setting new CDS start");return{typeName:"LocationStartChange",changedId:n._id,featureId:n._id,oldLocation:n.min,newLocation:r}}if(e.min<a&&e.max>=a){let r;for(const n of t.reverse())if(n.max<e.min){r=n.max;break}if(!r)throw new Error("Error setting new CDS end");return{typeName:"LocationEndChange",changedId:n._id,featureId:n._id,oldLocation:n.max,newLocation:r}}throw new Error("Unexpected relationship between exon and CDS")}}(i);e&&("DeleteFeatureChange"===e.typeName?(c.changedIds.push(...e.changedIds),c.changes.push(...e.changes)):s.push(e));const t=h(i);if(t){s.push(t);const e=i.parent?.parent;if(e?.children)if("LocationStartChange"===t.typeName){let n=t.newLocation;for(const[,r]of e.children)r._id!=t.featureId&&r.min<n&&(n=r.min);n!=e.min&&s.push({typeName:t.typeName,changedId:e._id,featureId:e._id,oldLocation:e.min,newLocation:n})}else{let n=t.newLocation;for(const[,r]of e.children)r._id!=t.featureId&&r.max>n&&(n=r.max);n!=e.max&&s.push({typeName:t.typeName,changedId:e._id,featureId:e._id,oldLocation:e.max,newLocation:n})}}}const u=function(e,t){if(0===e.length)return;const n=new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:t}),r=new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:t});for(const t of e)"LocationStartChange"===t.typeName&&(n.changedIds.push(t.changedId),n.changes.push({featureId:t.featureId,oldStart:t.oldLocation,newStart:t.newLocation})),"LocationEndChange"===t.typeName&&(r.changedIds.push(t.changedId),r.changes.push({featureId:t.featureId,oldEnd:t.oldLocation,newEnd:t.newLocation}));if(n.changedIds.length>0&&0===r.changedIds.length)return n;if(r.changedIds.length>0&&0===n.changedIds.length)return r;throw new Error("Unexpected list of changes")}(s,o);await e.submit(c),u&&await e.submit(u),t(),r.preventDefault()}(r)}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,"Are you sure you want to delete the selected feature?")),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit"},"Yes"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),s?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},s)):null)}!function(e){e.GENE_AND_SUBFEATURES="GENE_AND_SUBFEATURES",e.TRANSCRIPT_AND_SUBFEATURES="TRANSCRIPT_AND_SUBFEATURES",e.CUSTOM="CUSTOM"}(rR||(rR={}));var uR={exports:{}};function dR({handleClose:e,session:t}){const[n,a]=u.useState(!1),[o,i]=u.useState(),[s,d]=u.useState(""),{collaborationServerDriver:f,getInternetAccount:p,inMemoryFileDriver:h}=t.apolloDataStore,m=[...f.getAssemblies(),...h.getAssemblies()];return $.default.createElement(Vp,{open:!0,title:"Export GFF3",handleClose:e,maxWidth:!1,"data-testid":"download-gff3"},$.default.createElement("form",{onSubmit:async function(a){if(a.preventDefault(),d(""),!o)return void d("Must select assembly to download");const{internetAccountConfigId:i}=r.getConf(o,["sequence","metadata"]);i?await async function(e){if(!o)return void d("Must select assembly to download");const t=p(o.configuration.name,e),r=new URL("export/getID",t.baseURL),a=new URLSearchParams({assembly:o.name});r.search=a.toString();const i=r.toString(),s=t.getFetcher({locationType:"UriLocation",uri:i}),l=await s(i,{method:"GET"});if(!l.ok){const e=await Np(l,"Error when exporting ID");return void d(e)}const{exportID:c}=await l.json(),u=new URL("export",t.baseURL),f=new URLSearchParams({exportID:c,includeFASTA:n?"true":"false"});u.search=f.toString();const h=u.toString();window.open(h,"_blank")}(i):function(e){if(!o)return void d("Must select assembly to download");const{assemblies:t}=e.apolloDataStore,n=t.get(o.name),a=n?.refSeqs;if(!a)return void d(`No refSeqs found for assembly "${o.name}"`);const i=[{directive:"gff-version",value:"3"}],s=r.getConf(o,["sequence","adapter","features"]);for(const e of s){const{end:t,refName:n,start:r}=e;i.push({directive:"sequence-region",value:`${n} ${r+1} ${t}`})}for(const[,e]of a){const{features:t}=e;if(t)for(const[,e]of t)i.push(Or.annotationFeatureToGFF3(l.getSnapshot(e)))}for(const e of s){const{refName:t,seq:n}=e;i.push({id:t,description:"",sequence:n})}const c=vp.formatSync(i),u=new Blob([c],{type:"text/plain;charset=utf-8"});uR.exports.saveAs(u,`${o.displayName??o.name}.gff3`)}(t),e()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,"Select assembly"),$.default.createElement(c.Select,{labelId:"label",value:o?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));i(t)},disabled:0===m.length},m.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),$.default.createElement(c.DialogContentText,null,"Select assembly to export to GFF3"),$.default.createElement(c.FormGroup,null,$.default.createElement(c.FormControlLabel,{"data-testid":"include-fasta-checkbox",control:$.default.createElement(c.Checkbox,{checked:n,onChange:()=>{a(!n)}}),label:"Include fasta sequence in GFF output"}))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!o,variant:"contained",type:"submit"},"Download"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),s?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},s)):null)}function fR({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:a}=n,[o,i]=u.useState(),[s,l]=u.useState(),[d,f]=u.useState(""),[p,h]=u.useState(!1),[m,g]=u.useState(),[y,v]=u.useState(!1),[b,_]=u.useState(!1),{collaborationServerDriver:w,getInternetAccount:x}=a,S=w.getAssemblies();return u.useEffect((()=>{s&&(async()=>{const{internetAccountConfigId:e}=r.getConf(s,["sequence","metadata"]),t=x(s.name,e);if(!t)throw new Error("No Apollo internet account found");const{baseURL:n}=t,a=new URL("features/count",n),o=new URLSearchParams({assemblyId:s.name});a.search=o.toString();const i=t.getFetcher({locationType:"UriLocation",uri:a.toString()});_(!0);const l=await i(a.toString(),{method:"GET"});if(!l.ok)throw new Error(await Np(l));{const e=await l.json();g(e.count)}_(!1)})().catch((e=>{console.error(e),f(e.message??e)}))}),[x,n,s]),$.default.createElement(Vp,{open:!0,title:"Import Features from GFF3 file",handleClose:t,maxWidth:!1,"data-testid":"import-features-dialog"},b?$.default.createElement(Y.default,null):null,$.default.createElement("form",{onSubmit:async function(a){a.preventDefault(),f(""),_(!0),h(!0);let i="";if(!o)return void f("must select a file");if(!s)return void f("Must select assembly to download");const{internetAccountConfigId:l}=r.getConf(s,["sequence","metadata"]),c=x(s.name,l),{baseURL:u}=c,d=new URL("files",u);d.searchParams.set("type","text/x-gff3");const p=d.href,m=new FormData;m.append("file",o),m.append("fileName",o.name),m.append("type","text/x-gff3");const g=c.getFetcher({locationType:"UriLocation",uri:p});t();const{jobsManager:v}=n,b=new AbortController,w={name:`Importing features for ${s.displayName}`,statusMessage:"Uploading file, this may take awhile",progressPct:0,cancelCallback:()=>{b.abort(),v.abortJob(w.name)}};if(v.runJob(w),g){const{signal:e}=b,t=await g(p,{method:"POST",body:m,signal:e});if(!t.ok){const e=await Np(t,"Error when inserting new features (while uploading file)");return v.abortJob(w.name,e),void f(e)}i=(await t.json())._id}const S=new Or.AddFeaturesFromFileChange({typeName:"AddFeaturesFromFileChange",assembly:s.name,fileId:i,deleteExistingFeatures:y});v.done(w),await e.submit(S,{updateJobsManager:!0})}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,"Select assembly"),$.default.createElement(c.Select,{labelId:"label",value:s?.name??"",onChange:function(e){const t=S.find((t=>t.name===e.target.value));l(t),h(!1)},disabled:p&&!d},S.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name))))),$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,"Upload GFF3 to load features"),$.default.createElement("input",{type:"file",onChange:function(e){h(!1),e.target.files&&i(e.target.files[0])},disabled:p&&!d})),m&&m>0?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,null,"This assembly already has ",m," features, would you like to delete the existing features before importing new ones?"),$.default.createElement(J.default,{label:"Yes, delete existing features",disabled:p&&!d,control:$.default.createElement(V.default,{checked:y,onChange:function(e){v(e.target.checked)},inputProps:{"aria-label":"controlled"},color:"warning"})})):null,$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!(s&&o&&void 0!==m)||p,variant:"contained",type:"submit"},p?"Submitting...":"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close"))),d?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},d)):null)}function pR({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),[r,a]=u.useState(""),o=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===o.length)throw new Error("No Apollo internet account found");const[i,s]=u.useState(o[0]);return $.default.createElement(Vp,{open:!0,title:"Log out",handleClose:e,maxWidth:!1,"data-testid":"log-out"},$.default.createElement("form",{onSubmit:function(e){e.preventDefault(),a(""),i.removeToken(),globalThis.location.reload()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},o.length>1?$.default.createElement($.default.Fragment,null,$.default.createElement(c.DialogContentText,null,"Select account"),$.default.createElement(c.Select,{value:i.internetAccountId,onChange:function(e){const t=o.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);s(t)}},n.map((e=>$.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,$.default.createElement(c.DialogContentText,null,"Are you sure you want to log out?")),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!i,variant:"contained",type:"submit"},"Log Out"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),r?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},r)):null)}function hR({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),[r,a]=u.useState(),[o,i]=u.useState(""),[s,d]=u.useState(!1),f=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===f.length)throw new Error("No Apollo internet account found");const[p,h]=u.useState(f[0]),[m,g]=u.useState([]),[y,v]=u.useState([]),{collaborationServerDriver:b}=t.apolloDataStore,_=b.getAssemblies();function w(e,t){const n=[...y],r=e.target.value;if(t)n.includes(r)||(n.push(r),v(n));else{const e=n.indexOf(r,0);-1!==e&&n.splice(e,1),v(n)}}return u.useEffect((()=>{(async function(){const{baseURL:e,getFetcher:t}=p,n=new URL("checks/types",e).href,r=t({locationType:"UriLocation",uri:n}),a=await r(n,{method:"GET"});if(!a.ok){const e=await Np(a,"Error when retrieving checks from server");return void i(e)}const o=await a.json();g(o)})().catch((e=>{i(String(e))}))}),[p]),u.useEffect((()=>{_.length>0&&void 0===r&&a(_[0])}),[_,r]),u.useEffect((()=>{(async function(){if(!r)return;const{baseURL:e,getFetcher:t}=p,n=new URL(`/assemblies/${r.name}`,e).href,a=t({locationType:"UriLocation",uri:n}),o=await a(n,{method:"GET"});if(!o.ok){const e=await Np(o,"Error when retrieving assembly from server");return void i(e)}const s=await o.json();v(s.checks)})().catch((e=>{i(String(e))}))}),[r,p]),$.default.createElement(Vp,{open:!0,title:"Manage Checks",handleClose:e,"data-testid":"manage-checks"},$.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),!r)return void i("Must select assembly!");const{notify:a}=t,{baseURL:o,getFetcher:s}=p,l=new URL("assemblies/checks",o).href,c=s({locationType:"UriLocation",uri:l}),u=await c(l,{method:"POST",body:JSON.stringify({_id:r.name,checks:y,name:""}),headers:{"Content-Type":"application/json"}});if(u.ok)a("Assembly checks updated successfully","success"),e();else{const e=await Np(u,"Error when updating assembly checks");i(e)}}},$.default.createElement(c.DialogContent,null,f.length>1?$.default.createElement($.default.Fragment,null,$.default.createElement(c.DialogContentText,null,"Select account"),$.default.createElement(c.Select,{value:p.internetAccountId,onChange:function(e){d(!1);const t=f.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);h(t)},disabled:s&&!o},n.map((e=>$.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,$.default.createElement(c.DialogContentText,null,"Select assembly"),$.default.createElement(c.Select,{style:{width:300},labelId:"label",value:r?.name??"",onChange:function(e){const t=_.find((t=>t.name===e.target.value));a(t)},disabled:0===_.length},_.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),$.default.createElement("br",null),$.default.createElement("br",null),$.default.createElement(c.TableContainer,{component:c.Paper},$.default.createElement(c.Table,null,$.default.createElement(c.TableHead,null,$.default.createElement(c.TableRow,null,$.default.createElement(c.TableCell,null,"Check name"),$.default.createElement(c.TableCell,null,"Use check"))),$.default.createElement(c.TableBody,null,m.map((e=>$.default.createElement(c.TableRow,{key:e._id},$.default.createElement(c.TableCell,null,e.name),$.default.createElement(c.TableCell,null,$.default.createElement(c.Checkbox,{value:e._id,checked:y.includes(e._id),onChange:w}))))))))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit"},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),o?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},o)):null)}!function(e,t){!function(){function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){i(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==("undefined"==typeof window?"undefined":xe(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":xe(self))&&self.self===self?self:"object"==xe(ue)&&ue.global===ue?ue:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=a.saveAs||("object"!=("undefined"==typeof window?"undefined":xe(window))||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,o,i){var s=a.URL||a.webkitURL,l=document.createElement("a");l.download=o=o||e.name||"download",l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,o,i):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,o){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=xe(t)&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),a);else if(n(e))t(e,a,o);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){r(i)}))}}:function(e,n,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var d=a.URL||a.webkitURL,f=d.createObjectURL(e);i?i.location=f:location.href=f,i=null,setTimeout((function(){d.revokeObjectURL(f)}),4e4)}});a.saveAs=i.saveAs=i,e.exports=i}()}(uR);var mR={},gR=eu.exports;Object.defineProperty(mR,"__esModule",{value:!0});var yR=mR.default=void 0;function vR({changeManager:e,handleClose:t,session:n}){const{internetAccounts:r}=l.getRoot(n),a=r.filter((e=>"ApolloInternetAccount"===e.type&&e.role?.includes("admin")));if(0===a.length)throw new Error("No Apollo internet account found");const[o,i]=u.useState(""),[s,d]=u.useState(a[0]),[f,p]=u.useState([]),h=u.useCallback((async()=>{const{baseURL:e}=s,t=new URL("users",e).href,n=s.getFetcher({locationType:"UriLocation",uri:t});if(n){const e=await n(t,{method:"GET"});if(!e.ok){const t=await Np(e,"Error when getting user data from db");return void i(t)}const r=await e.json();p(r.map((e=>void 0===e.role?{...e,role:""}:e)))}}),[s]);function m(e){return e===s.getUserId()}u.useEffect((()=>{h().catch((e=>{i(String(e))}))}),[h]);const g=[{field:"username",headerName:"User",width:140},{field:"email",headerName:"Email",width:160},{field:"role",headerName:"Role",width:140,type:"singleSelect",valueOptions:["readOnly","user","admin","none"],getOptionLabel(e){switch(e){case"readOnly":return"Read-only";case"user":return"User";case"admin":return"Admin";case"none":return"None";default:return"unknown"}},editable:!0},{field:"actions",type:"actions",getActions:t=>[$.default.createElement(b.GridActionsCellItem,{key:`delete-${t.id}`,icon:$.default.createElement(yR,null),onClick:async()=>{globalThis.confirm("Delete this user?")&&await async function(t){const n=new Or.DeleteUserChange({typeName:"DeleteUserChange",userId:t});await e.submit(n,{internetAccountId:s.internetAccountId}),p((e=>e.filter((e=>e._id!==t))))}(t.id)},disabled:m(t.id),label:"Delete"})]}];return $.default.createElement(Vp,{open:!0,fullScreen:!0,title:"Manage users",handleClose:t,"data-testid":"manage-users"},$.default.createElement(c.DialogContent,null,a.length>1?$.default.createElement($.default.Fragment,null,$.default.createElement(c.DialogContentText,null,"Select account"),$.default.createElement(c.Select,{value:s.internetAccountId,onChange:function(e){const t=a.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);d(t)},disabled:!o},r.map((e=>$.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,$.default.createElement("div",{style:{height:"100%",width:"100%"}},$.default.createElement(b.DataGrid,{pagination:!0,rows:f,columns:g,getRowId:e=>e._id,slots:{toolbar:b.GridToolbar},getRowHeight:()=>"auto",isCellEditable:e=>!m(e.id),processRowUpdate:async function(t){const n=new Or.UserChange({typeName:"UserChange",role:t.role,userId:t._id});return await e.submit(n,{internetAccountId:s.internetAccountId}),t},onProcessRowUpdateError:e=>{i(String(e))}}))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),o?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},o)):null)}function bR(e,t){const n=t[e];let r;if("three_prime"===e)r=`3'end (coords: ${n.min+1}-${n.max})`;else{if("five_prime"!==e)throw new Error(`Unexpected direction: "${e}"`);r=`5'end (coords: ${n.min+1}-${n.max})`}return r}function _R({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:r,sourceAssemblyId:a,sourceFeature:o}){const[i,s]=u.useState(""),[d,f]=u.useState(),p=function(e){const t={},n=e.parent;if(!n)throw new Error("Unable to find parent of reference exon");let r=[];if(n.children)for(const[,e]of n.children)"exon"===e.type&&r.push(e);r=r.sort(((e,t)=>e.min===t.min?e.max-t.max:e.min-t.min)),n.strand&&-1===n.strand&&(r=r.reverse());let a=0;for(const n of r){if(n._id===e._id){r.length>a+1&&(t.three_prime=r[a+1]),a>0&&(t.five_prime=r[a-1]);break}a++}return t}(o);return $.default.createElement(Vp,{open:!0,title:"Merge exons",handleClose:t,maxWidth:!1,"data-testid":"merge-exons"},$.default.createElement("form",{onSubmit:function(i){i.preventDefault(),s("");const{parent:c}=o;if(!d||!c)return;n?._id===o._id&&r();const u=new Or.MergeExonsChange({changedIds:[o._id],typeName:"MergeExonsChange",assembly:a,firstExon:l.getSnapshot(o),secondExon:l.getSnapshot(d),parentFeatureId:c._id});e.submit(u),t(),i.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(p).length?"There are no neighbouring exons to merge with":"Merge with exon on:",$.default.createElement(c.FormControl,{style:{marginTop:5}},$.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:d,onChange:e=>{s("");const{value:t}=e.target;f(p[t])}},Object.keys(p).map((e=>$.default.createElement(c.FormControlLabel,{value:e,key:e,control:$.default.createElement(c.Radio,null),label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},bR(e,p))})))))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(p).length||void 0===d},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function wR(e){let t;return t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id,`${t} [${e.min+1}-${e.max}]`}function xR({changeManager:e,handleClose:t,selectedFeature:n,session:r,setSelectedFeature:a,sourceAssemblyId:o,sourceFeature:i}){const{notify:s}=r,[d,f]=u.useState(""),[p,h]=u.useState(),m=function(e,t){const n=e.parent;if(!n)throw new Error("Unable to find parent of reference transcript");const{featureTypeOntology:r}=t.apolloDataStore.ontologyManager;if(!r)throw new Error("featureTypeOntology is undefined");const a={};if(n.children)for(const[,t]of n.children)r.isTypeOf(t.type,"transcript")&&t._id!==e._id&&(a[t._id]=t);return a}(i,r);return $.default.createElement(Vp,{open:!0,title:"Merge transcripts",handleClose:t,maxWidth:!1,"data-testid":"merge-transcripts"},$.default.createElement("form",{onSubmit:async function(r){if(r.preventDefault(),f(""),!p)return;if(n?._id===i._id&&a(),!i.parent)throw new Error("Cannot find parent");const c=new Or.MergeTranscriptsChange({changedIds:[i._id],typeName:"MergeTranscriptsChange",assembly:o,firstTranscript:l.getSnapshot(i),secondTranscript:l.getSnapshot(p),parentFeatureId:i.parent._id});await e.submit(c),s("Transcripts successfully merged","success"),t(),r.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(m).length?"There are no transcripts to merge with":"Merge with transcript:",$.default.createElement(c.FormControl,{style:{marginTop:5}},$.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:p,onChange:e=>{f("");const{value:t}=e.target;h(m[t])}},Object.keys(m).map((e=>$.default.createElement(c.FormControlLabel,{value:e,key:e,control:$.default.createElement(c.Radio,null),label:$.default.createElement(c.Box,{display:"flex",alignItems:"center"},wR(m[e]))})))))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(m).length||void 0===p},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),d?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},d)):null)}yR=mR.default=(0,gR(tu).default)((0,G.default.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");var SR=function(){return crypto.getRandomValues(new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:21)).reduce((function(e,t){return e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")}),"")};function ER({handleClose:e,session:t}){const{apolloDataStore:r}=t,{addAssembly:a,addSessionAssembly:o,assemblyManager:i,notify:s}=t,[l,d]=u.useState(null),[f,p]=u.useState(""),[h,m]=u.useState(""),[g,y]=u.useState(!1),v=c.useTheme();return $.default.createElement(Vp,{open:!0,title:"Open local GFF3 file",handleClose:e,maxWidth:!1,"data-testid":"open-local-file"},$.default.createElement("form",{onSubmit:async function(c){if(c.preventDefault(),m(""),y(!0),!l)throw new Error("No file selected");const u=await new Response(l).text(),d=`${f}-${l.name}-${SR(8)}`;try{await bp(d,u,r)}catch(t){return console.error(t),s(`Error loading GFF3 ${l.name}, ${String(t)}`,"error"),void e()}const p={name:d,aliases:[f],displayName:f,sequence:{trackId:`sequenceConfigId-${f}`,type:"ReferenceSequenceTrack",adapter:{type:"ApolloSequenceAdapter",assemblyId:d},metadata:{apollo:!0,...n.isElectron?{file:l.path}:{}}}};await(o||a)(p);const h=await i.waitForAssembly(p.name);h?(t.addApolloTrackConfig(h),s(`Loaded GFF3 ${l.name}`,"success")):s(`Error loading GFF3 ${l.name}`,"error"),e()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.FormControl,null,$.default.createElement("div",{style:{flexDirection:"row"}},$.default.createElement(c.Button,{variant:"contained",component:"label",style:{marginRight:v.spacing()}},"Choose File",$.default.createElement("input",{type:"file",required:!0,hidden:!0,onChange:function(e){const t=e.target.files?.item(0);if(t&&(m(""),d(t),!f)){const e=t.name,n=e.lastIndexOf(".");p(-1===n?e:e.slice(0,n))}}})),l?l.name:"No file chosen"),$.default.createElement(c.FormHelperText,null,"Make sure your GFF3 has an embedded FASTA section")),$.default.createElement(c.TextField,{required:!0,label:"Assembly name",value:f,onChange:function(e){p(e.target.value)}})),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{disabled:!1,variant:"contained",type:"submit"},g?"Submitting...":"Submit"),$.default.createElement(c.Button,{disabled:g,variant:"outlined",type:"submit",onClick:e},"Cancel"))),h?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},h)):null)}var kR={},CR=eu.exports;Object.defineProperty(kR,"__esModule",{value:!0});var AR=kR.default=void 0;AR=kR.default=(0,CR(tu).default)((0,G.default.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}),"ContentCopy");var OR={},TR=eu.exports;Object.defineProperty(OR,"__esModule",{value:!0});var NR=OR.default=void 0;NR=OR.default=(0,TR(tu).default)((0,G.default.jsx)("path",{d:"M18.41 16.59 13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage");var RR={},IR=eu.exports;Object.defineProperty(RR,"__esModule",{value:!0});var PR=RR.default=void 0;PR=RR.default=(0,IR(tu).default)((0,G.default.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");var FR={},MR=eu.exports;Object.defineProperty(FR,"__esModule",{value:!0});var jR=FR.default=void 0;jR=FR.default=(0,MR(tu).default)((0,G.default.jsx)("path",{d:"M15.41 16.59 10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"KeyboardArrowLeft");var DR={},LR=eu.exports;Object.defineProperty(DR,"__esModule",{value:!0});var BR=DR.default=void 0;BR=DR.default=(0,LR(tu).default)((0,G.default.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");var qR={},UR=eu.exports;Object.defineProperty(qR,"__esModule",{value:!0});var zR=qR.default=void 0;zR=qR.default=(0,UR(tu).default)((0,G.default.jsx)("path",{d:"M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z"}),"KeyboardArrowUp");var GR={},HR=eu.exports;Object.defineProperty(GR,"__esModule",{value:!0});var $R=GR.default=void 0;async function WR(e){if(isSecureContext){const t=new Blob([e.outerText],{type:"text/plain"}),n=new Blob([e.outerHTML],{type:"text/html"}),r=new ClipboardItem({[t.type]:t,[n.type]:n});return navigator.clipboard.write([r])}const t=t=>{t.clipboardData?.setData("text/plain",e.outerText),t.clipboardData?.setData("text/html",e.outerHTML),t.preventDefault()};document.addEventListener("copy",t),document.execCommand("copy"),document.removeEventListener("copy",t)}$R=GR.default=(0,HR(tu).default)((0,G.default.jsx)("path",{d:"M5.59 7.41 10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage");const VR={FeatureAttributeChange:"Attribute Change",UserChange:"User Change",UndoSplitExonChange:"Undo Split Exon",UndoMergeTranscriptsChange:"Undo Merge Transcripts",UndoMergeExonsChange:"Undo Merge Exons",TypeChange:"Type Change",StrandChange:"Strand Change",SplitExonChange:"Split Exon",MergeTranscriptsChange:"Merge Transcripts",MergeExonsChange:"Merge Exons",LocationStartChange:"Location Start Change",LocationEndChange:"Location End Change",DeleteUserChange:"Delete User",DeleteFeatureChange:"Delete Feature",DeleteAssemblyChange:"Delete Assembly",AddFeatureChange:"Add Feature"};function JR(e){if(!e)return"";const t=["gene_id","transcript_id","exon_id","protein_id"];for(const n of t){const t=e.attributes?.[n];if(t&&Array.isArray(t)&&t.length>0)return t[0]}return e._id||""}function YR({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),r=n.find((e=>"ApolloInternetAccount"===e.type));if(!r)throw new Error("No Apollo internet account found");const{baseURL:a}=r,[o,i]=u.useState(),[s,d]=u.useState([]),[f,p]=u.useState(""),[h,m]=u.useState([]),[g,y]=$.default.useState(0),[v,b]=$.default.useState(5),[_,w]=u.useState("");u.useEffect((()=>{(async function(){const e=new URL("assemblies",a).href,t=r?.getFetcher({locationType:"UriLocation",uri:e});if(t){const n=await t(e,{method:"GET"});if(!n.ok){const e=await Np(n,"Error when retrieving assemblies from server");return void i(e)}const r=await n.json();d(r)}})().catch((e=>{i(String(e))}))}),[r,a]),u.useEffect((()=>{!f&&s.length>0&&p(s[0]._id)}),[f,s]),u.useEffect((()=>{(async function(){if(!f)return;const e=new URL("changes",a),t=new URLSearchParams({assembly:f});e.search=t.toString();const n=e.toString(),o=r?.getFetcher({locationType:"UriLocation",uri:n});if(o){const e=await o(n,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await Np(e,"Error when retrieving changes");return void i(t)}const t=await e.json(),r=[];for(const e of t){const{changedIds:t}=e,n=Array.isArray(e.changes)?e.changes:[];let a=0;for(const o of n){const n={...e,changes:[o],_id:`${e._id}-${a}`};"featureId"in o&&t.includes(o.featureId)&&(n.changedIds=[o.featureId],n._id=`${e._id}-${o.featureId}`),r.push(n),a++}}m(r)}})().catch((e=>{i(String(e))}))}),[f,r,a]);const x=()=>v>0?S().slice(g*v,g*v+v):S(),S=()=>{if(!_||""===_.trim())return h;const e=_.toLowerCase();return h.filter((t=>{const{_id:n="",typeName:r="",user:a="",createdAt:o="",updatedAt:i="",changedIds:s=[],changes:l=[]}=t;return[n,r,a,o,i,...s,JSON.stringify(l)].join(" ").toLowerCase().includes(e)}))};return $.default.createElement(Vp,{open:!0,title:"Change history",handleClose:e,"data-testid":"view-changelog",maxWidth:"xl",fullWidth:!0},$.default.createElement(c.DialogContent,null,$.default.createElement(c.Grid2,{container:!0,spacing:2},$.default.createElement(c.Grid2,{size:6},$.default.createElement(c.Select,{value:f,onChange:function(e){p(e.target.value)},size:"small",style:{width:300,margin:0}},s.map((e=>$.default.createElement(c.MenuItem,{key:e._id,value:e._id},e.name))))),$.default.createElement(c.Grid2,{size:6},$.default.createElement(c.TextField,{id:"outlined-basic",label:"Filter",size:"small",variant:"outlined",style:{float:"right",width:300,margin:0},value:_,onChange:e=>{w(e.target.value)}})),$.default.createElement(c.Grid2,{size:12,sx:{height:"70vh",overflowY:"scroll"}},$.default.createElement(re.default,{component:Q.default},$.default.createElement(ee.default,{"aria-label":"collapsible table"},$.default.createElement(oe.default,null,$.default.createElement(se.default,null,$.default.createElement(ne.default,null),$.default.createElement(ne.default,null,"Change type"),$.default.createElement(ne.default,null,"Feature ID"),$.default.createElement(ne.default,{align:"right"},"User"),$.default.createElement(ne.default,{align:"right"},"Created At"))),$.default.createElement(te.default,null,x().map((e=>$.default.createElement(KR,{key:e._id,row:e,session:t,assemblyId:f}))),0===x().length&&$.default.createElement(se.default,null,$.default.createElement(ne.default,{colSpan:6,align:"center"},"No changes found"))),$.default.createElement(ae.default,null,$.default.createElement(se.default,null,$.default.createElement(ne.default,{colSpan:6,align:"left"},$.default.createElement(ie.default,{rowsPerPageOptions:[5,10,25,{label:"All",value:-1}],colSpan:3,count:S().length,rowsPerPage:v,page:g,slotProps:{select:{inputProps:{"aria-label":"rows per page"},native:!0}},onPageChange:(e,t)=>{y(t)},onRowsPerPageChange:e=>{b(Number.parseInt(e.target.value,10)),y(0)},ActionsComponent:iI}))))))))),o?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},o)):null)}function KR(e){const{row:t,key:n,session:r,assemblyId:a}=e,[o,i]=$.default.useState(!1),[s,l]=u.useState(null);return u.useEffect((()=>{switch(t.typeName){case"LocationStartChange":case"LocationEndChange":l($.default.createElement(eI,{row:t,session:r,assemblyId:a}));break;case"FeatureAttributeChange":l($.default.createElement(tI,{row:t,session:r,assemblyId:a}));break;case"TypeChange":l($.default.createElement(QR,{row:t,session:r,assemblyId:a}));break;case"AddFeatureChange":l($.default.createElement(ZR,{row:t,session:r,assemblyId:a}));break;case"DeleteFeatureChange":l($.default.createElement(XR,{row:t}));break;default:l($.default.createElement(oI,{row:t}))}}),[t]),$.default.createElement($.default.Fragment,null,$.default.createElement(se.default,{key:n,sx:{borderBottom:"1px solid #e0e0e0"}},$.default.createElement(ne.default,{sx:{borderBottom:"none",width:"40px",maxWidth:"40px"}},$.default.createElement(X.default,{"aria-label":"expand row",size:"small",onClick:()=>{i(!o)}},$.default.createElement(o?zR:PR,null))),$.default.createElement(ne.default,{component:"th",scope:"row",sx:{borderBottom:"none"}},VR[t.typeName]||t.typeName),$.default.createElement(ne.default,{sx:{borderBottom:"none"}},t.changedIds.length>0?t.changedIds.join(", "):"-"),$.default.createElement(ne.default,{align:"right",sx:{borderBottom:"none"}},t.user),$.default.createElement(ne.default,{align:"right",sx:{borderBottom:"none"}},t.createdAt)),o&&$.default.createElement(se.default,null,$.default.createElement(ne.default,{style:{paddingBottom:0,paddingTop:0},colSpan:6},$.default.createElement(Z.default,{in:o,timeout:"auto",unmountOnExit:!0},$.default.createElement(K.default,{sx:{margin:1}},s)))))}function ZR(e){const{row:t,session:n,assemblyId:r}=e,{changes:a}=t,{addedFeature:o}=a?.[0]||{},i=o,[s,l]=u.useState([]),[c,d]=u.useState();return u.useEffect((()=>{"gene"===i.type?d(i):(async e=>{if(!e)return;const t=n.apolloDataStore.collaborationServerDriver,a=await t.getFeatureById(e,r,!0);a&&d(a)})(i._id).catch((e=>{console.error("Error fetching feature by ID:",e),d(void 0)}));const e=[];if(e.push({id:i._id,type:i.type}),i.children)for(const[,t]of Object.entries(i.children))if(e.push({id:t._id,type:t.type}),t.children)for(const[,n]of Object.entries(t.children))e.push({id:n._id,type:n.type});l(e)}),[t]),o?$.default.createElement(re.default,{component:Q.default,style:{margin:10,maxHeight:"300px",overflow:"auto"}},$.default.createElement(ee.default,{size:"small"},$.default.createElement(te.default,null,$.default.createElement(se.default,{style:{borderTop:"1px solid #e0e0e0"}},$.default.createElement(ne.default,null,$.default.createElement("small",null,"Feature ID")),$.default.createElement(ne.default,null,$.default.createElement("small",null,"Type")),$.default.createElement(ne.default,null,$.default.createElement("small",null,"Status"))),s.map((e=>$.default.createElement(se.default,{key:e.id},$.default.createElement(ne.default,null,$.default.createElement("small",null,e.id)),$.default.createElement(ne.default,null,$.default.createElement("small",null,e.type)),$.default.createElement(ne.default,null,$.default.createElement("small",null,rI(c,t))))))))):$.default.createElement(oI,{row:t})}function XR(e){const{row:t}=e,{changes:n}=t,{deletedFeature:r}=n?.[0]||{};if(!r)return $.default.createElement(oI,{row:t});const a=r,o=[];if(o.push({id:a._id,type:a.type}),a.children)for(const[,e]of Object.entries(a.children))if(o.push({id:e._id,type:e.type}),e.children)for(const[,t]of Object.entries(e.children))o.push({id:t._id,type:t.type});return $.default.createElement(re.default,{component:Q.default,style:{margin:10,maxHeight:"300px",overflow:"auto"}},$.default.createElement(ee.default,{size:"small"},$.default.createElement(te.default,null,$.default.createElement(se.default,{style:{borderTop:"1px solid #e0e0e0"}},$.default.createElement(ne.default,null,$.default.createElement("small",null,"Feature ID")),$.default.createElement(ne.default,null,$.default.createElement("small",null,"Type"))),o.map((e=>$.default.createElement(se.default,{key:e.id},$.default.createElement(ne.default,null,$.default.createElement("small",null,e.id)),$.default.createElement(ne.default,null,$.default.createElement("small",null,e.type))))))))}function QR(e){const{row:t,session:n,assemblyId:r}=e,[a]=t.changedIds,[o,i]=u.useState(),[s,l]=u.useState(),[c,d]=u.useState([]);return u.useEffect((()=>{(async()=>{if(!a)return;const e=n.apolloDataStore.collaborationServerDriver,t=await e.getFeatureById(a,r,!0);if(i(t),t)if(a!==t._id)for(const[e,n]of new Map(Object.entries(t.children??{}))){if(e===a)return void l(n);for(const[e,t]of new Map(Object.entries(n.children??{})))if(e===a)return void l(t)}else l(t)})().catch((e=>{console.error("Error fetching feature by ID:",e),l(void 0)}));const e=[];e.push({attribute:"",old:[String(t.changes?.[0].oldType)],new:[String(t.changes?.[0].newType)]}),d(e)}),[a,r]),s?$.default.createElement("div",null,$.default.createElement(aI,{feature:s,gene:o,row:t}),$.default.createElement(nI,{diffAttributes:c})):$.default.createElement(oI,{...e})}function eI(e){const{row:t,session:n,assemblyId:r}=e,[a]=t.changedIds,[o,i]=u.useState(),[s,l]=u.useState(),[c,d]=u.useState([]);return u.useEffect((()=>{(async()=>{if(!a)return;const e=n.apolloDataStore.collaborationServerDriver,t=await e.getFeatureById(a,r,!0);if(i(t),t)if(a!==t._id)for(const[e,n]of new Map(Object.entries(t.children??{}))){if(e===a)return void l(n);for(const[e,t]of new Map(Object.entries(n.children??{})))if(e===a)return void l(t)}else l(t)})().catch((e=>{console.error("Error fetching feature by ID:",e),l(void 0)}));const e=[];"LocationStartChange"===t.typeName&&e.push({attribute:"",old:[String(t.changes?.[0].oldStart)],new:[String(t.changes?.[0].newStart)]}),"LocationEndChange"===t.typeName&&e.push({attribute:"",old:[String(t.changes?.[0].oldEnd)],new:[String(t.changes?.[0].newEnd)]}),d(e)}),[a,r]),s?$.default.createElement("div",null,$.default.createElement(aI,{feature:s,gene:o,row:t}),$.default.createElement(nI,{diffAttributes:c})):$.default.createElement(oI,{...e})}function tI(e){const{row:t,session:n,assemblyId:r}=e,[a]=t.changedIds,[o,i]=u.useState(),[s,l]=u.useState(),[c,d]=u.useState([]);return u.useEffect((()=>{(async()=>{if(!a)return;const e=n.apolloDataStore.collaborationServerDriver,t=await e.getFeatureById(a,r,!0);if(i(t),t)if(a!==t._id)for(const[e,n]of new Map(Object.entries(t.children??{}))){if(e===a)return void l(n);for(const[e,t]of new Map(Object.entries(n.children??{})))if(e===a)return void l(t)}else l(t)})().catch((e=>{console.error("Error fetching feature by ID:",e),l(void 0)}));const e=((e,t)=>{const n=new Set([...Object.keys(e),...Object.keys(t)]),r=[];for(const a of n){const n=e[a]??[],o=t[a]??[],i=new Set(n),s=new Set(o),l=n.length===o.length&&i.size===s.size&&[...i].every((e=>s.has(e)));l||r.push({attribute:a,old:n,new:o})}return r})(t.changes?.[0].oldAttributes??{},t.changes?.[0].newAttributes??{});d(e)}),[a,r]),s?$.default.createElement("div",null,$.default.createElement(aI,{feature:s,gene:o,row:t}),$.default.createElement(nI,{diffAttributes:c})):$.default.createElement(oI,{...e})}function nI(e){const{diffAttributes:t}=e;return $.default.createElement("div",null,t.length>0&&$.default.createElement(re.default,{component:Q.default,style:{margin:10}},$.default.createElement(ee.default,{size:"small"},$.default.createElement(te.default,null,$.default.createElement(se.default,{style:{borderTop:"1px solid #e0e0e0"}},$.default.createElement(ne.default,{align:"left"},$.default.createElement("small",null,"Attribute")),$.default.createElement(ne.default,{align:"left"},$.default.createElement("small",null,"Old")),$.default.createElement(ne.default,{align:"left"},$.default.createElement("small",null,"New"))),t.map(((e,t)=>$.default.createElement(se.default,{key:t},$.default.createElement(ne.default,{align:"left"},$.default.createElement("small",null,e.attribute)),$.default.createElement(ne.default,null,e.old.length>0?$.default.createElement("ul",null,e.old.map(((e,t)=>$.default.createElement("li",{key:t},e)))):$.default.createElement("small",null,"N/A")),$.default.createElement(ne.default,{align:"left"},e.new.length>0?$.default.createElement("ul",null,e.new.map(((e,t)=>$.default.createElement("li",{key:t},e)))):$.default.createElement("small",null,"N/A")))))))))}const rI=(e,t)=>{if(!e)return"Unknown";const n=e.attributes?.savedAt?.[0];return n&&t.updatedAt&&new Date(n)>=new Date(t.updatedAt)?"Done":"Pending"};function aI(e){const{feature:t,gene:n,row:r}=e;return $.default.createElement(re.default,{component:Q.default,style:{margin:10}},$.default.createElement(ee.default,{size:"small"},$.default.createElement(te.default,null,$.default.createElement(se.default,{style:{borderTop:"1px solid #e0e0e0"}},$.default.createElement(ne.default,null,$.default.createElement("small",null,"Type")),$.default.createElement(ne.default,null,$.default.createElement("small",null,"Feature ID")),n?.type!==t.type&&$.default.createElement(ne.default,null,$.default.createElement("small",null,"Gene ID")),$.default.createElement(ne.default,null,$.default.createElement("small",null,"Status"))),$.default.createElement(se.default,null,$.default.createElement(ne.default,null,$.default.createElement("small",null,t.type)),$.default.createElement(ne.default,null,$.default.createElement("small",null,JR(t))),n?.type!==t.type&&$.default.createElement(ne.default,null,$.default.createElement("small",null,JR(n))),$.default.createElement(ne.default,null,$.default.createElement("small",null,rI(n,r)))))))}function oI(e){const{row:t}=e,n=u.useRef(null);return $.default.createElement("div",null,$.default.createElement("div",{style:{marginTop:10,display:"flex",flexDirection:"row",alignItems:"center",gap:10}},$.default.createElement(le.default,null,"Change Object"),$.default.createElement(c.Tooltip,{title:"Copy"},$.default.createElement(AR,{style:{fontSize:15,cursor:"pointer"},onClick:()=>{const e=n.current;e&&WR(e)}}))),$.default.createElement("div",{style:{height:"100px",overflowY:"scroll",border:"1px solid #e0e0e0",borderRadius:5},ref:n},$.default.createElement("pre",null,JSON.stringify(t.changes,null,2))))}function iI(e){const t=P.useTheme(),{count:n,page:r,rowsPerPage:a,onPageChange:o}=e;return $.default.createElement(K.default,{sx:{flexShrink:0,ml:2.5}},$.default.createElement(X.default,{onClick:e=>{o(e,0)},disabled:0===r,"aria-label":"first page"},$.default.createElement("rtl"===t.direction?$R:NR,null)),$.default.createElement(X.default,{onClick:e=>{o(e,r-1)},disabled:0===r,"aria-label":"previous page"},$.default.createElement("rtl"===t.direction?BR:jR,null)),$.default.createElement(X.default,{onClick:e=>{o(e,r+1)},disabled:r>=Math.ceil(n/a)-1,"aria-label":"next page"},$.default.createElement("rtl"===t.direction?jR:BR,null)),$.default.createElement(X.default,{onClick:e=>{o(e,Math.max(0,Math.ceil(n/a)-1))},disabled:r>=Math.ceil(n/a)-1,"aria-label":"last page"},$.default.createElement("rtl"===t.direction?NR:$R,null)))}const sI=[{field:"refName",headerName:"Ref Name"},{field:"aliases",headerName:"Aliases",editable:!0}],lI=e=>/^[\da-f]{24}$/i.test(e);function cI({changeManager:e,handleClose:t,session:n}){const r=u.useRef(null),[a,o]=u.useState(""),[i,s]=u.useState(!1),[l,d]=u.useState(),[f,p]=u.useState([]),[h,m]=u.useState(new Map),{apolloDataStore:g}=n,{collaborationServerDriver:y}=g,v=y.getAssemblies();u.useEffect((()=>{let e=0;const t=()=>{if(!l)return;const n=new Map;if(e<2&&!l.refNames&&(e++,setTimeout(t,50)),!l.refNames)return;const r=l.refNameAliases;for(const e in r){const t=r[e];if(t&&!lI(e))if(n.has(t)){const r=n.get(t)??[];n.set(t,[...r,e])}else n.set(t,[e])}m(n)};t()}),[l]);const _=()=>[...h].map(((e,t)=>({id:t,refName:e[0],aliases:e[1].filter((t=>t!==e[0])).join(", ")})));return $.default.createElement(Vp,{open:!0,title:"Add reference sequence aliases",handleClose:t,maxWidth:"sm","data-testid":"add-refseq-alias",fullWidth:!0},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.Grid2,{container:!0,spacing:2},$.default.createElement(c.Grid2,null,$.default.createElement(c.FormControl,{disabled:i&&!a,fullWidth:!0},$.default.createElement(c.InputLabel,{id:"demo-simple-select-label"},"Assembly"),$.default.createElement(c.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Assembly",value:l?.name??"",onChange:e=>{const t=v.find((t=>t.name===e.target.value));d(t),s(!1),o(""),r.current&&(r.current.value="")}},v.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))))),$.default.createElement(c.Grid2,null,$.default.createElement(c.InputLabel,null,"Load RefName alias"),$.default.createElement("input",{type:"file",onChange:e=>{(async e=>{if(!e.target.files)return;const t=e.target.files[0],n=(await t.text()).split("\n"),r=new Map(h);o("");for(const e of n){const t=e.split("\t");for(const e of t)r.has(e)&&r.set(e,[...r.get(e)??[],...t])}m(r)})(e).catch((()=>{o("Error reading file")}))},ref:r,disabled:i&&!a||!l}))),l&&h.size>0?$.default.createElement("div",{style:{height:200,width:"100%",marginTop:20}},$.default.createElement(c.InputLabel,null,"Refname aliases found for selected assembly."),$.default.createElement(b.DataGrid,{rows:_(),columns:sI,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],onRowSelectionModelChange:e=>{(e=>{if(e.length>0){s(!0);const t=e.flatMap((e=>_().filter((t=>t.id===e))));p(t)}else s(!1),p([])})(e)},processRowUpdate:(e,t)=>{const n=new Map(h);return n.set(e.refName,e.aliases.split(",")),m(n),e},checkboxSelection:!0})):null),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:!i,onClick:()=>{const n=[];for(const e of f){const{refName:t}=e,r=e.aliases.split(",").map((e=>e.trim())).filter((e=>e.length>0));n.push({refName:t,aliases:r})}if(o(""),!l)return void o("No assembly selected");const r=new Or.AddRefSeqAliasesChange({typeName:"AddRefSeqAliasesChange",assembly:l.name,refSeqAliases:n});e.submit(r).catch((()=>{o("Error submitting change")})),t()}},"Submit"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),a?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},a)):null)}function uI({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),{collaborationServerDriver:r}=t.apolloDataStore,a=n.find((e=>"ApolloInternetAccount"===e.type));if(!a)throw new Error("No Apollo internet account found");const{baseURL:o}=a,[i,s]=u.useState(),[d,f]=u.useState(),[p,h]=u.useState([]),m=r.getAssemblies();return u.useEffect((()=>{!d&&m.length>0&&f(m[0])}),[m,d]),u.useEffect((()=>{(async function(){const e=d?.name;if(!e)return;const t=new URL("checks",o),n=new URLSearchParams({assembly:e});t.search=n.toString();const r=t.toString(),i=a?.getFetcher({locationType:"UriLocation",uri:r});if(i){const e=await i(r,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await Np(e,"Error when retrieving checks");return void s(t)}const t=await e.json();h(t)}})().catch((e=>{s(String(e))}))}),[d,a,o]),$.default.createElement(Vp,{open:!0,fullScreen:!0,title:"View check results",handleClose:e,"data-testid":"view-check-results"},$.default.createElement(c.Select,{style:{width:200,marginLeft:40},value:d?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));f(t)},disabled:0===m.length},m.map((e=>$.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),$.default.createElement(c.DialogContent,null,$.default.createElement(b.DataGrid,{pagination:!0,rows:p,columns:[{field:"_id",headerName:"id",width:50},{field:"name",headerName:"Check name",width:200},{field:"refSeq",headerName:"Reference sequence ID",width:200},{field:"ids",headerName:"Feature IDs",width:200},{field:"message",headerName:"Message",flex:1}],getRowId:e=>e._id,slots:{toolbar:b.GridToolbar},initialState:{sorting:{sortModel:[{field:"name",sort:"asc"}]},columns:{columnVisibilityModel:{name:!0}}}})),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Close")),i?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function dI(e){return e.max-e.min<2?{isSplittable:!1,comment:"This exon is too short to be split"}:{isSplittable:!0,comment:""}}function fI({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:r,sourceAssemblyId:a,sourceFeature:o}){const[i,s]=u.useState(""),d=l.getSnapshot(o);return $.default.createElement(Vp,{open:!0,title:"Split exon",handleClose:t,maxWidth:!1,"data-testid":"split-exon"},$.default.createElement("form",{onSubmit:function(i){i.preventDefault(),s(""),n?._id===o._id&&r();const l=d.min+(d.max-d.min)/2,c=Math.floor(l),u=Math.ceil(l);if(!o.parent?._id)throw new Error("Splitting an exon without parent is not possible yet");const f=new Or.SplitExonChange({changedIds:[o._id],typeName:"SplitExonChange",assembly:a,exonToBeSplit:d,parentFeatureId:o.parent._id,upstreamCut:c,downstreamCut:u,leftExonId:(new _r).toHexString(),rightExonId:(new _r).toHexString()});e.submit(f),t(),i.preventDefault()}},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.DialogContentText,null,function(e){const t=dI(e);return t.isSplittable?"Are you sure you want to split the selected exon?":t.comment}(d))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:!dI(d).isSplittable},"Yes"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},i)):null)}const pI=[{field:"name",headerName:"Assembly Name",width:150,editable:!1},{field:"aliases",headerName:"Aliases",width:300,editable:!0}];function hI({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:r}=n,{collaborationServerDriver:a}=r,o=a.getAssemblies().map((e=>({id:e.name,name:e.displayName??e.name,aliases:e.aliases.join(", ")}))),[i,s]=$.default.useState("");return $.default.createElement(Vp,{open:!0,title:"Add assembly aliases",handleClose:t,maxWidth:"sm","data-testid":"add-assembly-alias",fullWidth:!0},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},$.default.createElement(c.Box,{sx:{height:400,width:"100%"}},$.default.createElement(b.DataGrid,{rows:o,columns:pI,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5],processRowUpdate:(n,r)=>{const a=new Or.AddAssemblyAliasesChange({typeName:"AddAssemblyAliasesChange",assembly:n.id,aliases:n.aliases.split(",")});return e.submit(a).catch((()=>{s("Error submitting change")})),t(),n},disableRowSelectionOnClick:!0}))),i?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},i)):null)}var mI={},gI=eu.exports;Object.defineProperty(mI,"__esModule",{value:!0});var yI=mI.default=void 0;function vI(e){const{color:t}=e;return $.default.createElement(c.SvgIcon,{viewBox:"0 0 18 18",style:{fontSize:18,marginRight:4},...e},"disabled"===t?$.default.createElement("path",{d:"M9.001,10.71 l0,-3.348 l8.424,0 c0.126,0.567,0.225,1.098,0.225,1.845 c0,5.139,-3.447,8.793,-8.64,8.793 c-4.968,0,-9,-4.032,-9,-9 c0,-4.968,4.032,-9,9,-9 c2.43,0,4.464,0.891,6.021,2.349 l-2.556,2.484 c-0.648,-0.612,-1.782,-1.332,-3.465,-1.332 c-2.979,0,-5.409,2.475,-5.409,5.508 c0,3.033,2.43,5.508,5.409,5.508 c3.447,0,4.716,-2.385,4.95,-3.798 l-4.959,0 l0,-0.009 z"}):$.default.createElement($.default.Fragment,null,$.default.createElement("path",{d:"M17.64,9.20454545 c0,-0.638,-0.057,-1.252,-0.164,-1.841 l-8.476,0 l0,3.481 l4.844,0 c-0.209,1.125,-0.843,2.079,-1.796,2.717 l0,2.258 l2.908,0 c1.702,-1.567,2.684,-3.874,2.684,-6.615 l0,0 z",fill:"#4285F4"}),$.default.createElement("path",{d:"M9,18 c2.43,0,4.467,-0.806,5.956,-2.18 l-2.908,-2.259 c-0.806,0.54,-1.837,0.859,-3.048,0.859 c-2.344,0,-4.328,-1.583,-5.036,-3.71 l-3.007,0 l0,2.332 c1.481,2.941,4.525,4.958,8.043,4.958 l0,0 z",fill:"#34A853"}),$.default.createElement("path",{d:"M3.96409091,10.71 c-0.18,-0.54,-0.282,-1.117,-0.282,-1.71 c0,-0.593,0.102,-1.17,0.282,-1.71 l0,-2.332 l-3.007,0 c-0.609,1.215,-0.957,2.59,-0.957,4.042 c0,1.452,0.348,2.827,0.957,4.042 l3.007,-2.332 l0,0 z",fill:"#FBBC05"}),$.default.createElement("path",{d:"M9,3.57954545 c1.321,0,2.508,0.454,3.44,1.346 l2.582,-2.581 c-1.559,-1.453,-3.596,-2.345,-6.022,-2.345 c-3.518,0,-6.562,2.017,-8.043,4.959 l3.007,2.331 c0.708,-2.127,2.692,-3.71,5.036,-3.71 l0,0 z",fill:"#EA4335"})))}function bI(e){const{color:t}=e;return $.default.createElement(c.SvgIcon,{viewBox:"0 0 21 21",style:{fontSize:21},...e},$.default.createElement("rect",{x:"1",y:"1",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#F25022"}),$.default.createElement("rect",{x:"1",y:"11",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#00A4EF"}),$.default.createElement("rect",{x:"11",y:"1",width:"9",height:"9",fill:"disabled"===t?"#939393":"#7FBA00"}),$.default.createElement("rect",{x:"11",y:"11",width:"9",height:"9",fill:"disabled"===t?"#B9B9B9":"#FFB900"}))}yI=mI.default=(0,gI(tu).default)((0,G.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"}),"AccountCircle");const _I=d.makeStyles()((e=>({loginButton:{marginBottom:e.spacing(1),width:"220px",height:"40px",fontSize:"16px",textTransform:"none",justifyContent:"left",padding:"3px 12px"}})));function wI(e){const{classes:t}=_I(),{disabled:n}=e;return $.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:$.default.createElement(vI,{color:n?"disabled":void 0}),...e},"Sign in with Google")}function xI(e){const{classes:t}=_I(),{disabled:n}=e;return $.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:$.default.createElement(bI,{color:n?"disabled":void 0}),...e},"Sign in with Microsoft")}function SI(e){const{classes:t}=_I();return $.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:$.default.createElement(yI,{fontSize:"small"}),...e},"Continue as Guest")}const EI=d.makeStyles()((e=>({divider:{marginTop:e.spacing(4),marginBottom:e.spacing(5)}}))),kI=({baseURL:e,handleClose:t,name:n})=>{const{classes:r}=EI(),[a,o]=u.useState(""),[i,s]=u.useState([]);function l(e){t("google"===e?"google":"microsoft"===e?"microsoft":"guest")}u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return async function(){const t=new URL("auth/types",e).href,r=await fetch(t,{method:"GET",signal:n});if(!r.ok){const e=await Np(r,"Error when retrieving auth types from server");return void o(e)}const a=await r.json();s(a)}().catch((e=>{bN(e)||o(String(e))})),()=>{t.abort()}}),[e]);const d=i.includes("google"),f=i.includes("microsoft"),p=i.includes("guest");return $.default.createElement(Vp,{open:!0,title:`Log in to ${n}`,handleClose:t,maxWidth:!1,"data-testid":"login-apollo"},$.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column",paddingTop:8}},d?$.default.createElement(wI,{disabled:!d,onClick:()=>{l("google")}}):null,f?$.default.createElement(xI,{disabled:!f,onClick:()=>{l("microsoft")}}):null,p?$.default.createElement($.default.Fragment,null,$.default.createElement(c.Divider,{className:r.divider}),$.default.createElement(SI,{onClick:()=>{l("guest")}})):null),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")),a?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},a)):null)},CI="undefined"==typeof sessionStorage,AI=e=>a.InternetAccount.named("ApolloInternetAccount").props({type:l.types.literal("ApolloInternetAccount"),configuration:r.ConfigurationReference(e)}).views((e=>({get baseURL(){return r.getConf(e,"baseURL")},getUserId(){const t=e.retrieveToken();if(t)return Or.getDecodedToken(t).id}}))).volatile((()=>({role:void 0}))).actions((e=>{let t=!1;return{setRole(){const n=e.retrieveToken();if(!n)return void(e.role=void 0);const r=Or.getDecodedToken(n),{role:a}=r;if(!a&&!t){const{session:n}=l.getRoot(e);n.notify("You have registered as a user but have not been given access. Ask your administrator to enable access for your account.","warning"),t=!0}e.role!==a&&(e.role=a)}}})).actions((e=>{let t;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},finishOAuthWindow(t,n,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri.replace("#","?"),o=new URL(a),i=new URLSearchParams(o.search).get("access_token");this.deleteMessageChannel(),i?(e.storeToken(i),e.setRole(),n(i)):r(new Error("Error with token endpoint"))},async openAuthWindow(t,r,a){const o=n.isElectron?"http://localhost/auth":globalThis.location.origin+globalThis.location.pathname,i=new URL("auth/login",e.baseURL),s=new URLSearchParams({type:t,redirect_uri:o});i.search=s.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(n.isElectron){const{ipcRenderer:t}=globalThis.require("electron"),n=await t.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:{redirect_uri:o},url:i.toString()}),s=new MessageEvent("message",{data:{name:l,redirectUri:n}});this.finishOAuthWindow(s,r,a)}else this.addMessageChannel(r,a),window.open(i,l,"width=500,height=600")}}})).actions((e=>({async getTokenFromUser(t,n){const{baseURL:r}=e,a=await new Promise(((t,n)=>{const{session:r}=l.getRoot(e),{baseURL:a,name:o}=e;r.queueDialog((e=>[kI,{name:o,handleClose:r=>{r?r instanceof Error?n(r):t(r):n(new Error("user cancelled entry")),e()},baseURL:a}]))}));if("guest"!==a)return void e.openAuthWindow(a,t,n);const o=new URL("auth/login",r),i=new URLSearchParams({type:a});o.search=i.toString();const s=o.toString(),c=await fetch(s);if(!c.ok){const e=await Np(c,"Error when logging in");return void n(new Error(e))}const{token:u}=await c.json();t(u)}}))).volatile((()=>({lastChangeSequenceNumber:void 0}))).actions((e=>({setLastChangeSequenceNumber(t){e.lastChangeSequenceNumber=t}}))).actions((e=>({updateLastChangeSequenceNumber:l.flow((function*(){const{baseURL:t}=e,n=new URL("changes",t),r=new URLSearchParams({limit:"1"});n.search=r.toString();const a=n.toString(),o=e.getFetcher({locationType:"UriLocation",uri:a}),i=yield o(a,{method:"GET"});if(!i.ok){const e=yield Np(i,"Error when fetching server LastChangeSequence");throw new Error(e)}const s=yield i.json();e.setLastChangeSequenceNumber(s.length>0?s[0].sequence:0)})),getMissingChanges:l.flow((function*(){const{session:t}=l.getRoot(e),{changeManager:n}=t.apolloDataStore;if(!e.lastChangeSequenceNumber)throw new Error("No LastChangeSequence stored in session. Please, refresh you browser to get last updates from server");const{baseURL:r,lastChangeSequenceNumber:a}=e,o=new URL("changes",r),i=new URLSearchParams({since:String(a),sort:"1"});o.search=i.toString();const s=o.toString(),c=e.getFetcher({locationType:"UriLocation",uri:s}),u=yield c(s,{method:"GET"});if(!u.ok)return void console.error(`Error when fetching the last updates to recover socket connection  ${u.status}`);const d=yield u.json();for(const e of d){const t=pe.Change.fromJSON(e);n.submit(t,{submitToBackend:!1})}}))}))).volatile((e=>{const{origin:t,pathname:n}=new URL("socket.io/",e.baseURL);return{socket:Ad(t,{path:n})}})).actions((e=>({addSocketListeners(){const{session:t}=l.getRoot(e),{notify:n}=t,r=e.retrieveToken();if(!r)throw new Error("No Token found");const{socket:a}=e,{addCheckResult:o,changeManager:i,deleteCheckResult:s}=t.apolloDataStore;a.on("connect",(async()=>{await e.getMissingChanges()})),a.on("connect_error",(e=>{console.error(e),n("Could not connect to the Apollo server.","error")})),a.on("COMMON",(e=>{if("checkResult"in e)return void(e.deleted?s(e.checkResult._id.toString()):o(e.checkResult));if(sessionStorage.setItem("LastChangeSequence",String(e.changeSequence)),e.userSessionId===r)return;const t=pe.Change.fromJSON(e.changeInfo);i.submit(t,{submitToBackend:!1})})),a.on("USER_LOCATION",(e=>{const{channel:n,locations:a,userName:o,userSessionId:i}=e,s=Or.getDecodedToken(r),l=Or.makeUserSessionId(s);"USER_LOCATION"===n&&i!==l&&t.addOrUpdateCollaborator({name:o,id:i,locations:a})})),a.on("REQUEST_INFORMATION",(e=>{const{channel:n,userSessionId:a}=e;"REQUEST_INFORMATION"===n&&a!==r&&t.broadcastLocations()}))}}))).actions((e=>({postUserLocation:(t=>{let n;return t=>{clearTimeout(n),n=setTimeout((()=>{!async function(t){const{baseURL:n}=e,r=new URL("users/userLocation",n).href,a=new URLSearchParams(JSON.stringify(t)),o=e.getFetcher({locationType:"UriLocation",uri:r});try{if(!(await o(r,{method:"POST",body:a})).ok)throw new Error("ignore")}catch{console.error("Broadcasting user location failed")}}(t)}),300)}})()}))).actions((e=>({initialize:l.flow((function*(t){if("admin"===t){const t=l.getRoot(e);n.isAbstractMenuManager(t)&&function(e){e.appendToMenu("Apollo",{label:"Add Assembly",onClick:e=>{e.queueDialog((t=>[Zp,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Delete Assembly",onClick:e=>{e.queueDialog((t=>[lR,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Import Features",onClick:e=>{e.queueDialog((t=>[fR,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Add reference sequence aliases",onClick:e=>{e.queueDialog((t=>[cI,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Add Assembly aliases",onClick:e=>{e.queueDialog((t=>[hI,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Manage Users",onClick:e=>{e.queueDialog((t=>[vR,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Undo",onClick:e=>{const{apolloDataStore:t}=e,{notify:n}=e;t.changeManager.recentChanges.length>0?t.changeManager.revertLastChange():n("No changes to undo","info")}})}(t)}yield e.updateLastChangeSequenceNumber(),e.addSocketListeners();const{baseURL:r}=e,a=new URL("users/locations",r).href,o=e.getFetcher({locationType:"UriLocation",uri:a});yield o(a,{method:"GET"}),window.addEventListener("beforeunload",(()=>{e.postUserLocation([])})),document.addEventListener("visibilitychange",(()=>{if("hidden"===document.visibilityState&&e.postUserLocation([]),"visible"===document.visibilityState){const{session:t}=l.getRoot(e);t.broadcastLocations()}}))}))}))).actions((e=>({afterAttach(){e.setRole(),s.autorun((async t=>{if(CI)return;const{session:n}=l.getRoot(e);n&&e.role&&(await e.initialize(e.role),t.dispose())}),{name:"ApolloInternetAccount"})}}))),OI="undefined"==typeof sessionStorage;class TI extends M.BaseAdapter{refNameAliases;async getRefNameAliases(){const e=r.readConfObject(this.config,"assemblyId");if(!OI){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e);return await n.getRefNameAliases(e)}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n(new Error("timeout"))}),2e4),a=SR(),o=e=>{const n=e.data;(function(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo&&"refNameAliases"in e})(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.refNameAliases))};addEventListener("message",o),rpcServer.emit("apollo",{apollo:!0,method:"getRefNameAliases",assembly:e,messageId:a})}));return this.refNameAliases=t,t}freeResources(){}}var NI=r.ConfigurationSchema("ApolloRefNameAliasAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),RI={};function II(e){return"uniqueId"in e&&"object"!==xe(e.data)}Object.defineProperty(RI,"__esModule",{value:!0}),RI.isFeature=function(e){return"object"===xe(e)&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id};var PI=function(){function e(t){var n,r=this;ke(this,e),II(t)?this.data=t:(this.data=t.data,this.parentHandle=t.parent);var a=II(t)?t.uniqueId:t.id;if(null==a)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(a),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(n=this.data.subfeatures)||void 0===n?void 0:n.map((function(t,n){return"function"!=typeof t.get?new e({id:t.uniqueId||"".concat(a,"-").concat(n),data:_e({strand:r.data.strand},t),parent:r}):t})))}return Ae(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=_e(_e({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e(_e({},t))}}]),e}(),FI=RI.default=PI;function MI(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo}const jI="undefined"==typeof sessionStorage;class DI extends M.BaseSequenceAdapter{regions;async getRefNames(){return(await this.getRegions()).map((e=>e.refName))}async getRegions(){if(this.regions)return this.regions;const e=r.readConfObject(this.config,"assemblyId");if(!jI){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e),r=await n.getRegions(e);return this.regions=r,r}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n("timeout")}),2e4),a=SR(),o=e=>{const{data:n}=e;MI(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.regions))};addEventListener("message",o),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getRegions",assembly:e,messageId:a})}));return this.regions=t,t}getFeatures(e){const{end:t,refName:n,start:a}=e,o=r.readConfObject(this.config,"assemblyId"),i={...e,assemblyName:o};return j.ObservableCreate((async e=>{if(!jI){const r=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!r)return void e.error("No Apollo data store found");const s=r.getBackendDriver(o),l=(await s.getRegions(i.assemblyName)).find((e=>e.refName===i.refName));if(!l)return void e.error("Cannot get region");i.end>l.end&&(i.end=l.end);const{seq:c}=await s.getSequence(i);return e.next(new FI({id:`${n} ${a}-${t}`,data:{refName:n,start:a,end:t,seq:c}})),void e.complete()}const r=await new Promise(((e,t)=>{const n=setTimeout((()=>{t("timeout")}),2e4),r=SR(),a=t=>{const{data:o}=t;MI(o)&&o.messageId===r&&(clearTimeout(n),removeEventListener("message",a),e(o.sequence))};addEventListener("message",a),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getSequence",region:i,messageId:r})}));e.next(new FI({id:`${n} ${a}-${t}`,data:{refName:n,start:a,end:t,seq:r}})),e.complete()}))}freeResources(){}}var LI=r.ConfigurationSchema("ApolloSequenceAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),BI={};Object.defineProperty(BI,"__esModule",{value:!0}),BI.RefSequenceResult=void 0;var qI=function(){function e(t){ke(this,e),this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}return Ae(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"hasLocation",value:function(){return!!this.locString}},{key:"getLocation",value:function(){return this.locString}},{key:"getComboResults",value:function(){return this.results}}]),e}(),UI=BI.default=qI,zI=function(e){Te(n,e);var t=De(n);function n(e){var r,a;return ke(this,n),(r=t.call(this,e)).refName=null!==(a=e.refName)&&void 0!==a?a:"",r}return Ae(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(qI);BI.RefSequenceResult=zI;class GI extends M.BaseAdapter{get baseURL(){return r.readConfObject(this.config,"baseURL").uri}get trackId(){return r.readConfObject(this.config,"trackId")}get assemblyNames(){return r.readConfObject(this.config,"assemblyNames")}mapBaseResult(e,t,n){return e.map((e=>{const r=t.getCanonicalRefName(e.refSeq);return new UI({label:n,trackId:this.trackId,locString:`${r}:${e.min+1}..${e.max}`})}))}async searchIndex(e){const t=e.queryString,n=[],r=this.pluginManager?.rootModel?.session;if(!r)return n;const{apolloDataStore:a}=r,{assemblyManager:o}=r;for(const r of this.assemblyNames){const i=a.getBackendDriver(r),s=o.get(r);if(!i||!s)continue;const l=await i.searchFeatures(e.queryString,[r]);n.push(...this.mapBaseResult(l,s,t))}return n}freeResources(){}}var HI=r.ConfigurationSchema("ApolloTextSearchAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"},trackId:{type:"string",defaultValue:""},baseURL:{type:"fileLocation",defaultValue:{uri:"",locationType:"UriLocation"}}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),$I={},WI=eu.exports;Object.defineProperty($I,"__esModule",{value:!0});var VI=$I.default=void 0;VI=$I.default=(0,WI(tu).default)((0,G.default.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var JI={},YI=eu.exports;Object.defineProperty(JI,"__esModule",{value:!0});var KI=JI.default=void 0;KI=JI.default=(0,YI(tu).default)((0,G.default.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");var ZI={},XI=eu.exports;Object.defineProperty(ZI,"__esModule",{value:!0});var QI=ZI.default=void 0;QI=ZI.default=(0,XI(tu).default)((0,G.default.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreHoriz");const eP=d.makeStyles()((e=>({attributeKey:{fontWeight:"bold",marginRight:e.spacing(2)}})));function tP({attributeKey:e}){const{classes:t}=eP(),n=/^[A-Z]/.test(e);let r,a=e;return Or.isGFFInternalAttribute(e)?(a=Or.internalToGFF[e],r=`On GFF3 export, this will be assigned to the GFF3's reserved "${a}" attribute`):Or.isGFFColumnInternal(e)?(a=Or.gffInternalToColumn[e],r=`On GFF3 export, this will be placed in the GFF3's "${a}" column`):n&&(r="On GFF3 export, this attribute will be changed to start with a lower-case letter because attributes starting with an upper-case letter are reserved in GFF3"),$.default.createElement("div",{style:{display:"flex"}},$.default.createElement(c.Typography,{className:t.attributeKey},a),r?$.default.createElement(c.Tooltip,{title:r},$.default.createElement(c.Chip,{icon:$.default.createElement(Pp,null),label:"GFF3",size:"small",variant:"outlined"})):null)}const nP="Custom",rP={[nP]:"custom"};for(const[e,t]of Object.entries(Or.gffToInternal))rP[`GFF ${t}`]=e;for(const[e,t]of Object.entries(Or.gffColumnToInternal))rP[`GFF ${t}`]=e;const aP=p.observer((function({setKey:e,session:t}){const{pluginManager:r}=n.getEnv(t),a=r.evaluateExtensionPoint("Apollo-ReservedAttributeKeys",rP),o=Object.keys(a).at(0)??nP,[i,s]=u.useState(o),[l,d]=u.useState(),f=i===nP;return $.default.createElement("form",{onSubmit:function(t){t.preventDefault(),e(f?l:a[i])}},$.default.createElement("div",{style:{display:"flex",flexDirection:"column",margin:8}},$.default.createElement(c.FormControl,{variant:"outlined"},$.default.createElement(c.InputLabel,{id:"attribute-key-select-label"},"Key"),$.default.createElement(c.Select,{labelId:"attribute-key-select-label",value:i,label:"Key",onChange:e=>{s(e.target.value)}},Object.keys(a).map((e=>$.default.createElement(c.MenuItem,{key:e,value:e},e))))),f?$.default.createElement(c.TextField,{label:"Attribute key",variant:"outlined",id:"attributeKey",onChange:e=>{d(e.target.value)}}):null),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{color:"primary",variant:"contained",type:"submit",disabled:f&&!l},"Add"),$.default.createElement(c.Button,{variant:"outlined",onClick:function(){e()}},"Cancel")))}));var oP={},iP=eu.exports;Object.defineProperty(oP,"__esModule",{value:!0});var sP=oP.default=void 0;sP=oP.default=(0,iP(tu).default)((0,G.default.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");const lP=p.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,l]=u.useState(null);return u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),$.default.createElement(c.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{r!==String(t)&&e(r)},inputRef:e=>{l(e)}})})),cP=p.observer((function({attributeValues:e,setAttribute:t,isNew:n=!1}){const[r,a]=u.useState(e&&e.length>0?e:[""]);return $.default.createElement($.default.Fragment,null,r.map(((e,t)=>$.default.createElement("div",{key:`${t}-${e}`,style:{display:"flex"}},$.default.createElement(lP,{value:e,onChangeCommitted:e=>{!function(e,t){a((n=>{const r=[...n];return r[e]=t,r}))}(t,e)},variant:"outlined",fullWidth:!0}),$.default.createElement(c.IconButton,{"aria-label":"delete",size:"medium",edge:"end",onClick:()=>{!function(e){a((t=>{const n=[...t];return n.splice(e,1),n}))}(t)}},$.default.createElement(yR,{fontSize:"inherit"}))))),$.default.createElement(c.IconButton,{"aria-label":"add",size:"medium",color:"secondary",edge:"start",onClick:function(){a((e=>{const t=[...e];return t.push(""),t}))}},$.default.createElement(sP,{fontSize:"inherit"})),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{color:"primary",variant:"contained",onClick:()=>{t(r.filter(Boolean))}},n?"Add":"Update"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")))}));function uP({values:e}){return $.default.createElement($.default.Fragment,null,e?.map(((e,t)=>$.default.createElement(c.Typography,{key:`${t}.${e}`,variant:"body2",color:"textSecondary"},e))))}const dP=d.makeStyles()((e=>({list:{"li:nth-of-type(odd)":{backgroundColor:e.palette.action.focus},"li:nth-of-type(even)":{backgroundColor:e.palette.action.hover}}}))),fP=p.observer((function({assembly:e,editable:t,feature:r,session:a}){const{pluginManager:o}=n.getEnv(a),{classes:i}=dP(),[d,f]=u.useState(null),[p,h]=u.useState(null),[m,g]=u.useState(null),[y,v]=u.useState(!1),[b,_]=u.useState(),w=Boolean(d),{changeManager:x}=a.apolloDataStore,{notify:S}=a;function E(){f(null),h(null)}const{_id:k,attributes:C}=r,A=o.evaluateExtensionPoint("Apollo-AttributeEditorComponent",cP,{key:b});return $.default.createElement($.default.Fragment,null,$.default.createElement(c.List,{className:i.list},s.entries(C).map((([n,i])=>{const s=o.evaluateExtensionPoint("Apollo-AttributeEditorComponent",cP,{key:n}),u=o.evaluateExtensionPoint("Apollo-AttributeViewerComponent",uP,{key:n});return $.default.createElement(c.ListItem,{key:n,secondaryAction:t&&!m?$.default.createElement(c.IconButton,{edge:"end",onClick:e=>{!function(e,t){f(e.currentTarget),h(t)}(e,n)}},$.default.createElement(QI,null)):null},$.default.createElement(c.ListItemText,{disableTypography:!0,primary:$.default.createElement(tP,{attributeKey:n}),secondary:m===n?$.default.createElement(s,{session:a,attributeValues:i,setAttribute:t=>{g(null),t&&function(t,n){const a={...l.getSnapshot(C)},o=structuredClone(a);if(!(t in a))return void S(`"${t}" not found in feature attributes`,"error");if(a[t].toString()===n.toString())return;a[t]=n;const i=new Or.FeatureAttributeChange({changedIds:[r._id],typeName:"FeatureAttributeChange",assembly:e,featureId:r._id,oldAttributes:o,newAttributes:a});x.submit(i)}(n,t)}}):$.default.createElement(u,{values:i})}))})),b?$.default.createElement(c.ListItem,null,$.default.createElement(c.ListItemText,{disableTypography:!0,primary:$.default.createElement(tP,{attributeKey:b}),secondary:$.default.createElement(A,{session:a,attributeValues:[],setAttribute:t=>{t&&function(t,n){const a={...l.getSnapshot(C)},o=structuredClone(a);if(t in a)return void S(`Feature already has attribute "${t}"`,"error");a[t]=n;const i=new Or.FeatureAttributeChange({changedIds:[r._id],typeName:"FeatureAttributeChange",assembly:e,featureId:r._id,oldAttributes:o,newAttributes:a});x.submit(i)}(b,t),_(void 0)},isNew:!0})})):null),t?$.default.createElement(c.Button,{color:"primary",variant:"contained",disabled:y||Boolean(b),onClick:()=>{v(!0)}},"Add new"):null,y?$.default.createElement(c.Paper,{variant:"outlined",style:{marginTop:8}},$.default.createElement(aP,{session:a,setKey:e=>{_(e),v(!1)}})):null,$.default.createElement(c.Menu,{anchorEl:d,open:w,onClose:E},$.default.createElement(c.MenuItem,{onClick:function(){p&&function(t){const n=l.getSnapshot(C),{[t]:r,...a}=n,o=new Or.FeatureAttributeChange({changedIds:[k],typeName:"FeatureAttributeChange",assembly:e,featureId:k,oldAttributes:n,newAttributes:a});x.submit(o)}(p),E()}},$.default.createElement(c.ListItemIcon,null,$.default.createElement(yR,{fontSize:"small"})),$.default.createElement(c.Typography,{variant:"inherit"},"Delete")),$.default.createElement(c.MenuItem,{onClick:function(){p&&g(p),E()}},$.default.createElement(c.ListItemIcon,null,$.default.createElement(KI,{fontSize:"small"})),$.default.createElement(c.Typography,{variant:"inherit"},"Edit"))))})),pP=p.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,l]=u.useState(null);u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]);const d=Number.isNaN(Number(r));return $.default.createElement(c.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{const n=Number(r);r!==String(t)&&(Number.isNaN(n)?a(String(t)):e(n))},inputRef:e=>{l(e)},error:d,helperText:d?"Not a valid number":void 0})})),hP=p.observer((function({assembly:e,feature:t,session:n}){const[r,a]=u.useState(""),[o,i]=u.useState(""),{_id:s,assemblyId:l,max:d,min:f,strand:p,type:h}=t,m=e=>{n.notify(e.message,"error")},{changeManager:g}=n.apolloDataStore;function y(t){const{value:n}=t.target,r=n?Number(n):void 0,a=new Or.StrandChange({typeName:"StrandChange",changedIds:[s],featureId:s,oldStrand:p,newStrand:r,assembly:e});return g.submit(a)}return $.default.createElement("div",{"data-testid":"basic_information"},$.default.createElement(pP,{margin:"dense",id:"start",label:"Start",fullWidth:!0,variant:"outlined",value:f+1,onChangeCommitted:function(t){t--;const n=new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[s],featureId:s,oldStart:f,newStart:t,assembly:e});return g.submit(n)}}),$.default.createElement(pP,{margin:"dense",id:"end",label:"End",fullWidth:!0,variant:"outlined",value:d,onChangeCommitted:function(t){const n=new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[s],featureId:s,oldEnd:d,newEnd:t,assembly:e});return g.submit(n)}}),$.default.createElement(tR,{session:n,ontologyName:"Sequence Ontology",value:h,filterTerms:XN,fetchValidTerms:async function(e,t,n){const r=await eR(e,t);if(r)return r;i(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,t),renderInput:e=>$.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(o),helperText:o}),onChange:(e,t)=>{t&&function(e){a("");const t=new Or.TypeChange({typeName:"TypeChange",changedIds:[s],featureId:s,oldType:h,newType:e,assembly:l});return g.submit(t)}(t).catch(m)}}),$.default.createElement("label",null,$.default.createElement("input",{type:"radio",value:"1",checked:1===p,onChange:y}),"Positive Strand (+)"),$.default.createElement("label",null,$.default.createElement("input",{type:"radio",value:"-1",checked:-1===p,onChange:y}),"Negative Strand (-)"),$.default.createElement("label",null,$.default.createElement("input",{type:"radio",value:"",checked:void 0===p,onChange:y}),"No Strand Information"),r?$.default.createElement(c.Typography,{color:"error"},r):null)})),mP=p.observer((function(e){const{feature:t,model:n}=e,{children:r,parent:a}=t,o=[];if(r)for(const[,e]of r)o.push(e);return a??o.length>0?$.default.createElement("div",{style:{marginTop:10}},a&&$.default.createElement("div",null,$.default.createElement(c.Typography,{variant:"h6"},"Parent:"),$.default.createElement(c.Button,{variant:"contained",onClick:()=>{n.setFeature(a)}},a.type,Sp(a)," (",a.min,"..",a.max,")")),o.length>0&&$.default.createElement("div",null,$.default.createElement(c.Typography,{variant:"h6"},1===o.length?"Child":"Children",":"),o.map((e=>$.default.createElement("div",{key:e._id,style:{marginBottom:5}},$.default.createElement(c.Button,{variant:"contained",onClick:()=>{n.setFeature(e)}},e.type,Sp(e)," (",e.min,"..",e.max,")")))))):null})),gP=d.makeStyles()({sequence:{width:"100%",resize:"vertical"}}),yP=p.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),{classes:o}=gP();if(!t||!a)return null;const i=a.getByRefName(n);if(!i)return null;const{max:s,min:l}=t;let c=i.getSequence(l,s);return c?c=function(e,t,n,r,a){return`>${t}:${n+1}${r}\n${e}`}(c,n,l,s):r.apolloDataStore.loadRefSeq([{assemblyName:e,refName:n,start:l,end:s}]),$.default.createElement("div",null,$.default.createElement("textarea",{readOnly:!0,rows:20,className:o.sequence,value:c}))})),vP=d.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),bP=p.observer((function(e){const{model:t}=e,{assembly:r,feature:a,refName:o}=t,i=n.getSession(t),s=i.apolloDataStore.assemblies.get(r),{classes:l}=vP(),[d,f]=u.useState(["attributes"]);if(u.useEffect((()=>{f(["attributes"])}),[a]),!a||!s)return null;const p=s.getByRefName(o);if(!p)return null;const{max:h,min:m}=a;function g(e,t){f(e?[...d,t]:d.filter((e=>e!==t)))}return p.getSequence(m,h)||i.apolloDataStore.loadRefSeq([{assemblyName:r,refName:o,start:m,end:h}]),$.default.createElement("div",{className:l.root},$.default.createElement(hP,{feature:a,session:i,assembly:s._id}),$.default.createElement(c.Accordion,{style:{marginTop:10},expanded:d.includes("attributes"),onChange:(e,t)=>{g(t,"attributes")}},$.default.createElement(c.AccordionSummary,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},$.default.createElement(c.Typography,{component:"span"},"Attributes")),$.default.createElement(c.AccordionDetails,null,$.default.createElement(fP,{feature:a,session:i,assembly:s._id,editable:!0}))),$.default.createElement(c.Accordion,{style:{marginTop:10},expanded:d.includes("sequence"),onChange:(e,t)=>{g(t,"sequence")}},$.default.createElement(c.AccordionSummary,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},$.default.createElement(c.Typography,{component:"span"},"Sequence")),$.default.createElement(c.AccordionDetails,null,d.includes("sequence")&&$.default.createElement(yP,{feature:a,session:i,assembly:s._id,refName:o}))),$.default.createElement(c.Accordion,{style:{marginTop:10},expanded:d.includes("related_features"),onChange:(e,t)=>{g(t,"related_features")}},$.default.createElement(c.AccordionSummary,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},$.default.createElement(c.Typography,{component:"span"},"Related features")),$.default.createElement(c.AccordionDetails,null,$.default.createElement(mP,{model:t,feature:a}))))}));var _P={},wP={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationFeatureModel=void 0;var t=U.default,n=H.default,r=_P,a=n.types.late((function(){return e.AnnotationFeatureModel}));e.AnnotationFeatureModel=n.types.model("AnnotationFeatureModel",{_id:n.types.identifier,refSeq:n.types.string,type:n.types.string,min:n.types.number,max:n.types.number,strand:n.types.maybe(n.types.union(n.types.literal(1),n.types.literal(-1))),children:n.types.maybe(n.types.map(a)),attributes:n.types.map(n.types.array(n.types.string)),updatedAt:n.types.maybe(n.types.string)}).views((function(e){return{get length(){return e.max-e.min},get featureId(){return e.attributes.get("id")},get minWithChildren(){var t=e.min,n=e.children;if(!n)return t;var r,a=Ve(n);try{for(a.s();!(r=a.n()).done;){var o=Be(r.value,2);t=Math.min(t,o[1].min)}}catch(e){a.e(e)}finally{a.f()}return t},get maxWithChildren(){var t=e.max,n=e.children;if(!n)return t;var r,a=Ve(n);try{for(a.s();!(r=a.n()).done;){var o=Be(r.value,2);t=Math.max(t,o[1].max)}}catch(e){a.e(e)}finally{a.f()}return t},hasDescendant:function(t){var n=e.children;if(!n)return!1;var r,a=Ve(n);try{for(a.s();!(r=a.n()).done;){var o=Be(r.value,2);if(o[0]===t)return!0;if(o[1].hasDescendant(t))return!0}}catch(e){a.e(e)}finally{a.f()}return!1},get transcriptExonParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent, cannot calculate exon locations");var r=e.children;if(!r)throw new Error("No exons in transcript");var a,o=Ue(r.values()).filter((function(e){return n.isTypeOf(e.type,"exon")})).sort((function(e,t){return e.min-t.min})),i=e.min,s=[],l=Ve(o);try{for(l.s();!(a=l.n()).done;){var c=a.value;c.min>i&&s.push({min:i,max:c.min,type:"intron"}),s.push({min:c.min,max:c.max,type:"exon"}),i=c.max}}catch(e){l.e(e)}finally{l.f()}return i<e.max&&s.push({min:i,max:e.max,type:"intron"}),-1===e.strand&&s.reverse(),s},get transcriptParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error('Only features of type "transcript" or equivalent can calculate CDS locations');var r=e.children;if(!r)throw new Error("no CDS or exons in transcript");var a=Ue(r.values()).filter((function(e){return n.isTypeOf(e.type,"CDS")})),o=[];if(0===a.length)return o.push(this.transcriptExonParts),o;var i,s=Ve(a);try{var l=function(){var a,s=i.value,l=s.max,c=s.min,u=[],d=!1,f=[],p=Ve(r);try{for(p.s();!(a=p.n()).done;){var h=Be(a.value,2)[1];n.isTypeOf(h.type,"exon")&&f.push({min:h.min,max:h.max})}}catch(e){p.e(e)}finally{p.f()}f.sort((function(e,t){return e.min-t.min}));for(var m=0,g=f;m<g.length;m++){var y=g[m],v=u.at(-1);v&&u.push({min:v.max,max:y.min,type:"intron"});var b,_=Be((0,t.intersection2)(c,l,y.min,y.max),2),w=_[0],x=_[1];b=d?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==w&&void 0!==x?(d=!0,w===y.min&&x===y.max?u.push({min:w,max:x,phase:0,type:"CDS"}):w===y.min?u.push({min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:b}):x===y.max?u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"}):u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:"fivePrimeUTR"===b?"threePrimeUTR":"fivePrimeUTR"})):u.push({min:y.min,max:y.max,type:b})}u.sort((function(e,t){return e.min-t.min})),-1===e.strand&&u.reverse();var S=0,E=u.map((function(e){if("CDS"!==e.type)return e;var t=S;return S=(3-(e.max-e.min-t+3)%3)%3,_e(_e({},e),{},{phase:t})}));o.push(E)};for(s.s();!(i=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}return o}}})).views((function(e){return{get cdsLocations(){return e.transcriptParts.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))},get looksLikeGene(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n)return!1;var r=e.children;if(null==r||!r.size)return!1;if(!n.isTypeOf(e.type,"gene")&&!n.isTypeOf(e.type,"pseudogene"))return!1;var a,o=Ve(r);try{for(o.s();!(a=o.n()).done;){var i=Be(a.value,2)[1];if(n.isTypeOf(i.type,"transcript")||n.isTypeOf(i.type,"pseudogenic_transcript")){var s=i.children;return!(null==s||!s.size)&&Ue(s.values()).some((function(e){return n.isTypeOf(e.type,"exon")}))}}}catch(e){o.e(e)}finally{o.f()}return!1}}})).actions((function(e){return{setAttributes:function(t){e.attributes.clear();var n,r=Ve(t.entries());try{for(r.s();!(n=r.n()).done;){var a=Be(n.value,2);e.attributes.set(a[0],a[1])}}catch(e){r.e(e)}finally{r.f()}},setAttribute:function(t,n){e.attributes.merge(Oe({},t,n))},setType:function(t){e.type=t},setRefSeq:function(t){e.refSeq=t},setMin:function(t){if(t>e.max)throw new Error('Min "'.concat(t+1,'" is greater than max "').concat(e.max,'"'));e.min!==t&&(e.min=t)},setMax:function(t){if(t<e.min)throw new Error('Max "'.concat(t,'" is less than Min "').concat(e.min,'"'));e.max!==t&&(e.max=t)},setStrand:function(t){e.strand=t},addChild:function(t){if(e.children&&e.children.size>0){var r=(0,n.getSnapshot)(e.children);e.children.clear();var a,o=Ve(Object.entries(_e(_e({},r),{},Oe({},t._id,t))).sort((function(e,t){var n=Be(e,2)[1],r=Be(t,2);return n.min-r[1].min})));try{for(o.s();!(a=o.n()).done;){var i=Be(a.value,2);e.children.put(i[1])}}catch(e){o.e(e)}finally{o.f()}}else{var s;e.children=(0,n.cast)({}),null===(s=e.children)||void 0===s||s.put(t)}},deleteChild:function(t){var n;null===(n=e.children)||void 0===n||n.delete(t)}}})).actions((function(e){return{update:function(t){var r=t.children,a=t.max,o=t.min,i=t.strand;e.setRefSeq(t.refSeq),e.setMin(o),e.setMax(a),e.setStrand(i),r&&(e.children=(0,n.cast)(r))}}})).views((function(t){return{get parent(){var r;try{r=(0,n.getParentOfType)(t,e.AnnotationFeatureModel)}catch(e){}return r},get topLevelFeature(){var r,a=t;do{try{a=r=(0,n.getParentOfType)(a,e.AnnotationFeatureModel)}catch(e){r=void 0}}while(r);return a},get assemblyId(){return(0,n.getParentOfType)(t,r.ApolloAssembly)._id}}}))}(wP);var xP={},SP={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ApolloRefSeq=e.Sequence=void 0;var t=U.default,n=H.default,r=wP;e.Sequence=n.types.model({start:n.types.number,stop:n.types.number,sequence:n.types.string}),e.ApolloRefSeq=n.types.model("ApolloRefSeq",{_id:n.types.identifier,name:n.types.string,description:"",features:n.types.map(r.AnnotationFeatureModel),sequence:n.types.array(e.Sequence)}).actions((function(e){return{addFeature:function(t){e.features.put(t)},deleteFeature:function(t){return e.features.delete(t)},setDescription:function(t){e.description=t},addSequence:function(t){var n;if(t.sequence.length!==t.stop-t.start)throw new Error("sequence does not match declared length: ".concat(JSON.stringify(t)));if(0!==e.sequence.length){var r=e.sequence.map((function(e){return{start:e.start,stop:e.stop,sequence:e.sequence}}));r.push({start:t.start,stop:t.stop,sequence:t.sequence}),r.sort((function(e,t){return e.start===t.start?e.stop-t.stop:e.start-t.start}));var a,o=r.reduce((function(e,t){var n=e.at(-1);if(void 0===n)return[t];if(n.stop>=t.start){if(t.stop>n.stop){var r=n.stop-t.start;n.stop=t.stop,n.sequence+=t.sequence.slice(r)}}else e.push(t);return e}),[]),i=Ve(o);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.sequence.length!==s.stop-s.start)throw new Error("Consolidated sequence does not match declared length")}}catch(e){i.e(e)}finally{i.f()}e.sequence.length===o.length&&e.sequence.every((function(e,t){return e.start===o[t].start&&e.stop===o[t].stop}))||(e.sequence.clear(),(n=e.sequence).push.apply(n,Ue(o)))}else e.sequence.push(t)}}})).views((function(e){return{getSequence:function(n,r){var a,o=Ve(e.sequence);try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.sequence,l=i.start;if((0,t.isContainedWithin)(n,r,l,i.stop))return s.slice(n-l,r-l)}}catch(e){o.e(e)}finally{o.f()}return""},getFeatures:function(n,r){var a,o=[],i=Ve(e.features);try{for(i.s();!(a=i.n()).done;){var s=Be(a.value,2)[1];(0,t.doesIntersect2)(s.min,s.max,n,r)&&o.push(s)}}catch(e){i.e(e)}finally{i.f()}return o}}}))}(SP),Object.defineProperty(xP,"__esModule",{value:!0}),xP.ApolloAssembly=void 0;var EP=H.default;xP.ApolloAssembly=EP.types.model("ApolloAssembly",{_id:EP.types.identifier,refSeqs:EP.types.map(SP.ApolloRefSeq),comments:EP.types.array(EP.types.string),backendDriverType:EP.types.optional(EP.types.enumeration("backendDriverType",["CollaborationServerDriver","InMemoryFileDriver","DesktopFileDriver"]),"CollaborationServerDriver")}).views((function(e){return{getByRefName:function(t){return Ue(e.refSeqs.values()).find((function(e){return e.name===t}))}}})).actions((function(e){return{addRefSeq:function(t,n,r){return e.refSeqs.put({_id:t,name:n,description:r})},addComment:function(t){return e.comments.push(t)}}}));var kP={};Object.defineProperty(kP,"__esModule",{value:!0}),kP.CheckResult=void 0;var CP=H.default;kP.CheckResult=CP.types.model("CheckResult",{_id:CP.types.identifier,name:CP.types.string,cause:CP.types.string,ids:CP.types.array(CP.types.safeReference(wP.AnnotationFeatureModel)),refSeq:CP.types.string,start:CP.types.number,end:CP.types.number,ignored:!1,message:CP.types.string}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Ct;t.__exportStar(wP,e),t.__exportStar(xP,e),t.__exportStar(SP,e),t.__exportStar(kP,e)}(_P);const AP=l.types.model("ApolloFeatureDetailsWidget",{id:h.ElementId,type:l.types.literal("ApolloFeatureDetailsWidget"),feature:l.types.maybe(l.types.reference(_P.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:l.types.string,refName:l.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}}))),OP=l.types.model("ApolloTranscriptDetails",{id:h.ElementId,type:l.types.literal("ApolloTranscriptDetails"),feature:l.types.maybe(l.types.reference(_P.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:l.types.string,refName:l.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}})));function TP(){return TP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},TP.apply(this,arguments)}function NP(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var RP=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,IP=NP((function(e){return RP.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),PP=function(){function e(e){var t=this;this._insertTag=function(e){t.container.insertBefore(e,0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling),t.tags.push(e)},this.isSpeedy=void 0===e.speedy?"production"===fn.env.NODE_ENV:e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if("production"!==fn.env.NODE_ENV){var n=64===e.charCodeAt(0)&&105===e.charCodeAt(1);n&&this._alreadyInsertedOrderInsensitiveRule&&console.error("You're attempting to insert the following rule:\n"+e+"\n\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules."),this._alreadyInsertedOrderInsensitiveRule=this._alreadyInsertedOrderInsensitiveRule||!n}if(this.isSpeedy){var r=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{r.insertRule(e,r.cssRules.length)}catch(t){"production"===fn.env.NODE_ENV||/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(e)||console.error('There was a problem inserting the following rule: "'+e+'"',t)}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0,"production"!==fn.env.NODE_ENV&&(this._alreadyInsertedOrderInsensitiveRule=!1)},e}(),FP="-ms-",MP="-moz-",jP="-webkit-",DP="comm",LP="rule",BP="decl",qP="@keyframes",UP=Math.abs,zP=String.fromCharCode,GP=Object.assign;function HP(e){return e.trim()}function $P(e,t,n){return e.replace(t,n)}function WP(e,t){return e.indexOf(t)}function VP(e,t){return 0|e.charCodeAt(t)}function JP(e,t,n){return e.slice(t,n)}function YP(e){return e.length}function KP(e){return e.length}function ZP(e,t){return t.push(e),e}var XP=1,QP=1,eF=0,tF=0,nF=0,rF="";function aF(e,t,n,r,a,o,i){return{value:e,root:t,parent:n,type:r,props:a,children:o,line:XP,column:QP,length:i,return:""}}function oF(e,t){return GP(aF("",null,null,"",null,null,0),e,{length:-e.length},t)}function iF(){return nF=tF>0?VP(rF,--tF):0,QP--,10===nF&&(QP=1,XP--),nF}function sF(){return nF=tF<eF?VP(rF,tF++):0,QP++,10===nF&&(QP=1,XP++),nF}function lF(){return VP(rF,tF)}function cF(){return tF}function uF(e,t){return JP(rF,e,t)}function dF(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function fF(e){return XP=QP=1,eF=YP(rF=e),tF=0,[]}function pF(e){return rF="",e}function hF(e){return HP(uF(tF-1,yF(91===e?e+2:40===e?e+1:e)))}function mF(e){for(;(nF=lF())&&nF<33;)sF();return dF(e)>2||dF(nF)>3?"":" "}function gF(e,t){for(;--t&&sF()&&!(nF<48||nF>102||nF>57&&nF<65||nF>70&&nF<97););return uF(e,cF()+(t<6&&32==lF()&&32==sF()))}function yF(e){for(;sF();)switch(nF){case e:return tF;case 34:case 39:34!==e&&39!==e&&yF(nF);break;case 40:41===e&&yF(e);break;case 92:sF()}return tF}function vF(e,t){for(;sF()&&e+nF!==57&&(e+nF!==84||47!==lF()););return"/*"+uF(t,tF-1)+"*"+zP(47===e?e:sF())}function bF(e){for(;!dF(lF());)sF();return uF(e,tF)}function _F(e){return pF(wF("",null,null,null,[""],e=fF(e),0,[0],e))}function wF(e,t,n,r,a,o,i,s,l){for(var c=0,u=0,d=i,f=0,p=0,h=0,m=1,g=1,y=1,v=0,b="",_=a,w=o,x=r,S=b;g;)switch(h=v,v=sF()){case 40:if(108!=h&&58==VP(S,d-1)){-1!=WP(S+=$P(hF(v),"&","&\f"),"&\f")&&(y=-1);break}case 34:case 39:case 91:S+=hF(v);break;case 9:case 10:case 13:case 32:S+=mF(h);break;case 92:S+=gF(cF()-1,7);continue;case 47:switch(lF()){case 42:case 47:ZP(SF(vF(sF(),cF()),t,n),l);break;default:S+="/"}break;case 123*m:s[c++]=YP(S)*y;case 125*m:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:-1==y&&(S=$P(S,/\f/g,"")),p>0&&YP(S)-d&&ZP(p>32?EF(S+";",r,n,d-1):EF($P(S," ","")+";",r,n,d-2),l);break;case 59:S+=";";default:if(ZP(x=xF(S,t,n,c,u,a,s,b,_=[],w=[],d),o),123===v)if(0===u)wF(S,t,x,x,_,o,d,s,w);else switch(99===f&&110===VP(S,3)?100:f){case 100:case 108:case 109:case 115:wF(e,x,x,r&&ZP(xF(e,x,x,0,0,a,s,b,a,_=[],d),w),a,w,d,s,r?_:w);break;default:wF(S,x,x,x,[""],w,0,s,w)}}c=u=p=0,m=y=1,b=S="",d=i;break;case 58:d=1+YP(S),p=h;default:if(m<1)if(123==v)--m;else if(125==v&&0==m++&&125==iF())continue;switch(S+=zP(v),v*m){case 38:y=u>0?1:(S+="\f",-1);break;case 44:s[c++]=(YP(S)-1)*y,y=1;break;case 64:45===lF()&&(S+=hF(sF())),f=lF(),u=d=YP(b=S+=bF(cF())),v++;break;case 45:45===h&&2==YP(S)&&(m=0)}}return o}function xF(e,t,n,r,a,o,i,s,l,c,u){for(var d=a-1,f=0===a?o:[""],p=KP(f),h=0,m=0,g=0;h<r;++h)for(var y=0,v=JP(e,d+1,d=UP(m=i[h])),b=e;y<p;++y)(b=HP(m>0?f[y]+" "+v:$P(v,/&\f/g,f[y])))&&(l[g++]=b);return aF(e,t,n,0===a?LP:s,l,c,u)}function SF(e,t,n){return aF(e,t,n,DP,zP(nF),JP(e,2,-2),0)}function EF(e,t,n,r){return aF(e,t,n,BP,JP(e,0,r),JP(e,r+1,-1),r)}function kF(e,t){for(var n="",r=KP(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function CF(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case BP:return e.return=e.return||e.value;case DP:return"";case qP:return e.return=e.value+"{"+kF(e.children,r)+"}";case LP:e.value=e.props.join(",")}return YP(n=kF(e.children,r))?e.return=e.value+"{"+n+"}":""}var AF=function(e,t,n){for(var r=0,a=0;r=a,a=lF(),38===r&&12===a&&(t[n]=1),!dF(a);)sF();return uF(e,tF)},OF=new WeakMap,TF=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||OF.get(n))&&!r){OF.set(e,!0);for(var a=[],o=function(e,t){return pF(function(e,t){var n=-1,r=44;do{switch(dF(r)){case 0:38===r&&12===lF()&&(t[n]=1),e[n]+=AF(tF-1,t,n);break;case 2:e[n]+=hF(r);break;case 4:if(44===r){e[++n]=58===lF()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=zP(r)}}while(r=sF());return e}(fF(e),t))}(t,a),i=n.props,s=0,l=0;s<o.length;s++)for(var c=0;c<i.length;c++,l++)e.props[l]=a[s]?o[s].replace(/&\f/g,i[c]):i[c]+" "+o[s]}}},NF=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},RF=function(e){return"comm"===e.type&&e.children.indexOf("emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason")>-1},IF=function(e){return 105===e.type.charCodeAt(1)&&64===e.type.charCodeAt(0)},PF=function(e){e.type="",e.value="",e.return="",e.children="",e.props=""},FF=function(e,t,n){IF(e)&&(e.parent?(console.error("`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles."),PF(e)):function(e,t){for(var n=e-1;n>=0;n--)if(!IF(t[n]))return!0;return!1}(t,n)&&(console.error("`@import` rules can't be after other rules. Please put your `@import` rules before your other rules."),PF(e)))};function MF(e,t){switch(function(e,t){return 45^VP(e,0)?(((t<<2^VP(e,0))<<2^VP(e,1))<<2^VP(e,2))<<2^VP(e,3):0}(e,t)){case 5103:return jP+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return jP+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return jP+e+MP+e+FP+e+e;case 6828:case 4268:return jP+e+FP+e+e;case 6165:return jP+e+FP+"flex-"+e+e;case 5187:return jP+e+$P(e,/(\w+).+(:[^]+)/,jP+"box-$1$2"+FP+"flex-$1$2")+e;case 5443:return jP+e+FP+"flex-item-"+$P(e,/flex-|-self/,"")+e;case 4675:return jP+e+FP+"flex-line-pack"+$P(e,/align-content|flex-|-self/,"")+e;case 5548:return jP+e+FP+$P(e,"shrink","negative")+e;case 5292:return jP+e+FP+$P(e,"basis","preferred-size")+e;case 6060:return jP+"box-"+$P(e,"-grow","")+jP+e+FP+$P(e,"grow","positive")+e;case 4554:return jP+$P(e,/([^-])(transform)/g,"$1"+jP+"$2")+e;case 6187:return $P($P($P(e,/(zoom-|grab)/,jP+"$1"),/(image-set)/,jP+"$1"),e,"")+e;case 5495:case 3959:return $P(e,/(image-set\([^]*)/,jP+"$1$`$1");case 4968:return $P($P(e,/(.+:)(flex-)?(.*)/,jP+"box-pack:$3"+FP+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+jP+e+e;case 4095:case 3583:case 4068:case 2532:return $P(e,/(.+)-inline(.+)/,jP+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(YP(e)-1-t>6)switch(VP(e,t+1)){case 109:if(45!==VP(e,t+4))break;case 102:return $P(e,/(.+:)(.+)-([^]+)/,"$1"+jP+"$2-$3$1"+MP+(108==VP(e,t+3)?"$3":"$2-$3"))+e;case 115:return~WP(e,"stretch")?MF($P(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==VP(e,t+1))break;case 6444:switch(VP(e,YP(e)-3-(~WP(e,"!important")&&10))){case 107:return $P(e,":",":"+jP)+e;case 101:return $P(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+jP+(45===VP(e,14)?"inline-":"")+"box$3$1"+jP+"$2$3$1"+FP+"$2box$3")+e}break;case 5936:switch(VP(e,t+11)){case 114:return jP+e+FP+$P(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return jP+e+FP+$P(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return jP+e+FP+$P(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return jP+e+FP+e+e}return e}var jF=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case BP:e.return=MF(e.value,e.length);break;case qP:return kF([oF(e,{value:$P(e.value,"@","@"+jP)})],r);case LP:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=/(::plac\w+|:read-\w+)/.exec(e))?e[0]:e}(t)){case":read-only":case":read-write":return kF([oF(e,{props:[$P(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return kF([oF(e,{props:[$P(t,/:(plac\w+)/,":"+jP+"input-$1")]}),oF(e,{props:[$P(t,/:(plac\w+)/,":-moz-$1")]}),oF(e,{props:[$P(t,/:(plac\w+)/,FP+"input-$1")]})],r)}return""}))}}],DF=function(e){var t=e.key;if("production"!==fn.env.NODE_ENV&&!t)throw new Error("You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\nIf multiple caches share the same key they might \"fight\" for each other's style elements.");if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||jF;if("production"!==fn.env.NODE_ENV&&/[^a-z-]/.test(t))throw new Error('Emotion key must only contain lower case alphabetical characters and - but "'+t+'" was passed');var a,o,i={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)i[t[n]]=!0;s.push(e)}));var l=[TF,NF];"production"!==fn.env.NODE_ENV&&l.push(function(e){return function(t,n,r){if("rule"===t.type&&!e.compat){var a=t.value.match(/(:first|:nth|:nth-last)-child/g);if(a){for(var o=t.parent?t.parent.children:r,i=o.length-1;i>=0;i--){var s=o[i];if(s.line<t.line)break;if(s.column<t.column){if(RF(s))return;break}}a.forEach((function(e){console.error('The pseudo class "'+e+'" is potentially unsafe when doing server-side rendering. Try changing it to "'+e.split("-child")[0]+'-of-type".')}))}}}}({get compat(){return p.compat}}),FF);var c,u,d=[CF,"production"!==fn.env.NODE_ENV?function(e){e.root||(e.return?c.insert(e.return):e.value&&e.type!==DP&&c.insert(e.value+"{}"))}:(u=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],f=function(e){var t=KP(e);return function(n,r,a,o){for(var i="",s=0;s<t;s++)i+=e[s](n,r,a,o)||"";return i}}(l.concat(r,d));o=function(e,t,n,r){c=n,"production"!==fn.env.NODE_ENV&&void 0!==t.map&&(c={insert:function(e){n.insert(e+t.map)}}),function(e){kF(_F(e),f)}(e?e+"{"+t.styles+"}":t.styles),r&&(p.inserted[t.name]=!0)};var p={key:t,sheet:new PP({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:i,registered:{},insert:o};return p.sheet.hydrate(s),p};function LF(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var BF=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},qF=function(e,t,n){BF(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}},UF={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},zF="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",GF=/[A-Z]|^ms/g,HF=/_EMO_([^_]+?)_([^]*?)_EMO_/g,$F=function(e){return 45===e.charCodeAt(1)},WF=function(e){return null!=e&&"boolean"!=typeof e},VF=NP((function(e){return $F(e)?e:e.replace(GF,"-$&").toLowerCase()})),JF=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(HF,(function(e,t,n){return aM={name:t,styles:n,next:aM},t}))}return 1===UF[e]||$F(e)||"number"!=typeof t||0===t?t:t+"px"};if("production"!==fn.env.NODE_ENV){var YF=/(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\(|(no-)?(open|close)-quote/,KF=["normal","none","initial","inherit","unset"],ZF=JF,XF=/^-ms-/,QF=/-(.)/g,eM={};JF=function(e,t){if("content"===e&&("string"!=typeof t||-1===KF.indexOf(t)&&!YF.test(t)&&(t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0))))throw new Error("You seem to be using a value for 'content' without quotes, try replacing it with `content: '\""+t+"\"'`");var n=ZF(e,t);return""===n||$F(e)||-1===e.indexOf("-")||void 0!==eM[e]||(eM[e]=!0,console.error("Using kebab-case for css properties in objects is not supported. Did you mean "+e.replace(XF,"ms-").replace(QF,(function(e,t){return t.toUpperCase()}))+"?")),n}}var tM="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function nM(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles){if("production"!==fn.env.NODE_ENV&&"NO_COMPONENT_SELECTOR"===n.toString())throw new Error(tM);return n}switch(xe(n)){case"boolean":return"";case"object":if(1===n.anim)return aM={name:n.name,styles:n.styles,next:aM},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)aM={name:r.name,styles:r.styles,next:aM},r=r.next;var a=n.styles+";";return"production"!==fn.env.NODE_ENV&&void 0!==n.map&&(a+=n.map),a}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=nM(e,t,n[a])+";";else for(var o in n){var i=n[o];if("object"!==xe(i))null!=t&&void 0!==t[i]?r+=o+"{"+t[i]+"}":WF(i)&&(r+=VF(o)+":"+JF(o,i)+";");else{if("NO_COMPONENT_SELECTOR"===o&&"production"!==fn.env.NODE_ENV)throw new Error(tM);if(!Array.isArray(i)||"string"!=typeof i[0]||null!=t&&void 0!==t[i[0]]){var s=nM(e,t,i);switch(o){case"animation":case"animationName":r+=VF(o)+":"+s+";";break;default:"production"!==fn.env.NODE_ENV&&"undefined"===o&&console.error("You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key)."),r+=o+"{"+s+"}"}}else for(var l=0;l<i.length;l++)WF(i[l])&&(r+=VF(o)+":"+JF(o,i[l])+";")}}return r}(e,t,n);case"function":if(void 0!==e){var o=aM,i=n(e);return aM=o,nM(e,t,i)}"production"!==fn.env.NODE_ENV&&console.error("Functions that are interpolated in css calls will be stringified.\nIf you want to have a css call based on props, create a function that returns a css call like this\nlet dynamicStyle = (props) => css`color: ${props.color}`\nIt can be called directly with props or interpolated in a styled call like this\nlet SomeComponent = styled('div')`${dynamicStyle}`");break;case"string":if("production"!==fn.env.NODE_ENV){var s=[],l=n.replace(HF,(function(e,t,n){var r="animation"+s.length;return s.push("const "+r+" = keyframes`"+n.replace(/^@keyframes animation-\w+/,"")+"`"),"${"+r+"}"}));s.length&&console.error("`keyframes` output got interpolated into plain string, please wrap it with `css`.\n\nInstead of doing this:\n\n"+[].concat(s,["`"+l+"`"]).join("\n")+"\n\nYou should wrap it with `css` like this:\n\ncss`"+l+"`")}}if(null==t)return n;var c=t[n];return void 0!==c?c:n}var rM,aM,oM=/label:\s*([^\s;\n{]+)\s*(;|$)/g;"production"!==fn.env.NODE_ENV&&(rM=/\/\*#\ssourceMappingURL=data:application\/json;\S+\s+\*\//g);var iM=function(e,t,n){if(1===e.length&&"object"===xe(e[0])&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";aM=void 0;var o,i=e[0];null==i||void 0===i.raw?(r=!1,a+=nM(n,t,i)):("production"!==fn.env.NODE_ENV&&void 0===i[0]&&console.error(zF),a+=i[0]);for(var s=1;s<e.length;s++)a+=nM(n,t,e[s]),r&&("production"!==fn.env.NODE_ENV&&void 0===i[s]&&console.error(zF),a+=i[s]);"production"!==fn.env.NODE_ENV&&(a=a.replace(rM,(function(e){return o=e,""}))),oM.lastIndex=0;for(var l,c="";null!==(l=oM.exec(a));)c+="-"+l[1];var u=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(a)+c;return"production"!==fn.env.NODE_ENV?{name:u,styles:a,map:o,next:aM,toString:function(){return"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop)."}}:{name:u,styles:a,next:aM}},sM=!!W.useInsertionEffect&&W.useInsertionEffect||function(e){return e()},lM={}.hasOwnProperty,cM=W.createContext("undefined"!=typeof HTMLElement?DF({key:"css"}):null);"production"!==fn.env.NODE_ENV&&(cM.displayName="EmotionCacheContext");var uM=function(e){return u.forwardRef((function(t,n){var r=u.useContext(cM);return e(t,r,n)}))},dM=W.createContext({});"production"!==fn.env.NODE_ENV&&(dM.displayName="EmotionThemeContext");var fM="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",pM="__EMOTION_LABEL_PLEASE_DO_NOT_USE__",hM=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return BF(t,n,r),sM((function(){return qF(t,n,r)})),null},mM=uM((function(e,t,n){var r=e.css;"string"==typeof r&&void 0!==t.registered[r]&&(r=t.registered[r]);var a=e[fM],o=[r],i="";"string"==typeof e.className?i=LF(t.registered,o,e.className):null!=e.className&&(i=e.className+" ");var s=iM(o,void 0,W.useContext(dM));if("production"!==fn.env.NODE_ENV&&-1===s.name.indexOf("-")){var l=e[pM];l&&(s=iM([s,"label:"+l+";"]))}i+=t.key+"-"+s.name;var c={};for(var u in e)!lM.call(e,u)||"css"===u||u===fM||"production"!==fn.env.NODE_ENV&&u===pM||(c[u]=e[u]);return c.ref=n,c.className=i,W.createElement(W.Fragment,null,W.createElement(hM,{cache:t,serialized:s,isStringTag:"string"==typeof a}),W.createElement(a,c))}));"production"!==fn.env.NODE_ENV&&(mM.displayName="EmotionCssPropInternal");var gM=IP,yM=function(e){return"theme"!==e},vM=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?gM:yM},bM=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!=typeof r&&n&&(r=e.__emotion_forwardProp),r},_M="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",wM=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return BF(t,n,r),sM((function(){return qF(t,n,r)})),null},xM=function e(t,n){if("production"!==fn.env.NODE_ENV&&void 0===t)throw new Error("You are trying to create a styled element with an undefined component.\nYou may have forgotten to import it.");var r,a,o=t.__emotion_real===t,i=o&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var s=bM(t,n,o),l=s||vM(i),c=!l("as");return function(){var u=arguments,d=o&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&d.push("label:"+r+";"),null==u[0]||void 0===u[0].raw)d.push.apply(d,u);else{"production"!==fn.env.NODE_ENV&&void 0===u[0][0]&&console.error(_M),d.push(u[0][0]);for(var f=u.length,p=1;p<f;p++)"production"!==fn.env.NODE_ENV&&void 0===u[0][p]&&console.error(_M),d.push(u[p],u[0][p])}var h=uM((function(e,t,n){var r=c&&e.as||i,o="",u=[],f=e;if(null==e.theme){for(var p in f={},e)f[p]=e[p];f.theme=W.useContext(dM)}"string"==typeof e.className?o=LF(t.registered,u,e.className):null!=e.className&&(o=e.className+" ");var h=iM(d.concat(u),t.registered,f);o+=t.key+"-"+h.name,void 0!==a&&(o+=" "+a);var m=c&&void 0===s?vM(r):l,g={};for(var y in e)c&&"as"===y||m(y)&&(g[y]=e[y]);return g.className=o,g.ref=n,W.createElement(W.Fragment,null,W.createElement(wM,{cache:t,serialized:h,isStringTag:"string"==typeof r}),W.createElement(r,g))}));return h.displayName=void 0!==r?r:"Styled("+("string"==typeof i?i:i.displayName||i.name||"Component")+")",h.defaultProps=t.defaultProps,h.__emotion_real=h,h.__emotion_base=i,h.__emotion_styles=d,h.__emotion_forwardProp=s,Object.defineProperty(h,"toString",{value:function(){return void 0===a&&"production"!==fn.env.NODE_ENV?"NO_COMPONENT_SELECTOR":"."+a}}),h.withComponent=function(t,r){return e(t,TP({},n,r,{shouldForwardProp:bM(h,r,!0)})).apply(void 0,d)},h}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){xM[e]=xM(e)}));const SM=60;function EM(e,t,r){const a=[],{cdsLocations:o,strand:i,transcriptParts:s}=t;switch(e){case"genomic":case"cDNA":{const[t]=s;for(const o of t){if("cDNA"===e&&"intron"===o.type)continue;let t=r(o.min,o.max);-1===i&&(t=n.revcom(t));const s="fivePrimeUTR"===o.type||"threePrimeUTR"===o.type?"UTR":o.type,l=a.at(-1);if(l)if(l.type===s){const[e,...n]=l.sequenceLines,r=n.join("")+t;l.sequenceLines=[e,...Or.splitStringIntoChunks(r,SM)],l.locs.push({min:o.min,max:o.max})}else{const e=a.reduce(((e,t)=>e+t.sequenceLines.reduce(((e,t)=>e+t.length),0)),0),n=SM-e%SM,r=t.slice(0,n),i=Or.splitStringIntoChunks(t.slice(n),SM);a.push({type:s,sequenceLines:[r,...i],locs:[{min:o.min,max:o.max}]})}else{const e=Or.splitStringIntoChunks(t,SM);a.push({type:s,sequenceLines:e,locs:[{min:o.min,max:o.max}]})}}return a}case"CDS":{let e="";const[t]=o,s=[];for(const n of t)e+=r(n.min,n.max),s.push({min:n.min,max:n.max});-1===i&&(e=n.revcom(e));const l=Or.splitStringIntoChunks(e,SM);return a.push({type:"CDS",sequenceLines:l,locs:s}),a}case"protein":{let e="";const[t]=o,s=[];for(const n of t)e+=r(n.min,n.max),s.push({min:n.min,max:n.max});-1===i&&(e=n.revcom(e));let l="";for(let t=0;t<e.length;t+=3){const r=e.slice(t,t+3).toUpperCase();l+=n.defaultCodonTable[r]||"&"}const c=Or.splitStringIntoChunks(l,SM);return a.push({type:"protein",sequenceLines:c,locs:s}),a}}}function kM(e){switch(e){case"upOrDownstream":return"rgb(255,255,255)";case"exon":case"UTR":return"rgb(194,106,119)";case"CDS":return"rgb(93,168,153)";case"intron":return"rgb(187,187,187)";case"protein":return"rgb(148,203,236)"}}function CM(e){const t=[],n=e.flatMap((e=>e.locs));let[r]=n;for(let e=1;e<n.length;e++)r.min===n[e].max||r.max===n[e].min?r={min:Math.min(r.min,n[e].min),max:Math.max(r.max,n[e].max)}:(t.push(r),r=n[e]);return t.push(r),t}const AM=p.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),o=a?.getByRefName(n),{featureTypeOntology:i}=r.apolloDataStore.ontologyManager,s="genomic",l=["genomic","cDNA"],[d,f]=u.useState(l),[p,h]=u.useState(s),[m,g]=u.useState((()=>o?EM(s,t,((e,t)=>o.getSequence(e,t))):[])),[y,v]=u.useState((()=>CM(m))),b=c.useTheme(),_=u.useRef(null);if(u.useEffect((()=>{const{cdsLocations:e}=t,[n]=e;f(n.length>0?[...l,"CDS","protein"]:l)}),[t]),!a||!o)return null;const w=a.getByRefName(n);if(!w)return null;if(!i)throw new Error("featureTypeOntology is undefined");return i.isTypeOf(t.type,"transcript")?$.default.createElement($.default.Fragment,null,$.default.createElement(c.Select,{defaultValue:"genomic",value:p,onChange:function(e){const n=e.target.value;h(n);const r=o?EM(n,t,((e,t)=>o.getSequence(e,t))):[],a=CM(r);g(r),v(a)},size:"small"},d.map((e=>$.default.createElement(c.MenuItem,{key:e,value:e},e)))),$.default.createElement(c.Button,{variant:"contained",onClick:()=>{const e=_.current;e&&WR(e)},style:{marginLeft:10},size:"medium"},"Copy sequence"),$.default.createElement(c.Paper,{style:{fontFamily:"monospace",padding:b.spacing(),overflowX:"auto"},ref:_},">",w.name,":",y.map((e=>1===t.strand?`${e.min+1}-${e.max}`:`${e.max}-${e.min+1}`)).join(";"),"(strand=",1===t.strand?"+":"-",";length=",function(e){let t=0;for(const n of e)t+=n.max-n.min;return t}(y),")",$.default.createElement("br",null),m.map(((e,t)=>$.default.createElement("span",{key:`${e.type}-${t}`,style:{background:kM(e.type),color:b.palette.getContrastText(kM(e.type))}},e.sequenceLines.map(((t,n)=>$.default.createElement($.default.Fragment,{key:`${t.slice(0,5)}-${n}`},t,n===e.sequenceLines.length-1&&t.length!==SM?null:$.default.createElement("br",null))))))))):null}));var OM={},TM=eu.exports;Object.defineProperty(OM,"__esModule",{value:!0});var NM=OM.default=void 0;NM=OM.default=(0,TM(tu).default)((0,G.default.jsx)("path",{d:"M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1L9.64 7.64zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5zM19 3l-6 6 2 2 7-7V3z"}),"ContentCut");var RM={},IM=eu.exports;Object.defineProperty(RM,"__esModule",{value:!0});var PM=RM.default=void 0;PM=RM.default=(0,IM(tu).default)((0,G.default.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove");const FM=xM(pP)((()=>({"&.MuiFormControl-root":{marginTop:0,marginBottom:0,width:"100%"},"& .MuiInputBase-input":{fontSize:12,height:20,padding:1,paddingLeft:10}}))),MM=xM("div")({display:"flex",justifyContent:"center",alignItems:"center",textAlign:"left",width:"100%",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-all","& span":{fontSize:12}}),jM=e=>{const{strand:t}=e;return $.default.createElement("div",null,1===t?$.default.createElement(ru,null):-1===t?$.default.createElement(PM,null):$.default.createElement(c.Typography,{component:"span"},"N/A"))},DM=p.observer((function({assembly:e,feature:t,refName:r,session:a}){const{notify:o}=a,i=a.apolloDataStore.assemblies.get(e),s=i?.getByRefName(r),{changeManager:l}=a.apolloDataStore,d=u.useRef(null);if(!s)return null;const{apolloDataStore:f}=a,{featureTypeOntology:p}=f.ontologyManager;if(!p.isTypeOf(t.type,"transcript")&&!p.isTypeOf(t.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent");const{cdsLocations:h,transcriptExonParts:m,strand:g}=t,[y]=h,[v,b]=((e,t)=>{const{transcriptExonParts:n}=e,r=n.filter((e=>t.isTypeOf(e.type,"exon"))).sort((({min:e},{min:t})=>e-t)),a=r[0]?.min,o=r[r.length-1]?.max;return[a,o]})(t,p);let _=v,w=b;const x=y.length>0;if(x){const e=y.toSorted((({min:e},{min:t})=>e-t));_=e[0].min,w=e[e.length-1].max}const S=(t,n,r,a,i)=>{if(!r.children)throw new Error("Transcript should have child features");if(t===n)return;const s=A(r,p,t,a);if(!s)return void o("No matching CDS feature found","error");if(a&&n>=s.max)return void o("Start location should be less than CDS end location","error");if(!a&&n<=s.min)return void o("End location should be greater than CDS start location","error");if(!R(r,p,n,a))return void o("There should be an overlapping exon for the new CDS location","error");const c=a?new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[s._id],featureId:s._id,oldStart:s.min,newStart:n,assembly:e}):new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[s._id],featureId:s._id,oldEnd:s.max,newEnd:n,assembly:e});l.submit(c).then((()=>{i&&i()})).catch((()=>{o("Error updating feature CDS position","error")}))};function E(t,n,r,a){if(!r.children)throw new Error("Transcript should have child features");const{matchingExon:i,prevExon:s,nextExon:c}=I(r,p,t,a);if(!i)return void o("No matching exon found","error");if(a&&n>=i.max)return void o("Start location should be less than end location","error");if(!a&&n<=i.min)return void o("End location should be greater than start location","error");if(s&&s.max+2>n)return void o("Error while changing start location","error");if(c&&c.min-2<n)return void o("Error while changing end location","error");const u=T(r,i.min,i.max,p);if(!u)return void o("No matching exon feature found","error");const d=O(r,p);if(a&&n!==i.min){const t=new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:e});if(s)C(u,t,n);else{const e=r.min,o=r.parent;if(n<e)o&&n<o.min&&C(o,t,n),C(r,t,n),C(u,t,n);else if(n>e&&(C(u,t,n),C(r,t,n),o)){const[e]=N(o,r,n,p,a);o.min!=e&&C(o,t,e)}}d&&d.min>=i.min&&d.min<=i.max&&n>d.min&&C(d,t,n),l.submit(t).catch((()=>{o("Error updating feature exon start position","error")}))}if(!a&&n!==i.max){const t=new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:e});if(c)k(u,t,n);else{const e=r.max,o=r.parent;if(n>e)o&&n>o.max&&k(o,t,n),k(r,t,n),k(u,t,n);else if(n<e&&(k(u,t,n),k(r,t,n),o)){const[,e]=N(o,r,n,p,a);o.max!=e&&k(o,t,e)}}d&&d.max>=i.min&&d.max<=i.max&&n<d.max&&k(d,t,n),l.submit(t).catch((()=>{o("Error updating feature exon end position","error")}))}}const k=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldEnd:e.max,newEnd:n})},C=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldStart:e.min,newStart:n})},A=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(t.isTypeOf(o.type,"CDS")){if(r&&n===o.min){a=o;break}if(!r&&n===o.max){a=o;break}}return a},O=(e,t)=>{let n;for(const[,r]of e.children??[])if(t.isTypeOf(r.type,"CDS")){n=r;break}return n},T=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(r.isTypeOf(o.type,"exon")&&t===o.min&&n===o.max){a=o;break}return a},N=(e,t,n,r,a)=>{const o=[],i=[];for(const[,s]of e.children?.entries()??[])r.isTypeOf(s.type,"transcript")&&(s._id===t._id?a?(o.push(n),i.push(s.max)):(i.push(n),o.push(s.min)):(o.push(s.min),i.push(s.max)));return[Math.min(...o),Math.max(...i)]},R=(e,t,n,r)=>{const{transcriptExonParts:a}=e;let o;for(const[,e]of a.entries())if(t.isTypeOf(e.type,"exon")){if(!r&&n>=e.min&&n<=e.max){o=e;break}if(r&&n>=e.min&&n<=e.max){o=e;break}}return o},I=(e,t,n,r)=>{const{transcriptExonParts:a,strand:o}=e;let i,s,l,c;for(const[e,o]of a.entries())if(t.isTypeOf(o.type,"exon")){if(r&&o.min===n){i=o,s=e;break}if(!r&&o.max===n){i=o,s=e;break}}if(i&&void 0!==s){if(1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(-1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}if(-1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}}return{matchingExon:i,prevExon:l,nextExon:c}},P=()=>{let e="";const[r]=h,a=r.toSorted((({min:e},{min:t})=>e-t));for(const t of a)e+=s.getSequence(t.min,t.max);-1===g&&(e=n.revcom(e));const o=[];for(let r=0;r<e.length;r+=3){const a=e.slice(r,r+3).toUpperCase(),i=n.defaultCodonTable[a]||"&";"ATG"===a?o.push($.default.createElement(c.Typography,{component:"span",style:{backgroundColor:"yellow",cursor:"pointer",border:"1px solid black"},key:r,onClick:()=>{const e=F(r);e!==_&&1===g&&S(_,e,t,!0),e!==w&&-1===g&&S(w,e,t,!1)}},i)):["TAA","TAG","TGA"].includes(a)?o.push($.default.createElement(c.Typography,{style:{backgroundColor:"red",color:"white"},component:"span",key:r},i)):o.push($.default.createElement(c.Typography,{component:"span",key:r},i))}return o},F=e=>{const[t]=h;let n=0;const r=t.toSorted((({min:e},{min:t})=>e-t));if(1===g)for(const t of r){const r=t.max-t.min;if(n+r>e)return t.min+(e-n);n+=r}else if(-1===g)for(let t=r.length-1;t>=0;t--){const a=r[t],o=a.max-a.min;if(n+o>e)return a.max-(e-n);n+=o}return 1===g?_:w};return $.default.createElement("div",null,x&&$.default.createElement("div",null,$.default.createElement(c.Accordion,null,$.default.createElement(UM,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},$.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Translation")),$.default.createElement(c.AccordionDetails,null,$.default.createElement(MM,null,$.default.createElement(c.Typography,{component:"span",ref:d,style:{maxHeight:120,overflowY:"scroll"}},P())),$.default.createElement("div",{style:{marginTop:10,display:"flex",flexDirection:"row",alignItems:"center",gap:10}},$.default.createElement(c.Tooltip,{title:"Copy"},$.default.createElement(AR,{style:{fontSize:15,cursor:"pointer"},onClick:()=>{const e=d.current;e&&WR(e)}})),$.default.createElement(c.Tooltip,{title:"Trim"},$.default.createElement(NM,{style:{fontSize:15,cursor:"pointer"},onClick:()=>{const e=P(),n=e.map((e=>e.props.children)).join("");if(n.startsWith("M")&&n.endsWith("*"))return;const r=[];for(const t of e)r.push({codonGenomicPos:t.key,sequenceLetter:t.props.children});if(0===r.length)return;const a=n.indexOf("M"),i=n.indexOf("*")+1,s=r[a].codonGenomicPos,l=r[i].codonGenomicPos;if(!s||!l)return;const c=F(s),u=F(l);if(1===g){if(c>u)return void o("Start codon genomic location should be less than stop codon genomic location","error");let e;c!==_&&(e=new Promise((e=>{S(_,c,t,!0,(()=>{e(!0)}))}))),u!==w&&(e?e.then((()=>{S(w,u,t,!1)})):S(w,u,t,!1))}if(-1===g){if(c<u)return void o("Start codon genomic location should be less than stop codon genomic location","error");let e;c!==w&&(e=new Promise((e=>{S(w,c,t,!1,(()=>{e(!0)}))}))),u!==_&&(e?e.then((()=>{S(_,u,t,!0)})):S(_,u,t,!0))}o("Translation sequence trimmed to start and stop codons","success")}}))))),$.default.createElement(c.Grid2,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center",marginTop:10}},$.default.createElement(c.Grid2,{size:1}),$.default.createElement(c.Grid2,{size:4},$.default.createElement(FM,1===g?{margin:"dense",variant:"outlined",value:_+1,onChangeCommitted:e=>{S(_,e-1,t,!0)},style:{border:"1px solid black",borderRadius:5}}:{margin:"dense",variant:"outlined",value:w,onChangeCommitted:e=>{S(w,e,t,!1)},style:{border:"1px solid black",borderRadius:5}})),$.default.createElement(c.Grid2,{size:2},$.default.createElement(c.Typography,{component:"span"},"CDS")),$.default.createElement(c.Grid2,{size:4},$.default.createElement(FM,1===g?{margin:"dense",variant:"outlined",value:w,onChangeCommitted:e=>{S(w,e,t,!1)},style:{border:"1px solid black",borderRadius:5}}:{margin:"dense",variant:"outlined",value:_+1,onChangeCommitted:e=>{S(_,e-1,t,!0)},style:{border:"1px solid black",borderRadius:5}})),$.default.createElement(c.Grid2,{size:1}))),$.default.createElement("div",{style:{marginTop:5}},m.map(((e,r)=>$.default.createElement("div",{key:r},"exon"===e.type&&$.default.createElement(c.Grid2,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center"}},$.default.createElement(c.Grid2,{size:1},0!==r&&((e,t)=>{let r="";if(t>0){const a=m[t-1];1===g?"intron"===a.type&&(r=s.getSequence(e.min-2,e.min)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.max,e.max+2)))}return[{spliceSite:r,color:"AG"===r?"green":"red"}]})(e,r).map(((e,t)=>$.default.createElement(c.Typography,{key:t,component:"span",color:e.color},e.spliceSite)))),$.default.createElement(c.Grid2,{size:4,style:{padding:0}},$.default.createElement(FM,1===g?{margin:"dense",variant:"outlined",value:e.min+1,onChangeCommitted:n=>{E(e.min,n-1,t,!0)}}:{margin:"dense",variant:"outlined",value:e.max,onChangeCommitted:n=>{E(e.max,n,t,!1)}})),$.default.createElement(c.Grid2,{size:2},$.default.createElement(jM,{strand:t.strand})),$.default.createElement(c.Grid2,{size:4,style:{padding:0}},$.default.createElement(FM,1===g?{margin:"dense",variant:"outlined",value:e.max,onChangeCommitted:n=>{E(e.max,n,t,!1)}}:{margin:"dense",variant:"outlined",value:e.min+1,onChangeCommitted:n=>{E(e.min,n-1,t,!0)}})),$.default.createElement(c.Grid2,{size:1},r!==m.length-1&&((e,t)=>{let r="";if(t<m.length-1){const a=m[t+1];1===g?"intron"===a.type&&(r=s.getSequence(e.max,e.max+2)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.min-2,e.min)))}return[{spliceSite:r,color:"GT"===r?"green":"red"}]})(e,r).map(((e,t)=>$.default.createElement(c.Typography,{key:t,component:"span",color:e.color},e.spliceSite))))))))))})),LM=xM(c.TableCell)((()=>({fontWeight:"bold"}))),BM=p.observer((function(e){const{feature:t}=e,n=wp(t),r=xp(t);return $.default.createElement(c.Table,{size:"small",sx:{fontSize:"0.75rem","& .MuiTableCell-root":{padding:"4px"}}},$.default.createElement(c.TableBody,null,""!==n&&$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"Name"),$.default.createElement(c.TableCell,null,wp(t))),""!==r&&$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"ID"),$.default.createElement(c.TableCell,null,xp(t))),$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"Apollo ID"),$.default.createElement(c.TableCell,null,t._id)),$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"Type"),$.default.createElement(c.TableCell,null,t.type)),$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"Location"),$.default.createElement(c.TableCell,null,e.refName,":",t.min,"..",t.max)),$.default.createElement(c.TableRow,null,$.default.createElement(LM,null,"Strand"),$.default.createElement(c.TableCell,null,1===(a=t.strand)?"Forward":-1===a?"Reverse":""))));var a})),qM=d.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),UM=xM(c.AccordionSummary)((()=>({minHeight:30,maxHeight:30,"&.Mui-expanded":{minHeight:30,maxHeight:30}})));function zM(e){return null}const GM=p.observer((function(e){const{classes:t}=qM(),r=["summary","location"],[a,o]=u.useState(r),{model:i}=e,{assembly:s,feature:d,refName:f}=i;u.useEffect((()=>{o(r)}),[d]);const p=n.getSession(i),{pluginManager:h}=n.getEnv(p),m=n.getSession(i),g=m.apolloDataStore.assemblies.get(s),{internetAccounts:y}=l.getRoot(p),v=y.find((e=>"ApolloInternetAccount"===e.type)),b=v?.retrieveToken(),_=["admin","user"].includes((v?v.role:"admin")??"");if(!d||!g)return null;const w=g.getByRefName(f);if(!w)return null;const{max:x,min:S}=d;function E(e,t){o(e?[...a,t]:a.filter((e=>e!==t)))}w.getSequence(S,x)||m.apolloDataStore.loadRefSeq([{assemblyName:s,refName:f,start:S,end:x}]);const k=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent",zM,e),C=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomTypesComponent",(()=>null),{feature:d,session:p}),A=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomSaveComponent",(()=>null),{feature:d,session:p,token:b}),O=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomAttributesComponent",(()=>null),{feature:d,session:p});return $.default.createElement("div",{className:t.root},$.default.createElement(c.Accordion,{expanded:a.includes("summary"),onChange:(e,t)=>{E(t,"summary")}},$.default.createElement(UM,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},$.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Summary")),$.default.createElement(c.AccordionDetails,null,$.default.createElement(BM,{feature:d,refName:f}))),$.default.createElement(k,{session:p,feature:d}),$.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("location"),onChange:(e,t)=>{E(t,"location")}},$.default.createElement(UM,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},$.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Location")),$.default.createElement(c.AccordionDetails,null,$.default.createElement(DM,{feature:d,refName:f,session:m,assembly:g._id||""}),$.default.createElement(C,{feature:d,session:p}),$.default.createElement(O,{feature:d,session:p}))),$.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("attrs"),onChange:(e,t)=>{E(t,"attrs")}},$.default.createElement(UM,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},$.default.createElement("div",{style:{display:"flex",alignItems:"center"}},$.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Attributes"," "),$.default.createElement(c.Tooltip,{title:"Separate multiple values for the attribute with commas"},$.default.createElement(Pp,{style:{color:"white",fontSize:15,marginLeft:10}})))),$.default.createElement(c.AccordionDetails,null,$.default.createElement(fP,{feature:d,session:m,assembly:g._id||"",editable:_}))),$.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("sequence"),onChange:(e,t)=>{E(t,"sequence")}},$.default.createElement(UM,{expandIcon:$.default.createElement(VI,{style:{color:"white"}}),"aria-controls":"panel4-content",id:"panel4-header"},$.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Sequence")),$.default.createElement(c.AccordionDetails,null,a.includes("sequence")&&$.default.createElement(AM,{feature:d,session:m,assembly:g._id||"",refName:f}))),$.default.createElement(A,{feature:d,session:p,token:b}))})),HM=r.ConfigurationSchema("LinearApolloDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),$M=d.makeStyles()({highlighted:{background:"orange"}}),WM=({highlight:e,text:t})=>{const{classes:n}=$M();if(!e)return $.default.createElement($.default.Fragment,null,t);const r=t.split(e);if(1===r.length)return $.default.createElement($.default.Fragment,null,t);const a=[];for(let t=0;t<r.length-1;t++)a.push(r[t],$.default.createElement("span",{className:n.highlighted},e));return $.default.createElement($.default.Fragment,null,a,r.at(-1))},VM=p.observer((function({feature:e,filterText:t}){const n=[...e.attributes.entries()].map((([e,t])=>{if(e.startsWith("gff_")){const n=e.slice(4);return[n.charAt(0).toUpperCase()+n.slice(1),l.getSnapshot(t)]}return"_id"===e?["ID",l.getSnapshot(t)]:[e,l.getSnapshot(t)]})).filter((([e])=>e)).map((([e,t])=>`${e}=${Array.isArray(t)?t.join(", "):t}`)).join(", ");return $.default.createElement(WM,{text:n,highlight:t})})),JM=d.makeStyles()((e=>({inputWrapper:{position:"relative"},hiddenWidthSpan:{padding:e.spacing(.5),color:"transparent"},numberTextInput:{border:"none",background:"inherit",font:"inherit",position:"absolute",width:"100%",left:0}}))),YM=p.observer((function({initialValue:e,notifyError:t,onChangeCommitted:n}){const[r,a]=u.useState(e),[o,i]=u.useState(!1),[s,l]=u.useState(null),{classes:c}=JM();return u.useEffect((()=>{e!==r&&a(e)}),[e]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),$.default.createElement("span",{className:c.inputWrapper},$.default.createElement("span",{className:c.hiddenWidthSpan,"aria-hidden":!0},r),$.default.createElement("input",{type:"text",value:r,className:c.numberTextInput,onChange:function(e){const t=Number(e.target.value);Number.isNaN(t)||a(t)},onKeyDown:t=>{"Enter"===t.key?s?.blur():"Escape"===t.key&&(a(e),i(!0))},onBlur:()=>{r!==e&&n(r).catch(t)},ref:e=>{l(e)}}))})),KM=d.makeStyles()((e=>({typeContent:{display:"inline-block",width:"174px",height:"100%",cursor:"text"},feature:{td:{position:"relative",verticalAlign:"top",paddingLeft:"0.5em"}},arrow:{display:"inline-block",width:"1.6em",textAlign:"center",cursor:"pointer"},arrowExpanded:{transform:"rotate(90deg)"},hoveredFeature:{backgroundColor:e.palette.action.hover},typeInputElement:{border:"none",background:"none"},typeErrorMessage:{color:"red"}})));function ZM(e,t){const{changeManager:r,getAssemblyId:a,regions:o,selectedFeature:i,session:s,setSelectedFeature:c,filteredTranscripts:u,updateFilteredTranscripts:d}=e;return function(e,t,r,a,o,i,s,c,u){const d=function(e){const{internetAccounts:t}=l.getParent(e);return t.find((e=>"ApolloInternetAccount"===e.type))}(i),f=d?d.role:"admin",p="admin"===f,h=!(f&&["admin","user"].includes(f)),m=[];if(e){const l=e.attributes.get("gff_id")?.toString(),f=r(t.assemblyName),g=r(t.assemblyName);m.push({label:"Edit feature details",onClick:()=>{const n=i.addWidget("ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget",{feature:e,assembly:g,refName:t.refName});i.showWidget(n)}},{label:"Add child feature",disabled:h,onClick:()=>{i.queueDialog((t=>[nR,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:f,internetAccount:d}]))}},{label:"Copy features and annotations",disabled:h,onClick:()=>{i.queueDialog((t=>[sR,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g}]))}},{label:"Delete feature",disabled:!p,onClick:()=>{i.queueDialog((t=>[cR,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Merge transcripts",disabled:!p,onClick:()=>{i.queueDialog((t=>[xR,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Merge exons",disabled:!p,onClick:()=>{i.queueDialog((t=>[_R,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Split exon",disabled:!p,onClick:()=>{i.queueDialog((t=>[fI,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}});const{featureTypeOntology:y}=i.apolloDataStore.ontologyManager;if(!y)throw new Error("featureTypeOntology is undefined");(y.isTypeOf(e.type,"transcript")||y.isTypeOf(e.type,"pseudogenic_transcript"))&&n.isSessionModelWithWidgets(i)&&m.push({label:"Edit transcript details",onClick:()=>{const n=i.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:e,assembly:g,changeManager:s,refName:t.refName});i.showWidget(n)}},{label:"Visible",type:"checkbox",checked:!l||!c.includes(l),onClick:()=>{if(l){const e=c.includes(l)?c.filter((e=>e!==l)):[...c,l];u(e)}}})}return m}(t,o[0],a,i,c,s,r,u,d)}function XM(e){let t=e;for(;t.parent;)t=t.parent;return t}const QM=p.observer((function e({depth:t,feature:n,isHovered:r,isSelected:a,model:o,selectedFeatureClass:i,setContextMenu:s}){const{classes:l}=KM(),{apolloHover:c,changeManager:u,selectedFeature:d,session:f,tabularEditor:p}=o,{featureCollapsed:h,filterText:m}=p,{_id:g,children:y,max:v,min:b,strand:_,type:w}=n,x=!h.get(g),S=e=>{f.notify(e.message,"error")};return $.default.createElement($.default.Fragment,null,$.default.createElement("tr",{onMouseEnter:e=>{o.setApolloHover({feature:n,topLevelFeature:XM(n),glyph:o.getGlyph(XM(n))})},className:l.feature+(a?` ${i}`:r?` ${l.hoveredFeature}`:""),onClick:e=>{e.stopPropagation(),o.setSelectedFeature(n)},onContextMenu:e=>(e.preventDefault(),s({position:{left:e.clientX+2,top:e.clientY-6},items:ZM(o,n)}),!1)},$.default.createElement("td",{style:{whiteSpace:"nowrap",borderLeft:2*t+"em solid transparent"}},y?.size?$.default.createElement("div",{onClick:e=>{e.stopPropagation(),p.setFeatureCollapsed(g,x)},className:l.arrow+(x?` ${l.arrowExpanded}`:"")},""):null,$.default.createElement("div",{className:l.typeContent},$.default.createElement(tR,{session:f,ontologyName:"Sequence Ontology",style:{width:170},value:w,filterTerms:XN,fetchValidTerms:ej.bind(null,n),renderInput:e=>$.default.createElement("div",{ref:e.InputProps.ref},$.default.createElement("input",{type:"text",...e.inputProps,className:l.typeInputElement,style:{width:170}}),e.error?$.default.createElement("div",{className:l.typeErrorMessage},e.errorMessage??"unknown error"):null),onChange:(e,t)=>{t&&function(e,t,n,r){const a=t._id,o=new Or.TypeChange({typeName:"TypeChange",changedIds:[a],featureId:a,oldType:String(n),newType:String(r),assembly:t.assemblyId});return e.submit(o)}(u,n,e,t).catch(S)}}))),$.default.createElement("td",null,$.default.createElement(YM,{initialValue:b+1,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[a],featureId:a,oldStart:n,newStart:r,assembly:t.assemblyId});return e.submit(o)}(u,n,b,e-1)})),$.default.createElement("td",null,$.default.createElement(YM,{initialValue:v,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[a],featureId:a,oldEnd:n,newEnd:r,assembly:t.assemblyId});return e.submit(o)}(u,n,v,e)})),$.default.createElement("td",null,1===_?"+":-1===_?"-":void 0),$.default.createElement("td",null,$.default.createElement(VM,{filterText:m,feature:n}))),x&&y?[...y.entries()].filter((e=>{if(!m)return!0;const[,t]=e;return JSON.stringify(t).includes(m)})).map((([n,r])=>$.default.createElement(e,{isHovered:c?.feature._id===r._id,isSelected:d?._id===r._id,selectedFeatureClass:i,key:n,depth:(t||0)+1,feature:r,model:o,setContextMenu:s}))):null)}));async function ej(e,t,n){const{parent:r}=e;if(r){const e=(await t.getTermsWithLabelOrSynonym(r.type,{includeSubclasses:!1})).filter(XN);if(e.length>0)return await t.getClassesThat("part_of",e)}}const tj=d.makeStyles()((e=>({scrollableTable:{width:"100%",height:"100%",th:{position:"sticky",top:0,zIndex:2,textAlign:"left",background:e.palette.background.paper,paddingTop:"3.2em"},td:{whiteSpace:"normal"}},selectedFeature:{backgroundColor:e.palette.action.selected}}))),nj=p.observer((function({model:e}){const{apolloHover:t,seenFeatures:n,selectedFeature:r,tabularEditor:a}=e,o=c.useTheme(),{classes:i}=tj(),s=u.useRef(null),[l,d]=u.useState(null),{filterText:p}=a;return u.useEffect((()=>{const e=s.current;if(e&&r){const t=e.querySelector(`.${i.selectedFeature}`);if(t){const n=e.scrollTop,r=t.offsetTop-25;r>n&&r<n+e.offsetHeight||e.scroll({top:r-40,behavior:"smooth"})}}}),[r,n,i.selectedFeature]),$.default.createElement("div",{ref:s,style:{width:"100%",overflowY:"auto",height:"100%"}},$.default.createElement("table",{className:i.scrollableTable},$.default.createElement("thead",null,$.default.createElement("tr",null,$.default.createElement("th",null,"Type"),$.default.createElement("th",null,"Start"),$.default.createElement("th",null,"End"),$.default.createElement("th",null,"Strand"),$.default.createElement("th",null,"Attributes"))),$.default.createElement("tbody",null,[...n.entries()].filter((e=>{if(!p)return!0;const[,t]=e;return JSON.stringify(t).includes(p)})).sort(((e,t)=>e[1].min-t[1].min)).map((([n,a])=>$.default.createElement(QM,{key:n,isSelected:r?._id===n,isHovered:t?.feature._id===n,selectedFeatureClass:i.selectedFeature,feature:a,model:e,depth:0,setContextMenu:d}))))),$.default.createElement(f.Menu,{open:Boolean(l),onMenuItemClick:(e,t)=>{t(),d(null)},onClose:()=>{d(null)},TransitionProps:{onExit:()=>{d(null)}},style:{zIndex:o.zIndex.tooltip},menuItems:l?.items??[],anchorReference:"anchorPosition",anchorPosition:l?.position}))}));var rj={},aj=eu.exports;Object.defineProperty(rj,"__esModule",{value:!0});var oj=rj.default=void 0;oj=rj.default=(0,aj(tu).default)((0,G.default.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var ij={},sj=eu.exports;Object.defineProperty(ij,"__esModule",{value:!0});var lj=ij.default=void 0;lj=ij.default=(0,sj(tu).default)((0,G.default.jsx)("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z"}),"UnfoldLess");const cj=d.makeStyles()({toolbar:{width:"100%",display:"flex",paddingRight:"2em",flexDirection:"row",justifyContent:"space-between",position:"absolute",zIndex:4},filterText:{}}),uj=p.observer((function({model:e}){const t=e.tabularEditor,{classes:n}=cj();return $.default.createElement("div",{className:n.toolbar},$.default.createElement(c.Tooltip,{title:"Collapse all"},$.default.createElement(c.IconButton,{"aria-label":"collapse",sx:{marginTop:0},onClick:t.collapseAllFeatures},$.default.createElement(lj,null))),$.default.createElement(c.TextField,{className:n.filterText,label:"Filter features",value:t.filterText,sx:{marginTop:0},variant:"outlined",onChange:e=>{t.setFilterText(e.target.value)},slotProps:{input:{endAdornment:$.default.createElement(c.InputAdornment,{position:"end"},$.default.createElement(c.IconButton,{onClick:()=>{t.clearFilterText()}},$.default.createElement(oj,null)))}}}))}));function dj(e){e.stopPropagation()}const fj=p.observer((function({model:e}){return e.tabularEditor.isShown?$.default.createElement("div",{onMouseDown:dj,onClick:dj,style:{width:"100%",height:"100%",position:"relative"}},$.default.createElement(uj,{model:e}),$.default.createElement(nj,{model:e})):null})),pj=l.types.model("TabularEditor",{isShown:!0,featureCollapsed:l.types.map(l.types.boolean),filterText:""}).actions((e=>({setFeatureCollapsed(t,n){e.featureCollapsed.set(t,n)},setFilterText(t){e.filterText=t},clearFilterText(){e.filterText=""},collapseAllFeatures(){const t=l.getParent(e);for(const[n]of t.seenFeatures.entries())e.featureCollapsed.set(n,!0)},togglePane(){e.isShown=!e.isShown},hidePane(){e.isShown=!1},showPane(){e.isShown=!0}})));function hj(e,t){return Boolean(t&&e._id===t._id)}function mj(e,t){return t?e?.palette.text.primary??"black":e?.palette.background.default??"white"}function gj(e,t,n,r,a,o){e.fillStyle=o,e.fillRect(t,n,r,a)}function yj(e){let t;t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id;const n=`(${(e.min+1).toLocaleString("en")}..${e.max.toLocaleString("en")})`;if(t&&t.length+n.length>65){const e=60-n.length;t=e>0?t.slice(0,e):"",t=`${t}[...]`}return`${t} ${n}`}function vj(e,t){const{apolloInternetAccount:n,changeManager:r,regions:a,selectedFeature:o,session:i}=e,s=[],l=n?n.role:"admin",c="admin"===l,u=!(l&&["admin","user"].includes(l)),[d]=a,f=e.getAssemblyId(d.assemblyName),p=e.getAssemblyId(d.assemblyName),{featureTypeOntology:h}=i.apolloDataStore.ontologyManager;if(!h)throw new Error("featureTypeOntology is undefined");return s.push({label:yj(t),type:"subHeader"},{label:"Add child feature",disabled:u,onClick:()=>{i.queueDialog((e=>[nR,{session:i,handleClose:()=>{e()},changeManager:r,sourceFeature:t,sourceAssemblyId:f,internetAccount:n}]))}},{label:"Copy features and annotations",disabled:u,onClick:()=>{i.queueDialog((e=>[sR,{session:i,handleClose:()=>{e()},changeManager:r,sourceFeature:t,sourceAssemblyId:p}]))}},{label:"Delete feature",disabled:!c,onClick:()=>{i.queueDialog((n=>[cR,{session:i,handleClose:()=>{n()},changeManager:r,sourceFeature:t,sourceAssemblyId:p,selectedFeature:o,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),s}function bj(e,t,n){const{refName:r,regionNumber:a,x:o}=e,{lgv:i}=n,{offsetPx:s}=i,l=i.bpToPx({refName:r,coord:t.min,regionNumber:a}),c=i.bpToPx({refName:r,coord:t.max,regionNumber:a});if(void 0!==l&&void 0!==c){const e=l.offsetPx-s,t=c.offsetPx-s;if(Math.abs(t-e)<8)return;if(Math.abs(e-o)<4)return"min";if(Math.abs(t-o)<4)return"max"}}const _j={draw:function(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,session:s,theme:l}=r,{bpPerPx:c,displayedRegions:u,offsetPx:d}=i,f=u[a],p=(i.bpToPx({refName:f.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-d,{reversed:h}=f,{apolloSelectedFeature:m}=s,g=t.length/c,y=h?p-g:p,v=n*o,b=hj(t,m),_=mj(l,b),w=function(e,t){return t?e?.palette.getContrastText(mj(e,t))??"white":e?.palette.text.primary??"black"}(l,b);!function(e,t,n,r,a,o){gj(e,t,n,r,a,o),r<=2||e.clearRect(t+1,n+1,r-2,a-2)}(e,y,v,g,o,w),g<=2||(function(e,t,n,r,a,o){gj(e,t+1,n+1,r-2,a-2,o)}(e,y,v,g,o,_),function(e,t,n,r,a,o){e.fillStyle=a;const i=Math.max(t+1,0);e.fillText(o,i,n+11,t-1+r-i)}(e,y,v,g,w,t.type))},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,theme:o}=e;if(!n)return;const{feature:i}=n,s=e.getFeatureLayoutPosition(i);if(!s)return;const{bpPerPx:l,displayedRegions:c,offsetPx:u}=a,{layoutIndex:d,layoutRow:f}=s,p=c[d],{refName:h,reversed:m}=p,{length:g,max:y,min:v}=i,b=(a.bpToPx({refName:h,coord:m?y:v,regionNumber:d})?.offsetPx??0)-u,_=f*r,w=g/l;t.fillStyle=o?.palette.action.focus??"rgba(0,0,0,0.04)",t.fillRect(b,_,w,r)},drawTooltip:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,theme:o}=e;if(!n)return;const{feature:i}=n,s=e.getFeatureLayoutPosition(i);if(!s)return;const{featureRow:l,layoutIndex:u,layoutRow:d}=s,{bpPerPx:f,displayedRegions:p,offsetPx:h}=a,m=p[u],{refName:g,reversed:y}=m;let v="Loc: ";const{length:b,max:_,min:w}=i;v+=`${w+1}${_}`;let x=(a.bpToPx({refName:g,coord:y?_:w,regionNumber:u})?.offsetPx??0)-h;const S=(d+l)*r,E=b/f,k=`Type: ${i.type}`,{attributes:C}=i,A=C.get("gff_name")?.find((e=>""!==e)),O=[t.measureText(k).width,t.measureText(v).width];A&&O.push(t.measureText(`Name: ${A}`).width);const T=Math.max(...O);x=x+E+5,t.fillStyle=c.alpha(o?.palette.text.primary??"rgb(1, 1, 1)",.7),t.fillRect(x,S,T+4,3===O.length?45:35),t.beginPath(),t.moveTo(x,S),t.lineTo(x-5,S+5),t.lineTo(x,S+10),t.fill(),t.fillStyle=o?.palette.background.default??"rgba(255, 255, 255)";let N=S+12;t.fillText(k,x+2,N),A&&(N+=12,t.fillText(`Name: ${A}`,x+2,N)),N+=12,t.fillText(v,x+2,N)},getContextMenuItemsForFeature:vj,getContextMenuItems:function(e){const{apolloHover:t}=e;if(!t)return[];const{feature:n}=t;return vj(e,n)},getFeatureFromLayout:function(e,t,n){return e},getRowCount:function(e){return 1},getRowForFeature:function(e,t){return 0},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{feature:a}=r,o=bj(t,a,e);o&&(n.stopPropagation(),e.startDrag(t,a,o))},onMouseLeave:function(){},onMouseMove:function(e,t){if(nD(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{feature:r}=n;if(bj(t,r,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t;if(!n)return;const{feature:r}=n;e.setSelectedFeature(r),e.showFeatureDetailsWidget(r)}};let wj=null,xj=null,Sj=null,Ej=null;const kj=globalThis.document.createElement("canvas");if(kj?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?wj=a.createPattern(n,"repeat"):Sj=a.createPattern(n,"repeat"):"light"===t?xj=a.createPattern(n,"repeat"):Ej=a.createPattern(n,"repeat")}}function Cj(e,t,n,r,a,o,i,s,l){const{apolloRowHeight:c,lgv:u,session:d,theme:f}=t,{bpPerPx:p,displayedRegions:h,offsetPx:m}=u,g=h[n],{refName:y,reversed:v}=g,{apolloSelectedFeature:b}=d,_=(u.bpToPx({refName:y,coord:a.min,regionNumber:n})?.offsetPx??0)-m,w=a.length/p,x=v?_-w:_,S=(r+o)*c,E=Math.round(.6*c),k=S+(c-E)/2;if(e.fillStyle=f?.palette.text.primary??"black",e.fillRect(x,k,w,E),w>2&&(e.clearRect(x+1,k+1,w-2,E-2),e.fillStyle=b&&a._id===b._id?"rgb(0,0,0)":"rgb(211,211,211)",e.fillRect(x+1,k+1,w-2,E-2),s&&l&&i)){const t=v?-1:1,[n,r]=i*t==1?[s,l]:[l,s];e.fillStyle=n,e.fillRect(x+1,k+1,w-2,(E-2)/2),e.fillStyle=r,e.fillRect(x+1,k+1+(E-2)/2,w-2,(E-2)/2)}}function Aj(e,t,n,r,a,o){const{apolloRowHeight:i,lgv:s,theme:l}=t,{bpPerPx:c,displayedRegions:u,offsetPx:d}=s,f=u[n],{refName:p,reversed:h}=f,m=(s.bpToPx({refName:p,coord:a.min,regionNumber:n})?.offsetPx??0)-d,g=a.length/c,y=h?m-g:m,v=Math.round((o+.5)*i)+r*i;e.strokeStyle=l?.palette.text.primary??"black",e.beginPath(),e.moveTo(y,v),e.lineTo(y+g,v),e.stroke()}function Oj(e,t){const{children:n,type:r}=e;if(!n)return 0;let a=0;if(t.isTypeOf(r,"transcript"))for(const[,e]of n)t.isTypeOf(e.type,"CDS")&&(a+=1);return a}function Tj(e,t,n){const{children:r,type:a}=e;if(!r)return 1;let o=0;if(t.isTypeOf(a,"transcript")||t.isTypeOf(a,"pseudogenic_transcript")){for(const[,e]of r)t.isTypeOf(e.type,"CDS")&&(o+=1);return 0===o?1:o}for(const[,e]of r)o+=Tj(e,t);return o}function Nj(e,t){if(!t.isTypeOf(e.type,"gene")&&!t.isTypeOf(e.type,"pseudogene"))throw new Error('Top level feature for GeneGlyph must have type "gene"');const{children:n}=e;if(!n)return[[e]];const r=[];for(const[,a]of n){if(!t.isTypeOf(a.type,"transcript")&&!t.isTypeOf(a.type,"pseudogenic_transcript")){r.push([a,e]);continue}if(!a.children)continue;const n=[],o=[];for(const[,e]of a.children)t.isTypeOf(e.type,"CDS")?n.push(e):t.isTypeOf(e.type,"exon")&&o.push(e);for(const t of n)r.push([t,...o,a,e]);0===n.length&&r.push([...o,a,e])}return r}function Rj(e,t,r){const{session:a}=r,{apolloDataStore:o}=a,{featureTypeOntology:i}=o.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");const s=i.isTypeOf(t.type,"gene")||i.isTypeOf(t.type,"pseudogene"),l=i.isTypeOf(t.type,"transcript")||i.isTypeOf(t.type,"pseudogenic_transcript"),c=i.isTypeOf(t.type,"CDS");if(s||l)return;const{bp:u,refName:d,regionNumber:f,x:p}=e,{lgv:h}=r;if(c){const e=t.parent;if(!e?.children)return;const r=[];for(const t of e.children.values())i.isTypeOf(t.type,"exon")&&r.push(t);const a=r.find((e=>{const[t,r]=n.intersection2(u-1,u,e.min,e.max);return void 0!==t&&void 0!==r}));if(a){const e=kp(a,d,f,h);if(e){const t=Cp(a,p,e);if(t)return t}}}const m=kp(t,d,f,h);if(m){const e=Cp(t,p,m);if(e)return e}}function Ij(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")}function Pj(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"exon")}const{drawTooltip:Fj,getContextMenuItemsForFeature:Mj,onMouseLeave:jj}=_j,Dj={draw:function(e,t,r,a,o){const{apolloRowHeight:i,lgv:s,session:l,theme:u}=a,{bpPerPx:d,displayedRegions:f,offsetPx:p}=s,h=f[o],{refName:m,reversed:g}=h,y=i,v=Math.round(.9*y),{children:b,min:_,strand:w}=t;if(!b)return;const{apolloSelectedFeature:x}=l,{apolloDataStore:S}=l,{featureTypeOntology:E}=S.ontologyManager;if(!E)throw new Error("featureTypeOntology is undefined");const k=(s.bpToPx({refName:m,coord:_,regionNumber:o})?.offsetPx??0)-p,C=t.length/d,A=g?k-C:k,O=r*y,T=Tj(t,E)*y;e.fillStyle=c.alpha(u?.palette.background.paper??"#ffffff",.6),e.fillRect(A,O,C,T);let N=0;for(const[,t]of b){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){N+=1;continue}const{children:n}=t;if(!n)continue;const i=Oj(t,E);for(const[,i]of n)E.isTypeOf(i.type,"CDS")&&(Aj(e,a,o,r,t,N),N+=1);0===i&&(Aj(e,a,o,r,t,N),N+=1)}const R="dark"===u?.palette.mode?Sj:wj,I="dark"===u?.palette.mode?Ej:xj;N=0;for(const[,t]of b){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){_j.draw(e,t,r,a,o),N+=1;continue}const i=Oj(t,E);if(0!=i)for(const i of t.cdsLocations){const{_id:l,children:c}=t;if(c){for(const[,t]of c)E.isTypeOf(t.type,"exon")&&Cj(e,a,o,r,t,N,w,R,I);for(const a of i){const i=(a.max-a.min)/d,c=(s.bpToPx({refName:m,coord:a.min,regionNumber:o})?.offsetPx??0)-p,f=g?c-i:c;e.fillStyle=u?.palette.text.primary??"black";const h=(r+N)*y+(y-v)/2;if(e.fillRect(f,h,i,v),i>2){e.clearRect(f+1,h+1,i-2,v-2);const r=n.getFrame(a.min,a.max,t.strand??1,a.phase),o=u?.palette.framesCDS.at(r)?.main;if(e.fillStyle=x&&l===x._id?"rgb(0,0,0)":o??"rgb(171,71,188)",e.fillRect(f+1,h+1,i-2,v-2),R&&I&&w){const t=g?-1:1,[n,r]=w*t==1?[R,I]:[I,R];e.fillStyle=n,e.fillRect(f+1,h+1,i-2,(v-2)/2),e.fillStyle=r,e.fillRect(f+1,h+(v-2)/2,i-2,(v-2)/2)}}}N+=1}}const{children:l}=t;if(0===i&&l){for(const[,t]of l)E.isTypeOf(t.type,"exon")&&Cj(e,a,o,r,t,N,w,R,I);N+=1}}},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,session:o,theme:i}=e,{featureTypeOntology:s}=o.apolloDataStore.ontologyManager;if(!n)return;const{feature:l}=n,c=e.getFeatureLayoutPosition(l);if(!c)return;const{bpPerPx:u,displayedRegions:d,offsetPx:f}=a,{featureRow:p,layoutIndex:h,layoutRow:m}=c,g=d[h],{refName:y,reversed:v}=g,{length:b,max:_,min:w}=l,x=(a.bpToPx({refName:y,coord:v?_:w,regionNumber:h})?.offsetPx??0)-f,S=(m+p)*r,E=b/u;if(t.fillStyle=i?.palette.action.selected??"rgba(0,0,0,04)",!s)throw new Error("featureTypeOntology is undefined");t.fillRect(x,S,E,r*Tj(l,s))},drawTooltip:Fj,getContextMenuItems:function(e,t){const{apolloInternetAccount:r,apolloHover:a,changeManager:o,regions:i,selectedFeature:s,session:l}=e,[c]=i,u=e.getAssemblyId(c.assemblyName),d=[],f="admin"===(r?r.role:"admin");if(!a)return d;let p=Ep(t);(function(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"CDS")})(t.featureAndGlyphUnderMouse.feature,l)&&(p=Ep(t,!0));for(const t of p){const r=_j.getContextMenuItemsForFeature(e,t);Pj(t,l)&&r.push({label:"Merge exons",disabled:!f,onClick:()=>{l.queueDialog((n=>[_R,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}},{label:"Split exon",disabled:!f,onClick:()=>{l.queueDialog((n=>[fI,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),Ij(t,l)&&(r.push({label:"Merge transcript",onClick:()=>{l.queueDialog((n=>[xR,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),n.isSessionModelWithWidgets(l)&&r.push({label:"Open transcript details",onClick:()=>{const e=l.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:t,assembly:u,changeManager:o,refName:c.refName});l.showWidget(e)}})),d.push({label:t.type,subMenu:r})}return d},getContextMenuItemsForFeature:Mj,getFeatureFromLayout:function(e,t,n,r){const a=Nj(e,r)[n]||[];for(const e of a){let n;if(t>=e.min&&t<=e.max&&e.parent&&(n=e),n){if(r.isTypeOf(n.type,"CDS")&&n.parent&&(r.isTypeOf(n.parent.type,"transcript")||r.isTypeOf(n.parent.type,"pseudogenic_transcript"))){const{cdsLocations:e}=n.parent;for(const r of e)for(const e of r)if(t>=e.min&&t<=e.max)return n;return n.parent}return n}}return e},getRowCount:Tj,getRowForFeature:function(e,t,n){const r=Nj(e,n);for(const[e,n]of r.entries())if(n.some((e=>e._id===t._id)))return e},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{feature:a}=r,o=Rj(t,a,e);o&&(n.stopPropagation(),e.startDrag(t,o.feature,o.edge,!0))},onMouseLeave:jj,onMouseMove:function(e,t){if(nD(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{feature:r}=n;if(Rj(t,r,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t;if(!n)return;const{feature:r}=n;e.setSelectedFeature(r);const{session:a}=e,{apolloDataStore:o}=a,{featureTypeOntology:i}=o.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");let s=!1;for(const[,e]of r.children??[])if(i.isTypeOf(e.type,"CDS")||i.isTypeOf(e.type,"exon")){s=!0;break}(i.isTypeOf(r.type,"transcript")||i.isTypeOf(r.type,"pseudogenic_transcript"))&&s?e.showFeatureDetailsWidget(r,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(r)}};function Lj(e){const t=[[e]];if(e.children)for(const[,n]of e.children)t.push(...Lj(n));return t}function Bj(e){return Lj(e).length}function qj(e,t,n,r,a,o){const i=Lj(t)[n-r];for(const t of i)Uj(e,t,n,a,o)}function Uj(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,session:s}=r,{bpPerPx:l,displayedRegions:c,offsetPx:u}=i,d=c[a],f=(i.bpToPx({refName:d.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-u,{reversed:p}=d,{apolloSelectedFeature:h}=s,m=t.length/l,g=p?f-m:f,y=n*o,v=Bj(t),b=hj(t,h);v>1&&gj(e,g,y,m,v*o,b?"rgba(130,0,0,0.45)":"rgba(255,0,0,0.25)"),_j.draw(e,t,n,r,a)}const{drawDragPreview:zj,drawTooltip:Gj,getContextMenuItemsForFeature:Hj,onMouseDown:$j,onMouseLeave:Wj,onMouseMove:Vj,onMouseUp:Jj}=_j,Yj={draw:function(e,t,n,r,a){for(let o=0;o<Bj(t);o++)qj(e,t,n+o,n,r,a)},drawDragPreview:zj,drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a}=e;if(!n)return;const{feature:o}=n,i=e.getFeatureLayoutPosition(o);if(!i)return;const{featureRow:s,layoutIndex:l,layoutRow:c}=i,{bpPerPx:u,displayedRegions:d,offsetPx:f}=a,p=d[l],{refName:h,reversed:m}=p,{length:g,max:y,min:v}=o,b=(a.bpToPx({refName:h,coord:m?y:v,regionNumber:l})?.offsetPx??0)-f,_=(c+s)*r,w=g/u;t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(b,_,w,r*Bj(o))},drawTooltip:Gj,getContextMenuItemsForFeature:Hj,getContextMenuItems:function(e,t){const{apolloHover:n,session:r}=e,a=[];if(!n)return a;const{feature:o}=n,{featureTypeOntology:i}=r.apolloDataStore.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");const s=_j.getContextMenuItems(e,t);a.push({label:o.type,subMenu:s});for(const n of Ep(t)){if(n._id===o._id)continue;const t=_j.getContextMenuItemsForFeature(e,n);a.push({label:n.type,subMenu:t})}return a},getFeatureFromLayout:function(e,t,n){return Lj(e)[n].find((e=>t>=e.min&&t<=e.max))},getRowCount:Bj,getRowForFeature:function(e,t){const n=Lj(e);for(const[e,r]of n.entries())if(r.some((e=>e._id===t._id)))return e},onMouseDown:$j,onMouseLeave:Wj,onMouseMove:Vj,onMouseUp:Jj},Kj=p.observer((function({featureTypes:e,handleClose:t,onUpdate:n,session:r}){const[a,o]=u.useState(""),[i,s]=u.useState(e);return $.default.createElement(Vp,{open:!0,maxWidth:!1,"data-testid":"filter-features-dialog",title:"Filter features by type",handleClose:t},$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,null,"Select the feature types you want to display in the apollo track"),$.default.createElement(c.Grid2,{container:!0,spacing:2},$.default.createElement(c.Grid2,{size:8},$.default.createElement(tR,{session:r,ontologyName:"Sequence Ontology",style:{width:"100%"},value:a,filterTerms:XN,renderInput:e=>$.default.createElement(c.TextField,{...e,label:"Feature type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{t&&(e=>{o(e)})(t)}})),$.default.createElement(c.Grid2,{size:4},$.default.createElement(c.Button,{variant:"contained",onClick:()=>{if(a){if(i.includes(a))return;n([...i,a]),s([...i,a])}},disabled:!a,style:{marginTop:9},size:"medium"},"Add"))),i.length>0&&$.default.createElement("div",null,$.default.createElement("hr",null),$.default.createElement("div",{style:{width:300}},$.default.createElement(c.DialogContentText,null,"Selected feature types:"),$.default.createElement(c.Box,{sx:{display:"flex",flexWrap:"wrap",gap:.5}},i.map((e=>$.default.createElement(c.Chip,{key:e,label:e,onDelete:()=>{(e=>{const t=i.filter((t=>t!==e));n(t),s(t)})(e)}}))))))))}));function Zj(e,t,n){const r=[];for(let a=e;a<e+t;a++){const e=n.get(a);e&&r.push(e)}return r}function Xj(e,t){for(const r of e)for(const[e,a]of r)if(n.doesIntersect2(t.min,t.max,e,a)||n.doesIntersect2(e,a,t.min,t.max))return!1;return!0}function Qj(e,t){return t?.palette.bases[e.toUpperCase()].main.toString()??"lightgray"}function eD(e,t,n,r,a){const o=Math.min(n,10);e.fillStyle="#000",e.font=`${o}px`;const i=e.measureText(r).width;e.fillText(r,t+(n-i)/2,a+10)}function tD(e,t,r,a,o,i,s,l,c,u,d,f){let p=s.slice(l,l+3).toUpperCase();c&&(p=function(e){return[...e].map((e=>n.revcom(e))).reverse().join("")}(p));const h=n.defaultCodonTable[p];if(!h)return;const m=function(e,t){return{M:"#33ee33","*":t?"#000000":"#f44336"}[e.toUpperCase()]}(h,f);m&&(d&&"*"==h||u&&"*"!=h)&&(e.fillStyle=m,e.fillRect(r,a,o,i)),t<=.1&&(e.rect(r,a,o,i),e.stroke(),eD(e,r,o,h,a))}function nD(e){return"featureAndGlyphUnderMouse"in e}function rD(e,t){const n=t<=1?2:0;switch(e){case 3:return 0;case 2:return 1;case 1:return 2;case-1:return 3+n;case-2:return 4+n;case-3:return 5+n}}function aD(e,t){if(!(t>1||void 0===e))return 1===e?3:4}function oD(e,t,n,r,a,o){void 0!==a&&(e.fillStyle=t?.palette.action.focus??"rgba(0,0,0,0.04)",e.fillRect(n,r*a,o,r))}function iD(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return a.BaseDisplay.named("BaseLinearApolloDisplay").props({type:l.types.literal("LinearApolloDisplay"),configuration:r.ConfigurationReference(t),graphical:!0,table:!1,showStartCodons:!1,showStopCodons:!0,highContrast:!1,heightPreConfig:l.types.maybe(l.types.refinement("displayHeight",l.types.number,(e=>e>=20))),filteredFeatureTypes:l.types.array(l.types.string),loadingState:!1}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...D.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?500:e.graphical?200:300},get loading(){return e.loadingState}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=200)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=l.getRoot(e),{assemblyName:a}=t,{assemblyManager:o}=e.session,i=o.get(a);if(!i)throw new Error(`No assembly found with name ${a}`);const{internetAccountConfigId:s}=r.getConf(i,["sequence","metadata"]);return n.find((e=>r.getConf(e,"internetAccountId")===s))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowStartCodons(){e.showStartCodons=!e.showStartCodons},toggleShowStopCodons(){e.showStopCodons=!e.showStopCodons},toggleHighContrast(){e.highContrast=!e.highContrast},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=l.cast(t)},setLoading(t){e.loadingState=t}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:n}=e;return{trackMenuItems(){const{graphical:r,table:a,showStartCodons:o,showStopCodons:i,highContrast:s}=e;return[...n(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:r&&!a,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:a&&!r,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:a&&r,onClick:()=>{e.showGraphicalAndTable()}},{label:"Show start codons",type:"checkbox",checked:o,onClick:()=>{e.toggleShowStartCodons()}},{label:"Show stop codons",type:"checkbox",checked:i,onClick:()=>{e.toggleShowStopCodons()}},{label:"Use high contrast colors",type:"checkbox",checked:s,onClick:()=>{e.toggleHighContrast()}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((r=>[Kj,{session:n,handleClose:()=>{r()},featureTypes:l.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],d=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(d)},afterAttach(){l.addDisposer(e,s.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.setLoading(!0),e.session.apolloDataStore.loadFeatures(e.regions).then((()=>{setTimeout((()=>{e.setLoading(!1)}),1e3)})),e.lgv.bpPerPx<=3&&e.session.apolloDataStore.loadRefSeq(e.regions))}),{name:"LinearApolloDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return o.named("LinearApolloDisplayLayouts").props({cleanupBoundary:2e5}).volatile((()=>({seenFeatures:s.observable.map()}))).views((e=>({getAnnotationFeatureById:t=>e.seenFeatures.get(t),getGlyph:e=>e.looksLikeGene?Dj:e.children?.size?Yj:_j}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((r=>{const a=t.get(r.assemblyName),o=new Map,i=new Map,{end:s,refName:c,start:u}=r;for(const[t,r]of e.seenFeatures.entries()){if(!l.isAlive(r)){e.deleteSeenFeature(t);continue}if(c!==a?.getCanonicalRefName(r.refSeq)||!n.doesIntersect2(u,s,r.min,r.max)||e.filteredFeatureTypes.length>0&&!e.filteredFeatureTypes.includes(r.type))continue;const{featureTypeOntology:d}=e.session.apolloDataStore.ontologyManager;if(!d)throw new Error("featureTypeOntology is undefined");const f=e.getGlyph(r).getRowCount(r,d,e.lgv.bpPerPx);let p=0,h=!1;for(;!h;){let e=Zj(p,f,i);if(e.length<f){for(let t=0;t<f-e.length;t++){const e=i.size;i.set(e,[]),o.set(e,[])}e=Zj(p,f,i)}if(Xj(e,r)){for(let e=p;e<p+f;e++){i.get(e)?.push([r.min,r.max]);const t=o.get(e);t?.push([e-p,r._id])}h=!0}else p+=1}}return o}))},getFeatureLayoutPosition(t){const{featureLayouts:n}=this,{featureTypeOntology:r}=e.session.apolloDataStore.ontologyManager;for(const[a,o]of n.entries())for(const[n,i]of o)for(const[o,s]of i){if(0!==o)continue;const i=e.getAnnotationFeatureById(s);if(i){if(t._id===i._id)return{layoutIndex:a,layoutRow:n,featureRow:o};if(i.hasDescendant(t._id)){if(!r)throw new Error("featureTypeOntology is undefined");const o=e.getGlyph(i).getRowForFeature(i,t,r);if(void 0!==o)return{layoutIndex:a,layoutRow:n,featureRow:o}}}}}}))).views((e=>({get highestRow(){return Math.max(0,...e.featureLayouts.map((e=>Math.max(...e.keys()))))}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered()){for(const[t,r]of e.seenFeatures.entries()){let a=!1;for(const t of e.regions)if(n.doesIntersect2(t.start-e.cleanupBoundary,t.end+e.cleanupBoundary,r.min,r.max)){a=!0;break}a||e.deleteSeenFeature(t)}for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}}),{name:"LinearApolloDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloDisplayRendering").props({sequenceRowHeight:15,apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:40,isShown:!0,filteredTranscripts:l.types.array(l.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,seqTrackCanvas:null,seqTrackOverlayCanvas:null,theme:void 0}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setSeqTrackCanvas(t){e.seqTrackCanvas=t},setSeqTrackOverlayCanvas(t){e.seqTrackOverlayCanvas=t},setTheme(t){e.theme=t},afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,d=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,d,100),t.fillStyle="black",t.fillText(n.name,u+1,11,d-2)}a++}}}}),{name:"LinearApolloDisplayRenderCollaborators"}))}})))}(0,t);return o.actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{theme:t}=e;if(!e.lgv.initialized||e.regionCannotBeRendered())return;const r=3/e.lgv.bpPerPx;if(r<1)return;const a=e.seqTrackCanvas?.getContext("2d");if(!a)return;a.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.lgv.bpPerPx<=1?125:95);const o=e.lgv.bpPerPx<=1?[3,2,1,0,0,-1,-2,-3]:[3,2,1,-1,-2,-3];let i=0;if(t)for(const n of o){let r=t.palette.framesCDS.at(n)?.main;if(r){let n=0;e.highContrast&&(r="white",n=1,a.fillStyle=t.palette.grey[200],a.fillRect(0,i,e.lgv.dynamicBlocks.totalWidthPx,e.sequenceRowHeight)),a.fillStyle=r,a.fillRect(0+n,i+n,e.lgv.dynamicBlocks.totalWidthPx-2*n,e.sequenceRowHeight-2*n)}i+=e.sequenceRowHeight}for(const[t,o]of e.regions.entries()){const{apolloDataStore:i}=e.session,s=i.assemblies.get(o.assemblyName),l=s?.getByRefName(o.refName),c=l?.getSequence(o.start,o.end);if(!c)return;for(const[i,s]of[...c].entries()){const l=(e.lgv.bpToPx({refName:o.refName,coord:o.start+i,regionNumber:t})?.offsetPx??0)-e.lgv.offsetPx,u=e.lgv.displayedRegions[t].reversed?l-r:l;for(let t=2;t>=0;t--)(o.start+i)%3===t&&tD(a,e.lgv.bpPerPx,u,e.sequenceRowHeight*(2-t),r,e.sequenceRowHeight,c,i,!1,e.showStartCodons,e.showStopCodons,e.highContrast);if(e.lgv.bpPerPx<=1){const r=(e.lgv.bpToPx({refName:o.refName,coord:o.start+i,regionNumber:t})?.offsetPx??0)-e.lgv.offsetPx,l=1/e.lgv.bpPerPx,c=e.lgv.displayedRegions[t].reversed?r-l:r;a.beginPath(),a.fillStyle=Qj(s,e.theme),a.rect(c,3*e.sequenceRowHeight,l,e.sequenceRowHeight),a.fill(),e.lgv.bpPerPx<=.1&&(a.stroke(),eD(a,c,l,s,3*e.sequenceRowHeight));const u=n.revcom(s);a.beginPath(),a.fillStyle=Qj(u,e.theme),a.rect(c,4*e.sequenceRowHeight,l,e.sequenceRowHeight),a.fill(),e.lgv.bpPerPx<=.1&&(a.stroke(),eD(a,c,l,u,4*e.sequenceRowHeight))}for(let t=0;t<=2;t++)(o.start+i)%3===t&&tD(a,e.lgv.bpPerPx,u,e.sequenceRowHeight*((e.lgv.bpPerPx<=1?5:3)+t),r,e.sequenceRowHeight,c,i,!0,e.showStartCodons,e.showStopCodons,e.highContrast)}}}),{name:"LinearApolloDisplayRenderSequence"}))}})))}(0,t).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{canvas:t,featureLayouts:r,featuresHeight:a,lgv:o}=e;if(!o.initialized||e.regionCannotBeRendered())return;const{displayedRegions:i,dynamicBlocks:s}=o,l=t?.getContext("2d");if(l){l.clearRect(0,0,s.totalWidthPx,a);for(const[t,a]of r.entries()){const r=i[t];for(const[o,i]of a.entries())for(const[a,s]of i){const i=e.getAnnotationFeatureById(s);a>0||!i||n.doesIntersect2(r.start,r.end,i.min,i.max)&&e.getGlyph(i).draw(l,i,o,e,t)}}}}),{name:"LinearApolloDisplayRenderFeatures"}))}})))}(0,t);return o.named("LinearApolloDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0,apolloHover:void 0}))).views((e=>({getMousePosition(t){const n=function(e,t){const n=e.currentTarget,{clientX:r,clientY:a}=e,{left:o,top:i}=n.getBoundingClientRect(),s=r-o,l=a-i,{coord:c,index:u,refName:d}=t.pxToBp(s);return{x:s,y:l,refName:d,bp:c,regionNumber:u}}(t,e.lgv),{bp:r,regionNumber:a,y:o}=n,i=Math.floor(o/e.apolloRowHeight),s=e.featureLayouts[a].get(i);if(!s)return n;const l=s.find((t=>{const n=e.getAnnotationFeatureById(t[1]);return n&&r>=n.min&&r<=n.max}));if(!l)return n;const[c,u]=l,d=e.getAnnotationFeatureById(u);if(!d)return n;const f=e.getGlyph(d),{featureTypeOntology:p}=e.session.apolloDataStore.ontologyManager;if(!p)throw new Error("featureTypeOntology is undefined");const h=f.getFeatureFromLayout(d,r,c,p);return h?{...n,featureAndGlyphUnderMouse:{feature:h,topLevelFeature:d,glyph:f}}:n}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setApolloHover(t){e.apolloHover=t},setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(e){}}))).actions((()=>({onClick(){}})))}(0,t).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.seqTrackOverlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.lgv.bpPerPx<=1?125:95);const{apolloHover:r,lgv:a,regions:o,sequenceRowHeight:i,session:s,theme:l}=e;if(!r)return;const{feature:c}=r,{featureTypeOntology:u}=s.apolloDataStore.ontologyManager;if(!u)throw new Error("featureTypeOntology is undefined");for(const[e,r]of o.entries())if(u.isTypeOf(c.type,"CDS")){const o=c.parent;if(!o)continue;const s=o.cdsLocations.find((e=>c.min===e.at(0)?.min&&c.max===e.at(-1)?.max));if(!s)continue;for(const o of s){const s=rD(n.getFrame(o.min,o.max,c.strand??1,o.phase),a.bpPerPx),u=(a.bpToPx({refName:r.refName,coord:o.min,regionNumber:e})?.offsetPx??0)-a.offsetPx,d=(o.max-o.min)/a.bpPerPx;oD(t,l,a.displayedRegions[e].reversed?u-d:u,i,s,d)}}else{const n=aD(c.strand,a.bpPerPx),o=(a.bpToPx({refName:r.refName,coord:c.min,regionNumber:e})?.offsetPx??0)-a.offsetPx,s=c.length/a.bpPerPx;oD(t,l,a.displayedRegions[e].reversed?o-s:o,i,n,s)}}),{name:"LinearApolloDisplayRenderSeqHighlight"}))}})))}(0,t);return o.views((e=>({contextMenuItems(t){const{apolloHover:n}=e;if(!n)return[];const r=e.getMousePosition(t),{topLevelFeature:a}=n,o=e.getGlyph(a);return nD(r)?o.getContextMenuItems(e,r):[]}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=Tp(r,t.bp,n,o),c="max"===n?new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);nD(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);nD(n)?n.featureAndGlyphUnderMouse.glyph.onMouseMove(e,n,t):(e.setApolloHover(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setApolloHover();const n=e.getMousePosition(t);nD(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);nD(n)?n.featureAndGlyphUnderMouse.glyph.onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,apolloHover:r}=e;if(!r)return;const{glyph:a}=r;a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:l.types.optional(pj,{})}).named("LinearApolloDisplay")}const sD=r.ConfigurationSchema("LinearApolloSixFrameDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),lD=p.observer((function({sourceFeature:e,filteredTranscripts:t,handleClose:n,onUpdate:r}){const a=[];if(e.children)for(const[,t]of e.children){const e=t.attributes.get("gff_id")?.toString();e&&a.push(e)}const[o,i]=u.useState(t);return $.default.createElement(Vp,{open:!0,maxWidth:!1,"data-testid":"filter-transcripts-dialog",title:"Filter transcripts by ID",handleClose:n},$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,null,"Select the alternate transcripts you want to display in the apollo track"),$.default.createElement(c.Grid2,{container:!0,spacing:2},$.default.createElement(c.Grid2,{size:8},$.default.createElement(c.FormGroup,null,a.map((e=>$.default.createElement(c.FormControlLabel,{control:$.default.createElement(c.Checkbox,{checked:!o.includes(e),onChange:()=>{(e=>{const t=o.includes(e)?o.filter((t=>t!==e)):[...o,e];r(t),i(t)})(e)},inputProps:{"aria-label":"controlled"}}),label:e}))))))))}));let cD=null,uD=null,dD=null,fD=null;const pD=globalThis.document.createElement("canvas");if(pD?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?cD=a.createPattern(n,"repeat"):dD=a.createPattern(n,"repeat"):"light"===t?uD=a.createPattern(n,"repeat"):fD=a.createPattern(n,"repeat")}}function hD(e,t){for(const n of e)if(UN(n,t))return!0;return!1}function mD(e,t){return Boolean(t&&e._id===t._id)}function gD(e,t,r,a){const{filteredTranscripts:o,session:i}=a,{apolloDataStore:s}=i,{featureTypeOntology:l}=s.ontologyManager;if(!l)throw new Error("featureTypeOntology is undefined");const c=l.isTypeOf(r.type,"transcript");if(null===t)return;const u=r.attributes.get("gff_id")?.toString();if(u&&o.includes(u))return;const{bp:d,refName:f,regionNumber:p,x:h}=e,{lgv:m}=a;if(c){const e=r;if(!e.children)return;const a=[],o=[];for(const t of e.children.values()){const e=l.isTypeOf(t.type,"exon"),n=l.isTypeOf(t.type,"CDS");e?a.push(t):n&&o.push(t)}const i=a.find((e=>{const[t,r]=n.intersection2(d,d+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(i){const e=kp(i,f,p,m);if(e){const t=Cp(i,h,e);if(t)return t}}const s=kp(t,f,p,m);if(s){const e=o.find((e=>{const[t,r]=n.intersection2(d,d+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(e){const t=Cp(e,h,s);if(t)return t}}}}const yD={draw:function(e,t,r,a,o){const{apolloRowHeight:i,lgv:s,session:l,theme:u,highestRow:d,filteredTranscripts:f,showFeatureLabels:p}=a,{bpPerPx:h,displayedRegions:m,offsetPx:g}=s,y=m[o],{refName:v,reversed:b}=y,_=i,w=_,x=_,S=_,E=p?2:1,k=u?.palette.text.primary??"black",{attributes:C,children:A,min:O,strand:T}=t;if(!A)return;const{apolloSelectedFeature:N}=l,{apolloDataStore:R}=l,{featureTypeOntology:I}=R.ontologyManager;if(!I)throw new Error("featureTypeOntology is undefined");const P=[],F=(s.bpToPx({refName:v,coord:O,regionNumber:o})?.offsetPx??0)-g,M=t.length/h,j=b?F-M:F,D=(1==T?3:4)*E*_;e.fillStyle=u?.palette.text.primary??"black",e.fillRect(j,D,M,S),e.fillStyle=mD(t,N)?c.alpha("rgb(0,0,0)",.7):c.alpha(u?.palette.background.paper??"#ffffff",.7),e.fillRect(j+1,D+1,M-2,S-2);const L=mD(t,N),B={x:j,y:D,h:S,text:C.get("gff_id")?.toString(),color:k,isSelected:L};L?P.unshift(B):P.push(B);const q="dark"===u?.palette.mode?dD:cD,U="dark"===u?.palette.mode?fD:uD,z=b?-1:1;let G=null,H=null;T&&([G,H]=T*z==1?[q,U]:[U,q]),G&&H&&(e.fillStyle=G,e.fillRect(j+1,D+1,M-2,(S-2)/2),e.fillStyle=H,e.fillRect(j+1,D+(S-2)/2,M-2,(S-2)/2));const $=new Set;for(const[,t]of A){if(!I.isTypeOf(t.type,"transcript")&&!I.isTypeOf(t.type,"pseudogenic_transcript"))continue;const{children:r,cdsLocations:a}=t;if(!r)continue;const i=t.attributes.get("gff_id")?.toString();if(i&&f.includes(i))continue;for(const[,t]of r){if(!I.isTypeOf(t.type,"exon"))continue;const n=(s.bpToPx({refName:v,coord:t.min,regionNumber:o})?.offsetPx??0)-g,r=t.length/h,a=b?n-r:n,i=D+(S-w)/2,l=mD(t,N);if(e.fillStyle=u?.palette.text.primary??"black",e.fillRect(a,i,r,w),r>2){e.clearRect(a+1,i+1,r-2,w-2),e.fillStyle=l?"rgb(0,0,0)":c.alpha("#f5f500",.6),e.fillRect(a+1,i+1,r-2,w-2),G&&H&&(e.fillStyle=G,e.fillRect(a+1,i+1,r-2,(w-2)/2),e.fillStyle=H,e.fillRect(a+1,i+1+(w-2)/2,r-2,(w-2)/2));const n={x:a,y:i,h:w,text:t.attributes.get("gff_id")?.toString(),color:k,isSelected:l};l?P.unshift(n):P.push(n)}}const l=mD(t,N?.parent);let p=0,m=0;for(const r of a){let a=0,i=0,c=1;for(const f of r.sort(((e,t)=>e.max-t.max)))if(N&&l&&I.isTypeOf(N.type,"CDS")||!hD($,f)){const r=(f.max-f.min)/h,y=(s.bpToPx({refName:v,coord:f.min,regionNumber:o})?.offsetPx??0)-g;p=b?y-r:y,e.fillStyle=u?.palette.text.primary??"black";const w=n.getFrame(f.min,f.max,t.strand??1,f.phase);if(m=((w<0?-1*w+5:w)*E-E)*_,e.fillRect(p,m,r,x),r>2){e.clearRect(p+1,m+1,r-2,x-2);const t=u?.palette.framesCDS.at(w)?.main,n=t??"rgb(171,71,188)";if(e.fillStyle=n,e.fillStyle=N&&l&&I.isTypeOf(N.type,"CDS")?"rgb(0,0,0)":n,e.fillRect(p+1,m+1,r-2,x-2),c>1){const t=[(p-i)/2+i,Math.max(w<0?_*E*d+1:1,Math.min(a,m)-_/2)];e.strokeStyle="rgb(0, 128, 128)",e.beginPath(),e.moveTo(i,a),e.lineTo(...t),e.stroke(),e.moveTo(...t),e.lineTo(p,m+_/2),e.stroke()}i=p+r,a=m+_/2,c+=1,G&&H&&(e.fillStyle=G,e.fillRect(p+1,m+1,r-2,(x-2)/2),e.fillStyle=H,e.fillRect(p+1,m+(x-2)/2,r-2,(x-2)/2))}$.add(f)}}const y={x:p,y:m,h:x,text:t.attributes.get("gff_id")?.toString(),color:k,isSelected:l};l?P.unshift(y):P.push(y)}p&&function(e,t,r="10px sans-serif"){for(let a=t.length-1;a>=0;--a){const o=t[a];e.fillStyle=o.color;const i=Math.max(o.x+1,0),s=o.y+o.h,l=n.measureText(o.text,10);o.isSelected&&(e.clearRect(i-5,s,l+10,o.h),e.font="bold ".concat(r)),o.text&&(e.fillText(o.text,i,s+11,l),e.font=r)}}(e,P)},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:d,feature:f,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-f[d]:f[d]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,highestRow:s,session:l,showFeatureLabels:c}=e;if(!r)return;const{apolloDataStore:u}=l,{featureTypeOntology:d}=u.ontologyManager;if(!d)throw new Error("featureTypeOntology is undefined");const{feature:f}=r;if(!d.isTypeOf(f.type,"transcript"))return;const p=f.attributes.get("gff_id")?.toString();if(p&&o.includes(p))return;const h=e.getFeatureLayoutPosition(f);if(!h)return;const{bpPerPx:m,displayedRegions:g,offsetPx:y}=i,{layoutIndex:v}=h,b=g[v],{refName:_,reversed:w}=b,x=a,S=x,E=c?2:1,{cdsLocations:k,strand:C}=f;for(const e of k){let r=0,a=0,o=1;for(const l of e.sort(((e,t)=>e.max-t.max))){const e=(l.max-l.min)/m;if(e>2){const c=(i.bpToPx({refName:_,coord:l.min,regionNumber:v})?.offsetPx??0)-y,u=w?c-e:c,d=n.getFrame(l.min,l.max,C??1,l.phase),f=((d<0?-1*d+5:d)*E-E)*x;if(t.fillStyle="rgba(255,0,0,0.6)",t.fillRect(u,f,e,S),o>1){const e=[(u-a)/2+a,Math.max(d<0?x*E*s+1:1,Math.min(r,f)-x/2)];t.strokeStyle="rgb(0, 0, 0)",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(...e),t.stroke(),t.moveTo(...e),t.lineTo(u,f+x/2),t.stroke()}a=u+e,r=f+x/2,o+=1}}}},drawTooltip:function(e,t){const{apolloHover:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,theme:s}=e;if(!r)return;const{cds:l,feature:u}=r;if(!l)return;const d=e.getFeatureLayoutPosition(u);if(!d)return;const f=u.attributes.get("gff_id")?.toString();if(f&&o.includes(f))return;const{layoutIndex:p}=d,{bpPerPx:h,displayedRegions:m,offsetPx:g}=i,y=m[p],{refName:v,reversed:b}=y,_=a,w=Math.round(.7*_);let x="Loc: ";const{strand:S}=u,{max:E,min:k,phase:C}=l;x+=`${k+1}${E}`;let A=(i.bpToPx({refName:v,coord:b?E:k,regionNumber:p})?.offsetPx??0)-g;const O=n.getFrame(k,E,S??1,C),T=((O<0?-1*O+5:O)-1)*_+(_-w)/2,N=(E-k)/h,R=`Type: ${l.type}`,{attributes:I}=u,P=I.get("gff_name")?.find((e=>""!==e)),F=[t.measureText(R).width,t.measureText(x).width];P&&F.push(t.measureText(`Parent Type: ${u.type}`).width,t.measureText(`Parent Name: ${P}`).width);const M=Math.max(...F);A=A+N+5,t.fillStyle=c.alpha(s?.palette.text.primary??"rgb(1, 1, 1)",.7),t.fillRect(A,T,M+4,4===F.length?55:35),t.beginPath(),t.moveTo(A,T),t.lineTo(A-5,T+5),t.lineTo(A,T+10),t.fill(),t.fillStyle=s?.palette.background.default??"rgba(255, 255, 255)";let j=T+12;t.fillText(R,A+2,j),P&&(j+=12,t.fillText(`Parent Type: ${u.type}`,A+2,j),j+=12,t.fillText(`Parent Name: ${P}`,A+2,j)),j+=12,t.fillText(x,A+2,j)},getContextMenuItems:function(e){const{apolloHover:t,apolloInternetAccount:n,changeManager:r,filteredTranscripts:a,regions:o,selectedFeature:i,session:s}=e,c=[];if(!t)return c;const{feature:u}=t,d=n?n.role:"admin",f="admin"===d,p=!(d&&["admin","user"].includes(d)),[h]=o,m=e.getAssemblyId(h.assemblyName),g=e.getAssemblyId(h.assemblyName);c.push({label:"Add child feature",disabled:p,onClick:()=>{s.queueDialog((e=>[nR,{session:s,handleClose:()=>{e()},changeManager:r,sourceFeature:u,sourceAssemblyId:m,internetAccount:n}]))}},{label:"Copy features and annotations",disabled:p,onClick:()=>{s.queueDialog((e=>[sR,{session:s,handleClose:()=>{e()},changeManager:r,sourceFeature:u,sourceAssemblyId:g}]))}},{label:"Delete feature",disabled:!f,onClick:()=>{s.queueDialog((t=>[cR,{session:s,handleClose:()=>{t()},changeManager:r,sourceFeature:u,sourceAssemblyId:g,selectedFeature:i,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}});const{featureTypeOntology:y}=s.apolloDataStore.ontologyManager;if(!y)throw new Error("featureTypeOntology is undefined");return y.isTypeOf(u.type,"gene")&&c.push({label:"Filter alternate transcripts",onClick:()=>{s.queueDialog((t=>[lD,{handleClose:()=>{t()},sourceFeature:u,filteredTranscripts:l.getSnapshot(a),onUpdate:t=>{e.updateFilteredTranscripts(t)}}]))}}),c},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{cds:a,feature:o}=r,i=gD(t,a,o,e);i&&(n.stopPropagation(),e.startDrag(t,i.feature,i.edge,!0))},onMouseLeave:function(){},onMouseMove:function(e,t){if(vD(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{cds:r,feature:a}=n;if(gD(t,r,a,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t,{session:r}=e,{apolloDataStore:a}=r,{featureTypeOntology:o}=a.ontologyManager;if(!n)return;const{feature:i}=n;if(e.setSelectedFeature(i),!o)throw new Error("featureTypeOntology is undefined");let s=!1;for(const[,e]of i.children??[])if(o.isTypeOf(e.type,"CDS")||o.isTypeOf(e.type,"exon")){s=!0;break}(o.isTypeOf(i.type,"transcript")||o.isTypeOf(i.type,"pseudogenic_transcript"))&&s?e.showFeatureDetailsWidget(i,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(i)}};function vD(e){return"featureAndGlyphUnderMouse"in e}function bD(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return a.BaseDisplay.named("BaseLinearApolloSixFrameDisplay").props({type:l.types.literal("LinearApolloSixFrameDisplay"),configuration:r.ConfigurationReference(t),graphical:!0,table:!1,showFeatureLabels:!0,heightPreConfig:l.types.maybe(l.types.refinement("displayHeight",l.types.number,(e=>e>=20))),filteredFeatureTypes:l.types.array(l.types.string)}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...D.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?500:e.graphical?200:300}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=200)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=l.getRoot(e),{assemblyName:a}=t,{assemblyManager:o}=e.session,i=o.get(a);if(!i)throw new Error(`No assembly found with name ${a}`);const{internetAccountConfigId:s}=r.getConf(i,["sequence","metadata"]);return n.find((e=>r.getConf(e,"internetAccountId")===s))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowFeatureLabels(){e.showFeatureLabels=!e.showFeatureLabels},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=l.cast(t)}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:n}=e;return{trackMenuItems(){const{graphical:r,table:a,showFeatureLabels:o}=e;return[...n(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:r&&!a,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:a&&!r,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:a&&r,onClick:()=>{e.showGraphicalAndTable()}},{label:"Feature Labels",type:"checkbox",checked:o,onClick:()=>{e.toggleShowFeatureLabels()}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((r=>[Kj,{session:n,handleClose:()=>{r()},featureTypes:l.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],d=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(d)},afterAttach(){l.addDisposer(e,s.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.session.apolloDataStore.loadFeatures(e.regions),e.lgv.bpPerPx<=3&&e.session.apolloDataStore.loadRefSeq(e.regions))}),{name:"LinearApolloSixFrameDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return o.named("LinearApolloSixFrameDisplayLayouts").props({featuresMinMaxLimit:5e5}).volatile((()=>({seenFeatures:s.observable.map()}))).views((e=>({get featuresMinMax(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((r=>{const a=t.get(r.assemblyName);let o,i;const{end:s,refName:l,start:c}=r;for(const[,t]of e.seenFeatures)l!==a?.getCanonicalRefName(t.refSeq)||!n.doesIntersect2(c,s,t.min,t.max)||t.length>e.featuresMinMaxLimit||(void 0===o&&({min:o}=t),void 0===i&&({max:i}=t),t.minWithChildren<o&&({min:o}=t),t.maxWithChildren>i&&({max:i}=t));if(void 0!==o&&void 0!==i)return[o,i]}))},getGlyph:e=>yD,featureLabelSpacer:t=>e.showFeatureLabels?2*t-1:t}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get geneTrackRowNums(){return[4,5].map((t=>e.featureLabelSpacer(t)))}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map(((r,a)=>{const o=t.get(r.assemblyName),i=new Map;if(!e.featuresMinMax[a])return i;const{end:s,refName:c,start:u}=r;for(const[t,r]of e.seenFeatures.entries()){if(!l.isAlive(r)){e.deleteSeenFeature(t);continue}if(c!==o?.getCanonicalRefName(r.refSeq)||!n.doesIntersect2(u,s,r.min,r.max))continue;const{featureTypeOntology:a}=e.session.apolloDataStore.ontologyManager;if(!a)throw new Error("featureTypeOntology is undefined");if(r.looksLikeGene){const t=1==r.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1];i.get(t)||i.set(t,[]);const o=i.get(t);o?.push({rowNum:t,feature:r,cds:null});const{children:s}=r;if(!s)continue;for(const[,t]of s)if(a.isTypeOf(t.type,"transcript")){const{cdsLocations:r,strand:o,children:s}=t;if(s)for(const[,t]of s){if(!a.isTypeOf(t.type,"exon"))continue;const n=1==t.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1],r=i.get(n);r?.push({rowNum:n,feature:t,cds:null})}for(const a of r)for(const r of a){let a=n.getFrame(r.min,r.max,o??1,r.phase);a=e.featureLabelSpacer(a<0?-1*a+5:a),i.get(a)||i.set(a,[]);const s=i.get(a);s?.push({rowNum:a,feature:t,cds:r})}}}}return i}))},getFeatureLayoutPosition(e){const{featureLayouts:t}=this;for(const[n,r]of t.entries())for(const[,t]of r)for(const{feature:r}of t)if(e._id===r._id)return{layoutIndex:n,layoutRow:0,featureRow:0}}}))).views((e=>({get highestRow(){return 5}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered())for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}),{name:"LinearApolloSixFrameDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloSixFrameDisplayRendering").props({sequenceRowHeight:15,apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:80,isShown:!0,filteredTranscripts:l.types.array(l.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,theme:void 0}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight*(e.showFeatureLabels?2:1)+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setTheme(t){e.theme=t},afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,d=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,d,100),t.fillStyle="black",t.fillText(n.name,u+1,11,d-2)}a++}}}}),{name:"LinearApolloSixFrameDisplayRenderCollaborators"}))}})))}(0,t);return o.actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{canvas:t,featureLayouts:r,featuresHeight:a,lgv:o}=e;if(!o.initialized||e.regionCannotBeRendered())return;const{displayedRegions:i,dynamicBlocks:s}=o,l=t?.getContext("2d");if(l){l.clearRect(0,0,s.totalWidthPx,a);for(const[t,a]of r.entries()){const r=i[t];for(const[o,i]of a.entries())for(const{feature:a}of i){if(!a.looksLikeGene)continue;if(!n.doesIntersect2(r.start,r.end,a.min,a.max))continue;const{topLevelFeature:i}=a,s=e.getGlyph(i);void 0!==s&&s.draw(l,i,o,e,t)}}}}),{name:"LinearApolloSixFrameDisplayRenderFeatures"}))}})))}(0,t).named("LinearApolloSixFrameDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0,apolloHover:void 0}))).views((e=>({getMousePosition(t){const n=function(e,t){const n=e.currentTarget,{clientX:r,clientY:a}=e,{left:o,top:i}=n.getBoundingClientRect(),s=r-o,l=a-i,{coord:c,index:u,refName:d}=t.pxToBp(s);return{x:s,y:l,refName:d,bp:c,regionNumber:u}}(t,e.lgv),{bp:r,regionNumber:a,y:o}=n,i=Math.floor(o/e.apolloRowHeight)+1,s=e.featureLayouts[a].get(i);if(!s)return n;let l;if(e.geneTrackRowNums.includes(i)?(l=s.find((e=>"exon"==e.feature.type&&r>=e.feature.min&&r<=e.feature.max)),l||(l=s.find((e=>r>=e.feature.min&&r<=e.feature.max)))):l=s.find((t=>{const n=t.feature.attributes.get("gff_id")?.toString();return null!=t.cds&&r>=t.cds.min&&r<=t.cds.max&&(void 0===n||!e.filteredTranscripts.includes(n))})),!l)return n;const{feature:c,cds:u}=l,{topLevelFeature:d}=c,f=e.getGlyph(c);return{...n,featureAndGlyphUnderMouse:{cds:u,feature:c,topLevelFeature:d,glyph:f}}}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setApolloHover(t){e.apolloHover=t},setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(t){e.filteredTranscripts=l.cast(t)}}))).actions((()=>({onClick(){}})))}(0,t);return o.views((e=>({contextMenuItems(t){const{apolloHover:n}=e;if(!n||!t)return[];const{topLevelFeature:r}=n;return e.getGlyph(r).getContextMenuItems(e)}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=Tp(r,t.bp,n,o),c="max"===n?new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);vD(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);vD(n)?n.featureAndGlyphUnderMouse.glyph.onMouseMove(e,n,t):(e.setApolloHover(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setApolloHover();const n=e.getMousePosition(t);vD(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);vD(n)?n.featureAndGlyphUnderMouse.glyph.onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,apolloHover:r}=e;if(!r)return;const{glyph:a}=r;a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloSixFrameDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:l.types.optional(pj,{})}).named("LinearApolloSixFrameDisplay")}const _D=r.ConfigurationSchema("ApolloPlugin",{ontologies:l.types.array(ZN),featureTypeOntologyName:{description:"Name of the feature type ontology",type:"string",defaultValue:"Sequence Ontology"},hasRole:{description:"Flag used internally by jbrowse-plugin-apollo",type:"boolean",defaultValue:!1}}),wD=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogene")||n.isTypeOf(e.type,"pseudogenic_transcript")},xD=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"pseudogene")},SD=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")};function ED(e){const{attributes:t}=e,n=["gene_name","gene_id","gene_stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}const kD=e=>{const t=function(e){const{attributes:t}=e,n=["name","gff_name","transcript_name","gene_name"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e),n=function(e){const{attributes:t}=e,n=["id","gff_id","transcript_id","gene_id","gene_stable_id","stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e);return t?`${e.type} - ${t}`:n?`${e.type} - ${n}`:e.type};function CD({annotationFeature:e,assembly:t,handleClose:n,refSeqId:r,session:a,region:o}){const i=a,{featureTypeOntology:s}=i.apolloDataStore.ontologyManager,d=u.useMemo((()=>Object.keys(e.children??{})),[e]),[f,p]=u.useState(!0),[h,m]=u.useState(d),[g,y]=u.useState(""),[v,b]=u.useState([]),[_,w]=u.useState(!1),[x,S]=u.useState(),E=i.apolloDataStore.assemblies.get(t.name),k=E?.refSeqs.get(r),C=k?.getFeatures(o.start,o.end),A=()=>{const e=[];for(const t of C??[])if(!(t.min>o.end||t.max<o.start)&&s?.isTypeOf(t.type,"gene")){const n=l.getSnapshot(t);e.push(n)}return e};u.useEffect((()=>{y("");const e=A();b(e),S(e[0])}),[h,f,o]);const O=async e=>{if(x)for(const n of Object.keys(e)){const r=e[n];if(r.strand=x.strand,r.children)for(const e of Object.keys(r.children))r.children[e].strand=x.strand;const a=new Or.AddFeatureChange({parentFeatureId:x._id,changedIds:[x._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:r});await R(a)}},T=async n=>{const a=(new _r).toHexString(),o=Math.min(...Object.values(n).map((e=>e.min))),i=Math.max(...Object.values(n).map((e=>e.max))),s=new Or.AddFeatureChange({changedIds:[a],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{_id:a,refSeq:r,min:o,max:i,strand:e.strand,type:"gene",children:n,attributes:{name:[ED(e)],gene_name:[ED(e)]}}});await R(s)},N=async(e,n)=>{if(!x)return;const r=[];e!==x.min&&r.push(new Or.LocationStartChange({typeName:"LocationStartChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldStart:x.min,newStart:e})),n!==x.max&&r.push(new Or.LocationEndChange({typeName:"LocationEndChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldEnd:x.max,newEnd:n}));for(const e of r)await R(e)},R=async e=>{await i.apolloDataStore.changeManager.submit(e)};return $.default.createElement(Vp,{open:!0,title:"Create Apollo Annotation",handleClose:n,fullWidth:!0,maxWidth:"sm"},$.default.createElement(c.DialogTitle,{fontSize:15},"Select the feature to be copied to apollo track"),$.default.createElement(c.DialogContent,null,$.default.createElement(c.Box,{sx:{ml:3}},wD(e,i)&&$.default.createElement(c.FormControlLabel,{control:$.default.createElement(c.Checkbox,{size:"small",checked:f,onChange:e=>{const t=e.target.checked;p(t),m(t?d:[])}}),label:`${kD(e)} (${e.min+1}..${e.max})`}),e.children&&$.default.createElement(c.Box,{sx:{display:"flex",flexDirection:"column",ml:3}},Object.values(e.children).filter((e=>SD(e,i))).map((e=>$.default.createElement(c.FormControlLabel,{key:e._id,control:$.default.createElement(c.Checkbox,{size:"small",checked:h.includes(e._id),onChange:t=>{((e,t)=>{m((n=>e.target.checked?[...n,t._id]:n.filter((e=>e!==t._id))))})(t,e)}}),label:`${kD(e)} (${e.min+1}..${e.max})`}))))),v.length>0&&(!f&&h.length>0||f&&SD(e,i))&&$.default.createElement("div",{style:{border:"1px solid #ccc",marginTop:20,padding:10,borderRadius:5}},$.default.createElement(c.Box,{sx:{ml:3}},$.default.createElement(c.Typography,{variant:"caption",fontSize:12},"Select the destination feature to copy the selected features"),$.default.createElement(c.Box,{sx:{mt:1}},$.default.createElement(c.Select,{labelId:"label",style:{width:"100%"},value:x?._id??"",onChange:e=>{const t=v.find((t=>t._id===e.target.value));S(t)},disabled:_},v.map((e=>$.default.createElement(c.MenuItem,{key:e._id,value:e._id},`${kD(e)} (${e.min+1}..${e.max})`)))))),$.default.createElement(c.Box,{sx:{ml:3}},$.default.createElement(c.FormGroup,null,$.default.createElement(c.FormControlLabel,{control:$.default.createElement(c.Checkbox,{checked:_,onChange:e=>{w(e.target.checked)}}),label:"Create new gene"}))))),$.default.createElement(c.DialogActions,null,$.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===h.length||!f&&h.length>0&&!x,onClick:async()=>{if(f){if(xD(e,i)&&(await(async()=>{let n;if(e.children&&h.length!==Object.values(e.children).length){const r={};for(const t of h)r[t]=e.children[t];n=new Or.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{...e,children:r}})}else n=new Or.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:e});await R(n)})(),a.notify("Successfully copied selected gene and transcript(s)","success")),SD(e,i))if(x&&!_){const t={};if(t[e._id]=e,x.max<e.max||x.min>e.min){const n=Math.min(x.min,e.min),r=Math.max(x.max,e.max);await N(n,r),await O(t)}else await O(t);a.notify("Successfully copied selected transcripts to destination gene","success")}else{const t={};t[e._id]=e,await T(t),a.notify("Successfully created a new gene with selected transcripts","success")}}else{if(!e.children)return;if(x&&!_){const t={};for(const n of h)t[n]=e.children[n];const n=Math.min(...Object.values(t).map((e=>e.min))),r=Math.max(...Object.values(t).map((e=>e.max)));if(x.min>n||x.max<r){const e=Math.min(x.min,n),a=Math.max(x.max,r);await N(e,a),await O(t)}else await O(t);a.notify("Successfully copied transcript to destination gene","success")}else{const t={};for(const n of h)t[n]=e.children[n];await T(t),a.notify("Successfully created a new gene with selected transcript","success")}}n()}},"Create"),$.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:n},"Cancel")),g?$.default.createElement(c.DialogContent,null,$.default.createElement(c.DialogContentText,{color:"error"},g)):null)}function AD(e){if("LinearPileupDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(){const t=e.contextMenuFeature,n=e.getAssembly(),r=e.getRefSeqId(n),a=t.get("start"),o=t.get("end"),i=t.get("strand"),s=t.get("name"),l=function(e){const t=/(\d+)([MIDNSHPX=])/g,n=[];let r;for(;null!==(r=t.exec(e));)n.push([r[2],Number.parseInt(r[1],10)]);return n}(t.get("CIGAR"));let c,u=a;const d=[];for(const[e,t]of l)switch(e){case"M":case"=":case"X":void 0===c&&(c=u),u+=t;break;case"N":void 0!==c&&(d.push({start:c,end:u}),c=void 0),u+=t;break;case"D":u+=t;break;case"I":case"S":case"H":case"P":break;default:throw new Error(`Unknown CIGAR operation: ${e}`)}void 0!==c&&d.push({start:c,end:u});const f={_id:_r().toHexString(),refSeq:r,min:a,max:o,type:"mRNA",strand:i,attributes:{name:[s]}};if(0===d.length)return f;f.children={};for(const e of d){const t={_id:_r().toHexString(),refSeq:r,min:e.start,max:e.end,type:"exon",strand:i};f.children[t._id]=t}return f}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:ru,onClick:()=>{r.queueDialog((t=>[CD,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}function OD(e,t){const n=JSON.parse(JSON.stringify(e)),r=n.subfeatures;return[{start:n.start+1,end:n.end,seq_id:t,source:n.source??null,type:n.type??null,score:n.score??null,strand:n.strand?1===n.strand?"+":"-":null,phase:null!==n.phase||void 0!==n.phase?n.phase:null,attributes:ND(n),derived_features:[],child_features:r?r.map((e=>OD(e,t))):[]}]}function TD(e,t){return Or.gff3ToAnnotationFeature(OD(e,t))}function ND(e){const t={},n=new Set(["start","end","type","strand","refName","subfeatures","derived_features","phase","source","score"]);for(const[r,a]of Object.entries(e))n.has(r)||(t[r]=Array.isArray(a)?a.map(String):[String(a)]);return t}function RD(e){if("LinearBasicDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(t){const n=e.getRefSeqId(t);return TD(e.contextMenuFeature.data,n)}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:ru,onClick:()=>{r.queueDialog((t=>[CD,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}var ID={},PD=eu.exports;Object.defineProperty(ID,"__esModule",{value:!0});var FD=ID.default=void 0;FD=ID.default=(0,PD(tu).default)((0,G.default.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");const MD=d.makeStyles()((e=>({canvasContainer:{position:"relative",left:0},canvas:{position:"absolute",left:0},ellipses:{textOverflow:"ellipsis",overflow:"hidden"},avatar:{position:"absolute",color:e.palette.warning.light,backgroundColor:e.palette.warning.contrastText},loading:{position:"absolute",right:e.spacing(3),zIndex:10,pointerEvents:"none",textAlign:"right"}}))),jD=p.observer((function(e){const t=c.useTheme(),{model:r}=e,{loading:a,contextMenuItems:o,cursor:i,featuresHeight:s,isShown:l,onMouseDown:d,onMouseLeave:p,onMouseMove:h,onMouseUp:m,regionCannotBeRendered:g,setCanvas:y,setCollaboratorCanvas:v,setOverlayCanvas:b,setSeqTrackCanvas:_,setSeqTrackOverlayCanvas:w,setTheme:x}=r,{classes:S}=MD(),E=n.getContainingView(r);u.useEffect((()=>{x(t)}),[t,x]);const[k,C]=u.useState(),[A,O]=u.useState([]),T=g();return l?$.default.createElement($.default.Fragment,null,3/E.bpPerPx>=1?$.default.createElement("div",{className:S.canvasContainer,style:{width:E.dynamicBlocks.totalWidthPx,height:E.bpPerPx<=1?125:95}},$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),_(e)},width:E.dynamicBlocks.totalWidthPx,height:E.bpPerPx<=1?125:95,className:S.canvas,"data-testid":"seqTrackCanvas"}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),w(e)},width:E.dynamicBlocks.totalWidthPx,height:E.bpPerPx<=1?125:95,className:S.canvas,"data-testid":"seqTrackOverlayCanvas"})):null,$.default.createElement("div",{className:S.canvasContainer,style:{width:E.dynamicBlocks.totalWidthPx,height:s},onContextMenu:e=>{e.preventDefault(),A.length>0?O([]):(C([e.clientX,e.clientY]),O(o(e)))}},a?$.default.createElement("div",{className:S.loading},$.default.createElement(c.CircularProgress,{size:"18px"})):null,T?$.default.createElement(c.Alert,{severity:"warning",classes:{message:S.ellipses}},$.default.createElement(c.Tooltip,{title:T},$.default.createElement("div",null,T))):$.default.createElement($.default.Fragment,null,$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),v(e)},width:E.dynamicBlocks.totalWidthPx,height:s,className:S.canvas,"data-testid":"collaboratorCanvas"}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),y(e)},width:E.dynamicBlocks.totalWidthPx,height:s,className:S.canvas,"data-testid":"canvas"}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),b(e)},width:E.dynamicBlocks.totalWidthPx,height:s,onMouseMove:h,onMouseLeave:p,onMouseDown:d,onMouseUp:m,className:S.canvas,style:{cursor:i??"default"},"data-testid":"overlayCanvas"}),$.default.createElement(f.Menu,{open:A.length>0,onMenuItemClick:(e,t)=>{t(),O([])},onClose:()=>{O([])},TransitionProps:{onExit:()=>{O([])}},anchorReference:"anchorPosition",anchorPosition:k?{top:k[1],left:k[0]}:void 0,style:{zIndex:t.zIndex.tooltip},menuItems:A})))):null}));var DD={},LD=eu.exports;Object.defineProperty(DD,"__esModule",{value:!0});var BD=DD.default=void 0;BD=DD.default=(0,LD(tu).default)((0,G.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");const qD=p.observer((function({model:e,hrStyle:t={margin:0,top:0,color:"black"},idx:n=0}){const{apolloRowHeight:r,highestRow:a,showFeatureLabels:o}=e,i=o?2:1;return $.default.createElement("div",{style:{position:"absolute",left:0,top:r*i*(a+1)/2+n*i*r,width:"100%"}},$.default.createElement("hr",{style:t}))})),UD=d.makeStyles()((e=>({canvasContainer:{position:"relative",left:0},canvas:{position:"absolute",left:0},ellipses:{textOverflow:"ellipsis",overflow:"hidden"},avatar:{position:"absolute",color:e.palette.warning.light,backgroundColor:e.palette.warning.contrastText}}))),zD=p.observer((function(e){const t=c.useTheme(),{model:r}=e,{apolloRowHeight:a,contextMenuItems:o,cursor:i,featuresHeight:s,isShown:l,onMouseDown:d,onMouseLeave:p,onMouseMove:h,onMouseUp:m,regionCannotBeRendered:g,session:y,setCanvas:v,setCollaboratorCanvas:b,setOverlayCanvas:_,setTheme:w}=r,{classes:x}=UD(),S=n.getContainingView(r);u.useEffect((()=>{w(t)}),[t,w]);const[E,k]=u.useState(),[C,A]=u.useState([]),O=g();if(!l)return null;const{assemblyManager:T}=y;return $.default.createElement($.default.Fragment,null,$.default.createElement("div",{className:x.canvasContainer,style:{width:S.dynamicBlocks.totalWidthPx,height:s},onContextMenu:e=>{if(e.preventDefault(),C.length>0)A([]);else{const t=[e.clientX,e.clientY];k(t),A(o(t))}}},O?$.default.createElement(c.Alert,{severity:"warning",classes:{message:x.ellipses}},$.default.createElement(c.Tooltip,{title:O},$.default.createElement("div",null,O))):$.default.createElement($.default.Fragment,null,$.default.createElement(qD,{model:r,idx:0}),$.default.createElement(qD,{model:r,hrStyle:{margin:0,top:0,color:"grey",opacity:.4},idx:1}),$.default.createElement(qD,{model:r,idx:2}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),b(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"collaboratorCanvas"}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),v(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"canvas"}),$.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),_(e)},width:S.dynamicBlocks.totalWidthPx,height:s,onMouseMove:h,onMouseLeave:p,onMouseDown:d,onMouseUp:m,className:x.canvas,style:{cursor:i??"default"},"data-testid":"overlayCanvas"}),S.displayedRegions.flatMap(((e,t)=>{const r=T.get(e.assemblyName);return[...y.apolloDataStore.checkResults.values()].filter((t=>r?.isValidRefName(t.refSeq)&&r.getCanonicalRefName(t.refSeq)===e.refName&&n.doesIntersect2(e.start,e.end,t.start,t.end))).map((n=>{const r=(S.bpToPx({refName:e.refName,coord:n.start,regionNumber:t})?.offsetPx??0)-S.offsetPx,[o]=n.ids;return o&&o.parent?.looksLikeGene?$.default.createElement(c.Tooltip,{key:n._id,title:n.message},$.default.createElement(c.Avatar,{className:x.avatar,style:{top:0,left:r,height:a,width:a}},$.default.createElement(BD,null))):null}))})),$.default.createElement(f.Menu,{open:C.length>0,onMenuItemClick:(e,t)=>{t(),A([])},onClose:()=>{A([])},TransitionProps:{onExit:()=>{A([])}},anchorReference:"anchorPosition",anchorPosition:E?{top:E[1],left:E[0]}:void 0,style:{zIndex:t.zIndex.tooltip},menuItems:C}))))})),GD=d.makeStyles()((e=>({shading:{background:c.alpha(e.palette.primary.main,.2),overflowY:"scroll",overflowX:"hidden"},details:{background:e.palette.background.paper},accordionControl:{height:12,width:"100%","&:hover":{background:e.palette.action.hover},display:"flex",alignItems:"center",justifyContent:"center"},accordionRoot:{background:e.palette.divider},resizeHandle:{width:"100%",height:4,position:"absolute",cursor:"row-resize",zIndex:100},expandIcon:{},title:{userSelect:"none"},alertContainer:{display:"flex",alignItems:"center",justifyContent:"center"}})));function HD(e,t){const{apolloRowHeight:n,selectedFeature:r}=e;if(t.current&&r){const a=e.getFeatureLayoutPosition(r);a&&t.current.scroll({top:(a.layoutRow+a.featureRow)*n,behavior:"smooth"})}}const $D=({onResize:e})=>{const{classes:t}=GD(),n=u.useCallback((t=>{t.stopPropagation(),t.preventDefault(),e(t.movementY)}),[e]),r=u.useCallback((e=>{e.stopPropagation(),e.preventDefault(),globalThis.removeEventListener("mousemove",n),globalThis.removeEventListener("mouseup",r),globalThis.removeEventListener("mouseleave",r)}),[n]);return $.default.createElement("div",{onMouseDown:e=>{e.stopPropagation(),globalThis.addEventListener("mousemove",n),globalThis.addEventListener("mouseup",r),globalThis.addEventListener("mouseleave",r)},onClick:e=>{e.stopPropagation(),e.preventDefault()},className:t.resizeHandle})},WD=p.observer((function({onClick:e,onResize:t,open:n,title:r}){const{classes:a}=GD();return $.default.createElement("div",{className:a.accordionRoot},n&&t?$.default.createElement($D,{onResize:t}):null,$.default.createElement("div",{className:a.accordionControl,onClick:e},$.default.createElement(n?FD:VI,{className:a.expandIcon}),r?$.default.createElement(c.Typography,{className:a.title,variant:"caption",component:"span"},r):null))})),VD=p.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=GD(),{graphical:l,height:d,isShown:f,selectedFeature:p,table:h,tabularEditor:m,toggleShown:g}=e,y=u.useRef(null);u.useEffect((()=>{HD(e,y)}),[e,p]);const v=t=>{e.setDetailsHeight(e.detailsHeight-t)};if(!i)return $.default.createElement("div",{className:s.alertContainer},$.default.createElement(c.Alert,{severity:"error"},"Could not load feature type ontology."));if(l&&h){const n=m.isShown?e.detailsHeight:0,r=f?d-e.detailsHeight-24:0;return $.default.createElement("div",{style:{height:d}},$.default.createElement(WD,{open:f,title:"Graphical",onClick:g}),$.default.createElement("div",{className:s.shading,ref:y,style:{height:r}},$.default.createElement(jD,{model:e,...t})),$.default.createElement(WD,{title:"Table",open:m.isShown,onClick:m.togglePane,onResize:v}),$.default.createElement("div",{className:s.details,style:{height:n}},$.default.createElement(fj,{model:e})))}return l?$.default.createElement("div",{className:s.shading,ref:y,style:{height:d}},$.default.createElement(jD,{model:e,...t})):$.default.createElement("div",{className:s.details,style:{height:d}},$.default.createElement(fj,{model:e}))})),JD=p.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=GD(),{detailsHeight:l,graphical:d,height:f,isShown:p,selectedFeature:h,table:m,tabularEditor:g,toggleShown:y}=e,v=u.useRef(null);u.useEffect((()=>{HD(e,v)}),[e,h]);const b=t=>{e.setDetailsHeight(l-t)};if(!i)return $.default.createElement("div",{className:s.alertContainer},$.default.createElement(c.Alert,{severity:"error"},"Could not load feature type ontology."));if(d&&m){const n=g.isShown?l:0,r=p?f-l-24:0;return $.default.createElement("div",{style:{height:f}},$.default.createElement(WD,{open:p,title:"Graphical",onClick:y}),$.default.createElement("div",{className:s.shading,ref:v,style:{height:r}},$.default.createElement(zD,{model:e,...t})),$.default.createElement(WD,{title:"Table",open:g.isShown,onClick:g.togglePane,onResize:b}),$.default.createElement("div",{className:s.details,style:{height:n}},$.default.createElement(fj,{model:e})))}return d?$.default.createElement("div",{className:s.shading,ref:v,style:{height:f}},$.default.createElement(zD,{model:e,...t})):$.default.createElement("div",{className:s.details,style:{height:f}},$.default.createElement(fj,{model:e}))}));var YD={},KD=eu.exports;Object.defineProperty(YD,"__esModule",{value:!0});var ZD=YD.default=void 0;ZD=YD.default=(0,KD(tu).default)((0,G.default.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save");const XD=l.types.model("JobsManager",{}).views((e=>({get jobStatusWidget(){const{widgets:t}=n.getSession(e);let r=t.get("JobsList");return r||(r=n.getSession(e).addWidget("JobsListWidget","JobsList")),r}}))).actions((e=>({update(t,n,r){e.jobStatusWidget.updateJobStatusMessage(t,n),r&&e.jobStatusWidget.updateJobProgressPct(t,r)},abortJob(t,r){const a=n.getSession(e);if(n.isSessionModelWithWidgets(a)){a.showWidget(e.jobStatusWidget),e.jobStatusWidget.updateJobStatusMessage(t,r??"Aborted unexpectedly");const n=e.jobStatusWidget.jobs.findIndex((e=>e.name===t));e.jobStatusWidget.addAbortedJob({...e.jobStatusWidget.jobs[n]}),e.jobStatusWidget.removeJob(t),a.notify("Job aborted","info")}},runJob(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.addJob(t))},done(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.removeJob(t.name),e.jobStatusWidget.addFinishedJob({name:t.name,statusMessage:"All operations successful",progressPct:100,cancelCallback:t.cancelCallback}))}})));class QD{clientStore;constructor(e){this.clientStore=e}}class eL{dataStore;constructor(e){this.dataStore=e}recentChanges=[];async submit(e,t={}){const{addToRecents:r=!0,submitToBackend:a=!0,updateJobsManager:o=!1}=t,i=n.getSession(this.dataStore),s=new AbortController,{jobsManager:l}=n.getSession(this.dataStore),c={name:e.typeName,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{s.abort()}};o&&l.runJob(c);const u=await Or.validationRegistry.frontendPreValidate(e);if(!u.ok){const e=`Pre-validation failed: "${u.resultsMessages}"`;return o&&l.abortJob(c.name,e),void i.notify(e,"error")}try{await e.execute(this.dataStore)}catch(e){return o&&l.abortJob(c.name,String(e)),console.error(e),void i.notify(`Error encountered in client: ${String(e)}. Data may be out of sync, please refresh the page`,"error")}if((await Or.validationRegistry.frontendPostValidate(e,this.dataStore)).ok||await this.revert(e),a){o&&l.update(c.name,"Submitting to driver");const{collaborationServerDriver:n,getBackendDriver:a}=this.dataStore,s=pe.isAssemblySpecificChange(e)?a(e.assembly):n;let d;try{d=await s.submitChange(e,t)}catch(t){return o&&l.abortJob(c.name,String(t)),console.error(t),i.notify(String(t),"error"),void await this.revert(e,!1)}if(!d.ok){const t=`Post-validation failed: "${u.resultsMessages}"`;return o&&l.abortJob(c.name,t),i.notify(t,"error"),void await this.revert(e,!1)}e.notification&&i.notify(e.notification,"success"),r&&this.recentChanges.push(e)}o&&l.done(c)}async revert(e,t=!0){const n=e.getInverse();return this.submit(n,{submitToBackend:t,addToRecents:!1})}async revertLastChange(){const e=this.recentChanges.pop();if(e)return this.revert(e);n.getSession(this.dataStore).notify("No changes to undo!","warning")}}class tL extends QD{inFlight=new Map;async fetch(e,t,n){return e.getFetcher({locationType:"UriLocation",uri:t.toString()})(t,n)}async searchFeatures(e,t){const n=this.clientStore.getInternetAccount(t[0]),{baseURL:r}=n,a=new URL("features/searchFeatures",r),o=new URLSearchParams({assemblies:t.join(","),term:e});a.search=o.toString();const i=a.toString(),s=await this.fetch(n,i);if(!s.ok){const e=await Np(s,"searchFeatures failed");throw new Error(e)}return s.json()}async getFeatures(e){const{assemblyName:t,end:a,refName:o,start:i}=e,{assemblyManager:s}=n.getSession(this.clientStore),l=s.get(t);if(!l)throw new Error(`Could not find assembly with name "${t}"`);const{ids:c}=r.getConf(l,["sequence","metadata"]),u=c[o];if(!u)throw new Error(`Could not find refSeq "${o}"`);const d=this.clientStore.getInternetAccount(t),{baseURL:f}=d,p=new URL("features/getFeatures",f),h=new URLSearchParams({refSeq:u,start:String(i),end:String(a)});p.search=h.toString();const m=p.toString(),g=await this.fetch(d,m);if(!g.ok){const e=await Np(g,"getFeatures failed");throw new Error(e)}return this.checkSocket(t,o,d),g.json()}async getFeatureById(e,t,n){const r=this.clientStore.getInternetAccount(t),{baseURL:a}=r,o=new URL(`features/${e}`,a),i=new URLSearchParams({topLevel:String(n)});o.search=i.toString();const s=await this.fetch(r,o.toString());if(!s.ok){const e=await Np(s,"getFeatureById failed");throw new Error(e)}return s.json()}checkSocket(e,t,n){const{socket:r}=n,a=n.retrieveToken(),o=`${e}-${t}`,i=new eL(this.clientStore);r.hasListeners(o)||r.on(o,(async e=>{if(n.setLastChangeSequenceNumber(Number(e.changeSequence)),e.userSessionId!==a&&e.channel===o){const t=pe.Change.fromJSON(e.changeInfo);await i.submit(t,{submitToBackend:!1})}}))}async getSequence(e){const t=`${e.refName}:${e.start}-${e.end}`,a=this.inFlight.get(t),{assemblyName:o,end:i,refName:s,start:l}=e,{assemblyManager:c}=n.getSession(this.clientStore),u=c.get(o);if(!u)throw new Error(`Could not find assembly with name "${o}"`);const{ids:d}=r.getConf(u,["sequence","metadata"]),f=d[s];if(!f)throw new Error(`Could not find refSeq "${s}"`);if(a)return{seq:await a,refSeq:f};let p=this.clientStore.assemblies.get(o);p||(p=this.clientStore.addAssembly(o));let h=p.refSeqs.get(f);h||(h=p.addRefSeq(f,s));const m=h.getSequence(l,i);if(m.length===i-l)return{seq:m,refSeq:f};const g=this.clientStore.getInternetAccount(o),{baseURL:y}=g,v=new URL("sequence",y),b=new URLSearchParams({refSeq:f,start:String(l),end:String(i)});v.search=b.toString();const _=v.toString(),w=this.getSeqFromServer(g,_,h,l,i);this.inFlight.set(t,w);const x=await w;return this.checkSocket(o,s,g),this.inFlight.delete(t),{seq:x,refSeq:f}}async getSeqFromServer(e,t,n,r,a){const o=await this.fetch(e,t);if(!o.ok){let e;try{e=await o.text()}catch{e=""}throw new Error(`getSequence failed: ${o.status} (${o.statusText})${e?` (${e})`:""}`)}const i=await o.text();return n.addSequence({sequence:i,start:r,stop:a}),i}async getRefNameAliases(e){const{assemblyManager:t}=n.getSession(this.clientStore);if(!t.get(e))throw new Error(`Could not find assembly with name "${e}"`);const r=this.clientStore.getInternetAccount(e),{baseURL:a}=r,o=new URL("refSeqs",a),i=new URLSearchParams({assembly:e});o.search=i.toString();const s=o.toString(),l=await this.fetch(r,s);if(!l.ok){let e;try{e=await l.text()}catch{e=""}throw new Error(`getRefNameAliases failed: ${l.status} (${l.statusText})${e?` (${e})`:""}`)}return(await l.json()).map((e=>({refName:e.name,aliases:[e._id,...e.aliases],uniqueId:`alias-${e._id}`})))}async getRegions(e){const{assemblyManager:t}=n.getSession(this.clientStore);if(!t.get(e))throw new Error(`Could not find assembly with name "${e}"`);const r=this.clientStore.getInternetAccount(e),{baseURL:a}=r,o=new URL("refSeqs",a),i=new URLSearchParams({assembly:e});o.search=i.toString();const s=o.toString(),l=await this.fetch(r,s);if(!l.ok){let e;try{e=await l.text()}catch{e=""}throw new Error(`getRegions failed: ${l.status} (${l.statusText})${e?` (${e})`:""}`)}return(await l.json()).map((e=>({refName:e.name,start:0,end:e.length})))}getAssemblies(e){const{assemblyManager:t}=n.getSession(this.clientStore);return t.assemblies.filter((t=>{const n=r.getConf(t,["sequence","metadata"]);return!(!(n&&n.apollo&&n.internetAccountConfigId)||e&&n.internetAccountConfigId!==e)}))}async submitChange(e,t={}){const{internetAccountId:n}=t,r=this.clientStore.getInternetAccount("assembly"in e?e.assembly:void 0,n),{baseURL:a}=r,o=new URL("changes",a).href,i=await this.fetch(r,o,{method:"POST",body:JSON.stringify(e.toJSON()),headers:{"Content-Type":"application/json"}});if(!i.ok){const e=await Np(i,"submitChange failed");throw new Error(e)}const s=new Or.ValidationResultSet;return i.ok||(s.ok=!1),s}}class nL extends QD{getFeatureById(e,t,n){throw new Error("Method not implemented.")}async getFeatures(){return[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=this.clientStore.assemblies.get(t);if(!o)return{seq:"",refSeq:r};const i=o.refSeqs.get(r);return i?{seq:i.getSequence(a,n),refSeq:r}:{seq:"",refSeq:r}}async getRefNameAliases(e){const t=this.clientStore.assemblies.get(e),n=[];if(!t)return n;for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getRegions(e){const t=this.clientStore.assemblies.get(e);if(!t)return[];const n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=r.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.file&&!t.internetAccountConfigId)}))}async submitChange(e,t={}){const{clientStore:n}=this,{assemblies:r}=n;n.clearCheckResults();for(const[,e]of r)if("InMemoryFileDriver"===e.backendDriverType){const t=await _p(e);n.addCheckResults(t)}return new Or.ValidationResultSet}async searchFeatures(e,t){return[]}}class rL extends QD{getFeatureById(e,t,n){throw new Error("Method not implemented.")}async loadAssembly(e){const{assemblyManager:t}=n.getSession(this.clientStore),a=t.get(e);if(!a)throw new Error(`Assembly ${e} not found`);const{file:o}=r.getConf(a,["sequence","metadata"]),i=require("node:fs");return bp(e,await i.promises.readFile(o,"utf8"),this.clientStore)}async getAssembly(e){let t=this.clientStore.assemblies.get(e);return t||(t=await this.loadAssembly(e)),t}async getRefNameAliases(e){const t=await this.getAssembly(e),n=[];for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getFeatures(e){return await this.getAssembly(e.assemblyName),[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=(await this.getAssembly(t)).refSeqs.get(r);if(!o)throw new Error(`refSeq ${r} not found in client data store`);return{seq:o.getSequence(a,n),refSeq:r}}async getRegions(e){const t=await this.getAssembly(e),n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=r.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.internetAccountConfigId&&t.file)}))}async submitChange(e){if(!pe.isAssemblySpecificChange(e))throw new Error(`Cannot use this type of change with local file: "${e.typeName}"`);const{assemblyManager:t}=n.getSession(this.clientStore),a=t.get(e.assembly);if(!a)throw new Error(`Could not find assembly with name "${e.assembly}"`);const{file:o}=r.getConf(a,["sequence","metadata"]),i=this.clientStore.assemblies.get(e.assembly);if(!i)throw new Error(`Could not find assembly in client with name "${e.assembly}"`);const s=new Set(...i.refSeqs.keys()),{checkResults:c}=this.clientStore;for(const e of c.values())s.has(e.refSeq)&&c.delete(e._id);const u=await _p(i);this.clientStore.addCheckResults(u);const d=[{directive:"gff-version",value:"3"}];for(const[,e]of i.refSeqs)d.push({directive:"sequence-region",value:`${e.name} 1 ${e.sequence[0].stop}`});for(const e of i.comments)d.push({comment:e});for(const[,e]of i.refSeqs){const{features:t}=e;for(const[,e]of t)d.push(Or.annotationFeatureToGFF3(l.getSnapshot(e)))}for(const[,e]of i.refSeqs){const[t]=e.sequence,n=Or.splitStringIntoChunks(t.sequence,80).join("\n");d.push({id:e.name,description:e.description,sequence:n})}const f=vp.formatSync(d),p=require("node:fs");return await p.promises.writeFile(o,f,"utf8"),new Or.ValidationResultSet}async searchFeatures(e,t){return[]}}function aL(e,t){const a=new AbortController,{signal:o}=a,i=e.evaluateExtensionPoint("Apollo-extendAnnotationFeature",_P.AnnotationFeatureModel),c=function(e){return l.types.model("ClientDataStore",{typeName:l.types.optional(l.types.literal("Client"),"Client"),assemblies:l.types.map(_P.ApolloAssembly),checkResults:l.types.map(_P.CheckResult),ontologyManager:l.types.optional(YN,{})}).views((t=>({get internetAccounts(){return l.getRoot(t).internetAccounts},get pluginConfiguration(){return l.getRoot(t).jbrowse.configuration.ApolloPlugin},getFeature:n=>l.resolveIdentifier(e,t.assemblies,n)}))).actions((e=>({addAssembly(t,n){const r={_id:t,refSeqs:{}};return n&&(r.backendDriverType=n),e.assemblies.put(r)},addFeature(t,n){const r=e.assemblies.get(t);if(!r)throw new Error(`Could not find assembly "${t}" to add feature "${n._id}"`);const a=r.refSeqs.get(n.refSeq);if(!a)throw new Error(`Could not find refSeq "${n.refSeq}" to add feature "${n._id}"`);a.features.put(n)},deleteFeature(t){const n=e.getFeature(t);if(!n)throw new Error(`Could not find feature "${t}" to delete`);const{_id:r,parent:a}=n;a?a.deleteChild(t):l.getParentOfType(n,_P.ApolloRefSeq).deleteFeature(r)},deleteAssembly(t){e.assemblies.delete(t)},addCheckResult(t){e.checkResults.put(t)},addCheckResults(t){for(const n of t)e.checkResults.has(n._id)||e.checkResults.put(n)},deleteCheckResult(t){e.checkResults.delete(t)},clearCheckResults(){e.checkResults.clear()}}))).volatile((e=>({changeManager:new eL(e),collaborationServerDriver:new tL(e),inMemoryFileDriver:new nL(e),desktopFileDriver:n.isElectron?new rL(e):void 0}))).actions((e=>({afterCreate(){l.addDisposer(e,s.autorun((()=>{const{ontologyManager:t,pluginConfiguration:a}=e,o=a.ontologies;for(const a of o||[]){const[o,i,s,l]=[r.readConfObject(a,"name"),r.readConfObject(a,"version"),r.readConfObject(a,"source"),r.readConfObject(a,"textIndexFields")];if(!t.findOntology(o)){const r=n.getSession(e),{jobsManager:a}=r,c=new AbortController,u=`Loading ontology "${o}"`,d={name:u,statusMessage:`Loading ontology "${o}", version "${i}", this may take a while`,progressPct:0,cancelCallback:()=>{c.abort(),a.abortJob(d.name)}};t.addOntology(o,i,s,{textIndexing:{indexFields:l},update:(e,t)=>{0!==t?100!==t?a.update(u,e,t):a.done(d):a.runJob(d)}})}}})))}}))).views((e=>({getBackendDriver(t){if(!t)return e.collaborationServerDriver;const a=n.getSession(e),{assemblyManager:o}=a,i=o.get(t);if(!i)return e.collaborationServerDriver;const{file:s,internetAccountConfigId:l}=r.getConf(i,["sequence","metadata"]);return n.isElectron&&s?e.desktopFileDriver:l?e.collaborationServerDriver:e.inMemoryFileDriver},getInternetAccount(t,a){if(!(t??a))throw new Error("Must provide either assemblyName or internetAccountId");let o=a;if(t&&!o){const{assemblyManager:a}=n.getSession(e),i=a.get(t);if(!i)throw new Error(`No assembly found with name ${t}`);({internetAccountConfigId:o}=r.getConf(i,["sequence","metadata"]))}const{internetAccounts:i}=e,s=i.find((e=>e.internetAccountId===o));if(!s)throw new Error(`No InternetAccount found with config id ${a}`);return s}}))).actions((e=>({loadFeatures:l.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const[r,a]=yield t.getFeatures(n);if(0===r.length)continue;const{assemblyName:o,refName:i}=n;let s=e.assemblies.get(o);s||(s=e.assemblies.put({_id:o,refSeqs:{}}));const[l]=r;let c=s.refSeqs.get(l.refSeq);c||(c=s.refSeqs.put({_id:l.refSeq,name:i,features:{}}));for(const e of r)c.features.has(e._id)||c.features.put(e);e.addCheckResults(a)}})),loadRefSeq:l.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const{refSeq:r,seq:a}=yield t.getSequence(n),{assemblyName:o,end:i,refName:s,start:l}=n;let c=e.assemblies.get(o);c||(c=e.assemblies.put({_id:o,refSeqs:{}}));let u=c.refSeqs.get(r);u||(u=c.refSeqs.put({_id:r,name:s,sequence:[]})),u.addSequence({start:l,stop:i,sequence:a})}}))})))}(i),u=t.props({apolloDataStore:l.types.optional(c,{typeName:"Client"}),apolloSelectedFeature:l.types.safeReference(i),jobsManager:l.types.optional(XD,{})}).extend((()=>{const e=s.observable.array([]);return{views:{get collaborators(){return e}},actions:{addOrUpdateCollaborator(t){const n=e.find((e=>e.id===t.id));n?n.locations=t.locations:e.push(t)}}}})).actions((e=>({apolloSetSelectedFeature(t){e.apolloSelectedFeature=t},addApolloTrackConfig(t,n){const a=`apollo_track_${t.name}`;e.tracks.some((e=>e.trackId===a))||e.addTrackConf({type:"ApolloTrack",trackId:a,name:`Annotations (${r.getConf(t,"displayName")||t.name})`,assemblyNames:[t.name],textSearching:{textSearchAdapter:{type:"ApolloTextSearchAdapter",trackId:a,assemblyNames:[t.name],textSearchAdapterId:`apollo_search_${t.name}`,...n?{baseURL:{uri:n,locationType:"UriLocation"}}:{}}}})},broadcastLocations(){const{internetAccounts:t}=l.getRoot(e),n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;t.forEach((t=>{if(void 0!==t.regionNumber){const{assemblyName:r,end:a,refName:o,start:i}=t,s=e.apolloDataStore.assemblies.get(r);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:r,refName:o,start:i,end:a})}}))}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const r=[];for(const e of t)if("baseURL"in e){for(const e of n)r.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(r)}}}))).actions((e=>({afterCreate:l.flow((function*(){s.autorun((()=>{const n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;t.forEach((t=>{if(void 0!==t.regionNumber){const{assemblyName:r,end:a,refName:o,start:i}=t,s=e.apolloDataStore.assemblies.get(r);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:r,refName:o,start:i,end:a})}}))}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const r=[];for(const e of t)if("baseURL"in e){for(const e of n)r.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(r)}}),{name:"ApolloSession"});const{internetAccounts:t,jbrowse:n,reloadPluginManagerCallback:a}=l.getRoot(e);if(r.readConfObject(n.configuration.ApolloPlugin,"hasRole"))return;const i=l.getSnapshot(e),{id:c,name:u}=i;l.applySnapshot(e,{name:u,id:c});for(const e of t){if("ApolloInternetAccount"!==e.type)continue;const{baseURL:t}=e,n=new URL("jbrowse/config.json",t).href,r=e.getFetcher({locationType:"UriLocation",uri:n});let s,l;try{s=yield r(n,{signal:o})}catch(e){console.error(e);continue}if(s.ok){try{l=yield s.json()}catch(e){console.error(e);continue}a(l,i)}else{const e=yield Np(s,"Failed to fetch assemblies");console.error(e)}}})),beforeDestroy(){a.abort("destroying session model")}}))).views((e=>{const t=e.getTrackActionMenuItems;return{getTrackActionMenuItems(n){if("ApolloTrack"===n.type||"ReferenceSequenceTrack"===n.type)return t?.(n);const a=r.readConfObject(n,"trackId");return a.endsWith("-sessionTrack")?[...t?.(n)??[],{label:"Save track to Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:r}=l.getRoot(e),o=l.getSnapshot(r);let i;i=Or.filterJBrowseConfig(o),0===Object.keys(i).length&&(i=void 0);const s={...l.getSnapshot(n),trackId:a.slice(0,a.length-13)};for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new Or.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:i,newJBrowseConfig:{...i,tracks:i?.tracks&&[...i.tracks,s]}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track added","success")}e.deleteTrackConf(n),r.addTrackConf(s)},icon:ZD}]:[...t?.(n)??[],{label:"Remove track from Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:r}=l.getRoot(e),o=l.getSnapshot(r);let i;i=Or.filterJBrowseConfig(o),0===Object.keys(i).length&&(i=void 0);const s=i?.tracks?.filter((e=>e.trackId!==a));for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new Or.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:i,newJBrowseConfig:{...i,tracks:s}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track removed","success")}e.deleteTrackConf(n),r.deleteTrackConf(n)},icon:ZD}]}}}));return l.types.snapshotProcessor(u,{postProcessor(e,t){e.apolloSelectedFeature=void 0;const n=Object.fromEntries(Object.entries(e.apolloDataStore.assemblies).filter((([,e])=>"InMemoryFileDriver"===e.backendDriverType)));if(e.apolloDataStore={typeName:"Client",assemblies:n,checkResults:{}},!t)return e;const{apolloDataStore:r}=t,{checkResults:a}=r;for(const[,t]of a){const[n]=t.ids;if(!n)continue;const a=r.assemblies.get(n.assemblyId);a&&"InMemoryFileDriver"===a.backendDriverType&&(e.apolloDataStore.checkResults[t._id]=l.getSnapshot(t))}return e}})}const oL="WorkerGlobalScope"in globalThis;for(const[e,t]of Object.entries(Or.changes))pe.changeRegistry.registerChange(e,t);const iL=new Or.CDSCheck;pe.checkRegistry.registerCheck(iL.name,iL),Or.validationRegistry.registerValidation(new Or.CoreValidation),Or.validationRegistry.registerValidation(new Or.ParentChildValidation),e.default=class extends q.default{name="ApolloPlugin";version="0.3.7";configurationSchema=_D;install(e){!function(e){e.addAdapterType((()=>new ce.default({name:"ApolloSequenceAdapter",configSchema:LI,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:DI})))}(e),function(e){e.addAdapterType((()=>new ce.default({name:"ApolloRefNameAliasAdapter",configSchema:NI,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:TI})))}(e),function(e){e.addTextSearchAdapterType((()=>new a.TextSearchAdapterType({name:"ApolloTextSearchAdapter",displayName:"Apollo text search adapter",configSchema:HI,AdapterClass:GI,description:"Apollo Text Search adapter"})))}(e),e.addWidgetType((()=>{const e=r.ConfigurationSchema("ApolloFeatureDetailsWidget",{});return new a.WidgetType({name:"ApolloFeatureDetailsWidget",heading:"Apollo feature details",configSchema:e,stateModel:AP,ReactComponent:bP})})),e.addWidgetType((()=>{const e=r.ConfigurationSchema("ApolloTranscriptDetails",{});return new a.WidgetType({name:"ApolloTranscriptDetails",heading:"Apollo transcript details",configSchema:e,stateModel:OP,ReactComponent:GM})})),e.addTrackType((()=>{const t=r.ConfigurationSchema("ApolloTrack",{adapter:""},{baseConfiguration:a.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new a.TrackType({name:"ApolloTrack",configSchema:t,stateModel:a.createBaseTrackModel(e,"ApolloTrack",t)})})),e.addInternetAccountType((()=>new a.InternetAccountType({name:"ApolloInternetAccount",configSchema:au,stateModel:AI(au)}))),e.addDisplayType((()=>new a.DisplayType({name:"LinearApolloDisplay",configSchema:HM,stateModel:iD(0,HM),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:VD}))),e.addDisplayType((()=>new a.DisplayType({name:"LinearApolloSixFrameDisplay",configSchema:sD,stateModel:bD(0,sD),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:JD}))),e.addToExtensionPoint("Core-extendSession",aL.bind(this,e)),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,r=t.views((e=>{const t=e.rubberBandMenuItems;return{rubberBandMenuItems:()=>[...t(),{label:"Add new feature",icon:ru,onClick:()=>{const t=n.getSession(e),{leftOffset:r,rightOffset:a}=e,o=e.getSelectedRegions(r,a);t.queueDialog((e=>[oR,{session:t,handleClose:()=>{e()},region:o[0],changeManager:t.apolloDataStore.changeManager}]))}}]}}));e.stateModel=r}return e})),e.addToExtensionPoint("Core-extendPluggableElement",AD),e.addToExtensionPoint("Core-extendPluggableElement",RD),oL||e.addToExtensionPoint("Core-extendWorker",(t=>"on"in t&&t.on?(t.on("apollo",(async n=>{if("object"!=typeof(r=n)||null===r||!("apollo"in r)||!0!==r.apollo)return;var r;const{apollo:a,messageId:o,method:i}=n;switch(i){case"getSequence":{const{region:r}=n,{assemblyName:i}=r,s=e.rootModel?.session?.apolloDataStore;if(!s)break;const l=s.getBackendDriver(i),{seq:c}=await l.getSequence(r);t.workers[0].postMessage({apollo:a,messageId:o,sequence:c});break}case"getRegions":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r),l=await s.getRegions(r);t.workers[0].postMessage({apollo:a,messageId:o,regions:l});break}case"getRefNameAliases":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r),l=await s.getRefNameAliases(r);t.workers[0].postMessage({apollo:a,messageId:o,refNameAliases:l});break}}})),t):t))}configure(e){n.isAbstractMenuManager(e.rootModel)&&(e.rootModel.appendToMenu("Apollo",{label:"Download GFF3",onClick:e=>{e.queueDialog((t=>[dR,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Manage Checks",onClick:e=>{e.queueDialog((t=>[hR,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"View Change Log",onClick:e=>{e.queueDialog((t=>[YR,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Open local GFF3 file",onClick:e=>{e.queueDialog((t=>[ER,{session:e,handleClose:()=>{t()},inMemoryFileDriver:e.apolloDataStore.inMemoryFileDriver}]))}}),e.rootModel.appendToMenu("Apollo",{label:"View check results",onClick:e=>{e.queueDialog((t=>[uI,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Log out",onClick:e=>{e.queueDialog((t=>[pR,{session:e,handleClose:()=>{t()}}]))}}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=jbrowse-plugin-apollo.umd.production.min.js.map
