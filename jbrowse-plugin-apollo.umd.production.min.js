!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jbrowse/core/Plugin"),require("@jbrowse/core/util"),require("@jbrowse/core/configuration"),require("@jbrowse/core/pluggableElementTypes"),require("@mui/material/utils"),require("react/jsx-runtime"),require("mobx"),require("mobx-state-tree"),require("@mui/material"),require("react"),require("tss-react/mui"),require("@jbrowse/core/ui"),require("mobx-react"),require("@jbrowse/core/util/types/mst"),require("@jbrowse/core/util/io"),require("@mui/material/Checkbox"),require("@mui/material/FormControlLabel"),require("@mui/material/LinearProgress"),require("@mui/x-data-grid"),require("@jbrowse/core/pluggableElementTypes/AdapterType"),require("@jbrowse/core/data_adapters/BaseAdapter"),require("@jbrowse/core/util/rxjs"),require("@jbrowse/core/util/tracks")):"function"==typeof define&&define.amd?define(["exports","@jbrowse/core/Plugin","@jbrowse/core/util","@jbrowse/core/configuration","@jbrowse/core/pluggableElementTypes","@mui/material/utils","react/jsx-runtime","mobx","mobx-state-tree","@mui/material","react","tss-react/mui","@jbrowse/core/ui","mobx-react","@jbrowse/core/util/types/mst","@jbrowse/core/util/io","@mui/material/Checkbox","@mui/material/FormControlLabel","@mui/material/LinearProgress","@mui/x-data-grid","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/data_adapters/BaseAdapter","@jbrowse/core/util/rxjs","@jbrowse/core/util/tracks"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).JBrowsePluginApollo={},e.JBrowseExports["@jbrowse/core/Plugin"],e.JBrowseExports["@jbrowse/core/util"],e.JBrowseExports["@jbrowse/core/configuration"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes"],e.JBrowseExports["@mui/material/utils"],e.JBrowseExports["react/jsx-runtime"],e.JBrowseExports.mobx,e.JBrowseExports["mobx-state-tree"],e.JBrowseExports["@mui/material"],e.JBrowseExports.react,e.JBrowseExports["tss-react/mui"],e.JBrowseExports["@jbrowse/core/ui"],e.JBrowseExports["mobx-react"],e.JBrowseExports["@jbrowse/core/util/types/mst"],e.JBrowseExports["@jbrowse/core/util/io"],e.JBrowseExports["@mui/material/Checkbox"],e.JBrowseExports["@mui/material/FormControlLabel"],e.JBrowseExports["@mui/material/LinearProgress"],e.JBrowseExports["@mui/x-data-grid"],e.JBrowseExports["@jbrowse/core/pluggableElementTypes/AdapterType"],e.JBrowseExports["@jbrowse/core/data_adapters/BaseAdapter"],e.JBrowseExports["@jbrowse/core/util/rxjs"],e.JBrowseExports["@jbrowse/core/util/tracks"])}(this,(function(e,t,n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S){"use strict";function E(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function k(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,t}var A=E(t),C=E(n),O=E(o),T=E(i),N=E(l),R=E(u),I=k(u),P=E(g),F=E(y),M=E(v),j=E(_),D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function L(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}function q(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var B={};function U(e){var t,n;function r(t,n){try{var o=e[t](n),i=o.value,s=i instanceof z;Promise.resolve(s?i.v:i).then((function(n){if(s){var l="return"===t?"return":"next";if(!i.k||n.done)return r(l,n);n=e[l](n).value}a(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise((function(o,i){var s={key:e,arg:a,resolve:o,reject:i,next:null};n?n=n.next=s:(t=n=s,r(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function z(e,t){this.v=e,this.k=t}function G(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new H(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function H(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return H=function(e){this.s=e,this.n=e.next},H.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new H(e)}function $(e){return new z(e,0)}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function J(){J=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=Object.create((t&&t.prototype instanceof y?t:y).prototype),i=new N(r||[]);return a(o,"_invoke",{value:A(e,n,i)}),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",p="suspendedYield",h="executing",m="completed",g={};function y(){}function v(){}function b(){}var _={};c(_,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(R([])));x&&x!==n&&r.call(x,i)&&(_=x);var S=b.prototype=y.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,o,i,s){var l=f(e[a],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(u).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function A(t,n,r){var a=d;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var l=C(s,r);if(l){if(l===g)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===d)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var c=f(t,n,r);if("normal"===c.type){if(a=r.done?m:p,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}function C(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=f(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=b,a(S,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:v,configurable:!0}),v.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new k(u(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(S),c(S,l,"Generator"),c(S,i,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function K(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function Z(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){K(o,r,a,i,s,"next",e)}function s(e){K(o,r,a,i,s,"throw",e)}i(void 0)}))}}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,we(r.key),r)}}function ee(e,t,n){return t&&Q(e.prototype,t),n&&Q(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function te(e,t,n){return(t=we(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ne(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ae(e,t)}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function ae(e,t){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ae(e,t)}function oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ie(e,t,n){return ie=oe()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&ae(a,n.prototype),a},ie.apply(null,arguments)}function se(e){var t="function"==typeof Map?new Map:void 0;return se=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ie(e,arguments,re(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ae(n,e)},se(e)}function le(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e){var t=oe();return function(){var n,r=re(e);if(t){var a=re(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ce(e)}(this,n)}}function fe(){return fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=re(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},fe.apply(this,arguments)}function de(e,t){return me(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw a}}return s}}(e,t)||ye(e,t)||be()}function pe(e){return me(e)||ge(e)||ye(e)||be()}function he(e){return function(e){if(Array.isArray(e))return ve(e)}(e)||ge(e)||ye(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e){if(Array.isArray(e))return e}function ge(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ye(e,t){if(e){if("string"==typeof e)return ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(e,t):void 0}}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function be(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ye(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function we(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}U.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},U.prototype.next=function(e){return this._invoke("next",e)},U.prototype.throw=function(e){return this._invoke("throw",e)},U.prototype.return=function(e){return this._invoke("return",e)};var xe=function(e,t){return xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},xe(e,t)};function Se(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Ee=function(){return Ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},Ee.apply(this,arguments)};function ke(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function Ae(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":Y(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i}function Ce(e,t){return function(n,r){t(n,r,e)}}function Oe(e,t){if("object"===("undefined"==typeof Reflect?"undefined":Y(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Te(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function Ne(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}var Re=Object.create?function(e,t,n,r){void 0===r&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function Ie(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Re(t,e,n)}function Pe(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fe(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i}function Me(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Fe(arguments[t]));return e}function je(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}function De(e,t,n){if(n||2===arguments.length)for(var r,a=0,o=t.length;a<o;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}function Le(e){return this instanceof Le?(this.v=e,this):new Le(e)}function qe(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof Le?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Be(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(n=!n)?{value:Le(e[r](t)),done:!1}:a?a(t):t}:a}}function Ue(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Pe(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}}function ze(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Ge=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function He(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&Re(t,e,n);return Ge(t,e),t}function $e(e){return e&&e.__esModule?e:{default:e}}function We(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function Ve(e,t,n,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,n):a?a.value=n:t.set(e,n),n}function Je(e,t){if(null===t||"object"!==Y(t)&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function Ye(e,t,n){if(null!=t){if("object"!==Y(t)&&"function"!=typeof t)throw new TypeError("Object expected.");var r;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose]}if("function"!=typeof r)throw new TypeError("Object not disposable.");e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var Ke="function"==typeof SuppressedError?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function Ze(e){function t(t){e.error=e.hasError?new Ke(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function n(){for(;e.stack.length;){var r=e.stack.pop();try{var a=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(a).then(n,(function(e){return t(e),n()}))}catch(e){t(e)}}if(e.hasError)throw e.error}()}var Xe={__proto__:null,__extends:Se,get __assign(){return Ee},__rest:ke,__decorate:Ae,__param:Ce,__esDecorate:function(e,t,n,r,a,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var s,l=r.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!t&&e?r.static?e:e.prototype:null,f=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),d=!1,p=n.length-1;p>=0;p--){var h={};for(var m in r)h[m]="access"===m?{}:r[m];for(var m in r.access)h.access[m]=r.access[m];h.addInitializer=function(e){if(d)throw new TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var g=(0,n[p])("accessor"===l?{get:f.get,set:f.set}:f[c],h);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!==Y(g))throw new TypeError("Object expected");(s=i(g.get))&&(f.get=s),(s=i(g.set))&&(f.set=s),(s=i(g.init))&&a.unshift(s)}else(s=i(g))&&("field"===l?a.unshift(s):f[c]=s)}u&&Object.defineProperty(u,r.name,f),d=!0},__runInitializers:function(e,t,n){for(var r=arguments.length>2,a=0;a<t.length;a++)n=r?t[a].call(e,n):t[a].call(e);return r?n:void 0},__propKey:function(e){return"symbol"===Y(e)?e:"".concat(e)},__setFunctionName:function(e,t,n){return"symbol"===Y(t)&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})},__metadata:Oe,__awaiter:Te,__generator:Ne,__createBinding:Re,__exportStar:Ie,__values:Pe,__read:Fe,__spread:Me,__spreadArrays:je,__spreadArray:De,__await:Le,__asyncGenerator:qe,__asyncDelegator:Be,__asyncValues:Ue,__makeTemplateObject:ze,__importStar:He,__importDefault:$e,__classPrivateFieldGet:We,__classPrivateFieldSet:Ve,__classPrivateFieldIn:Je,__addDisposableResource:Ye,__disposeResources:Ze,default:{__extends:Se,__assign:Ee,__rest:ke,__decorate:Ae,__param:Ce,__metadata:Oe,__awaiter:Te,__generator:Ne,__createBinding:Re,__exportStar:Ie,__values:Pe,__read:Fe,__spread:Me,__spreadArrays:je,__spreadArray:De,__await:Le,__asyncGenerator:qe,__asyncDelegator:Be,__asyncValues:Ue,__makeTemplateObject:ze,__importStar:He,__importDefault:$e,__classPrivateFieldGet:We,__classPrivateFieldSet:Ve,__classPrivateFieldIn:Je,__addDisposableResource:Ye,__disposeResources:Ze}},Qe=L(Xe),et={};Object.defineProperty(et,"__esModule",{value:!0}),et.ApolloPlugin=void 0;var tt=function(e){ne(n,e);var t=ue(n);function n(){return X(this,n),t.apply(this,arguments)}return ee(n,[{key:"apolloInstall",value:function(e){}}]),n}(Qe.__importDefault(A.default).default);et.ApolloPlugin=tt;var nt={},rt={},at={};Object.defineProperty(at,"__esModule",{value:!0}),at.changeRegistry=void 0,at.changeRegistry=new(function(){function e(){X(this,e),this.changes=new Map}return ee(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var ot={};Object.defineProperty(ot,"__esModule",{value:!0}),ot.Operation=void 0;var it=function(){function e(t,n){var r;X(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return ee(e,[{key:"execute",value:(t=Z(J().mark((function e(t){var n,r;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();ot.Operation=it,Object.defineProperty(rt,"__esModule",{value:!0}),rt.Change=void 0,rt.isChange=function(e){return void 0!==e.executeOnClient};var st=at,lt=function(e){ne(r,e);var t,n=ue(r);function r(){return X(this,r),n.apply(this,arguments)}return ee(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Z(J().mark((function e(t){var n;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",fe(re(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(st.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(ot.Operation);rt.Change=lt,Object.defineProperty(nt,"__esModule",{value:!0}),nt.AssemblySpecificChange=void 0,nt.isAssemblySpecificChange=function(e){return(0,ct.isChange)(e)&&void 0!==e.assembly};var ct=rt;nt.AssemblySpecificChange=function(e){ne(n,e);var t=ue(n);function n(e,r){var a;return X(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return ee(n)}(ct.Change);var ut={};Object.defineProperty(ut,"__esModule",{value:!0}),ut.Check=void 0,ut.Check=ee((function e(){X(this,e)}));var ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.checkRegistry=void 0,ft.checkRegistry=new(function(){function e(){X(this,e),this.checks=new Map}return ee(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var dt={},pt="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function ht(){throw new Error("setTimeout has not been defined")}function mt(){throw new Error("clearTimeout has not been defined")}var gt=ht,yt=mt;function vt(e){if(gt===setTimeout)return setTimeout(e,0);if((gt===ht||!gt)&&setTimeout)return gt=setTimeout,setTimeout(e,0);try{return gt(e,0)}catch(t){try{return gt.call(null,e,0)}catch(t){return gt.call(this,e,0)}}}"function"==typeof pt.setTimeout&&(gt=setTimeout),"function"==typeof pt.clearTimeout&&(yt=clearTimeout);var bt,_t=[],wt=!1,xt=-1;function St(){wt&&bt&&(wt=!1,bt.length?_t=bt.concat(_t):xt=-1,_t.length&&Et())}function Et(){if(!wt){var e=vt(St);wt=!0;for(var t=_t.length;t;){for(bt=_t,_t=[];++xt<t;)bt&&bt[xt].run();xt=-1,t=_t.length}bt=null,wt=!1,function(e){if(yt===clearTimeout)return clearTimeout(e);if((yt===mt||!yt)&&clearTimeout)return yt=clearTimeout,clearTimeout(e);try{return yt(e)}catch(t){try{return yt.call(null,e)}catch(t){return yt.call(this,e)}}}(e)}}function kt(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];_t.push(new At(e,t)),1!==_t.length||wt||vt(Et)}function At(e,t){this.fun=e,this.array=t}function Ct(){}At.prototype.run=function(){this.fun.apply(null,this.array)};var Ot=Ct,Tt=Ct,Nt=Ct,Rt=Ct,It=Ct,Pt=Ct,Ft=Ct,Mt=pt.performance||{},jt=Mt.now||Mt.mozNow||Mt.msNow||Mt.oNow||Mt.webkitNow||function(){return(new Date).getTime()},Dt=new Date,Lt={nextTick:kt,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:Ot,addListener:Tt,once:Nt,off:Rt,removeListener:It,removeAllListeners:Pt,emit:Ft,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*jt.call(Mt),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Dt)/1e3}},qt=[],Bt=[],Ut="undefined"!=typeof Uint8Array?Uint8Array:Array,zt=!1;function Gt(){zt=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)qt[t]=e[t],Bt[e.charCodeAt(t)]=t;Bt["-".charCodeAt(0)]=62,Bt["_".charCodeAt(0)]=63}function Ht(e,t,n){for(var r,a=[],o=t;o<n;o+=3)a.push(qt[(r=(e[o]<<16)+(e[o+1]<<8)+e[o+2])>>18&63]+qt[r>>12&63]+qt[r>>6&63]+qt[63&r]);return a.join("")}function $t(e,t,n,r,a){var o,i,s=8*a-r-1,l=(1<<s)-1,c=l>>1,u=-7,f=n?a-1:0,d=n?-1:1,p=e[t+f];for(f+=d,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+f],f+=d,u-=8);for(i=o&(1<<-u)-1,o>>=-u,u+=r;u>0;i=256*i+e[t+f],f+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return i?NaN:Infinity*(p?-1:1);i+=Math.pow(2,r),o-=c}return(p?-1:1)*i*Math.pow(2,o-r)}function Wt(e,t,n,r,a,o){var i,s,l,c=8*o-a-1,u=(1<<c)-1,f=u>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||Infinity===t?(s=isNaN(t)?1:0,i=u):(i=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-i))<1&&(i--,l*=2),(t+=i+f>=1?d/l:d*Math.pow(2,1-f))*l>=2&&(i++,l/=2),i+f>=u?(s=0,i=u):i+f>=1?(s=(t*l-1)*Math.pow(2,a),i+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,a),i=0));a>=8;e[n+p]=255&s,p+=h,s/=256,a-=8);for(i=i<<a|s,c+=a;c>0;e[n+p]=255&i,p+=h,i/=256,c-=8);e[n+p-h]|=128*m}var Vt={}.toString,Jt=Array.isArray||function(e){return"[object Array]"==Vt.call(e)};function Yt(){return Zt.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Kt(e,t){if(Yt()<t)throw new RangeError("Invalid typed array length");return Zt.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Zt.prototype:(null===e&&(e=new Zt(t)),e.length=t),e}function Zt(e,t,n){if(!(Zt.TYPED_ARRAY_SUPPORT||this instanceof Zt))return new Zt(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return en(this,e)}return Xt(this,e,t,n)}function Xt(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),Zt.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Zt.prototype:e=tn(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!Zt.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|an(t,n),a=(e=Kt(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(rn(t)){var n=0|nn(t.length);return 0===(e=Kt(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?Kt(e,0):tn(e,t);if("Buffer"===t.type&&Jt(t.data))return tn(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function Qt(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function en(e,t){if(Qt(t),e=Kt(e,t<0?0:0|nn(t)),!Zt.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function tn(e,t){var n=t.length<0?0:0|nn(t.length);e=Kt(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function nn(e){if(e>=Yt())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Yt().toString(16)+" bytes");return 0|e}function rn(e){return!(null==e||!e._isBuffer)}function an(e,t){if(rn(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return In(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Pn(e).length;default:if(r)return In(e).length;t=(""+t).toLowerCase(),r=!0}}function on(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return wn(this,t,n);case"utf8":case"utf-8":return yn(this,t,n);case"ascii":return bn(this,t,n);case"latin1":case"binary":return _n(this,t,n);case"base64":return gn(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xn(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function sn(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function ln(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=Zt.from(t,r)),rn(t))return 0===t.length?-1:cn(e,t,n,r,a);if("number"==typeof t)return t&=255,Zt.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):cn(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function cn(e,t,n,r,a){var o,i=1,s=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;i=2,s/=2,l/=2,n/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(a){var u=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*i}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var f=!0,d=0;d<l;d++)if(c(e,o+d)!==c(t,d)){f=!1;break}if(f)return o}return-1}function un(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[n+i]=s}return i}function fn(e,t,n,r){return Fn(In(t,e.length-n),e,n,r)}function dn(e,t,n,r){return Fn(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function pn(e,t,n,r){return dn(e,t,n,r)}function hn(e,t,n,r){return Fn(Pn(t),e,n,r)}function mn(e,t,n,r){return Fn(function(e,t){for(var n,r,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a.push(n%256),a.push(r);return a}(t,e.length-n),e,n,r)}function gn(e,t,n){return function(e){var t;zt||Gt();for(var n=e.length,r=n%3,a="",o=[],i=16383,s=0,l=n-r;s<l;s+=i)o.push(Ht(e,s,s+i>l?l:s+i));return 1===r?(a+=qt[(t=e[n-1])>>2],a+=qt[t<<4&63],a+="=="):2===r&&(a+=qt[(t=(e[n-2]<<8)+e[n-1])>>10],a+=qt[t>>4&63],a+=qt[t<<2&63],a+="="),o.push(a),o.join("")}(0===t&&n===e.length?e:e.slice(t,n))}function yn(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var o,i,s,l,c=e[a],u=null,f=c>239?4:c>223?3:c>191?2:1;if(a+f<=n)switch(f){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[a+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:i=e[a+2],128==(192&(o=e[a+1]))&&128==(192&i)&&(l=(15&c)<<12|(63&o)<<6|63&i)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:i=e[a+2],s=e[a+3],128==(192&(o=e[a+1]))&&128==(192&i)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,f=1):u>65535&&(r.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),r.push(u),a+=f}return function(e){var t=e.length;if(t<=vn)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=vn));return n}(r)}Zt.TYPED_ARRAY_SUPPORT=void 0===pt.TYPED_ARRAY_SUPPORT||pt.TYPED_ARRAY_SUPPORT,Zt.poolSize=8192,Zt._augment=function(e){return e.__proto__=Zt.prototype,e},Zt.from=function(e,t,n){return Xt(null,e,t,n)},Zt.TYPED_ARRAY_SUPPORT&&(Zt.prototype.__proto__=Uint8Array.prototype,Zt.__proto__=Uint8Array),Zt.alloc=function(e,t,n){return function(e,t,n,r){return Qt(t),t<=0?Kt(e,t):void 0!==n?"string"==typeof r?Kt(e,t).fill(n,r):Kt(e,t).fill(n):Kt(e,t)}(null,e,t,n)},Zt.allocUnsafe=function(e){return en(null,e)},Zt.allocUnsafeSlow=function(e){return en(null,e)},Zt.isBuffer=Mn,Zt.compare=function(e,t){if(!rn(e)||!rn(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=Math.min(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},Zt.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Zt.concat=function(e,t){if(!Jt(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Zt.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=Zt.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!rn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},Zt.byteLength=an,Zt.prototype._isBuffer=!0,Zt.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)sn(this,t,t+1);return this},Zt.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)sn(this,t,t+3),sn(this,t+1,t+2);return this},Zt.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)sn(this,t,t+7),sn(this,t+1,t+6),sn(this,t+2,t+5),sn(this,t+3,t+4);return this},Zt.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?yn(this,0,e):on.apply(this,arguments)},Zt.prototype.equals=function(e){if(!rn(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Zt.compare(this,e)},Zt.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},Zt.prototype.compare=function(e,t,n,r,a){if(!rn(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),i=(n>>>=0)-(t>>>=0),s=Math.min(o,i),l=this.slice(r,a),c=e.slice(t,n),u=0;u<s;++u)if(l[u]!==c[u]){o=l[u],i=c[u];break}return o<i?-1:i<o?1:0},Zt.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},Zt.prototype.indexOf=function(e,t,n){return ln(this,e,t,n,!0)},Zt.prototype.lastIndexOf=function(e,t,n){return ln(this,e,t,n,!1)},Zt.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return un(this,e,t,n);case"utf8":case"utf-8":return fn(this,e,t,n);case"ascii":return dn(this,e,t,n);case"latin1":case"binary":return pn(this,e,t,n);case"base64":return hn(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return mn(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Zt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var vn=4096;function bn(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function _n(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function wn(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",o=t;o<n;++o)a+=Rn(e[o]);return a}function xn(e,t,n){for(var r=e.slice(t,n),a="",o=0;o<r.length;o+=2)a+=String.fromCharCode(r[o]+256*r[o+1]);return a}function Sn(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function En(e,t,n,r,a,o){if(!rn(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function kn(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function An(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-n,4);a<o;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function Cn(e,t,n,r,a,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function On(e,t,n,r,a){return a||Cn(e,0,n,4),Wt(e,t,n,r,23,4),n+4}function Tn(e,t,n,r,a){return a||Cn(e,0,n,8),Wt(e,t,n,r,52,8),n+8}Zt.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),Zt.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=Zt.prototype;else{var a=t-e;n=new Zt(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+e]}return n},Zt.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Sn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r},Zt.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Sn(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},Zt.prototype.readUInt8=function(e,t){return t||Sn(e,1,this.length),this[e]},Zt.prototype.readUInt16LE=function(e,t){return t||Sn(e,2,this.length),this[e]|this[e+1]<<8},Zt.prototype.readUInt16BE=function(e,t){return t||Sn(e,2,this.length),this[e]<<8|this[e+1]},Zt.prototype.readUInt32LE=function(e,t){return t||Sn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Zt.prototype.readUInt32BE=function(e,t){return t||Sn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Zt.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Sn(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},Zt.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Sn(e,t,this.length);for(var r=t,a=1,o=this[e+--r];r>0&&(a*=256);)o+=this[e+--r]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},Zt.prototype.readInt8=function(e,t){return t||Sn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Zt.prototype.readInt16LE=function(e,t){t||Sn(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},Zt.prototype.readInt16BE=function(e,t){t||Sn(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},Zt.prototype.readInt32LE=function(e,t){return t||Sn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Zt.prototype.readInt32BE=function(e,t){return t||Sn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Zt.prototype.readFloatLE=function(e,t){return t||Sn(e,4,this.length),$t(this,e,!0,23,4)},Zt.prototype.readFloatBE=function(e,t){return t||Sn(e,4,this.length),$t(this,e,!1,23,4)},Zt.prototype.readDoubleLE=function(e,t){return t||Sn(e,8,this.length),$t(this,e,!0,52,8)},Zt.prototype.readDoubleBE=function(e,t){return t||Sn(e,8,this.length),$t(this,e,!1,52,8)},Zt.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||En(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},Zt.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||En(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},Zt.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,1,255,0),Zt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Zt.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,2,65535,0),Zt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):kn(this,e,t,!0),t+2},Zt.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,2,65535,0),Zt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):kn(this,e,t,!1),t+2},Zt.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,4,4294967295,0),Zt.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):An(this,e,t,!0),t+4},Zt.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,4,4294967295,0),Zt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):An(this,e,t,!1),t+4},Zt.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);En(this,e,t,n,a-1,-a)}var o=0,i=1,s=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},Zt.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);En(this,e,t,n,a-1,-a)}var o=n-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i>>0)-s&255;return t+n},Zt.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,1,127,-128),Zt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Zt.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,2,32767,-32768),Zt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):kn(this,e,t,!0),t+2},Zt.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,2,32767,-32768),Zt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):kn(this,e,t,!1),t+2},Zt.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,4,2147483647,-2147483648),Zt.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):An(this,e,t,!0),t+4},Zt.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||En(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Zt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):An(this,e,t,!1),t+4},Zt.prototype.writeFloatLE=function(e,t,n){return On(this,e,t,!0,n)},Zt.prototype.writeFloatBE=function(e,t,n){return On(this,e,t,!1,n)},Zt.prototype.writeDoubleLE=function(e,t,n){return Tn(this,e,t,!0,n)},Zt.prototype.writeDoubleBE=function(e,t,n){return Tn(this,e,t,!1,n)},Zt.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,o=r-n;if(this===e&&n<t&&t<r)for(a=o-1;a>=0;--a)e[a+t]=this[a+n];else if(o<1e3||!Zt.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},Zt.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Zt.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var i=rn(e)?e:In(new Zt(e,r).toString()),s=i.length;for(o=0;o<n-t;++o)this[o+t]=i[o%s]}return this};var Nn=/[^+\/0-9A-Za-z-_]/g;function Rn(e){return e<16?"0"+e.toString(16):e.toString(16)}function In(e,t){var n;t=t||Infinity;for(var r=e.length,a=null,o=[],i=0;i<r;++i){if((n=e.charCodeAt(i))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(t-=3)>-1&&o.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Pn(e){return function(e){var t,n,r,a,o,i;zt||Gt();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=new Ut(3*s/4-(o="="===e[s-2]?2:"="===e[s-1]?1:0)),r=o>0?s-4:s;var l=0;for(t=0,n=0;t<r;t+=4,n+=3)a=Bt[e.charCodeAt(t)]<<18|Bt[e.charCodeAt(t+1)]<<12|Bt[e.charCodeAt(t+2)]<<6|Bt[e.charCodeAt(t+3)],i[l++]=a>>16&255,i[l++]=a>>8&255,i[l++]=255&a;return 2===o?(a=Bt[e.charCodeAt(t)]<<2|Bt[e.charCodeAt(t+1)]>>4,i[l++]=255&a):1===o&&(a=Bt[e.charCodeAt(t)]<<10|Bt[e.charCodeAt(t+1)]<<4|Bt[e.charCodeAt(t+2)]>>2,i[l++]=a>>8&255,i[l++]=255&a),i}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Nn,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Fn(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function Mn(e){return null!=e&&(!!e._isBuffer||jn(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&jn(e.slice(0,0))}(e))}function jn(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}for(var Dn=Math.floor(16777215*Math.random()),Ln=Wn.index=parseInt(16777215*Math.random(),10),qn=(void 0===Lt||"number"!=typeof Lt.pid?Math.floor(1e5*Math.random()):Lt.pid)%65535,Bn=function(){try{return _Buffer}catch(e){try{return Zt}catch(e){return null}}}(),Un=function(e){return!(null==e||!e.constructor||"function"!=typeof e.constructor.isBuffer||!e.constructor.isBuffer(e))},zn=[],Gn=0;Gn<256;Gn++)zn[Gn]=(Gn<=15?"0":"")+Gn.toString(16);var Hn=new RegExp("^[0-9a-fA-F]{24}$"),$n=[];for(Gn=0;Gn<10;)$n[48+Gn]=Gn++;for(;Gn<16;)$n[55+Gn]=$n[87+Gn]=Gn++;function Wn(e){if(!(this instanceof Wn))return new Wn(e);if(e&&(e instanceof Wn||"ObjectID"===e._bsontype))return e;if(this._bsontype="ObjectID",null!=e&&"number"!=typeof e){var t=Wn.isValid(e);if(!t&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(t&&"string"==typeof e&&24===e.length)return Wn.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&"function"==typeof e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e}else this.id=this.generate(e)}var Vn=Wn;Wn.default=Wn,Wn.createFromTime=function(e){return new Wn(function(e,t){return 8===(t=t.toString(16)).length?t:"00000000".substring(t.length,8)+t}(0,e=parseInt(e,10)%4294967295)+"0000000000000000")},Wn.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var t="",n=0;n<24;)t+=String.fromCharCode($n[e.charCodeAt(n++)]<<4|$n[e.charCodeAt(n++)]);return new Wn(t)},Wn.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&Hn.test(e):e instanceof Wn||(Un(e)?Wn.isValid(e.toString("hex")):!("function"!=typeof e.toHexString||!Bn||!(e.id instanceof Bn||"string"==typeof e.id))&&(12===e.id.length||24===e.id.length&&Hn.test(e.id)))))},Wn.prototype={constructor:Wn,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(24===this.id.length)return this.id;if(Un(this.id))return this.id.toString("hex");for(var e="",t=0;t<this.id.length;t++)e+=zn[this.id.charCodeAt(t)];return e},equals:function(e){return e instanceof Wn?this.toString()===e.toString():"string"==typeof e&&Wn.isValid(e)&&12===e.length&&Un(this.id)?e===this.id.toString("binary"):"string"==typeof e&&Wn.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&Wn.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof Wn||e.toHexString))&&e.toHexString()===this.toHexString()},getTimestamp:function(){var e,t=new Date;return e=Un(this.id)?this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,t.setTime(1e3*Math.floor(e)),t},generate:function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3)),e=parseInt(e,10)%4294967295;var t=Ln=(Ln+1)%16777215;return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e,Dn>>16&255,Dn>>8&255,255&Dn,qn>>8&255,255&qn,t>>16&255,t>>8&255,255&t)}};var Jn=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";Wn.prototype[Jn]=function(){return"ObjectID("+this+")"},Wn.prototype.toJSON=Wn.prototype.toHexString,Wn.prototype.toString=Wn.prototype.toHexString,Object.defineProperty(dt,"__esModule",{value:!0}),dt.FeatureChange=void 0,dt.isFeatureChange=function(e){return(0,Kn.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var Yn=Qe.__importDefault(Vn),Kn=nt,Zn=function(e){ne(n,e);var t=ue(n);function n(e,r){var a;return X(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return ee(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=_e(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=de(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=_e((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=de(t.value,2);n.push.apply(n,[a[0]].concat(he(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new Yn.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return V(V({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=V({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,V(V({allIds:[]},t),{},{_id:a})),e.children=new Map(he(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=_e(r);try{for(s.s();!(i=s.n()).done;){var l=de(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(Kn.AssemblySpecificChange);dt.FeatureChange=Zn;var Xn={};Object.defineProperty(Xn,"__esModule",{value:!0}),Xn.operationRegistry=void 0,Xn.operationRegistry=new(function(){function e(){X(this,e),this.operations=new Map}return ee(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var Qn={};Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.Validation=void 0,Qn.isContext=function(e){return"context"in e&&"reflector"in e};var er=function(){function e(){X(this,e)}var t,n,r,a,o;return ee(e,[{key:"frontendPreValidate",value:(o=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Qn.Validation=er,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(et,e),t.__exportStar(nt,e),t.__exportStar(rt,e),t.__exportStar(at,e),t.__exportStar(ut,e),t.__exportStar(ft,e),t.__exportStar(dt,e),t.__exportStar(ot,e),t.__exportStar(Xn,e),t.__exportStar(Qn,e)}(B);var tr={},nr={},rr={},ar={},or={};Object.defineProperty(or,"__esModule",{value:!0}),or.ApolloPlugin=void 0;var ir=function(e){ne(n,e);var t=ue(n);function n(){return X(this,n),t.apply(this,arguments)}return ee(n,[{key:"apolloInstall",value:function(e){}}]),n}(Qe.__importDefault(A.default).default);or.ApolloPlugin=ir;var sr={},lr={},cr={};Object.defineProperty(cr,"__esModule",{value:!0}),cr.changeRegistry=void 0,cr.changeRegistry=new(function(){function e(){X(this,e),this.changes=new Map}return ee(e,[{key:"registerChange",value:function(e,t){if(this.changes.has(e))throw new Error('change type "'.concat(e,'" has already been registered'));this.changes.set(e,t)}},{key:"getChangeType",value:function(e){var t=this.changes.get(e);if(!t)throw new Error('No change constructor registered for "'.concat(e,'"'));return t}}]),e}());var ur={};Object.defineProperty(ur,"__esModule",{value:!0}),ur.Operation=void 0;var fr=function(){function e(t,n){var r;X(this,e),this.logger=null!==(r=null==n?void 0:n.logger)&&void 0!==r?r:console}var t;return ee(e,[{key:"execute",value:(t=Z(J().mark((function e(t){var n,r;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Server"!==(n=t.typeName)){e.next=4;break}return r=this.executeOnServer(t),e.abrupt("return",t.pluginsService.evaluateExtensionPoint("".concat(this.typeName,"-transformResults"),r,{operation:this,backend:t}));case 4:if("LocalGFF3"!==n){e.next=6;break}return e.abrupt("return",this.executeOnLocalGFF3(t));case 6:throw new Error("no operation implementation for backend type '".concat(n,"'"));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();ur.Operation=fr,Object.defineProperty(lr,"__esModule",{value:!0}),lr.Change=void 0,lr.isChange=function(e){return void 0!==e.executeOnClient};var dr=cr,pr=function(e){ne(r,e);var t,n=ue(r);function r(){return X(this,r),n.apply(this,arguments)}return ee(r,[{key:"notification",get:function(){return""}},{key:"execute",value:(t=Z(J().mark((function e(t){var n;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LocalGFF3"!==(n=t.typeName)&&"Server"!==n){e.next=3;break}return e.abrupt("return",fe(re(r.prototype),"execute",this).call(this,t));case 3:if("Client"!==n){e.next=5;break}return e.abrupt("return",this.executeOnClient(t));case 5:throw new Error("no change implementation for backend type '".concat(n,"'"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"fromJSON",value:function(e,t){return new(dr.changeRegistry.getChangeType(e.typeName))(e,(null==t?void 0:t.logger)&&{logger:t.logger})}}]),r}(ur.Operation);lr.Change=pr,Object.defineProperty(sr,"__esModule",{value:!0}),sr.AssemblySpecificChange=void 0,sr.isAssemblySpecificChange=function(e){return(0,hr.isChange)(e)&&void 0!==e.assembly};var hr=lr;sr.AssemblySpecificChange=function(e){ne(n,e);var t=ue(n);function n(e,r){var a;return X(this,n),(a=t.call(this,e,r)).assembly=e.assembly,a}return ee(n)}(hr.Change);var mr={};Object.defineProperty(mr,"__esModule",{value:!0}),mr.Check=void 0,mr.Check=ee((function e(){X(this,e)}));var gr={};Object.defineProperty(gr,"__esModule",{value:!0}),gr.checkRegistry=void 0,gr.checkRegistry=new(function(){function e(){X(this,e),this.checks=new Map}return ee(e,[{key:"registerCheck",value:function(e,t){if(this.checks.has(e))throw new Error('check "'.concat(e,'" has already been registered'));this.checks.set(e,t)}},{key:"getCheck",value:function(e){var t=this.checks.get(e);if(!t)throw new Error('No check constructor registered for "'.concat(e,'"'));return t}},{key:"getChecks",value:function(){return this.checks}}]),e}());var yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.FeatureChange=void 0,yr.isFeatureChange=function(e){return(0,br.isAssemblySpecificChange)(e)&&void 0!==e.changedIds};var vr=Qe.__importDefault(Vn),br=sr,_r=function(e){ne(n,e);var t=ue(n);function n(e,r){var a;return X(this,n),(a=t.call(this,e,r)).changedIds=e.changedIds,a}return ee(n,[{key:"getFeatureFromId",value:function(e,t){var n,r,a,o,i=this.logger;if(null===(n=i.verbose)||void 0===n||n.call(i,"Entry=".concat(JSON.stringify(e))),e._id.equals(t))return null===(r=i.debug)||void 0===r||r.call(i,"Top level featureId matches in the object ".concat(JSON.stringify(e))),e;null===(a=i.debug)||void 0===a||a.call(i,"FeatureId was not found on top level so lets make recursive call...");var s,l=_e(null!==(o=e.children)&&void 0!==o?o:new Map);try{for(l.s();!(s=l.n()).done;){var c=de(s.value,2),u=this.getFeatureFromId(c[1],t);if(u)return u}}catch(e){l.e(e)}finally{l.f()}return null}},{key:"getChildFeatureIds",value:function(e){if(!e.children)return[];var t,n=[],r=_e((e.children instanceof Map?e.children:new Map(Object.entries(e.children)))||new Map);try{for(r.s();!(t=r.n()).done;){var a=de(t.value,2);n.push.apply(n,[a[0]].concat(he(this.getChildFeatureIds(a[1]))))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"generateNewIds",value:function(e,t){var n=(new vr.default).toHexString();t.push(n);var r={};if(e.children)for(var a=0,o=Object.values(e.children);a<o.length;a++){var i=this.generateNewIds(o[a],t);r[i._id]=i}var s="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return V(V({},e),{},{refSeq:s,children:e.children&&r,_id:n})}},{key:"addChild",value:function(e,t){var n;if(!(null===(n=e.attributes)||void 0===n?void 0:n._id)){var r=e.attributes;r||(r={}),r=V({_id:[e._id.toString()]},JSON.parse(JSON.stringify(r))),e.attributes=r}var a=t._id;e.children||(e.children=new Map),e.children.set(a,V(V({allIds:[]},t),{},{_id:a})),e.children=new Map(he(e.children.entries()).sort((function(e,t){return e[1].min-t[1].min})))}},{key:"findAndDeleteChildFeature",value:function(e,t){if(!e.children)throw new Error("Feature ".concat(e._id.toHexString()," has no children"));var n=e._id,r=e.children,a=r.get(t);if(a){var o=this.getChildFeatureIds(a);return r.delete(t),o}var i,s=_e(r);try{for(s.s();!(i=s.n()).done;){var l=de(i.value,2)[1];try{return this.findAndDeleteChildFeature(l,t)}catch(e){}}}catch(e){s.e(e)}finally{s.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(n.toHexString()))}}]),n}(br.AssemblySpecificChange);yr.FeatureChange=_r;var wr={};Object.defineProperty(wr,"__esModule",{value:!0}),wr.operationRegistry=void 0,wr.operationRegistry=new(function(){function e(){X(this,e),this.operations=new Map}return ee(e,[{key:"registerOperation",value:function(e,t){if(this.operations.has(e))throw new Error('operation type "'.concat(e,'" has already been registered'));this.operations.set(e,t)}},{key:"getOperationType",value:function(e){var t=this.operations.get(e);if(!t)throw new Error('No operation constructor registered for "'.concat(e,'"'));return t}}]),e}());var xr={};Object.defineProperty(xr,"__esModule",{value:!0}),xr.Validation=void 0,xr.isContext=function(e){return"context"in e&&"reflector"in e};var Sr=function(){function e(){X(this,e)}var t,n,r,a,o;return ee(e,[{key:"frontendPreValidate",value:(o=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();xr.Validation=Sr,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(or,e),t.__exportStar(sr,e),t.__exportStar(lr,e),t.__exportStar(cr,e),t.__exportStar(mr,e),t.__exportStar(gr,e),t.__exportStar(yr,e),t.__exportStar(ur,e),t.__exportStar(wr,e),t.__exportStar(xr,e)}(ar),Object.defineProperty(rr,"__esModule",{value:!0}),rr.AddAssemblyAliasesChange=void 0;var Er=C.default,kr=function(e){ne(r,e);var t,n=ue(r);function r(e,t){var a;return X(this,r),te(ce(a=n.call(this,e,t)),"typeName","AddAssemblyAliasesChange"),te(ce(a),"aliases",void 0),a.aliases=e.aliases,a}return ee(r,[{key:"executeOnClient",value:function(e){var t=(0,Er.getSession)(e).assemblyManager.get(this.assembly);if(!t)throw new Error("assembly ".concat(this.assembly," not found"));return t.configuration.aliases.set(this.aliases),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,aliases:this.aliases}}},{key:"executeOnServer",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=this.assembly,i=this.aliases,null===(n=(o=this.logger).debug)||void 0===n||n.call(o,"Updating assembly aliases for assembly: ".concat(a,", aliases: ").concat(JSON.stringify(i))),e.next=5,r.findById(a);case 5:if(s=e.sent){e.next=8;break}throw new Error("Assembly with ID ".concat(a," not found"));case 8:return s.aliases=i,e.next=11,s.save();case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"Assembly aliases have been added."}}]),r}(ar.AssemblySpecificChange);rr.AddAssemblyAliasesChange=kr;var Ar={},Cr={},Or={},Tr={};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.annotationFeatureToGFF3=Rr;var Nr=C.default;function Rr(e,t,n){var r,a,o,i,s=JSON.parse(JSON.stringify(null!==(r=e.attributes)&&void 0!==r?r:{})),l=[],c=null!==(a=null===(o=e.attributes)||void 0===o||null===(o=o.gff_source)||void 0===o?void 0:o[0])&&void 0!==a?a:null;delete s.gff_source,t&&(s.Parent=[t]),s.gff_id?(s.ID=s.gff_id,delete s.gff_id):e.children&&(s.ID=[e._id]),s.gff_name&&(s.Name=s.gff_name,delete s.gff_name),s.gff_alias&&(s.Alias=s.gff_alias,delete s.gff_alias),s.gff_target&&(s.Target=s.gff_target,delete s.gff_target),s.gff_gap&&(s.Gap=s.gff_gap,delete s.gff_gap),s.gff_derives_from&&(s.Derives_from=s.gff_derives_from,delete s.gff_derives_from),s.gff_note&&(s.Note=s.gff_note,delete s.gff_note),s.gff_dbxref&&(s.Dbxref=s.gff_dbxref,delete s.gff_dbxref),s.gff_is_circular&&(s.Is_circular=s.gff_is_circular,delete s.gff_is_circular),s.gff_ontology_term&&(l.push.apply(l,he(s.gff_ontology_term)),delete s.gff_ontology_term),s["Gene Ontology"]&&(l.push.apply(l,he(s["Gene Ontology"])),delete s["Gene Ontology"]),s["Sequence Ontology"]&&(l.push.apply(l,he(s["Sequence Ontology"])),delete s["Sequence Ontology"]),l.length>0&&(s.Ontology_term=l);var u=null===(i=e.attributes)||void 0===i?void 0:i.gff_score,f=null;return u&&u.length>0&&(u[0]&&(f=Number(u[0]),Number.isNaN(f)&&(f=null)),delete s.gff_score),[{start:e.min,end:e.max}].map((function(t){var r,a;return{start:Number(t.start)+1,end:Number(t.end),seq_id:n?null!==(r=n[e.refSeq])&&void 0!==r?r:null:e.refSeq,source:c,type:e.type,score:f,strand:e.strand?1===e.strand?"+":"-":null,phase:null,attributes:Object.keys(s).length>0?s:null,derived_features:[],child_features:Ir(e,null===(a=s.ID)||void 0===a?void 0:a[0],n)}}))}function Ir(e,t,n){if(!e.children)return[];if("mRNA"===e.type){for(var r=[],a=function(e){var t=[];try{t=function(e){if("mRNA"!==e.type)throw new Error('Only features of type "mRNA" or equivalent can calculate CDS locations');if(!e.children)throw new Error("no CDS or exons in mRNA");var t=Object.values(e.children),n=t.filter((function(e){return"CDS"===e.type}));if(0===n.length)throw new Error("no CDS in mRNA");var r,a=[],o=_e(n);try{var i=function(){for(var n=r.value,o=n.max,i=n.min,s=[],l=!1,c=[],u=0,f=t;u<f.length;u++){var d=f[u];"exon"===d.type&&c.push({min:d.min,max:d.max})}c.sort((function(e,t){return e.min-t.min}));for(var p=0,h=c;p<h.length;p++){var m=h[p],g=s.at(-1);g&&s.push({min:g.max,max:m.min,type:"intron"});var y,v=de((0,Nr.intersection2)(i,o,m.min,m.max),2),b=v[0],_=v[1];y=l?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==b&&void 0!==_?(l=!0,b===m.min&&_===m.max?s.push({min:b,max:_,phase:0,type:"CDS"}):b===m.min?s.push({min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:y}):_===m.max?s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"}):s.push({min:m.min,max:b,type:y},{min:b,max:_,phase:0,type:"CDS"},{min:_,max:m.max,type:"fivePrimeUTR"===y?"threePrimeUTR":"fivePrimeUTR"})):s.push({min:m.min,max:m.max,type:y})}s.sort((function(e,t){return e.min-t.min})),-1===e.strand&&s.reverse();var w=0,x=s.map((function(e){if("CDS"!==e.type)return e;var t=w;return w=(3-(e.max-e.min-t+3)%3)%3,V(V({},e),{},{phase:t})}));a.push(x)};for(o.s();!(r=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return a}(e)}catch(e){return[]}return t.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))}(e),o=0,i=0,s=Object.values(e.children);i<s.length;i++){var l=s[i],c=Rr(l,t,n);if("CDS"===l.type){var u,f=_e(a[o]);try{for(f.s();!(u=f.n()).done;){var d=u.value,p=JSON.parse(JSON.stringify(c));if(1!=p.length)throw new Error("Unexpected CDS: ".concat(JSON.stringify(p,null,2)));p[0].start=d.min+1,p[0].end=d.max,p[0].phase=d.phase.toString(),p[0].type=d.type,r.push(p)}}catch(e){f.e(e)}finally{f.f()}o++}else r.push(c)}return r}return Object.values(e.children).map((function(e){return Rr(e,t,n)}))}var Pr={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.gffInternalToColumn=e.gffColumnToInternal=e.internalToGFF=e.gffToInternal=void 0,e.isGFFReservedAttribute=function(t){return t in e.gffToInternal},e.isGFFInternalAttribute=function(t){return t in e.internalToGFF},e.isGFFColumn=function(t){return t in e.gffColumnToInternal},e.isGFFColumnInternal=function(t){return t in e.gffInternalToColumn},e.gffToInternal={ID:"gff_id",Name:"gff_name",Alias:"gff_alias",Parent:"gff_parent",Target:"gff_target",Gap:"gff_gap",Derives_from:"gff_derives_from",Note:"gff_note",Dbxref:"gff_dbxref",Ontology_term:"gff_ontology_term",Is_circular:"gff_is_circular"},e.internalToGFF={gff_id:"ID",gff_name:"Name",gff_alias:"Alias",gff_parent:"Parent",gff_target:"Target",gff_gap:"Gap",gff_derives_from:"Derives_from",gff_note:"Note",gff_dbxref:"Dbxref",gff_ontology_term:"Ontology_term",gff_is_circular:"Is_circular"},e.gffColumnToInternal={score:"gff_score",source:"gff_source"},e.gffInternalToColumn={gff_score:"score",gff_source:"source"}}(Pr);var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.gff3ToAnnotationFeature=function e(t,n,r){var a=de(t,1)[0],o=a.end,i=a.seq_id,s=a.start,l=a.strand,c=a.type;if(!i)throw new Error("feature does not have seq_id: ".concat(JSON.stringify(a)));if(!c)throw new Error("feature does not have type: ".concat(JSON.stringify(a)));if(null===s)throw new Error("feature does not have start: ".concat(JSON.stringify(a)));if(null===o)throw new Error("feature does not have end: ".concat(JSON.stringify(a)));var u=de(function(e){if(e.length>1&&!e.every((function(e){return"CDS"===e.type})))throw new Error("GFF3 features has multiple locations but is not a CDS");var t=e.map((function(e){return e.start})).filter((function(e){return null!==e})),n=e.map((function(e){return e.end})).filter((function(e){return null!==e}));return[Math.min.apply(Math,he(t))-1,Math.max.apply(Math,he(n))]}(t),2),f=u[0],d=u[1],p=function(t,n,r){var a={},o=t.filter((function(e){return e.child_features.length>0}));if(o.length>1)throw new Error("Features with multiple locations may not have children");if(0!==o.length){var i,s=[],l=[],c=[],u=_e(de(o,1)[0].child_features);try{for(u.s();!(i=u.n()).done;){var f=i.value,d=de(f,1)[0];if("exon"===d.type&&l.push(f),"three_prime_UTR"!==d.type&&"five_prime_UTR"!==d.type||c.push(f),"three_prime_UTR"!==d.type&&"five_prime_UTR"!==d.type&&"intron"!==d.type&&"start_codon"!==d.type&&"stop_codon"!==d.type)if("CDS"===d.type)s.push(f);else{var p=e(f,n,r);a[p._id]=p}}}catch(e){u.e(e)}finally{u.f()}if(s.length>0){var h,m=function(t,n,r){var a=t.map((function(e){return e.length}));if(a.some((function(e){return e>1})))return t.map((function(t){return e(t,n,r)}));var o=t.map((function(e){return e[0]})).filter((function(e){return null!==e.start&&null!==e.end})).sort((function(e,t){return e.start-t.start}));if(!o.some((function(e,t){var n=o.at(t+1);return!!n&&(0,Mr.doesIntersect2)(e.start,e.end,n.start,n.end)})))return[e(o,n,r)];var i,s=t.map((function(e){return e[0]})),l=[],c=_e(s);try{var u=function(){var e=i.value,t=l.at(-1);if(!t)return l.push([e]),1;t.some((function(t){return(0,Mr.doesIntersect2)(t.start,t.end,e.start,e.end)}))?l.push([e]):t.push(e)};for(c.s();!(i=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}return l.map((function(t){return e(t,n,r)}))}(s,n,r),g=_e(m);try{for(g.s();!(h=g.n()).done;){var y=h.value;a[y._id]=y}}catch(e){g.e(e)}finally{g.f()}var v,b=function(e,t,n,r,a){var o,i=[],s=_e(n);try{for(s.s();!(o=s.n()).done;){var l,c=_e(o.value);try{for(c.s();!(l=c.n()).done;){var u=l.value;if(!u.start||!u.end)throw new Error("UTR has undefined start and/or end\n: ".concat(JSON.stringify(u,null,2)));var f=void 0;"+"===u.strand?f=1:"-"===u.strand&&(f=-1),i.push({_id:(new jr.default).toHexString(),refSeq:r,type:"exon",min:u.start-1,max:u.end,strand:f})}}catch(e){c.e(e)}finally{c.f()}}}catch(e){s.e(e)}finally{s.f()}i.sort((function(e,t){return e.min-t.min}));var d,p=[],h=_e(e);try{for(h.s();!(d=h.n()).done;){var m=d.value;m.sort((function(e,t){if(!e.start||!t.start)throw new Error("CDS has undefined start");return e.start-t.start}));for(var g=0;g<m.length;g++){var y,v=m[g],b=!1,_=_e(t);try{for(_.s();!(y=_.n()).done;){var w=y.value;if(1!=w.length)throw new Error("Unexpected number of exons");var x=de(w,1)[0];if(x.start&&x.end&&v.start&&v.end&&x.start<=v.start&&x.end>=v.end){b=!0;break}}}catch(e){_.e(e)}finally{_.f()}if(!b){if(!v.start||!v.end)throw new Error("CDS has undefined start and/or end: ".concat(JSON.stringify(v,null,2)));var S=void 0;"+"===v.strand?S=1:"-"===v.strand&&(S=-1);var E={_id:(new jr.default).toHexString(),refSeq:r,type:"exon",min:v.start-1,max:v.end,strand:S};if(0===g){var k,A=_e(i);try{for(A.s();!(k=A.n()).done;){var C=k.value;if(C.max>E.min)break;C.max===E.min?E.min=C.min:p.push(C)}}catch(e){A.e(e)}finally{A.f()}}if(g===m.length-1){var O,T=_e(i);try{for(T.s();!(O=T.n()).done;){var N=O.value;N.min<E.max||(N.min===E.max?E.max=N.max:p.push(N))}}catch(e){T.e(e)}finally{T.f()}}p.push(E)}}}}catch(e){h.e(e)}finally{h.f()}var R=function(e){if(0===e.length)return[];e.sort((function(e,t){return e.min-t.min}));var t=[];t.push(e[0]);for(var n=1;n<e.length;n++){var r=t.at(-1),a=e[n];r&&a.min<=r.max?r.max=Math.max(r.max,a.max):t.push(a)}return t}(p);if(a){var I,P=_e(R);try{for(P.s();!(I=P.n()).done;){var F=I.value;a.includes(F._id)||a.push(F._id)}}catch(e){P.e(e)}finally{P.f()}}return R}(s,l,c,m[0].refSeq,r),_=_e(b);try{for(_.s();!(v=_.n()).done;){var w=v.value;a[w._id]=w}}catch(e){_.e(e)}finally{_.f()}}return Object.keys(a).length>0?a:void 0}}(t,n,r),h=function(e){var t={},n=e.map((function(e){return e.score})).filter((function(e){return null!==e})),r=e.map((function(e){return e.source})).filter((function(e){return null!==e})),a=e.map((function(e){return e.attributes})).filter((function(e){return null!==e}));if(n.length>0){var o=de(n,1)[0];n.length>1&&(o=n.reduce((function(e,t){return e+t}),0)/n.length),t.gff_score=[String(o)]}if(r.length>0){var i=de(r,1)[0];r.length>1&&(i=he(new Set(r)).join(",")),t.gff_source=[i]}if(a.length>0){var s,l=_e(a);try{for(l.s();!(s=l.n()).done;)for(var c=0,u=Object.entries(s.value);c<u.length;c++){var f=de(u[c],2),d=f[0],p=f[1];if(p&&"Parent"!==d){var h=(0,Dr.isGFFReservedAttribute)(d)?Dr.gffToInternal[d]:d,m=t[h];if(m){var g=new Set([].concat(he(m),he(p)));t[h]=he(g)}else t[h]=p}}}catch(e){l.e(e)}finally{l.f()}}if(Object.keys(t).length>0)return t}(t),m={_id:(new jr.default).toHexString(),refSeq:null!=n?n:i,type:c,min:f,max:d};if(l)if("+"===l)m.strand=1;else{if("-"!==l)throw new Error('Unknown strand: "'.concat(l,'"'));m.strand=-1}return p&&(m.children=p),h&&(m.attributes=h),r&&r.push(m._id),m};var Mr=C.default,jr=Qe.__importDefault(Vn),Dr=Pr;!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(Tr,e),t.__exportStar(Pr,e),t.__exportStar(Fr,e)}(Or),Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.FromFileBaseChange=void 0;var Lr=Or,qr=function(e){ne(o,e);var t,n,r,a=ue(o);function o(){var e;X(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return te(ce(e=a.call.apply(a,[this].concat(n))),"refSeqCache",new Map),e}return ee(o,[{key:"addRefSeqIntoDb",value:(r=Z(J().mark((function e(t,n,r){var a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O,T,N,R,I,P,F,M,j,D,L,q,B,U,z,H,$,W,Y,K,Z,X;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.logger,i=r.filesService,s=r.refSeqChunkModel,l=r.refSeqModel,c=r.user,f=(u=Lt.env.CHUNK_SIZE)&&Number(u),d=0,p=0,m="text/x-gff3"!==t.type,g=i.getFileStream(t),y="",v="",b=!0,_=!1,null===(a=o.debug)||void 0===a||a.call(o,"starting sequence stream"),w=0,x=!1,S=!1,e.prev=16,k=G(g);case 18:return e.next=20,k.next();case 20:if(!(x=!(A=e.sent).done)){e.next=102;break}C=A.value.toString(),b=!C.endsWith("\n"),O=C.split(/\r?\n/),v&&(O[0]="".concat(v).concat(O[0]),v=""),b&&(v=O.pop()||""),T=!1,N=!1,e.prev=29,I=G(O);case 31:return e.next=33,I.next();case 33:if(!(T=!(P=e.sent).done)){e.next=83;break}if(F=P.value,++w%1e6==0&&(null===(M=o.debug)||void 0===M||M.call(o,"Processed ".concat(w," lines"))),m){e.next=40;break}return"##FASTA"===F.trim()&&(m=!0),e.abrupt("continue",80);case 40:if(!(j=/^>\s*(\S+)\s*(.*)/.exec(F))){e.next=66;break}if(_=!0,null===(D=o.debug)||void 0===D||D.call(o,'Reference sequence information line "'.concat(j[0],'"')),""===y){e.next=51;break}if(h){e.next=47;break}throw new Error("No refSeq document found");case 47:return p+=y.length,e.next=50,s.create([{refSeq:h._id,n:d,sequence:y,user:c,status:-1}]);case 50:y="";case 51:return e.next=53,null===(L=h)||void 0===L?void 0:L.updateOne({length:p});case 53:return p=0,d=0,B=j[1].trim(),U=j[2]?j[2].trim():"",e.next=59,l.create([V(V({name:B,description:U,assembly:n,length:0},f?{chunkSize:f}:null),{},{user:c,status:-1})]);case 59:z=de(e.sent,1),H=z[0],null===(q=o.debug)||void 0===q||q.call(o,'Added new refSeq "'.concat(B,'", desc "').concat(U,'", docId "').concat(H._id,'"')),h=H,e.next=80;break;case 66:if(!/\S/.test(F)){e.next=80;break}if(h){e.next=69;break}throw new Error("No refSeq document found");case 69:W=($=h)._id,Y=$.chunkSize,y+=F.replaceAll(/\s/g,"");case 71:if(!(y.length>=Y)){e.next=80;break}return K=y.slice(0,Y),p+=K.length,e.next=76,s.create([{refSeq:W,n:d,sequence:K,user:c,status:-1}]);case 76:d++,y=y.slice(Y),e.next=71;break;case 80:T=!1,e.next=31;break;case 83:e.next=89;break;case 85:e.prev=85,e.t0=e.catch(29),N=!0,R=e.t0;case 89:if(e.prev=89,e.prev=90,!T||null==I.return){e.next=94;break}return e.next=94,I.return();case 94:if(e.prev=94,!N){e.next=97;break}throw R;case 97:return e.finish(94);case 98:return e.finish(89);case 99:x=!1,e.next=18;break;case 102:e.next=108;break;case 104:e.prev=104,e.t1=e.catch(16),S=!0,E=e.t1;case 108:if(e.prev=108,e.prev=109,!x||null==k.return){e.next=113;break}return e.next=113,k.return();case 113:if(e.prev=113,!S){e.next=116;break}throw E;case 116:return e.finish(113);case 117:return e.finish(108);case 118:if(_){e.next=120;break}throw new Error("No reference sequences found in file");case 120:if(!y&&!b){e.next=131;break}if(h){e.next=123;break}throw new Error("No refSeq document found");case 123:return b&&(y+=v),p+=y.length,null===(Z=o.verbose)||void 0===Z||Z.call(o,'*** Add the very last chunk to ref seq ("'.concat(h._id,'", index ').concat(d," and total length for ref seq is ").concat(p,'): "').concat(y,'"')),null===(X=o.debug)||void 0===X||X.call(o,"Creating refSeq chunk number ".concat(d,' of "').concat(h._id,'"')),e.next=129,s.create([{refSeq:h._id,n:d,sequence:y,user:c,status:-1}]);case 129:return e.next=131,h.updateOne({length:p});case 131:case"end":return e.stop()}}),e,this,[[16,104,108,118],[29,85,89,99],[90,,94,98],[109,,113,117]])}))),function(e,t,n){return r.apply(this,arguments)})},{key:"removeExistingFeatures",value:(n=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.featureModel,a=t.refSeqModel,o=this.assembly,null===(n=(i=this.logger).debug)||void 0===n||n.call(i,"Removing existing features for assembly = ".concat(o)),e.next=5,a.find({assembly:o}).exec();case 5:s=_e(e.sent),e.prev=7,s.s();case 9:if((l=s.n()).done){e.next=15;break}return c=l.value,e.next=13,r.deleteMany({refSeq:c._id});case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s.e(e.t0);case 20:return e.prev=20,s.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[7,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"addFeatureIntoDb",value:(t=Z(J().mark((function e(t,n){var r,a,o,i,s,l,c,u,f,d,p;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.featureModel,a=n.refSeqModel,o=n.user,i=this.assembly,s=this.refSeqCache,l=de(t,1),c=l[0].seq_id){e.next=5;break}throw new Error("Valid seq_id not found in feature ".concat(JSON.stringify(t)));case 5:if(u=s.get(c)){e.next=20;break}return e.next=9,a.findOne({assembly:i,name:c}).exec();case 9:if(e.t1=f=e.sent,e.t0=null!==e.t1,!e.t0){e.next=13;break}e.t0=void 0!==f;case 13:if(!e.t0){e.next=17;break}e.t2=f,e.next=18;break;case 17:e.t2=void 0;case 18:(u=e.t2)&&s.set(c,u);case 20:if(u){e.next=22;break}throw new Error('RefSeq was not found by assembly "'.concat(i,'" and seq_id "').concat(c,'" not found'));case 22:return p=(0,Lr.gff3ToAnnotationFeature)(t,u._id,d=[]),e.next=26,r.create([V(V({allIds:d},p),{},{user:o,status:-1})]);case 26:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),o}(ar.AssemblySpecificChange);Cr.FromFileBaseChange=qr,Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.AddAssemblyAndFeaturesFromFileChange=void 0;var Br=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","AddAssemblyAndFeaturesFromFileChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=de(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O,T;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.fileModel,o=t.filesService,i=t.user,s=this.assembly,l=this.logger,c=_e(this.changes),e.prev=3,c.s();case 5:if((u=c.n()).done){e.next=71;break}if(g=(m=u.value).assemblyName,y=m.fileIds.fa,Lt.env.FILE_UPLOAD_FOLDER){e.next=12;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 12:return e.next=14,a.findById(y).exec();case 14:if(v=e.sent){e.next=17;break}throw new Error('File "'.concat(y,'" not found in Mongo'));case 17:return null===(f=l.debug)||void 0===f||f.call(l,'FileId "'.concat(y,'", checksum "').concat(v.checksum,'"')),e.next=20,n.findOne({name:g}).exec();case 20:if(!e.sent){e.next=23;break}throw new Error('Assembly "'.concat(g,'" already exists'));case 23:return e.next=25,r.find({default:!0}).exec();case 25:return b=e.sent.map((function(e){return e._id.toHexString()})),e.next=29,n.create([{_id:s,name:g,user:i,status:-1,fileId:y,checks:b}]);case 29:return _=de(e.sent,1),w=_[0],null===(d=l.debug)||void 0===d||d.call(l,'Added new assembly "'.concat(g,'", docId "').concat(w._id.toHexString(),'"')),null===(p=l.debug)||void 0===p||p.call(l,'File type: "'.concat(v.type,'"')),e.next=36,this.addRefSeqIntoDb(v,w._id.toString(),t);case 36:null===(h=l.debug)||void 0===h||h.call(l,'**************** LOOPATAAN KAIKKI FEATURET SEURAAVAKSI File type: "'.concat(v.type,'"')),x=o.parseGFF3(o.getFileStream(v)),S=!1,E=!1,e.prev=40,A=G(x);case 42:return e.next=44,A.next();case 44:if(!(S=!(C=e.sent).done)){e.next=53;break}return T=C.value,null===(O=l.verbose)||void 0===O||O.call(l,"ENTRY=".concat(JSON.stringify(T))),e.next=50,this.addFeatureIntoDb(T,t);case 50:S=!1,e.next=42;break;case 53:e.next=59;break;case 55:e.prev=55,e.t0=e.catch(40),E=!0,k=e.t0;case 59:if(e.prev=59,e.prev=60,!S||null==A.return){e.next=64;break}return e.next=64,A.return();case 64:if(e.prev=64,!E){e.next=67;break}throw k;case 67:return e.finish(64);case 68:return e.finish(59);case 69:e.next=5;break;case 71:e.next=76;break;case 73:e.prev=73,e.t1=e.catch(3),c.e(e.t1);case 76:return e.prev=76,c.f(),e.finish(76);case 79:case"end":return e.stop()}}),e,this,[[3,73,76,79],[40,55,59,69],[60,,64,68]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(Cr.FromFileBaseChange);Ar.AddAssemblyAndFeaturesFromFileChange=Br;var Ur={},zr={},Gr=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};X(this,e),this.baseOverrides={},this.url=t;var r=n.fetch||globalThis.fetch.bind(globalThis);if(!r)throw new TypeError("no fetch function supplied, and none found in global environment");n.overrides&&(this.baseOverrides=n.overrides),this.fetchImplementation=r}var t,n,r,a,o,i;return ee(e,[{key:"getBufferFromResponse",value:(i=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.buffer){e.next=4;break}return e.abrupt("return",t.buffer());case 4:if("function"!=typeof t.arrayBuffer){e.next=11;break}return e.next=7,t.arrayBuffer();case 7:return e.abrupt("return",Zt.from(e.sent));case 11:throw new TypeError("invalid HTTP response object, has no buffer method, and no arrayBuffer method");case 12:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"fetch",value:(o=Z(J().mark((function e(t,n){var r;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchImplementation(t,n);case 3:case 12:r=e.sent,e.next=16;break;case 6:if(e.prev=6,e.t0=e.catch(0),!"".concat(e.t0).includes("Failed to fetch")){e.next=15;break}return console.warn("generic-filehandle: refetching ".concat(t," to attempt to work around chrome CORS header caching bug")),e.next=12,this.fetchImplementation(t,V(V({},n),{},{cache:"reload"}));case 15:throw e.t0;case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e,t){return o.apply(this,arguments)})},{key:"read",value:(a=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:0,a=y.length>3&&void 0!==y[3]?y[3]:0,s=void 0===(i=(o=y.length>4&&void 0!==y[4]?y[4]:{}).headers)?{}:i,l=o.signal,u=void 0===(c=o.overrides)?{}:c,(r=y.length>2?y[2]:void 0)<Infinity?s.range="bytes=".concat(a,"-").concat(a+r):Infinity===r&&0!==a&&(s.range="bytes=".concat(a,"-")),f=V(V(V({},this.baseOverrides),u),{},{headers:V(V(V({},s),u.headers),this.baseOverrides.headers),method:"GET",redirect:"follow",mode:"cors",signal:l}),e.next=9,this.fetch(this.url,f);case 9:if((d=e.sent).ok){e.next=12;break}throw new Error("HTTP ".concat(d.status," ").concat(d.statusText," ").concat(this.url));case 12:if((200!==d.status||0!==a)&&206!==d.status){e.next=21;break}return e.next=15,this.getBufferFromResponse(d);case 15:return h=(p=e.sent).copy(t,n,0,Math.min(r,p.length)),m=d.headers.get("content-range"),(g=/\/(\d+)$/.exec(m||""))&&g[1]&&(this._stat={size:parseInt(g[1],10)}),e.abrupt("return",{bytesRead:h,buffer:t});case 21:if(200!==d.status){e.next=23;break}throw new Error("${this.url} fetch returned status 200, expected 206");case 23:throw new Error("HTTP ".concat(d.status," fetching ").concat(this.url));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Z(J().mark((function e(){var t,n,r,a,o,i,s,l,c,u=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof(t=u.length>0&&void 0!==u[0]?u[0]:{})?(n=t,r={}):(n=t.encoding,delete(r=t).encoding),s=void 0===(i=(a=r).overrides)?{}:i,l=V(V({headers:void 0===(o=a.headers)?{}:o,method:"GET",redirect:"follow",mode:"cors",signal:a.signal},this.baseOverrides),s),e.next=6,this.fetch(this.url,l);case 6:if(c=e.sent){e.next=9;break}throw new Error("generic-filehandle failed to fetch");case 9:if(200===c.status){e.next=11;break}throw Object.assign(new Error("HTTP ".concat(c.status," fetching ").concat(this.url)),{status:c.status});case 11:if("utf8"!==n){e.next=13;break}return e.abrupt("return",c.text());case 13:if(!n){e.next=15;break}throw new Error("unsupported encoding: ".concat(n));case 15:return e.abrupt("return",this.getBufferFromResponse(c));case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stat",value:(n=Z(J().mark((function e(){var t;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._stat){e.next=6;break}return t=Zt.allocUnsafe(10),e.next=4,this.read(t,0,10,0);case 4:if(this._stat){e.next=6;break}throw new Error("unable to determine size of file at ".concat(this.url));case 6:return e.abrupt("return",this._stat);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Z(J().mark((function e(){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function Hr(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"!=typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsArrayBuffer(e)}))}function $r(e){var t=new FileReader;return new Promise((function(n,r){t.onerror=function(){t.abort(),r(new Error("problem reading blob"))},t.onabort=function(){r(new Error("blob reading was aborted"))},t.onload=function(){t.result&&"string"==typeof t.result?n(t.result):r(new Error("unknown error reading blob"))},t.readAsText(e)}))}var Wr=function(){function e(t){X(this,e),this.blob=t,this.size=t.size}var t,n,r,a;return ee(e,[{key:"read",value:(a=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:0,a=c.length>3&&void 0!==c[3]?c[3]:0,r=c.length>2?c[2]:void 0){e.next=5;break}return e.abrupt("return",{bytesRead:0,buffer:t});case 5:return i=(o=a)+r,e.next=9,Hr(this.blob.slice(o,i));case 9:return s=Zt.from(e.sent),l=s.copy(t,n),e.abrupt("return",{bytesRead:l,buffer:s});case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"readFile",value:(r=Z(J().mark((function e(t){var n;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("utf8"!==(n="string"==typeof t?t:t&&t.encoding)){e.next=3;break}return e.abrupt("return",$r(this.blob));case 3:if(!n){e.next=5;break}throw new Error("unsupported encoding: ".concat(n));case 5:return e.next=7,Hr(this.blob);case 7:return e.abrupt("return",Zt.from(e.sent));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stat",value:(n=Z(J().mark((function e(){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{size:this.size});case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Z(J().mark((function e(){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();function Vr(e){return new Gr(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}var Jr={__proto__:null,open:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(void 0!==n)return n;if(void 0!==e)return Vr(e,r);if(void 0!==t)return new zr(t,r);throw new Error("no url, path, or filehandle provided, cannot open")},fromUrl:Vr,RemoteFile:Gr,LocalFile:zr,BlobFile:Wr},Yr={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==Y(r))throw new TypeError(r+"must be non-object");for(var a in r)n(r,a)&&(e[a]=r[a])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,r,a){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),a);else for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){var t,n,r,a,o,i;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(i=new Uint8Array(r),a=0,t=0,n=e.length;t<n;t++)i.set(o=e[t],a),a+=o.length;return i}},a={arraySet:function(e,t,n,r,a){for(var o=0;o<r;o++)e[a+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(t)}(Yr);var Kr={},Zr={},Xr={},Qr=Yr;function ea(e){for(var t=e.length;--t>=0;)e[t]=0}var ta=15,na=16,ra=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],aa=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],oa=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ia=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],sa=new Array(576);ea(sa);var la=new Array(60);ea(la);var ca=new Array(512);ea(ca);var ua=new Array(256);ea(ua);var fa=new Array(29);ea(fa);var da,pa,ha,ma=new Array(30);function ga(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}function ya(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function va(e){return e<256?ca[e]:ca[256+(e>>>7)]}function ba(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function _a(e,t,n){e.bi_valid>na-n?(e.bi_buf|=t<<e.bi_valid&65535,ba(e,e.bi_buf),e.bi_buf=t>>na-e.bi_valid,e.bi_valid+=n-na):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function wa(e,t,n){_a(e,n[2*t],n[2*t+1])}function xa(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Sa(e,t,n){var r,a,o=new Array(ta+1),i=0;for(r=1;r<=ta;r++)o[r]=i=i+n[r-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=xa(o[s]++,s))}}function Ea(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function ka(e){e.bi_valid>8?ba(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function Aa(e,t,n,r){var a=2*t,o=2*n;return e[a]<e[o]||e[a]===e[o]&&r[t]<=r[n]}function Ca(e,t,n){for(var r=e.heap[n],a=n<<1;a<=e.heap_len&&(a<e.heap_len&&Aa(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!Aa(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r}function Oa(e,t,n){var r,a,o,i,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],a=e.pending_buf[e.l_buf+s],s++,0===r?wa(e,a,t):(wa(e,(o=ua[a])+256+1,t),0!==(i=ra[o])&&_a(e,a-=fa[o],i),wa(e,o=va(--r),n),0!==(i=aa[o])&&_a(e,r-=ma[o],i))}while(s<e.last_lit);wa(e,256,t)}function Ta(e,t){var n,r,a,o=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(a=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[a]=0,e.opt_len--,s&&(e.static_len-=i[2*a+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)Ca(e,o,n);a=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ca(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,o[2*a]=o[2*n]+o[2*r],e.depth[a]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,o[2*n+1]=o[2*r+1]=a,e.heap[1]=a++,Ca(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,a,o,i,s,l=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,f=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,h=t.stat_desc.max_length,m=0;for(o=0;o<=ta;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(o=l[2*l[2*(r=e.heap[n])+1]+1]+1)>h&&(o=h,m++),l[2*r+1]=o,r>c||(e.bl_count[o]++,i=0,r>=p&&(i=d[r-p]),e.opt_len+=(s=l[2*r])*(o+i),f&&(e.static_len+=s*(u[2*r+1]+i)));if(0!==m){do{for(o=h-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[h]--,m-=2}while(m>0);for(o=h;0!==o;o--)for(r=e.bl_count[o];0!==r;)(a=e.heap[--n])>c||(l[2*a+1]!==o&&(e.opt_len+=(o-l[2*a+1])*l[2*a],l[2*a+1]=o),r--)}}(e,t),Sa(o,c,e.bl_count)}function Na(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=i,i=t[2*(r+1)+1],++s<l&&a===i||(s<c?e.bl_tree[2*a]+=s:0!==a?(a!==o&&e.bl_tree[2*a]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4))}function Ra(e,t,n){var r,a,o=-1,i=t[1],s=0,l=7,c=4;for(0===i&&(l=138,c=3),r=0;r<=n;r++)if(a=i,i=t[2*(r+1)+1],!(++s<l&&a===i)){if(s<c)do{wa(e,a,e.bl_tree)}while(0!=--s);else 0!==a?(a!==o&&(wa(e,a,e.bl_tree),s--),wa(e,16,e.bl_tree),_a(e,s-3,2)):s<=10?(wa(e,17,e.bl_tree),_a(e,s-3,3)):(wa(e,18,e.bl_tree),_a(e,s-11,7));s=0,o=a,0===i?(l=138,c=3):a===i?(l=6,c=3):(l=7,c=4)}}ea(ma);var Ia=!1;function Pa(e,t,n,r){_a(e,0+(r?1:0),3),function(e,t,n,r){ka(e),ba(e,n),ba(e,~n),Qr.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n)}Xr._tr_init=function(e){Ia||(function(){var e,t,n,r,a,o=new Array(ta+1);for(n=0,r=0;r<28;r++)for(fa[r]=n,e=0;e<1<<ra[r];e++)ua[n++]=r;for(ua[n-1]=r,a=0,r=0;r<16;r++)for(ma[r]=a,e=0;e<1<<aa[r];e++)ca[a++]=r;for(a>>=7;r<30;r++)for(ma[r]=a<<7,e=0;e<1<<aa[r]-7;e++)ca[256+a++]=r;for(t=0;t<=ta;t++)o[t]=0;for(e=0;e<=143;)sa[2*e+1]=8,e++,o[8]++;for(;e<=255;)sa[2*e+1]=9,e++,o[9]++;for(;e<=279;)sa[2*e+1]=7,e++,o[7]++;for(;e<=287;)sa[2*e+1]=8,e++,o[8]++;for(Sa(sa,287,o),e=0;e<30;e++)la[2*e+1]=5,la[2*e]=xa(e,5);da=new ga(sa,ra,257,286,ta),pa=new ga(la,aa,0,30,ta),ha=new ga(new Array(0),oa,0,19,7)}(),Ia=!0),e.l_desc=new ya(e.dyn_ltree,da),e.d_desc=new ya(e.dyn_dtree,pa),e.bl_desc=new ya(e.bl_tree,ha),e.bi_buf=0,e.bi_valid=0,Ea(e)},Xr._tr_stored_block=Pa,Xr._tr_flush_block=function(e,t,n,r){var a,o,i=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),Ta(e,e.l_desc),Ta(e,e.d_desc),i=function(e){var t;for(Na(e,e.dyn_ltree,e.l_desc.max_code),Na(e,e.dyn_dtree,e.d_desc.max_code),Ta(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*ia[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),(o=e.static_len+3+7>>>3)<=(a=e.opt_len+3+7>>>3)&&(a=o)):a=o=n+5,n+4<=a&&-1!==t?Pa(e,t,n,r):4===e.strategy||o===a?(_a(e,2+(r?1:0),3),Oa(e,sa,la)):(_a(e,4+(r?1:0),3),function(e,t,n,r){var a;for(_a(e,t-257,5),_a(e,n-1,5),_a(e,r-4,4),a=0;a<r;a++)_a(e,e.bl_tree[2*ia[a]+1],3);Ra(e,e.dyn_ltree,t-1),Ra(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),Oa(e,e.dyn_ltree,e.dyn_dtree)),Ea(e),r&&ka(e)},Xr._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ua[n]+256+1)]++,e.dyn_dtree[2*va(t)]++),e.last_lit===e.lit_bufsize-1},Xr._tr_align=function(e){_a(e,2,3),wa(e,256,sa),function(e){16===e.bi_valid?(ba(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var Fa=function(e,t,n,r){for(var a=65535&e|0,o=e>>>16&65535|0,i=0;0!==n;){n-=i=n>2e3?2e3:n;do{o=o+(a=a+t[r++]|0)|0}while(--i);a%=65521,o%=65521}return a|o<<16|0};function Ma(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var ja,Da=Ma(),La=function(e,t,n,r){var a=Da,o=r+n;e^=-1;for(var i=r;i<o;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},qa={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ba=Yr,Ua=Xr,za=Fa,Ga=La,Ha=qa,$a=0,Wa=0,Va=-2,Ja=2,Ya=8,Ka=286,Za=30,Xa=19,Qa=2*Ka+1,eo=15,to=3,no=258,ro=no+to+1,ao=42,oo=103,io=113,so=666;function lo(e,t){return e.msg=Ha[t],t}function co(e){return(e<<1)-(e>4?9:0)}function uo(e){for(var t=e.length;--t>=0;)e[t]=0}function fo(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Ba.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function po(e,t){Ua._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,fo(e.strm)}function ho(e,t){e.pending_buf[e.pending++]=t}function mo(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function go(e,t){var n,r,a=e.max_chain_length,o=e.strstart,i=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-ro?e.strstart-(e.w_size-ro):0,c=e.window,u=e.w_mask,f=e.prev,d=e.strstart+no,p=c[o+i-1],h=c[o+i];e.prev_length>=e.good_match&&(a>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(n=t)+i]===h&&c[n+i-1]===p&&c[n]===c[o]&&c[++n]===c[o+1]){o+=2,n++;do{}while(c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&c[++o]===c[++n]&&o<d);if(r=no-(d-o),o=d-no,r>i){if(e.match_start=t,i=r,r>=s)break;p=c[o+i-1],h=c[o+i]}}}while((t=f[t&u])>l&&0!=--a);return i<=e.lookahead?i:e.lookahead}function yo(e){var t,n,r,a,o,i,s,l,c,u,f=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=f+(f-ro)){Ba.arraySet(e.window,e.window,f,f,0),e.match_start-=f,e.strstart-=f,e.block_start-=f,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=f?r-f:0}while(--n);t=n=f;do{r=e.prev[--t],e.prev[t]=r>=f?r-f:0}while(--n);a+=f}if(0===e.strm.avail_in)break;if(s=e.window,l=e.strstart+e.lookahead,u=void 0,(u=(i=e.strm).avail_in)>(c=a)&&(u=c),n=0===u?0:(i.avail_in-=u,Ba.arraySet(s,i.input,i.next_in,u,l),1===i.state.wrap?i.adler=za(i.adler,s,u,l):2===i.state.wrap&&(i.adler=Ga(i.adler,s,u,l)),i.next_in+=u,i.total_in+=u,u),e.lookahead+=n,e.lookahead+e.insert>=to)for(e.ins_h=e.window[o=e.strstart-e.insert],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+to-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<to)););}while(e.lookahead<ro&&0!==e.strm.avail_in)}function vo(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(yo(e),0===e.lookahead&&t===$a)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,po(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-ro&&(po(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(po(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&po(e,!1),1)}function bo(e,t){for(var n,r;;){if(e.lookahead<ro){if(yo(e),e.lookahead<ro&&t===$a)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=to&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+to-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ro&&(e.match_length=go(e,n)),e.match_length>=to)if(r=Ua._tr_tally(e,e.strstart-e.match_start,e.match_length-to),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=to){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+to-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=Ua._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(po(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<to-1?e.strstart:to-1,4===t?(po(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(po(e,!1),0===e.strm.avail_out)?1:2}function _o(e,t){for(var n,r,a;;){if(e.lookahead<ro){if(yo(e),e.lookahead<ro&&t===$a)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=to&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+to-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=to-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ro&&(e.match_length=go(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===to&&e.strstart-e.match_start>4096)&&(e.match_length=to-1)),e.prev_length>=to&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-to,r=Ua._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-to),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+to-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=to-1,e.strstart++,r&&(po(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=Ua._tr_tally(e,0,e.window[e.strstart-1]))&&po(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Ua._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<to-1?e.strstart:to-1,4===t?(po(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(po(e,!1),0===e.strm.avail_out)?1:2}function wo(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}function xo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ya,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Ba.Buf16(2*Qa),this.dyn_dtree=new Ba.Buf16(2*(2*Za+1)),this.bl_tree=new Ba.Buf16(2*(2*Xa+1)),uo(this.dyn_ltree),uo(this.dyn_dtree),uo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Ba.Buf16(eo+1),this.heap=new Ba.Buf16(2*Ka+1),uo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Ba.Buf16(2*Ka+1),uo(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function So(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Ja,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ao:io,e.adler=2===t.wrap?0:1,t.last_flush=$a,Ua._tr_init(t),Wa):lo(e,Va)}function Eo(e){var t,n=So(e);return n===Wa&&((t=e.state).window_size=2*t.w_size,uo(t.head),t.max_lazy_match=ja[t.level].max_lazy,t.good_match=ja[t.level].good_length,t.nice_match=ja[t.level].nice_length,t.max_chain_length=ja[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=to-1,t.match_available=0,t.ins_h=0),n}function ko(e,t,n,r,a,o){if(!e)return Va;var i=1;if(-1===t&&(t=6),r<0?(i=0,r=-r):r>15&&(i=2,r-=16),a<1||a>9||n!==Ya||r<8||r>15||t<0||t>9||o<0||o>4)return lo(e,Va);8===r&&(r=9);var s=new xo;return e.state=s,s.strm=e,s.wrap=i,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=a+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+to-1)/to),s.window=new Ba.Buf8(2*s.w_size),s.head=new Ba.Buf16(s.hash_size),s.prev=new Ba.Buf16(s.w_size),s.lit_bufsize=1<<a+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Ba.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=n,Eo(e)}ja=[new wo(0,0,0,0,vo),new wo(4,4,8,4,bo),new wo(4,5,16,8,bo),new wo(4,6,32,32,bo),new wo(4,4,16,16,_o),new wo(8,16,32,32,_o),new wo(8,16,128,128,_o),new wo(8,32,128,256,_o),new wo(32,128,258,1024,_o),new wo(32,258,258,4096,_o)],Zr.deflateInit=function(e,t){return ko(e,t,Ya,15,8,0)},Zr.deflateInit2=ko,Zr.deflateReset=Eo,Zr.deflateResetKeep=So,Zr.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?Va:(e.state.gzhead=t,Wa):Va},Zr.deflate=function(e,t){var n,r,a,o;if(!e||!e.state||t>5||t<0)return e?lo(e,Va):Va;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===so&&4!==t)return lo(e,0===e.avail_out?-5:Va);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===ao)if(2===r.wrap)e.adler=0,ho(r,31),ho(r,139),ho(r,8),r.gzhead?(ho(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ho(r,255&r.gzhead.time),ho(r,r.gzhead.time>>8&255),ho(r,r.gzhead.time>>16&255),ho(r,r.gzhead.time>>24&255),ho(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),ho(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ho(r,255&r.gzhead.extra.length),ho(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Ga(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(ho(r,0),ho(r,0),ho(r,0),ho(r,0),ho(r,0),ho(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),ho(r,3),r.status=io);else{var i=Ya+(r.w_bits-8<<4)<<8;i|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(i|=32),i+=31-i%31,r.status=io,mo(r,i),0!==r.strstart&&(mo(r,e.adler>>>16),mo(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),fo(e),a=r.pending,r.pending!==r.pending_buf_size));)ho(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),fo(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ho(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),fo(e),a=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ho(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>a&&(e.adler=Ga(e.adler,r.pending_buf,r.pending-a,a)),0===o&&(r.status=oo)}else r.status=oo;if(r.status===oo&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&fo(e),r.pending+2<=r.pending_buf_size&&(ho(r,255&e.adler),ho(r,e.adler>>8&255),e.adler=0,r.status=io)):r.status=io),0!==r.pending){if(fo(e),0===e.avail_out)return r.last_flush=-1,Wa}else if(0===e.avail_in&&co(t)<=co(n)&&4!==t)return lo(e,-5);if(r.status===so&&0!==e.avail_in)return lo(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==$a&&r.status!==so){var s=2===r.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(yo(e),0===e.lookahead)){if(t===$a)return 1;break}if(e.match_length=0,n=Ua._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(po(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(po(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(po(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var n,r,a,o,i=e.window;;){if(e.lookahead<=no){if(yo(e),e.lookahead<=no&&t===$a)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=to&&e.strstart>0&&(r=i[a=e.strstart-1])===i[++a]&&r===i[++a]&&r===i[++a]){o=e.strstart+no;do{}while(r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&r===i[++a]&&a<o);e.match_length=no-(o-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=to?(n=Ua._tr_tally(e,1,e.match_length-to),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Ua._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(po(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(po(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(po(e,!1),0===e.strm.avail_out)?1:2}(r,t):ja[r.level].func(r,t);if(3!==s&&4!==s||(r.status=so),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),Wa;if(2===s&&(1===t?Ua._tr_align(r):5!==t&&(Ua._tr_stored_block(r,0,0,!1),3===t&&(uo(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),fo(e),0===e.avail_out))return r.last_flush=-1,Wa}return 4!==t?Wa:r.wrap<=0?1:(2===r.wrap?(ho(r,255&e.adler),ho(r,e.adler>>8&255),ho(r,e.adler>>16&255),ho(r,e.adler>>24&255),ho(r,255&e.total_in),ho(r,e.total_in>>8&255),ho(r,e.total_in>>16&255),ho(r,e.total_in>>24&255)):(mo(r,e.adler>>>16),mo(r,65535&e.adler)),fo(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Wa:1)},Zr.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ao&&69!==t&&73!==t&&91!==t&&t!==oo&&t!==io&&t!==so?lo(e,Va):(e.state=null,t===io?lo(e,-3):Wa):Va},Zr.deflateSetDictionary=function(e,t){var n,r,a,o,i,s,l,c,u=t.length;if(!e||!e.state)return Va;if(2===(o=(n=e.state).wrap)||1===o&&n.status!==ao||n.lookahead)return Va;for(1===o&&(e.adler=za(e.adler,t,u,0)),n.wrap=0,u>=n.w_size&&(0===o&&(uo(n.head),n.strstart=0,n.block_start=0,n.insert=0),c=new Ba.Buf8(n.w_size),Ba.arraySet(c,t,u-n.w_size,n.w_size,0),t=c,u=n.w_size),i=e.avail_in,s=e.next_in,l=e.input,e.avail_in=u,e.next_in=0,e.input=t,yo(n);n.lookahead>=to;){r=n.strstart,a=n.lookahead-(to-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+to-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--a);n.strstart=r,n.lookahead=to-1,yo(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=to-1,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=i,n.wrap=o,Wa},Zr.deflateInfo="pako deflate (from Nodeca project)";var Ao={},Co=Yr,Oo=!0,To=!0;try{String.fromCharCode.apply(null,[0])}catch(e){Oo=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){To=!1}for(var No=new Co.Buf8(256),Ro=0;Ro<256;Ro++)No[Ro]=Ro>=252?6:Ro>=248?5:Ro>=240?4:Ro>=224?3:Ro>=192?2:1;function Io(e,t){if(t<65534&&(e.subarray&&To||!e.subarray&&Oo))return String.fromCharCode.apply(null,Co.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}No[254]=No[254]=1,Ao.string2buf=function(e){var t,n,r,a,o,i=e.length,s=0;for(a=0;a<i;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Co.Buf8(s),o=0,a=0;o<s;a++)55296==(64512&(n=e.charCodeAt(a)))&&a+1<i&&56320==(64512&(r=e.charCodeAt(a+1)))&&(n=65536+(n-55296<<10)+(r-56320),a++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},Ao.buf2binstring=function(e){return Io(e,e.length)},Ao.binstring2buf=function(e){for(var t=new Co.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},Ao.buf2string=function(e,t){var n,r,a,o,i=t||e.length,s=new Array(2*i);for(r=0,n=0;n<i;)if((a=e[n++])<128)s[r++]=a;else if((o=No[a])>4)s[r++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<i;)a=a<<6|63&e[n++],o--;o>1?s[r++]=65533:a<65536?s[r++]=a:(s[r++]=55296|(a-=65536)>>10&1023,s[r++]=56320|1023&a)}return Io(s,r)},Ao.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+No[e[n]]>t?n:t};var Po=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Fo=Zr,Mo=Yr,jo=Ao,Do=qa,Lo=Po,qo=Object.prototype.toString,Bo=0,Uo=-1,zo=0,Go=8;function Ho(e){if(!(this instanceof Ho))return new Ho(e);this.options=Mo.assign({level:Uo,method:Go,chunkSize:16384,windowBits:15,memLevel:8,strategy:zo,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Lo,this.strm.avail_out=0;var n=Fo.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Bo)throw new Error(Do[n]);if(t.header&&Fo.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?jo.string2buf(t.dictionary):"[object ArrayBuffer]"===qo.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Fo.deflateSetDictionary(this.strm,r))!==Bo)throw new Error(Do[n]);this._dict_set=!0}}function $o(e,t){var n=new Ho(t);if(n.push(e,!0),n.err)throw n.msg||Do[n.err];return n.result}Ho.prototype.push=function(e,t){var n,r,a=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,a.input="string"==typeof e?jo.string2buf(e):"[object ArrayBuffer]"===qo.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new Mo.Buf8(o),a.next_out=0,a.avail_out=o),1!==(n=Fo.deflate(a,r))&&n!==Bo)return this.onEnd(n),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==r&&2!==r)||this.onData("string"===this.options.to?jo.buf2binstring(Mo.shrinkBuf(a.output,a.next_out)):Mo.shrinkBuf(a.output,a.next_out))}while((a.avail_in>0||0===a.avail_out)&&1!==n);return 4===r?(n=Fo.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Bo):2!==r||(this.onEnd(Bo),a.avail_out=0,!0)},Ho.prototype.onData=function(e){this.chunks.push(e)},Ho.prototype.onEnd=function(e){e===Bo&&(this.result="string"===this.options.to?this.chunks.join(""):Mo.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Kr.Deflate=Ho,Kr.deflate=$o,Kr.deflateRaw=function(e,t){return(t=t||{}).raw=!0,$o(e,t)},Kr.gzip=function(e,t){return(t=t||{}).gzip=!0,$o(e,t)};var Wo={},Vo={},Jo=Yr,Yo=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ko=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Zo=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Xo=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Qo=Yr,ei=Fa,ti=La,ni=function(e,t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A;k=e.input,a=(r=e.next_in)+(e.avail_in-5),A=e.output,i=(o=e.next_out)-(t-e.avail_out),s=o+(e.avail_out-257),l=(n=e.state).dmax,c=n.wsize,u=n.whave,f=n.wnext,d=n.window,p=n.hold,h=n.bits,m=n.lencode,g=n.distcode,y=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=m[p&y];t:for(;;){if(p>>>=_=b>>>24,h-=_,0==(_=b>>>16&255))A[o++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=m[(65535&b)+(p&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}w=65535&b,(_&=15)&&(h<_&&(p+=k[r++]<<h,h+=8),w+=p&(1<<_)-1,p>>>=_,h-=_),h<15&&(p+=k[r++]<<h,p+=k[r++]<<(h+=8),h+=8),b=g[p&v];n:for(;;){if(p>>>=_=b>>>24,h-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=g[(65535&b)+(p&(1<<_)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(x=65535&b,h<(_&=15)&&(p+=k[r++]<<h,(h+=8)<_&&(p+=k[r++]<<h,h+=8)),(x+=p&(1<<_)-1)>l){e.msg="invalid distance too far back",n.mode=30;break e}if(p>>>=_,h-=_,x>(_=o-i)){if((_=x-_)>u&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(S=0,E=d,0===f){if(S+=c-_,_<w){w-=_;do{A[o++]=d[S++]}while(--_);S=o-x,E=A}}else if(f<_){if(S+=c+f-_,(_-=f)<w){w-=_;do{A[o++]=d[S++]}while(--_);if(S=0,f<w){w-=_=f;do{A[o++]=d[S++]}while(--_);S=o-x,E=A}}}else if(S+=f-_,_<w){w-=_;do{A[o++]=d[S++]}while(--_);S=o-x,E=A}for(;w>2;)A[o++]=E[S++],A[o++]=E[S++],A[o++]=E[S++],w-=3;w&&(A[o++]=E[S++],w>1&&(A[o++]=E[S++]))}else{S=o-x;do{A[o++]=A[S++],A[o++]=A[S++],A[o++]=A[S++],w-=3}while(w>2);w&&(A[o++]=A[S++],w>1&&(A[o++]=A[S++]))}break}}break}}while(r<a&&o<s);p&=(1<<(h-=(w=h>>3)<<3))-1,e.next_in=r-=w,e.next_out=o,e.avail_in=r<a?a-r+5:5-(r-a),e.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=h},ri=function(e,t,n,r,a,o,i,s){var l,c,u,f,d,p,h,m,g,y=s.bits,v=0,b=0,_=0,w=0,x=0,S=0,E=0,k=0,A=0,C=0,O=null,T=0,N=new Jo.Buf16(16),R=new Jo.Buf16(16),I=null,P=0;for(v=0;v<=15;v++)N[v]=0;for(b=0;b<r;b++)N[t[n+b]]++;for(x=y,w=15;w>=1&&0===N[w];w--);if(x>w&&(x=w),0===w)return a[o++]=20971520,a[o++]=20971520,s.bits=1,0;for(_=1;_<w&&0===N[_];_++);for(x<_&&(x=_),k=1,v=1;v<=15;v++)if(k<<=1,(k-=N[v])<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(R[1]=0,v=1;v<15;v++)R[v+1]=R[v]+N[v];for(b=0;b<r;b++)0!==t[n+b]&&(i[R[t[n+b]]++]=b);if(0===e?(O=I=i,p=19):1===e?(O=Yo,T-=257,I=Ko,P-=257,p=256):(O=Zo,I=Xo,p=-1),C=0,b=0,v=_,d=o,S=x,E=0,u=-1,f=(A=1<<x)-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){h=v-E,i[b]<p?(m=0,g=i[b]):i[b]>p?(m=I[P+i[b]],g=O[T+i[b]]):(m=96,g=0),l=1<<v-E,_=c=1<<S;do{a[d+(C>>E)+(c-=l)]=h<<24|m<<16|g|0}while(0!==c);for(l=1<<v-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,b++,0==--N[v]){if(v===w)break;v=t[n+i[b]]}if(v>x&&(C&f)!==u){for(0===E&&(E=x),d+=_,k=1<<(S=v-E);S+E<w&&!((k-=N[S+E])<=0);)S++,k<<=1;if(A+=1<<S,1===e&&A>852||2===e&&A>592)return 1;a[u=C&f]=x<<24|S<<16|d-o|0}}return 0!==C&&(a[d+C]=v-E<<24|64<<16|0),s.bits=x,0},ai=0,oi=-2,ii=1,si=12,li=30,ci=852,ui=592;function fi(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function di(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Qo.Buf16(320),this.work=new Qo.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function pi(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ii,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Qo.Buf32(ci),t.distcode=t.distdyn=new Qo.Buf32(ui),t.sane=1,t.back=-1,ai):oi}function hi(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,pi(e)):oi}function mi(e,t){var n,r;return e&&e.state?(t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?oi:(null!==(r=e.state).window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,hi(e))):oi}function gi(e,t){var n,r;return e?(r=new di,e.state=r,r.window=null,(n=mi(e,t))!==ai&&(e.state=null),n):oi}var yi,vi,bi=!0;function _i(e){if(bi){var t;for(yi=new Qo.Buf32(512),vi=new Qo.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ri(1,e.lens,0,288,yi,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ri(2,e.lens,0,32,vi,0,e.work,{bits:5}),bi=!1}e.lencode=yi,e.lenbits=9,e.distcode=vi,e.distbits=5}function wi(e,t,n,r){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Qo.Buf8(o.wsize)),r>=o.wsize?(Qo.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>r&&(a=r),Qo.arraySet(o.window,t,n-r,a,o.wnext),(r-=a)?(Qo.arraySet(o.window,t,n-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}Vo.inflateReset=hi,Vo.inflateReset2=mi,Vo.inflateResetKeep=pi,Vo.inflateInit=function(e){return gi(e,15)},Vo.inflateInit2=gi,Vo.inflate=function(e,t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A=0,C=new Qo.Buf8(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return oi;(n=e.state).mode===si&&(n.mode=13),i=e.next_out,a=e.output,o=e.next_in,r=e.input,c=n.hold,u=n.bits,f=s=e.avail_in,d=l=e.avail_out,S=ai;e:for(;;)switch(n.mode){case ii:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(2&n.wrap&&35615===c){n.check=0,C[0]=255&c,C[1]=c>>>8&255,n.check=ti(n.check,C,2,0),c=0,u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=li;break}if(8!=(15&c)){e.msg="unknown compression method",n.mode=li;break}if(u-=4,x=8+(15&(c>>>=4)),0===n.wbits)n.wbits=x;else if(x>n.wbits){e.msg="invalid window size",n.mode=li;break}n.dmax=1<<x,e.adler=n.check=1,n.mode=512&c?10:si,c=0,u=0;break;case 2:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.flags=c,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=li;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=li;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=ti(n.check,C,2,0)),c=0,u=0,n.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.time=c),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,n.check=ti(n.check,C,4,0)),c=0,u=0,n.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=ti(n.check,C,2,0)),c=0,u=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&(C[0]=255&c,C[1]=c>>>8&255,n.check=ti(n.check,C,2,0)),c=0,u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((p=n.length)>s&&(p=s),p&&(n.head&&(x=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Qo.arraySet(n.head.extra,r,o,p,x)),512&n.flags&&(n.check=ti(n.check,r,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.name+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=ti(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;p=0;do{x=r[o+p++],n.head&&x&&n.length<65536&&(n.head.comment+=String.fromCharCode(x))}while(x&&p<s);if(512&n.flags&&(n.check=ti(n.check,r,p,o)),s-=p,o+=p,x)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=li;break}c=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=si;break;case 10:for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}e.adler=n.check=fi(c),c=0,u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,2;e.adler=n.check=1,n.mode=si;case si:if(5===t||6===t)break e;case 13:if(n.last){c>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}switch(n.last=1&c,u-=1,3&(c>>>=1)){case 0:n.mode=14;break;case 1:if(_i(n),n.mode=20,6===t){c>>>=2,u-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=li}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=li;break}if(n.length=65535&c,c=0,u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(p=n.length){if(p>s&&(p=s),p>l&&(p=l),0===p)break e;Qo.arraySet(a,r,o,p,i),s-=p,o+=p,l-=p,i+=p,n.length-=p;break}n.mode=si;break;case 17:for(;u<14;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(n.nlen=257+(31&c),u-=5,n.ndist=1+(31&(c>>>=5)),u-=5,n.ncode=4+(15&(c>>>=5)),c>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=li;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.lens[O[n.have++]]=7&c,c>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,S=ri(0,n.lens,0,19,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid code lengths set",n.mode=li;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;y=(A=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&A,!((g=A>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(v<16)c>>>=g,u-=g,n.lens[n.have++]=v;else{if(16===v){for(k=g+2;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c>>>=g,u-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=li;break}x=n.lens[n.have-1],p=3+(3&c),c>>>=2,u-=2}else if(17===v){for(k=g+3;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=3+(7&(c>>>=g)),c>>>=3,u-=3}else{for(k=g+7;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}u-=g,x=0,p=11+(127&(c>>>=g)),c>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=li;break}for(;p--;)n.lens[n.have++]=x}}if(n.mode===li)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=li;break}if(n.lenbits=9,S=ri(1,n.lens,0,n.nlen,n.lencode,0,n.work,E={bits:n.lenbits}),n.lenbits=E.bits,S){e.msg="invalid literal/lengths set",n.mode=li;break}if(n.distbits=6,n.distcode=n.distdyn,S=ri(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E={bits:n.distbits}),n.distbits=E.bits,S){e.msg="invalid distances set",n.mode=li;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(s>=6&&l>=258){e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,ni(e,d),i=e.next_out,a=e.output,l=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,c=n.hold,u=n.bits,n.mode===si&&(n.back=-1);break}for(n.back=0;y=(A=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,v=65535&A,!((g=A>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(y&&0==(240&y)){for(b=g,_=y,w=v;y=(A=n.lencode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&A,!(b+(g=A>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,n.length=v,0===y){n.mode=26;break}if(32&y){n.back=-1,n.mode=si;break}if(64&y){e.msg="invalid literal/length code",n.mode=li;break}n.extra=15&y,n.mode=22;case 22:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;y=(A=n.distcode[c&(1<<n.distbits)-1])>>>16&255,v=65535&A,!((g=A>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(0==(240&y)){for(b=g,_=y,w=v;y=(A=n.distcode[w+((c&(1<<b+_)-1)>>b)])>>>16&255,v=65535&A,!(b+(g=A>>>24)<=u);){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}c>>>=b,u-=b,n.back+=b}if(c>>>=g,u-=g,n.back+=g,64&y){e.msg="invalid distance code",n.mode=li;break}n.offset=v,n.extra=15&y,n.mode=24;case 24:if(n.extra){for(k=n.extra;u<k;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=li;break}n.mode=25;case 25:if(0===l)break e;if(n.offset>(p=d-l)){if((p=n.offset-p)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=li;break}h=p>n.wnext?n.wsize-(p-=n.wnext):n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=a,h=i-n.offset,p=n.length;p>l&&(p=l),l-=p,n.length-=p;do{a[i++]=m[h++]}while(--p);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;a[i++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===s)break e;s--,c|=r[o++]<<u,u+=8}if(e.total_out+=d-=l,n.total+=d,d&&(e.adler=n.check=n.flags?ti(n.check,a,d,i-d):ei(n.check,a,d,i-d)),d=l,(n.flags?c:fi(c))!==n.check){e.msg="incorrect data check",n.mode=li;break}c=0,u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,c+=r[o++]<<u,u+=8}if(c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=li;break}c=0,u=0}n.mode=29;case 29:S=1;break e;case li:S=-3;break e;case 31:return-4;default:return oi}return e.next_out=i,e.avail_out=l,e.next_in=o,e.avail_in=s,n.hold=c,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<li&&(n.mode<27||4!==t))&&wi(e,e.output,e.next_out,d-e.avail_out),d-=e.avail_out,e.total_in+=f-=e.avail_in,e.total_out+=d,n.total+=d,n.wrap&&d&&(e.adler=n.check=n.flags?ti(n.check,a,d,e.next_out-d):ei(n.check,a,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===si?128:0)+(20===n.mode||15===n.mode?256:0),(0===f&&0===d||4===t)&&S===ai&&(S=-5),S},Vo.inflateEnd=function(e){if(!e||!e.state)return oi;var t=e.state;return t.window&&(t.window=null),e.state=null,ai},Vo.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?oi:(n.head=t,t.done=!1,ai):oi},Vo.inflateSetDictionary=function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?oi:11===n.mode&&ei(1,t,r,0)!==n.check?-3:wi(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,ai):oi},Vo.inflateInfo="pako inflate (from Nodeca project)";var xi={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Si=Vo,Ei=Yr,ki=Ao,Ai=xi,Ci=qa,Oi=Po,Ti=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Ni=Object.prototype.toString;function Ri(e){if(!(this instanceof Ri))return new Ri(e);this.options=Ei.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Oi,this.strm.avail_out=0;var n=Si.inflateInit2(this.strm,t.windowBits);if(n!==Ai.Z_OK)throw new Error(Ci[n]);if(this.header=new Ti,Si.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ki.string2buf(t.dictionary):"[object ArrayBuffer]"===Ni.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Si.inflateSetDictionary(this.strm,t.dictionary))!==Ai.Z_OK))throw new Error(Ci[n])}function Ii(e,t){var n=new Ri(t);if(n.push(e,!0),n.err)throw n.msg||Ci[n.err];return n.result}Ri.prototype.push=function(e,t){var n,r,a,o,i,s=this.strm,l=this.options.chunkSize,c=this.options.dictionary,u=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?Ai.Z_FINISH:Ai.Z_NO_FLUSH,s.input="string"==typeof e?ki.binstring2buf(e):"[object ArrayBuffer]"===Ni.call(e)?new Uint8Array(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new Ei.Buf8(l),s.next_out=0,s.avail_out=l),(n=Si.inflate(s,Ai.Z_NO_FLUSH))===Ai.Z_NEED_DICT&&c&&(n=Si.inflateSetDictionary(this.strm,c)),n===Ai.Z_BUF_ERROR&&!0===u&&(n=Ai.Z_OK,u=!1),n!==Ai.Z_STREAM_END&&n!==Ai.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==Ai.Z_STREAM_END&&(0!==s.avail_in||r!==Ai.Z_FINISH&&r!==Ai.Z_SYNC_FLUSH)||("string"===this.options.to?(a=ki.utf8border(s.output,s.next_out),o=s.next_out-a,i=ki.buf2string(s.output,a),s.next_out=o,s.avail_out=l-o,o&&Ei.arraySet(s.output,s.output,a,o,0),this.onData(i)):this.onData(Ei.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(u=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==Ai.Z_STREAM_END);return n===Ai.Z_STREAM_END&&(r=Ai.Z_FINISH),r===Ai.Z_FINISH?(n=Si.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Ai.Z_OK):r!==Ai.Z_SYNC_FLUSH||(this.onEnd(Ai.Z_OK),s.avail_out=0,!0)},Ri.prototype.onData=function(e){this.chunks.push(e)},Ri.prototype.onEnd=function(e){e===Ai.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):Ei.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Wo.Inflate=Ri,Wo.inflate=Ii,Wo.inflateRaw=function(e,t){return(t=t||{}).raw=!0,Ii(e,t)},Wo.ungzip=Ii;var Pi={};(0,Yr.assign)(Pi,Kr,Wo,xi);var Fi=Pi;function Mi(e){return ji.apply(this,arguments)}function ji(){return ji=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=0,a=0,o=[],i=0;case 5:if(l=t.subarray(r),s=new Fi.Inflate,n=s.strm,s.push(l,Fi.Z_SYNC_FLUSH),!s.err){e.next=12;break}throw new Error(s.msg);case 12:r+=n.next_in,o[a]=s.result,i+=o[a].length,a+=1;case 16:if(n.avail_in){e.next=5;break}case 17:for(c=new Uint8Array(i),u=0,f=0;u<o.length;u++)c.set(o[u],f),f+=o[u].length;return e.abrupt("return",Zt.from(c));case 22:if(e.prev=22,e.t0=e.catch(0),!"".concat(e.t0).match(/incorrect header check/)){e.next=26;break}throw new Error("problem decompressing block: incorrect gzip header check");case 26:throw e.t0;case 27:case"end":return e.stop()}}),e,null,[[0,22]])}))),ji.apply(this,arguments)}var Di=null;try{Di=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Xl){}function Li(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function qi(e){return!0===(e&&e.__isLong__)}function Bi(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(Li.prototype,"__isLong__",{value:!0}),Li.isLong=qi;var Ui={},zi={};function Gi(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=zi[e])?r:(n=$i(e,0,!0),a&&(zi[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=Ui[e])?r:(n=$i(e,e<0?-1:0,!1),a&&(Ui[e]=n),n)}function Hi(e,t){if(isNaN(e))return t?es:Qi;if(t){if(e<0)return es;if(e>=Ki)return os}else{if(e<=-Zi)return is;if(e+1>=Zi)return as}return e<0?Hi(-e,t).neg():$i(e%Yi|0,e/Yi|0,t)}function $i(e,t,n){return new Li(e,t,n)}Li.fromInt=Gi,Li.fromNumber=Hi,Li.fromBits=$i;var Wi=Math.pow;function Vi(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?es:Qi;if((n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Vi(e.substring(1),t,n).neg();for(var a=Hi(Wi(n,8)),o=Qi,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),l=parseInt(e.substring(i,i+s),n);if(s<8){var c=Hi(Wi(n,s));o=o.mul(c).add(Hi(l))}else o=(o=o.mul(a)).add(Hi(l))}return o.unsigned=t,o}function Ji(e,t){return"number"==typeof e?Hi(e,t):"string"==typeof e?Vi(e,t):$i(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Li.fromString=Vi,Li.fromValue=Ji;var Yi=4294967296,Ki=Yi*Yi,Zi=Ki/2,Xi=Gi(16777216),Qi=Gi(0);Li.ZERO=Qi;var es=Gi(0,!0);Li.UZERO=es;var ts=Gi(1);Li.ONE=ts;var ns=Gi(1,!0);Li.UONE=ns;var rs=Gi(-1);Li.NEG_ONE=rs;var as=$i(-1,2147483647,!1);Li.MAX_VALUE=as;var os=$i(-1,-1,!0);Li.MAX_UNSIGNED_VALUE=os;var is=$i(0,-2147483648,!1);Li.MIN_VALUE=is;var ss=Li.prototype;ss.toInt=function(){return this.unsigned?this.low>>>0:this.low},ss.toNumber=function(){return this.unsigned?(this.high>>>0)*Yi+(this.low>>>0):this.high*Yi+(this.low>>>0)},ss.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(is)){var t=Hi(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=Hi(Wi(e,6),this.unsigned),o=this,i="";;){var s=o.div(a),l=(o.sub(s.mul(a)).toInt()>>>0).toString(e);if((o=s).isZero())return l+i;for(;l.length<6;)l="0"+l;i=""+l+i}},ss.getHighBits=function(){return this.high},ss.getHighBitsUnsigned=function(){return this.high>>>0},ss.getLowBits=function(){return this.low},ss.getLowBitsUnsigned=function(){return this.low>>>0},ss.getNumBitsAbs=function(){if(this.isNegative())return this.eq(is)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},ss.isZero=function(){return 0===this.high&&0===this.low},ss.eqz=ss.isZero,ss.isNegative=function(){return!this.unsigned&&this.high<0},ss.isPositive=function(){return this.unsigned||this.high>=0},ss.isOdd=function(){return 1==(1&this.low)},ss.isEven=function(){return 0==(1&this.low)},ss.equals=function(e){return qi(e)||(e=Ji(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},ss.eq=ss.equals,ss.notEquals=function(e){return!this.eq(e)},ss.neq=ss.notEquals,ss.ne=ss.notEquals,ss.lessThan=function(e){return this.comp(e)<0},ss.lt=ss.lessThan,ss.lessThanOrEqual=function(e){return this.comp(e)<=0},ss.lte=ss.lessThanOrEqual,ss.le=ss.lessThanOrEqual,ss.greaterThan=function(e){return this.comp(e)>0},ss.gt=ss.greaterThan,ss.greaterThanOrEqual=function(e){return this.comp(e)>=0},ss.gte=ss.greaterThanOrEqual,ss.ge=ss.greaterThanOrEqual,ss.compare=function(e){if(qi(e)||(e=Ji(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},ss.comp=ss.compare,ss.negate=function(){return!this.unsigned&&this.eq(is)?is:this.not().add(ts)},ss.neg=ss.negate,ss.add=function(e){qi(e)||(e=Ji(e));var t=0,n=0,r=0,a=0;return r+=(a+=(65535&this.low)+(65535&e.low))>>>16,n+=(r+=(this.low>>>16)+(e.low>>>16))>>>16,t+=(n+=(65535&this.high)+(65535&e.high))>>>16,t+=(this.high>>>16)+(e.high>>>16),$i((r&=65535)<<16|(a&=65535),(t&=65535)<<16|(n&=65535),this.unsigned)},ss.subtract=function(e){return qi(e)||(e=Ji(e)),this.add(e.neg())},ss.sub=ss.subtract,ss.multiply=function(e){if(this.isZero())return this;if(qi(e)||(e=Ji(e)),Di)return $i(Di.mul(this.low,this.high,e.low,e.high),Di.get_high(),this.unsigned);if(e.isZero())return this.unsigned?es:Qi;if(this.eq(is))return e.isOdd()?is:Qi;if(e.eq(is))return this.isOdd()?is:Qi;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Xi)&&e.lt(Xi))return Hi(this.toNumber()*e.toNumber(),this.unsigned);var t=65535&this.high,n=this.low>>>16,r=65535&this.low,a=65535&e.high,o=e.low>>>16,i=65535&e.low,s=0,l=0,c=0,u=0;return c+=(u+=r*i)>>>16,l+=(c+=n*i)>>>16,c&=65535,l+=(c+=r*o)>>>16,s+=(l+=t*i)>>>16,l&=65535,s+=(l+=n*o)>>>16,l&=65535,s+=(l+=r*a)>>>16,s+=(this.high>>>16)*i+t*o+n*a+r*(e.high>>>16),$i((c&=65535)<<16|(u&=65535),(s&=65535)<<16|(l&=65535),this.unsigned)},ss.mul=ss.multiply,ss.divide=function(e){if(qi(e)||(e=Ji(e)),e.isZero())throw Error("division by zero");var t,n,r;if(Di)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?$i((this.unsigned?Di.div_u:Di.div_s)(this.low,this.high,e.low,e.high),Di.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?es:Qi;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return es;if(e.gt(this.shru(1)))return ns;r=es}else{if(this.eq(is))return e.eq(ts)||e.eq(rs)?is:e.eq(is)?ts:(t=this.shr(1).div(e).shl(1)).eq(Qi)?e.isNegative()?ts:rs:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(is))return this.unsigned?es:Qi;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Qi}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:Wi(2,a-48),i=Hi(t),s=i.mul(e);s.isNegative()||s.gt(n);)s=(i=Hi(t-=o,this.unsigned)).mul(e);i.isZero()&&(i=ts),r=r.add(i),n=n.sub(s)}return r},ss.div=ss.divide,ss.modulo=function(e){return qi(e)||(e=Ji(e)),Di?$i((this.unsigned?Di.rem_u:Di.rem_s)(this.low,this.high,e.low,e.high),Di.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},ss.mod=ss.modulo,ss.rem=ss.modulo,ss.not=function(){return $i(~this.low,~this.high,this.unsigned)},ss.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},ss.clz=ss.countLeadingZeros,ss.countTrailingZeros=function(){return this.low?Bi(this.low):Bi(this.high)+32},ss.ctz=ss.countTrailingZeros,ss.and=function(e){return qi(e)||(e=Ji(e)),$i(this.low&e.low,this.high&e.high,this.unsigned)},ss.or=function(e){return qi(e)||(e=Ji(e)),$i(this.low|e.low,this.high|e.high,this.unsigned)},ss.xor=function(e){return qi(e)||(e=Ji(e)),$i(this.low^e.low,this.high^e.high,this.unsigned)},ss.shiftLeft=function(e){return qi(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?$i(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):$i(0,this.low<<e-32,this.unsigned)},ss.shl=ss.shiftLeft,ss.shiftRight=function(e){return qi(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?$i(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):$i(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},ss.shr=ss.shiftRight,ss.shiftRightUnsigned=function(e){return qi(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?$i(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):$i(32===e?this.high:this.high>>>e-32,0,this.unsigned)},ss.shru=ss.shiftRightUnsigned,ss.shr_u=ss.shiftRightUnsigned,ss.rotateLeft=function(e){var t;return qi(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?$i(this.high,this.low,this.unsigned):e<32?$i(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):$i(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},ss.rotl=ss.rotateLeft,ss.rotateRight=function(e){var t;return qi(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?$i(this.high,this.low,this.unsigned):e<32?$i(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):$i(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},ss.rotr=ss.rotateRight,ss.toSigned=function(){return this.unsigned?$i(this.low,this.high,!1):this},ss.toUnsigned=function(){return this.unsigned?this:$i(this.low,this.high,!0)},ss.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},ss.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},ss.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Li.fromBytes=function(e,t,n){return n?Li.fromBytesLE(e,t):Li.fromBytesBE(e,t)},Li.fromBytesLE=function(e,t){return new Li(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Li.fromBytesBE=function(e,t){return new Li(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var ls=function(){function e(t){var n=t.filehandle,r=t.path;if(X(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new zr(r)}}var t,n,r;return ee(e,[{key:"_readLongWithOverflow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Li.fromBytesLE(e.slice(t,t+8),n);if(r.greaterThan(Number.MAX_SAFE_INTEGER)||r.lessThan(Number.MIN_SAFE_INTEGER))throw new TypeError("integer overflow");return r.toNumber()}},{key:"_getIndex",value:function(){return this.index||(this.index=this._readIndex()),this.index}},{key:"_readIndex",value:(r=Z(J().mark((function e(){var t,n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Zt.allocUnsafe(8),e.next=3,this.filehandle.read(t,0,8,0);case 3:if(n=this._readLongWithOverflow(t,0,!0)){e.next=6;break}return e.abrupt("return",[[0,0]]);case 6:if((r=new Array(n+1))[0]=[0,0],!((a=16*n)>Number.MAX_SAFE_INTEGER)){e.next=11;break}throw new TypeError("integer overflow");case 11:return t=Zt.allocUnsafe(a),e.next=14,this.filehandle.read(t,0,a,8);case 14:for(o=0;o<n;o+=1)i=this._readLongWithOverflow(t,16*o),s=this._readLongWithOverflow(t,16*o+8),r[o+1]=[i,s];return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getLastBlock",value:(n=Z(J().mark((function e(){var t;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndex();case 2:if((t=e.sent).length){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.abrupt("return",t[t.length-1]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getRelevantBlocksForRead",value:(t=Z(J().mark((function e(t,n){var r,a,o,i,s,l,c,u,f;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n+t,0!==t){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,this._getIndex();case 5:for(o=[],i=function(e,t){var r=e[1];return r<=n&&(t?t[1]:Infinity)>n?0:r<n?-1:1},s=0,l=(a=e.sent).length-1,c=Math.floor(a.length/2),u=i(a[c],a[c+1]);0!==u;)u>0?l=c-1:u<0&&(s=c+1),c=Math.ceil((l-s)/2)+s,u=i(a[c],a[c+1]);o.push(a[c]),f=c+1;case 15:if(!(f<a.length)){e.next=22;break}if(o.push(a[f]),!(a[f][1]>=r)){e.next=19;break}return e.abrupt("break",22);case 19:f+=1,e.next=15;break;case 22:return o[o.length-1][1]<r&&o.push([]),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),cs=function(){function e(t){var n=t.filehandle,r=t.path,a=t.gziFilehandle,o=t.gziPath;if(X(this,e),n)this.filehandle=n;else{if(!r)throw new TypeError("either filehandle or path must be defined");this.filehandle=new zr(r)}if(!a&&!o&&!r)throw new TypeError("either gziFilehandle or gziPath must be defined");this.gzi=new ls({filehandle:a,path:a||o||!r?"".concat(r,".gzi"):o})}var t,n,r,a;return ee(e,[{key:"stat",value:(a=Z(J().mark((function e(){var t;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.filehandle.stat();case 2:return t=e.sent,e.t0=Object,e.t1=t,e.next=7,this.getUncompressedFileSize();case 7:return e.t2=e.sent,e.t3=void 0,e.t4=void 0,e.t5={size:e.t2,blocks:e.t3,blksize:e.t4},e.abrupt("return",e.t0.assign.call(e.t0,e.t1,e.t5));case 12:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUncompressedFileSize",value:(r=Z(J().mark((function e(){var t,n,r,a,o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getLastBlock();case 2:return t=de(e.sent,2),n=t[1],e.next=7,this.filehandle.stat();case 7:return r=e.sent.size,a=Zt.allocUnsafe(4),e.next=12,this.filehandle.read(a,0,4,r-28-4);case 12:if(4===e.sent.bytesRead){e.next=16;break}throw new Error("read error");case 16:return o=a.readUInt32LE(0),e.abrupt("return",n+o);case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_readAndUncompressBlock",value:(n=Z(J().mark((function e(t,n,r){var a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=de(n,1)[0],o=de(r,1)[0]){e.next=7;break}return e.next=6,this.filehandle.stat();case 6:o=e.sent.size;case 7:return i=o-a,e.next=10,this.filehandle.read(t,0,i,a);case 10:return e.next=12,Mi(t.slice(0,i));case 12:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"read",value:(t=Z(J().mark((function e(t,n,r,a){var o,i,s,l,c,u,f,d,p,h;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.gzi.getRelevantBlocksForRead(r,a);case 2:o=e.sent,i=Zt.allocUnsafe(65536),s=n,l=0,c=0;case 7:if(!(c<o.length-1)){e.next=18;break}return e.next=10,this._readAndUncompressBlock(i,o[c],o[c+1]);case 10:u=e.sent,f=de(o[c],2),p=(d=f[1])>=a?0:a-d,h=Math.min(a+r,d+u.length)-d,p>=0&&p<u.length&&(u.copy(t,s,p,h),s+=h-p,l+=h-p);case 15:c+=1,e.next=7;break;case 18:return e.abrupt("return",{bytesRead:l,buffer:t});case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a){return t.apply(this,arguments)})}]),e}();function us(e,t){return e.offset+e.lineBytes*Math.floor(t/e.lineLength)+t%e.lineLength}function fs(e,t){return ds.apply(this,arguments)}function ds(){return ds=Z(J().mark((function e(t,n){var r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if((r=e.sent)&&r.length){e.next=5;break}throw new Error("No data read from FASTA index (FAI) file");case 5:return a=0,i=r.toString("utf8").split(/\r?\n/).filter((function(e){return/\S/.test(e)})).map((function(e){return e.split("\t")})).filter((function(e){return""!==e[0]})).map((function(e){return o&&o.name===e[0]||(o={name:e[0],id:a},a+=1),{id:o.id,name:e[0],length:+e[1],start:0,end:+e[1],offset:+e[2],lineLength:+e[3],lineBytes:+e[4]}})),e.abrupt("return",{name:Object.fromEntries(i.map((function(e){return[e.name,e]}))),id:Object.fromEntries(i.map((function(e){return[e.id,e]})))});case 8:case"end":return e.stop()}}),e)}))),ds.apply(this,arguments)}var ps=function(){function e(t){var n=t.fasta,r=t.fai,a=t.path,o=t.faiPath;if(X(this,e),n)this.fasta=n;else{if(!a)throw new Error("Need to pass filehandle for fasta or path to localfile");this.fasta=new zr(a)}if(r)this.fai=r;else if(o)this.fai=new zr(o);else{if(!a)throw new Error("Need to pass filehandle for  or path to localfile");this.fai=new zr("".concat(a,".fai"))}}var t,n,r,a,o,i,s,l,c;return ee(e,[{key:"_getIndexes",value:(c=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.indexes||(this.indexes=fs(this.fai,t)),e.abrupt("return",this.indexes);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getSequenceNames",value:(l=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Object,e.next=3,this._getIndexes(t);case 3:return e.t1=e.sent.name,e.abrupt("return",e.t0.keys.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getSequenceSizes",value:(s=Z(J().mark((function e(t){var n,r,a;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,this._getIndexes(t);case 3:for(r=Object.values(e.sent.id),a=0;a<r.length;a+=1)n[r[a].name]=r[a].length;return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getSequenceSize",value:(i=Z(J().mark((function e(t,n){var r;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.abrupt("return",null===(r=e.sent.name[t])||void 0===r?void 0:r.length);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"hasReferenceSequence",value:(o=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(n);case 2:return e.t0=t,e.abrupt("return",!!e.sent.name[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getResiduesById",value:(a=Z(J().mark((function e(t,n,r,a){var o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.id[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"getResiduesByName",value:(r=Z(J().mark((function e(t,n,r,a){var o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getIndexes(a);case 2:if(e.t0=t,o=e.sent.name[e.t0]){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",this._fetchFromIndexEntry(o,n,r,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,a){return r.apply(this,arguments)})},{key:"getSequence",value:(n=Z(J().mark((function e(t,n,r,a){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getResiduesByName(t,n,r,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"_fetchFromIndexEntry",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>3?l[3]:void 0,a=l.length>2?l[2]:void 0,!((n=l.length>1&&void 0!==l[1]?l[1]:0)<0)){e.next=6;break}throw new TypeError("regionStart cannot be less than 0");case 6:if((void 0===a||a>t.length)&&(a=t.length),!(n>=a)){e.next=9;break}return e.abrupt("return","");case 9:return o=us(t,n),i=us(t,a)-o,s=Zt.allocUnsafe(i),e.next=14,this.fasta.read(s,0,i,o,r);case 14:return e.abrupt("return",s.toString("utf8").replace(/\s+/g,""));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),hs=function(e){ne(n,e);var t=ue(n);function n(e){var r,a=e.fasta,o=e.path,i=e.fai,s=e.faiPath,l=e.gzi,c=e.gziPath;return X(this,n),r=t.call(this,{fasta:a,path:o,fai:i,faiPath:s}),a&&l?r.fasta=new cs({filehandle:a,gziFilehandle:l}):o&&c&&(r.fasta=new cs({path:o,gziPath:c})),r}return ee(n)}(ps);function ms(e){return e.split(">").filter((function(e){return/\S/.test(e)})).map((function(e){var t=pe(e.split("\n")),n=t[0],r=t.slice(1),a=pe(n.split(" ")),o=a[0],i=a.slice(1),s=r.join("").replace(/\s/g,"");return{id:o,description:i.join(" "),sequence:s}}))}var gs=function(){function e(t){var n=t.fasta,r=t.path;if(X(this,e),n)this.fasta=n;else{if(!r)throw new Error("Need to pass fasta or path");this.fasta=new zr(r)}this.data=this.fasta.readFile().then((function(e){return ms(e.toString("utf8"))}))}var t,n;return ee(e,[{key:"fetch",value:(n=Z(J().mark((function e(t,n,r){var a,o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:if(a=e.sent.find((function(e){return e.id===t})),o=r-n,a){e.next=7;break}throw new Error("no sequence with id ".concat(t," exists"));case 7:return e.abrupt("return",a.sequence.substr(n,o));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getSequenceNames",value:(t=Z(J().mark((function e(){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:return e.abrupt("return",e.sent.map((function(e){return e.id})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ys=L({__proto__:null,parseSmallFasta:ms,FetchableSmallFasta:gs,IndexedFasta:ps,BgzipIndexedFasta:hs}),vs=L(Jr);Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.AddAssemblyFromExternalChange=void 0;var bs=ys,_s=vs,ws=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","AddAssemblyFromExternalChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=de(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,externalLocation:r.externalLocation}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.assemblyModel,r=t.checkModel,a=t.refSeqModel,o=t.user,i=this.assembly,s=this.changes,l=this.logger,u=(c=Lt.env.CHUNK_SIZE)&&Number(c),f=_e(s),e.prev=5,f.s();case 7:if((d=f.n()).done){e.next=45;break}return m=(h=d.value).assemblyName,y=(g=h.externalLocation).fa,v=g.fai,_=(b=g.gzi)?new bs.BgzipIndexedFasta({fasta:new _s.RemoteFile(y,{fetch:fetch}),fai:new _s.RemoteFile(v,{fetch:fetch}),gzi:new _s.RemoteFile(b,{fetch:fetch})}):new bs.IndexedFasta({fasta:new _s.RemoteFile(y,{fetch:fetch}),fai:new _s.RemoteFile(v,{fetch:fetch})}),e.next=14,_.getSequenceSizes();case 14:if(w=e.sent){e.next=17;break}throw new Error("No data read from indexed fasta getSequenceSizes");case 17:return e.next=19,n.findOne({name:m}).exec();case 19:if(!e.sent){e.next=22;break}throw new Error('Assembly "'.concat(m,'" already exists'));case 22:return e.next=24,r.find({default:!0}).exec();case 24:return x=e.sent.map((function(e){return e._id.toHexString()})),e.next=28,n.create([{_id:i,name:m,user:o,status:-1,externalLocation:g,checks:x}]);case 28:S=de(e.sent,1),E=S[0],null===(p=l.debug)||void 0===p||p.call(l,'Added new assembly "'.concat(m,'", docId "').concat(E._id,'"')),e.t0=J().keys(w);case 33:if((e.t1=e.t0()).done){e.next=43;break}return k=e.t1.value,e.next=37,a.create([V(V({name:k,assembly:E._id,length:w[k]},u?{chunkSize:u}:null),{},{user:o,status:-1})]);case 37:C=de(e.sent,1),O=C[0],null===(A=l.debug)||void 0===A||A.call(l,'Added new refSeq "'.concat(k,'", docId "').concat(O._id,'"')),e.next=33;break;case 43:e.next=7;break;case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(5),f.e(e.t2);case 50:return e.prev=50,f.f(),e.finish(50);case 53:case"end":return e.stop()}}),e,this,[[5,47,50,53]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(ar.AssemblySpecificChange);Ur.AddAssemblyFromExternalChange=ws;var xs={};Object.defineProperty(xs,"__esModule",{value:!0}),xs.AddAssemblyFromFileChange=void 0;var Ss=ys,Es=function(e){ne(s,e);var t,n,r,a,o,i=ue(s);function s(e,t){var n;return X(this,s),te(ce(n=i.call(this,e,t)),"typeName","AddAssemblyFromFileChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(s,[{key:"notification",get:function(){return'Assembly "'.concat(this.changes[0].assemblyName,'" added successfully. To use it, please refresh the page.')}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.typeName;if(1===t.length){var r=de(t,1)[0];return{typeName:n,assembly:e,assemblyName:r.assemblyName,fileIds:r.fileIds}}return{typeName:n,assembly:e,changes:t}}},{key:"executeOnServer",value:(o=Z(J().mark((function e(t){var n,r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_e(this.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=11;break}return o=(a=r.value).assemblyName,i=a.fileIds,e.next=9,"gzi"in i?this.executeOnServerIndexed(t,o,i):this.executeOnServerFasta(t,o,i.fa);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return o.apply(this,arguments)})},{key:"executeOnServerIndexed",value:(a=Z(J().mark((function e(t,n,r){var a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O,T,N,R,I;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(i=Lt.env.CHUNK_SIZE)&&Number(i),Lt.env.FILE_UPLOAD_FOLDER){e.next=5;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 5:return l=r.fa,c=r.fai,u=r.gzi,f=t.assemblyModel,d=t.checkModel,p=t.fileModel,h=t.filesService,m=t.refSeqModel,g=t.user,e.next=9,p.findById(l);case 9:if(null==(y=e.sent)?void 0:y.checksum){e.next=13;break}throw new Error("No checksum for file document ".concat(null==y?void 0:y.id));case 13:return e.next=15,p.findById(c);case 15:if(null==(v=e.sent)?void 0:v.checksum){e.next=19;break}throw new Error("No checksum for file document ".concat(null==v?void 0:v.id));case 19:return e.next=21,p.findById(u);case 21:if(null==(b=e.sent)?void 0:b.checksum){e.next=25;break}throw new Error("No checksum for file document ".concat(null==b?void 0:b.id));case 25:return _=h.getFileHandle(y),w=h.getFileHandle(v),x=h.getFileHandle(b),S=new Ss.BgzipIndexedFasta({fasta:_,fai:w,gzi:x}),e.next=31,S.getSequenceSizes();case 31:return E=e.sent,e.next=34,Promise.all([_.close(),w.close(),x.close()]);case 34:return e.next=36,f.findOne({name:n}).exec();case 36:if(!e.sent){e.next=39;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 39:return e.next=41,d.find({default:!0}).exec();case 41:return k=e.sent.map((function(e){return e._id.toHexString()})),e.next=45,f.create([{_id:this.assembly,name:n,user:g,status:-1,fileIds:r,checks:k}]);case 45:A=de(e.sent,1),C=A[0],null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'Added new assembly "'.concat(n,'", docId "').concat(C._id,'"')),e.t0=J().keys(E);case 50:if((e.t1=e.t0()).done){e.next=60;break}return O=e.t1.value,e.next=54,m.create([V(V({name:O,assembly:C._id,length:E[O]},s?{chunkSize:s}:null),{},{user:g,status:-1})]);case 54:R=de(e.sent,1),I=R[0],null===(T=(N=this.logger).debug)||void 0===T||T.call(N,'Added new refSeq "'.concat(O,'", docId "').concat(I._id,'"')),e.next=50;break;case 60:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"executeOnServerFasta",value:(r=Z(J().mark((function e(t,n,r){var a,o,i,s,l,c,u,f,d,p,h,m,g,y;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.assemblyModel,f=t.checkModel,d=t.fileModel,p=t.user,e.next=3,d.findById(r).exec();case 3:if(h=e.sent){e.next=6;break}throw new Error('File "'.concat(r,'" not found in Mongo'));case 6:return null===(a=(o=this.logger).debug)||void 0===a||a.call(o,'FileId "'.concat(r,'", checksum "').concat(h.checksum,'"')),e.next=9,u.findOne({name:n}).exec();case 9:if(!e.sent){e.next=12;break}throw new Error('Assembly "'.concat(n,'" already exists'));case 12:return e.next=14,f.find({default:!0}).exec();case 14:return m=e.sent.map((function(e){return e._id.toHexString()})),e.next=18,u.create([{_id:this.assembly,name:n,user:p,status:-1,fileIds:{fa:r},checks:m}]);case 18:return g=de(e.sent,1),y=g[0],null===(i=(s=this.logger).debug)||void 0===i||i.call(s,'Added new assembly "'.concat(n,'", docId "').concat(y._id,'"')),null===(l=(c=this.logger).debug)||void 0===l||l.call(c,'File type: "'.concat(h.type,'", assemblyId: "').concat(y._id,'"')),e.next=25,this.addRefSeqIntoDb(h,y._id.toString(),t);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new s({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),s}(Cr.FromFileBaseChange);xs.AddAssemblyFromFileChange=Es;var ks={},As={};Object.defineProperty(As,"__esModule",{value:!0}),As.DeleteFeatureChange=void 0,As.findAndDeleteChildFeature=Ts,As.isDeleteFeatureChange=function(e){return"DeleteFeatureChange"===e.typeName};var Cs=ks,Os=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","DeleteFeatureChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return"Feature deleted successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,deletedFeature:a.deletedFeature,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l=this;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=_e(this.changes),e.prev=3,s=J().mark((function e(){var t,o,s,c,u,f,d,p,h;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(o=i.value).deletedFeature,c=o.parentFeatureId,e.next=4,n.findOne({allIds:s._id}).session(r).exec();case 4:if(u=e.sent){e.next=9;break}throw f="*** ERROR: The following featureId was not found in database ='".concat(s._id,"'"),a.error(f),new Error(f);case 9:if(!u._id.equals(s._id)){e.next=16;break}if(!c){e.next=12;break}throw new Error('Feature "'.concat(s._id,'" is top-level, but received a parent feature ID'));case 12:return e.next=14,n.findByIdAndDelete(u._id);case 14:return null===(d=a.debug)||void 0===d||d.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'". Whole document deleted.')),e.abrupt("return",1);case 16:return(p=Ts(u,s._id,l)).push(s._id),u.allIds=u.allIds.filter((function(e){return!p.includes(e)})),u.markModified("children"),e.prev=20,e.next=23,u.save();case 23:e.next=29;break;case 25:throw e.prev=25,e.t0=e.catch(20),null===(h=a.debug)||void 0===h||h.call(a,"*** FAILED: ".concat(e.t0)),e.t0;case 29:null===(t=a.debug)||void 0===t||t.call(a,'Feature "'.concat(s._id,'" deleted from document "').concat(u._id,'"'));case 30:case"end":return e.stop()}}),e,null,[[20,25]])})),o.s();case 6:if((i=o.n()).done){e.next=12;break}return e.delegateYield(s(),"t0",8);case 8:if(!e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(3),o.e(e.t1);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=18;break}if(o=(a=r.value).deletedFeature,!(i=a.parentFeatureId)){e.next=15;break}if(s=t.getFeature(i)){e.next=12;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 12:s.deleteChild(o._id),e.next=16;break;case 15:t.getFeature(o._id)&&t.deleteFeature(o._id);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=he(this.changedIds).reverse(),o=he(n).reverse().map((function(e){return{addedFeature:e.deletedFeature,parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new Cs.AddFeatureChange({changedIds:a,typeName:"AddFeatureChange",changes:o,assembly:t},{logger:r})}}]),o}(ar.FeatureChange);function Ts(e,t,n){if(!e.children)throw new Error("Feature ".concat(e._id," has no children"));var r=e._id,a=e.children,o=a.get(t);if(o){var i=n.getChildFeatureIds(o);return a.delete(t),i}var s,l=_e(a);try{for(l.s();!(s=l.n()).done;){var c=de(s.value,2)[1];try{return Ts(c,t,n)}catch(e){}}}catch(e){l.e(e)}finally{l.f()}throw new Error('Feature "'.concat(t,'" not found in ').concat(r))}As.DeleteFeatureChange=Os,Object.defineProperty(ks,"__esModule",{value:!0}),ks.AddFeatureChange=void 0,ks.isAddFeatureChange=function(e){return"AddFeatureChange"===e.typeName};var Ns=As,Rs=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","AddFeatureChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return"Feature added successfully"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,addedFeature:a.addedFeature,parentFeatureId:a.parentFeatureId,copyFeature:a.copyFeature,allIds:a.allIds}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O,T,N,R,I,P,F,M;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.assemblyModel,o=t.featureModel,i=t.refSeqModel,s=t.session,l=t.user,c=this.assembly,u=this.changes,f=this.logger,e.next=4,a.findById(c).session(s).exec();case 4:if(e.sent){e.next=9;break}throw d='*** ERROR: Assembly with id "'.concat(c,'" not found'),f.error(d),new Error(d);case 9:p=0,null===(n=f.debug)||void 0===n||n.call(f,"changes: ".concat(JSON.stringify(u))),h=_e(u),e.prev=12,h.s();case 14:if((m=h.n()).done){e.next=61;break}return y=m.value,null===(g=f.debug)||void 0===g||g.call(f,"change: ".concat(JSON.stringify(y))),b=y.allIds,_=y.copyFeature,w=y.parentFeatureId,x=(v=y.addedFeature)._id,S=v.refSeq,e.next=21,i.findById(S).session(s).exec();case 21:if(e.sent){e.next=24;break}throw new Error('RefSeq was not found by assembly "'.concat(c,'" and seq_id "').concat(S,'" not found'));case 24:if(!_){e.next=34;break}return e.next=27,o.create([V(V({},v),{},{allIds:b,status:-1,user:l})],{session:s});case 27:k=de(e.sent,1),A=k[0],null===(E=f.debug)||void 0===E||E.call(f,'Copied feature, docId "'.concat(A._id,'" to assembly "').concat(c,'"')),p++,e.next=58;break;case 34:if(!w){e.next=50;break}return e.next=37,o.findOne({allIds:w}).session(s).exec();case 37:if(O=e.sent){e.next=40;break}throw new Error('Could not find feature with ID "'.concat(w,'"'));case 40:if(T=this.getFeatureFromId(O,w)){e.next=43;break}throw new Error('Could not find feature with ID "'.concat(w,'" in feature "').concat(O._id,'"'));case 43:return this.addChild(T,v),N=this.getChildFeatureIds(v),(C=O.allIds).push.apply(C,[x].concat(he(N))),e.next=48,O.save();case 48:e.next=58;break;case 50:return I=this.getChildFeatureIds(v),P=[x].concat(he(I)),e.next=54,o.create([V({allIds:P,status:0},v)],{session:s});case 54:F=de(e.sent,1),M=F[0],null===(R=f.verbose)||void 0===R||R.call(f,'Added docId "'.concat(M._id,'"'));case 58:p++;case 59:e.next=14;break;case 61:e.next=66;break;case 63:e.prev=63,e.t0=e.catch(12),h.e(e.t0);case 66:return e.prev=66,h.f(),e.finish(66);case 69:null===(r=f.debug)||void 0===r||r.call(f,"Added ".concat(p," new feature(s) into database."));case 70:case"end":return e.stop()}}),e,this,[[12,63,66,69]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=this.assembly,r=_e(this.changes),e.prev=4,r.s();case 6:if((a=r.n()).done){e.next=20;break}if(i=(o=a.value).addedFeature,!(s=o.parentFeatureId)){e.next=17;break}if(l=t.getFeature(s)){e.next=13;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 13:l.attributes.get("_id")||l.setAttribute("_id",[l._id]),l.addChild(i),e.next=18;break;case 17:t.addFeature(n,i);case 18:e.next=6;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(4),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[4,22,25,28]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=he(this.changedIds).reverse(),a=he(t).reverse().map((function(e){return{deletedFeature:e.addedFeature,parentFeatureId:e.parentFeatureId}}));return new Ns.DeleteFeatureChange({changedIds:r,typeName:"DeleteFeatureChange",changes:a,assembly:e},{logger:n})}}]),o}(ar.FeatureChange);ks.AddFeatureChange=Rs;var Is={};Object.defineProperty(Is,"__esModule",{value:!0}),Is.AddFeaturesFromFileChange=void 0;var Ps=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n,r;return X(this,o),te(ce(r=a.call(this,e,t)),"typeName","AddFeaturesFromFileChange"),te(ce(r),"changes",void 0),te(ce(r),"deleteExistingFeatures",!1),r.deleteExistingFeatures=null!==(n=e.deleteExistingFeatures)&&void 0!==n&&n,r.changes="changes"in e?e.changes:[e],r}return ee(o,[{key:"notification",get:function(){return"Features have been added. To see them, please refresh the page."}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changes,n=this.deleteExistingFeatures,r=this.typeName;return 1===t.length?{typeName:r,assembly:e,fileId:de(t,1)[0].fileId,deleteExistingFeatures:n}:{typeName:r,assembly:e,changes:t,deleteExistingFeatures:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.fileModel,a=t.filesService,o=this.changes,i=this.logger,!this.deleteExistingFeatures){e.next=5;break}return e.next=5,this.removeExistingFeatures(t);case 5:s=_e(o),e.prev=6,s.s();case 8:if((l=s.n()).done){e.next=56;break}if(u=l.value.fileId,Lt.env.FILE_UPLOAD_FOLDER){e.next=14;break}throw new Error("No FILE_UPLOAD_FOLDER found in .env file");case 14:return e.next=16,r.findById(u).exec();case 16:if(f=e.sent){e.next=19;break}throw new Error('File "'.concat(u,'" not found in Mongo'));case 19:null===(c=i.debug)||void 0===c||c.call(i,'FileId "'.concat(u,'", checksum "').concat(f.checksum,'"')),d=a.parseGFF3(a.getFileStream(f)),p=0,h=!1,m=!1,e.prev=24,y=G(d);case 26:return e.next=28,y.next();case 28:if(!(h=!(v=e.sent).done)){e.next=38;break}return b=v.value,e.next=33,this.addFeatureIntoDb(b,t);case 33:++p%1e3==0&&(null===(_=i.debug)||void 0===_||_.call(i,"Processed ".concat(p," features")));case 35:h=!1,e.next=26;break;case 38:e.next=44;break;case 40:e.prev=40,e.t0=e.catch(24),m=!0,g=e.t0;case 44:if(e.prev=44,e.prev=45,!h||null==y.return){e.next=49;break}return e.next=49,y.return();case 49:if(e.prev=49,!m){e.next=52;break}throw g;case 52:return e.finish(49);case 53:return e.finish(44);case 54:e.next=8;break;case 56:e.next=61;break;case 58:e.prev=58,e.t1=e.catch(6),s.e(e.t1);case 61:return e.prev=61,s.f(),e.finish(61);case 64:null===(n=i.debug)||void 0===n||n.call(i,"New features added into database!");case 65:case"end":return e.stop()}}),e,this,[[6,58,61,64],[24,40,44,54],[45,,49,53]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,assembly:this.assembly},{logger:this.logger})}}]),o}(Cr.FromFileBaseChange);Is.AddFeaturesFromFileChange=Ps;var Fs={};Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.AddRefSeqAliasesChange=void 0;var Ms=C.default,js=function(e){ne(r,e);var t,n=ue(r);function r(e,t){var a;return X(this,r),te(ce(a=n.call(this,e,t)),"typeName","AddRefSeqAliasesChange"),te(ce(a),"refSeqAliases",void 0),a.refSeqAliases=e.refSeqAliases,a}return ee(r,[{key:"executeOnClient",value:function(e){var t=(0,Ms.getSession)(e).assemblyManager.get(this.assembly);if(!t)throw new Error("assembly ".concat(this.assembly," not found"));var n=t.refNameAliases,r=t.lowerCaseRefNameAliases;if(!n||!r)throw new Error("Session refNameAliases not found in assembly");var a,o=_e(this.refSeqAliases);try{for(o.s();!(a=o.n()).done;){var i,s=a.value,l=s.refName,c=_e(s.aliases);try{for(c.s();!(i=c.n()).done;){var u=i.value;n[u]=l,r[u.toLowerCase()]=l}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}return t.setRefNameAliases(n,r),Promise.resolve()}},{key:"getInverse",value:function(){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{assembly:this.assembly,typeName:this.typeName,refSeqAliases:this.refSeqAliases}}},{key:"executeOnServer",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.refSeqModel,r=t.session,a=this.assembly,o=this.logger,i=_e(this.refSeqAliases),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=13;break}return c=s.value,null===(l=o.debug)||void 0===l||l.call(o,"Updating Refname alias for assembly: ".concat(a,", refSeqAlias: ").concat(JSON.stringify(c))),u=c.aliases,f=c.refName,e.next=11,n.updateOne({assembly:a,name:f},{$set:{aliases:u}}).session(r);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:function(e){throw new Error("Method not implemented.")}},{key:"notification",get:function(){return"RefSeq aliases have been added."}}]),r}(ar.AssemblySpecificChange);Fs.AddRefSeqAliasesChange=js;var Ds={};Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.DeleteAssemblyChange=void 0;var Ls=C.default,qs=function(e){ne(o,e);var t,n,r,a=ue(o);function o(){var e;X(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return te(ce(e=a.call.apply(a,[this].concat(n))),"typeName","DeleteAssemblyChange"),e}return ee(o,[{key:"notification",get:function(){return'Assembly "'.concat(this.assembly,'" deleted successfully.')}},{key:"toJSON",value:function(){return{typeName:this.typeName,assembly:this.assembly}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.assemblyModel,a=t.featureModel,o=t.refSeqChunkModel,i=t.refSeqModel,s=t.session,l=this.assembly,c=this.logger,e.next=4,r.findById(l).session(s).exec();case 4:if(e.sent){e.next=9;break}throw u='*** ERROR: Assembly with id "'.concat(l,'" not found'),c.error(u),new Error(u);case 9:return e.next=11,i.find({assembly:l}).exec();case 11:return f=e.sent.map((function(e){return e._id})),e.next=15,o.deleteMany({refSeq:f}).exec();case 15:return e.next=17,a.deleteMany({refSeq:f}).exec();case 17:return e.next=19,i.deleteMany({assembly:l}).exec();case 19:return e.next=21,r.findByIdAndDelete(l).exec();case 21:null===(n=c.debug)||void 0===n||n.call(c,'Assembly "'.concat(l,'" deleted from database.'));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.assembly,t){e.next=3;break}throw new Error("No data store");case 3:return o=(0,Ls.getSession)(t),t.assemblies.has(a)&&t.deleteAssembly(a),e.next=7,null===(n=o.removeAssembly)||void 0===n?void 0:n.call(o,a);case 7:return e.next=9,null===(r=o.removeSessionAssembly)||void 0===r?void 0:r.call(o,a);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"DeleteAssemblyChange",assembly:this.assembly},{logger:this.logger})}}]),o}(ar.AssemblySpecificChange);Ds.DeleteAssemblyChange=qs;var Bs={};Object.defineProperty(Bs,"__esModule",{value:!0}),Bs.DeleteUserChange=void 0;var Us=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","DeleteUserChange"),te(ce(n),"changes",void 0),te(ce(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return ee(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,userId:this.userId}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.userModel,a=this.logger,o=this.userId,e.next=4,r.findOneAndDelete({_id:o}).session(n).exec();case 4:if(e.sent){e.next=9;break}throw i='*** ERROR: User with id "'.concat(o,'" not found'),a.error(i),new Error(i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,userId:this.userId},{logger:this.logger})}}]),o}(ar.Change);Bs.DeleteUserChange=Us;var zs={};Object.defineProperty(zs,"__esModule",{value:!0}),zs.FeatureAttributeChange=void 0,zs.isFeatureAttributeChange=function(e){return"FeatureAttributeChange"===e.typeName};var Gs=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","FeatureAttributeChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldAttributes:a.oldAttributes,newAttributes:a.newAttributes}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=_e(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=26;break}return f=l.value.featureId,e.next=11,n.findOne({allIds:f}).session(r).exec();case 11:if(d=e.sent){e.next=16;break}throw p="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),o.error(p),new Error(p);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(d))),h=this.getFeatureFromId(d,f)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(h))),i.push({feature:h,topLevelFeature:d});case 24:e.next=6;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(4),s.e(e.t0);case 31:return e.prev=31,s.f(),e.finish(31);case 34:m=_e(a.entries()),e.prev=35,m.s();case 37:if((g=m.n()).done){e.next=55;break}return v=de(g.value,2),w=(b=i[v[0]]).topLevelFeature,(_=b.feature).attributes=v[1].newAttributes,w._id.equals(_._id)?w.markModified("attributes"):w.markModified("children"),e.prev=43,e.next=46,w.save();case 46:e.next=52;break;case 48:throw e.prev=48,e.t1=e.catch(43),null===(x=o.debug)||void 0===x||x.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 52:null===(y=o.debug)||void 0===y||y.call(o,"*** Feature attributes modified (added, edited or deleted), docId: ".concat(JSON.stringify(w)));case 53:e.next=37;break;case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(35),m.e(e.t2);case 60:return e.prev=60,m.f(),e.finish(60);case 63:case"end":return e.stop()}}),e,this,[[4,28,31,34],[35,57,60,63],[43,48]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("applyToLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=de(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setAttributes(new Map(Object.entries(this.changes[o].newAttributes)));case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger;return new o({changedIds:he(this.changedIds).reverse(),typeName:"FeatureAttributeChange",changes:he(t).reverse().map((function(e){return{featureId:e.featureId,oldAttributes:e.newAttributes,newAttributes:e.oldAttributes}})),assembly:e},{logger:n})}}]),o}(ar.FeatureChange);zs.FeatureAttributeChange=Gs;var Hs={},$s=["__v","_id","assemblies","configuration","internetAccounts","plugins","tracks"],Ws=["hasRole"];function Vs(e){var t,n=e.assemblies,r=e.configuration,a=e.internetAccounts,o=e.plugins,i=e.tracks,s=le(e,$s);if(n&&(s.assemblies=n.filter((function(e){return"ApolloSequenceAdapter"!==e.sequence.adapter.type}))),null!=r&&null!==(t=r.ApolloPlugin)&&void 0!==t&&t.hasRole){var l=le(r.ApolloPlugin,Ws);s.configuration=V(V({},r),{},{ApolloPlugin:l})}return a&&(s.internetAccounts=a.filter((function(e){return"ApolloInternetAccount"!==e.type}))),o&&(s.plugins=o.filter((function(e){return"Apollo"!==e.name}))),i&&(s.trackss=i.filter((function(e){return"ApolloTrack"!==e.type}))),s}Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.ImportJBrowseConfigChange=void 0,Hs.filterJBrowseConfig=Vs;var Js=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","ImportJBrowseConfigChange"),te(ce(n),"oldJBrowseConfig",void 0),te(ce(n),"newJBrowseConfig",void 0),n.oldJBrowseConfig=e.oldJBrowseConfig,n.newJBrowseConfig=e.newJBrowseConfig,n}return ee(o,[{key:"toJSON",value:function(){return{typeName:this.typeName,oldJBrowseConfig:this.oldJBrowseConfig,newJBrowseConfig:this.newJBrowseConfig}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.jbrowseConfigModel,a=this.logger,o=this.newJBrowseConfig,e.next=4,r.deleteMany();case 4:if(o){e.next=6;break}return e.abrupt("return");case 6:return i=Vs(o),e.next=9,r.create(i);case 9:null===(n=a.debug)||void 0===n||n.call(a,"Stored new JBrowse Config");case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:this.newJBrowseConfig,newJBrowseConfig:this.oldJBrowseConfig},{logger:this.logger})}}]),o}(ar.Change);Hs.ImportJBrowseConfigChange=Js;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0}),Ys.LocationEndChange=void 0,Ys.isLocationEndChange=function(e){return"LocationEndChange"===e.typeName};var Ks=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","LocationEndChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldEnd:a.oldEnd,newEnd:a.newEnd}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=_e(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}f=(u=s.value).featureId,d=u.oldEnd,p=u.newEnd,h=void 0,m=void 0,g=_e(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,f))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:f}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,f)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.max===d){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.max=p,h._id.equals(m._id)?h.markModified("end"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newEnd,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMax(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:he(this.changedIds).reverse(),typeName:r,changes:he(t).reverse().map((function(e){return{featureId:e.featureId,oldEnd:e.newEnd,newEnd:e.oldEnd}})),assembly:e},{logger:n})}}]),o}(ar.FeatureChange);Ys.LocationEndChange=Ks;var Zs={};Object.defineProperty(Zs,"__esModule",{value:!0}),Zs.LocationStartChange=void 0,Zs.isLocationStartChange=function(e){return"LocationStartChange"===e.typeName};var Xs=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","LocationStartChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStart:a.oldStart,newStart:a.newStart}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=[],i=_e(this.changes),e.prev=4,i.s();case 6:if((s=i.n()).done){e.next=55;break}f=(u=s.value).featureId,d=u.oldStart,p=u.newStart,h=void 0,m=void 0,g=_e(o),e.prev=12,g.s();case 14:if((y=g.n()).done){e.next=23;break}if(!(b=this.getFeatureFromId(v=y.value,f))){e.next=21;break}return h=v,m=b,e.abrupt("break",23);case 21:e.next=14;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),g.e(e.t0);case 28:return e.prev=28,g.f(),e.finish(28);case 31:if(h){e.next=36;break}return e.next=34,n.findOne({allIds:f}).session(r).exec();case 34:(h=e.sent)&&o.push(h);case 36:if(h){e.next=40;break}throw _="*** ERROR: The following featureId was not found in database ='".concat(f,"'"),a.error(_),new Error(_);case 40:if(null===(l=a.debug)||void 0===l||l.call(a,"*** TOP level feature found: ".concat(JSON.stringify(h))),m||(m=this.getFeatureFromId(h,f)),m){e.next=46;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 46:if(null===(c=a.debug)||void 0===c||c.call(a,"*** Found feature: ".concat(JSON.stringify(m))),m.min===d){e.next=51;break}throw a.error("Expected previous max does not match"),new Error("Expected previous max does not match");case 51:m.min=p,h._id.equals(m._id)?h.markModified("start"):h.markModified("children");case 53:e.next=6;break;case 55:e.next=60;break;case 57:e.prev=57,e.t1=e.catch(4),i.e(e.t1);case 60:return e.prev=60,i.f(),e.finish(60);case 63:w=0,x=o;case 64:if(!(w<x.length)){e.next=78;break}return S=x[w],e.prev=66,e.next=69,S.save();case 69:e.next=75;break;case 71:throw e.prev=71,e.t2=e.catch(66),null===(E=a.debug)||void 0===E||E.call(a,"*** FAILED: ".concat(e.t2)),e.t2;case 75:w++,e.next=64;break;case 78:case"end":return e.stop()}}),e,this,[[4,57,60,63],[12,25,28,31],[66,71]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=14;break}if(i=(a=r.value).newStart,s=t.getFeature(o=a.featureId)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(o,'"'));case 11:s.setMin(i);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:he(this.changedIds).reverse(),typeName:r,changes:he(t).reverse().map((function(e){return{featureId:e.featureId,oldStart:e.newStart,newStart:e.oldStart}})),assembly:e},{logger:n})}}]),o}(ar.FeatureChange);Zs.LocationStartChange=Xs;var Qs={},el={};Object.defineProperty(el,"__esModule",{value:!0}),el.UndoMergeExonsChange=void 0;var tl=Qs,nl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","UndoMergeExonsChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonsToRestore:a.exonsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=_e(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.exonsToRestore).length){e.next=10;break}throw new Error("Expected exactly two exons to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),f=_e(s);try{for(f.s();!(d=f.n()).done;)this.addChild(u,h=d.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(he(m)))}catch(e){f.e(e)}finally{f.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).exonsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=_e(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=he(this.changedIds).reverse(),a=he(t).reverse().map((function(e){return{firstExon:e.exonsToRestore[0],secondExon:e.exonsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new tl.MergeExonsChange({changedIds:r,typeName:"MergeExonsChange",changes:a,assembly:e},{logger:n})}}]),o}(ar.FeatureChange);el.UndoMergeExonsChange=nl,Object.defineProperty(Qs,"__esModule",{value:!0}),Qs.MergeExonsChange=void 0;var rl=As,al=el,ol=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","MergeExonsChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return"Exons successfully merged"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstExon:a.firstExon,secondExon:a.secondExon,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l=this;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=_e(this.changes),e.prev=3,s=J().mark((function e(){var t,o,s,c,u,f,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstExon,s=t.secondExon,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(f=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return f.min=Math.min(o.min,s.min),f.max=Math.max(o.max,s.max),f.attributes=l.mergeAttributes(o,s),(d=(0,rl.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!d.includes(e)})),e.next=22,c.save();case 22:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=19;break}if(s=(o=r.value).secondExon,l=t.getFeature((i=o.firstExon)._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(i._id,'"'));case 11:for(l.setMin(Math.min(i.min,s.min)),l.setMax(Math.max(i.max,s.max)),c=this.mergeAttributes(i,s),l.setAttributes(new Map),u=0,f=Object.keys(c);u<f.length;u++)l.setAttribute(d=f[u],c[d]);null===(a=l.parent)||void 0===a||a.deleteChild(s._id);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=he(this.changedIds).reverse(),o=he(n).reverse().map((function(e){return{exonsToRestore:[e.firstExon,e.secondExon],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new al.UndoMergeExonsChange({changedIds:a,typeName:"UndoMergeExonsChange",changes:o,assembly:t},{logger:r})}},{key:"mergeAttributes",value:function(e,t){var n={};if(e.attributes&&(n=JSON.parse(JSON.stringify(e.attributes))),t.attributes)for(var r=JSON.parse(JSON.stringify(t.attributes)),a=function(){var e=i[o];if("_id"===e||"gff_id"===e)return 1;Object.keys(n).includes(e)||(n[e]=[]),r[e].map((function(t){n[e].includes(t)||n[e].push(t)}))},o=0,i=Object.keys(r);o<i.length;o++)a();return n}}]),o}(ar.FeatureChange);Qs.MergeExonsChange=ol;var il={},sl={};Object.defineProperty(sl,"__esModule",{value:!0}),sl.UndoMergeTranscriptsChange=void 0;var ll=il,cl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","UndoMergeTranscriptsChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,transcriptsToRestore:a.transcriptsToRestore,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=_e(this.changes),e.prev=3,a.s();case 5:if((o=a.n()).done){e.next=25;break}if(l=(i=o.value).parentFeatureId,2===(s=i.transcriptsToRestore).length){e.next=10;break}throw new Error("Expected exactly two transcripts to restore. Got :".concat(s.length));case 10:return e.next=12,n.findOne({allIds:l}).session(r).exec();case 12:if(c=e.sent){e.next=15;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 15:if(u=this.getFeatureFromId(c,l)){e.next=18;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(c._id.toString(),'"'));case 18:u.children||(u.children=new Map),f=_e(s);try{for(f.s();!(d=f.n()).done;)this.addChild(u,h=d.value),m=this.getChildFeatureIds(h),(p=c.allIds).push.apply(p,[h._id].concat(he(m)))}catch(e){f.e(e)}finally{f.f()}return e.next=23,c.save();case 23:e.next=5;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),a.e(e.t0);case 30:return e.prev=30,a.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[3,27,30,33]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=19;break}if(o=(a=r.value).transcriptsToRestore,i=a.parentFeatureId){e.next=11;break}throw new Error("Parent ID is missing");case 11:if(s=t.getFeature(i)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(i,'"'));case 14:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),l=_e(o);try{for(l.s();!(c=l.n()).done;)s.addChild(c.value)}catch(e){l.e(e)}finally{l.f()}case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[4,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=he(this.changedIds).reverse(),a=he(t).reverse().map((function(e){return{firstTranscript:e.transcriptsToRestore[0],secondTranscript:e.transcriptsToRestore[1],parentFeatureId:e.parentFeatureId}}));return new ll.MergeTranscriptsChange({changedIds:r,typeName:"MergeTranscriptsChange",changes:a,assembly:e},{logger:n})}}]),o}(ar.FeatureChange);sl.UndoMergeTranscriptsChange=cl,Object.defineProperty(il,"__esModule",{value:!0}),il.MergeTranscriptsChange=void 0;var ul=C.default,fl=As,dl=sl,pl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","MergeTranscriptsChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,firstTranscript:a.firstTranscript,secondTranscript:a.secondTranscript,parentFeatureId:a.parentFeatureId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l=this;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=_e(this.changes),e.prev=3,s=J().mark((function e(){var t,o,s,c,u,f,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).firstTranscript,s=t.secondTranscript,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(c=e.sent){e.next=9;break}throw u="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(u),new Error(u);case 9:if(f=l.getFeatureFromId(c,o._id)){e.next=14;break}throw a.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 14:return l.mergeTranscriptsOnServer(f,s),(d=(0,fl.findAndDeleteChildFeature)(c,s._id,l)).push(s._id),c.allIds=c.allIds.filter((function(e){return!d.includes(e)})),e.next=20,c.save();case 20:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"mergeTranscriptsOnServer",value:function(e,t){if(e.min=Math.min(e.min,t.min),e.max=Math.max(e.max,t.max),this.mergeTranscriptAttributes(e,t),t.children)for(var n=0,r=Object.entries(t.children);n<r.length;n++){var a=de(r[n],2);this.mergeFeatureIntoTranscriptOnServer(a[1],e)}}},{key:"mergeFeatureIntoTranscriptOnServer",value:function(e,t){var n=this;t.children||(t.children=new Map);var r,a,o=!1,i=_e(t.children);try{for(i.s();!(a=i.n()).done;){var s=de(a.value,2),l=s[0],c=s[1];if(o&&r||(r=c),r.type===e.type&&r.type===c.type&&(0,ul.doesIntersect2)(e.min,e.max,r.min,r.max)&&(0,ul.doesIntersect2)(c.min,c.max,r.min,r.max)){r.min=Math.min(e.min,r.min,c.min),r.max=Math.max(e.max,r.max,c.max);var u=this.mergeAttributes(r,e);r.attributes=u,t.children.delete(l),o=!0}}}catch(e){i.e(e)}finally{i.f()}o&&r&&e.children&&Object.entries(e.children).map((function(e){var t=de(e,2);n.addChild(r,t[1])})),this.addChild(t,o&&r?r:e)}},{key:"executeOnClient",value:(n=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=15;break}if(o=de(r.value,2),i=o[1],l=(s=this.changes[o[0]]).secondTranscript,c=t.getFeature(s.firstTranscript._id)){e.next=11;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 11:this.mergeTranscriptsOnClient(c,l),null===(a=c.parent)||void 0===a||a.deleteChild(l._id);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"mergeTranscriptsOnClient",value:function(e,t){if(e.setMin(Math.min(e.min,t.min)),e.setMax(Math.max(e.max,t.max)),this.mergeTranscriptAttributes(e,t),t.children)for(var n=0,r=Object.entries(t.children);n<r.length;n++){var a=de(r[n],2);this.mergeFeatureIntoTranscriptOnClient(a[1],e)}}},{key:"mergeFeatureIntoTranscriptOnClient",value:function(e,t){t.children||(t.children=new Map);var n,r,a,o=!1,i=_e(t.children);try{for(i.s();!(a=i.n()).done;){var s=de(a.value,2)[1];if(o&&n?r=!0:(r=!1,n=s),n.type===e.type&&n.type===s.type&&(0,ul.doesIntersect2)(e.min,e.max,n.min,n.max)&&(0,ul.doesIntersect2)(s.min,s.max,n.min,n.max)){n.setMin(Math.min(e.min,n.min,s.min)),n.setMax(Math.max(e.max,n.max,s.max));var l=this.mergeAttributes(n,e);Object.entries(l).map((function(e){var t=de(e,2);n&&n.setAttribute(t[0],t[1])})),r&&t.deleteChild(s._id),o=!0}}}catch(e){i.e(e)}finally{i.f()}o&&n&&e.children&&Object.entries(e.children).map((function(e){var t=de(e,2);n.addChild(t[1])})),o&&n||t.addChild(e)}},{key:"isAnnotationFeature",value:function(e){return"function"==typeof e.setMin&&"function"==typeof e.setMax&&"function"==typeof e.addChild&&"function"==typeof e.deleteChild}},{key:"executeOnLocalGFF3",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"mergeAttributes",value:function(e,t){var n=e.attributes?JSON.parse(JSON.stringify(e.attributes)):{};if(t.attributes){var r=JSON.parse(JSON.stringify(t.attributes));Object.entries(r).map((function(e){var t=de(e,2),r=t[0],a=t[1];r in n||(n[r]=[]),a.map((function(e){n[r].includes(e)||n[r].push(e)}))}))}return n}},{key:"mergeTranscriptAttributes",value:function(e,t){var n=this.mergeAttributes(e,t);this.isAnnotationFeature(e)?Object.entries(n).map((function(t){var n=de(t,2);e.setAttribute(n[0],n[1])})):e.attributes=n}},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=he(this.changedIds).reverse(),o=he(n).reverse().map((function(e){return{transcriptsToRestore:[e.firstTranscript,e.secondTranscript],parentFeatureId:e.parentFeatureId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new dl.UndoMergeTranscriptsChange({changedIds:a,typeName:"UndoMergeTranscriptsChange",changes:o,assembly:t},{logger:r})}}]),o}(ar.FeatureChange);il.MergeTranscriptsChange=pl;var hl={},ml={};Object.defineProperty(ml,"__esModule",{value:!0}),ml.UndoSplitExonChange=void 0;var gl=As,yl=hl,vl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","UndoSplitExonChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToRestore:a.exonToRestore,parentFeatureId:a.parentFeatureId,idsToDelete:a.idsToDelete,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s=this;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=_e(this.changes),e.prev=3,i=J().mark((function e(){var t,a,i,l,c,u,f,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(a=o.value).exonToRestore,l=a.parentFeatureId,c=a.idsToDelete,e.next=4,n.findOne({allIds:l}).session(r).exec();case 4:if(u=e.sent){e.next=7;break}throw new Error('Could not find feature with ID "'.concat(l,'"'));case 7:if(f=s.getFeatureFromId(u,l)){e.next=10;break}throw new Error('Could not find feature with ID "'.concat(l,'" in feature "').concat(u._id.toString(),'"'));case 10:return f.children||(f.children=new Map),s.addChild(f,i),d=s.getChildFeatureIds(i),(t=u.allIds).push.apply(t,[i._id].concat(he(d))),u.allIds=u.allIds.filter((function(e){return!c.includes(e)})),c.map((function(e){return(0,gl.findAndDeleteChildFeature)(u,e,s)})),e.next=18,u.save();case 18:case"end":return e.stop()}}),e)})),a.s();case 6:if((o=a.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),a.e(e.t1);case 15:return e.prev=15,a.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changes),e.prev=4,a=J().mark((function e(){var n,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(n=r.value).exonToRestore,i=n.idsToDelete,o=n.parentFeatureId){e.next=4;break}throw new Error("Parent ID is missing");case 4:if(s=t.getFeature(o)){e.next=7;break}throw new Error('Could not find parent feature "'.concat(o,'"'));case 7:s.attributes.get("_id")||s.setAttribute("_id",[s._id]),s.addChild(a),i.map((function(e){s.deleteChild(e)}));case 10:case"end":return e.stop()}}),e)})),n.s();case 7:if((r=n.n()).done){e.next=11;break}return e.delegateYield(a(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),n.e(e.t1);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[4,13,16,19]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=he(this.changedIds).reverse(),a=he(t).reverse().map((function(e){return{parentFeatureId:e.parentFeatureId,exonToBeSplit:e.exonToRestore,upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return new yl.SplitExonChange({changedIds:r,typeName:"SplitExonChange",changes:a,assembly:e},{logger:n})}}]),o}(ar.FeatureChange);ml.UndoSplitExonChange=vl,Object.defineProperty(hl,"__esModule",{value:!0}),hl.SplitExonChange=void 0;var bl=As,_l=ml,wl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","SplitExonChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"notification",get:function(){return"Exon successfully split"}},{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,exonToBeSplit:a.exonToBeSplit,parentFeatureId:a.parentFeatureId,upstreamCut:a.upstreamCut,downstreamCut:a.downstreamCut,leftExonId:a.leftExonId,rightExonId:a.rightExonId}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l=this;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,a=this.logger,o=_e(this.changes),e.prev=3,s=J().mark((function e(){var t,o,s,c,u,f,d,p,h,m,g,y,v,b,_;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(t=i.value).exonToBeSplit,s=t.parentFeatureId,c=t.upstreamCut,u=t.downstreamCut,f=t.leftExonId,d=t.rightExonId,e.next=4,n.findOne({allIds:o._id}).session(r).exec();case 4:if(p=e.sent){e.next=9;break}throw h="*** ERROR: The following featureId was not found in database ='".concat(o._id,"'"),a.error(h),new Error(h);case 9:if(null!=(m=l.getFeatureFromId(p,s))&&m.children){e.next=12;break}throw new Error("ERROR: There should be at least one child (i.e. the exon to be split)");case 12:return g=l.makeSplitExons(o,c,u,f,d),y=de(g,2),b=y[1],m.children.set((v=y[0])._id,V(V({allIds:[]},v),{},{_id:v._id})),m.children.set(b._id,V(V({allIds:[]},b),{},{_id:b._id})),m.children=new Map(he(m.children.entries()).sort((function(e,t){return e[1].min-t[1].min}))),(_=(0,bl.findAndDeleteChildFeature)(p,o._id,l)).push(o._id),p.allIds=p.allIds.filter((function(e){return!_.includes(e)})),p.allIds.push(v._id,b._id),e.next=22,p.save();case 22:case"end":return e.stop()}}),e)})),o.s();case 6:if((i=o.n()).done){e.next=10;break}return e.delegateYield(s(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),o.e(e.t1);case 15:return e.prev=15,o.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=19;break}if(a=de(r.value,1),i=(o=this.changes[a[0]]).exonToBeSplit,l=o.upstreamCut,c=o.downstreamCut,u=o.leftExonId,f=o.rightExonId,s=o.parentFeatureId){e.next=10;break}throw new Error("TODO: Split exon without parent");case 10:if(d=this.makeSplitExons(i,l,c,u,f),p=de(d,2),h=p[0],m=p[1],g=t.getFeature(s)){e.next=14;break}throw new Error('Could not find parent feature "'.concat(s,'"'));case 14:g.addChild(h),g.addChild(m),t.getFeature(i._id)&&t.deleteFeature(i._id);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[3,21,24,27]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e,t=this.assembly,n=this.changes,r=this.logger,a=he(this.changedIds).reverse(),o=he(n).reverse().map((function(e){return{exonToRestore:e.exonToBeSplit,parentFeatureId:e.parentFeatureId,idsToDelete:[e.leftExonId,e.rightExonId],upstreamCut:e.upstreamCut,downstreamCut:e.downstreamCut,leftExonId:e.leftExonId,rightExonId:e.rightExonId}}));return null===(e=r.debug)||void 0===e||e.call(r,"INVERSE CHANGE '".concat(JSON.stringify(o),"'")),new _l.UndoSplitExonChange({changedIds:a,typeName:"UndoSplitExonChange",changes:o,assembly:t},{logger:r})}},{key:"makeSplitExons",value:function(e,t,n,r,a){var o=JSON.parse(JSON.stringify(e));delete o.attributes._id,delete o.attributes.gff_id;var i=structuredClone(o);i._id=r,i.max=t;var s=structuredClone(o);return s.min=n,s._id=a,[i,s]}}]),o}(ar.FeatureChange);hl.SplitExonChange=wl;var xl={};Object.defineProperty(xl,"__esModule",{value:!0}),xl.StrandChange=void 0;var Sl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","StrandChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldStrand:a.oldStrand,newStrand:a.newStrand}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=_e(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return d=(f=l.value).featureId,p=f.oldStrand,e.next=11,n.findOne({allIds:d}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,d)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.strand===p){e.next=27;break}throw y="*** ERROR: Feature's current strand \"".concat(h.strand,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=_e(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=de(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).strand=w[1].newStrand,E._id.equals(S._id)?E.markModified("strand"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=de(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setStrand(this.changes[o].newStrand);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:he(this.changedIds).reverse(),typeName:r,changes:he(t).reverse().map((function(e){return{featureId:e.featureId,oldStrand:e.newStrand,newStrand:e.oldStrand}})),assembly:e},{logger:n})}}]),o}(ar.FeatureChange);xl.StrandChange=Sl;var El={};Object.defineProperty(El,"__esModule",{value:!0}),El.TypeChange=void 0;var kl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","TypeChange"),te(ce(n),"changes",void 0),n.changes="changes"in e?e.changes:[e],n}return ee(o,[{key:"toJSON",value:function(){var e=this.assembly,t=this.changedIds,n=this.changes,r=this.typeName;if(1===n.length){var a=de(n,1)[0];return{typeName:r,changedIds:t,assembly:e,featureId:a.featureId,oldType:a.oldType,newType:a.newType}}return{typeName:r,changedIds:t,assembly:e,changes:n}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.featureModel,r=t.session,o=this.logger,i=[],s=_e(a=this.changes),e.prev=4,s.s();case 6:if((l=s.n()).done){e.next=30;break}return d=(f=l.value).featureId,p=f.oldType,e.next=11,n.findOne({allIds:d}).session(r).exec();case 11:if(h=e.sent){e.next=16;break}throw m="*** ERROR: The following featureId was not found in database ='".concat(d,"'"),o.error(m),new Error(m);case 16:if(null===(c=o.debug)||void 0===c||c.call(o,"*** Feature found: ".concat(JSON.stringify(h))),g=this.getFeatureFromId(h,d)){e.next=22;break}throw o.error("ERROR when searching feature by featureId"),new Error("ERROR when searching feature by featureId");case 22:if(null===(u=o.debug)||void 0===u||u.call(o,"*** Found feature: ".concat(JSON.stringify(g))),g.type===p){e.next=27;break}throw y="*** ERROR: Feature's current type \"".concat(h.type,'" doesn\'t match with expected value "').concat(p,'"'),o.error(y),new Error(y);case 27:i.push({feature:g,topLevelFeature:h});case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(4),s.e(e.t0);case 35:return e.prev=35,s.f(),e.finish(35);case 38:v=_e(a.entries()),e.prev=39,v.s();case 41:if((b=v.n()).done){e.next=59;break}return w=de(b.value,2),E=(x=i[w[0]]).topLevelFeature,(S=x.feature).type=w[1].newType,E._id.equals(S._id)?E.markModified("type"):E.markModified("children"),e.prev=47,e.next=50,E.save();case 50:e.next=56;break;case 52:throw e.prev=52,e.t1=e.catch(47),null===(k=o.debug)||void 0===k||k.call(o,"*** FAILED: ".concat(e.t1)),e.t1;case 56:null===(_=o.debug)||void 0===_||_.call(o,"*** Object updated in Mongo. New object: ".concat(JSON.stringify(E)));case 57:e.next=41;break;case 59:e.next=64;break;case 61:e.prev=61,e.t2=e.catch(39),v.e(e.t2);case 64:return e.prev=64,v.f(),e.finish(64);case 67:case"end":return e.stop()}}),e,this,[[4,32,35,38],[39,61,64,67],[47,52]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){var n,r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No data store");case 2:n=_e(this.changedIds.entries()),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=13;break}if(a=de(r.value,2),o=a[0],s=t.getFeature(i=a[1])){e.next=10;break}throw new Error('Could not find feature with identifier "'.concat(i,'"'));case 10:s.setType(this.changes[o].newType);case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),n.e(e.t0);case 18:return e.prev=18,n.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[3,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){var e=this.assembly,t=this.changes,n=this.logger,r=this.typeName;return new o({changedIds:he(this.changedIds).reverse(),typeName:r,changes:he(t).reverse().map((function(e){return{featureId:e.featureId,oldType:e.newType,newType:e.oldType}})),assembly:e},{logger:n})}}]),o}(ar.FeatureChange);El.TypeChange=kl;var Al={};Object.defineProperty(Al,"__esModule",{value:!0}),Al.UserChange=void 0;var Cl=function(e){ne(o,e);var t,n,r,a=ue(o);function o(e,t){var n;return X(this,o),te(ce(n=a.call(this,e,t)),"typeName","UserChange"),te(ce(n),"changes",void 0),te(ce(n),"userId",void 0),n.changes="changes"in e?e.changes:[e],n.userId=e.userId,n}return ee(o,[{key:"toJSON",value:function(){var e=this.changes,t=this.typeName,n=this.userId;return 1===e.length?{typeName:t,userId:n,role:de(e,1)[0].role}:{typeName:t,userId:n,changes:e}}},{key:"executeOnServer",value:(r=Z(J().mark((function e(t){var n,r,a,o,i,s,l,c,u,f,d;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.session,r=t.userModel,o=this.logger,i=this.userId,s=_e(a=this.changes),e.prev=3,s.s();case 5:if((l=s.n()).done){e.next=18;break}return u=l.value,null===(c=o.debug)||void 0===c||c.call(o,"change: ".concat(JSON.stringify(a))),f=u.role,e.next=11,r.findByIdAndUpdate(i,{role:f}).session(n).exec();case 11:if(e.sent){e.next=16;break}throw d='*** ERROR: User with id "'.concat(i,'" not found'),o.error(d),new Error(d);case 16:e.next=5;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),s.e(e.t0);case 23:return e.prev=23,s.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[3,20,23,26]])}))),function(e){return r.apply(this,arguments)})},{key:"executeOnLocalGFF3",value:(n=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"executeOnClient",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getInverse",value:function(){return new o({typeName:this.typeName,changes:this.changes,userId:this.userId},{logger:this.logger})}}]),o}(ar.Change);Al.UserChange=Cl,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.changes=void 0;var t=Qe;e.changes={AddAssemblyAndFeaturesFromFileChange:Ar.AddAssemblyAndFeaturesFromFileChange,AddAssemblyFromFileChange:xs.AddAssemblyFromFileChange,AddAssemblyFromExternalChange:Ur.AddAssemblyFromExternalChange,AddFeatureChange:ks.AddFeatureChange,AddFeaturesFromFileChange:Is.AddFeaturesFromFileChange,DeleteAssemblyChange:Ds.DeleteAssemblyChange,DeleteFeatureChange:As.DeleteFeatureChange,DeleteUserChange:Bs.DeleteUserChange,FeatureAttributeChange:zs.FeatureAttributeChange,ImportJBrowseConfigChange:Hs.ImportJBrowseConfigChange,LocationEndChange:Ys.LocationEndChange,LocationStartChange:Zs.LocationStartChange,MergeExonsChange:Qs.MergeExonsChange,SplitExonChange:hl.SplitExonChange,MergeTranscriptsChange:il.MergeTranscriptsChange,UndoMergeExonsChange:el.UndoMergeExonsChange,UndoSplitExonChange:ml.UndoSplitExonChange,UndoMergeTranscriptsChange:sl.UndoMergeTranscriptsChange,StrandChange:xl.StrandChange,TypeChange:El.TypeChange,UserChange:Al.UserChange,AddRefSeqAliasesChange:Fs.AddRefSeqAliasesChange,AddAssemblyAliasesChange:rr.AddAssemblyAliasesChange},t.__exportStar(Ar,e),t.__exportStar(xs,e),t.__exportStar(Ur,e),t.__exportStar(ks,e),t.__exportStar(Is,e),t.__exportStar(Ds,e),t.__exportStar(As,e),t.__exportStar(Bs,e),t.__exportStar(zs,e),t.__exportStar(Hs,e),t.__exportStar(Ys,e),t.__exportStar(Zs,e),t.__exportStar(Qs,e),t.__exportStar(hl,e),t.__exportStar(il,e),t.__exportStar(el,e),t.__exportStar(ml,e),t.__exportStar(sl,e),t.__exportStar(xl,e),t.__exportStar(El,e),t.__exportStar(Al,e),t.__exportStar(Fs,e),t.__exportStar(rr,e)}(nr);var Ol={},Tl={};Object.defineProperty(Tl,"__esModule",{value:!0}),Tl.GetAssembliesOperation=void 0;var Nl=function(e){ne(r,e);var t,n=ue(r);function r(){var e;X(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return te(ce(e=n.call.apply(n,[this].concat(a))),"typeName","GetAssembliesOperation"),e}return ee(r,[{key:"toJSON",value:function(){return{typeName:this.typeName}}},{key:"executeOnServer",value:function(e){return e.assemblyModel.find({status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(ar.Operation);Tl.GetAssembliesOperation=Nl;var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0}),Rl.GetFeaturesOperation=void 0;var Il=function(e){ne(r,e);var t,n=ue(r);function r(e,t){var a;return X(this,r),te(ce(a=n.call(this,e,t)),"typeName","GetFeaturesOperation"),te(ce(a),"refSeq",void 0),te(ce(a),"start",void 0),te(ce(a),"end",void 0),a.refSeq=e.refSeq,a.start=e.start,a.end=e.end,a}return ee(r,[{key:"toJSON",value:function(){return{typeName:this.typeName,refSeq:this.refSeq,start:this.start,end:this.end}}},{key:"executeOnServer",value:function(e){return e.featureModel.find({refSeq:this.refSeq,min:{$lte:this.end},max:{$gte:this.start},status:0}).exec()}},{key:"executeOnLocalGFF3",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("executeOnLocalGFF3 not implemented");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),r}(ar.Operation);Rl.GetFeaturesOperation=Il,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.operations=void 0;var t=Qe;e.operations={GetAssembliesOperation:Tl.GetAssembliesOperation,GetFeaturesOperation:Rl.GetFeaturesOperation},t.__exportStar(Tl,e),t.__exportStar(Rl,e)}(Ol);var Pl={},Fl={};Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.Validation=void 0,Fl.isContext=function(e){return void 0!==e.context&&void 0!==e.reflector};var Ml=function(){function e(){X(this,e)}var t,n,r,a,o;return ee(e,[{key:"frontendPreValidate",value:(o=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Z(J().mark((function e(t,n){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{validationName:this.name});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();Fl.Validation=Ml;var jl={};Object.defineProperty(jl,"__esModule",{value:!0}),jl.validationRegistry=jl.ValidationSet=jl.ValidationResultSet=void 0;var Dl=function(){function e(){X(this,e),te(this,"results",[]),te(this,"ok",!0)}return ee(e,[{key:"resultsMessages",get:function(){return this.results.map((function(e){var t;return null===(t=e.error)||void 0===t?void 0:t.message})).filter(Boolean).join(", ")}},{key:"add",value:function(e){this.results.push(e),e.error&&(this.ok=!1)}}]),e}();jl.ValidationResultSet=Dl;var Ll=function(){function e(){X(this,e),te(this,"validations",new Set)}var t,n,r,a,o;return ee(e,[{key:"registerValidation",value:function(e){this.validations.add(e)}},{key:"frontendPreValidate",value:(o=Z(J().mark((function e(t){var n,r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Dl,r=_e(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.frontendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"frontendPostValidate",value:(a=Z(J().mark((function e(t,n){var r,a,o,i,s;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Dl,a=_e(this.validations),e.prev=2,a.s();case 4:if((o=a.n()).done){e.next=14;break}return i=o.value,e.next=8,i.frontendPostValidate(t,n);case 8:if(r.add(s=e.sent),!s.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",r);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e,t){return a.apply(this,arguments)})},{key:"backendPreValidate",value:(r=Z(J().mark((function e(t){var n,r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Dl,r=_e(this.validations),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=14;break}return o=a.value,e.next=8,o.backendPreValidate(t);case 8:if(n.add(i=e.sent),!i.error){e.next=12;break}return e.abrupt("break",14);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e,this,[[2,16,19,22]])}))),function(e){return r.apply(this,arguments)})},{key:"backendPostValidate",value:(n=Z(J().mark((function e(t,n){var r,a,o,i,s,l,c;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=new Dl,i=_e(this.validations),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=15;break}return l=s.value,e.next=9,l.backendPostValidate(t,{featureModel:r,session:a});case 9:if(o.add(c=e.sent),!c.error){e.next=13;break}return e.abrupt("break",15);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e,t){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Z(J().mark((function e(t){var n,r,a,o;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_e(this.validations),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=7,a.possibleValues(t);case 7:if(!(o=e.sent)){e.next=10;break}return e.abrupt("return",o);case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return");case 21:case"end":return e.stop()}}),e,this,[[1,14,17,20]])}))),function(e){return t.apply(this,arguments)})}]),e}();jl.ValidationSet=Ll,jl.validationRegistry=new Ll;var ql={},Bl={};Object.defineProperty(Bl,"__esModule",{value:!0}),Bl.default=["2A_self_cleaving_peptide_region","4_methylcytosine","5S_SINE_retrotransposon","5_carboxylcytosine","5_formylcytosine","5_hydroxymethylcytosine","5_methylcytosine","7SL_SINE_retrotransposon","8_oxoadenine","8_oxoguanine","AACCCT_box","AFLP_fragment","AP_1_binding_site","ARIA","ARRET","ARS","ARS_consensus_sequence","ASPE_primer","AUG_initiated_uORF","AU_rich_element","A_box","A_box_type_1","A_box_type_2","A_minor_RNA_motif","A_to_C_transversion","A_to_G_transition","A_to_T_transversion","Ace2_UAS","Alu_deletion","Alu_insertion","BAC","BAC_cloned_genomic_insert","BAC_end","BAC_read_contig","BREd_motif","BREu_motif","B_box","Bel_Pao_LTR_retrotransposon","Bruno_response_element","C-D_H_ACA_box_scaRNA","C-D_H_ACA_box_scaRNA_gene","CAAT_signal","CAAX_box","CACTA_TIR_transposon","CAGE_cluster","CAGE_tag","CArG_box","CCAAT_motif","CCA_tail","CDRE_motif","CDS","CDS_extension","CDS_five_prime_extension","CDS_fragment","CDS_independently_known","CDS_predicted","CDS_region","CDS_supported_by_EST_or_cDNA_data","CDS_supported_by_domain_match_data","CDS_supported_by_peptide_spectrum_match","CDS_supported_by_sequence_similarity_data","CDS_three_prime_extension","CRE","CRISPR","CSL_response_element","CTCF_binding_site","CTG_start_codon","C_D_box_scaRNA","C_D_box_scaRNA_gene","C_D_box_snoRNA","C_D_box_snoRNA_gene","C_D_box_snoRNA_primary_transcript","C_box","C_cluster","C_gene_segment","C_region","C_to_A_transversion","C_to_G_transversion","C_to_T_transition","C_to_T_transition_at_pCpG_site","ChIP_seq_region","Copia_LTR_retrotransposon","CpG_island","Crick_strand","Crypton_YR_transposon","CsrB_RsmB_RNA","CuRE","DArT_marker","DCE","DCE_SI","DCE_SII","DCE_SIII","DDB_box","DHU_loop","DIRS_YR_retrotransposon","DJ_C_cluster","DJ_J_C_cluster","DJ_J_cluster","DJ_gene_segment","DMv1_motif","DMv2_motif","DMv3_motif","DMv4_motif","DMv5_motif","DNA_aptamer","DNA_binding_site","DNA_chromosome","DNA_constraint_sequence","DNA_loop","DNA_loop_anchor","DNA_motif","DNA_sequence_secondary_structure","DNA_transposon","DNAzyme","DNaseI_hypersensitive_site","DPE1_motif","DPE_motif","DRE","DRE_motif","DSR_motif","D_DJ_C_cluster","D_DJ_J_C_cluster","D_DJ_J_cluster","D_DJ_cluster","D_J_C_cluster","D_J_cluster","D_cluster","D_gene_recombination_feature","D_gene_segment","D_loop","DsrA_RNA","ER_retention_signal","EST","EST_match","E_box_motif","Endogenous_Retrovirus_LTR_retrotransposon","FLEX_element","FRE","FRT_site","GAGA_motif","GATA_box","GC_rich_promoter_region","GNA_oligo","GTT_trinucleotide_repeat","GT_dinucleotide_repeat","G_box","G_quartet","G_to_A_transition","G_to_C_transversion","G_to_T_transversion","GcvB_RNA","Gypsy_LTR_retrotransposon","H2AK5_acetylation_site","H2AK9_acetylation_site","H2AZK11_acetylation_site","H2AZK13_acetylation_site","H2AZK15_acetylation_site","H2AZK4_acetylation_site","H2AZK7_acetylation_site","H2BK120_acetylation_site","H2BK12_acetylation_site","H2BK15_acetylation_site","H2BK20_acetylation_site","H2BK5_acetylation_site","H2BK5_monomethylation_site","H2B_ubiquitination_site","H3K14_acetylation_site","H3K18_acetylation_site","H3K20_trimethylation_site","H3K23_acetylation_site","H3K23_dimethylation_site","H3K27_acetylation_site","H3K27_dimethylation_site","H3K27_methylation_site","H3K27_monomethylation_site","H3K27_trimethylation_site","H3K36_acetylation_site","H3K36_dimethylation_site","H3K36_methylation_site","H3K36_monomethylation_site","H3K36_trimethylation_site","H3K4_acetylation_site","H3K4_dimethylation_site","H3K4_methylation_site","H3K4_monomethylation_site","H3K4_trimethylation","H3K56_acetylation_site","H3K79_dimethylation_site","H3K79_methylation_site","H3K79_monomethylation_site","H3K79_trimethylation_site","H3K9_acetylation_site","H3K9_dimethylation_site","H3K9_methylation_site","H3K9_monomethylation_site","H3K9_trimethylation_site","H3R2_dimethylation_site","H3R2_monomethylation_site","H4K12_acetylation_site","H4K16_acetylation_site","H4K20_monomethylation_site","H4K4_trimethylation_site","H4K5_acetylation_site","H4K8_acetylation_site","H4K91_acetylation_site","H4K_acylation_region","H4R3_dimethylation_site","HERV_deletion","HERV_insertion","HSE","H_ACA_box_scaRNA","H_ACA_box_scaRNA_gene","H_ACA_box_snoRNA","H_ACA_box_snoRNA_gene","H_ACA_box_snoRNA_primary_transcript","H_pseudoknot","Hoogsteen_base_pair","I-box","IG_C_gene","IG_C_pseudogene","IG_D_gene","IG_J_gene","IG_J_pseudogene","IG_V_gene","IG_V_pseudogene","INR1_motif","INR_motif","IRLinv_site","IRRinv_site","ISRE","I_LINE_retrotransposon","J_C_cluster","J_cluster","J_gene_recombination_feature","J_gene_segment","J_heptamer","J_nonamer","J_spacer","Jockey_LINE_retrotransposon","KEN_box","K_turn_RNA_motif","L1_LINE_retrotransposon","LARD","LINE1_deletion","LINE1_insertion","LINE_element","LNA_oligo","LOZ1_response_element","LTR_component","LTR_retrotransposon","L_box","MCB","MITE","MNP","MNV","MNV_artifact","MTE","Mat2P","Mat3M","Merlin_TIR_transposon","MicF_RNA","Mutator_TIR_transposon","N2_2_prime_O_dimethylguanosine","N2_7_2prirme_O_trimethylguanosine","N2_7_dimethylguanosine","N2_N2_2_prime_O_trimethylguanosine","N2_N2_7_trimethylguanosine","N2_N2_dimethylguanosine","N2_methylguanosine","N4_2_prime_O_dimethylcytidine","N4_N4_2_prime_O_trimethylcytidine","N4_acetyl_2_prime_O_methylcytidine","N4_acetylcytidine","N4_methylcytidine","N6_2_prime_O_dimethyladenosine","N6_N6_2_prime_O_trimethyladenosine","N6_N6_dimethyladenosine","N6_acetyladenosine","N6_cis_hydroxyisopentenyl_adenosine","N6_glycinylcarbamoyladenosine","N6_hydroxynorvalylcarbamoyladenosine","N6_isopentenyladenosine","N6_methyl_N6_threonylcarbamoyladenosine","N6_methyladenine","N6_methyladenosine","N6_threonylcarbamoyladenosine","NDM2_motif","NDM3_motif","NMD_polymorphic_pseudogene_transcript","NMD_transcript","NSD_transcript","N_region","Ngaro_YR_retrotransposon","ORF","Okazaki_fragment","OxyS_RNA","PAC","PAC_end","PCB","PCR_product","PIF_Harbinger_TIR_transposon","PIP_box","PNA_oligo","PSE_motif","P_TIR_transposon","Penelope_retrotransposon","Phage_RNA_Polymerase_Promoter","Pho7_binding_site","QTL","R2_LINE_retrotransposon","RAPD","RFLP_fragment","RH_map","RNA_6S","RNA_7SK","RNA_7SK_gene","RNA_aptamer","RNA_chromosome","RNA_hook_turn","RNA_internal_loop","RNA_junction_loop","RNA_motif","RNA_polymerase_III_TATA_box","RNA_polymerase_II_TATA_box","RNA_sequence_secondary_structure","RNA_stability_element","RNA_thermometer","RNAi_reagent","RNApol_III_promoter","RNApol_III_promoter_type_1","RNApol_III_promoter_type_2","RNApol_III_promoter_type_3","RNApol_II_core_promoter","RNApol_II_promoter","RNApol_I_promoter","RNase_MRP_RNA","RNase_MRP_RNA_gene","RNase_P_RNA","RNase_P_RNA_gene","RRE_RNA","RR_tract","RST","RST_match","RTE_LINE_retrotransposon","R_GNA_oligo","R_LTR_region","R_five_prime_LTR_region","R_three_prime_LTR_region","Retrovirus_LTR_retrotransposon","Robertsonian_fusion","RprA_RNA","SAGE_tag","SECIS_element","SHP_box","SINE_element","SL10_acceptor_site","SL11_acceptor_site","SL12_acceptor_site","SL1_acceptor_site","SL2_acceptor_site","SL3_acceptor_site","SL4_acceptor_site","SL5_acceptor_site","SL6_acceptor_site","SL7_acceptor_site","SL8_acceptor_site","SL9_acceptor_site","SNP","SNV","SNV_artifact","SP6_RNA_Polymerase_Promoter","SRP_RNA","SRP_RNA_gene","SRP_RNA_primary_transcript","STREP_motif","STS","STS_map","SUMO_interaction_motif","SVA_deletion","SVA_insertion","S_GNA_oligo","S_region","Sap1_recognition_motif","Shine_Dalgarno_sequence","T3_RNA_Polymerase_Promoter","T7_RNA_Polymerase_Promoter","TATA_box","TCS_element","TCT_motif","TERRA","TFRS_collection","TFRS_module","TF_binding_site","TNA_oligo","TRIM","TR_C_Gene","TR_D_Gene","TR_J_Gene","TR_J_pseudogene","TR_V_Gene","TR_V_pseudogene","TR_box","TSS","T_cell_receptor_gene","T_cell_receptor_pseudogene","T_loop","T_to_A_transversion","T_to_C_transition","T_to_G_transversion","Tc1_Mariner_TIR_transposon","Transib_TIR_transposon","U11_snRNA","U12_intron","U12_snRNA","U14_snoRNA","U14_snoRNA_gene","U14_snoRNA_primary_transcript","U1_snRNA","U2_intron","U2_snRNA","U3_LTR_region","U3_five_prime_LTR_region","U3_snoRNA","U3_snoRNA_gene","U3_three_prime_LTR_region","U4_snRNA","U4atac_snRNA","U5_LTR_region","U5_five_prime_LTR_region","U5_snRNA","U5_three_prime_LTR_region","U6_snRNA","U6atac_snRNA","U7_snRNA","UAA_stop_codon_signal","UAG_stop_codon_signal","UGA_stop_codon_signal","UNAAAC_motif","UPD","UST","UST_match","UTR","UTR_intron","UTR_region","U_box","VDJ_C_cluster","VDJ_J_C_cluster","VDJ_J_cluster","VDJ_gene_segment","VD_gene_segment","VJ_C_cluster","VJ_J_C_cluster","VJ_J_cluster","VJ_gene_segment","V_DJ_C_cluster","V_DJ_J_C_cluster","V_DJ_J_cluster","V_DJ_cluster","V_D_DJ_C_cluster","V_D_DJ_J_C_cluster","V_D_DJ_J_cluster","V_D_DJ_cluster","V_D_J_C_cluster","V_D_J_cluster","V_J_C_cluster","V_J_cluster","V_VDJ_C_cluster","V_VDJ_J_C_cluster","V_VDJ_J_cluster","V_VDJ_cluster","V_VJ_C_cluster","V_VJ_J_C_cluster","V_VJ_J_cluster","V_VJ_cluster","V_cluster","V_gene_recombination_feature","V_gene_segment","V_heptamer","V_nonamer","V_region","V_spacer","Viper_YR_retrotransposon","WC_base_pair","W_region","Watson_strand","X_element","X_element_combinatorial_repeat","X_region","YAC","YAC_end","YR_retrotransposon","Y_RNA","Y_RNA_gene","Y_RNA_primary_transcript","Y_prime_element","Y_region","Z1_region","Z2_region","Zas1_recognition_motif","aberrant_processed_transcript","accessible_DNA_region","active_peptide","adaptive_island","alanine","alanine_tRNA_primary_transcript","alanyl_tRNA","allelic_pseudogene","allelic_pseudogenic_rRNA","allelic_pseudogenic_tRNA","allelically_excluded_gene","alpha_beta_motif","alpha_helix","alternate_sequence_site","alternatively_spliced_transcript","amber_stop_codon","ambisense_ssRNA_viral_sequence","amino_acid","amplification_origin","anchor_binding_site","anchor_region","androgen_response_element","anti_ARRET","anticodon","anticodon_loop","antiparallel_beta_strand","antisense_RNA","antisense_lncRNA","antisense_lncRNA_gene","antisense_primary_transcript","apicoplast_chromosome","apicoplast_gene","aptamer","archaeal_intron","archaeosine","arginine","arginine_tRNA_primary_transcript","arginyl_tRNA","asparagine","asparagine_tRNA_primary_transcript","asparaginyl_tRNA","aspartic_acid","aspartic_acid_tRNA_primary_transcript","aspartyl_tRNA","assembly","assembly_component","assembly_error_correction","asx_motif","asx_turn","asx_turn_left_handed_type_one","asx_turn_left_handed_type_two","asx_turn_right_handed_type_one","asx_turn_right_handed_type_two","asymmetric_RNA_internal_loop","attB_site","attC_site","attCtn_site","attI_site","attL_site","attP_site","attR_site","attenuator","autocatalytically_spliced_intron","bacterial_RNApol_promoter","bacterial_RNApol_promoter_sigma54_element","bacterial_RNApol_promoter_sigma_70_element","bacterial_RNApol_promoter_sigma_ecf_element","bacterial_terminator","base","base_call_error_correction","base_pair","beta_bulge","beta_bulge_loop","beta_bulge_loop_five","beta_bulge_loop_six","beta_strand","beta_turn","beta_turn_left_handed_type_one","beta_turn_left_handed_type_two","beta_turn_right_handed_type_one","beta_turn_right_handed_type_two","beta_turn_type_eight","beta_turn_type_six","beta_turn_type_six_a","beta_turn_type_six_a_one","beta_turn_type_six_a_two","beta_turn_type_six_b","bidirectional_promoter","bidirectional_promoter_lncRNA","binding_site","biochemical_region_of_peptide","biological_region","biomaterial_region","biosynthetic_gene_cluster","blocked_reading_frame","blunt_end_restriction_enzyme_cleavage_junction","blunt_end_restriction_enzyme_cleavage_site","boundary_element","branch_site","cDNA_clone","cDNA_match","c_terminal_region","candidate_gene","canonical_five_prime_splice_site","canonical_three_prime_splice_site","cap","capped_mRNA","capped_primary_transcript","cassette_pseudogene","catalytic_residue","catmat_left_handed_four","catmat_left_handed_three","catmat_right_handed_four","catmat_right_handed_three","central_hydrophobic_region_of_signal_peptide","centromere","centromere_DNA_Element_I","centromere_DNA_Element_II","centromere_DNA_Element_III","centromeric_repeat","chimeric_cDNA_clone","chloroplast_DNA_read","chloroplast_chromosome","chromatin_regulatory_region","chromoplast_chromosome","chromoplast_gene","chromosomal_regulatory_element","chromosomal_structural_element","chromosomal_translocation","chromosome","chromosome_arm","chromosome_band","chromosome_breakage_sequence","chromosome_breakpoint","chromosome_part","circular_double_stranded_DNA_chromosome","circular_double_stranded_RNA_chromosome","circular_mRNA","circular_ncRNA","circular_plasmid","circular_single_stranded_DNA_chromosome","circular_single_stranded_RNA_chromosome","cis_acting_homologous_chromosome_pairing_region","cis_regulatory_frameshift_element","cis_regulatory_module","cis_splice_site","class_II_RNA","class_I_RNA","cleaved_for_gpi_anchor_region","cleaved_initiator_methionine","cleaved_peptide_region","clip","clone","clone_end","clone_insert","clone_insert_end","clone_insert_start","cloned_cDNA_insert","cloned_genomic_insert","cloned_region","coding_conserved_region","coding_end","coding_exon","coding_region_of_exon","coding_start","coding_transcript_with_retained_intron","codon","coiled_coil","cointegrated_plasmid","common_fragile_site","complex_chromosomal_rearrangement","complex_operon","complex_regulon","complex_structural_alteration","complex_substitution","compositionally_biased_region_of_peptide","conformational_switch","conjugative_transposon","consensus_AFLP_fragment","consensus_gDNA","consensus_mRNA","consensus_region","conserved_region","constitutive_promoter","contig","contig_collection","contig_read","copy_number_gain","copy_number_loss","copy_number_variation","core_eukaryotic_promoter_element","core_prokaryotic_promoter_element","core_promoter_element","core_viral_promoter_element","cosmid","cross_genome_match","cryptic_gene","cryptic_promoter","cryptic_prophage","cryptic_splice_site","cryptogene","ct_gene","cyanelle_chromosome","cyanelle_gene","cyclic_translocation","cysteine","cysteine_tRNA_primary_transcript","cysteinyl_tRNA","cytoplasmic_polypeptide_region","cytosolic_16S_rRNA","cytosolic_18S_rRNA","cytosolic_23S_rRNA","cytosolic_25S_rRNA","cytosolic_28S_rRNA","cytosolic_2S_rRNA","cytosolic_5S_rRNA","cytosolic_5_8S_rRNA","cytosolic_LSU_rRNA","cytosolic_LSU_rRNA_gene","cytosolic_SSU_rRNA","cytosolic_SSU_rRNA_gene","cytosolic_rRNA","cytosolic_rRNA_16S_gene","cytosolic_rRNA_18S_gene","cytosolic_rRNA_23S_gene","cytosolic_rRNA_25S_gene","cytosolic_rRNA_28S_gene","cytosolic_rRNA_2S_gene","cytosolic_rRNA_5S_gene","cytosolic_rRNA_5_8S_gene","cytosolic_rRNA_gene","dCAPS_primer","databank_entry","decayed_exon","defective_conjugative_transposon","deficient_translocation","deletion","deletion_artifact","deletion_breakpoint","deletion_junction","delins","destruction_box","dg_repeat","dh_repeat","dicistronic_mRNA","dicistronic_primary_transcript","dicistronic_transcript","dif_site","dihydrouridine","dinucleotide_repeat_microsatellite_feature","direct_repeat","direct_tandem_duplication","disabled_reading_frame","dispersed_repeat","distal_duplication","distal_promoter_element","distant_three_prime_recoding_signal","double_stranded_DNA_chromosome","double_stranded_RNA_chromosome","ds_DNA_viral_sequence","ds_RNA_viral_sequence","ds_oligo","duplicated_pseudogene","duplication","duplication_artifact","dye_terminator_read","early_origin_of_replication","edited_CDS","edited_mRNA","edited_transcript","edited_transcript_by_A_to_I_substitution","edited_transcript_feature","editing_block","editing_domain","endogenous_retroviral_gene","endonuclease_spliced_intron","endosomal_localization_signal","engineered_episome","engineered_foreign_gene","engineered_foreign_region","engineered_foreign_repetitive_element","engineered_foreign_transposable_element","engineered_foreign_transposable_element_gene","engineered_fusion_gene","engineered_gene","engineered_insert","engineered_plasmid","engineered_region","engineered_rescue_region","engineered_tag","engineered_transposable_element","enhancer","enhancerRNA","enhancer_binding_site","enhancer_blocking_element","enhancer_bound_by_factor","enhancer_trap_construct","enzymatic_RNA","enzymatic_RNA_gene","epigenetically_modified_gene","epigenetically_modified_region","epigenomically_modified_region","episome","epitope","epoxyqueuosine","eukaryotic_promoter","eukaryotic_terminator","exemplar_mRNA","exon","exon_junction","exon_of_single_exon_gene","exon_region","exonic_splice_enhancer","exonic_splicing_silencer","experimental_feature","experimental_result_region","experimentally_defined_binding_region","expressed_sequence_assembly","expressed_sequence_match","extended_cis_splice_site","extended_intronic_splice_region","external_transcribed_spacer_region","extrachromosomal_mobile_genetic_element","extramembrane_polypeptide_region","fingerprint_map","five_aminomethyl_two_thiouridine","five_carbamoylmethyl_two_prime_O_methyluridine","five_carbamoylmethyluridine","five_carboxyhydroxymethyl_uridine","five_carboxyhydroxymethyl_uridine_methyl_ester","five_carboxymethylaminomethyl_two_prime_O_methyluridine","five_carboxymethylaminomethyl_two_thiouridine","five_carboxymethylaminomethyluridine","five_carboxymethyluridine","five_formyl_two_prime_O_methylcytidine","five_formylcytidine","five_hydroxymethylcytidine","five_hydroxyuridine","five_isopentenylaminomethyl_two_prime_O_methyluridine","five_isopentenylaminomethyl_two_thiouridine","five_isopentenylaminomethyl_uridine","five_methoxycarbonylmethyl_two_prime_O_methyluridine","five_methoxycarbonylmethyl_two_thiouridine","five_methoxycarbonylmethyluridine","five_methoxyuridine","five_methyl_2_thiouridine","five_methylaminomethyl_two_selenouridine","five_methylaminomethyl_two_thiouridine","five_methylaminomethyluridine","five_methylcytidine","five_methyldihydrouridine","five_methyluridine","five_prime_D_heptamer","five_prime_D_nonamer","five_prime_D_recombination_signal_sequence","five_prime_D_spacer","five_prime_EST","five_prime_LTR","five_prime_LTR_component","five_prime_RST","five_prime_UST","five_prime_UTR","five_prime_UTR_intron","five_prime_cis_splice_site","five_prime_clip","five_prime_coding_exon","five_prime_coding_exon_coding_region","five_prime_coding_exon_noncoding_region","five_prime_flanking_region","five_prime_intron","five_prime_noncoding_exon","five_prime_open_reading_frame","five_prime_recoding_site","five_prime_restriction_enzyme_junction","five_prime_sticky_end_restriction_enzyme_cleavage_site","five_prime_terminal_inverted_repeat","five_taurinomethyl_two_thiouridine","five_taurinomethyluridine","five_two_prime_O_dimethylcytidine","five_two_prime_O_dimethyluridine","flanking_region","flanking_repeat","flanking_three_prime_quadruplet_recoding_signal","floxed_gene","foldback_element","foreign_gene","foreign_transposable_element","forkhead_motif","forward_primer","fosmid","four_bp_start_codon","four_demethylwyosine","four_thiouridine","fragile_site","fragment_assembly","functional_candidate_gene","functional_gene_region","fusion_gene","gRNA_gene","galactosyl_queuosine","gamma_turn","gamma_turn_classic","gamma_turn_inverse","gap","gene","gene_array","gene_cassette","gene_cassette_array","gene_component_region","gene_fragment","gene_group","gene_member_region","gene_rearranged_at_DNA_level","gene_segment","gene_silenced_by_DNA_methylation","gene_silenced_by_DNA_modification","gene_silenced_by_RNA_interference","gene_silenced_by_histone_deacetylation","gene_silenced_by_histone_methylation","gene_silenced_by_histone_modification","gene_subarray","gene_trap_construct","gene_with_dicistronic_mRNA","gene_with_dicistronic_primary_transcript","gene_with_dicistronic_transcript","gene_with_edited_transcript","gene_with_mRNA_recoded_by_translational_bypass","gene_with_mRNA_with_frameshift","gene_with_non_canonical_start_codon","gene_with_polyadenylated_mRNA","gene_with_polycistronic_transcript","gene_with_recoded_mRNA","gene_with_start_codon_CUG","gene_with_stop_codon_read_through","gene_with_stop_codon_redefined_as_pyrrolysine","gene_with_stop_codon_redefined_as_selenocysteine","gene_with_trans_spliced_transcript","gene_with_transcript_with_translational_frameshift","genetic_marker","genomic_DNA_contig","genomic_DNA_read","genomic_clone","genomic_island","genomically_contaminated_cDNA_clone","glutamic_acid","glutamic_acid_tRNA_primary_transcript","glutamine","glutamine_tRNA_primary_transcript","glutaminyl_tRNA","glutamyl_tRNA","glycine","glycine_tRNA_primary_transcript","glycyl_tRNA","golden_path","golden_path_fragment","group_1_intron_homing_endonuclease_target_region","group_IIA_intron","group_IIB_intron","group_IIC_intron","group_III_intron","group_II_intron","group_I_intron","guide_RNA","guide_RNA_region","hAT_TIR_transposon","hammerhead_ribozyme","haplotype_block","helitron","helix_turn_helix","heptamer_of_recombination_feature_of_vertebrate_immune_system_gene","heritable_phenotypic_marker","high_identity_region","histidine","histidine_tRNA_primary_transcript","histidyl_tRNA","histone_2AZ_acetylation_site","histone_2A_acetylation_site","histone_2B_acetylation_site","histone_3_acetylation_site","histone_4_acetylation_site","histone_acetylation_site","histone_acylation_region","histone_binding_site","histone_methylation_site","histone_modification","histone_ubiqitination_site","homing_endonuclease_binding_site","homol_D_box","homol_E_box","homologous_chromosome_recognition_and_pairing_locus","homologous_region","hpRNA","hpRNA_gene","hydrophobic_region_of_peptide","hydroxywybutosine","iDNA","i_motif","immature_peptide_region","immunoglobulin_gene","immunoglobulin_pseudogene","immunoglobulin_region","imprinting_control_region","indel_artifact","inducible_promoter","inert_DNA_spacer","inosine","insertion","insertion_artifact","insertion_breakpoint","insertion_sequence","insertion_site","insulator","insulator_binding_site","integrated_mobile_genetic_element","integrated_plasmid","integration_excision_site","integron","intein","intein_encoding_region","interband","interchromosomal_breakpoint","interchromosomal_translocation","intergenic_region","interior_coding_exon","interior_exon","interior_intron","intermediate_element","internal_Shine_Dalgarno_sequence","internal_UTR","internal_eliminated_sequence","internal_guide_sequence","internal_ribosome_entry_site","internal_transcribed_spacer_region","intrachromosomal_breakpoint","intrachromosomal_translocation","intramembrane_polypeptide_region","intrinsically_unstructured_polypeptide_region","introgressed_chromosome_region","intron","intron_base_5","intron_domain","intronic_regulatory_region","intronic_splice_enhancer","intronic_splicing_silencer","invalidated_cDNA_clone","inversion","inversion_breakpoint","inversion_cum_translocation","inversion_site","inversion_site_part","inverted_intrachromosomal_transposition","inverted_repeat","inverted_tandem_duplication","iron_repressed_GATA_element","iron_responsive_element","isoleucine","isoleucine_tRNA_primary_transcript","isoleucyl_tRNA","isomiR","isowyosine","junction","kinetoplast_gene","knob","kozak_sequence","lambda_vector","lariat_intron","late_origin_of_replication","left_handed_peptide_helix","leucine","leucine_tRNA_primary_transcript","leucoplast_chromosome","leucoplast_gene","leucyl_tRNA","ligand_binding_site","ligation_based_read","lincRNA","lincRNA_gene","linear_double_stranded_DNA_chromosome","linear_double_stranded_RNA_chromosome","linear_plasmid","linear_single_stranded_DNA_chromosome","linear_single_stranded_RNA_chromosome","linkage_group","lipoprotein_signal_peptide","lncRNA","lncRNA_gene","lncRNA_primary_transcript","lncRNA_with_retained_intron","loR","locus_control_region","long_terminal_repeat","long_terminal_repeat_transcript","loop","low_complexity_region","loxP_site","lysidine","lysine","lysine_tRNA_primary_transcript","lysosomal_localization_signal","lysyl_tRNA","mRNA","mRNA_contig","mRNA_read","mRNA_recoded_by_codon_redefinition","mRNA_recoded_by_translational_bypass","mRNA_region","mRNA_with_frameshift","mRNA_with_minus_1_frameshift","mRNA_with_minus_2_frameshift","mRNA_with_plus_1_frameshift","mRNA_with_plus_2_frameshift","macronuclear_chromosome","macronucleus_destined_segment","major_TSS","mannosyl_queuosine","match","match_part","maternal_uniparental_disomy","maternally_imprinted_gene","mathematically_defined_repeat","mating_type_M_box","mating_type_region","mating_type_region_motif","mating_type_region_replication_fork_barrier","matrix_attachment_site","mature_protein_region","mature_protein_region_of_CDS","mature_transcript","mature_transcript_region","maxicircle","maxicircle_gene","meiotic_recombination_region","membrane_peptide_loop","membrane_structure","metabolic_island","metal_binding_site","methionine","methionine_tRNA_primary_transcript","methionyl_tRNA","methylated_DNA_base_feature","methylated_adenine","methylated_cytosine","methylation_guide_snoRNA","methylation_guide_snoRNA_gene","methylation_guide_snoRNA_primary_transcript","methylinosine","methylwyosine","miRNA","miRNA_antiguide","miRNA_gene","miRNA_loop","miRNA_primary_transcript","miRNA_primary_transcript_region","miRNA_stem","miRNA_target_site","miR_encoding_Y_RNA_primary_transcript","miR_encoding_lncRNA_primary_transcript","miR_encoding_shRNA_primary_transcript","miR_encoding_snoRNA_primary_transcript","miR_encoding_tRNA_primary_transcript","miR_encoding_vaultRNA_primary_transcript","miRtron","microarray_oligo","micronuclear_chromosome","microsatellite","mini_exon_donor_RNA","mini_gene","minicircle","minicircle_gene","minisatellite","minor_TSS","minus_10_signal","minus_12_signal","minus_1_translational_frameshift","minus_24_signal","minus_2_translational_frameshift","minus_35_signal","mitochondrial_DNA_read","mitochondrial_D_loop","mitochondrial_chromosome","mitochondrial_contig","mitochondrial_control_region","mitochondrial_supercontig","mitochondrial_targeting_signal","mitotic_recombination_region","moR","mobile_element_deletion","mobile_element_insertion","mobile_genetic_element","mobile_intron","modified_DNA_base","modified_L_alanine","modified_L_arginine","modified_L_asparagine","modified_L_aspartic_acid","modified_L_cysteine","modified_L_glutamic_acid","modified_L_glutamine","modified_L_histidine","modified_L_isoleucine","modified_L_leucine","modified_L_lysine","modified_L_methionine","modified_L_phenylalanine","modified_L_proline","modified_L_selenocysteine","modified_L_serine","modified_L_threonine","modified_L_tryptophan","modified_L_tyrosine","modified_L_valine","modified_RNA_base_feature","modified_adenine","modified_adenosine","modified_amino_acid_feature","modified_cytidine","modified_cytosine","modified_glycine","modified_guanine","modified_guanosine","modified_inosine","modified_uridine","molecular_contact_region","monocistronic_mRNA","monocistronic_primary_transcript","monocistronic_transcript","monomeric_repeat","morpholino_oligo","mt_LSU_rRNA","mt_LSU_rRNA_gene","mt_SSU_rRNA","mt_SSU_rRNA_gene","mt_gene","mt_rRNA","mt_rRNA_gene","mt_tRNA","multiplexing_sequence_identifier","mutated_variant_site","mutational_hotspot","n_terminal_region","natural_plasmid","natural_transposable_element","natural_variant_site","ncRNA","ncRNA_gene","nc_conserved_region","nc_primary_transcript","negative_sense_ssRNA_viral_sequence","negatively_autoregulated_gene","nested_repeat","nested_tandem_repeat","nested_transposon","no_output","no_sequence_alteration","non_AUG_initiated_uORF","non_LTR_retrotransposon","non_LTR_retrotransposon_polymeric_tract","non_adjacent_residues","non_allelic_homologous_recombination_region","non_canonical_five_prime_splice_site","non_canonical_start_codon","non_canonical_three_prime_splice_site","non_complimentary_stem","non_cytoplasmic_polypeptide_region","non_processed_pseudogene","non_terminal_residue","non_transcribed_region","nonamer_of_recombination_feature_of_vertebrate_immune_system_gene","noncoding_exon","noncoding_region_of_exon","novel_sequence_insertion","nuclear_chromosome","nuclear_export_signal","nuclear_gene","nuclear_localization_signal","nuclear_mt_pseudogene","nuclear_rim_localization_signal","nuclease_binding_site","nuclease_hypersensitive_site","nuclease_sensitive_site","nucleomorph_gene","nucleomorphic_chromosome","nucleotide_binding_site","nucleotide_cleavage_site","nucleotide_match","nucleotide_motif","nucleotide_to_protein_binding_site","ochre_stop_codon","octamer_motif","oligo","oligo_U_tail","one_methyl_three_three_amino_three_carboxypropyl_pseudouridine","one_methyladenosine","one_methylguanosine","one_methylinosine","one_methylpseudouridine","one_two_prime_O_dimethyladenosine","one_two_prime_O_dimethylguanosine","one_two_prime_O_dimethylinosine","opal_stop_codon","open_chromatin_region","operator","operon","oriC","oriT","oriV","origin_of_replication","orphan_CDS","orthologous_region","outron","overlapping_EST_set","overlapping_feature_set","paired_end_fragment","parallel_beta_strand","paralogous_region","partial_genomic_sequence_assembly","partially_processed_cDNA_clone","paternal_uniparental_disomy","paternally_imprinted_gene","pathogenic_island","peptide_coil","peptide_helix","peptide_localization_signal","peroxywybutosine","phage_sequence","phagemid","phenylalanine","phenylalanine_tRNA_primary_transcript","phenylalanyl_tRNA","pheromone_response_element","phosphorylation_site","piRNA","piRNA_gene","pi_helix","piggyBac_TIR_transposon","plasmid","plasmid_gene","plasmid_vector","plastid_LSU_rRNA","plastid_LSU_rRNA_gene","plastid_SSU_rRNA","plastid_SSU_rRNA_gene","plastid_gene","plastid_rRNA","plastid_rRNA_gene","plus_1_translational_frameshift","plus_2_translational_frameshift","point_centromere","point_mutation","polinton","polyA_primed_cDNA_clone","polyA_sequence","polyA_signal_sequence","polyA_site","polyA_site_cluster","polyadenylated_mRNA","polycistronic_mRNA","polycistronic_primary_transcript","polycistronic_transcript","polymerase_synthesis_read","polymorphic_pseudogene","polymorphic_pseudogene_processed_transcript","polymorphic_pseudogene_with_retained_intron","polypeptide","polypeptide_DNA_contact","polypeptide_binding_motif","polypeptide_calcium_ion_contact_site","polypeptide_catalytic_motif","polypeptide_cobalt_ion_contact_site","polypeptide_conserved_motif","polypeptide_conserved_region","polypeptide_copper_ion_contact_site","polypeptide_domain","polypeptide_iron_ion_contact_site","polypeptide_ligand_contact","polypeptide_magnesium_ion_contact_site","polypeptide_manganese_ion_contact_site","polypeptide_metal_contact","polypeptide_molybdenum_ion_contact_site","polypeptide_motif","polypeptide_nest_left_right_motif","polypeptide_nest_motif","polypeptide_nest_right_left_motif","polypeptide_nickel_ion_contact_site","polypeptide_region","polypeptide_repeat","polypeptide_secondary_structure","polypeptide_sequencing_information","polypeptide_structural_motif","polypeptide_structural_region","polypeptide_tungsten_ion_contact_site","polypeptide_turn_motif","polypeptide_variation_site","polypeptide_zinc_ion_contact_site","polypyrimidine_tract","positional_candidate_gene","positive_sense_ssRNA_viral_sequence","positively_autoregulated_gene","possible_assembly_error","possible_base_call_error","post_translationally_modified_region","post_translationally_regulated_gene","pre_edited_mRNA","pre_edited_region","pre_miRNA","predicted_gene","predicted_transcript","presence_absence_variation","priRNA","primary_transcript","primary_transcript_region","primer","primer_binding_site","primer_match","probe","processed_pseudogene","processed_pseudogenic_rRNA","processed_pseudogenic_tRNA","processed_transcript","prokaryotic_promoter","proline","proline_tRNA_primary_transcript","prolyl_tRNA","promoter","promoter_element","promoter_flanking_region","promoter_targeting_sequence","promoter_trap_construct","propeptide","propeptide_cleavage_site","propeptide_region_of_CDS","prophage","proplastid_gene","protease_site","protein_binding_site","protein_coding_gene","protein_coding_primary_transcript","protein_hmm_match","protein_match","protein_protein_contact","protein_stability_element","proviral_gene","proviral_region","proximal_promoter_element","pseudogene","pseudogene_by_unequal_crossing_over","pseudogene_processed_transcript","pseudogenic_CDS","pseudogenic_exon","pseudogenic_gene_segment","pseudogenic_rRNA","pseudogenic_region","pseudogenic_tRNA","pseudogenic_transcript","pseudogenic_transcript_with_retained_intron","pseudoknot","pseudouridine","pseudouridylation_guide_snoRNA","pseudouridylation_guide_snoRNA_gene","pumilio_response_element","purine_to_pyrimidine_transversion","purine_transition","pyrimidine_to_purine_transversion","pyrimidine_transition","pyrosequenced_read","pyrrolysine","pyrrolysine_tRNA_primary_transcript","pyrrolysyl_tRNA","queuosine","rDNA_intergenic_spacer_element","rDNA_replication_fork_barrier","rRNA","rRNA_21S_gene","rRNA_cleavage_RNA","rRNA_cleavage_snoRNA_primary_transcript","rRNA_gene","rRNA_large_subunit_primary_transcript","rRNA_primary_transcript","rRNA_primary_transcript_region","rRNA_small_subunit_primary_transcript","rare_fragile_site","rasiRNA","read","read_pair","reading_frame","reagent","rearrangement_region","reciprocal_chromosomal_translocation","recoded_codon","recoded_mRNA","recoding_pseudoknot","recoding_stimulatory_region","recombination_enhancer","recombination_feature","recombination_feature_of_rearranged_gene","recombination_hotspot","recombination_regulatory_region","recombination_signal_sequence","recombinationally_inverted_gene","recombinationally_rearranged_gene","recombinationally_rearranged_vertebrate_immune_system_gene","recursive_splice_site","ref_miRNA","region","regional_centromere","regional_centromere_central_core","regional_centromere_inner_repeat_region","regional_centromere_outer_repeat_region","regional_centromere_outer_repeat_transcript","regulatory_promoter_element","regulatory_region","regulon","remark","repeat_component","repeat_fragment","repeat_instability_region","repeat_region","repeat_unit","replication_regulatory_region","replication_start_site","replicon","rescue_gene","rescue_mini_gene","rescue_region","resolution_site","response_element","restriction_enzyme_assembly_scar","restriction_enzyme_binding_site","restriction_enzyme_cleavage_junction","restriction_enzyme_five_prime_single_strand_overhang","restriction_enzyme_recognition_site","restriction_enzyme_region","restriction_enzyme_single_strand_overhang","restriction_enzyme_three_prime_single_strand_overhang","restriction_fragment","retinoic_acid_responsive_element","retrogene","retron","retrotransposon","reverse_Hoogsteen_base_pair","reverse_primer","rho_dependent_bacterial_terminator","rho_independent_bacterial_terminator","ribonuclease_site","ribosome_entry_site","riboswitch","ribothymidine","ribozyme","ribozyme_gene","right_handed_peptide_helix","sORF","sarcin_like_RNA_motif","satellite_DNA","sbRNA","sbRNA_gene","scRNA","scRNA_gene","scRNA_primary_transcript","scaRNA","scaRNA_gene","schellmann_loop","schellmann_loop_seven","schellmann_loop_six","selection_marker","selenocysteine","selenocysteine_tRNA_primary_transcript","selenocysteinyl_tRNA","self_cleaving_ribozyme","sense_intronic_ncRNA","sense_intronic_ncRNA_gene","sense_overlap_ncRNA","sense_overlap_ncRNA_gene","sequence_alteration","sequence_alteration_artifact","sequence_assembly","sequence_comparison","sequence_conflict","sequence_difference","sequence_feature","sequence_length_alteration","sequence_motif","sequence_rearrangement_feature","sequence_secondary_structure","sequence_uncertainty","sequencing_primer","serine","serine_tRNA_primary_transcript","serine_threonine_motif","serine_threonine_staple_motif","serine_threonine_turn","seryl_tRNA","seven_aminomethyl_seven_deazaguanosine","seven_cyano_seven_deazaguanosine","seven_deazaguanosine","seven_methylguanine","seven_methylguanosine","sgRNA","shRNA","shRNA_primary_transcript","shadow_enhancer","short_tandem_repeat_variation","siRNA","signal_anchor","signal_peptide","signal_peptide_region_of_CDS","signature","silenced_gene","silencer","silent_mating_type_cassette_array","simple_operon","simple_regulon","simple_sequence_length_variation","single_strand_restriction_enzyme_cleavage_site","single_stranded_DNA_chromosome","single_stranded_RNA_chromosome","sisRNA","site_specific_recombination_target_region","smFISH_probe","small_regulatory_ncRNA","snRNA","snRNA_gene","snRNA_primary_transcript","sncRNA","sncRNA_gene","snoRNA","snoRNA_gene","snoRNA_primary_transcript","solo_LTR","sonicate_fragment","specific_recombination_site","splice_enhancer","splice_junction","splice_region","splice_site","spliced_leader_RNA","spliceosomal_intron","spliceosomal_intron_region","splicing_regulatory_region","spot_42_RNA","spurious_protein","ss_RNA_viral_sequence","ss_oligo","st_turn_left_handed_type_one","st_turn_left_handed_type_two","st_turn_right_handed_type_one","st_turn_right_handed_type_two","start_codon","stem","stem_loop","stem_loop_region","sterol_regulatory_element","sticky_end_restriction_enzyme_cleavage_site","stop_codon","stop_codon_read_through","stop_codon_redefined_as_pyrrolysine","stop_codon_redefined_as_selenocysteine","stop_codon_signal","structural_alteration","substitution","substitution_artifact","subtelomere","sugar_edge_base_pair","supercontig","symbiosis_island","symmetric_RNA_internal_loop","syntenic_region","synthetic_oligo","tRNA","tRNA_SINE_retrotransposon","tRNA_gene","tRNA_intron","tRNA_primary_transcript","tRNA_region","tag","tandem_duplication","tandem_repeat","target_site_duplication","targeting_vector","tasiRNA","tasiRNA_primary_transcript","teb1_recognition_motif","telomerase_RNA","telomerase_RNA_gene","telomere","telomeric_D_loop","telomeric_repeat","telomeric_transcript","template_region","terminal_inverted_repeat","terminal_inverted_repeat_element","terminal_repeat","terminator","terminator_of_type_2_RNApol_III_promoter","tetraloop","tetranucleotide_repeat_microsatellite_feature","three_methylcytidine","three_methylpseudouridine","three_methyluridine","three_prime_D_heptamer","three_prime_D_nonamer","three_prime_D_recombination_signal_sequence","three_prime_D_spacer","three_prime_EST","three_prime_LTR","three_prime_LTR_component","three_prime_RACE_clone","three_prime_RST","three_prime_UST","three_prime_UTR","three_prime_UTR_intron","three_prime_cis_splice_site","three_prime_clip","three_prime_coding_exon","three_prime_coding_exon_coding_region","three_prime_coding_exon_noncoding_region","three_prime_flanking_region","three_prime_intron","three_prime_noncoding_exon","three_prime_overlapping_ncrna","three_prime_recoding_site","three_prime_repeat_recoding_signal","three_prime_restriction_enzyme_junction","three_prime_stem_loop_structure","three_prime_sticky_end_restriction_enzyme_cleavage_site","three_prime_terminal_inverted_repeat","three_ten_helix","three_three_amino_three_carboxypropyl_uridine","three_two_prime_O_dimethyluridine","threonine","threonine_tRNA_primary_transcript","threonyl_tRNA","tiling_path","tiling_path_clone","tiling_path_fragment","tmRNA","tmRNA_acceptor_piece","tmRNA_coding_piece","tmRNA_gene","tmRNA_primary_transcript","tmRNA_region","tnaORF","topologically_associated_domain","topologically_associated_domain_boundary","topologically_defined_region","trans_splice_acceptor_site","trans_splice_donor_site","trans_splice_junction","trans_splice_site","trans_spliced_mRNA","trans_spliced_transcript","transcribed_cluster","transcribed_fragment","transcribed_processed_pseudogene","transcribed_spacer_region","transcribed_unitary_pseudogene","transcribed_unprocessed_pseudogene","transcript","transcript_bound_by_nucleic_acid","transcript_bound_by_protein","transcript_region","transcript_with_translational_frameshift","transcription_end_site","transcription_factor_regulatory_site","transcription_pause_site","transcription_start_cluster","transcription_termination_signal","transcription_unit","transcriptional_cis_regulatory_region","transgene","transgenic_insertion","transgenic_transposable_element","transit_peptide","transit_peptide_region_of_CDS","transition","translated_nucleotide_match","translated_processed_pseudogene","translated_unprocessed_pseudogene","translation_regulatory_region","translational_frameshift","translationally_regulated_gene","translocation","translocation_breakpoint","translocation_element","transmembrane_helix","transmembrane_polypeptide_region","transposable_element","transposable_element_CDS","transposable_element_flanking_region","transposable_element_gene","transposable_element_insertion_site","transposable_element_pseudogene","transposon_fragment","transversion","trinucleotide_repeat_microsatellite_feature","tryptophan","tryptophan_tRNA_primary_transcript","tryptophanyl_tRNA","twintron","two_methyladenosine","two_methylthio_N6_cis_hydroxyisopentenyl_adenosine","two_methylthio_N6_hydroxynorvalyl_carbamoyladenosine","two_methylthio_N6_isopentenyladenosine","two_methylthio_N6_methyladenosine","two_methylthio_N6_threonyl_carbamoyladenosine","two_prime_O_methyladenosine","two_prime_O_methylcytidine","two_prime_O_methylguanosine","two_prime_O_methylinosine","two_prime_O_methylpseudouridine","two_prime_O_methyluridine","two_prime_O_ribosyladenosine_phosphate","two_prime_O_ribosylguanosine_phosphate","two_thio_two_prime_O_methyluridine","two_thiocytidine","two_thiouridine","tyrosine","tyrosine_tRNA_primary_transcript","tyrosyl_tRNA","uORF","ultracontig","unassigned_supercontig","unconfirmed_transcript","undermodified_hydroxywybutosine","unedited_region","unigene_cluster","unit_of_gene_expression","unitary_pseudogene","unitary_pseudogenic_rRNA","unitary_pseudogenic_tRNA","unprocessed_pseudogenic_rRNA","unprocessed_pseudogenic_tRNA","unspecified_indel","untranslated_region_polycistronic_mRNA","upstream_AUG_codon","uridine_five_oxyacetic_acid","uridine_five_oxyacetic_acid_methyl_ester","vacuolar_sorting_signal","validated_cDNA_clone","valine","valine_tRNA_primary_transcript","valyl_tRNA","vaultRNA_primary_transcript","vault_RNA","vault_RNA_gene","vector_replicon","vertebrate_immune_system_gene","vertebrate_immune_system_gene_recombination_feature","vertebrate_immune_system_gene_recombination_signal_feature","vertebrate_immune_system_gene_recombination_spacer","vertebrate_immune_system_pseudogene","vertebrate_immunoglobulin_T_cell_receptor_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_gene_cluster","vertebrate_immunoglobulin_T_cell_receptor_rearranged_segment","vertebrate_immunoglobulin_T_cell_receptor_segment","viral_promoter","viral_sequence","virtual_sequence","wild_type_rescue_gene","wobble_base_pair","wybutosine","wyosine","zinc_finger_binding_site","zinc_repressed_element"],Object.defineProperty(ql,"__esModule",{value:!0}),ql.CoreValidation=void 0,ql.isTypeChange=Gl;var Ul=Fl,zl=Qe.__importDefault(Bl);function Gl(e){return"oldType"in e&&"newType"in e}var Hl=function(e){ne(a,e);var t,n,r=ue(a);function a(){var e;X(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return te(ce(e=r.call.apply(r,[this].concat(n))),"name","Core"),e}return ee(a,[{key:"frontendPreValidate",value:(n=Z(J().mark((function e(t){var n,r,a;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Gl(t)){e.next=18;break}n=_e(t.changes),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}if(zl.default.includes((a=r.value).newType)){e.next=8;break}return e.abrupt("return",{validationName:this.name,error:{message:'"'.concat(a.newType,'" is not a valid SO sequence_feature term')}});case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:return e.abrupt("return",{validationName:this.name});case 19:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"possibleValues",value:(t=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("type"!==t){e.next=2;break}return e.abrupt("return",zl.default);case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),a}(Ul.Validation);ql.CoreValidation=Hl;var $l={},Wl={};Object.defineProperty(Wl,"__esModule",{value:!0}),Wl.splitStringIntoChunks=function(e,t){for(var n=[],r=0;r<e.length;r+=t){var a=e.slice(r,r+t);n.push(a)}return n},Wl.getPrintableId=function(e){var t,n,r=e,a=null===(t=r.attributes.get("gff_id"))||void 0===t?void 0:t.join(",");if(a)return"ID=".concat(a," (_id: ").concat(e._id.toString(),")");var o=null===(n=r.attributes.get("gff_name"))||void 0===n?void 0:n.join(",");return o?"Name=".concat(o," (_id: ").concat(e._id.toString(),")"):"_id: ".concat(e._id.toString())},Object.defineProperty($l,"__esModule",{value:!0}),$l.ParentChildValidation=void 0;var Vl=nr,Jl=Wl,Yl=function(e){ne(a,e);var t,n,r=ue(a);function a(){var e;X(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return te(ce(e=r.call.apply(r,[this].concat(n))),"name","ParentChildValidation"),e}return ee(a,[{key:"backendPostValidate",value:(n=Z(J().mark((function e(t,n){var r,a;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.featureModel,a=n.session,!(0,Vl.isLocationEndChange)(t)&&!(0,Vl.isLocationStartChange)(t)){e.next=3;break}return e.abrupt("return",this.validateParentChildRelationships(t,{session:a,featureModel:r}));case 3:return e.abrupt("return",{validationName:this.name});case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"validateParentChildRelationships",value:(t=Z(J().mark((function e(t,n){var r,a,o,i,s,l,c,u,f;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.featureModel,a=n.session,o=[],i=_e(t.changes),e.prev=3,l=J().mark((function e(){var t,n,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value.featureId,e.next=4,r.findOne({allIds:t}).session(a).exec();case 4:if(n=e.sent){e.next=8;break}throw i="ERROR: The following featureId was not found in database ='".concat(t,"'"),new Error(i);case 8:o.some((function(e){return e._id===n._id}))||o.push(n);case 9:case"end":return e.stop()}}),e)})),i.s();case 6:if((s=i.n()).done){e.next=10;break}return e.delegateYield(l(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),i.e(e.t1);case 15:return e.prev=15,i.f(),e.finish(15);case 18:c=0,u=o;case 19:if(!(c<u.length)){e.next=31;break}f=u[c],e.prev=21,this.checkChildFeatureBoundaries(f),e.next=28;break;case 25:return e.prev=25,e.t2=e.catch(21),e.abrupt("return",{validationName:this.name,error:{message:String(e.t2)}});case 28:c++,e.next=19;break;case 31:return e.abrupt("return",{validationName:this.name});case 32:case"end":return e.stop()}}),e,this,[[3,12,15,18],[21,25]])}))),function(e,n){return t.apply(this,arguments)})},{key:"checkChildFeatureBoundaries",value:function(e){if(e.children){var t,n=_e(e.children||new Map);try{for(n.s();!(t=n.n()).done;){var r=de(t.value,2)[1];if(null!==e.min&&null!==e.max&&null!==r.min&&null!==r.max&&(r.max>e.max||r.min<e.min))throw new Error("Feature ".concat((0,Jl.getPrintableId)(r)," exceeds the bounds of its parent, ").concat((0,Jl.getPrintableId)(e)));this.checkChildFeatureBoundaries(r)}}catch(e){n.e(e)}finally{n.f()}}}}]),a}(Fl.Validation);$l.ParentChildValidation=Yl,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(Fl,e),t.__exportStar(jl,e),t.__exportStar(ql,e),t.__exportStar($l,e)}(Pl);var Kl={},Zl={};function Xl(e){this.message=e}(Xl.prototype=new Error).name="InvalidCharacterError";var Ql="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Xl("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,a=0,o=0,i="";r=t.charAt(o++);~r&&(n=a%4?64*n+r:r,a++%4)?i+=String.fromCharCode(255&n>>(-2*a&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};function ec(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Ql(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return Ql(t)}}function tc(e){this.message=e}(tc.prototype=new Error).name="InvalidTokenError";var nc={__proto__:null,default:function(e,t){if("string"!=typeof e)throw new tc("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(ec(e.split(".")[n]))}catch(e){throw new tc("Invalid token specified: "+e.message)}},InvalidTokenError:tc},rc=L(nc);Object.defineProperty(Zl,"__esModule",{value:!0}),Zl.makeUserSessionId=function(e){var t="string"==typeof e?(0,ac.default)(e):e;return"".concat(t.id,"-").concat(t.iat)},Zl.getDecodedToken=function(e){return(0,ac.default)(e)};var ac=Qe.__importDefault(rc);!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Qe.__exportStar(Zl,e)}(Kl);var oc={},ic={};Object.defineProperty(ic,"__esModule",{value:!0}),ic.CDSCheck=void 0;var sc,lc,cc=ar,uc=C.default,fc=Qe.__importDefault(Vn);!function(e){e[e.TAG=0]="TAG",e[e.TAA=1]="TAA",e[e.TGA=2]="TGA"}(sc||(sc={})),function(e){e[e.ATG=0]="ATG"}(lc||(lc={}));var dc,pc="CDSCheck";!function(e){e[e.InternalStopCodon=0]="InternalStopCodon",e[e.MissingStartCodon=1]="MissingStartCodon",e[e.MissingStopCodon=2]="MissingStopCodon",e[e.MultipleOfThree=3]="MultipleOfThree"}(dc||(dc={}));var hc={G:"C",A:"T",T:"A",C:"G",R:"Y",Y:"R",M:"K",K:"M",S:"S",W:"W",H:"D",B:"V",V:"B",D:"H",N:"N"};function mc(e){var t,n=[],r=_e(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=hc[a.toUpperCase()];if(void 0===o)throw new TypeError('Cannot complement nucleotide: "'.concat(a,'"'));a===a.toLowerCase()?n.push(o.toLowerCase()):n.push(o)}}catch(e){r.e(e)}finally{r.f()}return n.reverse().join("")}function gc(e,t,n){return yc.apply(this,arguments)}function yc(){return(yc=Z(J().mark((function e(t,n,r){var a;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return r(e.min,e.max)})));case 2:return a=e.sent.join(""),-1===n&&(a=mc(a)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vc(e){for(var t=[],n=0;n<=e.length-3;n+=3)t.push(e.slice(n,n+3));return t}function bc(e,t,n){return-1===n?e>t:e<t}function _c(e,t,n){var r=structuredClone(e);r.sort(-1===t?function(e,t){return e.min<t.min?1:-1}:function(e,t){return e.min<t.min?-1:1});for(var a=0,o=void 0,i=void 0,s=0;s<r.length;s++)for(var l=r[s],c=l.phase,u=-1===t?l.min:l.max,f=-1===t?l.max-c:l.min+c;bc(f,u,t);f=-1===t?f-3:f+3){if(o=f,i=-1===t?o-3:o+3,-1===t&&i<l.min?i=r[s+1].max-r[s+1].phase:i>l.max&&(i=r[s+1].min+r[s+1].phase),a===n)return[o,i].sort((function(e,t){return e-t}));a++}}function wc(e,t){return xc.apply(this,arguments)}function xc(){return(xc=Z(J().mark((function e(t,n){var r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v,b,_,w,x,S,E,k,A,C,O,T,N,R,I,P,F,M,j;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],a=t._id,o=t.max,i=t.min,s=t.refSeq,l=t.strand,c=Sc(t)){e.next=5;break}return e.abrupt("return",r);case 5:u=[a],f=_e(c),e.prev=7,f.s();case 9:if((d=f.n()).done){e.next=37;break}return p=d.value,e.next=13,gc(p,l,n);case 13:m=vc(h=e.sent),h.length%3==0?((g=m.at(0))&&!(g.toUpperCase()in lc)&&(w=-1===l?null!==(y=null===(v=p.at(-1))||void 0===v?void 0:v.max)&&void 0!==y?y:o:null!==(b=null===(_=p.at(0))||void 0===_?void 0:_.min)&&void 0!==b?b:i,w=-1===l?w-3:w,r.push({_id:(new fc.default).toHexString(),name:pc,cause:dc[dc.MissingStartCodon],ids:u,refSeq:s.toString(),start:w,end:w,message:'Unexpected start codon in feature "'.concat(a,'": ').concat(g)})),(x=m.at(-1))&&!(x.toUpperCase()in sc)&&(C=-1===l?null!==(S=null===(E=p.at(0))||void 0===E?void 0:E.min)&&void 0!==S?S:i:null!==(k=null===(A=p.at(-1))||void 0===A?void 0:A.max)&&void 0!==k?k:o,r.push({_id:(new fc.default).toHexString(),name:pc,cause:dc[dc.MissingStopCodon],ids:u,refSeq:s.toString(),start:C,end:C,message:'Missing stop codon for feature "'.concat(a,'"')}))):r.push({_id:(new fc.default).toHexString(),name:pc,cause:dc[dc.MultipleOfThree],ids:u,refSeq:s.toString(),start:i,end:o,message:'The coding sequence for feature "'.concat(a,'" is not a multiple of three')}),O=_e(m.entries()),e.prev=17,O.s();case 19:if((T=O.n()).done){e.next=27;break}if(N=de(T.value,2),I=N[1],(R=N[0])!==m.length-1){e.next=23;break}return e.abrupt("break",27);case 23:(P=_c(p,l,R))&&I.toUpperCase()in sc&&(F=de(P,2),M=F[0],j=F[1],r.push({_id:(new fc.default).toHexString(),name:pc,cause:dc[dc.InternalStopCodon],ids:u,refSeq:s.toString(),start:M,end:j,message:'The coding sequence for feature "'.concat(a,'" has an internal stop codon')}));case 25:e.next=19;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(17),O.e(e.t0);case 32:return e.prev=32,O.f(),e.finish(32);case 35:e.next=9;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(7),f.e(e.t1);case 42:return e.prev=42,f.f(),e.finish(42);case 45:return e.abrupt("return",r);case 46:case"end":return e.stop()}}),e,null,[[7,39,42,45],[17,29,32,35]])})))).apply(this,arguments)}function Sc(e){if("mRNA"===e.type){var t=e.children,n=e.strand;if(t){var r=Object.values(t).filter((function(e){return"CDS"===e.type}));if(0!==r.length){var a,o=[],i=_e(r);try{var s=function(){for(var e=a.value,r=e.max,i=e.min,s=[],l=0,c=Object.values(t);l<c.length;l++){var u=c[l];if("exon"===u.type){var f=de((0,uc.intersection2)(i,r,u.min,u.max),2),d=f[0],p=f[1];void 0!==d&&void 0!==p&&s.push({min:d,max:p})}}s.sort((function(e,t){return e.min-t.min})),-1===n&&s.reverse();var h=0,m=s.map((function(e){var t=h;return h=(3-(e.max-e.min-t+3)%3)%3,V(V({},e),{},{phase:t})}));m.sort((function(e,t){return e.min<t.min?-1:1})),o.push(m)};for(i.s();!(a=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return o.length>1&&o.sort((function(e,t){return e[0].min<t[0].min?-1:1})),o}}}}var Ec=function(e){ne(r,e);var t,n=ue(r);function r(){var e;X(this,r);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return te(ce(e=n.call.apply(n,[this].concat(a))),"name",pc),te(ce(e),"causes",Object.values(dc).filter((function(e){return Number.isNaN(Number(e))}))),te(ce(e),"version",1),te(ce(e),"default",!0),e}return ee(r,[{key:"checkFeature",value:(t=Z(J().mark((function e(t,n){var r,a,o,i;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("mRNA"!==t.type){e.next=2;break}return e.abrupt("return",wc(t,n));case 2:if(t.children){e.next=4;break}return e.abrupt("return",[]);case 4:r=[],a=0,o=Object.values(t.children);case 6:if(!(a<o.length)){e.next=19;break}return i=o[a],e.t0=r.push,e.t1=r,e.t2=he,e.next=13,this.checkFeature(i,n);case 13:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 16:a++,e.next=6;break;case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),r}(cc.Check);ic.CDSCheck=Ec,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Qe.__exportStar(ic,e)}(oc);var kc={};Object.defineProperty(kc,"__esModule",{value:!0}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(nr,e),t.__exportStar(Ol,e),t.__exportStar(Pl,e),t.__exportStar(Kl,e),t.__exportStar(oc,e),t.__exportStar(Wl,e),t.__exportStar(kc,e),t.__exportStar(Or,e)}(tr);var Ac={},Cc={exports:{}};!function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}(Cc);var Oc={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=O.default}(Oc);var Tc=Cc.exports;Object.defineProperty(Ac,"__esModule",{value:!0});var Nc=Ac.default=void 0;Nc=Ac.default=(0,Tc(Oc).default)((0,T.default.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");const Rc=r.ConfigurationSchema("ApolloInternetAccount",{baseURL:{description:"Location of Apollo server",type:"string",defaultValue:""},tokenType:{description:"A custom name for a token to include in the header",type:"string",defaultValue:"Bearer"}},{baseConfiguration:a.BaseInternetAccountConfig,explicitlyTyped:!0});var Ic=Object.create(null);Ic.open="0",Ic.close="1",Ic.ping="2",Ic.pong="3",Ic.message="4",Ic.upgrade="5",Ic.noop="6";var Pc=Object.create(null);Object.keys(Ic).forEach((function(e){Pc[Ic[e]]=e}));var Fc,Mc={type:"error",data:"parser error"},jc="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Dc="function"==typeof ArrayBuffer,Lc=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},qc=function(e,t,n){var r=e.type,a=e.data;return jc&&a instanceof Blob?t?n(a):Bc(a,n):Dc&&(a instanceof ArrayBuffer||Lc(a))?t?n(a):Bc(new Blob([a]),n):n(Ic[r]+(a||""))},Bc=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Uc(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var zc="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Gc=0;Gc<64;Gc++)zc["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(Gc)]=Gc;var Hc,$c="function"==typeof ArrayBuffer,Wc=function(e,t){if("string"!=typeof e)return{type:"message",data:Jc(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:Vc(e.substring(1),t)}:Pc[n]?e.length>1?{type:Pc[n],data:e.substring(1)}:{type:Pc[n]}:Mc},Vc=function(e,t){if($c){var n=function(e){var t,n,r,a,o,i=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),u=new Uint8Array(c);for(t=0;t<s;t+=4)n=zc[e.charCodeAt(t)],r=zc[e.charCodeAt(t+1)],a=zc[e.charCodeAt(t+2)],o=zc[e.charCodeAt(t+3)],u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&o;return c}(e);return Jc(n,t)}return{base64:!0,data:e}},Jc=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},Yc=String.fromCharCode(30);function Kc(e){return e.reduce((function(e,t){return e+t.length}),0)}function Zc(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),r=0,a=0;a<t;a++)n[a]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function Xc(e){if(e)return function(e){for(var t in Xc.prototype)e[t]=Xc.prototype[t];return e}(e)}Xc.prototype.on=Xc.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Xc.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Xc.prototype.off=Xc.prototype.removeListener=Xc.prototype.removeAllListeners=Xc.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var a=0;a<r.length;a++)if((n=r[a])===t||n.fn===t){r.splice(a,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},Xc.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var a=(n=n.slice(0)).length;r<a;++r)n[r].apply(this,t)}return this},Xc.prototype.emitReserved=Xc.prototype.emit,Xc.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Xc.prototype.hasListeners=function(e){return!!this.listeners(e).length};var Qc=function(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()}();function eu(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var tu=Qc.setTimeout,nu=Qc.clearTimeout;function ru(e,t){t.useNativeTimers?(e.setTimeoutFn=tu.bind(Qc),e.clearTimeoutFn=nu.bind(Qc)):(e.setTimeoutFn=Qc.setTimeout.bind(Qc),e.clearTimeoutFn=Qc.clearTimeout.bind(Qc))}var au,ou=function(e){ne(n,e);var t=ue(n);function n(e,r,a){var o;return X(this,n),(o=t.call(this,e)).description=r,o.context=a,o.type="TransportError",o}return ee(n)}(se(Error)),iu=function(e){ne(n,e);var t=ue(n);function n(e){var r;return X(this,n),(r=t.call(this)).writable=!1,ru(ce(r),e),r.opts=e,r.query=e.query,r.socket=e.socket,r}return ee(n,[{key:"onError",value:function(e,t,r){return fe(re(n.prototype),"emitReserved",this).call(this,"error",new ou(e,t,r)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,fe(re(n.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=Wc(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){fe(re(n.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",fe(re(n.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}]),n}(Xc),su="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),lu=64,cu=0;function uu(e){var t="";do{t=su[e%lu]+t,e=Math.floor(e/lu)}while(e>0);return t}function fu(){var e=uu(+new Date);return e!==au?(cu=0,au=e):e+"."+uu(cu++)}var du=!1;try{du="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(lo){}var pu=du;function hu(e){var t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||pu))return new XMLHttpRequest}catch(e){}if(!t)try{return new(Qc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function mu(){}var gu=function(){return null!=new hu({xdomain:!1}).responseType}(),yu=function(e){ne(n,e);var t=ue(n);function n(e){var r;if(X(this,n),(r=t.call(this,e)).polling=!1,"undefined"!=typeof location){var a="https:"===location.protocol,o=location.port;o||(o=a?"443":"80"),r.xd="undefined"!=typeof location&&e.hostname!==location.hostname||o!==e.port}return r.supportsBinary=gu&&!(e&&e.forceBase64),r.opts.withCredentials&&(r.cookieJar=void 0),r}return ee(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(Yc),r=[],a=0;a<n.length;a++){var o=Wc(n[a],t);if(r.push(o),"error"===o.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,n){var r=e.length,a=new Array(r),o=0;e.forEach((function(e,n){qc(e,!1,(function(e){var i;a[n]=e,++o===r&&(i=a.join(Yc),t.doWrite(i,(function(){t.writable=!0,t.emitReserved("drain")})))}))}))}(e)}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=fu()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new vu(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e,t){n.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t}}]),n}(iu),vu=function(e){ne(n,e);var t=ue(n);function n(e,r){var a;return X(this,n),ru(ce(a=t.call(this)),r),a.opts=r,a.method=r.method||"GET",a.uri=e,a.data=void 0!==r.data?r.data:null,a.create(),a}return ee(n,[{key:"create",value:function(){var e,t=this,r=eu(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;var a=this.xhr=new hu(r);try{a.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var o in a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&a.setRequestHeader(o,this.opts.extraHeaders[o])}catch(e){}if("POST"===this.method)try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{a.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(a),"withCredentials"in a&&(a.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(a.timeout=this.opts.requestTimeout),a.onreadystatechange=function(){var e;3===a.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(a)),4===a.readyState&&(200===a.status||1223===a.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"==typeof a.status?a.status:0)}),0))},a.send(this.data)}catch(e){return void this.setTimeoutFn((function(){t.onError(e)}),0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(null!=this.xhr){if(this.xhr.onreadystatechange=mu,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}(Xc);function bu(){for(var e in vu.requests)vu.requests.hasOwnProperty(e)&&vu.requests[e].abort()}vu.requestsCount=0,vu.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",bu):"function"==typeof addEventListener&&addEventListener("onpagehide"in Qc?"pagehide":"unload",bu,!1));var _u=function(){return"function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)}}(),wu=Qc.WebSocket||Qc.MozWebSocket,xu="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Su=function(e){ne(n,e);var t=ue(n);function n(e){var r;return X(this,n),(r=t.call(this,e)).supportsBinary=!e.forceBase64,r}return ee(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=xu?{}:eu(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=xu?new wu(e,t,n):t?new wu(e,t):new wu(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;qc(e[r],t.supportsBinary,(function(e){try{t.ws.send(e)}catch(e){}n&&_u((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=fu()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!wu}}]),n}(iu),Eu=function(e){ne(n,e);var t=ue(n);function n(){return X(this,n),t.apply(this,arguments)}return ee(n,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var n=function(e,t){Hc||(Hc=new TextDecoder);var n=[],r=0,a=-1,o=!1;return new TransformStream({transform:function(i,s){for(n.push(i);;){if(0===r){if(Kc(n)<1)break;var l=Zc(n,1);o=128==(128&l[0]),r=(a=127&l[0])<126?3:126===a?1:2}else if(1===r){if(Kc(n)<2)break;var c=Zc(n,2);a=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(2===r){if(Kc(n)<8)break;var u=Zc(n,8),f=new DataView(u.buffer,u.byteOffset,u.length),d=f.getUint32(0);if(d>Math.pow(2,21)-1){s.enqueue(Mc);break}a=d*Math.pow(2,32)+f.getUint32(4),r=3}else{if(Kc(n)<a)break;var p=Zc(n,a);s.enqueue(Wc(o?p:Hc.decode(p),t)),r=0}if(0===a||a>e){s.enqueue(Mc);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),a=new TransformStream({transform:function(e,t){!function(e,t){jc&&e.data instanceof Blob?e.data.arrayBuffer().then(Uc).then(t):Dc&&(e.data instanceof ArrayBuffer||Lc(e.data))?t(Uc(e.data)):qc(e,!1,(function(e){Fc||(Fc=new TextEncoder),t(Fc.encode(e))}))}(e,(function(n){var r,a=n.length;if(a<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,a);else if(a<65536){r=new Uint8Array(3);var o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,a)}else{r=new Uint8Array(9);var i=new DataView(r.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(a))}e.data&&"string"!=typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}});a.readable.pipeTo(t.writable),e.writer=a.writable.getWriter(),function t(){r.read().then((function(n){n.done||(e.onPacket(n.value),t())})).catch((function(e){}))}();var o={type:"open"};e.query.sid&&(o.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(o).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=r===e.length-1;t.writer.write(e[r]).then((function(){n&&_u((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),n}(iu),ku={websocket:Su,webtransport:Eu,polling:yu},Au=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cu=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ou(e){var t,n,r=e,a=e.indexOf("["),o=e.indexOf("]");-1!=a&&-1!=o&&(e=e.substring(0,a)+e.substring(a,o).replace(/:/g,";")+e.substring(o,e.length));for(var i,s=Au.exec(e||""),l={},c=14;c--;)l[Cu[c]]=s[c]||"";return-1!=a&&-1!=o&&(l.source=r,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.pathNames=(n=(t=l.path).replace(/\/{2,9}/g,"/").split("/"),"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n),l.queryKey=(i={},l.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(i[t]=n)})),i),l}var Tu=function(e){ne(n,e);var t=ue(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return X(this,n),(r=t.call(this)).binaryType="arraybuffer",r.writeBuffer=[],e&&"object"===Y(e)&&(a=e,e=null),e?(e=Ou(e),a.hostname=e.host,a.secure="https"===e.protocol||"wss"===e.protocol,a.port=e.port,e.query&&(a.query=e.query)):a.host&&(a.hostname=Ou(a.host).host),ru(ce(r),a),r.secure=null!=a.secure?a.secure:"undefined"!=typeof location&&"https:"===location.protocol,a.hostname&&!a.port&&(a.port=r.secure?"443":"80"),r.hostname=a.hostname||("undefined"!=typeof location?location.hostname:"localhost"),r.port=a.port||("undefined"!=typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=a.transports||["polling","websocket","webtransport"],r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},a),r.opts.path=r.opts.path.replace(/\/$/,"")+(r.opts.addTrailingSlash?"/":""),"string"==typeof r.opts.query&&(r.opts.query=function(e){for(var t={},n=e.split("&"),r=0,a=n.length;r<a;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"==typeof addEventListener&&(r.opts.closeOnBeforeunload&&(r.beforeunloadEventListener=function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())},addEventListener("beforeunload",r.beforeunloadEventListener,!1)),"localhost"!==r.hostname&&(r.offlineEventListener=function(){r.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",r.offlineEventListener,!1))),r.open(),r}return ee(n,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new ku[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),a=!1;n.priorWebsocketSuccess=!1;var o=function(){a||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(function(e){if(!a)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;n.priorWebsocketSuccess="websocket"===r.name,t.transport.pause((function(){a||"closed"!==t.readyState&&(f(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=r.name,t.emitReserved("upgradeError",o)}})))};function i(){a||(a=!0,f(),r.close(),r=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=r.name,i(),t.emitReserved("upgradeError",n)};function l(){s("transport closed")}function c(){s("socket closed")}function u(e){r&&e.name!==r.name&&i()}var f=function(){r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",l),t.off("close",c),t.off("upgrading",u)};r.once("open",o),r.once("error",s),r.once("close",l),this.once("close",c),this.once("upgrading",u),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){a||r.open()}),200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,n=0;n<this.writeBuffer.length;n++){var r=this.writeBuffer[n].data;if(r&&(t+="string"==typeof(e=r)?function(e){for(var t=0,n=0,r=0,a=e.length;r<a;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(Xc);Tu.protocol=4;var Nu="function"==typeof ArrayBuffer,Ru=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Iu=Object.prototype.toString,Pu="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Iu.call(Blob),Fu="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Iu.call(File);function Mu(e){return Nu&&(e instanceof ArrayBuffer||Ru(e))||Pu&&e instanceof Blob||Fu&&e instanceof File}function ju(e,t){if(!e||"object"!==Y(e))return!1;if(Array.isArray(e)){for(var n=0,r=e.length;n<r;n++)if(ju(e[n]))return!0;return!1}if(Mu(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return ju(e.toJSON(),!0);for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&ju(e[a]))return!0;return!1}function Du(e){var t=[],n=e;return n.data=Lu(e.data,t),n.attachments=t.length,{packet:n,buffers:t}}function Lu(e,t){if(!e)return e;if(Mu(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var r=new Array(e.length),a=0;a<e.length;a++)r[a]=Lu(e[a],t);return r}if("object"===Y(e)&&!(e instanceof Date)){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=Lu(e[i],t));return o}return e}function qu(e,t){return e.data=Bu(e.data,t),delete e.attachments,e}function Bu(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=Bu(e[n],t);else if("object"===Y(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=Bu(e[r],t));return e}var Uu,zu=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(Uu||(Uu={}));var Gu=function(){function e(t){X(this,e),this.replacer=t}return ee(e,[{key:"encode",value:function(e){return e.type!==Uu.EVENT&&e.type!==Uu.ACK||!ju(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Uu.EVENT?Uu.BINARY_EVENT:Uu.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==Uu.BINARY_EVENT&&e.type!==Uu.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=Du(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}();function Hu(e){return"[object Object]"===Object.prototype.toString.call(e)}var $u=function(e){ne(n,e);var t=ue(n);function n(e){var r;return X(this,n),(r=t.call(this)).reviver=e,r}return ee(n,[{key:"add",value:function(e){var t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===Uu.BINARY_EVENT;r||t.type===Uu.BINARY_ACK?(t.type=r?Uu.EVENT:Uu.ACK,this.reconstructor=new Wu(t),0===t.attachments&&fe(re(n.prototype),"emitReserved",this).call(this,"decoded",t)):fe(re(n.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!Mu(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,fe(re(n.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(void 0===Uu[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Uu.BINARY_EVENT||r.type===Uu.BINARY_ACK){for(var a=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(a,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var i=t+1;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(i,t)}else r.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var l=t+1;++t;){var c=e.charAt(t);if(null==c||Number(c)!=c){--t;break}if(t===e.length)break}r.id=Number(e.substring(l,t+1))}if(e.charAt(++t)){var u=this.tryParse(e.substr(t));if(!n.isPayloadValid(r.type,u))throw new Error("invalid payload");r.data=u}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case Uu.CONNECT:return Hu(t);case Uu.DISCONNECT:return void 0===t;case Uu.CONNECT_ERROR:return"string"==typeof t||Hu(t);case Uu.EVENT:case Uu.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===zu.indexOf(t[0]));case Uu.ACK:case Uu.BINARY_ACK:return Array.isArray(t)}}}]),n}(Xc),Wu=function(){function e(t){X(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return ee(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=qu(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),Vu={__proto__:null,protocol:5,get PacketType(){return Uu},Encoder:Gu,Decoder:$u};function Ju(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var Yu=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ku=function(e){ne(n,e);var t=ue(n);function n(e,r,a){var o;return X(this,n),(o=t.call(this)).connected=!1,o.recovered=!1,o.receiveBuffer=[],o.sendBuffer=[],o._queue=[],o._queueSeq=0,o.ids=0,o.acks={},o.flags={},o.io=e,o.nsp=r,a&&a.auth&&(o.auth=a.auth),o._opts=Object.assign({},a),o.io._autoConnect&&o.open(),o}return ee(n,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[Ju(e,"open",this.onopen.bind(this)),Ju(e,"packet",this.onpacket.bind(this)),Ju(e,"error",this.onerror.bind(this)),Ju(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Yu.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;var a={type:Uu.EVENT,data:n,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]){var o=this.ids++,i=n.pop();this._registerAckCallback(o,i),a.id=o}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n,r=this,a=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==a){var o=this.io.setTimeoutFn((function(){delete r.acks[e];for(var n=0;n<r.sendBuffer.length;n++)r.sendBuffer[n].id===e&&r.sendBuffer.splice(n,1);t.call(r,new Error("operation has timed out"))}),a);this.acks[e]=function(){r.io.clearTimeoutFn(o);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(r,[null].concat(n))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(n,a){r.push((function(e,t){return o?e?a(e):n(t):n(e)})),t.emit.apply(t,[e].concat(r))}))}},{key:"_addToQueue",value:function(e){var t,n=this;"function"==typeof e[e.length-1]&&(t=e.pop());var r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r===n._queue[0]){if(null!==e)r.tryCount>n._opts.retries&&(n._queue.shift(),t&&t(e));else if(n._queue.shift(),t){for(var a=arguments.length,o=new Array(a>1?a-1:0),i=1;i<a;i++)o[i-1]=arguments[i];t.apply(void 0,[null].concat(o))}return r.pending=!1,n._drainQueue()}})),this._queue.push(r),this._drainQueue()}},{key:"_drainQueue",value:function(){if(this.connected&&0!==this._queue.length){var e=this._queue[0];e.pending&&!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:Uu.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case Uu.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Uu.EVENT:case Uu.BINARY_EVENT:this.onevent(e);break;case Uu.ACK:case Uu.BINARY_ACK:this.onack(e);break;case Uu.DISCONNECT:this.ondisconnect();break;case Uu.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=_e(this._anyListeners.slice());try{for(r.s();!(t=r.n()).done;)t.value.apply(this,e)}catch(e){r.e(e)}finally{r.f()}}fe(re(n.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];t.packet({type:Uu.ACK,id:e,data:a})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:Uu.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=_e(this._anyOutgoingListeners.slice());try{for(n.s();!(t=n.n()).done;)t.value.apply(this,e.data)}catch(e){n.e(e)}finally{n.f()}}}}]),n}(Xc);function Zu(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Zu.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Zu.prototype.reset=function(){this.attempts=0},Zu.prototype.setMin=function(e){this.ms=e},Zu.prototype.setMax=function(e){this.max=e},Zu.prototype.setJitter=function(e){this.jitter=e};var Xu=function(e){ne(n,e);var t=ue(n);function n(e,r){var a,o;X(this,n),(a=t.call(this)).nsps={},a.subs=[],e&&"object"===Y(e)&&(r=e,e=void 0),(r=r||{}).path=r.path||"/socket.io",a.opts=r,ru(ce(a),r),a.reconnection(!1!==r.reconnection),a.reconnectionAttempts(r.reconnectionAttempts||Infinity),a.reconnectionDelay(r.reconnectionDelay||1e3),a.reconnectionDelayMax(r.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(o=r.randomizationFactor)&&void 0!==o?o:.5),a.backoff=new Zu({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==r.timeout?2e4:r.timeout),a._readyState="closed",a.uri=e;var i=r.parser||Vu;return a.encoder=new i.Encoder,a.decoder=new i.Decoder,a._autoConnect=!1!==r.autoConnect,a._autoConnect&&a.open(),a}return ee(n,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Tu(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var a=Ju(n,"open",(function(){r.onopen(),e&&e()})),o=function(n){t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},i=Ju(n,"error",o);if(!1!==this._timeout){var s=this.setTimeoutFn((function(){a(),o(new Error("timeout")),n.close()}),this._timeout);this.opts.autoUnref&&s.unref(),this.subs.push((function(){t.clearTimeoutFn(s)}))}return this.subs.push(a),this.subs.push(i),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(Ju(e,"ping",this.onping.bind(this)),Ju(e,"data",this.ondata.bind(this)),Ju(e,"error",this.onerror.bind(this)),Ju(e,"close",this.onclose.bind(this)),Ju(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}},{key:"ondecoded",value:function(e){var t=this;_u((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Ku(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++)if(this.nsps[n[t]].active)return;this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){e.clearTimeoutFn(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),n}(Xc),Qu={};function ef(e,t){"object"===Y(e)&&(t=e,e=void 0);var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),r=Ou(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port+t,r.href=r.protocol+"://"+a+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),a=r.source,o=r.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||Qu[o]&&r.path in Qu[o].nsps?n=new Xu(a,t):(Qu[o]||(Qu[o]=new Xu(a,t)),n=Qu[o]),r.query&&!t.query&&(t.query=r.queryKey),n.socket(r.path,t)}function tf(){}function nf(){nf.init.call(this)}function rf(e){return void 0===e._maxListeners?nf.defaultMaxListeners:e._maxListeners}function af(e,t,n,r){var a,o,i;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=e._events)?(o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),i=o[t]):(o=e._events=new tf,e._eventsCount=0),i){if("function"==typeof i?i=o[t]=r?[n,i]:[i,n]:r?i.unshift(n):i.push(n),!i.warned&&(a=rf(e))&&a>0&&i.length>a){i.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=i.length,function(e){"function"==typeof console.warn?console.warn(e):console.log(e)}(s)}}else i=o[t]=n,++e._eventsCount;return e}function of(e,t,n){var r=!1;function a(){e.removeListener(t,a),r||(r=!0,n.apply(e,arguments))}return a.listener=n,a}function sf(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function lf(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}Object.assign(ef,{Manager:Xu,Socket:Ku,io:ef,connect:ef}),tf.prototype=Object.create(null),nf.EventEmitter=nf,nf.usingDomains=!1,nf.prototype.domain=void 0,nf.prototype._events=void 0,nf.prototype._maxListeners=void 0,nf.defaultMaxListeners=10,nf.init=function(){this.domain=null,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new tf,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},nf.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},nf.prototype.getMaxListeners=function(){return rf(this)},nf.prototype.emit=function(e){var t,n,r,a,o,i,s,l="error"===e;if(i=this._events)l=l&&null==i.error;else if(!l)return!1;if(s=this.domain,l){if(t=arguments[1],!s){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=s,t.domainThrown=!1,s.emit("error",t),!1}if(!(n=i[e]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,a=lf(e,r),o=0;o<r;++o)a[o].call(n)}(n,u,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var a=e.length,o=lf(e,a),i=0;i<a;++i)o[i].call(n,r)}(n,u,this,arguments[1]);break;case 3:!function(e,t,n,r,a){if(t)e.call(n,r,a);else for(var o=e.length,i=lf(e,o),s=0;s<o;++s)i[s].call(n,r,a)}(n,u,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,a,o){if(t)e.call(n,r,a,o);else for(var i=e.length,s=lf(e,i),l=0;l<i;++l)s[l].call(n,r,a,o)}(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(r-1),o=1;o<r;o++)a[o-1]=arguments[o];!function(e,t,n,r){if(t)e.apply(n,r);else for(var a=e.length,o=lf(e,a),i=0;i<a;++i)o[i].apply(n,r)}(n,u,this,a)}return!0},nf.prototype.on=nf.prototype.addListener=function(e,t){return af(this,e,t,!1)},nf.prototype.prependListener=function(e,t){return af(this,e,t,!0)},nf.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,of(this,e,t)),this},nf.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,of(this,e,t)),this},nf.prototype.removeListener=function(e,t){var n,r,a,o,i;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new tf:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(a=-1,o=n.length;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=n[o].listener,a=o;break}if(a<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new tf,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,a=e.length;r<a;n+=1,r+=1)e[n]=e[r];e.pop()}(n,a);r.removeListener&&this.emit("removeListener",e,i||t)}return this},nf.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new tf,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new tf:delete n[e]),this;if(0===arguments.length){for(var r,a=Object.keys(n),o=0;o<a.length;++o)"removeListener"!==(r=a[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new tf,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},nf.prototype.listeners=function(e){var t,n,r=this._events;return n=r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[],n},nf.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):sf.call(e,t)},nf.prototype.listenerCount=sf,nf.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var cf="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},uf=/%[sdj%]/g;function ff(e){if(!Ef(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(gf(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,a=r.length,o=String(e).replace(uf,(function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),i=r[n];n<a;i=r[++n])Sf(i)||!Cf(i)?o+=" "+i:o+=" "+gf(i);return o}function df(e,t){if(kf(pt.process))return function(){return df(e,t).apply(this,arguments)};if(!0===Lt.noDeprecation)return e;var n=!1;return function(){if(!n){if(Lt.throwDeprecation)throw new Error(t);Lt.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}}var pf,hf={};function mf(e){return kf(pf)&&(pf=Lt.env.NODE_DEBUG||""),e=e.toUpperCase(),hf[e]||(hf[e]=new RegExp("\\b"+e+"\\b","i").test(pf)?function(){var t=ff.apply(null,arguments);console.error("%s %d: %s",e,0,t)}:function(){}),hf[e]}function gf(e,t){var n={seen:[],stylize:vf};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),xf(t)?n.showHidden=t:t&&function(e,t){if(!t||!Cf(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]]}(n,t),kf(n.showHidden)&&(n.showHidden=!1),kf(n.depth)&&(n.depth=2),kf(n.colors)&&(n.colors=!1),kf(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=yf),bf(n,e,n.depth)}function yf(e,t){var n=gf.styles[t];return n?"["+gf.colors[n][0]+"m"+e+"["+gf.colors[n][1]+"m":e}function vf(e,t){return e}function bf(e,t,n){if(e.customInspect&&t&&Nf(t.inspect)&&t.inspect!==gf&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return Ef(r)||(r=bf(e,r,n)),r}var a=function(e,t){if(kf(t))return e.stylize("undefined","undefined");if(Ef(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):xf(t)?e.stylize(""+t,"boolean"):Sf(t)?e.stylize("null","null"):void 0}(e,t);if(a)return a;var o=Object.keys(t),i=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),Tf(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return _f(t);if(0===o.length){if(Nf(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(Af(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Of(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Tf(t))return _f(t)}var s,l="",c=!1,u=["{","}"];return Array.isArray(t)&&(c=!0,u=["[","]"]),Nf(t)&&(l=" [Function"+(t.name?": "+t.name:"")+"]"),Af(t)&&(l=" "+RegExp.prototype.toString.call(t)),Of(t)&&(l=" "+Date.prototype.toUTCString.call(t)),Tf(t)&&(l=" "+_f(t)),0!==o.length||c&&0!=t.length?n<0?Af(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),s=c?function(e,t,n,r,a){for(var o=[],i=0,s=t.length;i<s;++i)If(t,String(i))?o.push(wf(e,t,n,r,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(wf(e,t,n,r,a,!0))})),o}(e,t,n,i,o):o.map((function(r){return wf(e,t,n,i,r,c)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(s,l,u)):u[0]+l+u[1]}function _f(e){return"["+Error.prototype.toString.call(e)+"]"}function wf(e,t,n,r,a,o){var i,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),If(r,a)||(i="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=Sf(n)?bf(e,l.value,null):bf(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),kf(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=e.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=e.stylize(i,"string"))}return i+": "+s}function xf(e){return"boolean"==typeof e}function Sf(e){return null===e}function Ef(e){return"string"==typeof e}function kf(e){return void 0===e}function Af(e){return Cf(e)&&"[object RegExp]"===Rf(e)}function Cf(e){return"object"===Y(e)&&null!==e}function Of(e){return Cf(e)&&"[object Date]"===Rf(e)}function Tf(e){return Cf(e)&&("[object Error]"===Rf(e)||e instanceof Error)}function Nf(e){return"function"==typeof e}function Rf(e){return Object.prototype.toString.call(e)}function If(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pf(){this.head=null,this.tail=null,this.length=0}gf.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},gf.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},Pf.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Pf.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Pf.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},Pf.prototype.clear=function(){this.head=this.tail=null,this.length=0},Pf.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},Pf.prototype.concat=function(e){if(0===this.length)return Zt.alloc(0);if(1===this.length)return this.head.data;for(var t=Zt.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t};var Ff=Zt.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Mf(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!Ff(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Df;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Lf;break;default:return void(this.write=jf)}this.charBuffer=new Zt(6),this.charReceived=0,this.charLength=0}function jf(e){return e.toString(this.encoding)}function Df(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Lf(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}Mf.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,a=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,a),a-=this.charReceived),(r=(t+=e.toString(this.encoding,0,a)).charCodeAt(a=t.length-1))>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,a)}return t},Mf.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},Mf.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.encoding;t+=this.charBuffer.slice(0,this.charReceived).toString(n)}return t},Uf.ReadableState=Bf;var qf=mf("stream");function Bf(e,t){this.objectMode=!!(e=e||{}).objectMode,t instanceof md&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark;this.highWaterMark=n||0===n?n:this.objectMode?16:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=new Pf,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new Mf(e.encoding),this.encoding=e.encoding)}function Uf(e){if(!(this instanceof Uf))return new Uf(e);this._readableState=new Bf(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),nf.call(this)}function zf(e,t,n,r,a){var o=function(e,t){var n=null;return Mn(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,$f(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!a){var i=new Error("stream.push() after EOF");e.emit("error",i)}else if(t.endEmitted&&a){var s=new Error("stream.unshift() after end event");e.emit("error",s)}else{var l;!t.decoder||a||r||(n=t.decoder.write(n),l=!t.objectMode&&0===n.length),a||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,a?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&$f(e))),function(e,t){t.readingMore||(t.readingMore=!0,kt(Vf,e,t))}(e,t)}else a||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}cf(Uf,nf),Uf.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=Zt.from(e,t),t=""),zf(this,n,e,t,!1)},Uf.prototype.unshift=function(e){return zf(this,this._readableState,e,"",!0)},Uf.prototype.isPaused=function(){return!1===this._readableState.flowing},Uf.prototype.setEncoding=function(e){return this._readableState.decoder=new Mf(e),this._readableState.encoding=e,this};var Gf=8388608;function Hf(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=Gf?e=Gf:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function $f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(qf("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?kt(Wf,e):Wf(e))}function Wf(e){qf("emit readable"),e.emit("readable"),Kf(e)}function Vf(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(qf("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function Jf(e){qf("readable nexttick read 0"),e.read(0)}function Yf(e,t){t.reading||(qf("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),Kf(e),t.flowing&&!t.reading&&e.read(0)}function Kf(e){var t=e._readableState;for(qf("flow",t.flowing);t.flowing&&null!==e.read(););}function Zf(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,a=n.data;for(e-=a.length;n=n.next;){var o=n.data,i=e>o.length?o.length:e;if(a+=i===o.length?o:o.slice(0,e),0==(e-=i)){i===o.length?(++r,t.head=n.next?n.next:t.tail=null):(t.head=n,n.data=o.slice(i));break}++r}return t.length-=r,a}(e,t):function(e,t){var n=Zt.allocUnsafe(e),r=t.head,a=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,i=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,i),0==(e-=i)){i===o.length?(++a,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=o.slice(i));break}++a}return t.length-=a,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function Xf(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,kt(Qf,t,e))}function Qf(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function ed(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function td(){}function nd(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function rd(e,t){Object.defineProperty(this,"buffer",{get:df((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),this.objectMode=!!(e=e||{}).objectMode,t instanceof md&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark;this.highWaterMark=n||0===n?n:this.objectMode?16:16384,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.decodeStrings=!(!1===e.decodeStrings),this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,a=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,a){--t.pendingcb,n?kt(a,r):a(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,n,r,t,a);else{var o=ld(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||sd(e,n),r?kt(id,e,n,o,a):id(e,n,o,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new fd(this)}function ad(e){if(!(this instanceof ad||this instanceof md))return new ad(e);this._writableState=new rd(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),nf.call(this)}function od(e,t,n,r,a,o,i){t.writelen=r,t.writecb=i,t.writing=!0,t.sync=!0,n?e._writev(a,t.onwrite):e._write(a,o,t.onwrite),t.sync=!1}function id(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),ud(e,t)}function sd(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=new Array(t.bufferedRequestCount),a=t.corkedRequestsFree;a.entry=n;for(var o=0;n;)r[o]=n,n=n.next,o+=1;od(e,t,!0,t.length,r,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new fd(t)}else{for(;n;){var i=n.chunk;if(od(e,t,!1,t.objectMode?1:i.length,i,n.encoding,n.callback),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function ld(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function cd(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function ud(e,t){var n=ld(t);return n&&(0===t.pendingcb?(cd(e,t),t.finished=!0,e.emit("finish")):cd(e,t)),n}function fd(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var a=r.callback;e.pendingcb--,a(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}Uf.prototype.read=function(e){qf("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return qf("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Xf(this):$f(this),null;if(0===(e=Hf(e,t))&&t.ended)return 0===t.length&&Xf(this),null;var r,a=t.needReadable;return qf("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&qf("length less than watermark",a=!0),t.ended||t.reading?qf("reading or ended",a=!1):a&&(qf("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=Hf(n,t))),null===(r=e>0?Zf(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Xf(this)),null!==r&&this.emit("data",r),r},Uf.prototype._read=function(e){this.emit("error",new Error("not implemented"))},Uf.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,qf("pipe count=%d opts=%j",r.pipesCount,t);var a=t&&!1===t.end?c:i;function o(e){qf("onunpipe"),e===n&&c()}function i(){qf("onend"),e.end()}r.endEmitted?kt(a):n.once("end",a),e.on("unpipe",o);var s=function(e){return function(){var t=e._readableState;qf("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,Kf(e))}}(n);e.on("drain",s);var l=!1;function c(){qf("cleanup"),e.removeListener("close",p),e.removeListener("finish",h),e.removeListener("drain",s),e.removeListener("error",d),e.removeListener("unpipe",o),n.removeListener("end",i),n.removeListener("end",c),n.removeListener("data",f),l=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||s()}var u=!1;function f(t){qf("ondata"),u=!1,!1!==e.write(t)||u||((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==ed(r.pipes,e))&&!l&&(qf("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,u=!0),n.pause())}function d(t){qf("onerror",t),m(),e.removeListener("error",d),0===e.listeners("error").length&&e.emit("error",t)}function p(){e.removeListener("finish",h),m()}function h(){qf("onfinish"),e.removeListener("close",p),m()}function m(){qf("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",p),e.once("finish",h),e.emit("pipe",n),r.flowing||(qf("pipe resume"),n.resume()),e},Uf.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)n[a].emit("unpipe",this);return this}var o=ed(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},Uf.prototype.addListener=Uf.prototype.on=function(e,t){var n=nf.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&$f(this):kt(Jf,this))}return n},Uf.prototype.resume=function(){var e=this._readableState;return e.flowing||(qf("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,kt(Yf,e,t))}(this,e)),this},Uf.prototype.pause=function(){return qf("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(qf("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Uf.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var a in e.on("end",(function(){if(qf("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(a){qf("wrapped data"),t.decoder&&(a=t.decoder.write(a)),t.objectMode&&null==a||(t.objectMode||a&&a.length)&&(r.push(a)||(n=!0,e.pause()))})),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));return function(t,n){for(var a=0,o=t.length;a<o;a++)e.on(i=t[a],r.emit.bind(r,i));var i}(["error","close","destroy","pause","resume"]),r._read=function(t){qf("wrapped _read",t),n&&(n=!1,e.resume())},r},Uf._fromList=Zf,ad.WritableState=rd,cf(ad,nf),rd.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},ad.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ad.prototype.write=function(e,t,n){var r=this._writableState,a=!1;return"function"==typeof t&&(n=t,t=null),Zt.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=td),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),kt(t,n)}(this,n):function(e,t,n,r){var a=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):Zt.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),kt(r,o),a=!1),a}(this,r,e,n)&&(r.pendingcb++,a=function(e,t,n,r,a){n=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Zt.from(t,n)),t}(t,n,r),Zt.isBuffer(n)&&(r="buffer");var o=t.objectMode?1:n.length;t.length+=o;var i=t.length<t.highWaterMark;if(i||(t.needDrain=!0),t.writing||t.corked){var s=t.lastBufferedRequest;t.lastBufferedRequest=new nd(n,r,a),s?s.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else od(e,t,!1,o,n,r,a);return i}(this,r,e,t,n)),a},ad.prototype.cork=function(){this._writableState.corked++},ad.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||sd(this,e))},ad.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},ad.prototype._write=function(e,t,n){n(new Error("not implemented"))},ad.prototype._writev=null,ad.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,ud(e,t),n&&(t.finished?kt(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},cf(md,Uf);for(var dd=Object.keys(ad.prototype),pd=0;pd<dd.length;pd++){var hd=dd[pd];md.prototype[hd]||(md.prototype[hd]=ad.prototype[hd])}function md(e){if(!(this instanceof md))return new md(e);Uf.call(this,e),ad.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",gd)}function gd(){this.allowHalfOpen||this._writableState.ended||kt(yd,this)}function yd(e){e.end()}function vd(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var a=r.writecb;if(!a)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),a(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function bd(e){if(!(this instanceof bd))return new bd(e);md.call(this,e),this._transformState=new vd(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){_d(t,e)})):_d(t)}))}function _d(e,t){if(t)return e.emit("error",t);var n=e._transformState;if(e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function wd(e){if(!(this instanceof wd))return new wd(e);bd.call(this,e)}function xd(){nf.call(this)}function Sd(e){return e.replace(/%([0-9A-Fa-f]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))}function Ed(e,t){return String(t).replace(e,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0");return"%".concat(t)}))}function kd(e){return Ed(/[\n;\r\t=%&,\x00-\x1f\x7f-\xff]/g,e)}function Ad(e){return Ed(/[\n\r\t%\x00-\x1f\x7f-\xff]/g,e)}function Cd(e){if(!e||!e.length||"."===e)return{};var t={};return e.replace(/\r?\n$/,"").split(";").forEach((function(e){var n,r=e.split("=",2);if(r[1]&&r[1].length){r[0]=r[0].trim();var a=t[r[0].trim()];a||(t[r[0]]=a=[]),(n=a).push.apply(n,he(r[1].split(",").map((function(e){return e.trim()})).map(Sd)))}})),t}function Od(e){var t=e.split("\t").map((function(e){return"."===e||""===e?null:e}));return{seq_id:t[0]&&Sd(t[0]),source:t[1]&&Sd(t[1]),type:t[2]&&Sd(t[2]),start:null===t[3]?null:parseInt(t[3],10),end:null===t[4]?null:parseInt(t[4],10),score:null===t[5]?null:parseFloat(t[5]),strand:t[6],phase:t[7],attributes:null===t[8]?null:Cd(t[8])}}function Td(e){var t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;var n=de(t,2)[1],r=de(t,3)[2],a={directive:n};if(r.length&&(r=r.replace(/\r?\n$/,""),a.value=r),"sequence-region"===n){var o=r.split(/\s+/,3);return V(V({},a),{},{seq_id:o[0],start:o[1]&&o[1].replace(/\D/g,""),end:o[2]&&o[2].replace(/\D/g,"")})}if("genome-build"===n){var i=de(r.split(/\s+/,2),2),s=i[0],l=i[1];return V(V({},a),{},{source:s,buildName:l})}return a}function Nd(e){var t=[];return Object.entries(e).forEach((function(e){var n,r=de(e,2),a=r[0],o=r[1];o&&(n=o.hasOwnProperty("toString")?kd(o.toString()):Array.isArray(o)?o.map(kd).join(","):kd(o),t.push("".concat(kd(a),"=").concat(n)))})),t.length?t.join(";"):"."}function Rd(e,t){var n=null==e.attributes?".":Nd(e.attributes),r=[null===e.seq_id?".":Ad(e.seq_id),null===e.source?".":Ad(e.source),null===e.type?".":Ad(e.type),null===e.start?".":Ad(e.start),null===e.end?".":Ad(e.end),null===e.score?".":Ad(e.score),null===e.strand?".":Ad(e.strand),null===e.phase?".":Ad(e.phase),n],a="".concat(r.join("\t"),"\n");return t[a]?"":(t[a]=!0,a)}function Id(e,t){if(Array.isArray(e))return e.map((function(e){return Id(e,t)})).join("");var n,r=[Rd(e,t)];return void 0!==(n=e).child_features&&void 0!==n.derived_features&&r.push.apply(r,he(e.child_features.map((function(e){return Id(e,t)}))).concat(he(e.derived_features.map((function(e){return Id(e,t)}))))),r.join("")}function Pd(e){return Id(e,{})}function Fd(e){var t="##".concat(e.directive);return e.value&&(t+=" ".concat(e.value)),t+"\n"}function Md(e){return"# ".concat(e.comment,"\n")}function jd(e){return">".concat(e.id).concat(e.description?" ".concat(e.description):"","\n").concat(e.sequence,"\n")}function Dd(e){function t(e){return"attributes"in e?Pd(e):"directive"in e?Fd(e):"sequence"in e?jd(e):"comment"in e?Md(e):"# (invalid item found during format)\n"}return Array.isArray(e)?e.map(t):t(e)}cf(bd,md),bd.prototype.push=function(e,t){return this._transformState.needTransform=!1,md.prototype.push.call(this,e,t)},bd.prototype._transform=function(e,t,n){throw new Error("Not implemented")},bd.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},bd.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},cf(wd,bd),wd.prototype._transform=function(e,t,n){n(null,e)},cf(xd,nf),xd.Readable=Uf,xd.Writable=ad,xd.Duplex=md,xd.Transform=bd,xd.PassThrough=wd,xd.Stream=xd,xd.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function a(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",a),e._isStdio||t&&!1===t.end||(n.on("end",i),n.on("close",s));var o=!1;function i(){o||(o=!0,e.end())}function s(){o||(o=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(c(),0===nf.listenerCount(this,"error"))throw e}function c(){n.removeListener("data",r),e.removeListener("drain",a),n.removeListener("end",i),n.removeListener("close",s),n.removeListener("error",l),e.removeListener("error",l),n.removeListener("end",c),n.removeListener("close",c),e.removeListener("close",c)}return n.on("error",l),e.on("error",l),n.on("end",c),n.on("close",c),e.on("close",c),e.emit("pipe",n),e};var Ld={__proto__:null,unescape:Sd,escape:kd,escapeColumn:Ad,parseAttributes:Cd,parseFeature:Od,parseDirective:Td,formatAttributes:Nd,formatFeature:Pd,formatDirective:Fd,formatComment:Md,formatSequence:jd,formatItem:Dd},qd=function(){function e(t){X(this,e),this.seqCallback=t,this.currentSequence=void 0}return ee(e,[{key:"addLine",value:function(e){var t=/^>\s*(\S+)\s*(.*)/.exec(e);t?(this._flush(),this.currentSequence={id:t[1],sequence:""},t[2]&&(this.currentSequence.description=t[2].trim())):this.currentSequence&&/\S/.test(e)&&(this.currentSequence.sequence+=e.replace(/\s/g,""))}},{key:"_flush",value:function(){this.currentSequence&&this.seqCallback(this.currentSequence)}},{key:"finish",value:function(){this._flush()}}]),e}(),Bd=function(){function e(t){X(this,e),this.fastaParser=void 0,this.eof=!1,this.lineNumber=0,this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},this._underConstructionOrphans={};var n=function(){};this.featureCallback=t.featureCallback||n,this.endCallback=t.endCallback||n,this.commentCallback=t.commentCallback||n,this.errorCallback=t.errorCallback||n,this.directiveCallback=t.directiveCallback||n,this.sequenceCallback=t.sequenceCallback||n,this.bufferSize=void 0===t.bufferSize?1e3:t.bufferSize}return ee(e,[{key:"addLine",value:function(e){if(this.fastaParser)this.fastaParser.addLine(e);else if(!this.eof)if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))this._bufferLine(e);else{var t=/^\s*(#+)(.*)/.exec(e);if(t){var n=de(t,2)[1],r=de(t,3)[2];if(3===n.length)this._emitAllUnderConstructionFeatures();else if(2===n.length){var a=Td(e);a&&("FASTA"===a.directive?(this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new qd(this.sequenceCallback)):this._emitItem(a))}else r=r.replace(/\s*/,""),this._emitItem({comment:r})}else if(/^\s*$/.test(e));else{if(!/^\s*>/.test(e)){var o=e.replace(/\r?\n?$/g,"");throw new Error("GFF3 parse error.  Cannot parse '".concat(o,"'."))}this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new qd(this.sequenceCallback),this.fastaParser.addLine(e)}}}},{key:"finish",value:function(){this._emitAllUnderConstructionFeatures(),this.fastaParser&&this.fastaParser.finish(),this.endCallback()}},{key:"_emitItem",value:function(e){Array.isArray(e)?this.featureCallback(e):"directive"in e?this.directiveCallback(e):"comment"in e&&this.commentCallback(e)}},{key:"_enforceBufferSizeLimit",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=function t(n){n&&Array.isArray(n)&&n[0].attributes&&n[0].attributes.ID&&n[0].attributes.ID[0]&&(n[0].attributes.ID.forEach((function(t){delete e._underConstructionById[t],delete e._completedReferences[t]})),n.forEach((function(e){e.child_features&&e.child_features.forEach((function(e){return t(e)})),e.derived_features&&e.derived_features.forEach((function(e){return t(e)}))})))};this._underConstructionTopLevel.length+t>this.bufferSize;){var r=this._underConstructionTopLevel.shift();r&&(this._emitItem(r),n(r))}}},{key:"_emitAllUnderConstructionFeatures",value:function(){if(this._underConstructionTopLevel.forEach(this._emitItem.bind(this)),this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},Array.from(Object.values(this._underConstructionOrphans)).length)throw new Error("some features reference other features that do not exist in the file (or in the same '###' scope). ".concat(JSON.stringify(this._underConstructionOrphans)))}},{key:"_bufferLine",value:function(e){var t,n,r,a=this,o=V(V({},Od(e)),{},{child_features:[],derived_features:[]}),i=(null===(t=o.attributes)||void 0===t?void 0:t.ID)||[],s=(null===(n=o.attributes)||void 0===n?void 0:n.Parent)||[],l=(null===(r=o.attributes)||void 0===r?void 0:r.Derives_from)||[];if(i.length||s.length||l.length){var c=void 0;i.forEach((function(e){var t=a._underConstructionById[e];t?(t[t.length-1].type!==o.type&&a._parseError('multi-line feature "'.concat(e,'" has inconsistent types: "').concat(o.type,'", "').concat(t[t.length-1].type,'"')),t.push(o),c=t):(c=[o],a._enforceBufferSizeLimit(1),s.length||l.length||a._underConstructionTopLevel.push(c),a._underConstructionById[e]=c,a._resolveReferencesTo(c,e))})),this._resolveReferencesFrom(c||[o],{Parent:s,Derives_from:l},i)}else this._emitItem([o])}},{key:"_resolveReferencesTo",value:function(e,t){var n=this._underConstructionOrphans[t];n&&(e.forEach((function(e){var t;(t=e.child_features).push.apply(t,he(n.Parent))})),e.forEach((function(e){var t;(t=e.derived_features).push.apply(t,he(n.Derives_from))})),delete this._underConstructionOrphans[t])}},{key:"_parseError",value:function(e){this.eof=!0,this.errorCallback("".concat(this.lineNumber,": ").concat(e))}},{key:"_resolveReferencesFrom",value:function(e,t,n){var r=this;function a(e,t,n){var r=e[t];r||(e[t]=r={});var a=r[n]||!1;return r[n]=!0,a}t.Parent.forEach((function(t){var o=r._underConstructionById[t];if(o)n.filter((function(e){return a(r._completedReferences,e,"Parent,".concat(t))})).length||o.forEach((function(t){t.child_features.push(e)}));else{var i=r._underConstructionOrphans[t];i||(r._underConstructionOrphans[t]=i={Parent:[],Derives_from:[]}),i.Parent.push(e)}})),t.Derives_from.forEach((function(t){var o=r._underConstructionById[t];if(o)n.filter((function(e){return a(r._completedReferences,e,"Derives_from,".concat(t))})).length||o.forEach((function(t){t.derived_features.push(e)}));else{var i=r._underConstructionOrphans[t];i||(r._underConstructionOrphans[t]=i={Parent:[],Derives_from:[]}),i.Derives_from.push(e)}}))}}]),e}();function Ud(e){Lt&&kt?kt(e):e()}function zd(e){var t=V({encoding:"utf8",parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1,bufferSize:1e3},e);return e.parseAll&&(t.parseFeatures=!0,t.parseDirectives=!0,t.parseComments=!0,t.parseSequences=!0),t}var Gd=function(e){ne(n,e);var t=ue(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};X(this,n),(e=t.call(this,{objectMode:!0})).textBuffer="";var a=zd(r);e.encoding=r.encoding||"utf8",e.decoder=new Mf;var o=e.push.bind(ce(e));return e.parser=new Bd({featureCallback:a.parseFeatures?o:void 0,directiveCallback:a.parseDirectives?o:void 0,commentCallback:a.parseComments?o:void 0,sequenceCallback:a.parseSequences?o:void 0,errorCallback:function(t){return e.emit("error",t)},bufferSize:a.bufferSize}),e}return ee(n,[{key:"_addLine",value:function(e){e&&this.parser.addLine(e)}},{key:"_nextText",value:function(e){var t=this,n=(this.textBuffer+e).split(/\r?\n/);this.textBuffer=n.pop()||"",n.forEach((function(e){return t._addLine(e)}))}},{key:"_transform",value:function(e,t,n){this._nextText(this.decoder.write(e)),Ud(n)}},{key:"_flush",value:function(e){this.decoder.end&&this._nextText(this.decoder.end()),null!=this.textBuffer&&this._addLine(this.textBuffer),this.parser.finish(),Ud(e)}}]),n}(bd),Hd=function(e){ne(n,e);var t=ue(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return X(this,n),(e=t.call(this,Object.assign(r,{objectMode:!0}))).linesSinceLastSyncMark=0,e.haveWeEmittedData=!1,e.fastaMode=!1,e.minLinesBetweenSyncMarks=r.minSyncLines||100,e.insertVersionDirective=r.insertVersionDirective||!1,e}return ee(n,[{key:"_transform",value:function(e,t,n){var r;if(!this.haveWeEmittedData&&this.insertVersionDirective){var a=Array.isArray(e)?e[0]:e;"directive"in a&&"gff-version"!==a.directive&&this.push("##gff-version 3\n")}if("sequence"in e&&!this.fastaMode&&(this.push("##FASTA\n"),this.fastaMode=!0),r=Array.isArray(e)?e.map(Dd).join(""):Dd(e),this.push(r),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)this.push("###\n"),this.linesSinceLastSyncMark=0;else{for(var o=0,i=0;i<r.length;i+=1)"\n"===r[i]&&(o+=1);this.linesSinceLastSyncMark+=o}this.haveWeEmittedData=!0,Ud(n)}}]),n}(bd),$d={parseStream:function(){return new Gd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},parseStringSync:function(e){if(!e)return[];var t=zd(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),n=[],r=n.push.bind(n),a=new Bd({featureCallback:t.parseFeatures?r:void 0,directiveCallback:t.parseDirectives?r:void 0,commentCallback:t.parseComments?r:void 0,sequenceCallback:t.parseSequences?r:void 0,bufferSize:Infinity,errorCallback:function(e){throw e}});return e.split(/\r?\n/).forEach(a.addLine.bind(a)),a.finish(),n},formatSync:function(e){var t=[],n=[];e.forEach((function(e){"sequence"in e?n.push(e):t.push(e)}));var r=t.map(Dd).join("");return n.length&&(r+="##FASTA\n",r+=n.map(jd).join("")),r},formatStream:function(){return new Hd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},formatFile:function(e,t){var n=V({insertVersionDirective:!0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});return new Promise((function(r,a){e.pipe(new Hd(n)).on("end",(function(){return r(null)})).on("error",a).pipe(t)}))},util:Ld};async function Wd(e,t,n){const r=$d.parseStringSync(t,{parseSequences:!0,parseComments:!0,parseDirectives:!1,parseFeatures:!0});if(0===r.length)throw new Error("No features found in GFF3 file");let a=0,o=n.assemblies.get(e);o||(o=n.addAssembly(e,"InMemoryFileDriver"));for(const e of r)if(Array.isArray(e)){const t=tr.gff3ToAnnotationFeature(e),n=o.refSeqs.get(t.refSeq)??o.addRefSeq(t.refSeq,t.refSeq);n.features.has(t._id)||n.addFeature(t)}else if("comment"in e)o.addComment(e.comment);else{a++;let t=o.refSeqs.get(e.id);t||(t=o.addRefSeq(e.id,e.id,e.description)),e.description&&!t.description&&t.setDescription(e.description),t.addSequence({start:0,stop:e.sequence.length,sequence:e.sequence})}if(0===a)throw new Error("No embedded FASTA section found in GFF3");const i=await Vd(o);return n.addCheckResults(i),o}async function Vd(e){const t=[];for(const n of e.refSeqs.values())for(const e of n.features.values())for(const r of B.checkRegistry.getChecks().values()){const a=await r.checkFeature(l.getSnapshot(e),((e,t)=>Promise.resolve(n.getSequence(e,t))));t.push(...a)}return t}function Jd(e){const{attributes:t}=e,n=t.get("gff_name");return n?n[0]:""}function Yd(e){const{attributes:t}=e,n=t.get("gff_id"),r=t.get("transcript_id"),a=t.get("exon_id"),o=t.get("protein_id");return n?n[0]:r?r[0]:a?a[0]:o?o[0]:""}function Kd(e){const t=Jd(e),n=Yd(e);return t?`: ${t}`:n?`: ${n}`:""}function Zd(e,t=!1){const n=[];if(!e.featureAndGlyphUnderMouse)return n;n.push(e.featureAndGlyphUnderMouse.feature);for(const t of function(e){const t=[];let{parent:n}=e;for(;n;)t.push(n),({parent:n}=n);return t}(e.featureAndGlyphUnderMouse.feature))n.push(t);const{bp:r}=e,a=function(e){const t=[];if(e.children)for(const[,n]of e.children)t.push(n);return t}(e.featureAndGlyphUnderMouse.feature);for(const e of a)e.min<r&&e.max>=r&&n.push(e);if(!t)return n;if(e.featureAndGlyphUnderMouse.feature.parent){const t=e.featureAndGlyphUnderMouse.feature.parent.children;if(t)for(const[,a]of t)a._id!=e.featureAndGlyphUnderMouse.feature._id&&a.min<r&&a.max>=r&&n.push(a)}return n}function Xd(e,t,n,r){const a=r.bpToPx({refName:t,coord:e.min,regionNumber:n}),o=r.bpToPx({refName:t,coord:e.max,regionNumber:n});if(void 0===a||void 0===o)return;const{offsetPx:i}=r;return[a.offsetPx-i,o.offsetPx-i]}function Qd(e,t,n){const[r,a]=n;if(!(Math.abs(a-r)<8))return Math.abs(r-t)<4?{feature:e,edge:"min"}:Math.abs(a-t)<4?{feature:e,edge:"max"}:void 0}function ep(e,t,n){const r=[{featureId:e._id,oldLocation:e[n],newLocation:t}],{parent:a}=e;return a&&("min"===n&&a[n]>t||"max"===n&&a[n]<t)&&r.push(...ep(a,t,n)),r}function tp(e,t,n,r,a){const o=e._id,i=[{featureId:o,oldLocation:e[n],newLocation:t}],{parent:s,children:l}=e;if(l)for(const[,e]of l)e._id!==a&&("min"===n&&e[n]<t||"max"===n&&e[n]>t)&&i.push(...tp(e,t,n,r));if(s&&r){const e=[];if(s.children)for(const[,t]of s.children)t._id!==o&&e.push(t);if(0===e.length)i.push(...tp(s,t,n,r,o));else{const a=s[n],l=Math[n](...e.map((e=>e[n])),t);l!==a&&i.push(...tp(s,l,n,r,o))}}return i}function np(e,t,n,r=!1){const a=e[n];if(t===a)throw new Error(`New and existing locations are the same: "${t}"`);return"min"===n?t>a?tp(e,t,n,r):ep(e,t,n):t<a?tp(e,t,n,r):ep(e,t,n)}async function rp(e,t){let n;try{n=await e.text()}catch{n=""}return`${t?`${t} — `:""}${e.status} ${e.statusText}${n?` (${n})`:""}`}var ap={},op=Cc.exports;Object.defineProperty(ap,"__esModule",{value:!0});var ip=ap.default=void 0;ip=ap.default=(0,op(Oc).default)((0,T.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),"Info");var sp={},lp=Cc.exports;Object.defineProperty(sp,"__esModule",{value:!0});var cp=sp.default=void 0;cp=sp.default=(0,lp(Oc).default)((0,T.default.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"Link");var up={},fp=Cc.exports;Object.defineProperty(up,"__esModule",{value:!0});var dp=up.default=void 0;dp=up.default=(0,fp(Oc).default)((0,T.default.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonChecked");var pp={},hp=Cc.exports;Object.defineProperty(pp,"__esModule",{value:!0});var mp=pp.default=void 0;mp=pp.default=(0,hp(Oc).default)((0,T.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked");var gp={},yp=Cc.exports;Object.defineProperty(gp,"__esModule",{value:!0});var vp=gp.default=void 0;vp=gp.default=(0,yp(Oc).default)((0,T.default.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");const bp=f.makeStyles()((e=>({dialogTitle:{background:e.palette.primary.main,color:e.palette.primary.contrastText,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1.5),color:e.palette.primary.contrastText}}))),_p=p.observer((function(e){const{classes:t}=bp(),{handleClose:n,title:r,...a}=e;return R.default.createElement(d.Dialog,{...a,header:R.default.createElement(R.default.Fragment,null,R.default.createElement(c.DialogTitle,{className:t.dialogTitle},r),R.default.createElement(c.IconButton,{"aria-label":"close",onClick:n,className:t.closeButton},R.default.createElement(vp,null)))})}));var wp;!function(e){e.GFF3="text/x-gff3",e.FASTA="text/x-fasta",e.BGZIP_FASTA="application/x-bgzip-fasta",e.FAI="text/x-fai",e.GZI="application/x-gzi",e.EXTERNAL="text/x-external"}(wp||(wp={}));const xp=f.makeStyles()((e=>({accordion:{border:`1px solid ${e.palette.divider}`,"&:not(:last-child)":{borderBottom:0}},accordionSummary:{flexDirection:"row-reverse"},accordionDetails:{padding:e.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"},radioIcon:{color:e?.palette?.tertiary?.contrastText},dialog:{minWidth:550,maxWidth:800}})));function Sp(e,t,n,r,a,o,i,s,l){return!(!e||!(t&&r||n===wp.GFF3&&r||r&&a&&o||i&&s&&l))}function Ep({changeManager:e,handleClose:t,session:n}){const{classes:a}=xp(),{internetAccounts:o}=l.getRoot(n),{notify:i}=n,s=o.filter((e=>"ApolloInternetAccount"===e.type));if(0===s.length)throw new Error("No Apollo internet account found");const[f,d]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(!1),[y,v]=u.useState(wp.BGZIP_FASTA),[b,_]=u.useState(!0),[w,x]=u.useState(!1),[S,E]=u.useState(!1),[k,A]=u.useState(null),[C,O]=u.useState(null),[T,N]=u.useState(null),[I,P]=u.useState(""),[F,M]=u.useState(""),[j,D]=u.useState(""),[L,q]=u.useState(!1),[B,U]=u.useState(!1);async function z(e,t){const{jobsManager:r}=n,a=new AbortController,[{baseURL:o,getFetcher:i}]=s,l=new URL("files",o);l.searchParams.set("type",t);const c=l.href,u=new FormData;let d=e.name;t===wp.FAI||t===wp.GZI?d=`${d}.txt`:B&&!e.name.toLocaleLowerCase().endsWith(".gz")?d=`${d}.gz`:!B&&e.name.toLocaleLowerCase().endsWith(".gz")&&(d=`${d}.txt`),u.append("file",e,d),u.append("type",t);const p=i({locationType:"UriLocation",uri:c});if(p){const t={name:`UploadAssemblyFile for ${f}`,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{a.abort(),r.abortJob(t.name)}};r.runJob(t),r.update(t.name,`Uploading ${e.name}, this may take awhile`);const{signal:n}=a,o=await p(c,{method:"POST",body:u,signal:n});if(!o.ok){const e=await rp(o,"Error when inserting new assembly (while uploading file)");return r.abortJob(t.name,e),h(e),""}const i=(await o.json())._id;return r.done(t),i}throw new Error("Failed to fetch")}u.useEffect((()=>{M(I?`${I}.fai`:"")}),[I]),u.useEffect((()=>{D(I?`${I}.gzi`:"")}),[I]),u.useEffect((()=>{U(!w&&y!==wp.GFF3||!!k?.name.toLocaleLowerCase().endsWith(".gz"))}),[k,w,y]);let G=!1;try{const e=new URL(I);"http:"!==e.protocol&&"https:"!==e.protocol||(G=!0)}catch{}let H=!1;try{const e=new URL(F);"http:"!==e.protocol&&"https:"!==e.protocol||(H=!0)}catch{}let $=!1;try{const e=new URL(j);"http:"!==e.protocol&&"https:"!==e.protocol||($=!0)}catch{}const[W,V]=R.default.useState("panelFastaInput"),J=e=>(t,n)=>{n&&V(e),U("panelGffInput"!==e)};return R.default.createElement(_p,{open:!0,handleClose:t,"data-testid":"add-assembly-dialog",title:"Add new assembly",maxWidth:!1},R.default.createElement("form",{onSubmit:async function(n){let r;if(n.preventDefault(),h(""),E(!0),q(!0),i(`Assembly "${f}" is being added`,"info"),t(),n.preventDefault(),y===wp.EXTERNAL)r=new tr.AddAssemblyFromExternalChange({typeName:"AddAssemblyFromExternalChange",assembly:(new Vn).toHexString(),assemblyName:f,externalLocation:{fa:I,fai:F,gzi:j}});else{if(!k)throw new Error("Missing fasta file");if(y===wp.GFF3&&b){const e=await z(k,wp.GFF3);r=new tr.AddAssemblyAndFeaturesFromFileChange({typeName:"AddAssemblyAndFeaturesFromFileChange",assembly:(new Vn).toHexString(),assemblyName:f,fileIds:{fa:e}})}else if(y===wp.GFF3){const e=await z(k,wp.GFF3);r=new tr.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Vn).toHexString(),assemblyName:f,fileIds:{fa:e}})}else if(w){const e=await z(k,wp.FASTA);r=new tr.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Vn).toHexString(),assemblyName:f,fileIds:{fa:e}})}else{if(!C||!T)throw new Error("Missing fasta index files");const e=await z(k,wp.BGZIP_FASTA),t=await z(C,wp.FAI),n=await z(T,wp.GZI);r=new tr.AddAssemblyFromFileChange({typeName:"AddAssemblyFromFileChange",assembly:(new Vn).toHexString(),assemblyName:f,fileIds:{fa:e,fai:t,gzi:n}})}}const[{internetAccountId:a}]=s;await e.submit(r,{internetAccountId:a,updateJobsManager:!0}),E(!1),q(!1)},"data-testid":"submit-form"},R.default.createElement(c.DialogContent,{className:a.dialog},L?R.default.createElement(c.LinearProgress,null):null,R.default.createElement(c.TextField,{margin:"dense",id:"name",label:"Assembly name",type:"TextField",fullWidth:!0,variant:"outlined",onChange:e=>{E(!1),d(e.target.value),function(e){const{assemblies:t}=n;t.find((t=>r.readConfObject(t,"displayName")===e))?(g(!1),h(`Assembly ${e} already exists.`)):(g(!0),h(""))}(e.target.value)},disabled:S&&!p}),R.default.createElement(c.Accordion,{disableGutters:!0,elevation:0,square:!0,className:a.accordion,expanded:"panelFastaInput"===W,onChange:J("panelFastaInput")},R.default.createElement(c.AccordionSummary,{className:a.accordionSummary,expandIcon:"panelFastaInput"===W?R.default.createElement(dp,{className:a.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):R.default.createElement(mp,{className:a.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelFastaInputd-content",id:"panelFastaInputd-header"},R.default.createElement(c.Typography,{component:"span"},"FASTA input")),R.default.createElement(c.AccordionDetails,{className:a.accordionDetails},R.default.createElement(c.FormGroup,null,R.default.createElement(c.FormControlLabel,{"data-testid":"files-on-url-checkbox",control:R.default.createElement(c.Checkbox,{onChange:()=>{v(y===wp.EXTERNAL?wp.BGZIP_FASTA:wp.EXTERNAL),y===wp.EXTERNAL&&x(!1)},checked:y===wp.EXTERNAL,disabled:w&&y!==wp.GFF3}),label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Use external URLs",R.default.createElement(c.Tooltip,{title:"Use external URLs to provide FASTA and index files. Does not copy the files to the Apollo collaboration server, so ensure the URLs are stable.",placement:"top-start"},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))}),R.default.createElement(c.FormControlLabel,{"data-testid":"sequence-is-editable-checkbox",control:R.default.createElement(c.Checkbox,{onChange:()=>{x(!w)}}),checked:w,disabled:y===wp.EXTERNAL,label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Store sequence in database",R.default.createElement(c.Tooltip,{title:"Enables users to edit the genomic sequence, but comes with performance impacts. Use with care.",placement:"top-start"},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))}),R.default.createElement(c.FormControlLabel,{"data-testid":"fasta-is-gzip-checkbox",control:R.default.createElement(c.Checkbox,{checked:B,onChange:()=>{U(!w||!B)},disabled:!w}),label:"FASTA is gzip compressed"}),R.default.createElement(c.Table,{size:"small",sx:{mt:2}},y===wp.BGZIP_FASTA||y===wp.GFF3?R.default.createElement(c.TableBody,null,R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement(c.Box,{display:"flex",alignItems:"center"},R.default.createElement("span",null,"FASTA"),R.default.createElement(c.Tooltip,{title:'Unless "Store sequence in database" enabled, FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent). Compression is optional for sequences stored in the database.'},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement("input",{"data-testid":"fasta-input-file",type:"file",onChange:e=>{A(e.target.files?.item(0)??null)},disabled:S&&!p}))),R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement("input",{"data-testid":"fai-input-file",type:"file",onChange:e=>{O(e.target.files?.item(0)??null)},disabled:S&&!p||w}))),R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement("input",{"data-testid":"gzi-input-file",type:"file",onChange:e=>{N(e.target.files?.item(0)??null)},disabled:S&&!p||w})))):R.default.createElement(c.TableBody,null,R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement(c.Box,{display:"flex",alignItems:"center"},R.default.createElement("span",null,"FASTA"),R.default.createElement(c.Tooltip,{title:"Remote FASTA input must be compressed with bgzip and indexed with samtools faidx (or equivalent)"},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement(c.TextField,{"data-testid":"fasta-input-url",variant:"outlined",value:I,error:!G,onChange:e=>{P(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:R.default.createElement(c.InputAdornment,{position:"start"},R.default.createElement(cp,null))}}}))),R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA index (.fai)"),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement(c.TextField,{"data-testid":"fai-input-url",variant:"outlined",value:F,error:!H,onChange:e=>{M(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:R.default.createElement(c.InputAdornment,{position:"start"},R.default.createElement(cp,null))}}}))),R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},"FASTA binary index (.gzi)"),R.default.createElement(c.TableCell,{style:{borderBottomWidth:0}},R.default.createElement(c.TextField,{"data-testid":"gzi-input-url",variant:"outlined",value:j,error:!$,onChange:e=>{D(e.target.value)},disabled:S&&!p,slotProps:{input:{startAdornment:R.default.createElement(c.InputAdornment,{position:"start"},R.default.createElement(cp,null))}}})))))))),R.default.createElement(c.Accordion,{disableGutters:!0,elevation:0,square:!0,className:a.accordion,expanded:"panelGffInput"===W,onChange:J("panelGffInput")},R.default.createElement(c.AccordionSummary,{className:a.accordionSummary,expandIcon:"panelGffInput"===W?R.default.createElement(dp,{className:a.radioIcon,sx:{fontSize:"1.2rem",ml:5}}):R.default.createElement(mp,{className:a.radioIcon,sx:{fontSize:"1.2rem",mr:5}}),"aria-controls":"panelGffInputd-content"},R.default.createElement(c.Typography,{component:"span"},"GFF3 input",R.default.createElement(c.Tooltip,{title:"GFF3 must includes FASTA sequences. File can be gzip compressed."},R.default.createElement(ip,{className:a.radioIcon,sx:{fontSize:18}})))),R.default.createElement(c.AccordionDetails,{className:a.accordionDetails},R.default.createElement(c.Box,{style:{marginTop:20}},R.default.createElement("input",{"data-testid":"gff3-input-file",type:"file",disabled:S&&!p,onChange:e=>{A(e.target.files?.item(0)??null),v(wp.GFF3)}}),R.default.createElement(c.FormGroup,{style:{display:"grid"}},R.default.createElement(c.FormControlLabel,{control:R.default.createElement(c.Checkbox,{checked:b,onChange:()=>{_(!b)},disabled:S&&!p}),label:"Load features from GFF3 file"}),R.default.createElement(c.FormControlLabel,{"data-testid":"gff3-is-gzip-checkbox",control:R.default.createElement(c.Checkbox,{checked:B,onChange:()=>{U(!B)},disabled:S&&!p}),label:"GFF3 is gzip compressed"})))))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!Sp(m,w,y,k,C,T,G,H,$)||S,variant:"contained",type:"submit","data-testid":"submit-button"},S?"Submitting...":"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},p)):null)}var kp,Ap,Cp=function(e,t){return t.some((function(t){return e instanceof t}))},Op=new WeakMap,Tp=new WeakMap,Np=new WeakMap,Rp=new WeakMap,Ip=new WeakMap,Pp={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Tp.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Np.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Mp(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function Fp(e){Pp=e(Pp)}function Mp(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var r=function(){t.removeEventListener("success",a),t.removeEventListener("error",o)},a=function(){e(Mp(t.result)),r()},o=function(){n(t.error),r()};t.addEventListener("success",a),t.addEventListener("error",o)}))).then((function(e){e instanceof IDBCursor&&Op.set(e,t)})).catch((function(){})),Ip.set(n,t),n;var t,n;if(Rp.has(e))return Rp.get(e);var r=function(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ap||(Ap=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(jp(this),n),Mp(Op.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Mp(t.apply(jp(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=t.call.apply(t,[jp(this),e].concat(r));return Np.set(o,e.sort?e.sort():[e]),Mp(o)}:(e instanceof IDBTransaction&&function(e){if(!Tp.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=function(){t(),r()},o=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)}));Tp.set(e,t)}}(e),Cp(e,kp||(kp=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Pp):e);var t}(e);return r!==e&&(Rp.set(e,r),Ip.set(r,e)),r}var jp=function(e){return Ip.get(e)},Dp=["get","getKey","getAll","getAllKeys","count"],Lp=["put","add","delete","clear"],qp=new Map;function Bp(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(qp.get(t))return qp.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=Lp.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||Dp.includes(n))){var o=function(){var e=Z(J().mark((function e(t){var o,i,s,l,c,u,f=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=this.transaction(t,a?"readwrite":"readonly"),s=i.store,l=f.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=f[u];return r&&(s=s.index(c.shift())),e.next=6,Promise.all([(o=s)[n].apply(o,c),a&&i.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return qp.set(t,o),o}}}Fp((function(e){return V(V({},e),{},{get:function(t,n,r){return Bp(t,n)||e.get(t,n,r)},has:function(t,n){return!!Bp(t,n)||e.has(t,n)}})}));var Up=["continue","continuePrimaryKey","advance"],zp={},Gp=new WeakMap,Hp=new WeakMap,$p={get:function(e,t){if(!Up.includes(t))return e[t];var n=zp[t];return n||(n=zp[t]=function(){var e;Gp.set(this,(e=Hp.get(this))[t].apply(e,arguments))}),n}};function Wp(){return Vp.apply(this,arguments)}function Vp(){var e;return e=J().mark((function e(){var t,n,r,a=arguments;return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)instanceof IDBCursor){e.next=5;break}return e.next=4,$((n=t).openCursor.apply(n,a));case 4:t=e.sent;case 5:if(t){e.next=7;break}return e.abrupt("return");case 7:r=new Proxy(t,$p),Hp.set(r,t),Ip.set(r,jp(t));case 11:if(!t){e.next=20;break}return e.next=14,r;case 14:return e.next=16,$(Gp.get(r)||t.continue());case 16:t=e.sent,Gp.delete(r),e.next=11;break;case 20:case"end":return e.stop()}}),e,this)})),Vp=function(){return new U(e.apply(this,arguments))},Vp.apply(this,arguments)}function Jp(e,t){return t===Symbol.asyncIterator&&Cp(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&Cp(e,[IDBIndex,IDBObjectStore])}Fp((function(e){return V(V({},e),{},{get:function(t,n,r){return Jp(t,n)?Wp:e.get(t,n,r)},has:function(t,n){return Jp(t,n)||e.has(t,n)}})}));var Yp={},Kp={},Zp={},Xp={},Qp={};Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.isFunction=void 0,Qp.isFunction=function(e){return"function"==typeof e};var eh={},th={},nh={};Object.defineProperty(nh,"__esModule",{value:!0}),nh.createErrorClass=void 0,nh.createErrorClass=function(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t},Object.defineProperty(th,"__esModule",{value:!0}),th.UnsubscriptionError=void 0,th.UnsubscriptionError=nh.createErrorClass((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));var rh={};Object.defineProperty(rh,"__esModule",{value:!0}),rh.arrRemove=void 0,rh.arrRemove=function(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}};var ah=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},oh=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},ih=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(eh,"__esModule",{value:!0}),eh.isSubscription=eh.EMPTY_SUBSCRIPTION=eh.Subscription=void 0;var sh=Qp,lh=th,ch=rh,uh=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var i=ah(o),s=i.next();!s.done;s=i.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(sh.isFunction(l))try{l()}catch(e){a=e instanceof lh.UnsubscriptionError?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=ah(c),f=u.next();!f.done;f=u.next()){var d=f.value;try{fh(d)}catch(e){a=null!=a?a:[],e instanceof lh.UnsubscriptionError?a=ih(ih([],oh(a)),oh(e.errors)):a.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(a)throw new lh.UnsubscriptionError(a)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)fh(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ch.arrRemove(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&ch.arrRemove(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();function fh(e){sh.isFunction(e)?e():e.unsubscribe()}eh.Subscription=uh,eh.EMPTY_SUBSCRIPTION=uh.EMPTY,eh.isSubscription=function(e){return e instanceof uh||e&&"closed"in e&&sh.isFunction(e.remove)&&sh.isFunction(e.add)&&sh.isFunction(e.unsubscribe)};var dh={};Object.defineProperty(dh,"__esModule",{value:!0}),dh.config=void 0,dh.config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ph={},hh={};!function(e){var t=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.timeoutProvider=void 0,e.timeoutProvider={setTimeout:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.timeoutProvider.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,n([r,a],t(o))):setTimeout.apply(void 0,n([r,a],t(o)))})),clearTimeout:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.timeoutProvider.delegate;return((null==n?void 0:n.clearTimeout)||clearTimeout)(t)})),delegate:void 0}}(hh),Object.defineProperty(ph,"__esModule",{value:!0}),ph.reportUnhandledError=void 0;var mh=dh,gh=hh;ph.reportUnhandledError=function(e){gh.timeoutProvider.setTimeout((function(){var t=mh.config.onUnhandledError;if(!t)throw e;t(e)}))};var yh={};Object.defineProperty(yh,"__esModule",{value:!0}),yh.noop=void 0,yh.noop=function(){};var vh={};function bh(e,t,n){return{kind:e,value:t,error:n}}Object.defineProperty(vh,"__esModule",{value:!0}),vh.createNotification=vh.nextNotification=vh.errorNotification=vh.COMPLETE_NOTIFICATION=void 0,vh.COMPLETE_NOTIFICATION=function(){return bh("C",void 0,void 0)}(),vh.errorNotification=function(e){return bh("E",void 0,e)},vh.nextNotification=function(e){return bh("N",e,void 0)},vh.createNotification=bh;var _h={};Object.defineProperty(_h,"__esModule",{value:!0}),_h.captureError=_h.errorContext=void 0;var wh=dh,xh=null;_h.errorContext=function(e){if(wh.config.useDeprecatedSynchronousErrorHandling){var t=!xh;if(t&&(xh={errorThrown:!1,error:null}),e(),t){var n=xh;if(xh=null,n.errorThrown)throw n.error}}else e()},_h.captureError=function(e){wh.config.useDeprecatedSynchronousErrorHandling&&xh&&(xh.errorThrown=!0,xh.error=e)},function(e){var t=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0}),e.EMPTY_OBSERVER=e.SafeSubscriber=e.Subscriber=void 0;var n=Qp,r=eh,a=dh,o=ph,i=yh,s=vh,l=hh,c=_h,u=function(n){function a(t){var a=n.call(this)||this;return a.isStopped=!1,t?(a.destination=t,r.isSubscription(t)&&t.add(a)):a.destination=e.EMPTY_OBSERVER,a}return t(a,n),a.create=function(e,t,n){return new h(e,t,n)},a.prototype.next=function(e){this.isStopped?g(s.nextNotification(e),this):this._next(e)},a.prototype.error=function(e){this.isStopped?g(s.errorNotification(e),this):(this.isStopped=!0,this._error(e))},a.prototype.complete=function(){this.isStopped?g(s.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},a.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},a.prototype._next=function(e){this.destination.next(e)},a.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},a.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},a}(r.Subscription);e.Subscriber=u;var f=Function.prototype.bind;function d(e,t){return f.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){m(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){m(e)}else m(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){m(e)}},e}(),h=function(e){function r(t,r,o){var i,s,l=e.call(this)||this;return n.isFunction(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=o?o:void 0}:l&&a.config.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},i={next:t.next&&d(t.next,s),error:t.error&&d(t.error,s),complete:t.complete&&d(t.complete,s)}):i=t,l.destination=new p(i),l}return t(r,e),r}(u);function m(e){a.config.useDeprecatedSynchronousErrorHandling?c.captureError(e):o.reportUnhandledError(e)}function g(e,t){var n=a.config.onStoppedNotification;n&&l.timeoutProvider.setTimeout((function(){return n(e,t)}))}e.SafeSubscriber=h,e.EMPTY_OBSERVER={closed:!0,next:i.noop,error:function(e){throw e},complete:i.noop}}(Xp);var Sh={};Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.observable=void 0,Sh.observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();var Eh={},kh={};Object.defineProperty(kh,"__esModule",{value:!0}),kh.identity=void 0,kh.identity=function(e){return e},Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.pipeFromArray=Eh.pipe=void 0;var Ah=kh;function Ch(e){return 0===e.length?Ah.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}Eh.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ch(e)},Eh.pipeFromArray=Ch,Object.defineProperty(Zp,"__esModule",{value:!0}),Zp.Observable=void 0;var Oh=Xp,Th=eh,Nh=Sh,Rh=Eh,Ih=dh,Ph=Qp,Fh=_h,Mh=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,a=function(e){return e&&e instanceof Oh.Subscriber||function(e){return e&&Ph.isFunction(e.next)&&Ph.isFunction(e.error)&&Ph.isFunction(e.complete)}(e)&&Th.isSubscription(e)}(e)?e:new Oh.SafeSubscriber(e,t,n);return Fh.errorContext((function(){var e=r.operator,t=r.source;a.add(e?e.call(a,t):t?r._subscribe(a):r._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=jh(t))((function(t,r){var a=new Oh.SafeSubscriber({next:function(t){try{e(t)}catch(e){r(e),a.unsubscribe()}},error:r,complete:t});n.subscribe(a)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Nh.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Rh.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=jh(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function jh(e){var t;return null!==(t=null!=e?e:Ih.config.Promise)&&void 0!==t?t:Promise}Zp.Observable=Mh;var Dh={},Lh={},qh={};Object.defineProperty(qh,"__esModule",{value:!0}),qh.operate=qh.hasLift=void 0;var Bh=Qp;function Uh(e){return Bh.isFunction(null==e?void 0:e.lift)}qh.hasLift=Uh,qh.operate=function(e){return function(t){if(Uh(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}};var zh={},Gh=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(zh,"__esModule",{value:!0}),zh.OperatorSubscriber=zh.createOperatorSubscriber=void 0;var Hh=Xp;zh.createOperatorSubscriber=function(e,t,n,r,a){return new $h(e,t,n,r,a)};var $h=function(e){function t(t,n,r,a,o,i){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=i,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=a?function(e){try{a(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return Gh(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Hh.Subscriber);zh.OperatorSubscriber=$h,Object.defineProperty(Lh,"__esModule",{value:!0}),Lh.refCount=void 0;var Wh=qh,Vh=zh;Lh.refCount=function(){return Wh.operate((function(e,t){var n=null;e._refCount++;var r=Vh.createOperatorSubscriber(t,void 0,void 0,void 0,(function(){if(!e||e._refCount<=0||0<--e._refCount)n=null;else{var r=e._connection,a=n;n=null,!r||a&&r!==a||r.unsubscribe(),t.unsubscribe()}}));e.subscribe(r),r.closed||(n=e.connect())}))};var Jh=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.ConnectableObservable=void 0;var Yh=eh,Kh=Lh,Zh=zh,Xh=qh,Qh=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._subject=null,r._refCount=0,r._connection=null,Xh.hasLift(t)&&(r.lift=t.lift),r}return Jh(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype._teardown=function(){this._refCount=0;var e=this._connection;this._subject=this._connection=null,null==e||e.unsubscribe()},t.prototype.connect=function(){var e=this,t=this._connection;if(!t){t=this._connection=new Yh.Subscription;var n=this.getSubject();t.add(this.source.subscribe(Zh.createOperatorSubscriber(n,void 0,(function(){e._teardown(),n.complete()}),(function(t){e._teardown(),n.error(t)}),(function(){return e._teardown()})))),t.closed&&(this._connection=null,t=Yh.Subscription.EMPTY)}return t},t.prototype.refCount=function(){return Kh.refCount()(this)},t}(Zp.Observable);Dh.ConnectableObservable=Qh;var em={},tm={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.performanceTimestampProvider=void 0,e.performanceTimestampProvider={now:function(){return(e.performanceTimestampProvider.delegate||performance).now()},delegate:void 0}}(tm);var nm={};!function(e){var t=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrameProvider=void 0;var r=eh;e.animationFrameProvider={schedule:function(t){var n=requestAnimationFrame,a=cancelAnimationFrame,o=e.animationFrameProvider.delegate;o&&(n=o.requestAnimationFrame,a=o.cancelAnimationFrame);var i=n((function(e){a=void 0,t(e)}));return new r.Subscription((function(){return null==a?void 0:a(i)}))},requestAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.requestAnimationFrame)||requestAnimationFrame).apply(void 0,n([],t(r)))})),cancelAnimationFrame:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=e.animationFrameProvider.delegate;return((null==o?void 0:o.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,n([],t(r)))})),delegate:void 0}}(nm),Object.defineProperty(em,"__esModule",{value:!0}),em.animationFrames=void 0;var rm=Zp,am=tm,om=nm;function im(e){return new rm.Observable((function(t){var n=e||am.performanceTimestampProvider,r=n.now(),a=0;return function o(){t.closed||(a=om.animationFrameProvider.requestAnimationFrame((function(i){a=0;var s=n.now();t.next({timestamp:e?s:i,elapsed:s-r}),o()})))}(),function(){a&&om.animationFrameProvider.cancelAnimationFrame(a)}}))}em.animationFrames=function(e){return e?im(e):sm};var sm=im(),lm={},cm={};Object.defineProperty(cm,"__esModule",{value:!0}),cm.ObjectUnsubscribedError=void 0,cm.ObjectUnsubscribedError=nh.createErrorClass((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}));var um=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),fm=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(lm,"__esModule",{value:!0}),lm.AnonymousSubject=lm.Subject=void 0;var dm=Zp,pm=eh,hm=cm,mm=rh,gm=_h,ym=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return um(t,e),t.prototype.lift=function(e){var t=new vm(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new hm.ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;gm.errorContext((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var a=fm(t.currentObservers),o=a.next();!o.done;o=a.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;gm.errorContext((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;gm.errorContext((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.observers;return n.hasError||n.isStopped?pm.EMPTY_SUBSCRIPTION:(this.currentObservers=null,r.push(e),new pm.Subscription((function(){t.currentObservers=null,mm.arrRemove(r,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.isStopped;t.hasError?e.error(t.thrownError):n&&e.complete()},t.prototype.asObservable=function(){var e=new dm.Observable;return e.source=this,e},t.create=function(e,t){return new vm(e,t)},t}(dm.Observable);lm.Subject=ym;var vm=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return um(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:pm.EMPTY_SUBSCRIPTION},t}(ym);lm.AnonymousSubject=vm;var bm={},_m=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(bm,"__esModule",{value:!0}),bm.BehaviorSubject=void 0;var wm=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return _m(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e._value;if(e.hasError)throw e.thrownError;return this._throwIfClosed(),t},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(lm.Subject);bm.BehaviorSubject=wm;var xm={},Sm={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dateTimestampProvider=void 0,e.dateTimestampProvider={now:function(){return(e.dateTimestampProvider.delegate||Date).now()},delegate:void 0}}(Sm);var Em=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(xm,"__esModule",{value:!0}),xm.ReplaySubject=void 0;var km=Sm,Am=function(e){function t(t,n,r){void 0===t&&(t=Infinity),void 0===n&&(n=Infinity),void 0===r&&(r=km.dateTimestampProvider);var a=e.call(this)||this;return a._bufferSize=t,a._windowTime=n,a._timestampProvider=r,a._buffer=[],a._infiniteTimeWindow=!0,a._infiniteTimeWindow=Infinity===n,a._bufferSize=Math.max(1,t),a._windowTime=Math.max(1,n),a}return Em(t,e),t.prototype.next=function(t){var n=this,r=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,i=n._windowTime;n.isStopped||(r.push(t),!a&&r.push(o.now()+i)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),a=0;a<r.length&&!e.closed;a+=n?1:2)e.next(r[a]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,a=e._infiniteTimeWindow,o=(a?1:2)*t;if(t<Infinity&&o<r.length&&r.splice(0,r.length-o),!a){for(var i=n.now(),s=0,l=1;l<r.length&&r[l]<=i;l+=2)s=l;s&&r.splice(0,s+1)}},t}(lm.Subject);xm.ReplaySubject=Am;var Cm={},Om=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.AsyncSubject=void 0;var Tm=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._value=null,t._hasValue=!1,t._isComplete=!1,t}return Om(t,e),t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t._hasValue,r=t._value,a=t.isStopped,o=t._isComplete;t.hasError?e.error(t.thrownError):(a||o)&&(n&&e.next(r),e.complete())},t.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},t.prototype.complete=function(){var t=this,n=t._hasValue,r=t._value;t._isComplete||(this._isComplete=!0,n&&e.prototype.next.call(this,r),e.prototype.complete.call(this))},t}(lm.Subject);Cm.AsyncSubject=Tm;var Nm={},Rm={},Im={},Pm={},Fm=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.Action=void 0,Pm.Action=function(e){function t(t,n){return e.call(this)||this}return Fm(t,e),t.prototype.schedule=function(e,t){return this},t}(eh.Subscription);var Mm={};!function(e){var t=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.intervalProvider=void 0,e.intervalProvider={setInterval:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(r,a){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];var s=e.intervalProvider.delegate;return(null==s?void 0:s.setInterval)?s.setInterval.apply(s,n([r,a],t(o))):setInterval.apply(void 0,n([r,a],t(o)))})),clearInterval:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(t){var n=e.intervalProvider.delegate;return((null==n?void 0:n.clearInterval)||clearInterval)(t)})),delegate:void 0}}(Mm);var jm=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Im,"__esModule",{value:!0}),Im.AsyncAction=void 0;var Dm=Mm,Lm=rh,qm=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return jm(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(a,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Dm.intervalProvider.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Dm.intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Lm.arrRemove(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Pm.Action);Im.AsyncAction=qm;var Bm={},Um={};Object.defineProperty(Um,"__esModule",{value:!0}),Um.TestTools=Um.Immediate=void 0;var zm,Gm=1,Hm={};function $m(e){return e in Hm&&(delete Hm[e],!0)}Um.Immediate={setImmediate:function(e){var t=Gm++;return Hm[t]=!0,zm||(zm=Promise.resolve()),zm.then((function(){return $m(t)&&e()})),t},clearImmediate:function(e){$m(e)}},Um.TestTools={pending:function(){return Object.keys(Hm).length}},function(e){var t=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},n=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(e,"__esModule",{value:!0}),e.immediateProvider=void 0;var r=Um.Immediate.setImmediate,a=Um.Immediate.clearImmediate;e.immediateProvider={setImmediate:function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var i=e.immediateProvider.delegate;return((null==i?void 0:i.setImmediate)||r).apply(void 0,n([],t(a)))},clearImmediate:function(t){var n=e.immediateProvider.delegate;return((null==n?void 0:n.clearImmediate)||a)(t)},delegate:void 0}}(Bm);var Wm=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.AsapAction=void 0;var Vm=Bm;Rm.AsapAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return Wm(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=Vm.immediateProvider.setImmediate(t.flush.bind(t,void 0))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(Vm.immediateProvider.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))},t}(Im.AsyncAction);var Jm={},Ym={},Km={};Object.defineProperty(Km,"__esModule",{value:!0}),Km.Scheduler=void 0;var Zm=Sm;Km.Scheduler=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Zm.dateTimestampProvider.now,e}();var Xm=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.AsyncScheduler=void 0;var Qm=Km;Ym.AsyncScheduler=function(e){function t(t,n){void 0===n&&(n=Qm.Scheduler.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return Xm(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Qm.Scheduler);var eg=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.AsapScheduler=void 0;var tg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return eg(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(Ym.AsyncScheduler);Jm.AsapScheduler=tg,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.asap=e.asapScheduler=void 0,e.asapScheduler=new Jm.AsapScheduler(Rm.AsapAction),e.asap=e.asapScheduler}(Nm);var ng={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.async=e.asyncScheduler=void 0,e.asyncScheduler=new Ym.AsyncScheduler(Im.AsyncAction),e.async=e.asyncScheduler}(ng);var rg={},ag={},og=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ag,"__esModule",{value:!0}),ag.QueueAction=void 0,ag.QueueAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return og(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!=r&&r>0||null==r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.flush(this),0)},t}(Im.AsyncAction);var ig={},sg=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ig,"__esModule",{value:!0}),ig.QueueScheduler=void 0;var lg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return sg(t,e),t}(Ym.AsyncScheduler);ig.QueueScheduler=lg,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.queue=e.queueScheduler=void 0,e.queueScheduler=new ig.QueueScheduler(ag.QueueAction),e.queue=e.queueScheduler}(rg);var cg={},ug={},fg=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(ug,"__esModule",{value:!0}),ug.AnimationFrameAction=void 0;var dg=nm;ug.AnimationFrameAction=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return fg(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t._scheduled||(t._scheduled=dg.animationFrameProvider.requestAnimationFrame((function(){return t.flush(void 0)}))))},t.prototype.recycleAsyncId=function(t,n,r){var a;if(void 0===r&&(r=0),null!=r?r>0:this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);var o=t.actions;null!=n&&(null===(a=o[o.length-1])||void 0===a?void 0:a.id)!==n&&(dg.animationFrameProvider.cancelAnimationFrame(n),t._scheduled=void 0)},t}(Im.AsyncAction);var pg={},hg=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(pg,"__esModule",{value:!0}),pg.AnimationFrameScheduler=void 0;var mg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return hg(t,e),t.prototype.flush=function(e){this._active=!0;var t=this._scheduled;this._scheduled=void 0;var n,r=this.actions;e=e||r.shift();do{if(n=e.execute(e.state,e.delay))break}while((e=r[0])&&e.id===t&&r.shift());if(this._active=!1,n){for(;(e=r[0])&&e.id===t&&r.shift();)e.unsubscribe();throw n}},t}(Ym.AsyncScheduler);pg.AnimationFrameScheduler=mg,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.animationFrame=e.animationFrameScheduler=void 0,e.animationFrameScheduler=new pg.AnimationFrameScheduler(ug.AnimationFrameAction),e.animationFrame=e.animationFrameScheduler}(cg);var gg={},yg=D&&D.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(gg,"__esModule",{value:!0}),gg.VirtualAction=gg.VirtualTimeScheduler=void 0;var vg=Im,bg=eh;gg.VirtualTimeScheduler=function(e){function t(t,n){void 0===t&&(t=_g),void 0===n&&(n=Infinity);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return yg(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(Ym.AsyncScheduler);var _g=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var a=e.call(this,t,n)||this;return a.scheduler=t,a.work=n,a.index=r,a.active=!0,a.index=t.index=r,a}return yg(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),Number.isFinite(r)){if(!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var a=new t(this.scheduler,this.work);return this.add(a),a.schedule(n,r)}return bg.Subscription.EMPTY},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var a=e.actions;return a.push(this),a.sort(t.sortActions),1},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(vg.AsyncAction);gg.VirtualAction=_g;var wg={},xg={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.empty=e.EMPTY=void 0;var t=Zp;e.EMPTY=new t.Observable((function(e){return e.complete()})),e.empty=function(n){return n?function(e){return new t.Observable((function(t){return e.schedule((function(){return t.complete()}))}))}(n):e.EMPTY}}(xg);var Sg={},Eg={},kg={};Object.defineProperty(kg,"__esModule",{value:!0}),kg.isScheduler=void 0;var Ag=Qp;kg.isScheduler=function(e){return e&&Ag.isFunction(e.schedule)},Object.defineProperty(Eg,"__esModule",{value:!0}),Eg.popNumber=Eg.popScheduler=Eg.popResultSelector=void 0;var Cg=Qp,Og=kg;function Tg(e){return e[e.length-1]}Eg.popResultSelector=function(e){return Cg.isFunction(Tg(e))?e.pop():void 0},Eg.popScheduler=function(e){return Og.isScheduler(Tg(e))?e.pop():void 0},Eg.popNumber=function(e,t){return"number"==typeof Tg(e)?e.pop():t};var Ng={},Rg={},Ig={},Pg={},Fg={};Object.defineProperty(Fg,"__esModule",{value:!0}),Fg.isArrayLike=void 0,Fg.isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};var Mg={};Object.defineProperty(Mg,"__esModule",{value:!0}),Mg.isPromise=void 0;var jg=Qp;Mg.isPromise=function(e){return jg.isFunction(null==e?void 0:e.then)};var Dg={};Object.defineProperty(Dg,"__esModule",{value:!0}),Dg.isInteropObservable=void 0;var Lg=Sh,qg=Qp;Dg.isInteropObservable=function(e){return qg.isFunction(e[Lg.observable])};var Bg={};Object.defineProperty(Bg,"__esModule",{value:!0}),Bg.isAsyncIterable=void 0;var Ug=Qp;Bg.isAsyncIterable=function(e){return Symbol.asyncIterator&&Ug.isFunction(null==e?void 0:e[Symbol.asyncIterator])};var zg={};Object.defineProperty(zg,"__esModule",{value:!0}),zg.createInvalidObservableTypeError=void 0,zg.createInvalidObservableTypeError=function(e){return new TypeError("You provided "+(null!==e&&"object"===Y(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")};var Gg={},Hg={};function $g(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(Hg,"__esModule",{value:!0}),Hg.iterator=Hg.getSymbolIterator=void 0,Hg.getSymbolIterator=$g,Hg.iterator=$g(),Object.defineProperty(Gg,"__esModule",{value:!0}),Gg.isIterable=void 0;var Wg=Hg,Vg=Qp;Gg.isIterable=function(e){return Vg.isFunction(null==e?void 0:e[Wg.iterator])};var Jg={},Yg=D&&D.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},Kg=D&&D.__await||function(e){return this instanceof Kg?(this.v=e,this):new Kg(e)},Zg=D&&D.__asyncGenerator||function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),o=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){a[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{!function(e){e.value instanceof Kg?Promise.resolve(e.value.v).then(l,c):u(o[0][2],e)}(a[e](t))}catch(e){u(o[0][3],e)}}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}};Object.defineProperty(Jg,"__esModule",{value:!0}),Jg.isReadableStreamLike=Jg.readableStreamLikeToAsyncGenerator=void 0;var Xg=Qp;Jg.readableStreamLikeToAsyncGenerator=function(e){return Zg(this,arguments,(function(){var t,n,r;return Yg(this,(function(a){switch(a.label){case 0:t=e.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Kg(t.read())];case 3:return n=a.sent(),r=n.value,n.done?[4,Kg(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Kg(r)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))},Jg.isReadableStreamLike=function(e){return Xg.isFunction(null==e?void 0:e.getReader)};var Qg=D&&D.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(i,s)}l((r=r.apply(e,t||[])).next())}))},ey=D&&D.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ty=D&&D.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof ny?ny(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,a){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,a,(t=e[n](t)).done,t.value)}))}}},ny=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Pg,"__esModule",{value:!0}),Pg.fromReadableStreamLike=Pg.fromAsyncIterable=Pg.fromIterable=Pg.fromPromise=Pg.fromArrayLike=Pg.fromInteropObservable=Pg.innerFrom=void 0;var ry=Fg,ay=Mg,oy=Zp,iy=Dg,sy=Bg,ly=zg,cy=Gg,uy=Jg,fy=Qp,dy=ph,py=Sh;function hy(e){return new oy.Observable((function(t){var n=e[py.observable]();if(fy.isFunction(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}))}function my(e){return new oy.Observable((function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()}))}function gy(e){return new oy.Observable((function(t){e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,dy.reportUnhandledError)}))}function yy(e){return new oy.Observable((function(t){var n,r;try{for(var a=ny(e),o=a.next();!o.done;o=a.next())if(t.next(o.value),t.closed)return}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t.complete()}))}function vy(e){return new oy.Observable((function(t){(function(e,t){var n,r,a,o;return Qg(this,void 0,void 0,(function(){var i;return ey(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),n=ty(e),s.label=1;case 1:return[4,n.next()];case 2:if((r=s.sent()).done)return[3,4];if(t.next(r.value),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return i=s.sent(),a={error:i},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function by(e){return vy(uy.readableStreamLikeToAsyncGenerator(e))}Pg.innerFrom=function(e){if(e instanceof oy.Observable)return e;if(null!=e){if(iy.isInteropObservable(e))return hy(e);if(ry.isArrayLike(e))return my(e);if(ay.isPromise(e))return gy(e);if(sy.isAsyncIterable(e))return vy(e);if(cy.isIterable(e))return yy(e);if(uy.isReadableStreamLike(e))return by(e)}throw ly.createInvalidObservableTypeError(e)},Pg.fromInteropObservable=hy,Pg.fromArrayLike=my,Pg.fromPromise=gy,Pg.fromIterable=yy,Pg.fromAsyncIterable=vy,Pg.fromReadableStreamLike=by;var _y={},wy={};Object.defineProperty(wy,"__esModule",{value:!0}),wy.executeSchedule=void 0,wy.executeSchedule=function(e,t,n,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);var o=t.schedule((function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!a)return o},Object.defineProperty(_y,"__esModule",{value:!0}),_y.observeOn=void 0;var xy=wy,Sy=qh,Ey=zh;_y.observeOn=function(e,t){return void 0===t&&(t=0),Sy.operate((function(n,r){n.subscribe(Ey.createOperatorSubscriber(r,(function(n){return xy.executeSchedule(r,e,(function(){return r.next(n)}),t)}),(function(){return xy.executeSchedule(r,e,(function(){return r.complete()}),t)}),(function(n){return xy.executeSchedule(r,e,(function(){return r.error(n)}),t)})))}))};var ky={};Object.defineProperty(ky,"__esModule",{value:!0}),ky.subscribeOn=void 0;var Ay=qh;ky.subscribeOn=function(e,t){return void 0===t&&(t=0),Ay.operate((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))},Object.defineProperty(Ig,"__esModule",{value:!0}),Ig.scheduleObservable=void 0;var Cy=Pg,Oy=_y,Ty=ky;Ig.scheduleObservable=function(e,t){return Cy.innerFrom(e).pipe(Ty.subscribeOn(t),Oy.observeOn(t))};var Ny={};Object.defineProperty(Ny,"__esModule",{value:!0}),Ny.schedulePromise=void 0;var Ry=Pg,Iy=_y,Py=ky;Ny.schedulePromise=function(e,t){return Ry.innerFrom(e).pipe(Py.subscribeOn(t),Iy.observeOn(t))};var Fy={};Object.defineProperty(Fy,"__esModule",{value:!0}),Fy.scheduleArray=void 0;var My=Zp;Fy.scheduleArray=function(e,t){return new My.Observable((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))};var jy={};Object.defineProperty(jy,"__esModule",{value:!0}),jy.scheduleIterable=void 0;var Dy=Zp,Ly=Hg,qy=Qp,By=wy;jy.scheduleIterable=function(e,t){return new Dy.Observable((function(n){var r;return By.executeSchedule(n,t,(function(){r=e[Ly.iterator](),By.executeSchedule(n,t,(function(){var e,t,a;try{t=(e=r.next()).value,a=e.done}catch(e){return void n.error(e)}a?n.complete():n.next(t)}),0,!0)})),function(){return qy.isFunction(null==r?void 0:r.return)&&r.return()}}))};var Uy={};Object.defineProperty(Uy,"__esModule",{value:!0}),Uy.scheduleAsyncIterable=void 0;var zy=Zp,Gy=wy;Uy.scheduleAsyncIterable=function(e,t){if(!e)throw new Error("Iterable cannot be null");return new zy.Observable((function(n){Gy.executeSchedule(n,t,(function(){var r=e[Symbol.asyncIterator]();Gy.executeSchedule(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))};var Hy={};Object.defineProperty(Hy,"__esModule",{value:!0}),Hy.scheduleReadableStreamLike=void 0;var $y=Uy,Wy=Jg;Hy.scheduleReadableStreamLike=function(e,t){return $y.scheduleAsyncIterable(Wy.readableStreamLikeToAsyncGenerator(e),t)},Object.defineProperty(Rg,"__esModule",{value:!0}),Rg.scheduled=void 0;var Vy=Ig,Jy=Ny,Yy=Fy,Ky=jy,Zy=Uy,Xy=Dg,Qy=Mg,ev=Fg,tv=Gg,nv=Bg,rv=zg,av=Jg,ov=Hy;Rg.scheduled=function(e,t){if(null!=e){if(Xy.isInteropObservable(e))return Vy.scheduleObservable(e,t);if(ev.isArrayLike(e))return Yy.scheduleArray(e,t);if(Qy.isPromise(e))return Jy.schedulePromise(e,t);if(nv.isAsyncIterable(e))return Zy.scheduleAsyncIterable(e,t);if(tv.isIterable(e))return Ky.scheduleIterable(e,t);if(av.isReadableStreamLike(e))return ov.scheduleReadableStreamLike(e,t)}throw rv.createInvalidObservableTypeError(e)},Object.defineProperty(Ng,"__esModule",{value:!0}),Ng.from=void 0;var iv=Rg,sv=Pg;Ng.from=function(e,t){return t?iv.scheduled(e,t):sv.innerFrom(e)},Object.defineProperty(Sg,"__esModule",{value:!0}),Sg.of=void 0;var lv=Eg,cv=Ng;Sg.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lv.popScheduler(e);return cv.from(e,n)};var uv={};Object.defineProperty(uv,"__esModule",{value:!0}),uv.throwError=void 0;var fv=Zp,dv=Qp;uv.throwError=function(e,t){var n=dv.isFunction(e)?e:function(){return e},r=function(e){return e.error(n())};return new fv.Observable(t?function(e){return t.schedule(r,0,e)}:r)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.observeNotification=e.Notification=e.NotificationKind=void 0;var t,n=xg,r=Sg,a=uv,o=Qp;(t=e.NotificationKind||(e.NotificationKind={})).NEXT="N",t.ERROR="E",t.COMPLETE="C";var i=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){return s(this,e)},e.prototype.do=function(e,t,n){var r=this,a=r.kind,o=r.error;return"N"===a?null==e?void 0:e(r.value):"E"===a?null==t?void 0:t(o):null==n?void 0:n()},e.prototype.accept=function(e,t,n){var r;return o.isFunction(null===(r=e)||void 0===r?void 0:r.next)?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){var e=this,t=e.kind,o=e.error,i="N"===t?r.of(e.value):"E"===t?a.throwError((function(){return o})):"C"===t?n.EMPTY:0;if(!i)throw new TypeError("Unexpected notification kind "+t);return i},e.createNext=function(t){return new e("N",t)},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e}();function s(e,t){var n,r,a,o=e.kind,i=e.value,s=e.error;if("string"!=typeof o)throw new TypeError('Invalid notification, missing "kind"');"N"===o?null===(n=t.next)||void 0===n||n.call(t,i):"E"===o?null===(r=t.error)||void 0===r||r.call(t,s):null===(a=t.complete)||void 0===a||a.call(t)}e.Notification=i,e.observeNotification=s}(wg);var pv={};Object.defineProperty(pv,"__esModule",{value:!0}),pv.isObservable=void 0;var hv=Zp,mv=Qp;pv.isObservable=function(e){return!!e&&(e instanceof hv.Observable||mv.isFunction(e.lift)&&mv.isFunction(e.subscribe))};var gv={},yv={};Object.defineProperty(yv,"__esModule",{value:!0}),yv.EmptyError=void 0,yv.EmptyError=nh.createErrorClass((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),Object.defineProperty(gv,"__esModule",{value:!0}),gv.lastValueFrom=void 0;var vv=yv;gv.lastValueFrom=function(e,t){var n="object"===Y(t);return new Promise((function(r,a){var o,i=!1;e.subscribe({next:function(e){o=e,i=!0},error:a,complete:function(){i?r(o):n?r(t.defaultValue):a(new vv.EmptyError)}})}))};var bv={};Object.defineProperty(bv,"__esModule",{value:!0}),bv.firstValueFrom=void 0;var _v=yv,wv=Xp;bv.firstValueFrom=function(e,t){var n="object"===Y(t);return new Promise((function(r,a){var o=new wv.SafeSubscriber({next:function(e){r(e),o.unsubscribe()},error:a,complete:function(){n?r(t.defaultValue):a(new _v.EmptyError)}});e.subscribe(o)}))};var xv={};Object.defineProperty(xv,"__esModule",{value:!0}),xv.ArgumentOutOfRangeError=void 0,xv.ArgumentOutOfRangeError=nh.createErrorClass((function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}}));var Sv={};Object.defineProperty(Sv,"__esModule",{value:!0}),Sv.NotFoundError=void 0,Sv.NotFoundError=nh.createErrorClass((function(e){return function(t){e(this),this.name="NotFoundError",this.message=t}}));var Ev={};Object.defineProperty(Ev,"__esModule",{value:!0}),Ev.SequenceError=void 0,Ev.SequenceError=nh.createErrorClass((function(e){return function(t){e(this),this.name="SequenceError",this.message=t}}));var kv={},Av={};Object.defineProperty(Av,"__esModule",{value:!0}),Av.isValidDate=void 0,Av.isValidDate=function(e){return e instanceof Date&&!isNaN(e)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.timeout=e.TimeoutError=void 0;var t=ng,n=Av,r=qh,a=Pg,o=zh,i=wy;function s(t){throw new e.TimeoutError(t)}e.TimeoutError=nh.createErrorClass((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}})),e.timeout=function(e,l){var c=n.isValidDate(e)?{first:e}:"number"==typeof e?{each:e}:e,u=c.first,f=c.each,d=c.with,p=void 0===d?s:d,h=c.scheduler,m=void 0===h?null!=l?l:t.asyncScheduler:h,g=c.meta,y=void 0===g?null:g;if(null==u&&null==f)throw new TypeError("No timeout provided.");return r.operate((function(e,t){var n,r,s=null,l=0,c=function(e){r=i.executeSchedule(t,m,(function(){try{n.unsubscribe(),a.innerFrom(p({meta:y,lastValue:s,seen:l})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(o.createOperatorSubscriber(t,(function(e){null==r||r.unsubscribe(),l++,t.next(s=e),f>0&&c(f)}),void 0,void 0,(function(){(null==r?void 0:r.closed)||null==r||r.unsubscribe(),s=null}))),!l&&c(null!=u?"number"==typeof u?u:+u-m.now():f)}))}}(kv);var Cv={},Ov={},Tv={},Nv={};Object.defineProperty(Nv,"__esModule",{value:!0}),Nv.map=void 0;var Rv=qh,Iv=zh;Nv.map=function(e,t){return Rv.operate((function(n,r){var a=0;n.subscribe(Iv.createOperatorSubscriber(r,(function(n){r.next(e.call(t,n,a++))})))}))};var Pv=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Fv=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Tv,"__esModule",{value:!0}),Tv.mapOneOrManyArgs=void 0;var Mv=Nv,jv=Array.isArray;Tv.mapOneOrManyArgs=function(e){return Mv.map((function(t){return function(e,t){return jv(t)?e.apply(void 0,Fv([],Pv(t))):e(t)}(e,t)}))};var Dv=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Lv=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Ov,"__esModule",{value:!0}),Ov.bindCallbackInternals=void 0;var qv=kg,Bv=Zp,Uv=ky,zv=Tv,Gv=_y,Hv=Cm;Ov.bindCallbackInternals=function e(t,n,r,a){if(r){if(!qv.isScheduler(r))return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return e(t,n,a).apply(this,o).pipe(zv.mapOneOrManyArgs(r))};a=r}return a?function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return e(t,n).apply(this,r).pipe(Uv.subscribeOn(a),Gv.observeOn(a))}:function(){for(var e=this,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var o=new Hv.AsyncSubject,i=!0;return new Bv.Observable((function(a){var s=o.subscribe(a);if(i){i=!1;var l=!1,c=!1;n.apply(e,Lv(Lv([],Dv(r)),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t){var r=e.shift();if(null!=r)return void o.error(r)}o.next(1<e.length?e:e[0]),c=!0,l&&o.complete()}])),c&&o.complete(),l=!0}return s}))}},Object.defineProperty(Cv,"__esModule",{value:!0}),Cv.bindCallback=void 0;var $v=Ov;Cv.bindCallback=function(e,t,n){return $v.bindCallbackInternals(!1,e,t,n)};var Wv={};Object.defineProperty(Wv,"__esModule",{value:!0}),Wv.bindNodeCallback=void 0;var Vv=Ov;Wv.bindNodeCallback=function(e,t,n){return Vv.bindCallbackInternals(!0,e,t,n)};var Jv={},Yv={};Object.defineProperty(Yv,"__esModule",{value:!0}),Yv.argsArgArrayOrObject=void 0;var Kv=Array.isArray,Zv=Object.getPrototypeOf,Xv=Object.prototype,Qv=Object.keys;Yv.argsArgArrayOrObject=function(e){if(1===e.length){var t=e[0];if(Kv(t))return{args:t,keys:null};if((r=t)&&"object"===Y(r)&&Zv(r)===Xv){var n=Qv(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}};var eb={};Object.defineProperty(eb,"__esModule",{value:!0}),eb.createObject=void 0,eb.createObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},Object.defineProperty(Jv,"__esModule",{value:!0}),Jv.combineLatestInit=Jv.combineLatest=void 0;var tb=Zp,nb=Yv,rb=Ng,ab=kh,ob=Tv,ib=Eg,sb=eb,lb=zh,cb=wy;function ub(e,t,n){return void 0===n&&(n=ab.identity),function(r){fb(t,(function(){for(var a=e.length,o=new Array(a),i=a,s=a,l=function(a){fb(t,(function(){var l=rb.from(e[a],t),c=!1;l.subscribe(lb.createOperatorSubscriber(r,(function(e){o[a]=e,c||(c=!0,s--),s||r.next(n(o.slice()))}),(function(){--i||r.complete()})))}),r)},c=0;c<a;c++)l(c)}),r)}}function fb(e,t,n){e?cb.executeSchedule(n,e,t):t()}Jv.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ib.popScheduler(e),r=ib.popResultSelector(e),a=nb.argsArgArrayOrObject(e),o=a.args,i=a.keys;if(0===o.length)return rb.from([],n);var s=new tb.Observable(ub(o,n,i?function(e){return sb.createObject(i,e)}:ab.identity));return r?s.pipe(ob.mapOneOrManyArgs(r)):s},Jv.combineLatestInit=ub;var db={},pb={},hb={},mb={},gb={};Object.defineProperty(gb,"__esModule",{value:!0}),gb.mergeInternals=void 0;var yb=Pg,vb=wy,bb=zh;gb.mergeInternals=function(e,t,n,r,a,o,i,s){var l=[],c=0,u=0,f=!1,d=function(){!f||l.length||c||t.complete()},p=function(e){return c<r?h(e):l.push(e)},h=function e(s){o&&t.next(s),c++;var f=!1;yb.innerFrom(n(s,u++)).subscribe(bb.createOperatorSubscriber(t,(function(e){null==a||a(e),o?p(e):t.next(e)}),(function(){f=!0}),void 0,(function(){if(f)try{c--;for(var n=function(){var n=l.shift();i?vb.executeSchedule(t,i,(function(){return e(n)})):e(n)};l.length&&c<r;)n();d()}catch(e){t.error(e)}})))};return e.subscribe(bb.createOperatorSubscriber(t,p,(function(){f=!0,d()}))),function(){null==s||s()}},Object.defineProperty(mb,"__esModule",{value:!0}),mb.mergeMap=void 0;var _b=Nv,wb=Pg,xb=qh,Sb=gb,Eb=Qp;mb.mergeMap=function e(t,n,r){return void 0===r&&(r=Infinity),Eb.isFunction(n)?e((function(e,r){return _b.map((function(t,a){return n(e,t,r,a)}))(wb.innerFrom(t(e,r)))}),r):("number"==typeof n&&(r=n),xb.operate((function(e,n){return Sb.mergeInternals(e,n,t,r)})))},Object.defineProperty(hb,"__esModule",{value:!0}),hb.mergeAll=void 0;var kb=mb,Ab=kh;hb.mergeAll=function(e){return void 0===e&&(e=Infinity),kb.mergeMap(Ab.identity,e)},Object.defineProperty(pb,"__esModule",{value:!0}),pb.concatAll=void 0;var Cb=hb;pb.concatAll=function(){return Cb.mergeAll(1)},Object.defineProperty(db,"__esModule",{value:!0}),db.concat=void 0;var Ob=pb,Tb=Eg,Nb=Ng;db.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ob.concatAll()(Nb.from(e,Tb.popScheduler(e)))};var Rb={},Ib={};Object.defineProperty(Ib,"__esModule",{value:!0}),Ib.defer=void 0;var Pb=Zp,Fb=Pg;Ib.defer=function(e){return new Pb.Observable((function(t){Fb.innerFrom(e()).subscribe(t)}))},Object.defineProperty(Rb,"__esModule",{value:!0}),Rb.connectable=void 0;var Mb=lm,jb=Zp,Db=Ib,Lb={connector:function(){return new Mb.Subject},resetOnDisconnect:!0};Rb.connectable=function(e,t){void 0===t&&(t=Lb);var n=null,r=t.connector,a=t.resetOnDisconnect,o=void 0===a||a,i=r(),s=new jb.Observable((function(e){return i.subscribe(e)}));return s.connect=function(){return n&&!n.closed||(n=Db.defer((function(){return e})).subscribe(i),o&&n.add((function(){return i=r()}))),n},s};var qb={};Object.defineProperty(qb,"__esModule",{value:!0}),qb.forkJoin=void 0;var Bb=Zp,Ub=Yv,zb=Pg,Gb=Eg,Hb=zh,$b=Tv,Wb=eb;qb.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Gb.popResultSelector(e),r=Ub.argsArgArrayOrObject(e),a=r.args,o=r.keys,i=new Bb.Observable((function(e){var t=a.length;if(t)for(var n=new Array(t),r=t,i=t,s=function(t){var s=!1;zb.innerFrom(a[t]).subscribe(Hb.createOperatorSubscriber(e,(function(e){s||(s=!0,i--),n[t]=e}),(function(){return r--}),void 0,(function(){r&&s||(i||e.next(o?Wb.createObject(o,n):n),e.complete())})))},l=0;l<t;l++)s(l);else e.complete()}));return n?i.pipe($b.mapOneOrManyArgs(n)):i};var Vb={},Jb=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(Vb,"__esModule",{value:!0}),Vb.fromEvent=void 0;var Yb=Pg,Kb=Zp,Zb=mb,Xb=Fg,Qb=Qp,e_=Tv,t_=["addListener","removeListener"],n_=["addEventListener","removeEventListener"],r_=["on","off"];function a_(e,t){return function(n){return function(r){return e[n](t,r)}}}Vb.fromEvent=function e(t,n,r,a){if(Qb.isFunction(r)&&(a=r,r=void 0),a)return e(t,n,r).pipe(e_.mapOneOrManyArgs(a));var o=Jb(function(e){return Qb.isFunction(e.addEventListener)&&Qb.isFunction(e.removeEventListener)}(t)?n_.map((function(e){return function(a){return t[e](n,a,r)}})):function(e){return Qb.isFunction(e.addListener)&&Qb.isFunction(e.removeListener)}(t)?t_.map(a_(t,n)):function(e){return Qb.isFunction(e.on)&&Qb.isFunction(e.off)}(t)?r_.map(a_(t,n)):[],2),i=o[0],s=o[1];if(!i&&Xb.isArrayLike(t))return Zb.mergeMap((function(t){return e(t,n,r)}))(Yb.innerFrom(t));if(!i)throw new TypeError("Invalid event target");return new Kb.Observable((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return i(t),function(){return s(t)}}))};var o_={};Object.defineProperty(o_,"__esModule",{value:!0}),o_.fromEventPattern=void 0;var i_=Zp,s_=Qp,l_=Tv;o_.fromEventPattern=function e(t,n,r){return r?e(t,n).pipe(l_.mapOneOrManyArgs(r)):new i_.Observable((function(e){var r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1===t.length?t[0]:t)},a=t(r);return s_.isFunction(n)?function(){return n(r,a)}:void 0}))};var c_={},u_=D&&D.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(c_,"__esModule",{value:!0}),c_.generate=void 0;var f_=kh,d_=kg,p_=Ib,h_=jy;c_.generate=function(e,t,n,r,a){var o,i,s,l;function c(){var e;return u_(this,(function(r){switch(r.label){case 0:e=l,r.label=1;case 1:return t&&!t(e)?[3,4]:[4,s(e)];case 2:r.sent(),r.label=3;case 3:return e=n(e),[3,1];case 4:return[2]}}))}return 1===arguments.length?(l=(o=e).initialState,t=o.condition,n=o.iterate,s=void 0===(i=o.resultSelector)?f_.identity:i,a=o.scheduler):(l=e,!r||d_.isScheduler(r)?(s=f_.identity,a=r):s=r),p_.defer(a?function(){return h_.scheduleIterable(c(),a)}:c)};var m_={};Object.defineProperty(m_,"__esModule",{value:!0}),m_.iif=void 0;var g_=Ib;m_.iif=function(e,t,n){return g_.defer((function(){return e()?t:n}))};var y_={},v_={};Object.defineProperty(v_,"__esModule",{value:!0}),v_.timer=void 0;var b_=Zp,__=ng,w_=kg,x_=Av;v_.timer=function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=__.async);var r=-1;return null!=t&&(w_.isScheduler(t)?n=t:r=t),new b_.Observable((function(t){var a=x_.isValidDate(e)?+e-n.now():e;a<0&&(a=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),a)}))},Object.defineProperty(y_,"__esModule",{value:!0}),y_.interval=void 0;var S_=ng,E_=v_;y_.interval=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=S_.asyncScheduler),e<0&&(e=0),E_.timer(e,e,t)};var k_={};Object.defineProperty(k_,"__esModule",{value:!0}),k_.merge=void 0;var A_=hb,C_=Pg,O_=xg,T_=Eg,N_=Ng;k_.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=T_.popScheduler(e),r=T_.popNumber(e,Infinity),a=e;return a.length?1===a.length?C_.innerFrom(a[0]):A_.mergeAll(r)(N_.from(a,n)):O_.EMPTY};var R_={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.never=e.NEVER=void 0,e.NEVER=new Zp.Observable(yh.noop),e.never=function(){return e.NEVER}}(R_);var I_={},P_={};Object.defineProperty(P_,"__esModule",{value:!0}),P_.argsOrArgArray=void 0;var F_=Array.isArray;P_.argsOrArgArray=function(e){return 1===e.length&&F_(e[0])?e[0]:e},Object.defineProperty(I_,"__esModule",{value:!0}),I_.onErrorResumeNext=void 0;var M_=Zp,j_=P_,D_=zh,L_=yh,q_=Pg;I_.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=j_.argsOrArgArray(e);return new M_.Observable((function(e){var t=0;!function r(){if(t<n.length){var a=void 0;try{a=q_.innerFrom(n[t++])}catch(e){return void r()}var o=new D_.OperatorSubscriber(e,void 0,L_.noop,L_.noop);a.subscribe(o),o.add(r)}else e.complete()}()}))};var B_={};Object.defineProperty(B_,"__esModule",{value:!0}),B_.pairs=void 0;var U_=Ng;B_.pairs=function(e,t){return U_.from(Object.entries(e),t)};var z_={},G_={};Object.defineProperty(G_,"__esModule",{value:!0}),G_.not=void 0,G_.not=function(e,t){return function(n,r){return!e.call(t,n,r)}};var H_={};Object.defineProperty(H_,"__esModule",{value:!0}),H_.filter=void 0;var $_=qh,W_=zh;H_.filter=function(e,t){return $_.operate((function(n,r){var a=0;n.subscribe(W_.createOperatorSubscriber(r,(function(n){return e.call(t,n,a++)&&r.next(n)})))}))},Object.defineProperty(z_,"__esModule",{value:!0}),z_.partition=void 0;var V_=G_,J_=H_,Y_=Pg;z_.partition=function(e,t,n){return[J_.filter(t,n)(Y_.innerFrom(e)),J_.filter(V_.not(t,n))(Y_.innerFrom(e))]};var K_={};Object.defineProperty(K_,"__esModule",{value:!0}),K_.raceInit=K_.race=void 0;var Z_=Zp,X_=Pg,Q_=P_,ew=zh;function tw(e){return function(t){for(var n=[],r=function(r){n.push(X_.innerFrom(e[r]).subscribe(ew.createOperatorSubscriber(t,(function(e){if(n){for(var a=0;a<n.length;a++)a!==r&&n[a].unsubscribe();n=null}t.next(e)}))))},a=0;n&&!t.closed&&a<e.length;a++)r(a)}}K_.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=Q_.argsOrArgArray(e)).length?X_.innerFrom(e[0]):new Z_.Observable(tw(e))},K_.raceInit=tw;var nw={};Object.defineProperty(nw,"__esModule",{value:!0}),nw.range=void 0;var rw=Zp,aw=xg;nw.range=function(e,t,n){if(null==t&&(t=e,e=0),t<=0)return aw.EMPTY;var r=t+e;return new rw.Observable(n?function(t){var a=e;return n.schedule((function(){a<r?(t.next(a++),this.schedule()):t.complete()}))}:function(t){for(var n=e;n<r&&!t.closed;)t.next(n++);t.complete()})};var ow={};Object.defineProperty(ow,"__esModule",{value:!0}),ow.using=void 0;var iw=Zp,sw=Pg,lw=xg;ow.using=function(e,t){return new iw.Observable((function(n){var r=e(),a=t(r);return(a?sw.innerFrom(a):lw.EMPTY).subscribe(n),function(){r&&r.unsubscribe()}}))};var cw={},uw=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},fw=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(cw,"__esModule",{value:!0}),cw.zip=void 0;var dw=Zp,pw=Pg,hw=P_,mw=xg,gw=zh,yw=Eg;cw.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yw.popResultSelector(e),r=hw.argsOrArgArray(e);return r.length?new dw.Observable((function(e){var t=r.map((function(){return[]})),a=r.map((function(){return!1}));e.add((function(){t=a=null}));for(var o=function(o){pw.innerFrom(r[o]).subscribe(gw.createOperatorSubscriber(e,(function(r){if(t[o].push(r),t.every((function(e){return e.length}))){var i=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,fw([],uw(i))):i),t.some((function(e,t){return!e.length&&a[t]}))&&e.complete()}}),(function(){a[o]=!0,!t[o].length&&e.complete()})))},i=0;!e.closed&&i<r.length;i++)o(i);return function(){t=a=null}})):mw.EMPTY};var vw={};Object.defineProperty(vw,"__esModule",{value:!0});var bw={};Object.defineProperty(bw,"__esModule",{value:!0}),bw.audit=void 0;var _w=qh,ww=Pg,xw=zh;bw.audit=function(e){return _w.operate((function(t,n){var r=!1,a=null,o=null,i=!1,s=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}i&&n.complete()},l=function(){o=null,i&&n.complete()};t.subscribe(xw.createOperatorSubscriber(n,(function(t){r=!0,a=t,o||ww.innerFrom(e(t)).subscribe(o=xw.createOperatorSubscriber(n,s,l))}),(function(){i=!0,(!r||!o||o.closed)&&n.complete()})))}))};var Sw={};Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.auditTime=void 0;var Ew=ng,kw=bw,Aw=v_;Sw.auditTime=function(e,t){return void 0===t&&(t=Ew.asyncScheduler),kw.audit((function(){return Aw.timer(e,t)}))};var Cw={};Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.buffer=void 0;var Ow=qh,Tw=yh,Nw=zh,Rw=Pg;Cw.buffer=function(e){return Ow.operate((function(t,n){var r=[];return t.subscribe(Nw.createOperatorSubscriber(n,(function(e){return r.push(e)}),(function(){n.next(r),n.complete()}))),Rw.innerFrom(e).subscribe(Nw.createOperatorSubscriber(n,(function(){var e=r;r=[],n.next(e)}),Tw.noop)),function(){r=null}}))};var Iw={},Pw=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.bufferCount=void 0;var Fw=qh,Mw=zh,jw=rh;Iw.bufferCount=function(e,t){return void 0===t&&(t=null),t=null!=t?t:e,Fw.operate((function(n,r){var a=[],o=0;n.subscribe(Mw.createOperatorSubscriber(r,(function(n){var i,s,l,c,u=null;o++%t==0&&a.push([]);try{for(var f=Pw(a),d=f.next();!d.done;d=f.next())(m=d.value).push(n),e<=m.length&&(u=null!=u?u:[]).push(m)}catch(e){i={error:e}}finally{try{d&&!d.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}if(u)try{for(var p=Pw(u),h=p.next();!h.done;h=p.next()){var m;jw.arrRemove(a,m=h.value),r.next(m)}}catch(e){l={error:e}}finally{try{h&&!h.done&&(c=p.return)&&c.call(p)}finally{if(l)throw l.error}}}),(function(){var e,t;try{for(var n=Pw(a),o=n.next();!o.done;o=n.next())r.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.complete()}),void 0,(function(){a=null})))}))};var Dw={},Lw=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.bufferTime=void 0;var qw=eh,Bw=qh,Uw=zh,zw=rh,Gw=ng,Hw=Eg,$w=wy;Dw.bufferTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=Hw.popScheduler(r))&&void 0!==t?t:Gw.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return Bw.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.buffer;e.subs.unsubscribe(),zw.arrRemove(r,e),n.next(t),a&&c()},c=function(){if(r){var t=new qw.Subscription;n.add(t);var a={buffer:[],subs:t};r.push(a),$w.executeSchedule(t,o,(function(){return l(a)}),e)}};null!==i&&i>=0?$w.executeSchedule(n,o,c,i,!0):a=!0,c();var u=Uw.createOperatorSubscriber(n,(function(e){var t,n,a=r.slice();try{for(var o=Lw(a),i=o.next();!i.done;i=o.next()){var c=i.value,u=c.buffer;u.push(e),s<=u.length&&l(c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;null==r?void 0:r.length;)n.next(r.shift().buffer);null==u||u.unsubscribe(),n.complete(),n.unsubscribe()}),void 0,(function(){return r=null}));t.subscribe(u)}))};var Ww={},Vw=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.bufferToggle=void 0;var Jw=eh,Yw=qh,Kw=Pg,Zw=zh,Xw=yh,Qw=rh;Ww.bufferToggle=function(e,t){return Yw.operate((function(n,r){var a=[];Kw.innerFrom(e).subscribe(Zw.createOperatorSubscriber(r,(function(e){var n=[];a.push(n);var o=new Jw.Subscription;o.add(Kw.innerFrom(t(e)).subscribe(Zw.createOperatorSubscriber(r,(function(){Qw.arrRemove(a,n),r.next(n),o.unsubscribe()}),Xw.noop)))}),Xw.noop)),n.subscribe(Zw.createOperatorSubscriber(r,(function(e){var t,n;try{for(var r=Vw(a),o=r.next();!o.done;o=r.next())o.value.push(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}),(function(){for(;a.length>0;)r.next(a.shift());r.complete()})))}))};var ex={};Object.defineProperty(ex,"__esModule",{value:!0}),ex.bufferWhen=void 0;var tx=qh,nx=yh,rx=zh,ax=Pg;ex.bufferWhen=function(e){return tx.operate((function(t,n){var r=null,a=null;!function t(){null==a||a.unsubscribe();var o=r;r=[],o&&n.next(o),ax.innerFrom(e()).subscribe(a=rx.createOperatorSubscriber(n,t,nx.noop))}(),t.subscribe(rx.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.push(e)}),(function(){r&&n.next(r),n.complete()}),void 0,(function(){return r=a=null})))}))};var ox={};Object.defineProperty(ox,"__esModule",{value:!0}),ox.catchError=void 0;var ix=Pg,sx=zh,lx=qh;ox.catchError=function e(t){return lx.operate((function(n,r){var a,o=null,i=!1;o=n.subscribe(sx.createOperatorSubscriber(r,void 0,void 0,(function(s){a=ix.innerFrom(t(s,e(t)(n))),o?(o.unsubscribe(),o=null,a.subscribe(r)):i=!0}))),i&&(o.unsubscribe(),o=null,a.subscribe(r))}))};var cx={},ux={},fx={},dx={},px={},hx={};Object.defineProperty(hx,"__esModule",{value:!0}),hx.scanInternals=void 0;var mx=zh;hx.scanInternals=function(e,t,n,r,a){return function(o,i){var s=n,l=t,c=0;o.subscribe(mx.createOperatorSubscriber(i,(function(t){var n=c++;l=s?e(l,t,n):(s=!0,t),r&&i.next(l)}),a&&function(){s&&i.next(l),i.complete()}))}},Object.defineProperty(px,"__esModule",{value:!0}),px.reduce=void 0;var gx=hx,yx=qh;px.reduce=function(e,t){return yx.operate(gx.scanInternals(e,t,arguments.length>=2,!1,!0))},Object.defineProperty(dx,"__esModule",{value:!0}),dx.toArray=void 0;var vx=px,bx=qh,_x=function(e,t){return e.push(t),e};dx.toArray=function(){return bx.operate((function(e,t){vx.reduce(_x,[])(e).subscribe(t)}))},Object.defineProperty(fx,"__esModule",{value:!0}),fx.joinAllInternals=void 0;var wx=kh,xx=Tv,Sx=Eh,Ex=mb,kx=dx;fx.joinAllInternals=function(e,t){return Sx.pipe(kx.toArray(),Ex.mergeMap((function(t){return e(t)})),t?xx.mapOneOrManyArgs(t):wx.identity)},Object.defineProperty(ux,"__esModule",{value:!0}),ux.combineLatestAll=void 0;var Ax=Jv,Cx=fx;ux.combineLatestAll=function(e){return Cx.joinAllInternals(Ax.combineLatest,e)},Object.defineProperty(cx,"__esModule",{value:!0}),cx.combineAll=void 0,cx.combineAll=ux.combineLatestAll;var Ox={},Tx={},Nx=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Rx=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Tx,"__esModule",{value:!0}),Tx.combineLatest=void 0;var Ix=Jv,Px=qh,Fx=P_,Mx=Tv,jx=Eh,Dx=Eg;Tx.combineLatest=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Dx.popResultSelector(t);return r?jx.pipe(e.apply(void 0,Rx([],Nx(t))),Mx.mapOneOrManyArgs(r)):Px.operate((function(e,n){Ix.combineLatestInit(Rx([e],Nx(Fx.argsOrArgArray(t))))(n)}))};var Lx=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},qx=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Ox,"__esModule",{value:!0}),Ox.combineLatestWith=void 0;var Bx=Tx;Ox.combineLatestWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Bx.combineLatest.apply(void 0,qx([],Lx(e)))};var Ux={};Object.defineProperty(Ux,"__esModule",{value:!0}),Ux.concatMap=void 0;var zx=mb,Gx=Qp;Ux.concatMap=function(e,t){return Gx.isFunction(t)?zx.mergeMap(e,t,1):zx.mergeMap(e,1)};var Hx={};Object.defineProperty(Hx,"__esModule",{value:!0}),Hx.concatMapTo=void 0;var $x=Ux,Wx=Qp;Hx.concatMapTo=function(e,t){return Wx.isFunction(t)?$x.concatMap((function(){return e}),t):$x.concatMap((function(){return e}))};var Vx={},Jx={},Yx=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Kx=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Jx,"__esModule",{value:!0}),Jx.concat=void 0;var Zx=qh,Xx=pb,Qx=Eg,eS=Ng;Jx.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Qx.popScheduler(e);return Zx.operate((function(t,r){Xx.concatAll()(eS.from(Kx([t],Yx(e)),n)).subscribe(r)}))};var tS=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},nS=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Vx,"__esModule",{value:!0}),Vx.concatWith=void 0;var rS=Jx;Vx.concatWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return rS.concat.apply(void 0,nS([],tS(e)))};var aS={},oS={};Object.defineProperty(oS,"__esModule",{value:!0}),oS.fromSubscribable=void 0;var iS=Zp;oS.fromSubscribable=function(e){return new iS.Observable((function(t){return e.subscribe(t)}))},Object.defineProperty(aS,"__esModule",{value:!0}),aS.connect=void 0;var sS=lm,lS=Pg,cS=qh,uS=oS,fS={connector:function(){return new sS.Subject}};aS.connect=function(e,t){void 0===t&&(t=fS);var n=t.connector;return cS.operate((function(t,r){var a=n();lS.innerFrom(e(uS.fromSubscribable(a))).subscribe(r),r.add(t.subscribe(a))}))};var dS={};Object.defineProperty(dS,"__esModule",{value:!0}),dS.count=void 0;var pS=px;dS.count=function(e){return pS.reduce((function(t,n,r){return!e||e(n,r)?t+1:t}),0)};var hS={};Object.defineProperty(hS,"__esModule",{value:!0}),hS.debounce=void 0;var mS=qh,gS=yh,yS=zh,vS=Pg;hS.debounce=function(e){return mS.operate((function(t,n){var r=!1,a=null,o=null,i=function(){if(null==o||o.unsubscribe(),o=null,r){r=!1;var e=a;a=null,n.next(e)}};t.subscribe(yS.createOperatorSubscriber(n,(function(t){null==o||o.unsubscribe(),r=!0,a=t,o=yS.createOperatorSubscriber(n,i,gS.noop),vS.innerFrom(e(t)).subscribe(o)}),(function(){i(),n.complete()}),void 0,(function(){a=o=null})))}))};var bS={};Object.defineProperty(bS,"__esModule",{value:!0}),bS.debounceTime=void 0;var _S=ng,wS=qh,xS=zh;bS.debounceTime=function(e,t){return void 0===t&&(t=_S.asyncScheduler),wS.operate((function(n,r){var a=null,o=null,i=null,s=function(){if(a){a.unsubscribe(),a=null;var e=o;o=null,r.next(e)}};function l(){var n=i+e,o=t.now();if(o<n)return a=this.schedule(void 0,n-o),void r.add(a);s()}n.subscribe(xS.createOperatorSubscriber(r,(function(n){o=n,i=t.now(),a||(a=t.schedule(l,e),r.add(a))}),(function(){s(),r.complete()}),void 0,(function(){o=a=null})))}))};var SS={};Object.defineProperty(SS,"__esModule",{value:!0}),SS.defaultIfEmpty=void 0;var ES=qh,kS=zh;SS.defaultIfEmpty=function(e){return ES.operate((function(t,n){var r=!1;t.subscribe(kS.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))};var AS={},CS={},OS={};Object.defineProperty(OS,"__esModule",{value:!0}),OS.take=void 0;var TS=xg,NS=qh,RS=zh;OS.take=function(e){return e<=0?function(){return TS.EMPTY}:NS.operate((function(t,n){var r=0;t.subscribe(RS.createOperatorSubscriber(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))};var IS={};Object.defineProperty(IS,"__esModule",{value:!0}),IS.ignoreElements=void 0;var PS=qh,FS=zh,MS=yh;IS.ignoreElements=function(){return PS.operate((function(e,t){e.subscribe(FS.createOperatorSubscriber(t,MS.noop))}))};var jS={};Object.defineProperty(jS,"__esModule",{value:!0}),jS.mapTo=void 0;var DS=Nv;jS.mapTo=function(e){return DS.map((function(){return e}))},Object.defineProperty(CS,"__esModule",{value:!0}),CS.delayWhen=void 0;var LS=db,qS=OS,BS=IS,US=jS,zS=mb,GS=Pg;CS.delayWhen=function e(t,n){return n?function(r){return LS.concat(n.pipe(qS.take(1),BS.ignoreElements()),r.pipe(e(t)))}:zS.mergeMap((function(e,n){return GS.innerFrom(t(e,n)).pipe(qS.take(1),US.mapTo(e))}))},Object.defineProperty(AS,"__esModule",{value:!0}),AS.delay=void 0;var HS=ng,$S=CS,WS=v_;AS.delay=function(e,t){void 0===t&&(t=HS.asyncScheduler);var n=WS.timer(e,t);return $S.delayWhen((function(){return n}))};var VS={};Object.defineProperty(VS,"__esModule",{value:!0}),VS.dematerialize=void 0;var JS=wg,YS=qh,KS=zh;VS.dematerialize=function(){return YS.operate((function(e,t){e.subscribe(KS.createOperatorSubscriber(t,(function(e){return JS.observeNotification(e,t)})))}))};var ZS={};Object.defineProperty(ZS,"__esModule",{value:!0}),ZS.distinct=void 0;var XS=qh,QS=zh,eE=yh,tE=Pg;ZS.distinct=function(e,t){return XS.operate((function(n,r){var a=new Set;n.subscribe(QS.createOperatorSubscriber(r,(function(t){var n=e?e(t):t;a.has(n)||(a.add(n),r.next(t))}))),t&&tE.innerFrom(t).subscribe(QS.createOperatorSubscriber(r,(function(){return a.clear()}),eE.noop))}))};var nE={};Object.defineProperty(nE,"__esModule",{value:!0}),nE.distinctUntilChanged=void 0;var rE=kh,aE=qh,oE=zh;function iE(e,t){return e===t}nE.distinctUntilChanged=function(e,t){return void 0===t&&(t=rE.identity),e=null!=e?e:iE,aE.operate((function(n,r){var a,o=!0;n.subscribe(oE.createOperatorSubscriber(r,(function(n){var i=t(n);!o&&e(a,i)||(o=!1,a=i,r.next(n))})))}))};var sE={};Object.defineProperty(sE,"__esModule",{value:!0}),sE.distinctUntilKeyChanged=void 0;var lE=nE;sE.distinctUntilKeyChanged=function(e,t){return lE.distinctUntilChanged((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))};var cE={},uE={};Object.defineProperty(uE,"__esModule",{value:!0}),uE.throwIfEmpty=void 0;var fE=yv,dE=qh,pE=zh;function hE(){return new fE.EmptyError}uE.throwIfEmpty=function(e){return void 0===e&&(e=hE),dE.operate((function(t,n){var r=!1;t.subscribe(pE.createOperatorSubscriber(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))},Object.defineProperty(cE,"__esModule",{value:!0}),cE.elementAt=void 0;var mE=xv,gE=H_,yE=uE,vE=SS,bE=OS;cE.elementAt=function(e,t){if(e<0)throw new mE.ArgumentOutOfRangeError;var n=arguments.length>=2;return function(r){return r.pipe(gE.filter((function(t,n){return n===e})),bE.take(1),n?vE.defaultIfEmpty(t):yE.throwIfEmpty((function(){return new mE.ArgumentOutOfRangeError})))}};var _E={},wE=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},xE=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(_E,"__esModule",{value:!0}),_E.endWith=void 0;var SE=db,EE=Sg;_E.endWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return SE.concat(t,EE.of.apply(void 0,xE([],wE(e))))}};var kE={};Object.defineProperty(kE,"__esModule",{value:!0}),kE.every=void 0;var AE=qh,CE=zh;kE.every=function(e,t){return AE.operate((function(n,r){var a=0;n.subscribe(CE.createOperatorSubscriber(r,(function(o){e.call(t,o,a++,n)||(r.next(!1),r.complete())}),(function(){r.next(!0),r.complete()})))}))};var OE={},TE={},NE={};Object.defineProperty(NE,"__esModule",{value:!0}),NE.exhaustMap=void 0;var RE=Nv,IE=Pg,PE=qh,FE=zh;NE.exhaustMap=function e(t,n){return n?function(r){return r.pipe(e((function(e,r){return IE.innerFrom(t(e,r)).pipe(RE.map((function(t,a){return n(e,t,r,a)})))})))}:PE.operate((function(e,n){var r=0,a=null,o=!1;e.subscribe(FE.createOperatorSubscriber(n,(function(e){a||(a=FE.createOperatorSubscriber(n,void 0,(function(){a=null,o&&n.complete()})),IE.innerFrom(t(e,r++)).subscribe(a))}),(function(){o=!0,!a&&n.complete()})))}))},Object.defineProperty(TE,"__esModule",{value:!0}),TE.exhaustAll=void 0;var ME=NE,jE=kh;TE.exhaustAll=function(){return ME.exhaustMap(jE.identity)},Object.defineProperty(OE,"__esModule",{value:!0}),OE.exhaust=void 0,OE.exhaust=TE.exhaustAll;var DE={};Object.defineProperty(DE,"__esModule",{value:!0}),DE.expand=void 0;var LE=qh,qE=gb;DE.expand=function(e,t,n){return void 0===t&&(t=Infinity),t=(t||0)<1?Infinity:t,LE.operate((function(r,a){return qE.mergeInternals(r,a,e,t,void 0,!0,n)}))};var BE={};Object.defineProperty(BE,"__esModule",{value:!0}),BE.finalize=void 0;var UE=qh;BE.finalize=function(e){return UE.operate((function(t,n){try{t.subscribe(n)}finally{n.add(e)}}))};var zE={};Object.defineProperty(zE,"__esModule",{value:!0}),zE.createFind=zE.find=void 0;var GE=qh,HE=zh;function $E(e,t,n){var r="index"===n;return function(n,a){var o=0;n.subscribe(HE.createOperatorSubscriber(a,(function(i){var s=o++;e.call(t,i,s,n)&&(a.next(r?s:i),a.complete())}),(function(){a.next(r?-1:void 0),a.complete()})))}}zE.find=function(e,t){return GE.operate($E(e,t,"value"))},zE.createFind=$E;var WE={};Object.defineProperty(WE,"__esModule",{value:!0}),WE.findIndex=void 0;var VE=qh,JE=zE;WE.findIndex=function(e,t){return VE.operate(JE.createFind(e,t,"index"))};var YE={};Object.defineProperty(YE,"__esModule",{value:!0}),YE.first=void 0;var KE=yv,ZE=H_,XE=OS,QE=SS,ek=uE,tk=kh;YE.first=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?ZE.filter((function(t,n){return e(t,n,r)})):tk.identity,XE.take(1),n?QE.defaultIfEmpty(t):ek.throwIfEmpty((function(){return new KE.EmptyError})))}};var nk={};Object.defineProperty(nk,"__esModule",{value:!0}),nk.groupBy=void 0;var rk=Zp,ak=Pg,ok=lm,ik=qh,sk=zh;nk.groupBy=function(e,t,n,r){return ik.operate((function(a,o){var i;t&&"function"!=typeof t?(n=t.duration,i=t.element,r=t.connector):i=t;var s=new Map,l=function(e){s.forEach(e),e(o)},c=function(e){return l((function(t){return t.error(e)}))},u=0,f=!1,d=new sk.OperatorSubscriber(o,(function(t){try{var a=e(t),l=s.get(a);if(!l){s.set(a,l=r?r():new ok.Subject);var p=(m=a,g=l,(y=new rk.Observable((function(e){u++;var t=g.subscribe(e);return function(){t.unsubscribe(),0==--u&&f&&d.unsubscribe()}}))).key=m,y);if(o.next(p),n){var h=sk.createOperatorSubscriber(l,(function(){l.complete(),null==h||h.unsubscribe()}),void 0,void 0,(function(){return s.delete(a)}));d.add(ak.innerFrom(n(p)).subscribe(h))}}l.next(i?i(t):t)}catch(e){c(e)}var m,g,y}),(function(){return l((function(e){return e.complete()}))}),c,(function(){return s.clear()}),(function(){return f=!0,0===u}));a.subscribe(d)}))};var lk={};Object.defineProperty(lk,"__esModule",{value:!0}),lk.isEmpty=void 0;var ck=qh,uk=zh;lk.isEmpty=function(){return ck.operate((function(e,t){e.subscribe(uk.createOperatorSubscriber(t,(function(){t.next(!1),t.complete()}),(function(){t.next(!0),t.complete()})))}))};var fk={},dk={},pk=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(dk,"__esModule",{value:!0}),dk.takeLast=void 0;var hk=xg,mk=qh,gk=zh;dk.takeLast=function(e){return e<=0?function(){return hk.EMPTY}:mk.operate((function(t,n){var r=[];t.subscribe(gk.createOperatorSubscriber(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var a=pk(r),o=a.next();!o.done;o=a.next())n.next(o.value)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))},Object.defineProperty(fk,"__esModule",{value:!0}),fk.last=void 0;var yk=yv,vk=H_,bk=dk,_k=uE,wk=SS,xk=kh;fk.last=function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?vk.filter((function(t,n){return e(t,n,r)})):xk.identity,bk.takeLast(1),n?wk.defaultIfEmpty(t):_k.throwIfEmpty((function(){return new yk.EmptyError})))}};var Sk={};Object.defineProperty(Sk,"__esModule",{value:!0}),Sk.materialize=void 0;var Ek=wg,kk=qh,Ak=zh;Sk.materialize=function(){return kk.operate((function(e,t){e.subscribe(Ak.createOperatorSubscriber(t,(function(e){t.next(Ek.Notification.createNext(e))}),(function(){t.next(Ek.Notification.createComplete()),t.complete()}),(function(e){t.next(Ek.Notification.createError(e)),t.complete()})))}))};var Ck={};Object.defineProperty(Ck,"__esModule",{value:!0}),Ck.max=void 0;var Ok=px,Tk=Qp;Ck.max=function(e){return Ok.reduce(Tk.isFunction(e)?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})};var Nk={};Object.defineProperty(Nk,"__esModule",{value:!0}),Nk.flatMap=void 0,Nk.flatMap=mb.mergeMap;var Rk={};Object.defineProperty(Rk,"__esModule",{value:!0}),Rk.mergeMapTo=void 0;var Ik=mb,Pk=Qp;Rk.mergeMapTo=function(e,t,n){return void 0===n&&(n=Infinity),Pk.isFunction(t)?Ik.mergeMap((function(){return e}),t,n):("number"==typeof t&&(n=t),Ik.mergeMap((function(){return e}),n))};var Fk={};Object.defineProperty(Fk,"__esModule",{value:!0}),Fk.mergeScan=void 0;var Mk=qh,jk=gb;Fk.mergeScan=function(e,t,n){return void 0===n&&(n=Infinity),Mk.operate((function(r,a){var o=t;return jk.mergeInternals(r,a,(function(t,n){return e(o,t,n)}),n,(function(e){o=e}),!1,void 0,(function(){return o=null}))}))};var Dk={},Lk={},qk=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Bk=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Lk,"__esModule",{value:!0}),Lk.merge=void 0;var Uk=qh,zk=P_,Gk=hb,Hk=Eg,$k=Ng;Lk.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Hk.popScheduler(e),r=Hk.popNumber(e,Infinity);return e=zk.argsOrArgArray(e),Uk.operate((function(t,a){Gk.mergeAll(r)($k.from(Bk([t],qk(e)),n)).subscribe(a)}))};var Wk=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},Vk=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(Dk,"__esModule",{value:!0}),Dk.mergeWith=void 0;var Jk=Lk;Dk.mergeWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Jk.merge.apply(void 0,Vk([],Wk(e)))};var Yk={};Object.defineProperty(Yk,"__esModule",{value:!0}),Yk.min=void 0;var Kk=px,Zk=Qp;Yk.min=function(e){return Kk.reduce(Zk.isFunction(e)?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})};var Xk={};Object.defineProperty(Xk,"__esModule",{value:!0}),Xk.multicast=void 0;var Qk=Dh,eA=Qp,tA=aS;Xk.multicast=function(e,t){var n=eA.isFunction(e)?e:function(){return e};return eA.isFunction(t)?tA.connect(t,{connector:n}):function(e){return new Qk.ConnectableObservable(e,n)}};var nA={},rA=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},aA=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(nA,"__esModule",{value:!0}),nA.onErrorResumeNext=nA.onErrorResumeNextWith=void 0;var oA=P_,iA=I_;function sA(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=oA.argsOrArgArray(e);return function(e){return iA.onErrorResumeNext.apply(void 0,aA([e],rA(n)))}}nA.onErrorResumeNextWith=sA,nA.onErrorResumeNext=sA;var lA={};Object.defineProperty(lA,"__esModule",{value:!0}),lA.pairwise=void 0;var cA=qh,uA=zh;lA.pairwise=function(){return cA.operate((function(e,t){var n,r=!1;e.subscribe(uA.createOperatorSubscriber(t,(function(e){var a=n;n=e,r&&t.next([a,e]),r=!0})))}))};var fA={};Object.defineProperty(fA,"__esModule",{value:!0}),fA.pluck=void 0;var dA=Nv;fA.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return dA.map((function(t){for(var r=t,a=0;a<n;a++){var o=null==r?void 0:r[e[a]];if(void 0===o)return;r=o}return r}))};var pA={};Object.defineProperty(pA,"__esModule",{value:!0}),pA.publish=void 0;var hA=lm,mA=Xk,gA=aS;pA.publish=function(e){return e?function(t){return gA.connect(e)(t)}:function(e){return mA.multicast(new hA.Subject)(e)}};var yA={};Object.defineProperty(yA,"__esModule",{value:!0}),yA.publishBehavior=void 0;var vA=bm,bA=Dh;yA.publishBehavior=function(e){return function(t){var n=new vA.BehaviorSubject(e);return new bA.ConnectableObservable(t,(function(){return n}))}};var _A={};Object.defineProperty(_A,"__esModule",{value:!0}),_A.publishLast=void 0;var wA=Cm,xA=Dh;_A.publishLast=function(){return function(e){var t=new wA.AsyncSubject;return new xA.ConnectableObservable(e,(function(){return t}))}};var SA={};Object.defineProperty(SA,"__esModule",{value:!0}),SA.publishReplay=void 0;var EA=xm,kA=Xk,AA=Qp;SA.publishReplay=function(e,t,n,r){n&&!AA.isFunction(n)&&(r=n);var a=AA.isFunction(n)?n:void 0;return function(n){return kA.multicast(new EA.ReplaySubject(e,t,r),a)(n)}};var CA={},OA=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},TA=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(CA,"__esModule",{value:!0}),CA.raceWith=void 0;var NA=K_,RA=qh,IA=kh;CA.raceWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?RA.operate((function(t,n){NA.raceInit(TA([t],OA(e)))(n)})):IA.identity};var PA={};Object.defineProperty(PA,"__esModule",{value:!0}),PA.repeat=void 0;var FA=xg,MA=qh,jA=zh,DA=Pg,LA=v_;PA.repeat=function(e){var t,n,r=Infinity;return null!=e&&("object"===Y(e)?(r=void 0===(t=e.count)?Infinity:t,n=e.delay):r=e),r<=0?function(){return FA.EMPTY}:MA.operate((function(e,t){var a,o=0,i=function(){if(null==a||a.unsubscribe(),a=null,null!=n){var e="number"==typeof n?LA.timer(n):DA.innerFrom(n(o)),r=jA.createOperatorSubscriber(t,(function(){r.unsubscribe(),s()}));e.subscribe(r)}else s()},s=function(){var n=!1;a=e.subscribe(jA.createOperatorSubscriber(t,void 0,(function(){++o<r?a?i():n=!0:t.complete()}))),n&&i()};s()}))};var qA={};Object.defineProperty(qA,"__esModule",{value:!0}),qA.repeatWhen=void 0;var BA=Pg,UA=lm,zA=qh,GA=zh;qA.repeatWhen=function(e){return zA.operate((function(t,n){var r,a,o=!1,i=!1,s=!1,l=function(){return s&&i&&(n.complete(),!0)},c=function(){return a||(a=new UA.Subject,BA.innerFrom(e(a)).subscribe(GA.createOperatorSubscriber(n,(function(){r?u():o=!0}),(function(){i=!0,l()})))),a},u=function e(){s=!1,r=t.subscribe(GA.createOperatorSubscriber(n,void 0,(function(){s=!0,!l()&&c().next()}))),o&&(r.unsubscribe(),r=null,o=!1,e())};u()}))};var HA={};Object.defineProperty(HA,"__esModule",{value:!0}),HA.retry=void 0;var $A=qh,WA=zh,VA=kh,JA=v_,YA=Pg;HA.retry=function(e){var t;void 0===e&&(e=Infinity);var n=(t=e&&"object"===Y(e)?e:{count:e}).count,r=void 0===n?Infinity:n,a=t.delay,o=t.resetOnSuccess,i=void 0!==o&&o;return r<=0?VA.identity:$A.operate((function(e,t){var n,o=0;!function s(){var l=!1;n=e.subscribe(WA.createOperatorSubscriber(t,(function(e){i&&(o=0),t.next(e)}),void 0,(function(e){if(o++<r){var i=function(){n?(n.unsubscribe(),n=null,s()):l=!0};if(null!=a){var c="number"==typeof a?JA.timer(a):YA.innerFrom(a(e,o)),u=WA.createOperatorSubscriber(t,(function(){u.unsubscribe(),i()}),(function(){t.complete()}));c.subscribe(u)}else i()}else t.error(e)}))),l&&(n.unsubscribe(),n=null,s())}()}))};var KA={};Object.defineProperty(KA,"__esModule",{value:!0}),KA.retryWhen=void 0;var ZA=Pg,XA=lm,QA=qh,eC=zh;KA.retryWhen=function(e){return QA.operate((function(t,n){var r,a,o=!1;!function i(){r=t.subscribe(eC.createOperatorSubscriber(n,void 0,void 0,(function(t){a||(a=new XA.Subject,ZA.innerFrom(e(a)).subscribe(eC.createOperatorSubscriber(n,(function(){return r?i():o=!0})))),a&&a.next(t)}))),o&&(r.unsubscribe(),r=null,o=!1,i())}()}))};var tC={};Object.defineProperty(tC,"__esModule",{value:!0}),tC.sample=void 0;var nC=Pg,rC=qh,aC=yh,oC=zh;tC.sample=function(e){return rC.operate((function(t,n){var r=!1,a=null;t.subscribe(oC.createOperatorSubscriber(n,(function(e){r=!0,a=e}))),nC.innerFrom(e).subscribe(oC.createOperatorSubscriber(n,(function(){if(r){r=!1;var e=a;a=null,n.next(e)}}),aC.noop))}))};var iC={};Object.defineProperty(iC,"__esModule",{value:!0}),iC.sampleTime=void 0;var sC=ng,lC=tC,cC=y_;iC.sampleTime=function(e,t){return void 0===t&&(t=sC.asyncScheduler),lC.sample(cC.interval(e,t))};var uC={};Object.defineProperty(uC,"__esModule",{value:!0}),uC.scan=void 0;var fC=qh,dC=hx;uC.scan=function(e,t){return fC.operate(dC.scanInternals(e,t,arguments.length>=2,!0))};var pC={};Object.defineProperty(pC,"__esModule",{value:!0}),pC.sequenceEqual=void 0;var hC=qh,mC=zh,gC=Pg;pC.sequenceEqual=function(e,t){return void 0===t&&(t=function(e,t){return e===t}),hC.operate((function(n,r){var a={buffer:[],complete:!1},o={buffer:[],complete:!1},i=function(e){r.next(e),r.complete()},s=function(e,n){var a=mC.createOperatorSubscriber(r,(function(r){var a=n.buffer;0===a.length?n.complete?i(!1):e.buffer.push(r):!t(r,a.shift())&&i(!1)}),(function(){e.complete=!0,n.complete&&i(0===n.buffer.length),null==a||a.unsubscribe()}));return a};n.subscribe(s(a,o)),gC.innerFrom(e).subscribe(s(o,a))}))};var yC={},vC=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},bC=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(yC,"__esModule",{value:!0}),yC.share=void 0;var _C=Pg,wC=lm,xC=Xp,SC=qh;function EC(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var a=new xC.SafeSubscriber({next:function(){a.unsubscribe(),e()}});return _C.innerFrom(t.apply(void 0,bC([],vC(n)))).subscribe(a)}}else e()}yC.share=function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new wC.Subject}:t,r=e.resetOnError,a=void 0===r||r,o=e.resetOnComplete,i=void 0===o||o,s=e.resetOnRefCountZero,l=void 0===s||s;return function(e){var t,r,o,s=0,c=!1,u=!1,f=function(){null==r||r.unsubscribe(),r=void 0},d=function(){f(),t=o=void 0,c=u=!1},p=function(){var e=t;d(),null==e||e.unsubscribe()};return SC.operate((function(e,h){s++,u||c||f();var m=o=null!=o?o:n();h.add((function(){0!=--s||u||c||(r=EC(p,l))})),m.subscribe(h),!t&&s>0&&(t=new xC.SafeSubscriber({next:function(e){return m.next(e)},error:function(e){u=!0,f(),r=EC(d,a,e),m.error(e)},complete:function(){c=!0,f(),r=EC(d,i),m.complete()}}),_C.innerFrom(e).subscribe(t))}))(e)}};var kC={};Object.defineProperty(kC,"__esModule",{value:!0}),kC.shareReplay=void 0;var AC=xm,CC=yC;kC.shareReplay=function(e,t,n){var r,a,o,i,s=!1;return e&&"object"===Y(e)?(i=void 0===(r=e.bufferSize)?Infinity:r,t=void 0===(a=e.windowTime)?Infinity:a,s=void 0!==(o=e.refCount)&&o,n=e.scheduler):i=null!=e?e:Infinity,CC.share({connector:function(){return new AC.ReplaySubject(i,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})};var OC={};Object.defineProperty(OC,"__esModule",{value:!0}),OC.single=void 0;var TC=yv,NC=Ev,RC=Sv,IC=qh,PC=zh;OC.single=function(e){return IC.operate((function(t,n){var r,a=!1,o=!1,i=0;t.subscribe(PC.createOperatorSubscriber(n,(function(s){o=!0,e&&!e(s,i++,t)||(a&&n.error(new NC.SequenceError("Too many matching values")),a=!0,r=s)}),(function(){a?(n.next(r),n.complete()):n.error(o?new RC.NotFoundError("No matching values"):new TC.EmptyError)})))}))};var FC={};Object.defineProperty(FC,"__esModule",{value:!0}),FC.skip=void 0;var MC=H_;FC.skip=function(e){return MC.filter((function(t,n){return e<=n}))};var jC={};Object.defineProperty(jC,"__esModule",{value:!0}),jC.skipLast=void 0;var DC=kh,LC=qh,qC=zh;jC.skipLast=function(e){return e<=0?DC.identity:LC.operate((function(t,n){var r=new Array(e),a=0;return t.subscribe(qC.createOperatorSubscriber(n,(function(t){var o=a++;if(o<e)r[o]=t;else{var i=o%e,s=r[i];r[i]=t,n.next(s)}}))),function(){r=null}}))};var BC={};Object.defineProperty(BC,"__esModule",{value:!0}),BC.skipUntil=void 0;var UC=qh,zC=zh,GC=Pg,HC=yh;BC.skipUntil=function(e){return UC.operate((function(t,n){var r=!1,a=zC.createOperatorSubscriber(n,(function(){null==a||a.unsubscribe(),r=!0}),HC.noop);GC.innerFrom(e).subscribe(a),t.subscribe(zC.createOperatorSubscriber(n,(function(e){return r&&n.next(e)})))}))};var $C={};Object.defineProperty($C,"__esModule",{value:!0}),$C.skipWhile=void 0;var WC=qh,VC=zh;$C.skipWhile=function(e){return WC.operate((function(t,n){var r=!1,a=0;t.subscribe(VC.createOperatorSubscriber(n,(function(t){return(r||(r=!e(t,a++)))&&n.next(t)})))}))};var JC={};Object.defineProperty(JC,"__esModule",{value:!0}),JC.startWith=void 0;var YC=db,KC=Eg,ZC=qh;JC.startWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=KC.popScheduler(e);return ZC.operate((function(t,r){(n?YC.concat(e,t,n):YC.concat(e,t)).subscribe(r)}))};var XC={},QC={};Object.defineProperty(QC,"__esModule",{value:!0}),QC.switchMap=void 0;var eO=Pg,tO=qh,nO=zh;QC.switchMap=function(e,t){return tO.operate((function(n,r){var a=null,o=0,i=!1,s=function(){return i&&!a&&r.complete()};n.subscribe(nO.createOperatorSubscriber(r,(function(n){null==a||a.unsubscribe();var i=0,l=o++;eO.innerFrom(e(n,l)).subscribe(a=nO.createOperatorSubscriber(r,(function(e){return r.next(t?t(n,e,l,i++):e)}),(function(){a=null,s()})))}),(function(){i=!0,s()})))}))},Object.defineProperty(XC,"__esModule",{value:!0}),XC.switchAll=void 0;var rO=QC,aO=kh;XC.switchAll=function(){return rO.switchMap(aO.identity)};var oO={};Object.defineProperty(oO,"__esModule",{value:!0}),oO.switchMapTo=void 0;var iO=QC,sO=Qp;oO.switchMapTo=function(e,t){return sO.isFunction(t)?iO.switchMap((function(){return e}),t):iO.switchMap((function(){return e}))};var lO={};Object.defineProperty(lO,"__esModule",{value:!0}),lO.switchScan=void 0;var cO=QC,uO=qh;lO.switchScan=function(e,t){return uO.operate((function(n,r){var a=t;return cO.switchMap((function(t,n){return e(a,t,n)}),(function(e,t){return a=t,t}))(n).subscribe(r),function(){a=null}}))};var fO={};Object.defineProperty(fO,"__esModule",{value:!0}),fO.takeUntil=void 0;var dO=qh,pO=zh,hO=Pg,mO=yh;fO.takeUntil=function(e){return dO.operate((function(t,n){hO.innerFrom(e).subscribe(pO.createOperatorSubscriber(n,(function(){return n.complete()}),mO.noop)),!n.closed&&t.subscribe(n)}))};var gO={};Object.defineProperty(gO,"__esModule",{value:!0}),gO.takeWhile=void 0;var yO=qh,vO=zh;gO.takeWhile=function(e,t){return void 0===t&&(t=!1),yO.operate((function(n,r){var a=0;n.subscribe(vO.createOperatorSubscriber(r,(function(n){var o=e(n,a++);(o||t)&&r.next(n),!o&&r.complete()})))}))};var bO={};Object.defineProperty(bO,"__esModule",{value:!0}),bO.tap=void 0;var _O=Qp,wO=qh,xO=zh,SO=kh;bO.tap=function(e,t,n){var r=_O.isFunction(e)||t||n?{next:e,error:t,complete:n}:e;return r?wO.operate((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var a=!0;e.subscribe(xO.createOperatorSubscriber(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;a=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;a=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;a&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):SO.identity};var EO={};Object.defineProperty(EO,"__esModule",{value:!0}),EO.throttle=void 0;var kO=qh,AO=zh,CO=Pg;EO.throttle=function(e,t){return kO.operate((function(n,r){var a=null!=t?t:{},o=a.leading,i=void 0===o||o,s=a.trailing,l=void 0!==s&&s,c=!1,u=null,f=null,d=!1,p=function(){null==f||f.unsubscribe(),f=null,l&&(g(),d&&r.complete())},h=function(){f=null,d&&r.complete()},m=function(t){return f=CO.innerFrom(e(t)).subscribe(AO.createOperatorSubscriber(r,p,h))},g=function(){if(c){c=!1;var e=u;u=null,r.next(e),!d&&m(e)}};n.subscribe(AO.createOperatorSubscriber(r,(function(e){c=!0,u=e,(!f||f.closed)&&(i?g():m(e))}),(function(){d=!0,(!(l&&c&&f)||f.closed)&&r.complete()})))}))};var OO={};Object.defineProperty(OO,"__esModule",{value:!0}),OO.throttleTime=void 0;var TO=ng,NO=EO,RO=v_;OO.throttleTime=function(e,t,n){void 0===t&&(t=TO.asyncScheduler);var r=RO.timer(e,t);return NO.throttle((function(){return r}),n)};var IO={};Object.defineProperty(IO,"__esModule",{value:!0}),IO.TimeInterval=IO.timeInterval=void 0;var PO=ng,FO=qh,MO=zh;IO.timeInterval=function(e){return void 0===e&&(e=PO.asyncScheduler),FO.operate((function(t,n){var r=e.now();t.subscribe(MO.createOperatorSubscriber(n,(function(t){var a=e.now(),o=a-r;r=a,n.next(new jO(t,o))})))}))};var jO=function(){return function(e,t){this.value=e,this.interval=t}}();IO.TimeInterval=jO;var DO={};Object.defineProperty(DO,"__esModule",{value:!0}),DO.timeoutWith=void 0;var LO=ng,qO=Av,BO=kv;DO.timeoutWith=function(e,t,n){var r,a,o;if(n=null!=n?n:LO.async,qO.isValidDate(e)?r=e:"number"==typeof e&&(a=e),!t)throw new TypeError("No observable provided to switch to");if(o=function(){return t},null==r&&null==a)throw new TypeError("No timeout provided.");return BO.timeout({first:r,each:a,scheduler:n,with:o})};var UO={};Object.defineProperty(UO,"__esModule",{value:!0}),UO.timestamp=void 0;var zO=Sm,GO=Nv;UO.timestamp=function(e){return void 0===e&&(e=zO.dateTimestampProvider),GO.map((function(t){return{value:t,timestamp:e.now()}}))};var HO={};Object.defineProperty(HO,"__esModule",{value:!0}),HO.window=void 0;var $O=lm,WO=qh,VO=zh,JO=yh,YO=Pg;HO.window=function(e){return WO.operate((function(t,n){var r=new $O.Subject;n.next(r.asObservable());var a=function(e){r.error(e),n.error(e)};return t.subscribe(VO.createOperatorSubscriber(n,(function(e){return null==r?void 0:r.next(e)}),(function(){r.complete(),n.complete()}),a)),YO.innerFrom(e).subscribe(VO.createOperatorSubscriber(n,(function(){r.complete(),n.next(r=new $O.Subject)}),JO.noop,a)),function(){null==r||r.unsubscribe(),r=null}}))};var KO={},ZO=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(KO,"__esModule",{value:!0}),KO.windowCount=void 0;var XO=lm,QO=qh,eT=zh;KO.windowCount=function(e,t){void 0===t&&(t=0);var n=t>0?t:e;return QO.operate((function(t,r){var a=[new XO.Subject],o=0;r.next(a[0].asObservable()),t.subscribe(eT.createOperatorSubscriber(r,(function(t){var i,s;try{for(var l=ZO(a),c=l.next();!c.done;c=l.next())c.value.next(t)}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}var u=o-e+1;if(u>=0&&u%n==0&&a.shift().complete(),++o%n==0){var f=new XO.Subject;a.push(f),r.next(f.asObservable())}}),(function(){for(;a.length>0;)a.shift().complete();r.complete()}),(function(e){for(;a.length>0;)a.shift().error(e);r.error(e)}),(function(){a=null})))}))};var tT={};Object.defineProperty(tT,"__esModule",{value:!0}),tT.windowTime=void 0;var nT=lm,rT=ng,aT=eh,oT=qh,iT=zh,sT=rh,lT=Eg,cT=wy;tT.windowTime=function(e){for(var t,n,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];var o=null!==(t=lT.popScheduler(r))&&void 0!==t?t:rT.asyncScheduler,i=null!==(n=r[0])&&void 0!==n?n:null,s=r[1]||Infinity;return oT.operate((function(t,n){var r=[],a=!1,l=function(e){var t=e.subs;e.window.complete(),t.unsubscribe(),sT.arrRemove(r,e),a&&c()},c=function(){if(r){var t=new aT.Subscription;n.add(t);var a=new nT.Subject,i={window:a,subs:t,seen:0};r.push(i),n.next(a.asObservable()),cT.executeSchedule(t,o,(function(){return l(i)}),e)}};null!==i&&i>=0?cT.executeSchedule(n,o,c,i,!0):a=!0,c();var u=function(e){return r.slice().forEach(e)},f=function(e){u((function(t){return e(t.window)})),e(n),n.unsubscribe()};return t.subscribe(iT.createOperatorSubscriber(n,(function(e){u((function(t){t.window.next(e),s<=++t.seen&&l(t)}))}),(function(){return f((function(e){return e.complete()}))}),(function(e){return f((function(t){return t.error(e)}))}))),function(){r=null}}))};var uT={},fT=D&&D.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(uT,"__esModule",{value:!0}),uT.windowToggle=void 0;var dT=lm,pT=eh,hT=qh,mT=Pg,gT=zh,yT=yh,vT=rh;uT.windowToggle=function(e,t){return hT.operate((function(n,r){var a=[],o=function(e){for(;0<a.length;)a.shift().error(e);r.error(e)};mT.innerFrom(e).subscribe(gT.createOperatorSubscriber(r,(function(e){var n=new dT.Subject;a.push(n);var i,s=new pT.Subscription;try{i=mT.innerFrom(t(e))}catch(e){return void o(e)}r.next(n.asObservable()),s.add(i.subscribe(gT.createOperatorSubscriber(r,(function(){vT.arrRemove(a,n),n.complete(),s.unsubscribe()}),yT.noop,o)))}),yT.noop)),n.subscribe(gT.createOperatorSubscriber(r,(function(e){var t,n,r=a.slice();try{for(var o=fT(r),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}),(function(){for(;0<a.length;)a.shift().complete();r.complete()}),o,(function(){for(;0<a.length;)a.shift().unsubscribe()})))}))};var bT={};Object.defineProperty(bT,"__esModule",{value:!0}),bT.windowWhen=void 0;var _T=lm,wT=qh,xT=zh,ST=Pg;bT.windowWhen=function(e){return wT.operate((function(t,n){var r,a,o=function(e){r.error(e),n.error(e)};!function t(){var i;null==a||a.unsubscribe(),null==r||r.complete(),r=new _T.Subject,n.next(r.asObservable());try{i=ST.innerFrom(e())}catch(e){return void o(e)}i.subscribe(a=xT.createOperatorSubscriber(n,t,t,o))}(),t.subscribe(xT.createOperatorSubscriber(n,(function(e){return r.next(e)}),(function(){r.complete(),n.complete()}),o,(function(){null==a||a.unsubscribe(),r=null})))}))};var ET={},kT=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},AT=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(ET,"__esModule",{value:!0}),ET.withLatestFrom=void 0;var CT=qh,OT=zh,TT=Pg,NT=kh,RT=yh,IT=Eg;ET.withLatestFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=IT.popResultSelector(e);return CT.operate((function(t,r){for(var a=e.length,o=new Array(a),i=e.map((function(){return!1})),s=!1,l=function(t){TT.innerFrom(e[t]).subscribe(OT.createOperatorSubscriber(r,(function(e){o[t]=e,s||i[t]||(i[t]=!0,(s=i.every(NT.identity))&&(i=null))}),RT.noop))},c=0;c<a;c++)l(c);t.subscribe(OT.createOperatorSubscriber(r,(function(e){if(s){var t=AT([e],kT(o));r.next(n?n.apply(void 0,AT([],kT(t))):t)}})))}))};var PT={};Object.defineProperty(PT,"__esModule",{value:!0}),PT.zipAll=void 0;var FT=cw,MT=fx;PT.zipAll=function(e){return MT.joinAllInternals(FT.zip,e)};var jT={},DT={},LT=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},qT=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(DT,"__esModule",{value:!0}),DT.zip=void 0;var BT=cw,UT=qh;DT.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return UT.operate((function(t,n){BT.zip.apply(void 0,qT([t],LT(e))).subscribe(n)}))};var zT=D&&D.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(a)throw a.error}}return i},GT=D&&D.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};Object.defineProperty(jT,"__esModule",{value:!0}),jT.zipWith=void 0;var HT=DT;jT.zipWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return HT.zip.apply(void 0,GT([],zT(e)))},function(e){var t=D&&D.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=D&&D.__exportStar||function(e,n){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(n,r)||t(n,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),e.interval=e.iif=e.generate=e.fromEventPattern=e.fromEvent=e.from=e.forkJoin=e.empty=e.defer=e.connectable=e.concat=e.combineLatest=e.bindNodeCallback=e.bindCallback=e.UnsubscriptionError=e.TimeoutError=e.SequenceError=e.ObjectUnsubscribedError=e.NotFoundError=e.EmptyError=e.ArgumentOutOfRangeError=e.firstValueFrom=e.lastValueFrom=e.isObservable=e.identity=e.noop=e.pipe=e.NotificationKind=e.Notification=e.Subscriber=e.Subscription=e.Scheduler=e.VirtualAction=e.VirtualTimeScheduler=e.animationFrameScheduler=e.animationFrame=e.queueScheduler=e.queue=e.asyncScheduler=e.async=e.asapScheduler=e.asap=e.AsyncSubject=e.ReplaySubject=e.BehaviorSubject=e.Subject=e.animationFrames=e.observable=e.ConnectableObservable=e.Observable=void 0,e.filter=e.expand=e.exhaustMap=e.exhaustAll=e.exhaust=e.every=e.endWith=e.elementAt=e.distinctUntilKeyChanged=e.distinctUntilChanged=e.distinct=e.dematerialize=e.delayWhen=e.delay=e.defaultIfEmpty=e.debounceTime=e.debounce=e.count=e.connect=e.concatWith=e.concatMapTo=e.concatMap=e.concatAll=e.combineLatestWith=e.combineLatestAll=e.combineAll=e.catchError=e.bufferWhen=e.bufferToggle=e.bufferTime=e.bufferCount=e.buffer=e.auditTime=e.audit=e.config=e.NEVER=e.EMPTY=e.scheduled=e.zip=e.using=e.timer=e.throwError=e.range=e.race=e.partition=e.pairs=e.onErrorResumeNext=e.of=e.never=e.merge=void 0,e.switchMap=e.switchAll=e.subscribeOn=e.startWith=e.skipWhile=e.skipUntil=e.skipLast=e.skip=e.single=e.shareReplay=e.share=e.sequenceEqual=e.scan=e.sampleTime=e.sample=e.refCount=e.retryWhen=e.retry=e.repeatWhen=e.repeat=e.reduce=e.raceWith=e.publishReplay=e.publishLast=e.publishBehavior=e.publish=e.pluck=e.pairwise=e.onErrorResumeNextWith=e.observeOn=e.multicast=e.min=e.mergeWith=e.mergeScan=e.mergeMapTo=e.mergeMap=e.flatMap=e.mergeAll=e.max=e.materialize=e.mapTo=e.map=e.last=e.isEmpty=e.ignoreElements=e.groupBy=e.first=e.findIndex=e.find=e.finalize=void 0,e.zipWith=e.zipAll=e.withLatestFrom=e.windowWhen=e.windowToggle=e.windowTime=e.windowCount=e.window=e.toArray=e.timestamp=e.timeoutWith=e.timeout=e.timeInterval=e.throwIfEmpty=e.throttleTime=e.throttle=e.tap=e.takeWhile=e.takeUntil=e.takeLast=e.take=e.switchScan=e.switchMapTo=void 0;var r=Zp;Object.defineProperty(e,"Observable",{enumerable:!0,get:function(){return r.Observable}});var a=Dh;Object.defineProperty(e,"ConnectableObservable",{enumerable:!0,get:function(){return a.ConnectableObservable}});var o=Sh;Object.defineProperty(e,"observable",{enumerable:!0,get:function(){return o.observable}});var i=em;Object.defineProperty(e,"animationFrames",{enumerable:!0,get:function(){return i.animationFrames}});var s=lm;Object.defineProperty(e,"Subject",{enumerable:!0,get:function(){return s.Subject}});var l=bm;Object.defineProperty(e,"BehaviorSubject",{enumerable:!0,get:function(){return l.BehaviorSubject}});var c=xm;Object.defineProperty(e,"ReplaySubject",{enumerable:!0,get:function(){return c.ReplaySubject}});var u=Cm;Object.defineProperty(e,"AsyncSubject",{enumerable:!0,get:function(){return u.AsyncSubject}});var f=Nm;Object.defineProperty(e,"asap",{enumerable:!0,get:function(){return f.asap}}),Object.defineProperty(e,"asapScheduler",{enumerable:!0,get:function(){return f.asapScheduler}});var d=ng;Object.defineProperty(e,"async",{enumerable:!0,get:function(){return d.async}}),Object.defineProperty(e,"asyncScheduler",{enumerable:!0,get:function(){return d.asyncScheduler}});var p=rg;Object.defineProperty(e,"queue",{enumerable:!0,get:function(){return p.queue}}),Object.defineProperty(e,"queueScheduler",{enumerable:!0,get:function(){return p.queueScheduler}});var h=cg;Object.defineProperty(e,"animationFrame",{enumerable:!0,get:function(){return h.animationFrame}}),Object.defineProperty(e,"animationFrameScheduler",{enumerable:!0,get:function(){return h.animationFrameScheduler}});var m=gg;Object.defineProperty(e,"VirtualTimeScheduler",{enumerable:!0,get:function(){return m.VirtualTimeScheduler}}),Object.defineProperty(e,"VirtualAction",{enumerable:!0,get:function(){return m.VirtualAction}});var g=Km;Object.defineProperty(e,"Scheduler",{enumerable:!0,get:function(){return g.Scheduler}});var y=eh;Object.defineProperty(e,"Subscription",{enumerable:!0,get:function(){return y.Subscription}});var v=Xp;Object.defineProperty(e,"Subscriber",{enumerable:!0,get:function(){return v.Subscriber}});var b=wg;Object.defineProperty(e,"Notification",{enumerable:!0,get:function(){return b.Notification}}),Object.defineProperty(e,"NotificationKind",{enumerable:!0,get:function(){return b.NotificationKind}});var _=Eh;Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return _.pipe}});var w=yh;Object.defineProperty(e,"noop",{enumerable:!0,get:function(){return w.noop}});var x=kh;Object.defineProperty(e,"identity",{enumerable:!0,get:function(){return x.identity}});var S=pv;Object.defineProperty(e,"isObservable",{enumerable:!0,get:function(){return S.isObservable}});var E=gv;Object.defineProperty(e,"lastValueFrom",{enumerable:!0,get:function(){return E.lastValueFrom}});var k=bv;Object.defineProperty(e,"firstValueFrom",{enumerable:!0,get:function(){return k.firstValueFrom}});var A=xv;Object.defineProperty(e,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return A.ArgumentOutOfRangeError}});var C=yv;Object.defineProperty(e,"EmptyError",{enumerable:!0,get:function(){return C.EmptyError}});var O=Sv;Object.defineProperty(e,"NotFoundError",{enumerable:!0,get:function(){return O.NotFoundError}});var T=cm;Object.defineProperty(e,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return T.ObjectUnsubscribedError}});var N=Ev;Object.defineProperty(e,"SequenceError",{enumerable:!0,get:function(){return N.SequenceError}});var R=kv;Object.defineProperty(e,"TimeoutError",{enumerable:!0,get:function(){return R.TimeoutError}});var I=th;Object.defineProperty(e,"UnsubscriptionError",{enumerable:!0,get:function(){return I.UnsubscriptionError}});var P=Cv;Object.defineProperty(e,"bindCallback",{enumerable:!0,get:function(){return P.bindCallback}});var F=Wv;Object.defineProperty(e,"bindNodeCallback",{enumerable:!0,get:function(){return F.bindNodeCallback}});var M=Jv;Object.defineProperty(e,"combineLatest",{enumerable:!0,get:function(){return M.combineLatest}});var j=db;Object.defineProperty(e,"concat",{enumerable:!0,get:function(){return j.concat}});var L=Rb;Object.defineProperty(e,"connectable",{enumerable:!0,get:function(){return L.connectable}});var q=Ib;Object.defineProperty(e,"defer",{enumerable:!0,get:function(){return q.defer}});var B=xg;Object.defineProperty(e,"empty",{enumerable:!0,get:function(){return B.empty}});var U=qb;Object.defineProperty(e,"forkJoin",{enumerable:!0,get:function(){return U.forkJoin}});var z=Ng;Object.defineProperty(e,"from",{enumerable:!0,get:function(){return z.from}});var G=Vb;Object.defineProperty(e,"fromEvent",{enumerable:!0,get:function(){return G.fromEvent}});var H=o_;Object.defineProperty(e,"fromEventPattern",{enumerable:!0,get:function(){return H.fromEventPattern}});var $=c_;Object.defineProperty(e,"generate",{enumerable:!0,get:function(){return $.generate}});var W=m_;Object.defineProperty(e,"iif",{enumerable:!0,get:function(){return W.iif}});var V=y_;Object.defineProperty(e,"interval",{enumerable:!0,get:function(){return V.interval}});var J=k_;Object.defineProperty(e,"merge",{enumerable:!0,get:function(){return J.merge}});var Y=R_;Object.defineProperty(e,"never",{enumerable:!0,get:function(){return Y.never}});var K=Sg;Object.defineProperty(e,"of",{enumerable:!0,get:function(){return K.of}});var Z=I_;Object.defineProperty(e,"onErrorResumeNext",{enumerable:!0,get:function(){return Z.onErrorResumeNext}});var X=B_;Object.defineProperty(e,"pairs",{enumerable:!0,get:function(){return X.pairs}});var Q=z_;Object.defineProperty(e,"partition",{enumerable:!0,get:function(){return Q.partition}});var ee=K_;Object.defineProperty(e,"race",{enumerable:!0,get:function(){return ee.race}});var te=nw;Object.defineProperty(e,"range",{enumerable:!0,get:function(){return te.range}});var ne=uv;Object.defineProperty(e,"throwError",{enumerable:!0,get:function(){return ne.throwError}});var re=v_;Object.defineProperty(e,"timer",{enumerable:!0,get:function(){return re.timer}});var ae=ow;Object.defineProperty(e,"using",{enumerable:!0,get:function(){return ae.using}});var oe=cw;Object.defineProperty(e,"zip",{enumerable:!0,get:function(){return oe.zip}});var ie=Rg;Object.defineProperty(e,"scheduled",{enumerable:!0,get:function(){return ie.scheduled}});var se=xg;Object.defineProperty(e,"EMPTY",{enumerable:!0,get:function(){return se.EMPTY}});var le=R_;Object.defineProperty(e,"NEVER",{enumerable:!0,get:function(){return le.NEVER}}),n(vw,e);var ce=dh;Object.defineProperty(e,"config",{enumerable:!0,get:function(){return ce.config}});var ue=bw;Object.defineProperty(e,"audit",{enumerable:!0,get:function(){return ue.audit}});var fe=Sw;Object.defineProperty(e,"auditTime",{enumerable:!0,get:function(){return fe.auditTime}});var de=Cw;Object.defineProperty(e,"buffer",{enumerable:!0,get:function(){return de.buffer}});var pe=Iw;Object.defineProperty(e,"bufferCount",{enumerable:!0,get:function(){return pe.bufferCount}});var he=Dw;Object.defineProperty(e,"bufferTime",{enumerable:!0,get:function(){return he.bufferTime}});var me=Ww;Object.defineProperty(e,"bufferToggle",{enumerable:!0,get:function(){return me.bufferToggle}});var ge=ex;Object.defineProperty(e,"bufferWhen",{enumerable:!0,get:function(){return ge.bufferWhen}});var ye=ox;Object.defineProperty(e,"catchError",{enumerable:!0,get:function(){return ye.catchError}});var ve=cx;Object.defineProperty(e,"combineAll",{enumerable:!0,get:function(){return ve.combineAll}});var be=ux;Object.defineProperty(e,"combineLatestAll",{enumerable:!0,get:function(){return be.combineLatestAll}});var _e=Ox;Object.defineProperty(e,"combineLatestWith",{enumerable:!0,get:function(){return _e.combineLatestWith}});var we=pb;Object.defineProperty(e,"concatAll",{enumerable:!0,get:function(){return we.concatAll}});var xe=Ux;Object.defineProperty(e,"concatMap",{enumerable:!0,get:function(){return xe.concatMap}});var Se=Hx;Object.defineProperty(e,"concatMapTo",{enumerable:!0,get:function(){return Se.concatMapTo}});var Ee=Vx;Object.defineProperty(e,"concatWith",{enumerable:!0,get:function(){return Ee.concatWith}});var ke=aS;Object.defineProperty(e,"connect",{enumerable:!0,get:function(){return ke.connect}});var Ae=dS;Object.defineProperty(e,"count",{enumerable:!0,get:function(){return Ae.count}});var Ce=hS;Object.defineProperty(e,"debounce",{enumerable:!0,get:function(){return Ce.debounce}});var Oe=bS;Object.defineProperty(e,"debounceTime",{enumerable:!0,get:function(){return Oe.debounceTime}});var Te=SS;Object.defineProperty(e,"defaultIfEmpty",{enumerable:!0,get:function(){return Te.defaultIfEmpty}});var Ne=AS;Object.defineProperty(e,"delay",{enumerable:!0,get:function(){return Ne.delay}});var Re=CS;Object.defineProperty(e,"delayWhen",{enumerable:!0,get:function(){return Re.delayWhen}});var Ie=VS;Object.defineProperty(e,"dematerialize",{enumerable:!0,get:function(){return Ie.dematerialize}});var Pe=ZS;Object.defineProperty(e,"distinct",{enumerable:!0,get:function(){return Pe.distinct}});var Fe=nE;Object.defineProperty(e,"distinctUntilChanged",{enumerable:!0,get:function(){return Fe.distinctUntilChanged}});var Me=sE;Object.defineProperty(e,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return Me.distinctUntilKeyChanged}});var je=cE;Object.defineProperty(e,"elementAt",{enumerable:!0,get:function(){return je.elementAt}});var De=_E;Object.defineProperty(e,"endWith",{enumerable:!0,get:function(){return De.endWith}});var Le=kE;Object.defineProperty(e,"every",{enumerable:!0,get:function(){return Le.every}});var qe=OE;Object.defineProperty(e,"exhaust",{enumerable:!0,get:function(){return qe.exhaust}});var Be=TE;Object.defineProperty(e,"exhaustAll",{enumerable:!0,get:function(){return Be.exhaustAll}});var Ue=NE;Object.defineProperty(e,"exhaustMap",{enumerable:!0,get:function(){return Ue.exhaustMap}});var ze=DE;Object.defineProperty(e,"expand",{enumerable:!0,get:function(){return ze.expand}});var Ge=H_;Object.defineProperty(e,"filter",{enumerable:!0,get:function(){return Ge.filter}});var He=BE;Object.defineProperty(e,"finalize",{enumerable:!0,get:function(){return He.finalize}});var $e=zE;Object.defineProperty(e,"find",{enumerable:!0,get:function(){return $e.find}});var We=WE;Object.defineProperty(e,"findIndex",{enumerable:!0,get:function(){return We.findIndex}});var Ve=YE;Object.defineProperty(e,"first",{enumerable:!0,get:function(){return Ve.first}});var Je=nk;Object.defineProperty(e,"groupBy",{enumerable:!0,get:function(){return Je.groupBy}});var Ye=IS;Object.defineProperty(e,"ignoreElements",{enumerable:!0,get:function(){return Ye.ignoreElements}});var Ke=lk;Object.defineProperty(e,"isEmpty",{enumerable:!0,get:function(){return Ke.isEmpty}});var Ze=fk;Object.defineProperty(e,"last",{enumerable:!0,get:function(){return Ze.last}});var Xe=Nv;Object.defineProperty(e,"map",{enumerable:!0,get:function(){return Xe.map}});var Qe=jS;Object.defineProperty(e,"mapTo",{enumerable:!0,get:function(){return Qe.mapTo}});var et=Sk;Object.defineProperty(e,"materialize",{enumerable:!0,get:function(){return et.materialize}});var tt=Ck;Object.defineProperty(e,"max",{enumerable:!0,get:function(){return tt.max}});var nt=hb;Object.defineProperty(e,"mergeAll",{enumerable:!0,get:function(){return nt.mergeAll}});var rt=Nk;Object.defineProperty(e,"flatMap",{enumerable:!0,get:function(){return rt.flatMap}});var at=mb;Object.defineProperty(e,"mergeMap",{enumerable:!0,get:function(){return at.mergeMap}});var ot=Rk;Object.defineProperty(e,"mergeMapTo",{enumerable:!0,get:function(){return ot.mergeMapTo}});var it=Fk;Object.defineProperty(e,"mergeScan",{enumerable:!0,get:function(){return it.mergeScan}});var st=Dk;Object.defineProperty(e,"mergeWith",{enumerable:!0,get:function(){return st.mergeWith}});var lt=Yk;Object.defineProperty(e,"min",{enumerable:!0,get:function(){return lt.min}});var ct=Xk;Object.defineProperty(e,"multicast",{enumerable:!0,get:function(){return ct.multicast}});var ut=_y;Object.defineProperty(e,"observeOn",{enumerable:!0,get:function(){return ut.observeOn}});var ft=nA;Object.defineProperty(e,"onErrorResumeNextWith",{enumerable:!0,get:function(){return ft.onErrorResumeNextWith}});var dt=lA;Object.defineProperty(e,"pairwise",{enumerable:!0,get:function(){return dt.pairwise}});var pt=fA;Object.defineProperty(e,"pluck",{enumerable:!0,get:function(){return pt.pluck}});var ht=pA;Object.defineProperty(e,"publish",{enumerable:!0,get:function(){return ht.publish}});var mt=yA;Object.defineProperty(e,"publishBehavior",{enumerable:!0,get:function(){return mt.publishBehavior}});var gt=_A;Object.defineProperty(e,"publishLast",{enumerable:!0,get:function(){return gt.publishLast}});var yt=SA;Object.defineProperty(e,"publishReplay",{enumerable:!0,get:function(){return yt.publishReplay}});var vt=CA;Object.defineProperty(e,"raceWith",{enumerable:!0,get:function(){return vt.raceWith}});var bt=px;Object.defineProperty(e,"reduce",{enumerable:!0,get:function(){return bt.reduce}});var _t=PA;Object.defineProperty(e,"repeat",{enumerable:!0,get:function(){return _t.repeat}});var wt=qA;Object.defineProperty(e,"repeatWhen",{enumerable:!0,get:function(){return wt.repeatWhen}});var xt=HA;Object.defineProperty(e,"retry",{enumerable:!0,get:function(){return xt.retry}});var St=KA;Object.defineProperty(e,"retryWhen",{enumerable:!0,get:function(){return St.retryWhen}});var Et=Lh;Object.defineProperty(e,"refCount",{enumerable:!0,get:function(){return Et.refCount}});var kt=tC;Object.defineProperty(e,"sample",{enumerable:!0,get:function(){return kt.sample}});var At=iC;Object.defineProperty(e,"sampleTime",{enumerable:!0,get:function(){return At.sampleTime}});var Ct=uC;Object.defineProperty(e,"scan",{enumerable:!0,get:function(){return Ct.scan}});var Ot=pC;Object.defineProperty(e,"sequenceEqual",{enumerable:!0,get:function(){return Ot.sequenceEqual}});var Tt=yC;Object.defineProperty(e,"share",{enumerable:!0,get:function(){return Tt.share}});var Nt=kC;Object.defineProperty(e,"shareReplay",{enumerable:!0,get:function(){return Nt.shareReplay}});var Rt=OC;Object.defineProperty(e,"single",{enumerable:!0,get:function(){return Rt.single}});var It=FC;Object.defineProperty(e,"skip",{enumerable:!0,get:function(){return It.skip}});var Pt=jC;Object.defineProperty(e,"skipLast",{enumerable:!0,get:function(){return Pt.skipLast}});var Ft=BC;Object.defineProperty(e,"skipUntil",{enumerable:!0,get:function(){return Ft.skipUntil}});var Mt=$C;Object.defineProperty(e,"skipWhile",{enumerable:!0,get:function(){return Mt.skipWhile}});var jt=JC;Object.defineProperty(e,"startWith",{enumerable:!0,get:function(){return jt.startWith}});var Dt=ky;Object.defineProperty(e,"subscribeOn",{enumerable:!0,get:function(){return Dt.subscribeOn}});var Lt=XC;Object.defineProperty(e,"switchAll",{enumerable:!0,get:function(){return Lt.switchAll}});var qt=QC;Object.defineProperty(e,"switchMap",{enumerable:!0,get:function(){return qt.switchMap}});var Bt=oO;Object.defineProperty(e,"switchMapTo",{enumerable:!0,get:function(){return Bt.switchMapTo}});var Ut=lO;Object.defineProperty(e,"switchScan",{enumerable:!0,get:function(){return Ut.switchScan}});var zt=OS;Object.defineProperty(e,"take",{enumerable:!0,get:function(){return zt.take}});var Gt=dk;Object.defineProperty(e,"takeLast",{enumerable:!0,get:function(){return Gt.takeLast}});var Ht=fO;Object.defineProperty(e,"takeUntil",{enumerable:!0,get:function(){return Ht.takeUntil}});var $t=gO;Object.defineProperty(e,"takeWhile",{enumerable:!0,get:function(){return $t.takeWhile}});var Wt=bO;Object.defineProperty(e,"tap",{enumerable:!0,get:function(){return Wt.tap}});var Vt=EO;Object.defineProperty(e,"throttle",{enumerable:!0,get:function(){return Vt.throttle}});var Jt=OO;Object.defineProperty(e,"throttleTime",{enumerable:!0,get:function(){return Jt.throttleTime}});var Yt=uE;Object.defineProperty(e,"throwIfEmpty",{enumerable:!0,get:function(){return Yt.throwIfEmpty}});var Kt=IO;Object.defineProperty(e,"timeInterval",{enumerable:!0,get:function(){return Kt.timeInterval}});var Zt=kv;Object.defineProperty(e,"timeout",{enumerable:!0,get:function(){return Zt.timeout}});var Xt=DO;Object.defineProperty(e,"timeoutWith",{enumerable:!0,get:function(){return Xt.timeoutWith}});var Qt=UO;Object.defineProperty(e,"timestamp",{enumerable:!0,get:function(){return Qt.timestamp}});var en=dx;Object.defineProperty(e,"toArray",{enumerable:!0,get:function(){return en.toArray}});var tn=HO;Object.defineProperty(e,"window",{enumerable:!0,get:function(){return tn.window}});var nn=KO;Object.defineProperty(e,"windowCount",{enumerable:!0,get:function(){return nn.windowCount}});var rn=tT;Object.defineProperty(e,"windowTime",{enumerable:!0,get:function(){return rn.windowTime}});var an=uT;Object.defineProperty(e,"windowToggle",{enumerable:!0,get:function(){return an.windowToggle}});var on=bT;Object.defineProperty(e,"windowWhen",{enumerable:!0,get:function(){return on.windowWhen}});var sn=ET;Object.defineProperty(e,"withLatestFrom",{enumerable:!0,get:function(){return sn.withLatestFrom}});var ln=PT;Object.defineProperty(e,"zipAll",{enumerable:!0,get:function(){return ln.zipAll}});var cn=jT;Object.defineProperty(e,"zipWith",{enumerable:!0,get:function(){return cn.zipWith}})}(Kp),Object.defineProperty(Yp,"__esModule",{value:!0});var $T=Yp.checkAbortSignal=YT;Yp.abortBreakPoint=function(e){return ZT.apply(this,arguments)},Yp.makeAbortError=XT,Yp.observeAbortSignal=function(e){return e?(0,VT.fromEvent)(e,"abort"):new VT.Observable};var WT=Yp.isAbortException=function(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))},VT=Kp,JT=function(e){ne(n,e);var t=ue(n);function n(){return X(this,n),t.apply(this,arguments)}return ee(n)}(se(Error));function YT(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw XT()}}function KT(e){return new Promise((function(t){return setTimeout(t,e)}))}function ZT(){return(ZT=Z(J().mark((function e(t){return J().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,KT(1);case 2:YT(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function XT(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");var e=new JT("aborted");return e.code="ERR_ABORTED",e}var QT={exports:{}};!function(e,t){var n;n=function(){return function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){if(!s&&q)return q(i);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(e){return a(t[i][1][e]||e)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var o=q,i=0;i<r.length;i++)a(r[i]);return a}({"./aesprim":[function(e,t,n){var r;r=function(e){var t,n,r,a,o,i,s,l,c,u,f,d,p,h,m,g,y,v;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function _(e){return e>=48&&e<=57}function w(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function x(e){return"01234567".indexOf(e)>=0}function S(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function E(e){return 10===e||13===e||8232===e||8233===e}function k(e){return 64==e||36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function A(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function C(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function O(e){return"eval"===e||"arguments"===e}function T(e,t,n,r,a){var o;b("number"==typeof n,"Comment must have valid position"),y.lastCommentStart>=n||(y.lastCommentStart=n,o={type:e,value:t},v.range&&(o.range=[n,r]),v.loc&&(o.loc=a),v.comments.push(o),v.attachComment&&(v.leadingComments.push(o),v.trailingComments.push(o)))}function N(e){var t,n,r,a;for(t=f-e,n={start:{line:d,column:f-p-e}};f<h;)if(r=c.charCodeAt(f),++f,E(r))return v.comments&&(a=c.slice(t+e,f-1),n.end={line:d,column:f-p-1},T("Line",a,t,f-1,n)),13===r&&10===c.charCodeAt(f)&&++f,++d,void(p=f);v.comments&&(a=c.slice(t+e,f),n.end={line:d,column:f-p},T("Line",a,t,f,n))}function R(){var e,t,n,r;for(v.comments&&(e=f-2,t={start:{line:d,column:f-p-2}});f<h;)if(E(n=c.charCodeAt(f)))13===n&&10===c.charCodeAt(f+1)&&++f,++d,++f,p=f,f>=h&&W({},i.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(f+1))return++f,++f,void(v.comments&&(r=c.slice(e+2,f-2),t.end={line:d,column:f-p},T("Block",r,e,f,t)));++f}else++f;W({},i.UnexpectedToken,"ILLEGAL")}function I(){var e,t;for(t=0===f;f<h;)if(S(e=c.charCodeAt(f)))++f;else if(E(e))++f,13===e&&10===c.charCodeAt(f)&&++f,++d,p=f,t=!0;else if(47===e)if(47===(e=c.charCodeAt(f+1)))++f,++f,N(2),t=!0;else{if(42!==e)break;++f,++f,R()}else if(t&&45===e){if(45!==c.charCodeAt(f+1)||62!==c.charCodeAt(f+2))break;f+=3,N(3)}else{if(60!==e)break;if("!--"!==c.slice(f+1,f+4))break;++f,++f,++f,++f,N(4)}}function P(e){var t,n,r,a=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(f<h&&w(c[f])))return"";r=c[f++],a=16*a+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(a)}function F(){var e,t;for(e=c.charCodeAt(f++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(f)&&W({},i.UnexpectedToken,"ILLEGAL"),++f,(e=P("u"))&&"\\"!==e&&k(e.charCodeAt(0))||W({},i.UnexpectedToken,"ILLEGAL"),t=e);f<h&&A(e=c.charCodeAt(f));)++f,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(f)&&W({},i.UnexpectedToken,"ILLEGAL"),++f,(e=P("u"))&&"\\"!==e&&A(e.charCodeAt(0))||W({},i.UnexpectedToken,"ILLEGAL"),t+=e);return t}function M(){var e,n,r,a,o=f,s=c.charCodeAt(f),l=c[f];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++f,v.tokenize&&(40===s?v.openParenToken=v.tokens.length:123===s&&(v.openCurlyToken=v.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:d,lineStart:p,start:o,end:f};default:if(61===(e=c.charCodeAt(f+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return f+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:d,lineStart:p,start:o,end:f};case 33:case 61:return 61===c.charCodeAt(f+=2)&&++f,{type:t.Punctuator,value:c.slice(o,f),lineNumber:d,lineStart:p,start:o,end:f}}}return">>>="===(a=c.substr(f,4))?{type:t.Punctuator,value:a,lineNumber:d,lineStart:p,start:o,end:f+=4}:">>>"===(r=a.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:d,lineStart:p,start:o,end:f+=3}:l===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(l)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:d,lineStart:p,start:o,end:f+=2}:"<>=!+-*%&|^/".indexOf(l)>=0?(++f,{type:t.Punctuator,value:l,lineNumber:d,lineStart:p,start:o,end:f}):void W({},i.UnexpectedToken,"ILLEGAL")}function j(){var e,n,r;if(b(_((r=c[f]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=f,e="","."!==r){if(e=c[f++],r=c[f],"0"===e){if("x"===r||"X"===r)return++f,function(e){for(var n="";f<h&&w(c[f]);)n+=c[f++];return 0===n.length&&W({},i.UnexpectedToken,"ILLEGAL"),k(c.charCodeAt(f))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:d,lineStart:p,start:e,end:f}}(n);if(x(r))return function(e){for(var n="0"+c[f++];f<h&&x(c[f]);)n+=c[f++];return(k(c.charCodeAt(f))||_(c.charCodeAt(f)))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:d,lineStart:p,start:e,end:f}}(n);r&&_(r.charCodeAt(0))&&W({},i.UnexpectedToken,"ILLEGAL")}for(;_(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("."===r){for(e+=c[f++];_(c.charCodeAt(f));)e+=c[f++];r=c[f]}if("e"===r||"E"===r)if(e+=c[f++],"+"!==(r=c[f])&&"-"!==r||(e+=c[f++]),_(c.charCodeAt(f)))for(;_(c.charCodeAt(f));)e+=c[f++];else W({},i.UnexpectedToken,"ILLEGAL");return k(c.charCodeAt(f))&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:d,lineStart:p,start:n,end:f}}function D(){var e,n,r,a;return g=null,I(),e=f,n=function(){var e,t,n,r;for(b("/"===(e=c[f]),"Regular expression literal must start with a slash"),t=c[f++],n=!1,r=!1;f<h;)if(t+=e=c[f++],"\\"===e)E((e=c[f++]).charCodeAt(0))&&W({},i.UnterminatedRegExp),t+=e;else if(E(e.charCodeAt(0)))W({},i.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||W({},i.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";f<h&&A((e=c[f]).charCodeAt(0));)if(++f,"\\"===e&&f<h)if("u"===(e=c[f])){if(r=++f,e=P("u"))for(n+=e,t+="\\u";r<f;++r)t+=c[r];else f=r,n+="u",t+="\\u";V({},i.UnexpectedToken,"ILLEGAL")}else t+="\\",V({},i.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),a=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){W({},i.InvalidRegExp)}return n}(n.value,r.value),v.tokenize?{type:t.RegularExpression,value:a,lineNumber:d,lineStart:p,start:e,end:f}:{literal:n.literal+r.literal,value:a,start:e,end:f}}function L(){var e,t,n,r;return I(),e=f,t={start:{line:d,column:f-p}},n=D(),t.end={line:d,column:f-p},v.tokenize||(v.tokens.length>0&&(r=v.tokens[v.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||v.tokens.pop()),v.tokens.push({type:"RegularExpression",value:n.literal,range:[e,f],loc:t})),n}function q(){var e,n,a;return I(),f>=h?{type:t.EOF,lineNumber:d,lineStart:p,start:f,end:f}:k(e=c.charCodeAt(f))?(n=f,a=92===c.charCodeAt(f)?F():function(){var e,t;for(e=f++;f<h;){if(92===(t=c.charCodeAt(f)))return f=e,F();if(!A(t))break;++f}return c.slice(e,f)}(),{type:1===a.length?t.Identifier:function(e){if(u&&C(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(a)?t.Keyword:"null"===a?t.NullLiteral:"true"===a||"false"===a?t.BooleanLiteral:t.Identifier,value:a,lineNumber:d,lineStart:p,start:n,end:f}):40===e||41===e||59===e?M():39===e||34===e?function(){var e,n,r,a,o,s,l,u,m="",g=!1;for(l=d,u=p,b("'"===(e=c[f])||'"'===e,"String literal must starts with a quote"),n=f,++f;f<h;){if((r=c[f++])===e){e="";break}if("\\"===r)if((r=c[f++])&&E(r.charCodeAt(0)))++d,"\r"===r&&"\n"===c[f]&&++f,p=f;else switch(r){case"u":case"x":s=f,(o=P(r))?m+=o:(f=s,m+=r);break;case"n":m+="\n";break;case"r":m+="\r";break;case"t":m+="\t";break;case"b":m+="\b";break;case"f":m+="\f";break;case"v":m+="\v";break;default:x(r)?(0!==(a="01234567".indexOf(r))&&(g=!0),f<h&&x(c[f])&&(g=!0,a=8*a+"01234567".indexOf(c[f++]),"0123".indexOf(r)>=0&&f<h&&x(c[f])&&(a=8*a+"01234567".indexOf(c[f++]))),m+=String.fromCharCode(a)):m+=r}else{if(E(r.charCodeAt(0)))break;m+=r}}return""!==e&&W({},i.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:m,octal:g,startLineNumber:l,startLineStart:u,lineNumber:d,lineStart:p,start:n,end:f}}():46===e?_(c.charCodeAt(f+1))?j():M():_(e)?j():v.tokenize&&47===e?function(){var e,t;if(!(e=v.tokens[v.tokens.length-1]))return L();if("Punctuator"===e.type){if("]"===e.value)return M();if(")"===e.value)return!(t=v.tokens[v.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?M():L();if("}"===e.value){if(v.tokens[v.openCurlyToken-3]&&"Keyword"===v.tokens[v.openCurlyToken-3].type){if(!(t=v.tokens[v.openCurlyToken-4]))return M()}else{if(!v.tokens[v.openCurlyToken-4]||"Keyword"!==v.tokens[v.openCurlyToken-4].type)return M();if(!(t=v.tokens[v.openCurlyToken-5]))return L()}return r.indexOf(t.value)>=0?M():L()}return L()}return"Keyword"===e.type?L():M()}():M()}function B(){var e,r,a;return I(),e={start:{line:d,column:f-p}},r=q(),e.end={line:d,column:f-p},r.type!==t.EOF&&(a=c.slice(r.start,r.end),v.tokens.push({type:n[r.type],value:a,range:[r.start,r.end],loc:e})),r}function U(){var e;return f=(e=g).end,d=e.lineNumber,p=e.lineStart,g=void 0!==v.tokens?B():q(),f=e.end,d=e.lineNumber,p=e.lineStart,e}function z(){var e,t,n;e=f,t=d,n=p,g=void 0!==v.tokens?B():q(),f=e,d=t,p=n}function G(e,t){this.line=e,this.column=t}function H(e,t,n,r){this.start=new G(e,t),this.end=new G(n,r)}function $(){var e,t,n,r;return e=f,t=d,n=p,I(),r=d!==t,f=e,d=t,p=n,r}function W(e,t){var n,r=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+a)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-p+1):((n=new Error("Line "+d+": "+a)).index=f,n.lineNumber=d,n.column=f-p+1),n.description=a,n}function V(){try{W.apply(null,arguments)}catch(e){if(!v.errors)throw e;v.errors.push(e)}}function J(e){if(e.type===t.EOF&&W(e,i.UnexpectedEOS),e.type===t.NumericLiteral&&W(e,i.UnexpectedNumber),e.type===t.StringLiteral&&W(e,i.UnexpectedString),e.type===t.Identifier&&W(e,i.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))W(e,i.UnexpectedReserved);else if(u&&C(e.value))return void V(e,i.StrictReservedWord);W(e,i.UnexpectedToken,e.value)}W(e,i.UnexpectedToken,e.value)}function Y(e){var n=U();n.type===t.Punctuator&&n.value===e||J(n)}function K(e){var n=U();n.type===t.Keyword&&n.value===e||J(n)}function Z(e){return g.type===t.Punctuator&&g.value===e}function X(e){return g.type===t.Keyword&&g.value===e}function Q(){var e;59===c.charCodeAt(f)||Z(";")?U():(e=d,I(),d===e&&(g.type===t.EOF||Z("}")||J(g)))}function ee(e){return e.type===a.Identifier||e.type===a.MemberExpression}function te(e,t){var n,r,a;return n=u,a=g,r=_e(),t&&u&&O(e[0].name)&&V(t,i.StrictParamName),u=n,m.markEnd(m.createFunctionExpression(null,e,[],r),a)}function ne(){var e,n;return n=g,(e=U()).type===t.StringLiteral||e.type===t.NumericLiteral?(u&&e.octal&&V(e,i.StrictOctalLiteral),m.markEnd(m.createLiteral(e),n)):m.markEnd(m.createIdentifier(e.value),n)}function re(){var e,n,r,a,o,s;return s=g,(e=g).type===t.Identifier?(r=ne(),"get"!==e.value||Z(":")?"set"!==e.value||Z(":")?(Y(":"),a=de(),m.markEnd(m.createProperty("init",r,a),s)):(n=ne(),Y("("),(e=g).type!==t.Identifier?(Y(")"),V(e,i.UnexpectedToken,e.value),a=te([])):(o=[me()],Y(")"),a=te(o,e)),m.markEnd(m.createProperty("set",n,a),s)):(n=ne(),Y("("),Y(")"),a=te([]),m.markEnd(m.createProperty("get",n,a),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=ne(),Y(":"),a=de(),m.markEnd(m.createProperty("init",n,a),s)):void J(e)}function ae(){var e,n,r,s;if(Z("("))return function(){var e;return Y("("),e=pe(),Y(")"),e}();if(Z("["))return function(){var e,t=[];for(e=g,Y("[");!Z("]");)Z(",")?(U(),t.push(null)):(t.push(de()),Z("]")||Y(","));return U(),m.markEnd(m.createArrayExpression(t),e)}();if(Z("{"))return function(){var e,t,n,r,s,l=[],c={},f=String;for(s=g,Y("{");!Z("}");)t=(e=re()).key.type===a.Identifier?e.key.name:f(e.key.value),r="init"===e.kind?o.Data:"get"===e.kind?o.Get:o.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===o.Data?u&&r===o.Data?V({},i.StrictDuplicateProperty):r!==o.Data&&V({},i.AccessorDataProperty):r===o.Data?V({},i.AccessorDataProperty):c[n]&r&&V({},i.AccessorGetSet),c[n]|=r):c[n]=r,l.push(e),Z("}")||Y(",");return Y("}"),m.markEnd(m.createObjectExpression(l),s)}();if(s=g,(e=g.type)===t.Identifier)r=m.createIdentifier(U().value);else if(e===t.StringLiteral||e===t.NumericLiteral)u&&g.octal&&V(g,i.StrictOctalLiteral),r=m.createLiteral(U());else if(e===t.Keyword){if(X("function"))return function(){var e,t,n,r,a,o,s,l,c,f=null;return l=g,K("function"),Z("(")||(e=g,f=me(),u?O(e.value)&&V(e,i.StrictFunctionName):O(e.value)?(n=e,r=i.StrictFunctionName):C(e.value)&&(n=e,r=i.StrictReservedWord)),c=(a=we(n)).params,t=a.stricted,n=a.firstRestricted,a.message&&(r=a.message),s=u,o=_e(),u&&n&&W(n,r),u&&t&&V(t,r),u=s,m.markEnd(m.createFunctionExpression(f,c,[],o),l)}();X("this")?(U(),r=m.createThisExpression()):J(U())}else e===t.BooleanLiteral?((n=U()).value="true"===n.value,r=m.createLiteral(n)):e===t.NullLiteral?((n=U()).value=null,r=m.createLiteral(n)):Z("/")||Z("/=")?(r=m.createLiteral(void 0!==v.tokens?L():D()),z()):J(U());return m.markEnd(r,s)}function oe(){var e=[];if(Y("("),!Z(")"))for(;f<h&&(e.push(de()),!Z(")"));)Y(",");return Y(")"),e}function ie(){return Y("."),function(){var e,n;return n=g,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=U())||J(e),m.markEnd(m.createIdentifier(e.value),n)}()}function se(){var e;return Y("["),e=pe(),Y("]"),e}function le(){var e,t,n;return n=g,K("new"),e=function(){var e,t,n,r;for(r=g,e=y.allowIn,t=X("new")?le():ae(),y.allowIn=e;Z(".")||Z("[");)Z("[")?(n=se(),t=m.createMemberExpression("[",t,n)):(n=ie(),t=m.createMemberExpression(".",t,n)),m.markEnd(t,r);return t}(),t=Z("(")?oe():[],m.markEnd(m.createNewExpression(e,t),n)}function ce(){var e,n,r=g;return e=function(){var e,t,n,r,a;for(a=g,e=y.allowIn,y.allowIn=!0,t=X("new")?le():ae(),y.allowIn=e;;){if(Z("."))r=ie(),t=m.createMemberExpression(".",t,r);else if(Z("("))n=oe(),t=m.createCallExpression(t,n);else{if(!Z("["))break;r=se(),t=m.createMemberExpression("[",t,r)}m.markEnd(t,a)}return t}(),g.type===t.Punctuator&&(!Z("++")&&!Z("--")||$()||(u&&e.type===a.Identifier&&O(e.name)&&V({},i.StrictLHSPostfix),ee(e)||V({},i.InvalidLHSInAssignment),n=U(),e=m.markEnd(m.createPostfixExpression(n.value,e),r))),e}function ue(){var e,n,r;return g.type!==t.Punctuator&&g.type!==t.Keyword?n=ce():Z("++")||Z("--")?(r=g,e=U(),n=ue(),u&&n.type===a.Identifier&&O(n.name)&&V({},i.StrictLHSPrefix),ee(n)||V({},i.InvalidLHSInAssignment),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):Z("+")||Z("-")||Z("~")||Z("!")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):X("delete")||X("void")||X("typeof")?(r=g,e=U(),n=ue(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r),u&&"delete"===n.operator&&n.argument.type===a.Identifier&&V({},i.StrictDelete)):n=ce(),n}function fe(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function de(){var e,n,r,o,s,l;return e=g,s=g,o=n=function(){var e,t,n,r,a;return a=g,e=function(){var e,t,n,r,a,o,i,s,l,c;if(e=g,l=ue(),0===(a=fe(r=g,y.allowIn)))return l;for(r.prec=a,U(),t=[e,g],o=[l,r,i=ue()];(a=fe(g,y.allowIn))>0;){for(;o.length>2&&a<=o[o.length-2].prec;)i=o.pop(),s=o.pop().value,l=o.pop(),n=m.createBinaryExpression(s,l,i),t.pop(),m.markEnd(n,e=t[t.length-1]),o.push(n);(r=U()).prec=a,o.push(r),t.push(g),n=ue(),o.push(n)}for(n=o[c=o.length-1],t.pop();c>1;)n=m.createBinaryExpression(o[c-1].value,o[c-2],n),c-=2,e=t.pop(),m.markEnd(n,e);return n}(),Z("?")&&(U(),t=y.allowIn,y.allowIn=!0,n=de(),y.allowIn=t,Y(":"),r=de(),e=m.createConditionalExpression(e,n,r),m.markEnd(e,a)),e}(),g.type!==t.Punctuator||"="!==(l=g.value)&&"*="!==l&&"/="!==l&&"%="!==l&&"+="!==l&&"-="!==l&&"<<="!==l&&">>="!==l&&">>>="!==l&&"&="!==l&&"^="!==l&&"|="!==l||(ee(n)||V({},i.InvalidLHSInAssignment),u&&n.type===a.Identifier&&O(n.name)&&V(e,i.StrictLHSAssignment),e=U(),r=de(),o=m.markEnd(m.createAssignmentExpression(e.value,n,r),s)),o}function pe(){var e,t=g;if(e=de(),Z(",")){for(e=m.createSequenceExpression([e]);f<h&&Z(",");)U(),e.expressions.push(de());m.markEnd(e,t)}return e}function he(){var e,t;return t=g,Y("{"),e=function(){for(var e,t=[];f<h&&!Z("}")&&void 0!==(e=Se());)t.push(e);return t}(),Y("}"),m.markEnd(m.createBlockStatement(e),t)}function me(){var e,n;return n=g,(e=U()).type!==t.Identifier&&J(e),m.markEnd(m.createIdentifier(e.value),n)}function ge(e){var t,n,r=null;return n=g,t=me(),u&&O(t.name)&&V({},i.StrictVarName),"const"===e?(Y("="),r=de()):Z("=")&&(U(),r=de()),m.markEnd(m.createVariableDeclarator(t,r),n)}function ye(e){var t=[];do{if(t.push(ge(e)),!Z(","))break;U()}while(f<h);return t}function ve(){var e,t,n,r=[];for(n=g,X("default")?(U(),e=null):(K("case"),e=pe()),Y(":");f<h&&!(Z("}")||X("default")||X("case"));)t=be(),r.push(t);return m.markEnd(m.createSwitchCase(e,r),n)}function be(){var e,n,r,o,s,l,d,p,v,b,_=g.type;if(_===t.EOF&&J(g),_===t.Punctuator&&"{"===g.value)return he();if(o=g,_===t.Punctuator)switch(g.value){case";":return m.markEnd((Y(";"),m.createEmptyStatement()),o);case"(":return m.markEnd(function(){var e=pe();return Q(),m.createExpressionStatement(e)}(),o)}if(_===t.Keyword)switch(g.value){case"break":return m.markEnd((b=null,K("break"),59===c.charCodeAt(f)?(U(),y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(null)):$()?(y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(null)):(g.type===t.Identifier&&(b=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+b.name)||W({},i.UnknownLabel,b.name)),Q(),null!==b||y.inIteration||y.inSwitch||W({},i.IllegalBreak),m.createBreakStatement(b))),o);case"continue":return m.markEnd(function(){var e=null;return K("continue"),59===c.charCodeAt(f)?(U(),y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(null)):$()?(y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(null)):(g.type===t.Identifier&&(e=me(),Object.prototype.hasOwnProperty.call(y.labelSet,"$"+e.name)||W({},i.UnknownLabel,e.name)),Q(),null!==e||y.inIteration||W({},i.IllegalContinue),m.createContinueStatement(e))}(),o);case"debugger":return m.markEnd((K("debugger"),Q(),m.createDebuggerStatement()),o);case"do":return m.markEnd((K("do"),v=y.inIteration,y.inIteration=!0,d=be(),y.inIteration=v,K("while"),Y("("),p=pe(),Y(")"),Z(";")&&U(),m.createDoWhileStatement(d,p)),o);case"for":return m.markEnd(function(){var e,t,n,r,a,o,s;return e=t=n=null,K("for"),Y("("),Z(";")?U():(X("var")||X("let")?(y.allowIn=!1,e=function(){var e,t,n;return n=g,e=U(),t=ye(),m.markEnd(m.createVariableDeclaration(t,e.value),n)}(),y.allowIn=!0,1===e.declarations.length&&X("in")&&(U(),r=e,a=pe(),e=null)):(y.allowIn=!1,e=pe(),y.allowIn=!0,X("in")&&(ee(e)||V({},i.InvalidLHSInForIn),U(),r=e,a=pe(),e=null)),void 0===r&&Y(";")),void 0===r&&(Z(";")||(t=pe()),Y(";"),Z(")")||(n=pe())),Y(")"),s=y.inIteration,y.inIteration=!0,o=be(),y.inIteration=s,void 0===r?m.createForStatement(e,t,n,o):m.createForInStatement(r,a,o)}(),o);case"function":return m.markEnd(xe(),o);case"if":return m.markEnd(function(){var e,t,n;return K("if"),Y("("),e=pe(),Y(")"),t=be(),X("else")?(U(),n=be()):n=null,m.createIfStatement(e,t,n)}(),o);case"return":return m.markEnd((l=null,K("return"),y.inFunctionBody||V({},i.IllegalReturn),32===c.charCodeAt(f)&&k(c.charCodeAt(f+1))?(l=pe(),Q(),m.createReturnStatement(l)):$()?m.createReturnStatement(null):(Z(";")||Z("}")||g.type===t.EOF||(l=pe()),Q(),m.createReturnStatement(l))),o);case"switch":return m.markEnd(function(){var e,t,n,r,a;if(K("switch"),Y("("),e=pe(),Y(")"),Y("{"),t=[],Z("}"))return U(),m.createSwitchStatement(e,t);for(r=y.inSwitch,y.inSwitch=!0,a=!1;f<h&&!Z("}");)null===(n=ve()).test&&(a&&W({},i.MultipleDefaultsInSwitch),a=!0),t.push(n);return y.inSwitch=r,Y("}"),m.createSwitchStatement(e,t)}(),o);case"throw":return m.markEnd(function(){var e;return K("throw"),$()&&W({},i.NewlineAfterThrow),e=pe(),Q(),m.createThrowStatement(e)}(),o);case"try":return m.markEnd(function(){var e,t,n,r,a=[],o=null;return K("try"),e=he(),X("catch")&&a.push((r=g,K("catch"),Y("("),Z(")")&&J(g),t=me(),u&&O(t.name)&&V({},i.StrictCatchVariable),Y(")"),n=he(),m.markEnd(m.createCatchClause(t,n),r))),X("finally")&&(U(),o=he()),0!==a.length||o||W({},i.NoCatchOrFinally),m.createTryStatement(e,[],a,o)}(),o);case"var":return m.markEnd((K("var"),s=ye(),Q(),m.createVariableDeclaration(s,"var")),o);case"while":return m.markEnd(function(){var e,t,n;return K("while"),Y("("),e=pe(),Y(")"),n=y.inIteration,y.inIteration=!0,t=be(),y.inIteration=n,m.createWhileStatement(e,t)}(),o);case"with":return m.markEnd(function(){var e,t;return u&&(I(),V({},i.StrictModeWith)),K("with"),Y("("),e=pe(),Y(")"),t=be(),m.createWithStatement(e,t)}(),o)}return(e=pe()).type===a.Identifier&&Z(":")?(U(),r="$"+e.name,Object.prototype.hasOwnProperty.call(y.labelSet,r)&&W({},i.Redeclaration,"Label",e.name),y.labelSet[r]=!0,n=be(),delete y.labelSet[r],m.markEnd(m.createLabeledStatement(e,n),o)):(Q(),m.markEnd(m.createExpressionStatement(e),o))}function _e(){var e,n,r,o,s,l,d,p,v=[];for(p=g,Y("{");f<h&&g.type===t.StringLiteral&&(n=g,e=Se(),v.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&V(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(o=y.labelSet,s=y.inIteration,l=y.inSwitch,d=y.inFunctionBody,y.labelSet={},y.inIteration=!1,y.inSwitch=!1,y.inFunctionBody=!0;f<h&&!Z("}")&&void 0!==(e=Se());)v.push(e);return Y("}"),y.labelSet=o,y.inIteration=s,y.inSwitch=l,y.inFunctionBody=d,m.markEnd(m.createBlockStatement(v),p)}function we(e){var t,n,r,a,o,s,l=[];if(Y("("),!Z(")"))for(a={};f<h&&(n=g,t=me(),o="$"+n.value,u?(O(n.value)&&(r=n,s=i.StrictParamName),Object.prototype.hasOwnProperty.call(a,o)&&(r=n,s=i.StrictParamDupe)):e||(O(n.value)?(e=n,s=i.StrictParamName):C(n.value)?(e=n,s=i.StrictReservedWord):Object.prototype.hasOwnProperty.call(a,o)&&(e=n,s=i.StrictParamDupe)),l.push(t),a[o]=!0,!Z(")"));)Y(",");return Y(")"),{params:l,stricted:r,firstRestricted:e,message:s}}function xe(){var e,t,n,r,a,o,s,l,c,f;return f=g,K("function"),r=g,e=me(),u?O(r.value)&&V(r,i.StrictFunctionName):O(r.value)?(s=r,l=i.StrictFunctionName):C(r.value)&&(s=r,l=i.StrictReservedWord),t=(o=we(s)).params,a=o.stricted,s=o.firstRestricted,o.message&&(l=o.message),c=u,n=_e(),u&&s&&W(s,l),u&&a&&V(a,l),u=c,m.markEnd(m.createFunctionDeclaration(e,t,[],n),f)}function Se(){if(g.type===t.Keyword)switch(g.value){case"const":case"let":return r=g,K(e=g.value),n=ye(e),Q(),m.markEnd(m.createVariableDeclaration(n,e),r);case"function":return xe();default:return be()}var e,n,r;if(g.type!==t.EOF)return be()}function Ee(){var e,t,n,r=[];for(e=0;e<v.tokens.length;++e)n={type:(t=v.tokens[e]).type,value:t.value},v.range&&(n.range=t.range),v.loc&&(n.loc=t.loc),r.push(n);v.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],a={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},o={Data:1,Get:2,Set:4},i={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},l={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===a.Program&&e.body.length>0)){for(v.trailingComments.length>0?v.trailingComments[0].range[0]>=e.range[1]?(n=v.trailingComments,v.trailingComments=[]):v.trailingComments.length=0:v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments&&v.bottomRightStack[v.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=v.bottomRightStack[v.bottomRightStack.length-1].trailingComments,delete v.bottomRightStack[v.bottomRightStack.length-1].trailingComments);v.bottomRightStack.length>0&&v.bottomRightStack[v.bottomRightStack.length-1].range[0]>=e.range[0];)t=v.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):v.leadingComments.length>0&&v.leadingComments[v.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=v.leadingComments,v.leadingComments=[]),n&&(e.trailingComments=n),v.bottomRightStack.push(e)}},markEnd:function(e,t){return v.range&&(e.range=[t.start,f]),v.loc&&(e.loc=new H(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),d,f-p),this.postProcess(e)),v.attachComment&&this.processComment(e),e},postProcess:function(e){return v.source&&(e.loc.source=v.source),e},createArrayExpression:function(e){return{type:a.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:a.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?a.LogicalExpression:a.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:a.BlockStatement,body:e}},createBreakStatement:function(e){return{type:a.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:a.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:a.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:a.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:a.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:a.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:a.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:a.EmptyStatement}},createExpressionStatement:function(e){return{type:a.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:a.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:a.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:a.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:a.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:a.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:a.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:a.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:a.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:a.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:a.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:a.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:a.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:a.Program,body:e}},createProperty:function(e,t,n){return{type:a.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:a.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:a.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:a.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:a.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:a.ThisExpression}},createThrowStatement:function(e){return{type:a.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:a.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:a.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:a.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:a.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:a.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:a.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:a.WithStatement,object:e,body:t}}},e.version="1.2.2",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),m=l,f=0,d=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},(n=n||{}).tokens=!0,v.tokens=[],v.tokenize=!0,v.openParenToken=-1,v.openCurlyToken=-1,v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]);try{if(z(),g.type===t.EOF)return v.tokens;for(U();g.type!==t.EOF;)try{U()}catch(e){if(v.errors){v.errors.push(e);break}throw e}Ee(),r=v.tokens,void 0!==v.comments&&(r.comments=v.comments),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.parse=function(e,n){var r,o,s,b;o=String,"string"==typeof e||e instanceof String||(e=o(e)),m=l,f=0,d=(c=e).length>0?1:0,p=0,h=c.length,g=null,y={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},v={},void 0!==n&&(v.range="boolean"==typeof n.range&&n.range,v.loc="boolean"==typeof n.loc&&n.loc,v.attachComment="boolean"==typeof n.attachComment&&n.attachComment,v.loc&&null!=n.source&&(v.source=o(n.source)),"boolean"==typeof n.tokens&&n.tokens&&(v.tokens=[]),"boolean"==typeof n.comment&&n.comment&&(v.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(v.errors=[]),v.attachComment&&(v.range=!0,v.comments=[],v.bottomRightStack=[],v.trailingComments=[],v.leadingComments=[]));try{I(),z(),b=g,u=!1,s=function(){for(var e,n,r,o=[];f<h&&(n=g).type===t.StringLiteral&&(e=Se(),o.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(u=!0,r&&V(r,i.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;f<h&&void 0!==(e=Se());)o.push(e);return o}(),r=m.markEnd(m.createProgram(s),b),void 0!==v.comments&&(r.comments=v.comments),void 0!==v.tokens&&(Ee(),r.tokens=v.tokens),void 0!==v.errors&&(r.errors=v.errors)}catch(e){throw e}finally{v={}}return r},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),a)a.hasOwnProperty(e)&&(t[e]=a[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()},r(void 0!==n?n:this.esprima={})},{}],1:[function(e,t,n){(function(r){var a=function(){var e={trace:function(){},yy:{},symbols_:{error:2,JSON_PATH:3,DOLLAR:4,PATH_COMPONENTS:5,LEADING_CHILD_MEMBER_EXPRESSION:6,PATH_COMPONENT:7,MEMBER_COMPONENT:8,SUBSCRIPT_COMPONENT:9,CHILD_MEMBER_COMPONENT:10,DESCENDANT_MEMBER_COMPONENT:11,DOT:12,MEMBER_EXPRESSION:13,DOT_DOT:14,STAR:15,IDENTIFIER:16,SCRIPT_EXPRESSION:17,INTEGER:18,END:19,CHILD_SUBSCRIPT_COMPONENT:20,DESCENDANT_SUBSCRIPT_COMPONENT:21,"[":22,SUBSCRIPT:23,"]":24,SUBSCRIPT_EXPRESSION:25,SUBSCRIPT_EXPRESSION_LIST:26,SUBSCRIPT_EXPRESSION_LISTABLE:27,",":28,STRING_LITERAL:29,ARRAY_SLICE:30,FILTER_EXPRESSION:31,QQ_STRING:32,Q_STRING:33,$accept:0,$end:1},terminals_:{2:"error",4:"DOLLAR",12:"DOT",14:"DOT_DOT",15:"STAR",16:"IDENTIFIER",17:"SCRIPT_EXPRESSION",18:"INTEGER",19:"END",22:"[",24:"]",28:",",30:"ARRAY_SLICE",31:"FILTER_EXPRESSION",32:"QQ_STRING",33:"Q_STRING"},productions_:[0,[3,1],[3,2],[3,1],[3,2],[5,1],[5,2],[7,1],[7,1],[8,1],[8,1],[10,2],[6,1],[11,2],[13,1],[13,1],[13,1],[13,1],[13,1],[9,1],[9,1],[20,3],[21,4],[23,1],[23,1],[26,1],[26,3],[27,1],[27,1],[27,1],[25,1],[25,1],[25,1],[29,1],[29,1]],performAction:function(e,n,r,a,o,i,s){a.ast||(a.ast=t,t.initialize());var l=i.length-1;switch(o){case 1:return a.ast.set({expression:{type:"root",value:i[l]}}),a.ast.unshift(),a.ast.yield();case 2:return a.ast.set({expression:{type:"root",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 3:return a.ast.unshift(),a.ast.yield();case 4:return a.ast.set({operation:"member",scope:"child",expression:{type:"identifier",value:i[l-1]}}),a.ast.unshift(),a.ast.yield();case 5:case 6:case 11:case 13:case 18:case 21:case 22:case 23:break;case 7:a.ast.set({operation:"member"}),a.ast.push();break;case 8:a.ast.set({operation:"subscript"}),a.ast.push();break;case 9:case 19:a.ast.set({scope:"child"});break;case 10:case 20:a.ast.set({scope:"descendant"});break;case 12:a.ast.set({scope:"child",operation:"member"});break;case 14:a.ast.set({expression:{type:"wildcard",value:i[l]}});break;case 15:a.ast.set({expression:{type:"identifier",value:i[l]}});break;case 16:a.ast.set({expression:{type:"script_expression",value:i[l]}});break;case 17:a.ast.set({expression:{type:"numeric_literal",value:parseInt(i[l])}});break;case 24:i[l].length>1?a.ast.set({expression:{type:"union",value:i[l]}}):this.$=i[l];break;case 25:this.$=[i[l]];break;case 26:this.$=i[l-2].concat(i[l]);break;case 27:this.$={expression:{type:"numeric_literal",value:parseInt(i[l])}},a.ast.set(this.$);break;case 28:this.$={expression:{type:"string_literal",value:i[l]}},a.ast.set(this.$);break;case 29:this.$={expression:{type:"slice",value:i[l]}},a.ast.set(this.$);break;case 30:this.$={expression:{type:"wildcard",value:i[l]}},a.ast.set(this.$);break;case 31:this.$={expression:{type:"script_expression",value:i[l]}},a.ast.set(this.$);break;case 32:this.$={expression:{type:"filter_expression",value:i[l]}},a.ast.set(this.$);break;case 33:case 34:this.$=i[l]}},table:[{3:1,4:[1,2],6:3,13:4,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{1:[3]},{1:[2,1],5:10,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,3],5:21,7:11,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,12],12:[2,12],14:[2,12],22:[2,12]},{1:[2,14],12:[2,14],14:[2,14],22:[2,14]},{1:[2,15],12:[2,15],14:[2,15],22:[2,15]},{1:[2,16],12:[2,16],14:[2,16],22:[2,16]},{1:[2,17],12:[2,17],14:[2,17],22:[2,17]},{1:[2,18],12:[2,18],14:[2,18],22:[2,18]},{1:[2,2],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,5],12:[2,5],14:[2,5],22:[2,5]},{1:[2,7],12:[2,7],14:[2,7],22:[2,7]},{1:[2,8],12:[2,8],14:[2,8],22:[2,8]},{1:[2,9],12:[2,9],14:[2,9],22:[2,9]},{1:[2,10],12:[2,10],14:[2,10],22:[2,10]},{1:[2,19],12:[2,19],14:[2,19],22:[2,19]},{1:[2,20],12:[2,20],14:[2,20],22:[2,20]},{13:23,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9]},{13:24,15:[1,5],16:[1,6],17:[1,7],18:[1,8],19:[1,9],22:[1,25]},{15:[1,29],17:[1,30],18:[1,33],23:26,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{1:[2,4],7:22,8:12,9:13,10:14,11:15,12:[1,18],14:[1,19],20:16,21:17,22:[1,20]},{1:[2,6],12:[2,6],14:[2,6],22:[2,6]},{1:[2,11],12:[2,11],14:[2,11],22:[2,11]},{1:[2,13],12:[2,13],14:[2,13],22:[2,13]},{15:[1,29],17:[1,30],18:[1,33],23:38,25:27,26:28,27:32,29:34,30:[1,35],31:[1,31],32:[1,36],33:[1,37]},{24:[1,39]},{24:[2,23]},{24:[2,24],28:[1,40]},{24:[2,30]},{24:[2,31]},{24:[2,32]},{24:[2,25],28:[2,25]},{24:[2,27],28:[2,27]},{24:[2,28],28:[2,28]},{24:[2,29],28:[2,29]},{24:[2,33],28:[2,33]},{24:[2,34],28:[2,34]},{24:[1,41]},{1:[2,21],12:[2,21],14:[2,21],22:[2,21]},{18:[1,33],27:42,29:34,30:[1,35],32:[1,36],33:[1,37]},{1:[2,22],12:[2,22],14:[2,22],22:[2,22]},{24:[2,26],28:[2,26]}],defaultActions:{27:[2,23],29:[2,30],30:[2,31],31:[2,32]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,n=[0],r=[null],a=[],o=this.table,i="",s=0,l=0,c=a.slice.call(arguments,1);this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;a.push(u);var f=this.lexer.options&&this.lexer.options.ranges;function d(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}this.parseError="function"==typeof this.yy.parseError?this.yy.parseError:Object.getPrototypeOf(this).parseError;for(var p,h,m,g,y,v,b,_={};;){if(this.defaultActions[h=n[n.length-1]]?m=this.defaultActions[h]:(null==p&&(p=d()),m=o[h]&&o[h][p]),void 0===m||!m.length||!m[0]){var w;for(y in b=[],o[h])this.terminals_[y]&&y>2&&b.push("'"+this.terminals_[y]+"'");w=this.lexer.showPosition?"Parse error on line "+(s+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(s+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:b})}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+p);switch(m[0]){case 1:n.push(p),r.push(this.lexer.yytext),a.push(this.lexer.yylloc),n.push(m[1]),p=null,l=this.lexer.yyleng,i=this.lexer.yytext,s=this.lexer.yylineno,u=this.lexer.yylloc;break;case 2:if(_.$=r[r.length-(v=this.productions_[m[1]][1])],_._$={first_line:a[a.length-(v||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(v||1)].first_column,last_column:a[a.length-1].last_column},f&&(_._$.range=[a[a.length-(v||1)].range[0],a[a.length-1].range[1]]),void 0!==(g=this.performAction.apply(_,[i,l,s,this.yy,m[1],r,a].concat(c))))return g;v&&(n=n.slice(0,-1*v*2),r=r.slice(0,-1*v),a=a.slice(0,-1*v)),n.push(this.productions_[m[1]][0]),r.push(_.$),a.push(_._$),n.push(o[n[n.length-2]][n[n.length-1]]);break;case 3:return!0}}return!0}},t={initialize:function(){this._nodes=[],this._node={},this._stash=[]},set:function(e){for(var t in e)this._node[t]=e[t];return this._node},node:function(e){return arguments.length&&(this._node=e),this._node},push:function(){this._nodes.push(this._node),this._node={}},unshift:function(){this._nodes.unshift(this._node),this._node={}},yield:function(){var e=this._nodes;return this.initialize(),e}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var o in a)this[o]=a[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),o=0;o<a.length;o++)if((n=this._input.match(this.rules[a[o]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,a[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,r){switch(n){case 0:return 4;case 1:return 14;case 2:return 12;case 3:return 15;case 4:return 16;case 5:return 22;case 6:return 24;case 7:return 28;case 8:return 30;case 9:return 18;case 10:return t.yytext=t.yytext.substr(1,t.yyleng-2),32;case 11:return t.yytext=t.yytext.substr(1,t.yyleng-2),33;case 12:return 17;case 13:return 31}},rules:[/^(?:\$)/,/^(?:\.\.)/,/^(?:\.)/,/^(?:\*)/,/^(?:[a-zA-Z_]+[a-zA-Z0-9_]*)/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?:((-?(?:0|[1-9][0-9]*)))?\:((-?(?:0|[1-9][0-9]*)))?(\:((-?(?:0|[1-9][0-9]*)))?)?)/,/^(?:(-?(?:0|[1-9][0-9]*)))/,/^(?:"(?:\\["bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^"\\])*")/,/^(?:'(?:\\['bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^'\\])*')/,/^(?:\(.+?\)(?=\]))/,/^(?:\?\(.+?\)(?=\]))/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return e}();function r(){this.yy={}}return e.lexer=n,r.prototype=e,e.Parser=r,new r}();void 0!==e&&void 0!==n&&(n.parser=a,n.Parser=a.Parser,n.parse=function(){return a.parse.apply(a,arguments)},n.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),r.exit(1));var a=e("fs").readFileSync(e("path").normalize(t[1]),"utf8");return n.parser.parse(a)},void 0!==t&&e.main===t&&n.main(r.argv.slice(1)))}).call(this,e("_process"))},{_process:14,fs:12,path:13}],2:[function(e,t,n){t.exports={identifier:"[a-zA-Z_]+[a-zA-Z0-9_]*",integer:"-?(?:0|[1-9][0-9]*)",qq_string:'"(?:\\\\["bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^"\\\\])*"',q_string:"'(?:\\\\['bfnrt/\\\\]|\\\\u[a-fA-F0-9]{4}|[^'\\\\])*'"}},{}],3:[function(e,t,n){var r=e("./dict"),a=e("fs"),o={lex:{macros:{esc:"\\\\",int:r.integer},rules:[["\\$","return 'DOLLAR'"],["\\.\\.","return 'DOT_DOT'"],["\\.","return 'DOT'"],["\\*","return 'STAR'"],[r.identifier,"return 'IDENTIFIER'"],["\\[","return '['"],["\\]","return ']'"],[",","return ','"],["({int})?\\:({int})?(\\:({int})?)?","return 'ARRAY_SLICE'"],["{int}","return 'INTEGER'"],[r.qq_string,"yytext = yytext.substr(1,yyleng-2); return 'QQ_STRING';"],[r.q_string,"yytext = yytext.substr(1,yyleng-2); return 'Q_STRING';"],["\\(.+?\\)(?=\\])","return 'SCRIPT_EXPRESSION'"],["\\?\\(.+?\\)(?=\\])","return 'FILTER_EXPRESSION'"]]},start:"JSON_PATH",bnf:{JSON_PATH:[["DOLLAR",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["DOLLAR PATH_COMPONENTS",'yy.ast.set({ expression: { type: "root", value: $1 } }); yy.ast.unshift(); return yy.ast.yield()'],["LEADING_CHILD_MEMBER_EXPRESSION","yy.ast.unshift(); return yy.ast.yield()"],["LEADING_CHILD_MEMBER_EXPRESSION PATH_COMPONENTS",'yy.ast.set({ operation: "member", scope: "child", expression: { type: "identifier", value: $1 }}); yy.ast.unshift(); return yy.ast.yield()']],PATH_COMPONENTS:[["PATH_COMPONENT",""],["PATH_COMPONENTS PATH_COMPONENT",""]],PATH_COMPONENT:[["MEMBER_COMPONENT",'yy.ast.set({ operation: "member" }); yy.ast.push()'],["SUBSCRIPT_COMPONENT",'yy.ast.set({ operation: "subscript" }); yy.ast.push() ']],MEMBER_COMPONENT:[["CHILD_MEMBER_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_MEMBER_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_MEMBER_COMPONENT:[["DOT MEMBER_EXPRESSION",""]],LEADING_CHILD_MEMBER_EXPRESSION:[["MEMBER_EXPRESSION",'yy.ast.set({ scope: "child", operation: "member" })']],DESCENDANT_MEMBER_COMPONENT:[["DOT_DOT MEMBER_EXPRESSION",""]],MEMBER_EXPRESSION:[["STAR",'yy.ast.set({ expression: { type: "wildcard", value: $1 } })'],["IDENTIFIER",'yy.ast.set({ expression: { type: "identifier", value: $1 } })'],["SCRIPT_EXPRESSION",'yy.ast.set({ expression: { type: "script_expression", value: $1 } })'],["INTEGER",'yy.ast.set({ expression: { type: "numeric_literal", value: parseInt($1) } })'],["END",""]],SUBSCRIPT_COMPONENT:[["CHILD_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "child" })'],["DESCENDANT_SUBSCRIPT_COMPONENT",'yy.ast.set({ scope: "descendant" })']],CHILD_SUBSCRIPT_COMPONENT:[["[ SUBSCRIPT ]",""]],DESCENDANT_SUBSCRIPT_COMPONENT:[["DOT_DOT [ SUBSCRIPT ]",""]],SUBSCRIPT:[["SUBSCRIPT_EXPRESSION",""],["SUBSCRIPT_EXPRESSION_LIST",'$1.length > 1? yy.ast.set({ expression: { type: "union", value: $1 } }) : $$ = $1']],SUBSCRIPT_EXPRESSION_LIST:[["SUBSCRIPT_EXPRESSION_LISTABLE","$$ = [$1]"],["SUBSCRIPT_EXPRESSION_LIST , SUBSCRIPT_EXPRESSION_LISTABLE","$$ = $1.concat($3)"]],SUBSCRIPT_EXPRESSION_LISTABLE:[["INTEGER",'$$ = { expression: { type: "numeric_literal", value: parseInt($1) } }; yy.ast.set($$)'],["STRING_LITERAL",'$$ = { expression: { type: "string_literal", value: $1 } }; yy.ast.set($$)'],["ARRAY_SLICE",'$$ = { expression: { type: "slice", value: $1 } }; yy.ast.set($$)']],SUBSCRIPT_EXPRESSION:[["STAR",'$$ = { expression: { type: "wildcard", value: $1 } }; yy.ast.set($$)'],["SCRIPT_EXPRESSION",'$$ = { expression: { type: "script_expression", value: $1 } }; yy.ast.set($$)'],["FILTER_EXPRESSION",'$$ = { expression: { type: "filter_expression", value: $1 } }; yy.ast.set($$)']],STRING_LITERAL:[["QQ_STRING","$$ = $1"],["Q_STRING","$$ = $1"]]}};a.readFileSync&&(o.moduleInclude=a.readFileSync(e.resolve("../include/module.js")),o.actionInclude=a.readFileSync(e.resolve("../include/action.js"))),t.exports=o},{"./dict":2,fs:12}],4:[function(e,t,n){var r=e("./aesprim"),a=e("./slice"),o=e("static-eval"),i=e("underscore").uniq,s=function(){return this.initialize.apply(this,arguments)};function l(t,n,a){var o=e("./index"),i=p(r.parse(n).body[0].expression,{"@":t.value}),s=a.replace(/\{\{\s*value\s*\}\}/g,i),l=o.nodes(t.value,s);return l.forEach((function(e){e.path=t.path.concat(e.path.slice(1))})),l}function c(e){return Array.isArray(e)}function u(e){return function(t,n,r,a){var o=t.value,i=t.path,s=[],l=function(t,o){var i;c(t)?(t.forEach((function(e,t){s.length>=a||r(t,e,n)&&s.push({path:o.concat(t),value:e})})),t.forEach((function(t,n){s.length>=a||e&&l(t,o.concat(n))}))):(i=t)&&!(i instanceof Array)&&i instanceof Object&&(this.keys(t).forEach((function(e){s.length>=a||r(e,t[e],n)&&s.push({path:o.concat(e),value:t[e]})})),this.keys(t).forEach((function(n){s.length>=a||e&&l(t[n],o.concat(n))})))}.bind(this);return l(o,i),s}}function f(e){return function(t,n,r){return this.descend(n,t.expression.value,e,r)}}function d(e){return function(t,n,r){return this.traverse(n,t.expression.value,e,r)}}function p(){try{return o.apply(this,arguments)}catch(e){}}function h(e){return e=e.filter((function(e){return e})),i(e,(function(e){return e.path.map((function(e){return String(e).replace("-","--")})).join("-")}))}function m(e){var t=String(e);return t.match(/^-?[0-9]+$/)?parseInt(t):null}s.prototype.initialize=function(){this.traverse=u(!0),this.descend=u()},s.prototype.keys=Object.keys,s.prototype.resolve=function(e){var t=[e.operation,e.scope,e.expression.type].join("-"),n=this._fns[t];if(!n)throw new Error("couldn't resolve key: "+t);return n.bind(this)},s.prototype.register=function(e,t){if(!t instanceof Function)throw new Error("handler must be a function");this._fns[e]=t},s.prototype._fns={"member-child-identifier":function(e,t){var n=e.expression.value,r=t.value;if(r instanceof Object&&n in r)return[{value:r[n],path:t.path.concat(n)}]},"member-descendant-identifier":d((function(e,t,n){return e==n})),"subscript-child-numeric_literal":f((function(e,t,n){return e===n})),"member-child-numeric_literal":f((function(e,t,n){return String(e)===String(n)})),"subscript-descendant-numeric_literal":d((function(e,t,n){return e===n})),"member-child-wildcard":f((function(){return!0})),"member-descendant-wildcard":d((function(){return!0})),"subscript-descendant-wildcard":d((function(){return!0})),"subscript-child-wildcard":f((function(){return!0})),"subscript-child-slice":function(e,t){if(c(t.value)){var n=e.expression.value.split(":").map(m),r=t.value.map((function(e,n){return{value:e,path:t.path.concat(n)}}));return a.apply(null,[r].concat(n))}},"subscript-child-union":function(e,t){var n=[];return e.expression.value.forEach((function(e){var r={operation:"subscript",scope:"child",expression:e.expression},a=this.resolve(r)(r,t);a&&(n=n.concat(a))}),this),h(n)},"subscript-descendant-union":function(t,n,r){var a=e(".."),o=this,i=[];return a.nodes(n,"$..*").slice(1).forEach((function(e){i.length>=r||t.expression.value.forEach((function(t){var n={operation:"subscript",scope:"child",expression:t.expression},r=o.resolve(n)(n,e);i=i.concat(r)}))})),h(i)},"subscript-child-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.descend(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-descendant-filter_expression":function(e,t,n){var a=e.expression.value.slice(2,-1),o=r.parse(a).body[0].expression;return this.traverse(t,null,(function(e,t){return p(o,{"@":t})}),n)},"subscript-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$[{{value}}]")},"member-child-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$.{{value}}")},"member-descendant-script_expression":function(e,t){return l(t,e.expression.value.slice(1,-1),"$..value")}},s.prototype._fns["subscript-child-string_literal"]=s.prototype._fns["member-child-identifier"],s.prototype._fns["member-descendant-numeric_literal"]=s.prototype._fns["subscript-descendant-string_literal"]=s.prototype._fns["member-descendant-identifier"],t.exports=s},{"..":"jsonpath","./aesprim":"./aesprim","./index":5,"./slice":7,"static-eval":15,underscore:12}],5:[function(e,t,n){var r=e("assert"),a=e("./dict"),o=e("./parser"),i=e("./handlers"),s=function(){this.initialize.apply(this,arguments)};function l(e){return"[object String]"==Object.prototype.toString.call(e)}s.prototype.initialize=function(){this.parser=new o,this.handlers=new i},s.prototype.parse=function(e){return r.ok(l(e),"we need a path"),this.parser.parse(e)},s.prototype.parent=function(e,t){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var n=this.nodes(e,t)[0];return n.path.pop(),this.value(e,n.path)},s.prototype.apply=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),r.equal(Y(n),"function","fn needs to be function");var a=this.nodes(e,t).sort((function(e,t){return t.path.length-e.path.length}));return a.forEach((function(t){var r=t.path.pop(),a=this.value(e,this.stringify(t.path)),o=t.value=n.call(e,a[r]);a[r]=o}),this),a},s.prototype.value=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),arguments.length>=3){var a=this.nodes(e,t).shift();if(!a)return this._vivify(e,t,n);var o=a.path.slice(-1).shift();this.parent(e,this.stringify(a.path))[o]=n}return this.query(e,this.stringify(t),1).shift()},s.prototype._vivify=function(e,t,n){var a=this;return r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),function t(n,r){var o=n.pop(),i=a.value(e,n);i||(t(n.concat(),"string"==typeof o?{}:[]),i=a.value(e,n)),i[o]=r}(this.parser.parse(t).map((function(e){return e.expression.value})),n),this.query(e,t)[0]},s.prototype.query=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(l(t),"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.value}));return a},s.prototype.paths=function(e,t,n){r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path");var a=this.nodes(e,t,n).map((function(e){return e.path}));return a},s.prototype.nodes=function(e,t,n){if(r.ok(e instanceof Object,"obj needs to be an object"),r.ok(t,"we need a path"),0===n)return[];var a=this.parser.parse(t),o=this.handlers,i=[{path:["$"],value:e}],s=[];return a.length&&"root"==a[0].expression.type&&a.shift(),a.length?(a.forEach((function(e,t){if(!(s.length>=n)){var r=o.resolve(e),l=[];i.forEach((function(o){if(!(s.length>=n)){var i=r(e,o,n);t==a.length-1?s=s.concat(i||[]):l=l.concat(i||[])}})),i=l}})),n?s.slice(0,n):s):i},s.prototype.stringify=function(e){r.ok(e,"we need a path");var t="$",n={"descendant-member":"..{{value}}","child-member":".{{value}}","descendant-subscript":"..[{{value}}]","child-subscript":"[{{value}}]"};return(e=this._normalize(e)).forEach((function(e){if("root"!=e.expression.type){var r,a=[e.scope,e.operation].join("-"),o=n[a];if(r="string_literal"==e.expression.type?JSON.stringify(e.expression.value):e.expression.value,!o)throw new Error("couldn't find template "+a);t+=o.replace(/{{value}}/,r)}})),t},s.prototype._normalize=function(e){if(r.ok(e,"we need a path"),"string"==typeof e)return this.parser.parse(e);if(Array.isArray(e)&&"string"==typeof e[0]){var t=[{expression:{type:"root",value:"$"}}];return e.forEach((function(e,n){"$"==e&&0===n||("string"==typeof e&&e.match("^"+a.identifier+"$")?t.push({operation:"member",scope:"child",expression:{value:e,type:"identifier"}}):t.push({operation:"subscript",scope:"child",expression:{value:e,type:"number"==typeof e?"numeric_literal":"string_literal"}}))})),t}if(Array.isArray(e)&&"object"==Y(e[0]))return e;throw new Error("couldn't understand path "+e)},s.Handlers=i,s.Parser=o;var c=new s;c.JSONPath=s,t.exports=c},{"./dict":2,"./handlers":4,"./parser":6,assert:8}],6:[function(e,t,n){var r=e("./grammar"),a=e("../generated/parser"),o=function(){var e=new a.Parser,t=e.parseError;return e.yy.parseError=function(){e.yy.ast&&e.yy.ast.initialize(),t.apply(e,arguments)},e};o.grammar=r,t.exports=o},{"../generated/parser":1,"./grammar":3}],7:[function(e,t,n){function r(e){return String(e).match(/^[0-9]+$/)?parseInt(e):Number.isFinite(e)?parseInt(e,10):0}t.exports=function(e,t,n,a){if("string"==typeof t)throw new Error("start cannot be a string");if("string"==typeof n)throw new Error("end cannot be a string");if("string"==typeof a)throw new Error("step cannot be a string");var o=e.length;if(0===a)throw new Error("step cannot be zero");if(a=a?r(a):1,n=n<0?o+n:n,t=r(0===(t=t<0?o+t:t)?0:t||(a>0?0:o-1)),n=r(0===n?0:n||(a>0?o:-1)),t=a>0?Math.max(0,t):Math.min(o,t),n=a>0?Math.min(n,o):Math.max(-1,n),a>0&&n<=t)return[];if(a<0&&t<=n)return[];for(var i=[],s=t;s!=n&&!(a<0&&s<=n||a>0&&s>=n);s+=a)i.push(e[s]);return i}},{}],8:[function(e,t,n){var r=e("util/"),a=Array.prototype.slice,o=Object.prototype.hasOwnProperty,i=t.exports=u;function s(e,t){return r.isUndefined(t)?""+t:r.isNumber(t)&&!isFinite(t)||r.isFunction(t)||r.isRegExp(t)?t.toString():t}function l(e,t){return r.isString(e)?e.length<t?e:e.slice(0,t):e}function c(e,t,n,r,a){throw new i.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:a})}function u(e,t){e||c(e,!0,t,"==",i.ok)}function f(e,t){if(e===t)return!0;if(r.isBuffer(e)&&r.isBuffer(t)){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return r.isDate(e)&&r.isDate(t)?e.getTime()===t.getTime():r.isRegExp(e)&&r.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:r.isObject(e)||r.isObject(t)?function(e,t){if(r.isNullOrUndefined(e)||r.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(r.isPrimitive(e)||r.isPrimitive(t))return e===t;var n=d(e),o=d(t);if(n&&!o||!n&&o)return!1;if(n)return f(e=a.call(e),t=a.call(t));var i,s,l=m(e),c=m(t);if(l.length!=c.length)return!1;for(l.sort(),c.sort(),s=l.length-1;s>=0;s--)if(l[s]!=c[s])return!1;for(s=l.length-1;s>=0;s--)if(!f(e[i=l[s]],t[i]))return!1;return!0}(e,t):e==t}function d(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function p(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||!0===t.call({},e))}function h(e,t,n,a){var o;r.isString(n)&&(a=n,n=null);try{t()}catch(e){o=e}if(a=(n&&n.name?" ("+n.name+").":".")+(a?" "+a:"."),e&&!o&&c(o,n,"Missing expected exception"+a),!e&&p(o,n)&&c(o,n,"Got unwanted exception"+a),e&&o&&n&&!p(o,n)||!e&&o)throw o}i.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return l(JSON.stringify(e.actual,s),128)+" "+e.operator+" "+l(JSON.stringify(e.expected,s),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||c;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,a=r.indexOf("\n"+t.name);if(a>=0){var o=r.indexOf("\n",a+1);r=r.substring(o+1)}this.stack=r}}},r.inherits(i.AssertionError,Error),i.fail=c,i.ok=u,i.equal=function(e,t,n){e!=t&&c(e,t,n,"==",i.equal)},i.notEqual=function(e,t,n){e==t&&c(e,t,n,"!=",i.notEqual)},i.deepEqual=function(e,t,n){f(e,t)||c(e,t,n,"deepEqual",i.deepEqual)},i.notDeepEqual=function(e,t,n){f(e,t)&&c(e,t,n,"notDeepEqual",i.notDeepEqual)},i.strictEqual=function(e,t,n){e!==t&&c(e,t,n,"===",i.strictEqual)},i.notStrictEqual=function(e,t,n){e===t&&c(e,t,n,"!==",i.notStrictEqual)},i.throws=function(e,t,n){h.apply(this,[!0].concat(a.call(arguments)))},i.doesNotThrow=function(e,t){h.apply(this,[!1].concat(a.call(arguments)))},i.ifError=function(e){if(e)throw e};var m=Object.keys||function(e){var t=[];for(var n in e)o.call(e,n)&&t.push(n);return t}},{"util/":11}],9:[function(e,t,n){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],10:[function(e,t,n){t.exports=function(e){return e&&"object"===Y(e)&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],11:[function(e,t,n){(function(t,r){var a=/%[sdj%]/g;n.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,i=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),l=r[n];n<o;l=r[++n])m(l)||!_(l)?i+=" "+l:i+=" "+s(l);return i},n.deprecate=function(e,a){if(v(r.process))return function(){return n.deprecate(e,a).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(a);t.traceDeprecation?console.trace(a):console.error(a),o=!0}return e.apply(this,arguments)}};var o,i={};function s(e,t){var r={seen:[],stylize:c};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&n._extend(r,t),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),u(r,e,r.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,t,r){if(e.customInspect&&t&&S(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=t.inspect(r,e);return y(a)||(a=u(e,a,r)),a}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):h(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var i=Object.keys(t),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),x(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return f(t);if(0===i.length){if(S(t))return e.stylize("[Function"+(t.name?": "+t.name:"")+"]","special");if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return f(t)}var l,c="",_=!1,E=["{","}"];return p(t)&&(_=!0,E=["[","]"]),S(t)&&(c=" [Function"+(t.name?": "+t.name:"")+"]"),b(t)&&(c=" "+RegExp.prototype.toString.call(t)),w(t)&&(c=" "+Date.prototype.toUTCString.call(t)),x(t)&&(c=" "+f(t)),0!==i.length||_&&0!=t.length?r<0?b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=_?function(e,t,n,r,a){for(var o=[],i=0,s=t.length;i<s;++i)C(t,String(i))?o.push(d(e,t,n,r,String(i),!0)):o.push("");return a.forEach((function(a){a.match(/^\d+$/)||o.push(d(e,t,n,r,a,!0))})),o}(e,t,r,s,i):i.map((function(n){return d(e,t,r,s,n,_)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,c,E)):E[0]+c+E[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,a,o){var i,s,l;if((l=Object.getOwnPropertyDescriptor(t,a)||{value:t[a]}).get?s=e.stylize(l.set?"[Getter/Setter]":"[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),C(r,a)||(i="["+a+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),v(i)){if(o&&a.match(/^\d+$/))return s;(i=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=e.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),i=e.stylize(i,"string"))}return i+": "+s}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===E(e)}function _(e){return"object"===Y(e)&&null!==e}function w(e){return _(e)&&"[object Date]"===E(e)}function x(e){return _(e)&&("[object Error]"===E(e)||e instanceof Error)}function S(e){return"function"==typeof e}function E(e){return Object.prototype.toString.call(e)}function k(e){return e<10?"0"+e.toString(10):e.toString(10)}n.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!i[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var r=t.pid;i[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else i[e]=function(){};return i[e]},n.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=h,n.isNull=m,n.isNullOrUndefined=function(e){return null==e},n.isNumber=g,n.isString=y,n.isSymbol=function(e){return"symbol"===Y(e)},n.isUndefined=v,n.isRegExp=b,n.isObject=_,n.isDate=w,n.isError=x,n.isFunction=S,n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===Y(e)||void 0===e},n.isBuffer=e("./support/isBuffer");var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.log=function(){var e,t;console.log("%s - %s",(t=[k((e=new Date).getHours()),k(e.getMinutes()),k(e.getSeconds())].join(":"),[e.getDate(),A[e.getMonth()],t].join(" ")),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==D?D:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":10,_process:14,inherits:9}],12:[function(e,t,n){},{}],13:[function(e,t,n){(function(e){function t(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}n.resolve=function(){for(var n="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var i=o>=0?arguments[o]:e.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(n=i+"/"+n,a="/"===i.charAt(0))}return(a?"/":"")+(n=t(r(n.split("/"),(function(e){return!!e})),!a).join("/"))||"."},n.normalize=function(e){var o=n.isAbsolute(e),i="/"===a(e,-1);return(e=t(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&i&&(e+="/"),(o?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},n.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var a=r(e.split("/")),o=r(t.split("/")),i=Math.min(a.length,o.length),s=i,l=0;l<i;l++)if(a[l]!==o[l]){s=l;break}var c=[];for(l=s;l<a.length;l++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!a){r=o;break}}else a=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},n.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,a=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){n=t+1;break}}else-1===r&&(a=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,a=!0,o=0,i=e.length-1;i>=0;--i){var s=e.charCodeAt(i);if(47!==s)-1===r&&(a=!1,r=i+1),46===s?-1===t?t=i:1!==o&&(o=1):-1!==t&&(o=-1);else if(!a){n=i+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var a="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:14}],14:[function(e,t,n){var r,a,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var c,u=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?u=c.concat(u):d=-1,u.length&&h())}function h(){if(!f){var e=l(p);f=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,f=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new m(e,t)),1!==u.length||f||l(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],15:[function(e,t,n){var r=e("escodegen").generate;t.exports=function(e,t){t||(t={});var n={},a=function e(a,o){if("Literal"===a.type)return a.value;if("UnaryExpression"===a.type){var i=e(a.argument);return"+"===a.operator?+i:"-"===a.operator?-i:"~"===a.operator?~i:"!"===a.operator?!i:n}if("ArrayExpression"===a.type){for(var s=[],l=0,c=a.elements.length;l<c;l++){if((y=e(a.elements[l]))===n)return n;s.push(y)}return s}if("ObjectExpression"===a.type){var u={};for(l=0;l<a.properties.length;l++){var f=null===(v=a.properties[l]).value?v.value:e(v.value);if(f===n)return n;u[v.key.value||v.key.name]=f}return u}if("BinaryExpression"===a.type||"LogicalExpression"===a.type){if((c=e(a.left))===n)return n;var d=e(a.right);if(d===n)return n;var p=a.operator;return"=="===p?c==d:"==="===p?c===d:"!="===p?c!=d:"!=="===p?c!==d:"+"===p?c+d:"-"===p?c-d:"*"===p?c*d:"/"===p?c/d:"%"===p?c%d:"<"===p?c<d:"<="===p?c<=d:">"===p?c>d:">="===p?c>=d:"|"===p?c|d:"&"===p?c&d:"^"===p?c^d:"&&"===p?c&&d:"||"===p?c||d:n}if("Identifier"===a.type)return{}.hasOwnProperty.call(t,a.name)?t[a.name]:n;if("ThisExpression"===a.type)return{}.hasOwnProperty.call(t,"this")?t.this:n;if("CallExpression"===a.type){var h=e(a.callee);if(h===n)return n;if("function"!=typeof h)return n;var m=a.callee.object?e(a.callee.object):n;m===n&&(m=null);var g=[];for(l=0,c=a.arguments.length;l<c;l++){var y;if((y=e(a.arguments[l]))===n)return n;g.push(y)}return h.apply(m,g)}var v;if("MemberExpression"===a.type)return(u=e(a.object))===n||"function"==typeof u?n:"Identifier"===a.property.type?u[a.property.name]:(v=e(a.property))===n?n:u[v];if("ConditionalExpression"===a.type)return(i=e(a.test))===n?n:e(i?a.consequent:a.alternate);if("ExpressionStatement"===a.type)return(i=e(a.expression))===n?n:i;if("ReturnStatement"===a.type)return e(a.argument);if("FunctionExpression"===a.type){var b=a.body.body,_={};for(Object.keys(t).forEach((function(e){_[e]=t[e]})),l=0;l<a.params.length;l++){var w=a.params[l];if("Identifier"!=w.type)return n;t[w.name]=null}for(var l in b)if(e(b[l])===n)return n;t=_;var x=Object.keys(t),S=x.map((function(e){return t[e]}));return Function(x.join(", "),"return "+r(a)).apply(null,S)}if("TemplateLiteral"===a.type){var E="";for(l=0;l<a.expressions.length;l++)E+=e(a.quasis[l]),E+=e(a.expressions[l]);return E+e(a.quasis[l])}if("TaggedTemplateExpression"===a.type){var k=e(a.tag),A=a.quasi,C=A.quasis.map(e),O=A.expressions.map(e);return k.apply(null,[C].concat(O))}return"TemplateElement"===a.type?a.value.cooked:n}(e);return a===n?void 0:a}},{escodegen:12}],jsonpath:[function(e,t,n){t.exports=e("./lib/index")},{"./lib/index":5}]},{},["jsonpath"])("jsonpath")},e.exports=n()}(QT);var eN=QT.exports;const tN=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now","0","1","2","3","4","5","6","7","8","9"]);function nN(e,t){for(const[n,r]of t.entries())if(e.startsWith(r))return e.replace(r,String(n));return e}const rN="$PREFIXED_ID";function aN(e,t,n){return t===rN?[nN(e.id,n)]:eN.query(e,t)}function oN(e){return e.toLowerCase().split(/[^\d:A-Za-z]+/).filter((e=>e&&!tN.has(e)))}function*iN(e){for(const t of e)yield*oN(t)}function*sN(e){for(const t of e)if("string"==typeof t)yield t;else if("object"==typeof t){const e=eN.query(t,"$..*");yield*sN(e)}}function*lN(e,t,n){for(const r of t){const t=aN(e,r,n);if(t.length>0)for(const e of iN(sN(t)))yield[r,e]}}async function cN(e,t,n){const r=await this.db,a=t??r.transaction(["nodes"]);$T(n);const o=[...oN(e)],i=[],s=new Map;i.push(...o.map((async(e,t)=>{$T(n);const r=a.objectStore("nodes").index("full-text-words");for await(const a of r.iterate(IDBKeyRange.bound(e,`${e}￿`,!1,!1))){$T(n);const e=a.value,r=s.get(e.id)??[e,new Set];r[1].add(t),s.set(e.id,r)}}))),await Promise.all(i),$T(n);const l=[];for(const[,[e,t]]of s)$T(n),l.push(...uN(this.textIndexFields,e,t,o,this.prefixes));return l.sort(((e,t)=>t.score-e.score)),l.slice(0,this.options.maxSearchResults??this.DEFAULT_MAX_SEARCH_RESULTS)}function uN(e,t,n,r,a){const o=[...n].sort().map((e=>r[e])),i=o.map((e=>{const t=e.replaceAll(/[$()*+./?[\\\]^{|}-]/g,String.raw`\$&`);return new RegExp(`\\b${t}`,"gi")}));let s=[],l=0;for(const[n,o]of e.entries()){const c=new Set,u=e.length-n-1,f=[...sN(aN(t,o.jsonPath,a))];for(const e of f){let n=0;const a=[];for(const[t,o]of i.entries())for(const i of e.matchAll(o)){n+=1+1*u,c.add(t);const o=i.index,s=r[t];void 0!==o&&(n+=.01*s.length,n+=s.length/e.length*100*.05,a.push({wordIndex:t,position:o}))}n+=100*c.size,l<n&&(l=n),a.sort(((e,t)=>e.position-t.position)),a.length>0&&s.push({term:t,field:o,str:e,score:n,wordMatches:a})}}s=s.filter((e=>e.score===l));for(const e of s){const{wordMatches:t}=e;for(let n=0;n<t.length-1;n++){const r=t[n],a=t[n+1],i=a.wordIndex-r.wordIndex;if(1===i||-1===i){e.score+=1,1===i&&(e.score+=1);const t=Math.abs(a.position-(r.position+o[r.wordIndex].length))-1;e.score-=.05*t}}}return s}function fN(e){return"string"==typeof e.id}function dN(e){return"string"==typeof e.sub&&"string"==typeof e.pred&&"string"==typeof e.obj}function pN(e){return Boolean(e.meta?.deprecated)}var hN=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==Y(t)&&"object"==Y(n)){if(t.constructor!==n.constructor)return!1;var r,a,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t instanceof Map&&n instanceof Map){if(t.size!==n.size)return!1;var i,s=_e(t.entries());try{for(s.s();!(i=s.n()).done;)if(!n.has((a=i.value)[0]))return!1}catch(e){s.e(e)}finally{s.f()}var l,c=_e(t.entries());try{for(c.s();!(l=c.n()).done;)if(!e((a=l.value)[1],n.get(a[0])))return!1}catch(e){c.e(e)}finally{c.f()}return!0}if(t instanceof Set&&n instanceof Set){if(t.size!==n.size)return!1;var u,f=_e(t.entries());try{for(f.s();!(u=f.n()).done;)if(!n.has((a=u.value)[0]))return!1}catch(e){f.e(e)}finally{f.f()}return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(n)){if((r=t.length)!=n.length)return!1;for(a=r;0!=a--;)if(t[a]!==n[a])return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=r;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=r;0!=a--;){var d=o[a];if(!e(t[d],n[d]))return!1}return!0}return t!=t&&n!=n};async function mN(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,o=n.blocking,i=n.terminated,s=indexedDB.open(e,t),l=Mp(s);return a&&s.addEventListener("upgradeneeded",(function(e){a(Mp(s.result),e.oldVersion,e.newVersion,Mp(s.transaction),e)})),r&&s.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),l.then((function(e){i&&e.addEventListener("close",(function(){return i()})),o&&e.addEventListener("versionchange",(function(e){return o(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),l}(e,2,{upgrade(e,t,n,r,a){if(t<2&&(e.objectStoreNames.contains("meta")&&e.deleteObjectStore("meta"),e.objectStoreNames.contains("nodes")&&e.deleteObjectStore("nodes"),e.objectStoreNames.contains("edges")&&e.deleteObjectStore("edges")),e.objectStoreNames.contains("meta")||e.createObjectStore("meta"),!e.objectStoreNames.contains("nodes")){e.createObjectStore("nodes",{keyPath:"id"});const t=r.objectStore("nodes");t.createIndex("by-label","lbl"),t.createIndex("by-type","type"),t.createIndex("by-synonym",["meta","synonyms","val"]),t.createIndex("full-text-words","fullTextWords",{multiEntry:!0})}if(!e.objectStoreNames.contains("edges")){e.createObjectStore("edges",{autoIncrement:!0});const t=r.objectStore("edges");t.createIndex("by-subject","sub"),t.createIndex("by-object","obj"),t.createIndex("by-predicate","pred")}}})}function gN(e){const t=new Set;for(const[,n]of e)t.add(n);return[...t]}async function yN(e){const t=Date.now();let n,r=1;this.options.update?.("Parsing JSON",r);try{n=JSON.parse(await m.openLocation(this.sourceLocation).readFile("utf8"))}catch{throw new Error("Error in loading ontology")}r+=5,this.options.update?.("Parsing JSON complete",r);const a=Date.now(),[o,...i]=n.graphs??[];if(o){if(i.length>0)throw new Error("multiple graphs not supported");try{const n=e.transaction(["meta","nodes","edges"],"readwrite");await n.objectStore("meta").clear(),await n.objectStore("nodes").clear(),await n.objectStore("edges").clear();const i=n.objectStore("nodes"),s=vN.call(this).map((e=>e.jsonPath));if(o.nodes){let e=Math.round(r);for(const[,t]of o.nodes.entries())r+=1/o.nodes.length*64,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing nodes",r),e=Math.round(r)),fN(t)&&await i.add({...t,fullTextWords:gN(lN(t,s,this.prefixes))})}const l=n.objectStore("edges");if(o.edges){let e=Math.round(r);for(const[,t]of o.edges.entries())r+=1/o.edges.length*30,Math.round(r)!=e&&r<100&&(this.options.update?.("Processing edges",r),e=Math.round(r)),dN(t)&&await l.add(t)}await n.done;const c=e.transaction("meta","readwrite"),{update:u,...f}=this.options;await c.objectStore("meta").add({ontologyRecord:{name:this.ontologyName,version:this.ontologyVersion,sourceLocation:this.sourceLocation},storeOptions:f,graphMeta:o.meta,timestamp:String(new Date),schemaVersion:2,timings:{overall:Date.now()-t,load:Date.now()-a}},"meta"),await c.done}catch(t){throw await e.transaction("meta","readwrite").objectStore("meta").clear(),t}}}function vN(){return[{displayName:"ID",jsonPath:rN},...this.options.textIndexing?.indexFields??SN]}async function bN(e){const[t]=await e.transaction("meta").objectStore("meta").getAll();return!!t&&hN(this.options.prefixes,t.storeOptions.prefixes)&&hN(this.options.textIndexing,t.storeOptions.textIndexing)}class _N{ontologyName;ontologyVersion;sourceLocation;db;options;loadOboGraphJson=yN;getTermsByFulltext=cN;openDatabase=mN;isDatabaseCurrent=bN;get textIndexFields(){return vN.call(this)}get prefixes(){return this.options.prefixes??new Map}DEFAULT_MAX_SEARCH_RESULTS=100;constructor(e,t,n,r){this.ontologyName=e,this.ontologyVersion=t,this.sourceLocation=n,this.options=r??{},this.db=this.prepareDatabase()}validate(){const e=[],{sourceLocation:t,sourceType:n}=this;return n?"obo-graph-json"!==n&&e.push(new Error(`ontology source file ${JSON.stringify(t)} has type ${n}, which is not yet supported`)):e.push(new Error(`unable to determine format of ontology source file ${JSON.stringify(t)}, file name must end with ".json", ".obo", or ".owl"`)),e}get sourceType(){if(n.isUriLocation(this.sourceLocation)){if(this.sourceLocation.uri.endsWith(".json"))return"obo-graph-json"}else if(n.isLocalPathLocation(this.sourceLocation)&&this.sourceLocation.localPath.endsWith(".json"))return"obo-graph-json"}get dbName(){return`Apollo Ontology "${this.ontologyName}" "${this.ontologyVersion}"`}async prepareDatabase(){const e=this.validate();if(e.length>0)throw e;const t=await this.openDatabase(this.dbName);if(await this.isDatabaseCurrent(t))return t;try{const{options:e,sourceLocation:n,sourceType:r}=this;if("obo-graph-json"!==r)throw new Error(`ontology source file ${JSON.stringify(n)} has type ${r}, which is not yet supported`);return e.update?.("",0),await this.loadOboGraphJson(t),e.update?.("",100),t}catch(e){throw t.close(),await function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).blocked,n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",(function(e){return t(e.oldVersion,e)})),Mp(n).then((function(){}))}(this.dbName),e}}async termCount(e){const t=await this.db;return(e??t.transaction("nodes")).objectStore("nodes").count()}unique(e){const t=new Map,n=[];for(const r of e)t.has(r.id)||(t.set(r.id,!0),n.push(r));return n}async getTermsWithLabelOrSynonym(e,t,n){const r=t?.includeSubclasses??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=o.objectStore("nodes"),s=[...await i.index("by-label").getAll(e),...await i.index("by-synonym").getAll(e)];if(r){const e=await this.recurseEdges("by-object",s.map((e=>e.id)),(e=>"is_a"===e.pred),"sub",o);for(const t of e){const e=await i.get(t);e&&s.push(e)}}return s}async getPropertiesByLabel(e,t,n){const r=t?.includeSubProperties??!0,a=await this.db,o=n??a.transaction(["nodes","edges"]),i=(await this.getTermsWithLabelOrSynonym(e,{includeSubclasses:!1},o)).filter((e=>AN(e)));if(r){const e=await this.recurseEdges("by-object",i.map((e=>e.id)),(e=>"subPropertyOf"===e.pred),"sub",o),t=o.objectStore("nodes");for(const n of e){const e=await t.get(n);e&&AN(e)&&i.push(e)}}return i}async recurseEdges(e,t,n,r,a){const o=new Set;return await async function t(i){await Promise.all([...i].map((async i=>{const s=(await a.objectStore("edges").index(e).getAll(i)).filter((e=>n(e))).map((e=>e[r]));if(s.length>0){for(const e of s)o.add(e);await t(s)}})))}(t),o.values()}async*expandNodeSet(e,t="is_a",n,r){const a=await this.db,o=r??a.transaction(["edges"]),i=[...e],s=await this.recurseEdges("subclasses"===n?"by-object":"by-subject",i,(e=>e.pred===t),"subclasses"===n?"sub":"obj",o);for(const e of i)yield e;for(const e of s)yield e}expandSubclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"subclasses",n)}expandSuperclasses(e,t="is_a",n){return this.expandNodeSet(e,t,"superclasses",n)}async getClassesThat(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=await this.getPropertiesByLabel(e,{includeSubProperties:!0},a),i=new Set(o.map((e=>e.id))),s=await async function(e){const t=[];for await(const n of e)t.push(n);return t}(this.expandSuperclasses(t.map((e=>e.id)),"is_a",a)),l=await this.recurseEdges("by-object",s,(e=>i.has(e.pred)),"sub",a),c=this.expandSubclasses(l,"is_a",a),u=[];for await(const e of c){const t=await a.objectStore("nodes").get(e);t&&kN(t)&&!pN(t)&&u.push(t)}return u}async getClassesWithoutPropertyLabeled(e,t,n){const r=await this.db,a=n??r.transaction(["nodes","edges"]),o=a.objectStore("nodes"),i=a.objectStore("edges"),s=(await this.getPropertiesByLabel(e,t,a)).map((e=>e.id)),l=await(async()=>{const e=new Set;for(const t of s)for await(const n of i.index("by-predicate").iterate(t))e.add(n.value.sub);const t=new Set;for await(const n of this.expandSubclasses(e,"is_a",a))t.add(n);return t})(),c=[];for await(const e of o){const t=e.value;kN(t)&&!l.has(t.id)&&c.push(t.id)}const u=[];for(const e of c){const t=await a.objectStore("nodes").get(e);t&&kN(t)&&!pN(t)&&u.push(t)}return u}async getAllClasses(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").index("by-type").getAll("CLASS")).filter((e=>!pN(e)))}async getAllTerms(e){const t=await this.db,n=e??t.transaction(["nodes"]);return(await n.objectStore("nodes").getAll()).filter((e=>!pN(e)))}}const wN=l.types.model("OntologyRecord",{name:l.types.string,version:"unversioned",source:l.types.union(h.LocalPathLocation,h.UriLocation,h.BlobLocation),options:l.types.frozen(),equivalentTypes:l.types.map(l.types.array(l.types.string))}).volatile((e=>({dataStore:void 0,startedEquivalentTypeRequests:new Set}))).actions((e=>({ping(){},initDataStore(){e.dataStore=new _N(e.name,e.version,l.getSnapshot(e.source),e.options)},afterCreate(){l.addDisposer(e,s.autorun((()=>{this.initDataStore()})))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).actions((e=>({loadEquivalentTypes:l.flow((function*(t){if(!e.dataStore)return;if(e.startedEquivalentTypeRequests.has(t))return;e.startedEquivalentTypeRequests.add(t);const n=(yield e.dataStore.getTermsWithLabelOrSynonym(t)).map((e=>e.lbl)).filter((e=>null!=e));l.isAlive(e)&&e.setEquivalentTypes(t,n)}))}))).actions((e=>({afterCreate(){s.autorun((t=>{e.dataStore&&(e.loadEquivalentTypes("gene"),e.loadEquivalentTypes("pseudogene"),e.loadEquivalentTypes("transcript"),e.loadEquivalentTypes("pseudogenic_transcript"),e.loadEquivalentTypes("CDS"),e.loadEquivalentTypes("mRNA"),t.dispose())}))},setEquivalentTypes(t,n){e.equivalentTypes.set(t,n)}}))).views((e=>({isTypeOf(t,n){if(t===n)return!0;if(!e.dataStore)return!1;const r=e.equivalentTypes.get(n);return r?r.includes(t):(e.loadEquivalentTypes(n),!1)}}))),xN=l.types.model("OntologyManager",{ontologies:l.types.array(wN),prefixes:l.types.optional(l.types.map(l.types.string),{"GO:":"http://purl.obolibrary.org/obo/GO_","SO:":"http://purl.obolibrary.org/obo/SO_"})}).views((e=>({get featureTypeOntologyName(){const t=l.getRoot(e).jbrowse.configuration;return r.readConfObject(t.ApolloPlugin,"featureTypeOntologyName")}}))).views((e=>({get featureTypeOntology(){return this.findOntology(e.featureTypeOntologyName)},findOntology:(t,n)=>e.ontologies.find((e=>e.name===t&&(void 0===n||e.version===n))),openOntology(e,t){return this.findOntology(e,t)?.dataStore},applyPrefixes:t=>nN(t,e.prefixes),expandPrefixes:t=>function(e,t){for(const[n,r]of t.entries())if(e.startsWith(String(n)))return e.replace(String(n),r);return e}(t,e.prefixes)}))).actions((e=>({addOntology(t,n,r,a){const o=e.ontologies.push({name:t,version:n,source:r,options:{prefixes:new Map(e.prefixes.entries()),...a}});e.ontologies[o-1].ping()}}))),SN=[{displayName:"Label",jsonPath:"$.lbl"},{displayName:"Synonym",jsonPath:"$.meta.synonyms[*].val"},{displayName:"Definition",jsonPath:"$.meta.definition.val"}],EN=r.ConfigurationSchema("OntologyRecord",{name:{type:"string",description:'the full name of the ontology, e.g. "Gene Ontology"',defaultValue:"My Ontology"},version:{type:"string",description:"the ontology's version string",defaultValue:"unversioned"},source:{type:"fileLocation",description:"the download location for the ontology's source file",defaultValue:{locationType:"UriLocation",uri:"http://example.com/myontology.json"}},textIndexFields:{type:"frozen",description:"JSON paths for text fields that will be indexed for text searching",defaultValue:SN}});function kN(e){return"CLASS"===e.type}function AN(e){return"PROPERTY"===e.type}async function CN(e,t,n){if(!e)return;const r=await t.getTermsWithLabelOrSynonym(e.type,{includeSubclasses:!1}),a=r.filter(kN);if(0===r.length)return;const o=await t.getClassesThat("part_of",a);return 0!==o.length?o:void 0}function ON({fetchValidTerms:e,filterTerms:t,includeDeprecated:n,onChange:r,ontologyName:a,ontologyVersion:o,renderInput:i,session:s,style:l,value:f}){const[d,p]=u.useState(!1),[h,m]=u.useState(),[g,y]=u.useState(""),[v,b]=u.useState(),{ontologyManager:_}=s.apolloDataStore,w=_.findOntology(a,o)?.dataStore,x=w&&d&&!h,S=w&&!v,E=u.useCallback((e=>(n||!pN(e))&&(!t||t(e))),[t,n]);u.useEffect((()=>{d||m(void 0)}),[d]),u.useEffect((()=>{const e=new AbortController,{signal:t}=e;return S&&(y(""),async function(e,t,n,r){if(!t)return;const a=(await e.getTermsWithLabelOrSynonym(t,{includeSubclasses:!1})).find((e=>(n??(()=>!0))(e)));if(!a)throw new Error(`not a valid ${e.ontologyName} term`);return a}(w,f,E).then((e=>{t.aborted||b(e)}),(e=>{t.aborted||WT(e)||y(String(e))}))),()=>{e.abort()}}),[s,f,E,w,S]),u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return x&&async function(e,t,n,r){let a;if(t){const n=await t(e,r);n&&(a=n)}return a||(a=await e.getAllTerms()),n?a.filter((e=>n(e))):a}(w,e,E,n).then((e=>{e&&!n.aborted&&m(e)}),(e=>{n.aborted||WT(e)||s.notify(e instanceof Error?e.message:String(e),"error")})),()=>{t.abort()}}),[x,E,w,s,e]);const k={};return g&&(k.error=!0,k.helperText=g),R.default.createElement(c.Autocomplete,{style:l,autoComplete:!0,filterSelectedOptions:!0,disableClearable:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,freeSolo:!0,value:f,options:h??[],onOpen:()=>{p(!0)},onClose:()=>{p(!1)},loading:x,renderInput:i??(e=>R.default.createElement(c.TextField,{...e,...k})),getOptionLabel:e=>"string"==typeof e?e:e.lbl??"",isOptionEqualToValue:(e,t)=>e.lbl===t.lbl,onChange:(e,t)=>{t&&("string"==typeof t?(b(void 0),r(f,t)):t.lbl!==f&&(y(""),b(t),r(f,t.lbl)))}})}function TN({changeManager:e,handleClose:t,session:n,sourceAssemblyId:r,sourceFeature:a}){const[o,i]=u.useState(String(a.max)),[s,l]=u.useState(String(a.min+1)),[f,d]=u.useState(""),[p,h]=u.useState(""),[m,g]=u.useState(""),y=Number(o)<=Number(s);return R.default.createElement(_p,{open:!0,title:"Add new child feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},R.default.createElement("form",{onSubmit:function(n){n.preventDefault(),h("");const i=new tr.AddFeatureChange({changedIds:[a._id],typeName:"AddFeatureChange",assembly:r,addedFeature:{_id:(new Vn).toHexString(),refSeq:a.refSeq,min:Number(s)-1,max:Number(o),type:f},parentFeatureId:a._id});e.submit(i),t(),n.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:s,onChange:e=>{l(e.target.value)}}),R.default.createElement(c.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:o,onChange:e=>{i(e.target.value)},error:y,helperText:y?'"End" must be greater than "Start"':null}),R.default.createElement(ON,{session:n,ontologyName:"Sequence Ontology",style:{width:170},value:f,filterTerms:kN,fetchValidTerms:async function(e,t,n){const r=await CN(e,t);if(r)return r;g(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,a),renderInput:e=>R.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(m),helperText:m}),onChange:(e,t)=>{var n;t&&(n=t,h(""),d(n))}})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:y||!(s&&o&&f)},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),p?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},p)):null)}var NN;function RN(e,t,n,r){const a={_id:(new Vn).toHexString(),refSeq:e,type:"CDS",min:n,max:r,strand:t},o={_id:(new Vn).toHexString(),refSeq:e,type:"exon",min:n,max:r,strand:t},i={};return i[a._id]=a,i[o._id]=o,{_id:(new Vn).toHexString(),refSeq:e,type:"mRNA",min:n,max:r,strand:t,children:i}}function IN({changeManager:e,handleClose:t,region:n,session:r}){const[a,o]=u.useState(String(n.end)),[i,s]=u.useState(String(n.start+1)),[l,f]=u.useState(NN.GENE_AND_SUBFEATURES),[d,p]=u.useState(),[h,m]=u.useState(),[g,y]=u.useState(""),v=Number(a)<=Number(i);let b=Boolean(v)||!(i&&a&&l);return(l===NN.CUSTOM&&!d||!h&&l===NN.GENE_AND_SUBFEATURES||!h&&l===NN.TRANSCRIPT_AND_SUBFEATURES)&&(b=!0),R.default.createElement(_p,{open:!0,title:"Add new feature",handleClose:t,maxWidth:!1,"data-testid":"add-feature-dialog"},R.default.createElement("form",{onSubmit:function(o){let s;o.preventDefault(),y("");for(const[,e]of r.apolloDataStore.assemblies??new Map)if(e._id===n.assemblyName)for(const[,t]of e.refSeqs??new Map)t.name===n.refName&&(s=t._id);if(!s)return void y("Invalid refseq id. Make sure you have the Apollo annotation track open");if(l===NN.GENE_AND_SUBFEATURES){const r=RN(s,h,Number(i)-1,Number(a)),o={};o[r._id]=r;const l=(new Vn).toHexString(),c=new tr.AddFeatureChange({changedIds:[l],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:l,refSeq:s,min:Number(i)-1,max:Number(a),type:"gene",strand:h,children:o}});return e.submit(c),void t()}if(l===NN.TRANSCRIPT_AND_SUBFEATURES){const r=RN(s,h,Number(i)-1,Number(a)),o=new tr.AddFeatureChange({changedIds:[r._id],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:r});return e.submit(o),void t()}if(!d)return void y("No type selected");const c=(new Vn).toHexString(),u=new tr.AddFeatureChange({changedIds:[c],typeName:"AddFeatureChange",assembly:n.assemblyName,addedFeature:{_id:c,refSeq:s,min:Number(i)-1,max:Number(a),type:d,strand:h}});e.submit(u),t()},"data-testid":"submit-form"},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.TextField,{margin:"dense",id:"start",label:"Start",type:"number",fullWidth:!0,variant:"outlined",value:Number(i),onChange:e=>{s(e.target.value)}}),R.default.createElement(c.TextField,{margin:"dense",id:"end",label:"End",type:"number",fullWidth:!0,variant:"outlined",value:a,onChange:e=>{o(e.target.value)},error:v,helperText:v?'"End" must be greater than "Start"':null}),R.default.createElement(c.FormControl,null,R.default.createElement(c.InputLabel,{id:"demo-simple-select-label"},"Strand"),R.default.createElement(c.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Strand",value:h?.toString(),onChange:function(e){switch(y(""),Number(e.target.value)){case 1:m(1);break;case-1:m(-1);break;default:m(void 0)}}},R.default.createElement(c.MenuItem,{value:void 0}),R.default.createElement(c.MenuItem,{value:1},"+"),R.default.createElement(c.MenuItem,{value:-1},"-"))),R.default.createElement(c.FormControl,{style:{marginTop:20}},R.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:NN.GENE_AND_SUBFEATURES,name:"radio-buttons-group",value:l,onChange:e=>{y("");const{value:t}=e.target;Object.keys(NN).includes(t)&&f(NN[t])}},R.default.createElement(c.FormControlLabel,{value:NN.GENE_AND_SUBFEATURES,control:R.default.createElement(c.Radio,null),label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Add gene and sub-features",R.default.createElement(c.Tooltip,{title:"This is a shortcut to create a gene with a single mRNA, exon, and CDS"},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))}),R.default.createElement(c.FormControlLabel,{value:NN.TRANSCRIPT_AND_SUBFEATURES,control:R.default.createElement(c.Radio,null),label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},"Add transcript and sub-features",R.default.createElement(c.Tooltip,{title:"This is a shortcut to create a single mRNA with exon and CDS, but without a parent gene"},R.default.createElement(c.IconButton,{size:"small"},R.default.createElement(ip,{sx:{fontSize:18}}))))}),R.default.createElement(c.FormControlLabel,{value:NN.CUSTOM,checked:l!==NN.GENE_AND_SUBFEATURES&&l!==NN.TRANSCRIPT_AND_SUBFEATURES,control:R.default.createElement(c.Radio,null),label:"Add feature with a sequence ontology type"}))),l===NN.CUSTOM?R.default.createElement(ON,{session:r,ontologyName:"Sequence Ontology",style:{width:170},value:"",filterTerms:kN,renderInput:e=>R.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{var n;t&&(n=t,y(""),p(n))}}):null),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:b},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),g?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},g)):null)}function PN(e,t){const n=(new Vn).toHexString();t.push(n);const r={};if(e.children)for(const n of Object.values(e.children)){const e=PN(n,t);r[e._id]=e}const a="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString();return{...e,refSeq:a,children:e.children&&r,_id:n}}function FN({changeManager:e,handleClose:t,session:n,sourceAssemblyId:a,sourceFeature:o}){const{assemblyManager:i}=n,s=i.assemblyList,[f,d]=u.useState(s.find((e=>e.name!==a))?.name),[p,h]=u.useState([]),[m,g]=u.useState(""),[y,v]=u.useState(o.min),[b,_]=u.useState("");function w(e,t){const n={};if(e.children)for(const r of Object.values(e.children)){const e=w(r,t);e.refSeq=m,e.min=e.min+t,e.max=e.max+t,n[e._id]=e}const r="string"==typeof e.refSeq?e.refSeq:e.refSeq.toHexString(),a="string"==typeof e._id?e._id:e._id.toHexString();return{...e,refSeq:r,children:e.children&&n,_id:a}}return u.useEffect((()=>{g(""),async function(){if(!f)return void _("No assemblies to copy to");const e=await i.waitForAssembly(f);if(!e)return;const{refNameAliases:t}=e;if(!t)return;const n=[...Object.entries(t)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t})));h(n),g(n[0]?._id||"")}().catch((e=>{_(String(e))}))}),[f,i]),R.default.createElement(_p,{open:!0,title:"Copy features and annotations",handleClose:t,maxWidth:!1,"data-testid":"copy-feature"},R.default.createElement("form",{onSubmit:async function(n){if(!f)return;n.preventDefault(),_("");const r=o.length,a=await i.waitForAssembly(f);if(!a)return void _(`Assembly not found: ${f}.`);const s=a.getCanonicalRefName(m),c=a.regions?.find((e=>e.refName===s));if(!c)return void _(`RefSeq not found: ${m}.`);const u=y+r;if(u>c.end)return void _(`Feature would extend beyond the bounds of the selected reference sequence. (Feature would end at ${u}, but reference sequence ends at ${c.end})`);if(y<c.start)return void _(`Reference sequence starts at ${c.start}, feature cannot start before that.`);const d=[],p=PN(l.getSnapshot(o),d),h={...p.attributes};"Parent"in h&&delete h.Parent,p.refSeq=m;const g=y-p.min;p.min=y,p.max=y+r;const v=w(p,g),b=new tr.AddFeatureChange({changedIds:[p._id],typeName:"AddFeatureChange",assembly:f,addedFeature:{_id:p._id,refSeq:p.refSeq,min:p.min,max:p.max,type:p.type,children:v.children,attributes:h,strand:p.strand},copyFeature:!0,allIds:d});e.submit(b),t(),n.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,"Target assembly"),R.default.createElement(c.Select,{labelId:"label",value:f,onChange:function(e){d(e.target.value)}},s.filter((e=>e.name!==a)).map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},r.readConfObject(e,"displayName"))))),R.default.createElement(c.DialogContentText,null,"Target reference sequence"),R.default.createElement(c.Select,{labelId:"label",value:m,onChange:function(e){g(e.target.value)}},p.map((e=>R.default.createElement(c.MenuItem,{key:e._id,value:e._id},e.name)))),R.default.createElement(c.DialogContentText,null,"Start position in target reference sequence"),R.default.createElement(c.TextField,{margin:"dense",type:"number",fullWidth:!0,variant:"outlined",value:y,onChange:e=>{v(Number(e.target.value))}})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!f||!m||!y,variant:"contained",type:"submit"},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),b?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},b)):null)}function MN({changeManager:e,handleClose:t,session:n}){const{internetAccounts:r}=l.getRoot(n),[a,o]=u.useState(),[i,s]=u.useState(""),[f,d]=u.useState(!1),[p,h]=u.useState(!1),m=r.filter((e=>"ApolloInternetAccount"===e.type));if(0===m.length)throw new Error("No Apollo internet account found");const[g,y]=u.useState(m[0]),{collaborationServerDriver:v}=n.apolloDataStore,b=v.getAssemblies();return u.useEffect((()=>{b.length>0&&void 0===a&&o(b[0])}),[b,a]),R.default.createElement(_p,{open:!0,title:"Delete Assembly",handleClose:t,maxWidth:!1,"data-testid":"delete-assembly"},R.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),h(!0),s(""),!a)return void s("Must select assembly!");const r=new tr.DeleteAssemblyChange({typeName:"DeleteAssemblyChange",assembly:a.name});await e.submit(r,{internetAccountId:g.internetAccountId}),t(),n.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},m.length>1?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.DialogContentText,null,"Select account"),R.default.createElement(c.Select,{value:g.internetAccountId,onChange:function(e){h(!1);const t=m.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);y(t)},disabled:p&&!i},r.map((e=>R.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,R.default.createElement(c.DialogContentText,null,"Select assembly"),R.default.createElement(c.Select,{labelId:"label",value:a?.name??"",onChange:function(e){const t=b.find((t=>t.name===e.target.value));o(t)},disabled:0===b.length},b.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),R.default.createElement(c.DialogContentText,null,R.default.createElement("strong",{style:{color:"red"}},"NOTE: All assembly data will be deleted and this operation cannot be undone!")),R.default.createElement(c.FormGroup,null,R.default.createElement(c.FormControlLabel,{control:R.default.createElement(c.Checkbox,{checked:f,onChange:()=>{d(!f)}}),label:"I understand that all assembly data will be deleted"}))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!a||!f,variant:"contained",type:"submit"},"Delete"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function jN({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:r,sourceAssemblyId:a,sourceFeature:o}){const[i,s]=u.useState("");return R.default.createElement(_p,{open:!0,title:"Delete feature",handleClose:t,maxWidth:!1,"data-testid":"delete-feature"},R.default.createElement("form",{onSubmit:function(i){i.preventDefault(),s(""),n?._id===o._id&&r();const c=new tr.DeleteFeatureChange({changedIds:[o._id],typeName:"DeleteFeatureChange",assembly:a,deletedFeature:l.getSnapshot(o),parentFeatureId:o.parent?._id});e.submit(c),t(),i.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,"Are you sure you want to delete the selected feature?")),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit"},"Yes"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}!function(e){e.GENE_AND_SUBFEATURES="GENE_AND_SUBFEATURES",e.TRANSCRIPT_AND_SUBFEATURES="TRANSCRIPT_AND_SUBFEATURES",e.CUSTOM="CUSTOM"}(NN||(NN={}));var DN={exports:{}};function LN({handleClose:e,session:t}){const[n,a]=u.useState(!1),[o,i]=u.useState(),[s,f]=u.useState(""),{collaborationServerDriver:d,getInternetAccount:p,inMemoryFileDriver:h}=t.apolloDataStore,m=[...d.getAssemblies(),...h.getAssemblies()];return R.default.createElement(_p,{open:!0,title:"Export GFF3",handleClose:e,maxWidth:!1,"data-testid":"download-gff3"},R.default.createElement("form",{onSubmit:async function(a){if(a.preventDefault(),f(""),!o)return void f("Must select assembly to download");const{internetAccountConfigId:i}=r.getConf(o,["sequence","metadata"]);i?await async function(e){if(!o)return void f("Must select assembly to download");const t=p(o.configuration.name,e),r=new URL("export/getID",t.baseURL),a=new URLSearchParams({assembly:o.name});r.search=a.toString();const i=r.toString(),s=t.getFetcher({locationType:"UriLocation",uri:i}),l=await s(i,{method:"GET"});if(!l.ok){const e=await rp(l,"Error when exporting ID");return void f(e)}const{exportID:c}=await l.json(),u=new URL("export",t.baseURL),d=new URLSearchParams({exportID:c,includeFASTA:n?"true":"false"});u.search=d.toString();const h=u.toString();window.open(h,"_blank")}(i):function(e){if(!o)return void f("Must select assembly to download");const{assemblies:t}=e.apolloDataStore,n=t.get(o.name),a=n?.refSeqs;if(!a)return void f(`No refSeqs found for assembly "${o.name}"`);const i=[{directive:"gff-version",value:"3"}],s=r.getConf(o,["sequence","adapter","features"]);for(const e of s){const{end:t,refName:n,start:r}=e;i.push({directive:"sequence-region",value:`${n} ${r+1} ${t}`})}for(const[,e]of a){const{features:t}=e;if(t)for(const[,e]of t)i.push(tr.annotationFeatureToGFF3(l.getSnapshot(e)))}for(const e of s){const{refName:t,seq:n}=e;i.push({id:t,description:"",sequence:n})}const c=$d.formatSync(i),u=new Blob([c],{type:"text/plain;charset=utf-8"});DN.exports.saveAs(u,`${o.displayName??o.name}.gff3`)}(t),e()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,"Select assembly"),R.default.createElement(c.Select,{labelId:"label",value:o?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));i(t)},disabled:0===m.length},m.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),R.default.createElement(c.DialogContentText,null,"Select assembly to export to GFF3"),R.default.createElement(c.FormGroup,null,R.default.createElement(c.FormControlLabel,{"data-testid":"include-fasta-checkbox",control:R.default.createElement(c.Checkbox,{checked:n,onChange:()=>{a(!n)}}),label:"Include fasta sequence in GFF output"}))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!o,variant:"contained",type:"submit"},"Download"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),s?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},s)):null)}function qN({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:a}=n,[o,i]=u.useState(),[s,l]=u.useState(),[f,d]=u.useState(""),[p,h]=u.useState(!1),[m,g]=u.useState(),[y,v]=u.useState(!1),[b,_]=u.useState(!1),{collaborationServerDriver:w,getInternetAccount:x}=a,S=w.getAssemblies();return u.useEffect((()=>{s&&(async()=>{const{internetAccountConfigId:e}=r.getConf(s,["sequence","metadata"]),t=x(s.name,e);if(!t)throw new Error("No Apollo internet account found");const{baseURL:n}=t,a=new URL("features/count",n),o=new URLSearchParams({assemblyId:s.name});a.search=o.toString();const i=t.getFetcher({locationType:"UriLocation",uri:a.toString()});_(!0);const l=await i(a.toString(),{method:"GET"});if(!l.ok)throw new Error(await rp(l));{const e=await l.json();g(e.count)}_(!1)})().catch((e=>{console.error(e),d(e.message??e)}))}),[x,n,s]),R.default.createElement(_p,{open:!0,title:"Import Features from GFF3 file",handleClose:t,maxWidth:!1,"data-testid":"import-features-dialog"},b?R.default.createElement(M.default,null):null,R.default.createElement("form",{onSubmit:async function(a){a.preventDefault(),d(""),_(!0),h(!0);let i="";if(!o)return void d("must select a file");if(!s)return void d("Must select assembly to download");const{internetAccountConfigId:l}=r.getConf(s,["sequence","metadata"]),c=x(s.name,l),{baseURL:u}=c,f=new URL("files",u);f.searchParams.set("type","text/x-gff3");const p=f.href,m=new FormData;m.append("file",o),m.append("fileName",o.name),m.append("type","text/x-gff3");const g=c.getFetcher({locationType:"UriLocation",uri:p});t();const{jobsManager:v}=n,b=new AbortController,w={name:`Importing features for ${s.displayName}`,statusMessage:"Uploading file, this may take awhile",progressPct:0,cancelCallback:()=>{b.abort(),v.abortJob(w.name)}};if(v.runJob(w),g){const{signal:e}=b,t=await g(p,{method:"POST",body:m,signal:e});if(!t.ok){const e=await rp(t,"Error when inserting new features (while uploading file)");return v.abortJob(w.name,e),void d(e)}i=(await t.json())._id}const S=new tr.AddFeaturesFromFileChange({typeName:"AddFeaturesFromFileChange",assembly:s.name,fileId:i,deleteExistingFeatures:y});v.done(w),await e.submit(S,{updateJobsManager:!0})}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,"Select assembly"),R.default.createElement(c.Select,{labelId:"label",value:s?.name??"",onChange:function(e){const t=S.find((t=>t.name===e.target.value));l(t),h(!1)},disabled:p&&!f},S.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name))))),R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,"Upload GFF3 to load features"),R.default.createElement("input",{type:"file",onChange:function(e){h(!1),e.target.files&&i(e.target.files[0])},disabled:p&&!f})),m&&m>0?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,null,"This assembly already has ",m," features, would you like to delete the existing features before importing new ones?"),R.default.createElement(F.default,{label:"Yes, delete existing features",disabled:p&&!f,control:R.default.createElement(P.default,{checked:y,onChange:function(e){v(e.target.checked)},inputProps:{"aria-label":"controlled"},color:"warning"})})):null,R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!(s&&o&&void 0!==m)||p,variant:"contained",type:"submit"},p?"Submitting...":"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close"))),f?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},f)):null)}function BN({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),[r,a]=u.useState(""),o=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===o.length)throw new Error("No Apollo internet account found");const[i,s]=u.useState(o[0]);return R.default.createElement(_p,{open:!0,title:"Log out",handleClose:e,maxWidth:!1,"data-testid":"log-out"},R.default.createElement("form",{onSubmit:function(e){e.preventDefault(),a(""),i.removeToken(),globalThis.location.reload()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},o.length>1?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.DialogContentText,null,"Select account"),R.default.createElement(c.Select,{value:i.internetAccountId,onChange:function(e){const t=o.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);s(t)}},n.map((e=>R.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,R.default.createElement(c.DialogContentText,null,"Are you sure you want to log out?")),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!i,variant:"contained",type:"submit"},"Log Out"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),r?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},r)):null)}function UN({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),[r,a]=u.useState(),[o,i]=u.useState(""),[s,f]=u.useState(!1),d=n.filter((e=>"ApolloInternetAccount"===e.type));if(0===d.length)throw new Error("No Apollo internet account found");const[p,h]=u.useState(d[0]),[m,g]=u.useState([]),[y,v]=u.useState([]),{collaborationServerDriver:b}=t.apolloDataStore,_=b.getAssemblies();function w(e,t){const n=[...y],r=e.target.value;if(t)n.includes(r)||(n.push(r),v(n));else{const e=n.indexOf(r,0);-1!==e&&n.splice(e,1),v(n)}}return u.useEffect((()=>{(async function(){const{baseURL:e,getFetcher:t}=p,n=new URL("checks/types",e).href,r=t({locationType:"UriLocation",uri:n}),a=await r(n,{method:"GET"});if(!a.ok){const e=await rp(a,"Error when retrieving checks from server");return void i(e)}const o=await a.json();g(o)})().catch((e=>{i(String(e))}))}),[p]),u.useEffect((()=>{_.length>0&&void 0===r&&a(_[0])}),[_,r]),u.useEffect((()=>{(async function(){if(!r)return;const{baseURL:e,getFetcher:t}=p,n=new URL(`/assemblies/${r.name}`,e).href,a=t({locationType:"UriLocation",uri:n}),o=await a(n,{method:"GET"});if(!o.ok){const e=await rp(o,"Error when retrieving assembly from server");return void i(e)}const s=await o.json();v(s.checks)})().catch((e=>{i(String(e))}))}),[r,p]),R.default.createElement(_p,{open:!0,title:"Manage Checks",handleClose:e,"data-testid":"manage-checks"},R.default.createElement("form",{onSubmit:async function(n){if(n.preventDefault(),!r)return void i("Must select assembly!");const{notify:a}=t,{baseURL:o,getFetcher:s}=p,l=new URL("assemblies/checks",o).href,c=s({locationType:"UriLocation",uri:l}),u=await c(l,{method:"POST",body:JSON.stringify({_id:r.name,checks:y,name:""}),headers:{"Content-Type":"application/json"}});if(u.ok)a("Assembly checks updated successfully","success"),e();else{const e=await rp(u,"Error when updating assembly checks");i(e)}}},R.default.createElement(c.DialogContent,null,d.length>1?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.DialogContentText,null,"Select account"),R.default.createElement(c.Select,{value:p.internetAccountId,onChange:function(e){f(!1);const t=d.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);h(t)},disabled:s&&!o},n.map((e=>R.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,R.default.createElement(c.DialogContentText,null,"Select assembly"),R.default.createElement(c.Select,{style:{width:300},labelId:"label",value:r?.name??"",onChange:function(e){const t=_.find((t=>t.name===e.target.value));a(t)},disabled:0===_.length},_.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),R.default.createElement("br",null),R.default.createElement("br",null),R.default.createElement(c.TableContainer,{component:c.Paper},R.default.createElement(c.Table,null,R.default.createElement(c.TableHead,null,R.default.createElement(c.TableRow,null,R.default.createElement(c.TableCell,null,"Check name"),R.default.createElement(c.TableCell,null,"Use check"))),R.default.createElement(c.TableBody,null,m.map((e=>R.default.createElement(c.TableRow,{key:e._id},R.default.createElement(c.TableCell,null,e.name),R.default.createElement(c.TableCell,null,R.default.createElement(c.Checkbox,{value:e._id,checked:y.includes(e._id),onChange:w}))))))))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit"},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Cancel"))),o?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},o)):null)}!function(e,t){!function(){function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){i(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==("undefined"==typeof window?"undefined":Y(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":Y(self))&&self.self===self?self:"object"==Y(D)&&D.global===D?D:void 0,o=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),i=a.saveAs||("object"!=("undefined"==typeof window?"undefined":Y(window))||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(e,o,i){var s=a.URL||a.webkitURL,l=document.createElement("a");l.download=o=o||e.name||"download",l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):n(l.href)?t(e,o,i):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,o){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=Y(t)&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),a);else if(n(e))t(e,a,o);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){r(i)}))}}:function(e,n,r,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var s="application/octet-stream"===e.type,l=/constructor/i.test(a.HTMLElement)||a.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},u.readAsDataURL(e)}else{var f=a.URL||a.webkitURL,d=f.createObjectURL(e);i?i.location=d:location.href=d,i=null,setTimeout((function(){f.revokeObjectURL(d)}),4e4)}});a.saveAs=i.saveAs=i,e.exports=i}()}(DN);var zN={},GN=Cc.exports;Object.defineProperty(zN,"__esModule",{value:!0});var HN=zN.default=void 0;function $N({changeManager:e,handleClose:t,session:n}){const{internetAccounts:r}=l.getRoot(n),a=r.filter((e=>"ApolloInternetAccount"===e.type&&e.role?.includes("admin")));if(0===a.length)throw new Error("No Apollo internet account found");const[o,i]=u.useState(""),[s,f]=u.useState(a[0]),[d,p]=u.useState([]),h=u.useCallback((async()=>{const{baseURL:e}=s,t=new URL("users",e).href,n=s.getFetcher({locationType:"UriLocation",uri:t});if(n){const e=await n(t,{method:"GET"});if(!e.ok){const t=await rp(e,"Error when getting user data from db");return void i(t)}const r=await e.json();p(r.map((e=>void 0===e.role?{...e,role:""}:e)))}}),[s]);function m(e){return e===s.getUserId()}u.useEffect((()=>{h().catch((e=>{i(String(e))}))}),[h]);const g=[{field:"username",headerName:"User",width:140},{field:"email",headerName:"Email",width:160},{field:"role",headerName:"Role",width:140,type:"singleSelect",valueOptions:["readOnly","user","admin","none"],getOptionLabel(e){switch(e){case"readOnly":return"Read-only";case"user":return"User";case"admin":return"Admin";case"none":return"None";default:return"unknown"}},editable:!0},{field:"actions",type:"actions",getActions:t=>[R.default.createElement(b.GridActionsCellItem,{key:`delete-${t.id}`,icon:R.default.createElement(HN,null),onClick:async()=>{globalThis.confirm("Delete this user?")&&await async function(t){const n=new tr.DeleteUserChange({typeName:"DeleteUserChange",userId:t});await e.submit(n,{internetAccountId:s.internetAccountId}),p((e=>e.filter((e=>e._id!==t))))}(t.id)},disabled:m(t.id),label:"Delete"})]}];return R.default.createElement(_p,{open:!0,fullScreen:!0,title:"Manage users",handleClose:t,"data-testid":"manage-users"},R.default.createElement(c.DialogContent,null,a.length>1?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.DialogContentText,null,"Select account"),R.default.createElement(c.Select,{value:s.internetAccountId,onChange:function(e){const t=a.find((t=>t.internetAccountId===e.target.value));if(!t)throw new Error(`Could not find internetAccount with ID "${e.target.value}"`);f(t)},disabled:!o},r.map((e=>R.default.createElement(c.MenuItem,{key:e.id,value:e.internetAccountId},e.name))))):null,R.default.createElement("div",{style:{height:"100%",width:"100%"}},R.default.createElement(b.DataGrid,{pagination:!0,rows:d,columns:g,getRowId:e=>e._id,slots:{toolbar:b.GridToolbar},getRowHeight:()=>"auto",isCellEditable:e=>!m(e.id),processRowUpdate:async function(t){const n=new tr.UserChange({typeName:"UserChange",role:t.role,userId:t._id});return await e.submit(n,{internetAccountId:s.internetAccountId}),t},onProcessRowUpdateError:e=>{i(String(e))}}))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),o?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},o)):null)}function WN(e,t){const n=t[e];let r;if("three_prime"===e)r=`3'end (coords: ${n.min+1}-${n.max})`;else{if("five_prime"!==e)throw new Error(`Unexpected direction: "${e}"`);r=`5'end (coords: ${n.min+1}-${n.max})`}return r}function VN({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:r,sourceAssemblyId:a,sourceFeature:o}){const[i,s]=u.useState(""),[f,d]=u.useState(),p=function(e){const t={},n=e.parent;if(!n)throw new Error("Unable to find parent of reference exon");let r=[];if(n.children)for(const[,e]of n.children)"exon"===e.type&&r.push(e);r=r.sort(((e,t)=>e.min===t.min?e.max-t.max:e.min-t.min)),n.strand&&-1===n.strand&&(r=r.reverse());let a=0;for(const n of r){if(n._id===e._id){r.length>a+1&&(t.three_prime=r[a+1]),a>0&&(t.five_prime=r[a-1]);break}a++}return t}(o);return R.default.createElement(_p,{open:!0,title:"Merge exons",handleClose:t,maxWidth:!1,"data-testid":"merge-exons"},R.default.createElement("form",{onSubmit:function(i){i.preventDefault(),s("");const{parent:c}=o;if(!f||!c)return;n?._id===o._id&&r();const u=new tr.MergeExonsChange({changedIds:[o._id],typeName:"MergeExonsChange",assembly:a,firstExon:l.getSnapshot(o),secondExon:l.getSnapshot(f),parentFeatureId:c._id});e.submit(u),t(),i.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(p).length?"There are no neighbouring exons to merge with":"Merge with exon on:",R.default.createElement(c.FormControl,{style:{marginTop:5}},R.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:f,onChange:e=>{s("");const{value:t}=e.target;d(p[t])}},Object.keys(p).map((e=>R.default.createElement(c.FormControlLabel,{value:e,key:e,control:R.default.createElement(c.Radio,null),label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},WN(e,p))})))))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(p).length||void 0===f},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function JN(e){let t;return t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id,`${t} [${e.min+1}-${e.max}]`}function YN({changeManager:e,handleClose:t,selectedFeature:n,session:r,setSelectedFeature:a,sourceAssemblyId:o,sourceFeature:i}){const{notify:s}=r,[f,d]=u.useState(""),[p,h]=u.useState(),m=function(e,t){const n=e.parent;if(!n)throw new Error("Unable to find parent of reference transcript");const{featureTypeOntology:r}=t.apolloDataStore.ontologyManager;if(!r)throw new Error("featureTypeOntology is undefined");const a={};if(n.children)for(const[,t]of n.children)r.isTypeOf(t.type,"transcript")&&t._id!==e._id&&(a[t._id]=t);return a}(i,r);return R.default.createElement(_p,{open:!0,title:"Merge transcripts",handleClose:t,maxWidth:!1,"data-testid":"merge-transcripts"},R.default.createElement("form",{onSubmit:async function(r){if(r.preventDefault(),d(""),!p)return;if(n?._id===i._id&&a(),!i.parent)throw new Error("Cannot find parent");const c=new tr.MergeTranscriptsChange({changedIds:[i._id],typeName:"MergeTranscriptsChange",assembly:o,firstTranscript:l.getSnapshot(i),secondTranscript:l.getSnapshot(p),parentFeatureId:i.parent._id});await e.submit(c),s("Transcripts successfully merged","success"),t(),r.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},0===Object.keys(m).length?"There are no transcripts to merge with":"Merge with transcript:",R.default.createElement(c.FormControl,{style:{marginTop:5}},R.default.createElement(c.RadioGroup,{"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",value:p,onChange:e=>{d("");const{value:t}=e.target;h(m[t])}},Object.keys(m).map((e=>R.default.createElement(c.FormControlLabel,{value:e,key:e,control:R.default.createElement(c.Radio,null),label:R.default.createElement(c.Box,{display:"flex",alignItems:"center"},JN(m[e]))})))))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===Object.keys(m).length||void 0===p},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),f?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},f)):null)}HN=zN.default=(0,GN(Oc).default)((0,T.default.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");var KN=function(){return crypto.getRandomValues(new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:21)).reduce((function(e,t){return e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")}),"")};function ZN({handleClose:e,session:t}){const{apolloDataStore:r}=t,{addAssembly:a,addSessionAssembly:o,assemblyManager:i,notify:s}=t,[l,f]=u.useState(null),[d,p]=u.useState(""),[h,m]=u.useState(""),[g,y]=u.useState(!1),v=c.useTheme();return R.default.createElement(_p,{open:!0,title:"Open local GFF3 file",handleClose:e,maxWidth:!1,"data-testid":"open-local-file"},R.default.createElement("form",{onSubmit:async function(c){if(c.preventDefault(),m(""),y(!0),!l)throw new Error("No file selected");const u=await new Response(l).text(),f=`${d}-${l.name}-${KN(8)}`;try{await Wd(f,u,r)}catch(t){return console.error(t),s(`Error loading GFF3 ${l.name}, ${String(t)}`,"error"),void e()}const p={name:f,aliases:[d],displayName:d,sequence:{trackId:`sequenceConfigId-${d}`,type:"ReferenceSequenceTrack",adapter:{type:"ApolloSequenceAdapter",assemblyId:f},metadata:{apollo:!0,...n.isElectron?{file:l.path}:{}}}};await(o||a)(p);const h=await i.waitForAssembly(p.name);h?(t.addApolloTrackConfig(h),s(`Loaded GFF3 ${l.name}`,"success")):s(`Error loading GFF3 ${l.name}`,"error"),e()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.FormControl,null,R.default.createElement("div",{style:{flexDirection:"row"}},R.default.createElement(c.Button,{variant:"contained",component:"label",style:{marginRight:v.spacing()}},"Choose File",R.default.createElement("input",{type:"file",required:!0,hidden:!0,onChange:function(e){const t=e.target.files?.item(0);if(t&&(m(""),f(t),!d)){const e=t.name,n=e.lastIndexOf(".");p(-1===n?e:e.slice(0,n))}}})),l?l.name:"No file chosen"),R.default.createElement(c.FormHelperText,null,"Make sure your GFF3 has an embedded FASTA section")),R.default.createElement(c.TextField,{required:!0,label:"Assembly name",value:d,onChange:function(e){p(e.target.value)}})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{disabled:!1,variant:"contained",type:"submit"},g?"Submitting...":"Submit"),R.default.createElement(c.Button,{disabled:g,variant:"outlined",type:"submit",onClick:e},"Cancel"))),h?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},h)):null)}const XN=f.makeStyles()((e=>({changeTextarea:{fontFamily:"monospace",width:600,resize:"none",border:`1px solid ${e.palette.divider}`,borderRadius:e.shape.borderRadius}})));function QN({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),r=n.find((e=>"ApolloInternetAccount"===e.type));if(!r)throw new Error("No Apollo internet account found");const{baseURL:a}=r,{classes:o}=XN(),[i,s]=u.useState(),[f,d]=u.useState([]),[p,h]=u.useState(""),[m,g]=u.useState([]),y=[{field:"sequence"},{field:"typeName",headerName:"Change type",width:200,type:"singleSelect",valueOptions:[...B.changeRegistry.changes.keys()]},{field:"changes",headerName:"Change JSON",width:600,renderCell:({value:e})=>R.default.createElement("textarea",{className:o.changeTextarea,value:JSON.stringify(e),readOnly:!0}),valueFormatter:({value:e})=>JSON.stringify(e)},{field:"user",headerName:"User",width:140},{field:"createdAt",headerName:"Time",width:160,type:"dateTime",valueGetter:e=>e&&new Date(e)}];return u.useEffect((()=>{(async function(){const e=new URL("assemblies",a).href,t=r?.getFetcher({locationType:"UriLocation",uri:e});if(t){const n=await t(e,{method:"GET"});if(!n.ok){const e=await rp(n,"Error when retrieving assemblies from server");return void s(e)}const r=await n.json();d(r)}})().catch((e=>{s(String(e))}))}),[r,a]),u.useEffect((()=>{!p&&f.length>0&&h(f[0]._id)}),[p,f]),u.useEffect((()=>{(async function(){if(!p)return;const e=new URL("changes",a),t=new URLSearchParams({assembly:p});e.search=t.toString();const n=e.toString(),o=r?.getFetcher({locationType:"UriLocation",uri:n});if(o){const e=await o(n,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await rp(e,"Error when retrieving changes");return void s(t)}const t=await e.json();g(t)}})().catch((e=>{s(String(e))}))}),[p,r,a]),R.default.createElement(_p,{open:!0,fullScreen:!0,title:"View change log",handleClose:e,"data-testid":"view-changelog"},R.default.createElement(c.Select,{style:{width:200,marginLeft:40},value:p,onChange:function(e){h(e.target.value)}},f.map((e=>R.default.createElement(c.MenuItem,{key:e._id,value:e._id},e.name)))),R.default.createElement(c.DialogContent,null,R.default.createElement(b.DataGrid,{pagination:!0,rows:m,columns:y,getRowId:e=>e._id,slots:{toolbar:b.GridToolbar},initialState:{sorting:{sortModel:[{field:"sequence",sort:"desc"}]},columns:{columnVisibilityModel:{sequence:!1}}}})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Close")),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}const eR=[{field:"refName",headerName:"Ref Name"},{field:"aliases",headerName:"Aliases",editable:!0}],tR=e=>/^[\da-f]{24}$/i.test(e);function nR({changeManager:e,handleClose:t,session:n}){const r=u.useRef(null),[a,o]=u.useState(""),[i,s]=u.useState(!1),[l,f]=u.useState(),[d,p]=u.useState([]),[h,m]=u.useState(new Map),{apolloDataStore:g}=n,{collaborationServerDriver:y}=g,v=y.getAssemblies();u.useEffect((()=>{let e=0;const t=()=>{if(!l)return;const n=new Map;if(e<2&&!l.refNames&&(e++,setTimeout(t,50)),!l.refNames)return;const r=l.refNameAliases;for(const e in r){const t=r[e];if(t&&!tR(e))if(n.has(t)){const r=n.get(t)??[];n.set(t,[...r,e])}else n.set(t,[e])}m(n)};t()}),[l]);const _=()=>[...h].map(((e,t)=>({id:t,refName:e[0],aliases:e[1].filter((t=>t!==e[0])).join(", ")})));return R.default.createElement(_p,{open:!0,title:"Add reference sequence aliases",handleClose:t,maxWidth:"sm","data-testid":"add-refseq-alias",fullWidth:!0},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.Grid2,{container:!0,spacing:2},R.default.createElement(c.Grid2,null,R.default.createElement(c.FormControl,{disabled:i&&!a,fullWidth:!0},R.default.createElement(c.InputLabel,{id:"demo-simple-select-label"},"Assembly"),R.default.createElement(c.Select,{labelId:"demo-simple-select-label",id:"demo-simple-select",label:"Assembly",value:l?.name??"",onChange:e=>{const t=v.find((t=>t.name===e.target.value));f(t),s(!1),o(""),r.current&&(r.current.value="")}},v.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))))),R.default.createElement(c.Grid2,null,R.default.createElement(c.InputLabel,null,"Load RefName alias"),R.default.createElement("input",{type:"file",onChange:e=>{(async e=>{if(!e.target.files)return;const t=e.target.files[0],n=(await t.text()).split("\n"),r=new Map(h);o("");for(const e of n){const t=e.split("\t");for(const e of t)r.has(e)&&r.set(e,[...r.get(e)??[],...t])}m(r)})(e).catch((()=>{o("Error reading file")}))},ref:r,disabled:i&&!a||!l}))),l&&h.size>0?R.default.createElement("div",{style:{height:200,width:"100%",marginTop:20}},R.default.createElement(c.InputLabel,null,"Refname aliases found for selected assembly."),R.default.createElement(b.DataGrid,{rows:_(),columns:eR,initialState:{pagination:{paginationModel:{page:0,pageSize:5}}},pageSizeOptions:[5,10],onRowSelectionModelChange:e=>{(e=>{if(e.length>0){s(!0);const t=e.flatMap((e=>_().filter((t=>t.id===e))));p(t)}else s(!1),p([])})(e)},processRowUpdate:(e,t)=>{const n=new Map(h);return n.set(e.refName,e.aliases.split(",")),m(n),e},checkboxSelection:!0})):null),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:!i,onClick:()=>{const n=[];for(const e of d){const{refName:t}=e,r=e.aliases.split(",").map((e=>e.trim())).filter((e=>e.length>0));n.push({refName:t,aliases:r})}if(o(""),!l)return void o("No assembly selected");const r=new tr.AddRefSeqAliasesChange({typeName:"AddRefSeqAliasesChange",assembly:l.name,refSeqAliases:n});e.submit(r).catch((()=>{o("Error submitting change")})),t()}},"Submit"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Close")),a?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},a)):null)}function rR({handleClose:e,session:t}){const{internetAccounts:n}=l.getRoot(t),{collaborationServerDriver:r}=t.apolloDataStore,a=n.find((e=>"ApolloInternetAccount"===e.type));if(!a)throw new Error("No Apollo internet account found");const{baseURL:o}=a,[i,s]=u.useState(),[f,d]=u.useState(),[p,h]=u.useState([]),m=r.getAssemblies();return u.useEffect((()=>{!f&&m.length>0&&d(m[0])}),[m,f]),u.useEffect((()=>{(async function(){const e=f?.name;if(!e)return;const t=new URL("checks",o),n=new URLSearchParams({assembly:e});t.search=n.toString();const r=t.toString(),i=a?.getFetcher({locationType:"UriLocation",uri:r});if(i){const e=await i(r,{headers:new Headers({"Content-Type":"application/json"})});if(!e.ok){const t=await rp(e,"Error when retrieving checks");return void s(t)}const t=await e.json();h(t)}})().catch((e=>{s(String(e))}))}),[f,a,o]),R.default.createElement(_p,{open:!0,fullScreen:!0,title:"View check results",handleClose:e,"data-testid":"view-check-results"},R.default.createElement(c.Select,{style:{width:200,marginLeft:40},value:f?.name??"",onChange:function(e){const t=m.find((t=>t.name===e.target.value));d(t)},disabled:0===m.length},m.map((e=>R.default.createElement(c.MenuItem,{key:e.name,value:e.name},e.displayName??e.name)))),R.default.createElement(c.DialogContent,null,R.default.createElement(b.DataGrid,{pagination:!0,rows:p,columns:[{field:"_id",headerName:"id",width:50},{field:"name",headerName:"Check name",width:200},{field:"refSeq",headerName:"Reference sequence ID",width:200},{field:"ids",headerName:"Feature IDs",width:200},{field:"message",headerName:"Message",flex:1}],getRowId:e=>e._id,slots:{toolbar:b.GridToolbar},initialState:{sorting:{sortModel:[{field:"name",sort:"asc"}]},columns:{columnVisibilityModel:{name:!0}}}})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:e},"Close")),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}function aR(e){return e.max-e.min<2?{isSplittable:!1,comment:"This exon is too short to be split"}:{isSplittable:!0,comment:""}}function oR({changeManager:e,handleClose:t,selectedFeature:n,setSelectedFeature:r,sourceAssemblyId:a,sourceFeature:o}){const[i,s]=u.useState(""),f=l.getSnapshot(o);return R.default.createElement(_p,{open:!0,title:"Split exon",handleClose:t,maxWidth:!1,"data-testid":"split-exon"},R.default.createElement("form",{onSubmit:function(i){i.preventDefault(),s(""),n?._id===o._id&&r();const l=f.min+(f.max-f.min)/2,c=Math.floor(l),u=Math.ceil(l);if(!o.parent?._id)throw new Error("Splitting an exon without parent is not possible yet");const d=new tr.SplitExonChange({changedIds:[o._id],typeName:"SplitExonChange",assembly:a,exonToBeSplit:f,parentFeatureId:o.parent._id,upstreamCut:c,downstreamCut:u,leftExonId:(new Vn).toHexString(),rightExonId:(new Vn).toHexString()});e.submit(d),t(),i.preventDefault()}},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.DialogContentText,null,function(e){const t=aR(e);return t.isSplittable?"Are you sure you want to split the selected exon?":t.comment}(f))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:!aR(f).isSplittable},"Yes"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:t},"Cancel"))),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}const iR=[{field:"name",headerName:"Assembly Name",width:150,editable:!1},{field:"aliases",headerName:"Aliases",width:300,editable:!0}];function sR({changeManager:e,handleClose:t,session:n}){const{apolloDataStore:r}=n,{collaborationServerDriver:a}=r,o=a.getAssemblies().map((e=>({id:e.name,name:e.displayName??e.name,aliases:e.aliases.join(", ")}))),[i,s]=R.default.useState("");return R.default.createElement(_p,{open:!0,title:"Add assembly aliases",handleClose:t,maxWidth:"sm","data-testid":"add-assembly-alias",fullWidth:!0},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column"}},R.default.createElement(c.Box,{sx:{height:400,width:"100%"}},R.default.createElement(b.DataGrid,{rows:o,columns:iR,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5],processRowUpdate:(n,r)=>{const a=new tr.AddAssemblyAliasesChange({typeName:"AddAssemblyAliasesChange",assembly:n.id,aliases:n.aliases.split(",")});return e.submit(a).catch((()=>{s("Error submitting change")})),t(),n},disableRowSelectionOnClick:!0}))),i?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},i)):null)}var lR={},cR=Cc.exports;Object.defineProperty(lR,"__esModule",{value:!0});var uR=lR.default=void 0;function fR(e){const{color:t}=e;return R.default.createElement(c.SvgIcon,{viewBox:"0 0 18 18",style:{fontSize:18,marginRight:4},...e},"disabled"===t?R.default.createElement("path",{d:"M9.001,10.71 l0,-3.348 l8.424,0 c0.126,0.567,0.225,1.098,0.225,1.845 c0,5.139,-3.447,8.793,-8.64,8.793 c-4.968,0,-9,-4.032,-9,-9 c0,-4.968,4.032,-9,9,-9 c2.43,0,4.464,0.891,6.021,2.349 l-2.556,2.484 c-0.648,-0.612,-1.782,-1.332,-3.465,-1.332 c-2.979,0,-5.409,2.475,-5.409,5.508 c0,3.033,2.43,5.508,5.409,5.508 c3.447,0,4.716,-2.385,4.95,-3.798 l-4.959,0 l0,-0.009 z"}):R.default.createElement(R.default.Fragment,null,R.default.createElement("path",{d:"M17.64,9.20454545 c0,-0.638,-0.057,-1.252,-0.164,-1.841 l-8.476,0 l0,3.481 l4.844,0 c-0.209,1.125,-0.843,2.079,-1.796,2.717 l0,2.258 l2.908,0 c1.702,-1.567,2.684,-3.874,2.684,-6.615 l0,0 z",fill:"#4285F4"}),R.default.createElement("path",{d:"M9,18 c2.43,0,4.467,-0.806,5.956,-2.18 l-2.908,-2.259 c-0.806,0.54,-1.837,0.859,-3.048,0.859 c-2.344,0,-4.328,-1.583,-5.036,-3.71 l-3.007,0 l0,2.332 c1.481,2.941,4.525,4.958,8.043,4.958 l0,0 z",fill:"#34A853"}),R.default.createElement("path",{d:"M3.96409091,10.71 c-0.18,-0.54,-0.282,-1.117,-0.282,-1.71 c0,-0.593,0.102,-1.17,0.282,-1.71 l0,-2.332 l-3.007,0 c-0.609,1.215,-0.957,2.59,-0.957,4.042 c0,1.452,0.348,2.827,0.957,4.042 l3.007,-2.332 l0,0 z",fill:"#FBBC05"}),R.default.createElement("path",{d:"M9,3.57954545 c1.321,0,2.508,0.454,3.44,1.346 l2.582,-2.581 c-1.559,-1.453,-3.596,-2.345,-6.022,-2.345 c-3.518,0,-6.562,2.017,-8.043,4.959 l3.007,2.331 c0.708,-2.127,2.692,-3.71,5.036,-3.71 l0,0 z",fill:"#EA4335"})))}function dR(e){const{color:t}=e;return R.default.createElement(c.SvgIcon,{viewBox:"0 0 21 21",style:{fontSize:21},...e},R.default.createElement("rect",{x:"1",y:"1",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#F25022"}),R.default.createElement("rect",{x:"1",y:"11",width:"9",height:"9",fill:"disabled"===t?"#7B7B7B":"#00A4EF"}),R.default.createElement("rect",{x:"11",y:"1",width:"9",height:"9",fill:"disabled"===t?"#939393":"#7FBA00"}),R.default.createElement("rect",{x:"11",y:"11",width:"9",height:"9",fill:"disabled"===t?"#B9B9B9":"#FFB900"}))}uR=lR.default=(0,cR(Oc).default)((0,T.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z"}),"AccountCircle");const pR=f.makeStyles()((e=>({loginButton:{marginBottom:e.spacing(1),width:"220px",height:"40px",fontSize:"16px",textTransform:"none",justifyContent:"left",padding:"3px 12px"}})));function hR(e){const{classes:t}=pR(),{disabled:n}=e;return R.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:R.default.createElement(fR,{color:n?"disabled":void 0}),...e},"Sign in with Google")}function mR(e){const{classes:t}=pR(),{disabled:n}=e;return R.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:R.default.createElement(dR,{color:n?"disabled":void 0}),...e},"Sign in with Microsoft")}function gR(e){const{classes:t}=pR();return R.default.createElement(c.Button,{className:t.loginButton,variant:"outlined",startIcon:R.default.createElement(uR,{fontSize:"small"}),...e},"Continue as Guest")}const yR=f.makeStyles()((e=>({divider:{marginTop:e.spacing(4),marginBottom:e.spacing(5)}}))),vR=({baseURL:e,handleClose:t,name:n})=>{const{classes:r}=yR(),[a,o]=u.useState(""),[i,s]=u.useState([]);function l(e){t("google"===e?"google":"microsoft"===e?"microsoft":"guest")}u.useEffect((()=>{const t=new AbortController,{signal:n}=t;return async function(){const t=new URL("auth/types",e).href,r=await fetch(t,{method:"GET",signal:n});if(!r.ok){const e=await rp(r,"Error when retrieving auth types from server");return void o(e)}const a=await r.json();s(a)}().catch((e=>{WT(e)||o(String(e))})),()=>{t.abort()}}),[e]);const f=i.includes("google"),d=i.includes("microsoft"),p=i.includes("guest");return R.default.createElement(_p,{open:!0,title:`Log in to ${n}`,handleClose:t,maxWidth:!1,"data-testid":"login-apollo"},R.default.createElement(c.DialogContent,{style:{display:"flex",flexDirection:"column",paddingTop:8}},f?R.default.createElement(hR,{disabled:!f,onClick:()=>{l("google")}}):null,d?R.default.createElement(mR,{disabled:!d,onClick:()=>{l("microsoft")}}):null,p?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.Divider,{className:r.divider}),R.default.createElement(gR,{onClick:()=>{l("guest")}})):null),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")),a?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},a)):null)},bR="undefined"==typeof sessionStorage,_R=e=>a.InternetAccount.named("ApolloInternetAccount").props({type:l.types.literal("ApolloInternetAccount"),configuration:r.ConfigurationReference(e)}).views((e=>({get baseURL(){return r.getConf(e,"baseURL")},getUserId(){const t=e.retrieveToken();if(t)return tr.getDecodedToken(t).id}}))).volatile((()=>({role:void 0}))).actions((e=>{let t=!1;return{setRole(){const n=e.retrieveToken();if(!n)return void(e.role=void 0);const r=tr.getDecodedToken(n),{role:a}=r;if(!a&&!t){const{session:n}=l.getRoot(e);n.notify("You have registered as a user but have not been given access. Ask your administrator to enable access for your account.","warning"),t=!0}e.role!==a&&(e.role=a)}}})).actions((e=>{let t;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},finishOAuthWindow(t,n,r){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return void this.deleteMessageChannel();const a=t.data.redirectUri.replace("#","?"),o=new URL(a),i=new URLSearchParams(o.search).get("access_token");this.deleteMessageChannel(),i?(e.storeToken(i),e.setRole(),n(i)):r(new Error("Error with token endpoint"))},async openAuthWindow(t,r,a){const o=n.isElectron?"http://localhost/auth":globalThis.location.origin+globalThis.location.pathname,i=new URL("auth/login",e.baseURL),s=new URLSearchParams({type:t,redirect_uri:o});i.search=s.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(n.isElectron){const{ipcRenderer:t}=globalThis.require("electron"),n=await t.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:{redirect_uri:o},url:i.toString()}),s=new MessageEvent("message",{data:{name:l,redirectUri:n}});this.finishOAuthWindow(s,r,a)}else this.addMessageChannel(r,a),window.open(i,l,"width=500,height=600")}}})).actions((e=>({async getTokenFromUser(t,n){const{baseURL:r}=e,a=await new Promise(((t,n)=>{const{session:r}=l.getRoot(e),{baseURL:a,name:o}=e;r.queueDialog((e=>[vR,{name:o,handleClose:r=>{r?r instanceof Error?n(r):t(r):n(new Error("user cancelled entry")),e()},baseURL:a}]))}));if("guest"!==a)return void e.openAuthWindow(a,t,n);const o=new URL("auth/login",r),i=new URLSearchParams({type:a});o.search=i.toString();const s=o.toString(),c=await fetch(s);if(!c.ok){const e=await rp(c,"Error when logging in");return void n(new Error(e))}const{token:u}=await c.json();t(u)}}))).volatile((()=>({lastChangeSequenceNumber:void 0}))).actions((e=>({setLastChangeSequenceNumber(t){e.lastChangeSequenceNumber=t}}))).actions((e=>({updateLastChangeSequenceNumber:l.flow((function*(){const{baseURL:t}=e,n=new URL("changes",t),r=new URLSearchParams({limit:"1"});n.search=r.toString();const a=n.toString(),o=e.getFetcher({locationType:"UriLocation",uri:a}),i=yield o(a,{method:"GET"});if(!i.ok){const e=yield rp(i,"Error when fetching server LastChangeSequence");throw new Error(e)}const s=yield i.json();e.setLastChangeSequenceNumber(s.length>0?s[0].sequence:0)})),getMissingChanges:l.flow((function*(){const{session:t}=l.getRoot(e),{changeManager:n}=t.apolloDataStore;if(!e.lastChangeSequenceNumber)throw new Error("No LastChangeSequence stored in session. Please, refresh you browser to get last updates from server");const{baseURL:r,lastChangeSequenceNumber:a}=e,o=new URL("changes",r),i=new URLSearchParams({since:String(a),sort:"1"});o.search=i.toString();const s=o.toString(),c=e.getFetcher({locationType:"UriLocation",uri:s}),u=yield c(s,{method:"GET"});if(!u.ok)return void console.error(`Error when fetching the last updates to recover socket connection — ${u.status}`);const f=yield u.json();for(const e of f){const t=B.Change.fromJSON(e);n.submit(t,{submitToBackend:!1})}}))}))).volatile((e=>{const{origin:t,pathname:n}=new URL("socket.io/",e.baseURL);return{socket:ef(t,{path:n})}})).actions((e=>({addSocketListeners(){const{session:t}=l.getRoot(e),{notify:n}=t,r=e.retrieveToken();if(!r)throw new Error("No Token found");const{socket:a}=e,{addCheckResult:o,changeManager:i,deleteCheckResult:s}=t.apolloDataStore;a.on("connect",(async()=>{await e.getMissingChanges()})),a.on("connect_error",(e=>{console.error(e),n("Could not connect to the Apollo server.","error")})),a.on("COMMON",(e=>{if("checkResult"in e)return void(e.deleted?s(e.checkResult._id.toString()):o(e.checkResult));if(sessionStorage.setItem("LastChangeSequence",String(e.changeSequence)),e.userSessionId===r)return;const t=B.Change.fromJSON(e.changeInfo);i.submit(t,{submitToBackend:!1})})),a.on("USER_LOCATION",(e=>{const{channel:n,locations:a,userName:o,userSessionId:i}=e,s=tr.getDecodedToken(r),l=tr.makeUserSessionId(s);"USER_LOCATION"===n&&i!==l&&t.addOrUpdateCollaborator({name:o,id:i,locations:a})})),a.on("REQUEST_INFORMATION",(e=>{const{channel:n,userSessionId:a}=e;"REQUEST_INFORMATION"===n&&a!==r&&t.broadcastLocations()}))}}))).actions((e=>({postUserLocation:(t=>{let n;return t=>{clearTimeout(n),n=setTimeout((()=>{!async function(t){const{baseURL:n}=e,r=new URL("users/userLocation",n).href,a=new URLSearchParams(JSON.stringify(t)),o=e.getFetcher({locationType:"UriLocation",uri:r});try{if(!(await o(r,{method:"POST",body:a})).ok)throw new Error("ignore")}catch{console.error("Broadcasting user location failed")}}(t)}),300)}})()}))).actions((e=>({initialize:l.flow((function*(t){if("admin"===t){const t=l.getRoot(e);n.isAbstractMenuManager(t)&&function(e){e.appendToMenu("Apollo",{label:"Add Assembly",onClick:e=>{e.queueDialog((t=>[Ep,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Delete Assembly",onClick:e=>{e.queueDialog((t=>[MN,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Import Features",onClick:e=>{e.queueDialog((t=>[qN,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Add reference sequence aliases",onClick:e=>{e.queueDialog((t=>[nR,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Add Assembly aliases",onClick:e=>{e.queueDialog((t=>[sR,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Manage Users",onClick:e=>{e.queueDialog((t=>[$N,{session:e,handleClose:()=>{t()},changeManager:e.apolloDataStore.changeManager}]))}}),e.appendToMenu("Apollo",{label:"Undo",onClick:e=>{const{apolloDataStore:t}=e,{notify:n}=e;t.changeManager.recentChanges.length>0?t.changeManager.revertLastChange():n("No changes to undo","info")}})}(t)}yield e.updateLastChangeSequenceNumber(),e.addSocketListeners();const{baseURL:r}=e,a=new URL("users/locations",r).href,o=e.getFetcher({locationType:"UriLocation",uri:a});yield o(a,{method:"GET"}),window.addEventListener("beforeunload",(()=>{e.postUserLocation([])})),document.addEventListener("visibilitychange",(()=>{if("hidden"===document.visibilityState&&e.postUserLocation([]),"visible"===document.visibilityState){const{session:t}=l.getRoot(e);t.broadcastLocations()}}))}))}))).actions((e=>({afterAttach(){e.setRole(),s.autorun((async t=>{if(bR)return;const{session:n}=l.getRoot(e);n&&e.role&&(await e.initialize(e.role),t.dispose())}),{name:"ApolloInternetAccount"})}}))),wR="undefined"==typeof sessionStorage;class xR extends w.BaseAdapter{refNameAliases;async getRefNameAliases(){const e=r.readConfObject(this.config,"assemblyId");if(!wR){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e);return await n.getRefNameAliases(e)}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n(new Error("timeout"))}),2e4),a=KN(),o=e=>{const n=e.data;(function(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo&&"refNameAliases"in e})(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.refNameAliases))};addEventListener("message",o),rpcServer.emit("apollo",{apollo:!0,method:"getRefNameAliases",assembly:e,messageId:a})}));return this.refNameAliases=t,t}freeResources(){}}var SR=r.ConfigurationSchema("ApolloRefNameAliasAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),ER={};function kR(e){return"uniqueId"in e&&"object"!==Y(e.data)}Object.defineProperty(ER,"__esModule",{value:!0}),ER.isFeature=function(e){return"object"===Y(e)&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id};var AR=function(){function e(t){var n,r=this;X(this,e),kR(t)?this.data=t:(this.data=t.data,this.parentHandle=t.parent);var a=kR(t)?t.uniqueId:t.id;if(null==a)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(a),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(n=this.data.subfeatures)||void 0===n?void 0:n.map((function(t,n){return"function"!=typeof t.get?new e({id:t.uniqueId||"".concat(a,"-").concat(n),data:V({strand:r.data.strand},t),parent:r}):t})))}return ee(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=V(V({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e(V({},t))}}]),e}(),CR=ER.default=AR;function OR(e){return"object"==typeof e&&null!==e&&"apollo"in e&&!0===e.apollo}const TR="undefined"==typeof sessionStorage;class NR extends w.BaseSequenceAdapter{regions;async getRefNames(){return(await this.getRegions()).map((e=>e.refName))}async getRegions(){if(this.regions)return this.regions;const e=r.readConfObject(this.config,"assemblyId");if(!TR){const t=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!t)throw new Error("No Apollo data store found");const n=t.getBackendDriver(e),r=await n.getRegions(e);return this.regions=r,r}const t=await new Promise(((t,n)=>{const r=setTimeout((()=>{n("timeout")}),2e4),a=KN(),o=e=>{const{data:n}=e;OR(n)&&n.messageId===a&&(clearTimeout(r),removeEventListener("message",o),t(n.regions))};addEventListener("message",o),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getRegions",assembly:e,messageId:a})}));return this.regions=t,t}getFeatures(e){const{end:t,refName:n,start:a}=e,o=r.readConfObject(this.config,"assemblyId"),i={...e,assemblyName:o};return x.ObservableCreate((async e=>{if(!TR){const r=this.pluginManager?.rootModel?.session?.apolloDataStore;if(!r)return void e.error("No Apollo data store found");const s=r.getBackendDriver(o),l=(await s.getRegions(i.assemblyName)).find((e=>e.refName===i.refName));if(!l)return void e.error("Cannot get region");i.end>l.end&&(i.end=l.end);const{seq:c}=await s.getSequence(i);return e.next(new CR({id:`${n} ${a}-${t}`,data:{refName:n,start:a,end:t,seq:c}})),void e.complete()}const r=await new Promise(((e,t)=>{const n=setTimeout((()=>{t("timeout")}),2e4),r=KN(),a=t=>{const{data:o}=t;OR(o)&&o.messageId===r&&(clearTimeout(n),removeEventListener("message",a),e(o.sequence))};addEventListener("message",a),globalThis.rpcServer.emit("apollo",{apollo:!0,method:"getSequence",region:i,messageId:r})}));e.next(new CR({id:`${n} ${a}-${t}`,data:{refName:n,start:a,end:t,seq:r}})),e.complete()}))}freeResources(){}}var RR=r.ConfigurationSchema("ApolloSequenceAdapter",{assemblyId:{type:"string",defaultValue:""}},{explicitlyTyped:!0}),IR={};Object.defineProperty(IR,"__esModule",{value:!0}),IR.RefSequenceResult=void 0;var PR=function(){function e(t){X(this,e),this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}return ee(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"hasLocation",value:function(){return!!this.locString}},{key:"getLocation",value:function(){return this.locString}},{key:"getComboResults",value:function(){return this.results}}]),e}(),FR=IR.default=PR,MR=function(e){ne(n,e);var t=ue(n);function n(e){var r,a;return X(this,n),(r=t.call(this,e)).refName=null!==(a=e.refName)&&void 0!==a?a:"",r}return ee(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(PR);IR.RefSequenceResult=MR;class jR extends w.BaseAdapter{get baseURL(){return r.readConfObject(this.config,"baseURL").uri}get trackId(){return r.readConfObject(this.config,"trackId")}get assemblyNames(){return r.readConfObject(this.config,"assemblyNames")}mapBaseResult(e,t,n){return e.map((e=>{const r=t.getCanonicalRefName(e.refSeq);return new FR({label:n,trackId:this.trackId,locString:`${r}:${e.min+1}..${e.max}`})}))}async searchIndex(e){const t=e.queryString,n=[],r=this.pluginManager?.rootModel?.session;if(!r)return n;const{apolloDataStore:a}=r,{assemblyManager:o}=r;for(const r of this.assemblyNames){const i=a.getBackendDriver(r),s=o.get(r);if(!i||!s)continue;const l=await i.searchFeatures(e.queryString,[r]);n.push(...this.mapBaseResult(l,s,t))}return n}freeResources(){}}var DR=r.ConfigurationSchema("ApolloTextSearchAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"},trackId:{type:"string",defaultValue:""},baseURL:{type:"fileLocation",defaultValue:{uri:"",locationType:"UriLocation"}}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),LR={},qR=Cc.exports;Object.defineProperty(LR,"__esModule",{value:!0});var BR=LR.default=void 0;BR=LR.default=(0,qR(Oc).default)((0,T.default.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var UR={},zR=Cc.exports;Object.defineProperty(UR,"__esModule",{value:!0});var GR=UR.default=void 0;GR=UR.default=(0,zR(Oc).default)((0,T.default.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");var HR={},$R=Cc.exports;Object.defineProperty(HR,"__esModule",{value:!0});var WR=HR.default=void 0;WR=HR.default=(0,$R(Oc).default)((0,T.default.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreHoriz");const VR=f.makeStyles()((e=>({attributeKey:{fontWeight:"bold",marginRight:e.spacing(2)}})));function JR({attributeKey:e}){const{classes:t}=VR(),n=/^[A-Z]/.test(e);let r,a=e;return tr.isGFFInternalAttribute(e)?(a=tr.internalToGFF[e],r=`On GFF3 export, this will be assigned to the GFF3's reserved "${a}" attribute`):tr.isGFFColumnInternal(e)?(a=tr.gffInternalToColumn[e],r=`On GFF3 export, this will be placed in the GFF3's "${a}" column`):n&&(r="On GFF3 export, this attribute will be changed to start with a lower-case letter because attributes starting with an upper-case letter are reserved in GFF3"),R.default.createElement("div",{style:{display:"flex"}},R.default.createElement(c.Typography,{className:t.attributeKey},a),r?R.default.createElement(c.Tooltip,{title:r},R.default.createElement(c.Chip,{icon:R.default.createElement(ip,null),label:"GFF3",size:"small",variant:"outlined"})):null)}const YR="Custom",KR={[YR]:"custom"};for(const[e,t]of Object.entries(tr.gffToInternal))KR[`GFF ${t}`]=e;for(const[e,t]of Object.entries(tr.gffColumnToInternal))KR[`GFF ${t}`]=e;const ZR=p.observer((function({setKey:e,session:t}){const{pluginManager:r}=n.getEnv(t),a=r.evaluateExtensionPoint("Apollo-ReservedAttributeKeys",KR),o=Object.keys(a).at(0)??YR,[i,s]=u.useState(o),[l,f]=u.useState(),d=i===YR;return R.default.createElement("form",{onSubmit:function(t){t.preventDefault(),e(d?l:a[i])}},R.default.createElement("div",{style:{display:"flex",flexDirection:"column",margin:8}},R.default.createElement(c.FormControl,{variant:"outlined"},R.default.createElement(c.InputLabel,{id:"attribute-key-select-label"},"Key"),R.default.createElement(c.Select,{labelId:"attribute-key-select-label",value:i,label:"Key",onChange:e=>{s(e.target.value)}},Object.keys(a).map((e=>R.default.createElement(c.MenuItem,{key:e,value:e},e))))),d?R.default.createElement(c.TextField,{label:"Attribute key",variant:"outlined",id:"attributeKey",onChange:e=>{f(e.target.value)}}):null),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{color:"primary",variant:"contained",type:"submit",disabled:d&&!l},"Add"),R.default.createElement(c.Button,{variant:"outlined",onClick:function(){e()}},"Cancel")))}));var XR={},QR=Cc.exports;Object.defineProperty(XR,"__esModule",{value:!0});var eI=XR.default=void 0;eI=XR.default=(0,QR(Oc).default)((0,T.default.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddBox");const tI=p.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,l]=u.useState(null);return u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),R.default.createElement(c.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{r!==String(t)&&e(r)},inputRef:e=>{l(e)}})})),nI=p.observer((function({attributeValues:e,setAttribute:t,isNew:n=!1}){const[r,a]=u.useState(e&&e.length>0?e:[""]);return R.default.createElement(R.default.Fragment,null,r.map(((e,t)=>R.default.createElement("div",{key:`${t}-${e}`,style:{display:"flex"}},R.default.createElement(tI,{value:e,onChangeCommitted:e=>{!function(e,t){a((n=>{const r=[...n];return r[e]=t,r}))}(t,e)},variant:"outlined",fullWidth:!0}),R.default.createElement(c.IconButton,{"aria-label":"delete",size:"medium",edge:"end",onClick:()=>{!function(e){a((t=>{const n=[...t];return n.splice(e,1),n}))}(t)}},R.default.createElement(HN,{fontSize:"inherit"}))))),R.default.createElement(c.IconButton,{"aria-label":"add",size:"medium",color:"secondary",edge:"start",onClick:function(){a((e=>{const t=[...e];return t.push(""),t}))}},R.default.createElement(eI,{fontSize:"inherit"})),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{color:"primary",variant:"contained",onClick:()=>{t(r.filter(Boolean))}},n?"Add":"Update"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:()=>{t()}},"Cancel")))}));function rI({values:e}){return R.default.createElement(R.default.Fragment,null,e?.map(((e,t)=>R.default.createElement(c.Typography,{key:`${t}.${e}`,variant:"body2",color:"textSecondary"},e))))}const aI=f.makeStyles()((e=>({list:{"li:nth-of-type(odd)":{backgroundColor:e.palette.action.focus},"li:nth-of-type(even)":{backgroundColor:e.palette.action.hover}}}))),oI=p.observer((function({assembly:e,editable:t,feature:r,session:a}){const{pluginManager:o}=n.getEnv(a),{classes:i}=aI(),[f,d]=u.useState(null),[p,h]=u.useState(null),[m,g]=u.useState(null),[y,v]=u.useState(!1),[b,_]=u.useState(),w=Boolean(f),{changeManager:x}=a.apolloDataStore,{notify:S}=a;function E(){d(null),h(null)}const{_id:k,attributes:A}=r,C=o.evaluateExtensionPoint("Apollo-AttributeEditorComponent",nI,{key:b});return R.default.createElement(R.default.Fragment,null,R.default.createElement(c.List,{className:i.list},s.entries(A).map((([n,i])=>{const s=o.evaluateExtensionPoint("Apollo-AttributeEditorComponent",nI,{key:n}),u=o.evaluateExtensionPoint("Apollo-AttributeViewerComponent",rI,{key:n});return R.default.createElement(c.ListItem,{key:n,secondaryAction:t&&!m?R.default.createElement(c.IconButton,{edge:"end",onClick:e=>{!function(e,t){d(e.currentTarget),h(t)}(e,n)}},R.default.createElement(WR,null)):null},R.default.createElement(c.ListItemText,{disableTypography:!0,primary:R.default.createElement(JR,{attributeKey:n}),secondary:m===n?R.default.createElement(s,{session:a,attributeValues:i,setAttribute:t=>{g(null),t&&function(t,n){const a={...l.getSnapshot(A)},o=structuredClone(a);if(!(t in a))return void S(`"${t}" not found in feature attributes`,"error");if(a[t].toString()===n.toString())return;a[t]=n;const i=new tr.FeatureAttributeChange({changedIds:[r._id],typeName:"FeatureAttributeChange",assembly:e,featureId:r._id,oldAttributes:o,newAttributes:a});x.submit(i)}(n,t)}}):R.default.createElement(u,{values:i})}))})),b?R.default.createElement(c.ListItem,null,R.default.createElement(c.ListItemText,{disableTypography:!0,primary:R.default.createElement(JR,{attributeKey:b}),secondary:R.default.createElement(C,{session:a,attributeValues:[],setAttribute:t=>{t&&function(t,n){const a={...l.getSnapshot(A)},o=structuredClone(a);if(t in a)return void S(`Feature already has attribute "${t}"`,"error");a[t]=n;const i=new tr.FeatureAttributeChange({changedIds:[r._id],typeName:"FeatureAttributeChange",assembly:e,featureId:r._id,oldAttributes:o,newAttributes:a});x.submit(i)}(b,t),_(void 0)},isNew:!0})})):null),t?R.default.createElement(c.Button,{color:"primary",variant:"contained",disabled:y||Boolean(b),onClick:()=>{v(!0)}},"Add new"):null,y?R.default.createElement(c.Paper,{variant:"outlined",style:{marginTop:8}},R.default.createElement(ZR,{session:a,setKey:e=>{_(e),v(!1)}})):null,R.default.createElement(c.Menu,{anchorEl:f,open:w,onClose:E},R.default.createElement(c.MenuItem,{onClick:function(){p&&function(t){const n=l.getSnapshot(A),{[t]:r,...a}=n,o=new tr.FeatureAttributeChange({changedIds:[k],typeName:"FeatureAttributeChange",assembly:e,featureId:k,oldAttributes:n,newAttributes:a});x.submit(o)}(p),E()}},R.default.createElement(c.ListItemIcon,null,R.default.createElement(HN,{fontSize:"small"})),R.default.createElement(c.Typography,{variant:"inherit"},"Delete")),R.default.createElement(c.MenuItem,{onClick:function(){p&&g(p),E()}},R.default.createElement(c.ListItemIcon,null,R.default.createElement(GR,{fontSize:"small"})),R.default.createElement(c.Typography,{variant:"inherit"},"Edit"))))})),iI=p.observer((function({onChangeCommitted:e,value:t,...n}){const[r,a]=u.useState(String(t)),[o,i]=u.useState(!1),[s,l]=u.useState(null);u.useEffect((()=>{a(String(t))}),[t]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]);const f=Number.isNaN(Number(r));return R.default.createElement(c.TextField,{...n,type:"text",onChange:function(e){a(e.target.value)},value:r,onKeyDown:e=>{"Enter"===e.key?s?.blur():"Escape"===e.key&&(a(String(t)),i(!0))},onBlur:()=>{const n=Number(r);r!==String(t)&&(Number.isNaN(n)?a(String(t)):e(n))},inputRef:e=>{l(e)},error:f,helperText:f?"Not a valid number":void 0})})),sI=p.observer((function({assembly:e,feature:t,session:n}){const[r,a]=u.useState(""),[o,i]=u.useState(""),{_id:s,assemblyId:l,max:f,min:d,strand:p,type:h}=t,m=e=>{n.notify(e.message,"error")},{changeManager:g}=n.apolloDataStore;function y(t){const{value:n}=t.target,r=n?Number(n):void 0,a=new tr.StrandChange({typeName:"StrandChange",changedIds:[s],featureId:s,oldStrand:p,newStrand:r,assembly:e});return g.submit(a)}return R.default.createElement("div",{"data-testid":"basic_information"},R.default.createElement(iI,{margin:"dense",id:"start",label:"Start",fullWidth:!0,variant:"outlined",value:d+1,onChangeCommitted:function(t){t--;const n=new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[s],featureId:s,oldStart:d,newStart:t,assembly:e});return g.submit(n)}}),R.default.createElement(iI,{margin:"dense",id:"end",label:"End",fullWidth:!0,variant:"outlined",value:f,onChangeCommitted:function(t){const n=new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[s],featureId:s,oldEnd:f,newEnd:t,assembly:e});return g.submit(n)}}),R.default.createElement(ON,{session:n,ontologyName:"Sequence Ontology",value:h,filterTerms:kN,fetchValidTerms:async function(e,t,n){const r=await CN(e,t);if(r)return r;i(`Type "${e?.type}" does not have any children in the ontology`)}.bind(null,t),renderInput:e=>R.default.createElement(c.TextField,{...e,label:"Type",variant:"outlined",fullWidth:!0,error:Boolean(o),helperText:o}),onChange:(e,t)=>{t&&function(e){a("");const t=new tr.TypeChange({typeName:"TypeChange",changedIds:[s],featureId:s,oldType:h,newType:e,assembly:l});return g.submit(t)}(t).catch(m)}}),R.default.createElement("label",null,R.default.createElement("input",{type:"radio",value:"1",checked:1===p,onChange:y}),"Positive Strand (+)"),R.default.createElement("label",null,R.default.createElement("input",{type:"radio",value:"-1",checked:-1===p,onChange:y}),"Negative Strand (-)"),R.default.createElement("label",null,R.default.createElement("input",{type:"radio",value:"",checked:void 0===p,onChange:y}),"No Strand Information"),r?R.default.createElement(c.Typography,{color:"error"},r):null)})),lI=p.observer((function(e){const{feature:t,model:n}=e,{children:r,parent:a}=t,o=[];if(r)for(const[,e]of r)o.push(e);return a??o.length>0?R.default.createElement("div",{style:{marginTop:10}},a&&R.default.createElement("div",null,R.default.createElement(c.Typography,{variant:"h6"},"Parent:"),R.default.createElement(c.Button,{variant:"contained",onClick:()=>{n.setFeature(a)}},a.type,Kd(a)," (",a.min,"..",a.max,")")),o.length>0&&R.default.createElement("div",null,R.default.createElement(c.Typography,{variant:"h6"},1===o.length?"Child":"Children",":"),o.map((e=>R.default.createElement("div",{key:e._id,style:{marginBottom:5}},R.default.createElement(c.Button,{variant:"contained",onClick:()=>{n.setFeature(e)}},e.type,Kd(e)," (",e.min,"..",e.max,")")))))):null})),cI=f.makeStyles()({sequence:{width:"100%",resize:"vertical"}}),uI=p.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),{classes:o}=cI();if(!t||!a)return null;const i=a.getByRefName(n);if(!i)return null;const{max:s,min:l}=t;let c=i.getSequence(l,s);return c?c=function(e,t,n,r,a){return`>${t}:${n+1}–${r}\n${e}`}(c,n,l,s):r.apolloDataStore.loadRefSeq([{assemblyName:e,refName:n,start:l,end:s}]),R.default.createElement("div",null,R.default.createElement("textarea",{readOnly:!0,rows:20,className:o.sequence,value:c}))})),fI=f.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),dI=p.observer((function(e){const{model:t}=e,{assembly:r,feature:a,refName:o}=t,i=n.getSession(t),s=i.apolloDataStore.assemblies.get(r),{classes:l}=fI(),[f,d]=u.useState(["attributes"]);if(u.useEffect((()=>{d(["attributes"])}),[a]),!a||!s)return null;const p=s.getByRefName(o);if(!p)return null;const{max:h,min:m}=a;function g(e,t){d(e?[...f,t]:f.filter((e=>e!==t)))}return p.getSequence(m,h)||i.apolloDataStore.loadRefSeq([{assemblyName:r,refName:o,start:m,end:h}]),R.default.createElement("div",{className:l.root},R.default.createElement(sI,{feature:a,session:i,assembly:s._id}),R.default.createElement(c.Accordion,{style:{marginTop:10},expanded:f.includes("attributes"),onChange:(e,t)=>{g(t,"attributes")}},R.default.createElement(c.AccordionSummary,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},R.default.createElement(c.Typography,{component:"span"},"Attributes")),R.default.createElement(c.AccordionDetails,null,R.default.createElement(oI,{feature:a,session:i,assembly:s._id,editable:!0}))),R.default.createElement(c.Accordion,{style:{marginTop:10},expanded:f.includes("sequence"),onChange:(e,t)=>{g(t,"sequence")}},R.default.createElement(c.AccordionSummary,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},R.default.createElement(c.Typography,{component:"span"},"Sequence")),R.default.createElement(c.AccordionDetails,null,f.includes("sequence")&&R.default.createElement(uI,{feature:a,session:i,assembly:s._id,refName:o}))),R.default.createElement(c.Accordion,{style:{marginTop:10},expanded:f.includes("related_features"),onChange:(e,t)=>{g(t,"related_features")}},R.default.createElement(c.AccordionSummary,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},R.default.createElement(c.Typography,{component:"span"},"Related features")),R.default.createElement(c.AccordionDetails,null,R.default.createElement(lI,{model:t,feature:a}))))}));var pI={},hI={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationFeatureModel=void 0;var t=C.default,n=N.default,r=pI,a=n.types.late((function(){return e.AnnotationFeatureModel}));e.AnnotationFeatureModel=n.types.model("AnnotationFeatureModel",{_id:n.types.identifier,refSeq:n.types.string,type:n.types.string,min:n.types.number,max:n.types.number,strand:n.types.maybe(n.types.union(n.types.literal(1),n.types.literal(-1))),children:n.types.maybe(n.types.map(a)),attributes:n.types.map(n.types.array(n.types.string))}).views((function(e){return{get length(){return e.max-e.min},get featureId(){return e.attributes.get("id")},get minWithChildren(){var t=e.min,n=e.children;if(!n)return t;var r,a=_e(n);try{for(a.s();!(r=a.n()).done;){var o=de(r.value,2);t=Math.min(t,o[1].min)}}catch(e){a.e(e)}finally{a.f()}return t},get maxWithChildren(){var t=e.max,n=e.children;if(!n)return t;var r,a=_e(n);try{for(a.s();!(r=a.n()).done;){var o=de(r.value,2);t=Math.max(t,o[1].max)}}catch(e){a.e(e)}finally{a.f()}return t},hasDescendant:function(t){var n=e.children;if(!n)return!1;var r,a=_e(n);try{for(a.s();!(r=a.n()).done;){var o=de(r.value,2);if(o[0]===t)return!0;if(o[1].hasDescendant(t))return!0}}catch(e){a.e(e)}finally{a.f()}return!1},get transcriptExonParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent, cannot calculate exon locations");var r=e.children;if(!r)throw new Error("No exons in transcript");var a,o=he(r.values()).filter((function(e){return n.isTypeOf(e.type,"exon")})).sort((function(e,t){return e.min-t.min})),i=e.min,s=[],l=_e(o);try{for(l.s();!(a=l.n()).done;){var c=a.value;c.min>i&&s.push({min:i,max:c.min,type:"intron"}),s.push({min:c.min,max:c.max,type:"exon"}),i=c.max}}catch(e){l.e(e)}finally{l.f()}return i<e.max&&s.push({min:i,max:e.max,type:"intron"}),-1===e.strand&&s.reverse(),s},get transcriptParts(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n.isTypeOf(e.type,"transcript")&&!n.isTypeOf(e.type,"pseudogenic_transcript"))throw new Error('Only features of type "transcript" or equivalent can calculate CDS locations');var r=e.children;if(!r)throw new Error("no CDS or exons in transcript");var a=he(r.values()).filter((function(e){return n.isTypeOf(e.type,"CDS")})),o=[];if(0===a.length)return o.push(this.transcriptExonParts),o;var i,s=_e(a);try{var l=function(){var a,s=i.value,l=s.max,c=s.min,u=[],f=!1,d=[],p=_e(r);try{for(p.s();!(a=p.n()).done;){var h=de(a.value,2)[1];n.isTypeOf(h.type,"exon")&&d.push({min:h.min,max:h.max})}}catch(e){p.e(e)}finally{p.f()}d.sort((function(e,t){return e.min-t.min}));for(var m=0,g=d;m<g.length;m++){var y=g[m],v=u.at(-1);v&&u.push({min:v.max,max:y.min,type:"intron"});var b,_=de((0,t.intersection2)(c,l,y.min,y.max),2),w=_[0],x=_[1];b=f?1===e.strand?"threePrimeUTR":"fivePrimeUTR":1===e.strand?"fivePrimeUTR":"threePrimeUTR",void 0!==w&&void 0!==x?(f=!0,w===y.min&&x===y.max?u.push({min:w,max:x,phase:0,type:"CDS"}):w===y.min?u.push({min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:b}):x===y.max?u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"}):u.push({min:y.min,max:w,type:b},{min:w,max:x,phase:0,type:"CDS"},{min:x,max:y.max,type:"fivePrimeUTR"===b?"threePrimeUTR":"fivePrimeUTR"})):u.push({min:y.min,max:y.max,type:b})}u.sort((function(e,t){return e.min-t.min})),-1===e.strand&&u.reverse();var S=0,E=u.map((function(e){if("CDS"!==e.type)return e;var t=S;return S=(3-(e.max-e.min-t+3)%3)%3,V(V({},e),{},{phase:t})}));o.push(E)};for(s.s();!(i=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}return o}}})).views((function(e){return{get cdsLocations(){return e.transcriptParts.map((function(e){return e.filter((function(e){return"CDS"===e.type}))}))},get looksLikeGene(){var n=(0,t.getSession)(e).apolloDataStore.ontologyManager.featureTypeOntology;if(!n)return!1;var r=e.children;if(null==r||!r.size)return!1;if(!n.isTypeOf(e.type,"gene")&&!n.isTypeOf(e.type,"pseudogene"))return!1;var a,o=_e(r);try{for(o.s();!(a=o.n()).done;){var i=de(a.value,2)[1];if(n.isTypeOf(i.type,"transcript")||n.isTypeOf(i.type,"pseudogenic_transcript")){var s=i.children;return!(null==s||!s.size)&&he(s.values()).some((function(e){return n.isTypeOf(e.type,"exon")}))}}}catch(e){o.e(e)}finally{o.f()}return!1}}})).actions((function(e){return{setAttributes:function(t){e.attributes.clear();var n,r=_e(t.entries());try{for(r.s();!(n=r.n()).done;){var a=de(n.value,2);e.attributes.set(a[0],a[1])}}catch(e){r.e(e)}finally{r.f()}},setAttribute:function(t,n){e.attributes.merge(te({},t,n))},setType:function(t){e.type=t},setRefSeq:function(t){e.refSeq=t},setMin:function(t){if(t>e.max)throw new Error('Min "'.concat(t+1,'" is greater than max "').concat(e.max,'"'));e.min!==t&&(e.min=t)},setMax:function(t){if(t<e.min)throw new Error('Max "'.concat(t,'" is less than Min "').concat(e.min,'"'));e.max!==t&&(e.max=t)},setStrand:function(t){e.strand=t},addChild:function(t){if(e.children&&e.children.size>0){var r=(0,n.getSnapshot)(e.children);e.children.clear();var a,o=_e(Object.entries(V(V({},r),{},te({},t._id,t))).sort((function(e,t){var n=de(e,2)[1],r=de(t,2);return n.min-r[1].min})));try{for(o.s();!(a=o.n()).done;){var i=de(a.value,2);e.children.put(i[1])}}catch(e){o.e(e)}finally{o.f()}}else{var s;e.children=(0,n.cast)({}),null===(s=e.children)||void 0===s||s.put(t)}},deleteChild:function(t){var n;null===(n=e.children)||void 0===n||n.delete(t)}}})).actions((function(e){return{update:function(t){var r=t.children,a=t.max,o=t.min,i=t.strand;e.setRefSeq(t.refSeq),e.setMin(o),e.setMax(a),e.setStrand(i),r&&(e.children=(0,n.cast)(r))}}})).views((function(t){return{get parent(){var r;try{r=(0,n.getParentOfType)(t,e.AnnotationFeatureModel)}catch(e){}return r},get topLevelFeature(){var r,a=t;do{try{a=r=(0,n.getParentOfType)(a,e.AnnotationFeatureModel)}catch(e){r=void 0}}while(r);return a},get assemblyId(){return(0,n.getParentOfType)(t,r.ApolloAssembly)._id}}}))}(hI);var mI={},gI={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ApolloRefSeq=e.Sequence=void 0;var t=C.default,n=N.default,r=hI;e.Sequence=n.types.model({start:n.types.number,stop:n.types.number,sequence:n.types.string}),e.ApolloRefSeq=n.types.model("ApolloRefSeq",{_id:n.types.identifier,name:n.types.string,description:"",features:n.types.map(r.AnnotationFeatureModel),sequence:n.types.array(e.Sequence)}).actions((function(e){return{addFeature:function(t){e.features.put(t)},deleteFeature:function(t){return e.features.delete(t)},setDescription:function(t){e.description=t},addSequence:function(t){var n;if(t.sequence.length!==t.stop-t.start)throw new Error("sequence does not match declared length: ".concat(JSON.stringify(t)));if(0!==e.sequence.length){var r=e.sequence.map((function(e){return{start:e.start,stop:e.stop,sequence:e.sequence}}));r.push({start:t.start,stop:t.stop,sequence:t.sequence}),r.sort((function(e,t){return e.start===t.start?e.stop-t.stop:e.start-t.start}));var a,o=r.reduce((function(e,t){var n=e.at(-1);if(void 0===n)return[t];if(n.stop>=t.start){if(t.stop>n.stop){var r=n.stop-t.start;n.stop=t.stop,n.sequence+=t.sequence.slice(r)}}else e.push(t);return e}),[]),i=_e(o);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.sequence.length!==s.stop-s.start)throw new Error("Consolidated sequence does not match declared length")}}catch(e){i.e(e)}finally{i.f()}e.sequence.length===o.length&&e.sequence.every((function(e,t){return e.start===o[t].start&&e.stop===o[t].stop}))||(e.sequence.clear(),(n=e.sequence).push.apply(n,he(o)))}else e.sequence.push(t)}}})).views((function(e){return{getSequence:function(n,r){var a,o=_e(e.sequence);try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.sequence,l=i.start;if((0,t.isContainedWithin)(n,r,l,i.stop))return s.slice(n-l,r-l)}}catch(e){o.e(e)}finally{o.f()}return""},getFeatures:function(n,r){var a,o=[],i=_e(e.features);try{for(i.s();!(a=i.n()).done;){var s=de(a.value,2)[1];(0,t.doesIntersect2)(s.min,s.max,n,r)&&o.push(s)}}catch(e){i.e(e)}finally{i.f()}return o}}}))}(gI),Object.defineProperty(mI,"__esModule",{value:!0}),mI.ApolloAssembly=void 0;var yI=N.default;mI.ApolloAssembly=yI.types.model("ApolloAssembly",{_id:yI.types.identifier,refSeqs:yI.types.map(gI.ApolloRefSeq),comments:yI.types.array(yI.types.string),backendDriverType:yI.types.optional(yI.types.enumeration("backendDriverType",["CollaborationServerDriver","InMemoryFileDriver","DesktopFileDriver"]),"CollaborationServerDriver")}).views((function(e){return{getByRefName:function(t){return he(e.refSeqs.values()).find((function(e){return e.name===t}))}}})).actions((function(e){return{addRefSeq:function(t,n,r){return e.refSeqs.put({_id:t,name:n,description:r})},addComment:function(t){return e.comments.push(t)}}}));var vI={};Object.defineProperty(vI,"__esModule",{value:!0}),vI.CheckResult=void 0;var bI=N.default;vI.CheckResult=bI.types.model("CheckResult",{_id:bI.types.identifier,name:bI.types.string,cause:bI.types.string,ids:bI.types.array(bI.types.safeReference(hI.AnnotationFeatureModel)),refSeq:bI.types.string,start:bI.types.number,end:bI.types.number,ignored:!1,message:bI.types.string}),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Qe;t.__exportStar(hI,e),t.__exportStar(mI,e),t.__exportStar(gI,e),t.__exportStar(vI,e)}(pI);const _I=l.types.model("ApolloFeatureDetailsWidget",{id:h.ElementId,type:l.types.literal("ApolloFeatureDetailsWidget"),feature:l.types.maybe(l.types.reference(pI.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:l.types.string,refName:l.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}}))),wI=l.types.model("ApolloTranscriptDetails",{id:h.ElementId,type:l.types.literal("ApolloTranscriptDetails"),feature:l.types.maybe(l.types.reference(pI.AnnotationFeatureModel,{onInvalidated(e){e.parent.setTryReload(e.invalidId),e.removeRef()}})),assembly:l.types.string,refName:l.types.string}).volatile((()=>({tryReload:void 0}))).actions((e=>({setFeature(t){e.feature=t},setTryReload(t){e.tryReload=t}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((t=>{if(!e.tryReload)return;const r=n.getSession(e),{apolloDataStore:a}=r;if(!a)return;const o=a.getFeature(e.tryReload);o&&(e.setFeature(o),e.setTryReload(),t.dispose())})))}})));function xI(){return xI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},xI.apply(this,arguments)}function SI(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}var EI=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,kI=SI((function(e){return EI.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),AI=function(){function e(e){var t=this;this._insertTag=function(e){t.container.insertBefore(e,0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling),t.tags.push(e)},this.isSpeedy=void 0===e.speedy?"production"===Lt.env.NODE_ENV:e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if("production"!==Lt.env.NODE_ENV){var n=64===e.charCodeAt(0)&&105===e.charCodeAt(1);n&&this._alreadyInsertedOrderInsensitiveRule&&console.error("You're attempting to insert the following rule:\n"+e+"\n\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules."),this._alreadyInsertedOrderInsensitiveRule=this._alreadyInsertedOrderInsensitiveRule||!n}if(this.isSpeedy){var r=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{r.insertRule(e,r.cssRules.length)}catch(t){"production"===Lt.env.NODE_ENV||/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(e)||console.error('There was a problem inserting the following rule: "'+e+'"',t)}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0,"production"!==Lt.env.NODE_ENV&&(this._alreadyInsertedOrderInsensitiveRule=!1)},e}(),CI="-ms-",OI="-moz-",TI="-webkit-",NI="comm",RI="rule",II="decl",PI="@keyframes",FI=Math.abs,MI=String.fromCharCode,jI=Object.assign;function DI(e){return e.trim()}function LI(e,t,n){return e.replace(t,n)}function qI(e,t){return e.indexOf(t)}function BI(e,t){return 0|e.charCodeAt(t)}function UI(e,t,n){return e.slice(t,n)}function zI(e){return e.length}function GI(e){return e.length}function HI(e,t){return t.push(e),e}var $I=1,WI=1,VI=0,JI=0,YI=0,KI="";function ZI(e,t,n,r,a,o,i){return{value:e,root:t,parent:n,type:r,props:a,children:o,line:$I,column:WI,length:i,return:""}}function XI(e,t){return jI(ZI("",null,null,"",null,null,0),e,{length:-e.length},t)}function QI(){return YI=JI>0?BI(KI,--JI):0,WI--,10===YI&&(WI=1,$I--),YI}function eP(){return YI=JI<VI?BI(KI,JI++):0,WI++,10===YI&&(WI=1,$I++),YI}function tP(){return BI(KI,JI)}function nP(){return JI}function rP(e,t){return UI(KI,e,t)}function aP(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function oP(e){return $I=WI=1,VI=zI(KI=e),JI=0,[]}function iP(e){return KI="",e}function sP(e){return DI(rP(JI-1,uP(91===e?e+2:40===e?e+1:e)))}function lP(e){for(;(YI=tP())&&YI<33;)eP();return aP(e)>2||aP(YI)>3?"":" "}function cP(e,t){for(;--t&&eP()&&!(YI<48||YI>102||YI>57&&YI<65||YI>70&&YI<97););return rP(e,nP()+(t<6&&32==tP()&&32==eP()))}function uP(e){for(;eP();)switch(YI){case e:return JI;case 34:case 39:34!==e&&39!==e&&uP(YI);break;case 40:41===e&&uP(e);break;case 92:eP()}return JI}function fP(e,t){for(;eP()&&e+YI!==57&&(e+YI!==84||47!==tP()););return"/*"+rP(t,JI-1)+"*"+MI(47===e?e:eP())}function dP(e){for(;!aP(tP());)eP();return rP(e,JI)}function pP(e){return iP(hP("",null,null,null,[""],e=oP(e),0,[0],e))}function hP(e,t,n,r,a,o,i,s,l){for(var c=0,u=0,f=i,d=0,p=0,h=0,m=1,g=1,y=1,v=0,b="",_=a,w=o,x=r,S=b;g;)switch(h=v,v=eP()){case 40:if(108!=h&&58==BI(S,f-1)){-1!=qI(S+=LI(sP(v),"&","&\f"),"&\f")&&(y=-1);break}case 34:case 39:case 91:S+=sP(v);break;case 9:case 10:case 13:case 32:S+=lP(h);break;case 92:S+=cP(nP()-1,7);continue;case 47:switch(tP()){case 42:case 47:HI(gP(fP(eP(),nP()),t,n),l);break;default:S+="/"}break;case 123*m:s[c++]=zI(S)*y;case 125*m:case 59:case 0:switch(v){case 0:case 125:g=0;case 59+u:-1==y&&(S=LI(S,/\f/g,"")),p>0&&zI(S)-f&&HI(p>32?yP(S+";",r,n,f-1):yP(LI(S," ","")+";",r,n,f-2),l);break;case 59:S+=";";default:if(HI(x=mP(S,t,n,c,u,a,s,b,_=[],w=[],f),o),123===v)if(0===u)hP(S,t,x,x,_,o,f,s,w);else switch(99===d&&110===BI(S,3)?100:d){case 100:case 108:case 109:case 115:hP(e,x,x,r&&HI(mP(e,x,x,0,0,a,s,b,a,_=[],f),w),a,w,f,s,r?_:w);break;default:hP(S,x,x,x,[""],w,0,s,w)}}c=u=p=0,m=y=1,b=S="",f=i;break;case 58:f=1+zI(S),p=h;default:if(m<1)if(123==v)--m;else if(125==v&&0==m++&&125==QI())continue;switch(S+=MI(v),v*m){case 38:y=u>0?1:(S+="\f",-1);break;case 44:s[c++]=(zI(S)-1)*y,y=1;break;case 64:45===tP()&&(S+=sP(eP())),d=tP(),u=f=zI(b=S+=dP(nP())),v++;break;case 45:45===h&&2==zI(S)&&(m=0)}}return o}function mP(e,t,n,r,a,o,i,s,l,c,u){for(var f=a-1,d=0===a?o:[""],p=GI(d),h=0,m=0,g=0;h<r;++h)for(var y=0,v=UI(e,f+1,f=FI(m=i[h])),b=e;y<p;++y)(b=DI(m>0?d[y]+" "+v:LI(v,/&\f/g,d[y])))&&(l[g++]=b);return ZI(e,t,n,0===a?RI:s,l,c,u)}function gP(e,t,n){return ZI(e,t,n,NI,MI(YI),UI(e,2,-2),0)}function yP(e,t,n,r){return ZI(e,t,n,II,UI(e,0,r),UI(e,r+1,-1),r)}function vP(e,t){for(var n="",r=GI(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function bP(e,t,n,r){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case II:return e.return=e.return||e.value;case NI:return"";case PI:return e.return=e.value+"{"+vP(e.children,r)+"}";case RI:e.value=e.props.join(",")}return zI(n=vP(e.children,r))?e.return=e.value+"{"+n+"}":""}var _P=function(e,t,n){for(var r=0,a=0;r=a,a=tP(),38===r&&12===a&&(t[n]=1),!aP(a);)eP();return rP(e,JI)},wP=new WeakMap,xP=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||wP.get(n))&&!r){wP.set(e,!0);for(var a=[],o=function(e,t){return iP(function(e,t){var n=-1,r=44;do{switch(aP(r)){case 0:38===r&&12===tP()&&(t[n]=1),e[n]+=_P(JI-1,t,n);break;case 2:e[n]+=sP(r);break;case 4:if(44===r){e[++n]=58===tP()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=MI(r)}}while(r=eP());return e}(oP(e),t))}(t,a),i=n.props,s=0,l=0;s<o.length;s++)for(var c=0;c<i.length;c++,l++)e.props[l]=a[s]?o[s].replace(/&\f/g,i[c]):i[c]+" "+o[s]}}},SP=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},EP=function(e){return"comm"===e.type&&e.children.indexOf("emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason")>-1},kP=function(e){return 105===e.type.charCodeAt(1)&&64===e.type.charCodeAt(0)},AP=function(e){e.type="",e.value="",e.return="",e.children="",e.props=""},CP=function(e,t,n){kP(e)&&(e.parent?(console.error("`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles."),AP(e)):function(e,t){for(var n=e-1;n>=0;n--)if(!kP(t[n]))return!0;return!1}(t,n)&&(console.error("`@import` rules can't be after other rules. Please put your `@import` rules before your other rules."),AP(e)))};function OP(e,t){switch(function(e,t){return 45^BI(e,0)?(((t<<2^BI(e,0))<<2^BI(e,1))<<2^BI(e,2))<<2^BI(e,3):0}(e,t)){case 5103:return TI+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return TI+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return TI+e+OI+e+CI+e+e;case 6828:case 4268:return TI+e+CI+e+e;case 6165:return TI+e+CI+"flex-"+e+e;case 5187:return TI+e+LI(e,/(\w+).+(:[^]+)/,TI+"box-$1$2"+CI+"flex-$1$2")+e;case 5443:return TI+e+CI+"flex-item-"+LI(e,/flex-|-self/,"")+e;case 4675:return TI+e+CI+"flex-line-pack"+LI(e,/align-content|flex-|-self/,"")+e;case 5548:return TI+e+CI+LI(e,"shrink","negative")+e;case 5292:return TI+e+CI+LI(e,"basis","preferred-size")+e;case 6060:return TI+"box-"+LI(e,"-grow","")+TI+e+CI+LI(e,"grow","positive")+e;case 4554:return TI+LI(e,/([^-])(transform)/g,"$1"+TI+"$2")+e;case 6187:return LI(LI(LI(e,/(zoom-|grab)/,TI+"$1"),/(image-set)/,TI+"$1"),e,"")+e;case 5495:case 3959:return LI(e,/(image-set\([^]*)/,TI+"$1$`$1");case 4968:return LI(LI(e,/(.+:)(flex-)?(.*)/,TI+"box-pack:$3"+CI+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+TI+e+e;case 4095:case 3583:case 4068:case 2532:return LI(e,/(.+)-inline(.+)/,TI+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(zI(e)-1-t>6)switch(BI(e,t+1)){case 109:if(45!==BI(e,t+4))break;case 102:return LI(e,/(.+:)(.+)-([^]+)/,"$1"+TI+"$2-$3$1"+OI+(108==BI(e,t+3)?"$3":"$2-$3"))+e;case 115:return~qI(e,"stretch")?OP(LI(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==BI(e,t+1))break;case 6444:switch(BI(e,zI(e)-3-(~qI(e,"!important")&&10))){case 107:return LI(e,":",":"+TI)+e;case 101:return LI(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+TI+(45===BI(e,14)?"inline-":"")+"box$3$1"+TI+"$2$3$1"+CI+"$2box$3")+e}break;case 5936:switch(BI(e,t+11)){case 114:return TI+e+CI+LI(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return TI+e+CI+LI(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return TI+e+CI+LI(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return TI+e+CI+e+e}return e}var TP=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case II:e.return=OP(e.value,e.length);break;case PI:return vP([XI(e,{value:LI(e.value,"@","@"+TI)})],r);case RI:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=/(::plac\w+|:read-\w+)/.exec(e))?e[0]:e}(t)){case":read-only":case":read-write":return vP([XI(e,{props:[LI(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return vP([XI(e,{props:[LI(t,/:(plac\w+)/,":"+TI+"input-$1")]}),XI(e,{props:[LI(t,/:(plac\w+)/,":-moz-$1")]}),XI(e,{props:[LI(t,/:(plac\w+)/,CI+"input-$1")]})],r)}return""}))}}],NP=function(e){var t=e.key;if("production"!==Lt.env.NODE_ENV&&!t)throw new Error("You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\nIf multiple caches share the same key they might \"fight\" for each other's style elements.");if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||TP;if("production"!==Lt.env.NODE_ENV&&/[^a-z-]/.test(t))throw new Error('Emotion key must only contain lower case alphabetical characters and - but "'+t+'" was passed');var a,o,i={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)i[t[n]]=!0;s.push(e)}));var l=[xP,SP];"production"!==Lt.env.NODE_ENV&&l.push(function(e){return function(t,n,r){if("rule"===t.type&&!e.compat){var a=t.value.match(/(:first|:nth|:nth-last)-child/g);if(a){for(var o=t.parent?t.parent.children:r,i=o.length-1;i>=0;i--){var s=o[i];if(s.line<t.line)break;if(s.column<t.column){if(EP(s))return;break}}a.forEach((function(e){console.error('The pseudo class "'+e+'" is potentially unsafe when doing server-side rendering. Try changing it to "'+e.split("-child")[0]+'-of-type".')}))}}}}({get compat(){return p.compat}}),CP);var c,u,f=[bP,"production"!==Lt.env.NODE_ENV?function(e){e.root||(e.return?c.insert(e.return):e.value&&e.type!==NI&&c.insert(e.value+"{}"))}:(u=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&u(e)})],d=function(e){var t=GI(e);return function(n,r,a,o){for(var i="",s=0;s<t;s++)i+=e[s](n,r,a,o)||"";return i}}(l.concat(r,f));o=function(e,t,n,r){c=n,"production"!==Lt.env.NODE_ENV&&void 0!==t.map&&(c={insert:function(e){n.insert(e+t.map)}}),vP(pP(e?e+"{"+t.styles+"}":t.styles),d),r&&(p.inserted[t.name]=!0)};var p={key:t,sheet:new AI({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:i,registered:{},insert:o};return p.sheet.hydrate(s),p};function RP(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var IP=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},PP=function(e,t,n){IP(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}},FP={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},MP="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",jP=/[A-Z]|^ms/g,DP=/_EMO_([^_]+?)_([^]*?)_EMO_/g,LP=function(e){return 45===e.charCodeAt(1)},qP=function(e){return null!=e&&"boolean"!=typeof e},BP=SI((function(e){return LP(e)?e:e.replace(jP,"-$&").toLowerCase()})),UP=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(DP,(function(e,t,n){return ZP={name:t,styles:n,next:ZP},t}))}return 1===FP[e]||LP(e)||"number"!=typeof t||0===t?t:t+"px"};if("production"!==Lt.env.NODE_ENV){var zP=/(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\(|(no-)?(open|close)-quote/,GP=["normal","none","initial","inherit","unset"],HP=UP,$P=/^-ms-/,WP=/-(.)/g,VP={};UP=function(e,t){if("content"===e&&("string"!=typeof t||-1===GP.indexOf(t)&&!zP.test(t)&&(t.charAt(0)!==t.charAt(t.length-1)||'"'!==t.charAt(0)&&"'"!==t.charAt(0))))throw new Error("You seem to be using a value for 'content' without quotes, try replacing it with `content: '\""+t+"\"'`");var n=HP(e,t);return""===n||LP(e)||-1===e.indexOf("-")||void 0!==VP[e]||(VP[e]=!0,console.error("Using kebab-case for css properties in objects is not supported. Did you mean "+e.replace($P,"ms-").replace(WP,(function(e,t){return t.toUpperCase()}))+"?")),n}}var JP="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function YP(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles){if("production"!==Lt.env.NODE_ENV&&"NO_COMPONENT_SELECTOR"===n.toString())throw new Error(JP);return n}switch(Y(n)){case"boolean":return"";case"object":if(1===n.anim)return ZP={name:n.name,styles:n.styles,next:ZP},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)ZP={name:r.name,styles:r.styles,next:ZP},r=r.next;var a=n.styles+";";return"production"!==Lt.env.NODE_ENV&&void 0!==n.map&&(a+=n.map),a}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=YP(e,t,n[a])+";";else for(var o in n){var i=n[o];if("object"!==Y(i))null!=t&&void 0!==t[i]?r+=o+"{"+t[i]+"}":qP(i)&&(r+=BP(o)+":"+UP(o,i)+";");else{if("NO_COMPONENT_SELECTOR"===o&&"production"!==Lt.env.NODE_ENV)throw new Error(JP);if(!Array.isArray(i)||"string"!=typeof i[0]||null!=t&&void 0!==t[i[0]]){var s=YP(e,t,i);switch(o){case"animation":case"animationName":r+=BP(o)+":"+s+";";break;default:"production"!==Lt.env.NODE_ENV&&"undefined"===o&&console.error("You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key)."),r+=o+"{"+s+"}"}}else for(var l=0;l<i.length;l++)qP(i[l])&&(r+=BP(o)+":"+UP(o,i[l])+";")}}return r}(e,t,n);case"function":if(void 0!==e){var o=ZP,i=n(e);return ZP=o,YP(e,t,i)}"production"!==Lt.env.NODE_ENV&&console.error("Functions that are interpolated in css calls will be stringified.\nIf you want to have a css call based on props, create a function that returns a css call like this\nlet dynamicStyle = (props) => css`color: ${props.color}`\nIt can be called directly with props or interpolated in a styled call like this\nlet SomeComponent = styled('div')`${dynamicStyle}`");break;case"string":if("production"!==Lt.env.NODE_ENV){var s=[],l=n.replace(DP,(function(e,t,n){var r="animation"+s.length;return s.push("const "+r+" = keyframes`"+n.replace(/^@keyframes animation-\w+/,"")+"`"),"${"+r+"}"}));s.length&&console.error("`keyframes` output got interpolated into plain string, please wrap it with `css`.\n\nInstead of doing this:\n\n"+[].concat(s,["`"+l+"`"]).join("\n")+"\n\nYou should wrap it with `css` like this:\n\ncss`"+l+"`")}}if(null==t)return n;var c=t[n];return void 0!==c?c:n}var KP,ZP,XP=/label:\s*([^\s;\n{]+)\s*(;|$)/g;"production"!==Lt.env.NODE_ENV&&(KP=/\/\*#\ssourceMappingURL=data:application\/json;\S+\s+\*\//g);var QP=function(e,t,n){if(1===e.length&&"object"===Y(e[0])&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";ZP=void 0;var o,i=e[0];null==i||void 0===i.raw?(r=!1,a+=YP(n,t,i)):("production"!==Lt.env.NODE_ENV&&void 0===i[0]&&console.error(MP),a+=i[0]);for(var s=1;s<e.length;s++)a+=YP(n,t,e[s]),r&&("production"!==Lt.env.NODE_ENV&&void 0===i[s]&&console.error(MP),a+=i[s]);"production"!==Lt.env.NODE_ENV&&(a=a.replace(KP,(function(e){return o=e,""}))),XP.lastIndex=0;for(var l,c="";null!==(l=XP.exec(a));)c+="-"+l[1];var u=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(a)+c;return"production"!==Lt.env.NODE_ENV?{name:u,styles:a,map:o,next:ZP,toString:function(){return"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop)."}}:{name:u,styles:a,next:ZP}},eF=!!I.useInsertionEffect&&I.useInsertionEffect||function(e){return e()},tF={}.hasOwnProperty,nF=I.createContext("undefined"!=typeof HTMLElement?NP({key:"css"}):null);"production"!==Lt.env.NODE_ENV&&(nF.displayName="EmotionCacheContext");var rF=function(e){return u.forwardRef((function(t,n){var r=u.useContext(nF);return e(t,r,n)}))},aF=I.createContext({});"production"!==Lt.env.NODE_ENV&&(aF.displayName="EmotionThemeContext");var oF="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",iF="__EMOTION_LABEL_PLEASE_DO_NOT_USE__",sF=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return IP(t,n,r),eF((function(){return PP(t,n,r)})),null},lF=rF((function(e,t,n){var r=e.css;"string"==typeof r&&void 0!==t.registered[r]&&(r=t.registered[r]);var a=e[oF],o=[r],i="";"string"==typeof e.className?i=RP(t.registered,o,e.className):null!=e.className&&(i=e.className+" ");var s=QP(o,void 0,I.useContext(aF));if("production"!==Lt.env.NODE_ENV&&-1===s.name.indexOf("-")){var l=e[iF];l&&(s=QP([s,"label:"+l+";"]))}i+=t.key+"-"+s.name;var c={};for(var u in e)!tF.call(e,u)||"css"===u||u===oF||"production"!==Lt.env.NODE_ENV&&u===iF||(c[u]=e[u]);return c.ref=n,c.className=i,I.createElement(I.Fragment,null,I.createElement(sF,{cache:t,serialized:s,isStringTag:"string"==typeof a}),I.createElement(a,c))}));"production"!==Lt.env.NODE_ENV&&(lF.displayName="EmotionCssPropInternal");var cF=kI,uF=function(e){return"theme"!==e},fF=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?cF:uF},dF=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!=typeof r&&n&&(r=e.__emotion_forwardProp),r},pF="You have illegal escape sequence in your template literal, most likely inside content's property value.\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \"content: '\\00d7';\" should become \"content: '\\\\00d7';\".\nYou can read more about this here:\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences",hF=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;return IP(t,n,r),eF((function(){return PP(t,n,r)})),null},mF=function e(t,n){if("production"!==Lt.env.NODE_ENV&&void 0===t)throw new Error("You are trying to create a styled element with an undefined component.\nYou may have forgotten to import it.");var r,a,o=t.__emotion_real===t,i=o&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var s=dF(t,n,o),l=s||fF(i),c=!l("as");return function(){var u=arguments,f=o&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&f.push("label:"+r+";"),null==u[0]||void 0===u[0].raw)f.push.apply(f,u);else{"production"!==Lt.env.NODE_ENV&&void 0===u[0][0]&&console.error(pF),f.push(u[0][0]);for(var d=u.length,p=1;p<d;p++)"production"!==Lt.env.NODE_ENV&&void 0===u[0][p]&&console.error(pF),f.push(u[p],u[0][p])}var h=rF((function(e,t,n){var r=c&&e.as||i,o="",u=[],d=e;if(null==e.theme){for(var p in d={},e)d[p]=e[p];d.theme=I.useContext(aF)}"string"==typeof e.className?o=RP(t.registered,u,e.className):null!=e.className&&(o=e.className+" ");var h=QP(f.concat(u),t.registered,d);o+=t.key+"-"+h.name,void 0!==a&&(o+=" "+a);var m=c&&void 0===s?fF(r):l,g={};for(var y in e)c&&"as"===y||m(y)&&(g[y]=e[y]);return g.className=o,g.ref=n,I.createElement(I.Fragment,null,I.createElement(hF,{cache:t,serialized:h,isStringTag:"string"==typeof r}),I.createElement(r,g))}));return h.displayName=void 0!==r?r:"Styled("+("string"==typeof i?i:i.displayName||i.name||"Component")+")",h.defaultProps=t.defaultProps,h.__emotion_real=h,h.__emotion_base=i,h.__emotion_styles=f,h.__emotion_forwardProp=s,Object.defineProperty(h,"toString",{value:function(){return void 0===a&&"production"!==Lt.env.NODE_ENV?"NO_COMPONENT_SELECTOR":"."+a}}),h.withComponent=function(t,r){return e(t,xI({},n,r,{shouldForwardProp:dF(h,r,!0)})).apply(void 0,f)},h}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){mF[e]=mF(e)}));const gF=60;function yF(e,t,r){const a=[],{cdsLocations:o,strand:i,transcriptParts:s}=t;switch(e){case"genomic":case"cDNA":{const[t]=s;for(const o of t){if("cDNA"===e&&"intron"===o.type)continue;let t=r(o.min,o.max);-1===i&&(t=n.revcom(t));const s="fivePrimeUTR"===o.type||"threePrimeUTR"===o.type?"UTR":o.type,l=a.at(-1);if(l)if(l.type===s){const[e,...n]=l.sequenceLines,r=n.join("")+t;l.sequenceLines=[e,...tr.splitStringIntoChunks(r,gF)],l.locs.push({min:o.min,max:o.max})}else{const e=a.reduce(((e,t)=>e+t.sequenceLines.reduce(((e,t)=>e+t.length),0)),0),n=gF-e%gF,r=t.slice(0,n),i=tr.splitStringIntoChunks(t.slice(n),gF);a.push({type:s,sequenceLines:[r,...i],locs:[{min:o.min,max:o.max}]})}else{const e=tr.splitStringIntoChunks(t,gF);a.push({type:s,sequenceLines:e,locs:[{min:o.min,max:o.max}]})}}return a}case"CDS":{let e="";const[t]=o,s=[];for(const a of t){let t=r(a.min,a.max);-1===i&&(t=n.revcom(t)),e+=t,s.push({min:a.min,max:a.max})}const l=tr.splitStringIntoChunks(e,gF);return a.push({type:"CDS",sequenceLines:l,locs:s}),a}case"protein":{let e="";const[t]=o,s=[];for(const a of t){let t=r(a.min,a.max);-1===i&&(t=n.revcom(t)),e+=t,s.push({min:a.min,max:a.max})}let l="";for(let t=0;t<e.length;t+=3){const r=e.slice(t,t+3).toUpperCase();l+=n.defaultCodonTable[r]||"&"}const c=tr.splitStringIntoChunks(l,gF);return a.push({type:"protein",sequenceLines:c,locs:s}),a}}}function vF(e){switch(e){case"upOrDownstream":return"rgb(255,255,255)";case"exon":case"UTR":return"rgb(194,106,119)";case"CDS":return"rgb(93,168,153)";case"intron":return"rgb(187,187,187)";case"protein":return"rgb(148,203,236)"}}function bF(e){const t=[],n=e.flatMap((e=>e.locs));let[r]=n;for(let e=1;e<n.length;e++)r.min===n[e].max||r.max===n[e].min?r={min:Math.min(r.min,n[e].min),max:Math.max(r.max,n[e].max)}:(t.push(r),r=n[e]);return t.push(r),t}const _F=p.observer((function({assembly:e,feature:t,refName:n,session:r}){const a=r.apolloDataStore.assemblies.get(e),o=a?.getByRefName(n),{featureTypeOntology:i}=r.apolloDataStore.ontologyManager,s="genomic",l=["genomic","cDNA"],[f,d]=u.useState(l),[p,h]=u.useState(s),[m,g]=u.useState((()=>o?yF(s,t,((e,t)=>o.getSequence(e,t))):[])),[y,v]=u.useState((()=>bF(m))),b=c.useTheme(),_=u.useRef(null);if(u.useEffect((()=>{const{cdsLocations:e}=t,[n]=e;d(n.length>0?[...l,"CDS","protein"]:l)}),[t]),!a||!o)return null;const w=a.getByRefName(n);if(!w)return null;if(!i)throw new Error("featureTypeOntology is undefined");return i.isTypeOf(t.type,"transcript")?R.default.createElement(R.default.Fragment,null,R.default.createElement(c.Select,{defaultValue:"genomic",value:p,onChange:function(e){const n=e.target.value;h(n);const r=o?yF(n,t,((e,t)=>o.getSequence(e,t))):[],a=bF(r);g(r),v(a)},size:"small"},f.map((e=>R.default.createElement(c.MenuItem,{key:e,value:e},e)))),R.default.createElement(c.Button,{variant:"contained",onClick:()=>{const e=_.current;if(!e)return;const t=new Blob([e.outerText],{type:"text/plain"}),n=new Blob([e.outerHTML],{type:"text/html"}),r=new ClipboardItem({[t.type]:t,[n.type]:n});navigator.clipboard.write([r])},style:{marginLeft:10},size:"medium"},"Copy sequence"),R.default.createElement(c.Paper,{style:{fontFamily:"monospace",padding:b.spacing(),overflowX:"auto"},ref:_},">",w.name,":",y.map((e=>1===t.strand?`${e.min+1}-${e.max}`:`${e.max}-${e.min+1}`)).join(";"),"(",1===t.strand?"+":"-",")",R.default.createElement("br",null),m.map(((e,t)=>R.default.createElement("span",{key:`${e.type}-${t}`,style:{background:vF(e.type),color:b.palette.getContrastText(vF(e.type))}},e.sequenceLines.map(((t,n)=>R.default.createElement(R.default.Fragment,{key:`${t.slice(0,5)}-${n}`},t,n===e.sequenceLines.length-1&&t.length!==gF?null:R.default.createElement("br",null))))))))):null}));var wF={},xF=Cc.exports;Object.defineProperty(wF,"__esModule",{value:!0});var SF=wF.default=void 0;SF=wF.default=(0,xF(Oc).default)((0,T.default.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}),"ContentCopy");var EF={},kF=Cc.exports;Object.defineProperty(EF,"__esModule",{value:!0});var AF=EF.default=void 0;AF=EF.default=(0,kF(Oc).default)((0,T.default.jsx)("path",{d:"M9.64 7.64c.23-.5.36-1.05.36-1.64 0-2.21-1.79-4-4-4S2 3.79 2 6s1.79 4 4 4c.59 0 1.14-.13 1.64-.36L10 12l-2.36 2.36C7.14 14.13 6.59 14 6 14c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4c0-.59-.13-1.14-.36-1.64L12 14l7 7h3v-1L9.64 7.64zM6 8c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm0 12c-1.1 0-2-.89-2-2s.9-2 2-2 2 .89 2 2-.9 2-2 2zm6-7.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5.5.22.5.5-.22.5-.5.5zM19 3l-6 6 2 2 7-7V3z"}),"ContentCut");var CF={},OF=Cc.exports;Object.defineProperty(CF,"__esModule",{value:!0});var TF=CF.default=void 0;TF=CF.default=(0,OF(Oc).default)((0,T.default.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove");const NF=mF(iI)((()=>({"&.MuiFormControl-root":{marginTop:0,marginBottom:0,width:"100%"},"& .MuiInputBase-input":{fontSize:12,height:20,padding:1,paddingLeft:10}}))),RF=mF("div")({display:"flex",justifyContent:"center",alignItems:"center",textAlign:"left",width:"100%",overflowWrap:"break-word",wordWrap:"break-word",wordBreak:"break-all","& span":{fontSize:12}}),IF=e=>{const{strand:t}=e;return R.default.createElement("div",null,1===t?R.default.createElement(Nc,null):-1===t?R.default.createElement(TF,null):R.default.createElement(c.Typography,{component:"span"},"N/A"))},PF=p.observer((function({assembly:e,feature:t,refName:r,session:a}){const{notify:o}=a,i=a.apolloDataStore.assemblies.get(e),s=i?.getByRefName(r),{changeManager:l}=a.apolloDataStore,f=u.useRef(null);if(!s)return null;const{apolloDataStore:d}=a,{featureTypeOntology:p}=d.ontologyManager;if(!p.isTypeOf(t.type,"transcript")&&!p.isTypeOf(t.type,"pseudogenic_transcript"))throw new Error("Feature is not a transcript or equivalent");const{cdsLocations:h,transcriptExonParts:m,strand:g}=t,[y]=h,[v,b]=((e,t)=>{const{transcriptExonParts:n}=e,r=n.filter((e=>t.isTypeOf(e.type,"exon"))).sort((({min:e},{min:t})=>e-t)),a=r[0]?.min,o=r[r.length-1]?.max;return[a,o]})(t,p);let _=v,w=b;const x=y.length>0;if(x){const e=y.sort((({min:e},{min:t})=>e-t));_=e[0].min,w=e[e.length-1].max}function S(t,n,r,a,i){if(!r.children)throw new Error("Transcript should have child features");const s=P(r,p,t,a);if(!s)return void o("No matching exon found","error");const c=a?s.min:s.max,{prevExon:u,nextExon:f}=F(r,p,c,a);if(a&&n>=s.max)return void o("Start location should be less than overlapping exon end location","error");if(!a&&n<=s.min)return void o("End location should be greater than overlapping exon start location","error");if(u&&u.max+2>n)return void o("Start location should be greater than previous exon end location","error");if(f&&f.min-2<n)return void o("End location should be less than next exon start location","error");const d=O(r,p,t,a);if(!d)return void o("No matching CDS feature found","error");if(!a&&n<=d.min)return void o("End location should be greater than CDS start location","error");if(a&&n>=d.max)return void o("Start location should be less than CDS end location","error");const h=N(r,s.min,s.max,p);if(h){if(a&&n!==d.min){const t=new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:e});if(n<s.min)if(u)C(h,t,n),C(d,t,n);else{const e=r.parent;n<r.min&&(e&&n<e.min&&C(e,t,n),C(r,t,n),C(h,t,n),C(d,t,n))}else C(d,t,n);l.submit(t).then((()=>{i&&i()})).catch((()=>{o("Error updating feature CDS start position","error")}))}if(!a&&n!==d.max){const t=new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:e});if(n>s.max)if(f)A(h,t,n),A(d,t,n);else{const e=r.parent;n>r.max&&(e&&n>e.max&&A(e,t,n),A(r,t,n),A(h,t,n),A(d,t,n))}else A(d,t,n);l.submit(t).then((()=>{i&&i()})).catch((()=>{o("Error updating feature CDS end position","error")}))}}else o("No matching exon feature found","error")}const E=(t,n,r,a)=>{if(!r.children)throw new Error("Transcript should have child features");if(t===n)return;const i=O(r,p,t,a);if(!i)return void o("No matching CDS feature found","error");const s=a?new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[i._id],featureId:i._id,oldStart:i.min,newStart:n,assembly:e}):new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[i._id],featureId:i._id,oldEnd:i.max,newEnd:n,assembly:e});l.submit(s).catch((()=>{o("Error updating feature CDS position","error")}))};function k(t,n,r,a){if(!r.children)throw new Error("Transcript should have child features");const{matchingExon:i,prevExon:s,nextExon:c}=F(r,p,t,a);if(!i)return void o("No matching exon found","error");if(a&&n>=i.max)return void o("Start location should be less than end location","error");if(!a&&n<=i.min)return void o("End location should be greater than start location","error");if(s&&s.max+2>n)return void o("Error while changing start location","error");if(c&&c.min-2<n)return void o("Error while changing end location","error");const u=N(r,i.min,i.max,p);if(!u)return void o("No matching exon feature found","error");const f=T(r,p);if(a&&n!==i.min){const t=new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[],changes:[],assembly:e});if(s)C(u,t,n);else{const e=r.min,o=r.parent;if(n<e)o&&n<o.min&&C(o,t,n),C(r,t,n),C(u,t,n);else if(n>e&&(C(u,t,n),C(r,t,n),o)){const[e]=I(o,r,n,p,a);o.min!=e&&C(o,t,e)}}f&&f.min>=i.min&&f.min<=i.max&&n>f.min&&C(f,t,n),l.submit(t).catch((()=>{o("Error updating feature exon start position","error")}))}if(!a&&n!==i.max){const t=new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[],changes:[],assembly:e});if(c)A(u,t,n);else{const e=r.max,o=r.parent;if(n>e)o&&n>o.max&&A(o,t,n),A(r,t,n),A(u,t,n);else if(n<e&&(A(u,t,n),A(r,t,n),o)){const[,e]=I(o,r,n,p,a);o.max!=e&&A(o,t,e)}}f&&f.max>=i.min&&f.max<=i.max&&n<f.max&&A(f,t,n),l.submit(t).catch((()=>{o("Error updating feature exon end position","error")}))}}const A=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldEnd:e.max,newEnd:n})},C=(e,t,n)=>{t.changedIds.push(e._id),t.changes.push({featureId:e._id,oldStart:e.min,newStart:n})},O=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(t.isTypeOf(o.type,"CDS")){if(r&&n===o.min){a=o;break}if(!r&&n===o.max){a=o;break}}return a},T=(e,t)=>{let n;for(const[,r]of e.children??[])if(t.isTypeOf(r.type,"CDS")){n=r;break}return n},N=(e,t,n,r)=>{let a;for(const[,o]of e.children??[])if(r.isTypeOf(o.type,"exon")&&t===o.min&&n===o.max){a=o;break}return a},I=(e,t,n,r,a)=>{const o=[],i=[];for(const[,s]of e.children?.entries()??[])r.isTypeOf(s.type,"transcript")&&(s._id===t._id?a?(o.push(n),i.push(s.max)):(i.push(n),o.push(s.min)):(o.push(s.min),i.push(s.max)));return[Math.min(...o),Math.max(...i)]},P=(e,t,n,r)=>{const{transcriptExonParts:a}=e;let o;for(const[,e]of a.entries())if(t.isTypeOf(e.type,"exon")){if(!r&&n>=e.min&&n<=e.max){o=e;break}if(r&&n>=e.min&&n<=e.max){o=e;break}}return o},F=(e,t,n,r)=>{const{transcriptExonParts:a,strand:o}=e;let i,s,l,c;for(const[e,o]of a.entries())if(t.isTypeOf(o.type,"exon")){if(r&&o.min===n){i=o,s=e;break}if(!r&&o.max===n){i=o,s=e;break}}if(i&&void 0!==s){if(1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(-1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){l=n;break}}if(1===o&&s<a.length-1)for(let e=s+1;e<a.length;e++){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}if(-1===o&&s>0)for(let e=s-1;e>=0;e--){const n=a[e];if(t.isTypeOf(n.type,"exon")){c=n;break}}}return{matchingExon:i,prevExon:l,nextExon:c}},M=()=>{let e="";const[r]=h;for(const t of r)e+=s.getSequence(t.min,t.max);-1===g&&(e=n.revcom(e));const a=[];for(let r=0;r<e.length;r+=3){const o=e.slice(r,r+3).toUpperCase(),i=n.defaultCodonTable[o]||"&";"ATG"===o?a.push(R.default.createElement(c.Typography,{component:"span",style:{backgroundColor:"yellow",cursor:"pointer",border:"1px solid black"},key:r,onClick:()=>{const e=j(r);e!==_&&1===g&&E(_,e,t,!0),e!==w&&-1===g&&E(w,e,t,!1)}},i)):["TAA","TAG","TGA"].includes(o)?a.push(R.default.createElement(c.Typography,{style:{backgroundColor:"red",color:"white"},component:"span",key:r},i)):a.push(R.default.createElement(c.Typography,{component:"span",key:r},i))}return a},j=e=>{const[t]=h;let n=0;if(1===g)for(const r of t){const t=r.max-r.min;if(n+t>e)return r.min+(e-n);n+=t}else if(-1===g)for(let r=t.length-1;r>=0;r--){const a=t[r],o=a.max-a.min;if(n+o>e)return a.max-(e-n);n+=o}return 1===g?_:w};return R.default.createElement("div",null,x&&R.default.createElement("div",null,R.default.createElement(c.Accordion,{defaultExpanded:!0},R.default.createElement(DF,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},R.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Translation")),R.default.createElement(c.AccordionDetails,null,R.default.createElement(RF,null,R.default.createElement(c.Typography,{component:"span",ref:f,style:{maxHeight:120,overflowY:"scroll"}},M())),R.default.createElement("div",{style:{marginTop:10,display:"flex",flexDirection:"row",alignItems:"center",gap:10}},R.default.createElement(c.Tooltip,{title:"Copy"},R.default.createElement(SF,{style:{fontSize:15,cursor:"pointer"},onClick:()=>{const e=f.current;if(!e)return;const t=new Blob([e.outerText],{type:"text/plain"}),n=new Blob([e.outerHTML],{type:"text/html"}),r=new ClipboardItem({[t.type]:t,[n.type]:n});navigator.clipboard.write([r])}})),R.default.createElement(c.Tooltip,{title:"Trim"},R.default.createElement(AF,{style:{fontSize:15,cursor:"pointer"},onClick:()=>{const e=M(),n=e.map((e=>e.props.children)).join("");if(n.startsWith("M")&&n.endsWith("*"))return;const r=[];for(const t of e)r.push({codonGenomicPos:t.key,sequenceLetter:t.props.children});if(0===r.length)return;const a=n.indexOf("M"),o=n.indexOf("*")+1,i=r[a].codonGenomicPos,s=r[o].codonGenomicPos;if(!i||!s)return;const l=j(i),c=j(s);if(1===g){let e;l!==_&&(e=new Promise((e=>{S(_,l,t,!0,(()=>{e(!0)}))}))),c!==w&&(e?e.then((()=>{S(w,c,t,!1)})):S(w,c,t,!1))}if(-1===g){let e;l!==w&&(e=new Promise((e=>{S(w,l,t,!1,(()=>{e(!0)}))}))),c!==_&&(e?e.then((()=>{S(_,c,t,!0)})):S(_,c,t,!0))}}}))))),R.default.createElement(c.Grid2,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center",marginTop:10}},R.default.createElement(c.Grid2,{size:1}),R.default.createElement(c.Grid2,{size:4},R.default.createElement(NF,{margin:"dense",variant:"outlined",value:_+1,onChangeCommitted:e=>{S(_,e-1,t,!0)}})),R.default.createElement(c.Grid2,{size:2},R.default.createElement(c.Typography,{component:"span"},"CDS")),R.default.createElement(c.Grid2,{size:4},R.default.createElement(NF,{margin:"dense",variant:"outlined",value:w,onChangeCommitted:e=>{S(w,e,t,!1)}})),R.default.createElement(c.Grid2,{size:1}))),R.default.createElement("div",{style:{marginTop:5}},m.map(((e,r)=>R.default.createElement("div",{key:r},"exon"===e.type&&R.default.createElement(c.Grid2,{container:!0,justifyContent:"center",alignItems:"center",style:{textAlign:"center"}},R.default.createElement(c.Grid2,{size:1},0!==r&&((e,t)=>{let r="";if(t>0){const a=m[t-1];1===g?"intron"===a.type&&(r=s.getSequence(e.min-2,e.min)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.max,e.max+2)))}return[{spliceSite:r,color:"AG"===r?"green":"red"}]})(e,r).map(((e,t)=>R.default.createElement(c.Typography,{key:t,component:"span",color:e.color},e.spliceSite)))),R.default.createElement(c.Grid2,{size:4,style:{padding:0}},R.default.createElement(NF,{margin:"dense",variant:"outlined",value:e.min+1,onChangeCommitted:n=>{k(e.min,n-1,t,!0)}})),R.default.createElement(c.Grid2,{size:2},R.default.createElement(IF,{strand:t.strand})),R.default.createElement(c.Grid2,{size:4,style:{padding:0}},R.default.createElement(NF,{margin:"dense",variant:"outlined",value:e.max,onChangeCommitted:n=>{k(e.max,n,t,!1)}})),R.default.createElement(c.Grid2,{size:1},r!==m.length-1&&((e,t)=>{let r="";if(t<m.length-1){const a=m[t+1];1===g?"intron"===a.type&&(r=s.getSequence(e.max,e.max+2)):"intron"===a.type&&(r=n.revcom(s.getSequence(e.min-2,e.min)))}return[{spliceSite:r,color:"GT"===r?"green":"red"}]})(e,r).map(((e,t)=>R.default.createElement(c.Typography,{key:t,component:"span",color:e.color},e.spliceSite))))))))))})),FF=mF(c.TableCell)((()=>({fontWeight:"bold"}))),MF=p.observer((function(e){const{feature:t}=e,n=Jd(t),r=Yd(t);return R.default.createElement(c.Table,{size:"small",sx:{fontSize:"0.75rem","& .MuiTableCell-root":{padding:"4px"}}},R.default.createElement(c.TableBody,null,""!==n&&R.default.createElement(c.TableRow,null,R.default.createElement(FF,null,"Name"),R.default.createElement(c.TableCell,null,Jd(t))),""!==r&&R.default.createElement(c.TableRow,null,R.default.createElement(FF,null,"ID"),R.default.createElement(c.TableCell,null,Yd(t))),R.default.createElement(c.TableRow,null,R.default.createElement(FF,null,"Location"),R.default.createElement(c.TableCell,null,e.refName,":",t.min,"..",t.max)),R.default.createElement(c.TableRow,null,R.default.createElement(FF,null,"Strand"),R.default.createElement(c.TableCell,null,1===(a=t.strand)?"Forward":-1===a?"Reverse":""))));var a})),jF=f.makeStyles()((e=>({root:{padding:e.spacing(2)}}))),DF=mF(c.AccordionSummary)((()=>({minHeight:30,maxHeight:30,"&.Mui-expanded":{minHeight:30,maxHeight:30}})));function LF(e){return null}const qF=p.observer((function(e){const{classes:t}=jF(),r=["summary","location","attrs"],[a,o]=u.useState(r),{model:i}=e,{assembly:s,feature:f,refName:d}=i;u.useEffect((()=>{o(r)}),[f]);const p=n.getSession(i),{pluginManager:h}=n.getEnv(p),m=n.getSession(i),g=m.apolloDataStore.assemblies.get(s),{internetAccounts:y}=l.getRoot(p),v=y.find((e=>"ApolloInternetAccount"===e.type)),b=["admin","user"].includes((v?v.role:"admin")??"");if(!f||!g)return null;const _=g.getByRefName(d);if(!_)return null;const{max:w,min:x}=f;function S(e,t){o(e?[...a,t]:a.filter((e=>e!==t)))}_.getSequence(x,w)||m.apolloDataStore.loadRefSeq([{assemblyName:s,refName:d,start:x,end:w}]);const E=h.evaluateExtensionPoint("Apollo-TranscriptDetailsCustomComponent",LF,e);return R.default.createElement("div",{className:t.root},R.default.createElement(c.Accordion,{expanded:a.includes("summary"),onChange:(e,t)=>{S(t,"summary")}},R.default.createElement(DF,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel1-content",id:"panel1-header"},R.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Summary")),R.default.createElement(c.AccordionDetails,null,R.default.createElement(MF,{feature:f,refName:d}))),R.default.createElement(E,{session:p,feature:f}),R.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("location"),onChange:(e,t)=>{S(t,"location")}},R.default.createElement(DF,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel2-content",id:"panel2-header"},R.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Location")),R.default.createElement(c.AccordionDetails,null,R.default.createElement(PF,{feature:f,refName:d,session:m,assembly:g._id||""}))),R.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("attrs"),onChange:(e,t)=>{S(t,"attrs")}},R.default.createElement(DF,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel3-content",id:"panel3-header"},R.default.createElement("div",{style:{display:"flex",alignItems:"center"}},R.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Attributes"," "),R.default.createElement(c.Tooltip,{title:"Separate multiple values for the attribute with commas"},R.default.createElement(ip,{style:{color:"white",fontSize:15,marginLeft:10}})))),R.default.createElement(c.AccordionDetails,null,R.default.createElement(oI,{feature:f,session:m,assembly:g._id||"",editable:b}))),R.default.createElement(c.Accordion,{style:{marginTop:5},expanded:a.includes("sequence"),onChange:(e,t)=>{S(t,"sequence")}},R.default.createElement(DF,{expandIcon:R.default.createElement(BR,{style:{color:"white"}}),"aria-controls":"panel4-content",id:"panel4-header"},R.default.createElement(c.Typography,{component:"span",fontWeight:"bold"},"Sequence")),R.default.createElement(c.AccordionDetails,null,a.includes("sequence")&&R.default.createElement(_F,{feature:f,session:m,assembly:g._id||"",refName:d}))))})),BF=r.ConfigurationSchema("LinearApolloDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),UF=f.makeStyles()({highlighted:{background:"orange"}}),zF=({highlight:e,text:t})=>{const{classes:n}=UF();if(!e)return R.default.createElement(R.default.Fragment,null,t);const r=t.split(e);if(1===r.length)return R.default.createElement(R.default.Fragment,null,t);const a=[];for(let t=0;t<r.length-1;t++)a.push(r[t],R.default.createElement("span",{className:n.highlighted},e));return R.default.createElement(R.default.Fragment,null,a,r.at(-1))},GF=p.observer((function({feature:e,filterText:t}){const n=[...e.attributes.entries()].map((([e,t])=>{if(e.startsWith("gff_")){const n=e.slice(4);return[n.charAt(0).toUpperCase()+n.slice(1),l.getSnapshot(t)]}return"_id"===e?["ID",l.getSnapshot(t)]:[e,l.getSnapshot(t)]})).filter((([e])=>e)).map((([e,t])=>`${e}=${Array.isArray(t)?t.join(", "):t}`)).join(", ");return R.default.createElement(zF,{text:n,highlight:t})})),HF=f.makeStyles()((e=>({inputWrapper:{position:"relative"},hiddenWidthSpan:{padding:e.spacing(.5),color:"transparent"},numberTextInput:{border:"none",background:"inherit",font:"inherit",position:"absolute",width:"100%",left:0}}))),$F=p.observer((function({initialValue:e,notifyError:t,onChangeCommitted:n}){const[r,a]=u.useState(e),[o,i]=u.useState(!1),[s,l]=u.useState(null),{classes:c}=HF();return u.useEffect((()=>{e!==r&&a(e)}),[e]),u.useEffect((()=>{o&&(s?.blur(),i(!1))}),[o,s]),R.default.createElement("span",{className:c.inputWrapper},R.default.createElement("span",{className:c.hiddenWidthSpan,"aria-hidden":!0},r),R.default.createElement("input",{type:"text",value:r,className:c.numberTextInput,onChange:function(e){const t=Number(e.target.value);Number.isNaN(t)||a(t)},onKeyDown:t=>{"Enter"===t.key?s?.blur():"Escape"===t.key&&(a(e),i(!0))},onBlur:()=>{r!==e&&n(r).catch(t)},ref:e=>{l(e)}}))})),WF=f.makeStyles()((e=>({typeContent:{display:"inline-block",width:"174px",height:"100%",cursor:"text"},feature:{td:{position:"relative",verticalAlign:"top",paddingLeft:"0.5em"}},arrow:{display:"inline-block",width:"1.6em",textAlign:"center",cursor:"pointer"},arrowExpanded:{transform:"rotate(90deg)"},hoveredFeature:{backgroundColor:e.palette.action.hover},typeInputElement:{border:"none",background:"none"},typeErrorMessage:{color:"red"}})));function VF(e,t){const{changeManager:r,getAssemblyId:a,regions:o,selectedFeature:i,session:s,setSelectedFeature:c,filteredTranscripts:u,updateFilteredTranscripts:f}=e;return function(e,t,r,a,o,i,s,c,u){const f=function(e){const{internetAccounts:t}=l.getParent(e);return t.find((e=>"ApolloInternetAccount"===e.type))}(i),d=f?f.role:"admin",p="admin"===d,h=!(d&&["admin","user"].includes(d)),m=[];if(e){const l=e.attributes.get("gff_id")?.toString(),d=r(t.assemblyName),g=r(t.assemblyName);m.push({label:"Edit feature details",onClick:()=>{const n=i.addWidget("ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget",{feature:e,assembly:g,refName:t.refName});i.showWidget(n)}},{label:"Add child feature",disabled:h,onClick:()=>{i.queueDialog((t=>[TN,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:d,internetAccount:f}]))}},{label:"Copy features and annotations",disabled:h,onClick:()=>{i.queueDialog((t=>[FN,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g}]))}},{label:"Delete feature",disabled:!p,onClick:()=>{i.queueDialog((t=>[jN,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Merge transcripts",disabled:!p,onClick:()=>{i.queueDialog((t=>[YN,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Merge exons",disabled:!p,onClick:()=>{i.queueDialog((t=>[VN,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}},{label:"Split exon",disabled:!p,onClick:()=>{i.queueDialog((t=>[oR,{session:i,handleClose:()=>{t()},changeManager:s,sourceFeature:e,sourceAssemblyId:g,selectedFeature:a,setSelectedFeature:o}]))}});const{featureTypeOntology:y}=i.apolloDataStore.ontologyManager;if(!y)throw new Error("featureTypeOntology is undefined");(y.isTypeOf(e.type,"transcript")||y.isTypeOf(e.type,"pseudogenic_transcript"))&&n.isSessionModelWithWidgets(i)&&m.push({label:"Edit transcript details",onClick:()=>{const n=i.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:e,assembly:g,changeManager:s,refName:t.refName});i.showWidget(n)}},{label:"Visible",type:"checkbox",checked:!l||!c.includes(l),onClick:()=>{if(l){const e=c.includes(l)?c.filter((e=>e!==l)):[...c,l];u(e)}}})}return m}(t,o[0],a,i,c,s,r,u,f)}function JF(e){let t=e;for(;t.parent;)t=t.parent;return t}const YF=p.observer((function e({depth:t,feature:n,isHovered:r,isSelected:a,model:o,selectedFeatureClass:i,setContextMenu:s}){const{classes:l}=WF(),{apolloHover:c,changeManager:u,selectedFeature:f,session:d,tabularEditor:p}=o,{featureCollapsed:h,filterText:m}=p,{_id:g,children:y,max:v,min:b,strand:_,type:w}=n,x=!h.get(g),S=e=>{d.notify(e.message,"error")};return R.default.createElement(R.default.Fragment,null,R.default.createElement("tr",{onMouseEnter:e=>{o.setApolloHover({feature:n,topLevelFeature:JF(n),glyph:o.getGlyph(JF(n))})},className:l.feature+(a?` ${i}`:r?` ${l.hoveredFeature}`:""),onClick:e=>{e.stopPropagation(),o.setSelectedFeature(n)},onContextMenu:e=>(e.preventDefault(),s({position:{left:e.clientX+2,top:e.clientY-6},items:VF(o,n)}),!1)},R.default.createElement("td",{style:{whiteSpace:"nowrap",borderLeft:2*t+"em solid transparent"}},y?.size?R.default.createElement("div",{onClick:e=>{e.stopPropagation(),p.setFeatureCollapsed(g,x)},className:l.arrow+(x?` ${l.arrowExpanded}`:"")},"❯"):null,R.default.createElement("div",{className:l.typeContent},R.default.createElement(ON,{session:d,ontologyName:"Sequence Ontology",style:{width:170},value:w,filterTerms:kN,fetchValidTerms:KF.bind(null,n),renderInput:e=>R.default.createElement("div",{ref:e.InputProps.ref},R.default.createElement("input",{type:"text",...e.inputProps,className:l.typeInputElement,style:{width:170}}),e.error?R.default.createElement("div",{className:l.typeErrorMessage},e.errorMessage??"unknown error"):null),onChange:(e,t)=>{t&&function(e,t,n,r){const a=t._id,o=new tr.TypeChange({typeName:"TypeChange",changedIds:[a],featureId:a,oldType:String(n),newType:String(r),assembly:t.assemblyId});return e.submit(o)}(u,n,e,t).catch(S)}}))),R.default.createElement("td",null,R.default.createElement($F,{initialValue:b+1,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[a],featureId:a,oldStart:n,newStart:r,assembly:t.assemblyId});return e.submit(o)}(u,n,b,e-1)})),R.default.createElement("td",null,R.default.createElement($F,{initialValue:v,notifyError:S,onChangeCommitted:e=>function(e,t,n,r){const a=t._id,o=new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[a],featureId:a,oldEnd:n,newEnd:r,assembly:t.assemblyId});return e.submit(o)}(u,n,v,e)})),R.default.createElement("td",null,1===_?"+":-1===_?"-":void 0),R.default.createElement("td",null,R.default.createElement(GF,{filterText:m,feature:n}))),x&&y?[...y.entries()].filter((e=>{if(!m)return!0;const[,t]=e;return JSON.stringify(t).includes(m)})).map((([n,r])=>R.default.createElement(e,{isHovered:c?.feature._id===r._id,isSelected:f?._id===r._id,selectedFeatureClass:i,key:n,depth:(t||0)+1,feature:r,model:o,setContextMenu:s}))):null)}));async function KF(e,t,n){const{parent:r}=e;if(r){const e=(await t.getTermsWithLabelOrSynonym(r.type,{includeSubclasses:!1})).filter(kN);if(e.length>0)return await t.getClassesThat("part_of",e)}}const ZF=f.makeStyles()((e=>({scrollableTable:{width:"100%",height:"100%",th:{position:"sticky",top:0,zIndex:2,textAlign:"left",background:e.palette.background.paper,paddingTop:"3.2em"},td:{whiteSpace:"normal"}},selectedFeature:{backgroundColor:e.palette.action.selected}}))),XF=p.observer((function({model:e}){const{apolloHover:t,seenFeatures:n,selectedFeature:r,tabularEditor:a}=e,o=c.useTheme(),{classes:i}=ZF(),s=u.useRef(null),[l,f]=u.useState(null),{filterText:p}=a;return u.useEffect((()=>{const e=s.current;if(e&&r){const t=e.querySelector(`.${i.selectedFeature}`);if(t){const n=e.scrollTop,r=t.offsetTop-25;r>n&&r<n+e.offsetHeight||e.scroll({top:r-40,behavior:"smooth"})}}}),[r,n,i.selectedFeature]),R.default.createElement("div",{ref:s,style:{width:"100%",overflowY:"auto",height:"100%"}},R.default.createElement("table",{className:i.scrollableTable},R.default.createElement("thead",null,R.default.createElement("tr",null,R.default.createElement("th",null,"Type"),R.default.createElement("th",null,"Start"),R.default.createElement("th",null,"End"),R.default.createElement("th",null,"Strand"),R.default.createElement("th",null,"Attributes"))),R.default.createElement("tbody",null,[...n.entries()].filter((e=>{if(!p)return!0;const[,t]=e;return JSON.stringify(t).includes(p)})).sort(((e,t)=>e[1].min-t[1].min)).map((([n,a])=>R.default.createElement(YF,{key:n,isSelected:r?._id===n,isHovered:t?.feature._id===n,selectedFeatureClass:i.selectedFeature,feature:a,model:e,depth:0,setContextMenu:f}))))),R.default.createElement(d.Menu,{open:Boolean(l),onMenuItemClick:(e,t)=>{t(),f(null)},onClose:()=>{f(null)},TransitionProps:{onExit:()=>{f(null)}},style:{zIndex:o.zIndex.tooltip},menuItems:l?.items??[],anchorReference:"anchorPosition",anchorPosition:l?.position}))}));var QF={},eM=Cc.exports;Object.defineProperty(QF,"__esModule",{value:!0});var tM=QF.default=void 0;tM=QF.default=(0,eM(Oc).default)((0,T.default.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var nM={},rM=Cc.exports;Object.defineProperty(nM,"__esModule",{value:!0});var aM=nM.default=void 0;aM=nM.default=(0,rM(Oc).default)((0,T.default.jsx)("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z"}),"UnfoldLess");const oM=f.makeStyles()({toolbar:{width:"100%",display:"flex",paddingRight:"2em",flexDirection:"row",justifyContent:"space-between",position:"absolute",zIndex:4},filterText:{}}),iM=p.observer((function({model:e}){const t=e.tabularEditor,{classes:n}=oM();return R.default.createElement("div",{className:n.toolbar},R.default.createElement(c.Tooltip,{title:"Collapse all"},R.default.createElement(c.IconButton,{"aria-label":"collapse",sx:{marginTop:0},onClick:t.collapseAllFeatures},R.default.createElement(aM,null))),R.default.createElement(c.TextField,{className:n.filterText,label:"Filter features",value:t.filterText,sx:{marginTop:0},variant:"outlined",onChange:e=>{t.setFilterText(e.target.value)},slotProps:{input:{endAdornment:R.default.createElement(c.InputAdornment,{position:"end"},R.default.createElement(c.IconButton,{onClick:()=>{t.clearFilterText()}},R.default.createElement(tM,null)))}}}))}));function sM(e){e.stopPropagation()}const lM=p.observer((function({model:e}){return e.tabularEditor.isShown?R.default.createElement("div",{onMouseDown:sM,onClick:sM,style:{width:"100%",height:"100%",position:"relative"}},R.default.createElement(iM,{model:e}),R.default.createElement(XF,{model:e})):null})),cM=l.types.model("TabularEditor",{isShown:!0,featureCollapsed:l.types.map(l.types.boolean),filterText:""}).actions((e=>({setFeatureCollapsed(t,n){e.featureCollapsed.set(t,n)},setFilterText(t){e.filterText=t},clearFilterText(){e.filterText=""},collapseAllFeatures(){const t=l.getParent(e);for(const[n]of t.seenFeatures.entries())e.featureCollapsed.set(n,!0)},togglePane(){e.isShown=!e.isShown},hidePane(){e.isShown=!1},showPane(){e.isShown=!0}})));function uM(e,t){return Boolean(t&&e._id===t._id)}function fM(e,t){return t?e?.palette.text.primary??"black":e?.palette.background.default??"white"}function dM(e,t,n,r,a,o){e.fillStyle=o,e.fillRect(t,n,r,a)}function pM(e){let t;t=e.attributes.get("gff_name")?e.attributes.get("gff_name")?.join(","):e.attributes.get("gff_id")?e.attributes.get("gff_id")?.join(","):e._id;const n=`(${(e.min+1).toLocaleString("en")}..${e.max.toLocaleString("en")})`;if(t&&t.length+n.length>65){const e=60-n.length;t=e>0?t.slice(0,e):"",t=`${t}[...]`}return`${t} ${n}`}function hM(e,t){const{apolloInternetAccount:n,changeManager:r,regions:a,selectedFeature:o,session:i}=e,s=[],l=n?n.role:"admin",c="admin"===l,u=!(l&&["admin","user"].includes(l)),[f]=a,d=e.getAssemblyId(f.assemblyName),p=e.getAssemblyId(f.assemblyName),{featureTypeOntology:h}=i.apolloDataStore.ontologyManager;if(!h)throw new Error("featureTypeOntology is undefined");return s.push({label:pM(t),type:"subHeader"},{label:"Add child feature",disabled:u,onClick:()=>{i.queueDialog((e=>[TN,{session:i,handleClose:()=>{e()},changeManager:r,sourceFeature:t,sourceAssemblyId:d,internetAccount:n}]))}},{label:"Copy features and annotations",disabled:u,onClick:()=>{i.queueDialog((e=>[FN,{session:i,handleClose:()=>{e()},changeManager:r,sourceFeature:t,sourceAssemblyId:p}]))}},{label:"Delete feature",disabled:!c,onClick:()=>{i.queueDialog((n=>[jN,{session:i,handleClose:()=>{n()},changeManager:r,sourceFeature:t,sourceAssemblyId:p,selectedFeature:o,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),s}function mM(e,t,n){const{refName:r,regionNumber:a,x:o}=e,{lgv:i}=n,{offsetPx:s}=i,l=i.bpToPx({refName:r,coord:t.min,regionNumber:a}),c=i.bpToPx({refName:r,coord:t.max,regionNumber:a});if(void 0!==l&&void 0!==c){const e=l.offsetPx-s,t=c.offsetPx-s;if(Math.abs(t-e)<8)return;if(Math.abs(e-o)<4)return"min";if(Math.abs(t-o)<4)return"max"}}const gM={draw:function(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,session:s,theme:l}=r,{bpPerPx:c,displayedRegions:u,offsetPx:f}=i,d=u[a],p=(i.bpToPx({refName:d.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-f,{reversed:h}=d,{apolloSelectedFeature:m}=s,g=t.length/c,y=h?p-g:p,v=n*o,b=uM(t,m),_=fM(l,b),w=function(e,t){return t?e?.palette.getContrastText(fM(e,t))??"white":e?.palette.text.primary??"black"}(l,b);!function(e,t,n,r,a,o){dM(e,t,n,r,a,o),r<=2||e.clearRect(t+1,n+1,r-2,a-2)}(e,y,v,g,o,w),g<=2||(function(e,t,n,r,a,o){dM(e,t+1,n+1,r-2,a-2,o)}(e,y,v,g,o,_),function(e,t,n,r,a,o){e.fillStyle=a;const i=Math.max(t+1,0);e.fillText(o,i,n+11,t-1+r-i)}(e,y,v,g,w,t.type))},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:f,feature:d,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-d[f]:d[f]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,theme:o}=e;if(!n)return;const{feature:i}=n,s=e.getFeatureLayoutPosition(i);if(!s)return;const{bpPerPx:l,displayedRegions:c,offsetPx:u}=a,{layoutIndex:f,layoutRow:d}=s,p=c[f],{refName:h,reversed:m}=p,{length:g,max:y,min:v}=i,b=(a.bpToPx({refName:h,coord:m?y:v,regionNumber:f})?.offsetPx??0)-u,_=d*r,w=g/l;t.fillStyle=o?.palette.action.focus??"rgba(0,0,0,0.04)",t.fillRect(b,_,w,r)},drawTooltip:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,theme:o}=e;if(!n)return;const{feature:i}=n,s=e.getFeatureLayoutPosition(i);if(!s)return;const{featureRow:l,layoutIndex:u,layoutRow:f}=s,{bpPerPx:d,displayedRegions:p,offsetPx:h}=a,m=p[u],{refName:g,reversed:y}=m;let v="Loc: ";const{length:b,max:_,min:w}=i;v+=`${w+1}–${_}`;let x=(a.bpToPx({refName:g,coord:y?_:w,regionNumber:u})?.offsetPx??0)-h;const S=(f+l)*r,E=b/d,k=`Type: ${i.type}`,{attributes:A}=i,C=A.get("gff_name")?.find((e=>""!==e)),O=[t.measureText(k).width,t.measureText(v).width];C&&O.push(t.measureText(`Name: ${C}`).width);const T=Math.max(...O);x=x+E+5,t.fillStyle=c.alpha(o?.palette.text.primary??"rgb(1, 1, 1)",.7),t.fillRect(x,S,T+4,3===O.length?45:35),t.beginPath(),t.moveTo(x,S),t.lineTo(x-5,S+5),t.lineTo(x,S+10),t.fill(),t.fillStyle=o?.palette.background.default??"rgba(255, 255, 255)";let N=S+12;t.fillText(k,x+2,N),C&&(N+=12,t.fillText(`Name: ${C}`,x+2,N)),N+=12,t.fillText(v,x+2,N)},getContextMenuItemsForFeature:hM,getContextMenuItems:function(e){const{apolloHover:t}=e;if(!t)return[];const{feature:n}=t;return hM(e,n)},getFeatureFromLayout:function(e,t,n){return e},getRowCount:function(e){return 1},getRowForFeature:function(e,t){return 0},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{feature:a}=r,o=mM(t,a,e);o&&(n.stopPropagation(),e.startDrag(t,a,o))},onMouseLeave:function(){},onMouseMove:function(e,t){if(XM(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{feature:r}=n;if(mM(t,r,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t;if(!n)return;const{feature:r}=n;e.setSelectedFeature(r),e.showFeatureDetailsWidget(r)}};let yM=null,vM=null,bM=null,_M=null;const wM=globalThis.document.createElement("canvas");if(wM?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?yM=a.createPattern(n,"repeat"):bM=a.createPattern(n,"repeat"):"light"===t?vM=a.createPattern(n,"repeat"):_M=a.createPattern(n,"repeat")}}function xM(e,t,n,r,a,o,i,s,l){const{apolloRowHeight:c,lgv:u,session:f,theme:d}=t,{bpPerPx:p,displayedRegions:h,offsetPx:m}=u,g=h[n],{refName:y,reversed:v}=g,{apolloSelectedFeature:b}=f,_=(u.bpToPx({refName:y,coord:a.min,regionNumber:n})?.offsetPx??0)-m,w=a.length/p,x=v?_-w:_,S=(r+o)*c,E=Math.round(.6*c),k=S+(c-E)/2;if(e.fillStyle=d?.palette.text.primary??"black",e.fillRect(x,k,w,E),w>2&&(e.clearRect(x+1,k+1,w-2,E-2),e.fillStyle=b&&a._id===b._id?"rgb(0,0,0)":"rgb(211,211,211)",e.fillRect(x+1,k+1,w-2,E-2),s&&l&&i)){const t=v?-1:1,[n,r]=i*t==1?[s,l]:[l,s];e.fillStyle=n,e.fillRect(x+1,k+1,w-2,(E-2)/2),e.fillStyle=r,e.fillRect(x+1,k+1+(E-2)/2,w-2,(E-2)/2)}}function SM(e,t,n,r,a,o){const{apolloRowHeight:i,lgv:s,theme:l}=t,{bpPerPx:c,displayedRegions:u,offsetPx:f}=s,d=u[n],{refName:p,reversed:h}=d,m=(s.bpToPx({refName:p,coord:a.min,regionNumber:n})?.offsetPx??0)-f,g=a.length/c,y=h?m-g:m,v=Math.round((o+.5)*i)+r*i;e.strokeStyle=l?.palette.text.primary??"black",e.beginPath(),e.moveTo(y,v),e.lineTo(y+g,v),e.stroke()}function EM(e,t){const{children:n,type:r}=e;if(!n)return 0;let a=0;if(t.isTypeOf(r,"transcript"))for(const[,e]of n)t.isTypeOf(e.type,"CDS")&&(a+=1);return a}function kM(e,t,n){const{children:r,type:a}=e;if(!r)return 1;let o=0;if(t.isTypeOf(a,"transcript")||t.isTypeOf(a,"pseudogenic_transcript")){for(const[,e]of r)t.isTypeOf(e.type,"CDS")&&(o+=1);return 0===o?1:o}for(const[,e]of r)o+=kM(e,t);return o}function AM(e,t){if(!t.isTypeOf(e.type,"gene")&&!t.isTypeOf(e.type,"pseudogene"))throw new Error('Top level feature for GeneGlyph must have type "gene"');const{children:n}=e;if(!n)return[[e]];const r=[];for(const[,a]of n){if(!t.isTypeOf(a.type,"transcript")&&!t.isTypeOf(a.type,"pseudogenic_transcript")){r.push([a,e]);continue}if(!a.children)continue;const n=[],o=[];for(const[,e]of a.children)t.isTypeOf(e.type,"CDS")?n.push(e):t.isTypeOf(e.type,"exon")&&o.push(e);for(const t of n)r.push([t,...o,a,e]);0===n.length&&r.push([...o,a,e])}return r}function CM(e,t,r){const{session:a}=r,{apolloDataStore:o}=a,{featureTypeOntology:i}=o.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");const s=i.isTypeOf(t.type,"gene")||i.isTypeOf(t.type,"pseudogene"),l=i.isTypeOf(t.type,"transcript")||i.isTypeOf(t.type,"pseudogenic_transcript"),c=i.isTypeOf(t.type,"CDS");if(s||l)return;const{bp:u,refName:f,regionNumber:d,x:p}=e,{lgv:h}=r;if(c){const e=t.parent;if(!e?.children)return;const r=[];for(const t of e.children.values())i.isTypeOf(t.type,"exon")&&r.push(t);const a=r.find((e=>{const[t,r]=n.intersection2(u-1,u,e.min,e.max);return void 0!==t&&void 0!==r}));if(a){const e=Xd(a,f,d,h);if(e){const t=Qd(a,p,e);if(t)return t}}}const m=Xd(t,f,d,h);if(m){const e=Qd(t,p,m);if(e)return e}}function OM(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")}function TM(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"exon")}const{drawTooltip:NM,getContextMenuItemsForFeature:RM,onMouseLeave:IM}=gM,PM={draw:function(e,t,r,a,o){const{apolloRowHeight:i,lgv:s,session:l,theme:u}=a,{bpPerPx:f,displayedRegions:d,offsetPx:p}=s,h=d[o],{refName:m,reversed:g}=h,y=i,v=Math.round(.9*y),{children:b,min:_,strand:w}=t;if(!b)return;const{apolloSelectedFeature:x}=l,{apolloDataStore:S}=l,{featureTypeOntology:E}=S.ontologyManager;if(!E)throw new Error("featureTypeOntology is undefined");const k=(s.bpToPx({refName:m,coord:_,regionNumber:o})?.offsetPx??0)-p,A=t.length/f,C=g?k-A:k,O=r*y,T=kM(t,E)*y;e.fillStyle=c.alpha(u?.palette.background.paper??"#ffffff",.6),e.fillRect(C,O,A,T);let N=0;for(const[,t]of b){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){N+=1;continue}const{children:n}=t;if(!n)continue;const i=EM(t,E);for(const[,i]of n)E.isTypeOf(i.type,"CDS")&&(SM(e,a,o,r,t,N),N+=1);0===i&&(SM(e,a,o,r,t,N),N+=1)}const R="dark"===u?.palette.mode?bM:yM,I="dark"===u?.palette.mode?_M:vM;N=0;for(const[,t]of b){if(!E.isTypeOf(t.type,"transcript")&&!E.isTypeOf(t.type,"pseudogenic_transcript")){gM.draw(e,t,r,a,o),N+=1;continue}const i=EM(t,E);if(0!=i)for(const i of t.cdsLocations){const{_id:l,children:c}=t;if(c){for(const[,t]of c)E.isTypeOf(t.type,"exon")&&xM(e,a,o,r,t,N,w,R,I);for(const a of i){const i=(a.max-a.min)/f,c=(s.bpToPx({refName:m,coord:a.min,regionNumber:o})?.offsetPx??0)-p,d=g?c-i:c;e.fillStyle=u?.palette.text.primary??"black";const h=(r+N)*y+(y-v)/2;if(e.fillRect(d,h,i,v),i>2){e.clearRect(d+1,h+1,i-2,v-2);const r=n.getFrame(a.min,a.max,t.strand??1,a.phase),o=u?.palette.framesCDS.at(r)?.main;if(e.fillStyle=x&&l===x._id?"rgb(0,0,0)":o??"rgb(171,71,188)",e.fillRect(d+1,h+1,i-2,v-2),R&&I&&w){const t=g?-1:1,[n,r]=w*t==1?[R,I]:[I,R];e.fillStyle=n,e.fillRect(d+1,h+1,i-2,(v-2)/2),e.fillStyle=r,e.fillRect(d+1,h+(v-2)/2,i-2,(v-2)/2)}}}N+=1}}const{children:l}=t;if(0===i&&l){for(const[,t]of l)E.isTypeOf(t.type,"exon")&&xM(e,a,o,r,t,N,w,R,I);N+=1}}},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:f,feature:d,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-d[f]:d[f]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a,session:o,theme:i}=e,{featureTypeOntology:s}=o.apolloDataStore.ontologyManager;if(!n)return;const{feature:l}=n,c=e.getFeatureLayoutPosition(l);if(!c)return;const{bpPerPx:u,displayedRegions:f,offsetPx:d}=a,{featureRow:p,layoutIndex:h,layoutRow:m}=c,g=f[h],{refName:y,reversed:v}=g,{length:b,max:_,min:w}=l,x=(a.bpToPx({refName:y,coord:v?_:w,regionNumber:h})?.offsetPx??0)-d,S=(m+p)*r,E=b/u;if(t.fillStyle=i?.palette.action.selected??"rgba(0,0,0,04)",!s)throw new Error("featureTypeOntology is undefined");t.fillRect(x,S,E,r*kM(l,s))},drawTooltip:NM,getContextMenuItems:function(e,t){const{apolloInternetAccount:r,apolloHover:a,changeManager:o,regions:i,selectedFeature:s,session:l}=e,[c]=i,u=e.getAssemblyId(c.assemblyName),f=[],d="admin"===(r?r.role:"admin");if(!a)return f;let p=Zd(t);(function(e,t){const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"CDS")})(t.featureAndGlyphUnderMouse.feature,l)&&(p=Zd(t,!0));for(const t of p){const r=gM.getContextMenuItemsForFeature(e,t);TM(t,l)&&r.push({label:"Merge exons",disabled:!d,onClick:()=>{l.queueDialog((n=>[VN,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}},{label:"Split exon",disabled:!d,onClick:()=>{l.queueDialog((n=>[oR,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),OM(t,l)&&(r.push({label:"Merge transcript",onClick:()=>{l.queueDialog((n=>[YN,{session:l,handleClose:()=>{n()},changeManager:o,sourceFeature:t,sourceAssemblyId:u,selectedFeature:s,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}}),n.isSessionModelWithWidgets(l)&&r.push({label:"Open transcript details",onClick:()=>{const e=l.addWidget("ApolloTranscriptDetails","apolloTranscriptDetails",{feature:t,assembly:u,changeManager:o,refName:c.refName});l.showWidget(e)}})),f.push({label:t.type,subMenu:r})}return f},getContextMenuItemsForFeature:RM,getFeatureFromLayout:function(e,t,n,r){const a=AM(e,r)[n]||[];for(const e of a){let n;if(t>=e.min&&t<=e.max&&e.parent&&(n=e),n){if(r.isTypeOf(n.type,"CDS")&&n.parent&&(r.isTypeOf(n.parent.type,"transcript")||r.isTypeOf(n.parent.type,"pseudogenic_transcript"))){const{cdsLocations:e}=n.parent;for(const r of e)for(const e of r)if(t>=e.min&&t<=e.max)return n;return n.parent}return n}}return e},getRowCount:kM,getRowForFeature:function(e,t,n){const r=AM(e,n);for(const[e,n]of r.entries())if(n.some((e=>e._id===t._id)))return e},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{feature:a}=r,o=CM(t,a,e);o&&(n.stopPropagation(),e.startDrag(t,o.feature,o.edge,!0))},onMouseLeave:IM,onMouseMove:function(e,t){if(XM(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{feature:r}=n;if(CM(t,r,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t;if(!n)return;const{feature:r}=n;e.setSelectedFeature(r);const{session:a}=e,{apolloDataStore:o}=a,{featureTypeOntology:i}=o.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");let s=!1;for(const[,e]of r.children??[])if(i.isTypeOf(e.type,"CDS")||i.isTypeOf(e.type,"exon")){s=!0;break}(i.isTypeOf(r.type,"transcript")||i.isTypeOf(r.type,"pseudogenic_transcript"))&&s?e.showFeatureDetailsWidget(r,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(r)}};function FM(e){const t=[[e]];if(e.children)for(const[,n]of e.children)t.push(...FM(n));return t}function MM(e){return FM(e).length}function jM(e,t,n,r,a,o){const i=FM(t)[n-r];for(const t of i)DM(e,t,n,a,o)}function DM(e,t,n,r,a){const{apolloRowHeight:o,lgv:i,session:s}=r,{bpPerPx:l,displayedRegions:c,offsetPx:u}=i,f=c[a],d=(i.bpToPx({refName:f.refName,coord:t.min,regionNumber:a})?.offsetPx??0)-u,{reversed:p}=f,{apolloSelectedFeature:h}=s,m=t.length/l,g=p?d-m:d,y=n*o,v=MM(t),b=uM(t,h);v>1&&dM(e,g,y,m,v*o,b?"rgba(130,0,0,0.45)":"rgba(255,0,0,0.25)"),gM.draw(e,t,n,r,a)}const{drawDragPreview:LM,drawTooltip:qM,getContextMenuItemsForFeature:BM,onMouseDown:UM,onMouseLeave:zM,onMouseMove:GM,onMouseUp:HM}=gM,$M={draw:function(e,t,n,r,a){for(let o=0;o<MM(t);o++)jM(e,t,n+o,n,r,a)},drawDragPreview:LM,drawHover:function(e,t){const{apolloHover:n,apolloRowHeight:r,lgv:a}=e;if(!n)return;const{feature:o}=n,i=e.getFeatureLayoutPosition(o);if(!i)return;const{featureRow:s,layoutIndex:l,layoutRow:c}=i,{bpPerPx:u,displayedRegions:f,offsetPx:d}=a,p=f[l],{refName:h,reversed:m}=p,{length:g,max:y,min:v}=o,b=(a.bpToPx({refName:h,coord:m?y:v,regionNumber:l})?.offsetPx??0)-d,_=(c+s)*r,w=g/u;t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(b,_,w,r*MM(o))},drawTooltip:qM,getContextMenuItemsForFeature:BM,getContextMenuItems:function(e,t){const{apolloHover:n,session:r}=e,a=[];if(!n)return a;const{feature:o}=n,{featureTypeOntology:i}=r.apolloDataStore.ontologyManager;if(!i)throw new Error("featureTypeOntology is undefined");const s=gM.getContextMenuItems(e,t);a.push({label:o.type,subMenu:s});for(const n of Zd(t)){if(n._id===o._id)continue;const t=gM.getContextMenuItemsForFeature(e,n);a.push({label:n.type,subMenu:t})}return a},getFeatureFromLayout:function(e,t,n){return FM(e)[n].find((e=>t>=e.min&&t<=e.max))},getRowCount:MM,getRowForFeature:function(e,t){const n=FM(e);for(const[e,r]of n.entries())if(r.some((e=>e._id===t._id)))return e},onMouseDown:UM,onMouseLeave:zM,onMouseMove:GM,onMouseUp:HM},WM=p.observer((function({featureTypes:e,handleClose:t,onUpdate:n,session:r}){const[a,o]=u.useState(""),[i,s]=u.useState(e);return R.default.createElement(_p,{open:!0,maxWidth:!1,"data-testid":"filter-features-dialog",title:"Filter features by type",handleClose:t},R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,null,"Select the feature types you want to display in the apollo track"),R.default.createElement(c.Grid2,{container:!0,spacing:2},R.default.createElement(c.Grid2,{size:8},R.default.createElement(ON,{session:r,ontologyName:"Sequence Ontology",style:{width:"100%"},value:a,filterTerms:kN,renderInput:e=>R.default.createElement(c.TextField,{...e,label:"Feature type",variant:"outlined",fullWidth:!0}),onChange:(e,t)=>{t&&(e=>{o(e)})(t)}})),R.default.createElement(c.Grid2,{size:4},R.default.createElement(c.Button,{variant:"contained",onClick:()=>{if(a){if(i.includes(a))return;n([...i,a]),s([...i,a])}},disabled:!a,style:{marginTop:9},size:"medium"},"Add"))),i.length>0&&R.default.createElement("div",null,R.default.createElement("hr",null),R.default.createElement("div",{style:{width:300}},R.default.createElement(c.DialogContentText,null,"Selected feature types:"),R.default.createElement(c.Box,{sx:{display:"flex",flexWrap:"wrap",gap:.5}},i.map((e=>R.default.createElement(c.Chip,{key:e,label:e,onDelete:()=>{(e=>{const t=i.filter((t=>t!==e));n(t),s(t)})(e)}}))))))))}));function VM(e,t,n){const r=[];for(let a=e;a<e+t;a++){const e=n.get(a);e&&r.push(e)}return r}function JM(e,t){for(const r of e)for(const[e,a]of r)if(n.doesIntersect2(t.min,t.max,e,a)||n.doesIntersect2(e,a,t.min,t.max))return!1;return!0}function YM(e,t){return t?.palette.bases[e.toUpperCase()].main.toString()??"lightgray"}function KM(e,t,n,r,a){const o=Math.min(n,10);e.fillStyle="#000",e.font=`${o}px`;const i=e.measureText(r).width;e.fillText(r,t+(n-i)/2,a+10)}function ZM(e,t,r,a,o,i,s,l,c,u,f,d){let p=s.slice(l,l+3).toUpperCase();c&&(p=function(e){return[...e].map((e=>n.revcom(e))).reverse().join("")}(p));const h=n.defaultCodonTable[p];if(!h)return;const m=function(e,t){return{M:"#33ee33","*":t?"#000000":"#f44336"}[e.toUpperCase()]}(h,d);m&&(f&&"*"==h||u&&"*"!=h)&&(e.fillStyle=m,e.fillRect(r,a,o,i)),t<=.1&&(e.rect(r,a,o,i),e.stroke(),KM(e,r,o,h,a))}function XM(e){return"featureAndGlyphUnderMouse"in e}function QM(e,t){const n=t<=1?2:0;switch(e){case 3:return 0;case 2:return 1;case 1:return 2;case-1:return 3+n;case-2:return 4+n;case-3:return 5+n}}function ej(e,t){if(!(t>1||void 0===e))return 1===e?3:4}function tj(e,t,n,r,a,o){void 0!==a&&(e.fillStyle=t?.palette.action.focus??"rgba(0,0,0,0.04)",e.fillRect(n,r*a,o,r))}function nj(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return a.BaseDisplay.named("BaseLinearApolloDisplay").props({type:l.types.literal("LinearApolloDisplay"),configuration:r.ConfigurationReference(t),graphical:!0,table:!1,showStartCodons:!1,showStopCodons:!0,highContrast:!1,heightPreConfig:l.types.maybe(l.types.refinement("displayHeight",l.types.number,(e=>e>=20))),filteredFeatureTypes:l.types.array(l.types.string),loadingState:!1}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...S.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?500:e.graphical?200:300},get loading(){return e.loadingState}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=200)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=l.getRoot(e),{assemblyName:a}=t,{assemblyManager:o}=e.session,i=o.get(a);if(!i)throw new Error(`No assembly found with name ${a}`);const{internetAccountConfigId:s}=r.getConf(i,["sequence","metadata"]);return n.find((e=>r.getConf(e,"internetAccountId")===s))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowStartCodons(){e.showStartCodons=!e.showStartCodons},toggleShowStopCodons(){e.showStopCodons=!e.showStopCodons},toggleHighContrast(){e.highContrast=!e.highContrast},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=l.cast(t)},setLoading(t){e.loadingState=t}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:n}=e;return{trackMenuItems(){const{graphical:r,table:a,showStartCodons:o,showStopCodons:i,highContrast:s}=e;return[...n(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:r&&!a,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:a&&!r,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:a&&r,onClick:()=>{e.showGraphicalAndTable()}},{label:"Show start codons",type:"checkbox",checked:o,onClick:()=>{e.toggleShowStartCodons()}},{label:"Show stop codons",type:"checkbox",checked:i,onClick:()=>{e.toggleShowStopCodons()}},{label:"Use high contrast colors",type:"checkbox",checked:s,onClick:()=>{e.toggleHighContrast()}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((r=>[WM,{session:n,handleClose:()=>{r()},featureTypes:l.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],f=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(f)},afterAttach(){l.addDisposer(e,s.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.setLoading(!0),e.session.apolloDataStore.loadFeatures(e.regions).then((()=>{setTimeout((()=>{e.setLoading(!1)}),1e3)})),e.lgv.bpPerPx<=3&&e.session.apolloDataStore.loadRefSeq(e.regions))}),{name:"LinearApolloDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return o.named("LinearApolloDisplayLayouts").props({cleanupBoundary:2e5}).volatile((()=>({seenFeatures:s.observable.map()}))).views((e=>({getAnnotationFeatureById:t=>e.seenFeatures.get(t),getGlyph:e=>e.looksLikeGene?PM:e.children?.size?$M:gM}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((r=>{const a=t.get(r.assemblyName),o=new Map,i=new Map,{end:s,refName:c,start:u}=r;for(const[t,r]of e.seenFeatures.entries()){if(!l.isAlive(r)){e.deleteSeenFeature(t);continue}if(c!==a?.getCanonicalRefName(r.refSeq)||!n.doesIntersect2(u,s,r.min,r.max)||e.filteredFeatureTypes.length>0&&!e.filteredFeatureTypes.includes(r.type))continue;const{featureTypeOntology:f}=e.session.apolloDataStore.ontologyManager;if(!f)throw new Error("featureTypeOntology is undefined");const d=e.getGlyph(r).getRowCount(r,f,e.lgv.bpPerPx);let p=0,h=!1;for(;!h;){let e=VM(p,d,i);if(e.length<d){for(let t=0;t<d-e.length;t++){const e=i.size;i.set(e,[]),o.set(e,[])}e=VM(p,d,i)}if(JM(e,r)){for(let e=p;e<p+d;e++){i.get(e)?.push([r.min,r.max]);const t=o.get(e);t?.push([e-p,r._id])}h=!0}else p+=1}}return o}))},getFeatureLayoutPosition(t){const{featureLayouts:n}=this,{featureTypeOntology:r}=e.session.apolloDataStore.ontologyManager;for(const[a,o]of n.entries())for(const[n,i]of o)for(const[o,s]of i){if(0!==o)continue;const i=e.getAnnotationFeatureById(s);if(i){if(t._id===i._id)return{layoutIndex:a,layoutRow:n,featureRow:o};if(i.hasDescendant(t._id)){if(!r)throw new Error("featureTypeOntology is undefined");const o=e.getGlyph(i).getRowForFeature(i,t,r);if(void 0!==o)return{layoutIndex:a,layoutRow:n,featureRow:o}}}}}}))).views((e=>({get highestRow(){return Math.max(0,...e.featureLayouts.map((e=>Math.max(...e.keys()))))}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered()){for(const[t,r]of e.seenFeatures.entries()){let a=!1;for(const t of e.regions)if(n.doesIntersect2(t.start-e.cleanupBoundary,t.end+e.cleanupBoundary,r.min,r.max)){a=!0;break}a||e.deleteSeenFeature(t)}for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}}),{name:"LinearApolloDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloDisplayRendering").props({sequenceRowHeight:15,apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:40,isShown:!0,filteredTranscripts:l.types.array(l.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,seqTrackCanvas:null,seqTrackOverlayCanvas:null,theme:void 0}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setSeqTrackCanvas(t){e.seqTrackCanvas=t},setSeqTrackOverlayCanvas(t){e.seqTrackOverlayCanvas=t},setTheme(t){e.theme=t},afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,f=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,f,100),t.fillStyle="black",t.fillText(n.name,u+1,11,f-2)}a++}}}}),{name:"LinearApolloDisplayRenderCollaborators"}))}})))}(0,t);return o.actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{theme:t}=e;if(!e.lgv.initialized||e.regionCannotBeRendered())return;const r=3/e.lgv.bpPerPx;if(r<1)return;const a=e.seqTrackCanvas?.getContext("2d");if(!a)return;a.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.lgv.bpPerPx<=1?125:95);const o=e.lgv.bpPerPx<=1?[3,2,1,0,0,-1,-2,-3]:[3,2,1,-1,-2,-3];let i=0;if(t)for(const n of o){let r=t.palette.framesCDS.at(n)?.main;if(r){let n=0;e.highContrast&&(r="white",n=1,a.fillStyle=t.palette.grey[200],a.fillRect(0,i,e.lgv.dynamicBlocks.totalWidthPx,e.sequenceRowHeight)),a.fillStyle=r,a.fillRect(0+n,i+n,e.lgv.dynamicBlocks.totalWidthPx-2*n,e.sequenceRowHeight-2*n)}i+=e.sequenceRowHeight}for(const[t,o]of e.regions.entries()){const{apolloDataStore:i}=e.session,s=i.assemblies.get(o.assemblyName),l=s?.getByRefName(o.refName),c=l?.getSequence(o.start,o.end);if(!c)return;for(const[i,s]of[...c].entries()){const l=(e.lgv.bpToPx({refName:o.refName,coord:o.start+i,regionNumber:t})?.offsetPx??0)-e.lgv.offsetPx,u=e.lgv.displayedRegions[t].reversed?l-r:l;for(let t=2;t>=0;t--)(o.start+i)%3===t&&ZM(a,e.lgv.bpPerPx,u,e.sequenceRowHeight*(2-t),r,e.sequenceRowHeight,c,i,!1,e.showStartCodons,e.showStopCodons,e.highContrast);if(e.lgv.bpPerPx<=1){const r=(e.lgv.bpToPx({refName:o.refName,coord:o.start+i,regionNumber:t})?.offsetPx??0)-e.lgv.offsetPx,l=1/e.lgv.bpPerPx,c=e.lgv.displayedRegions[t].reversed?r-l:r;a.beginPath(),a.fillStyle=YM(s,e.theme),a.rect(c,3*e.sequenceRowHeight,l,e.sequenceRowHeight),a.fill(),e.lgv.bpPerPx<=.1&&(a.stroke(),KM(a,c,l,s,3*e.sequenceRowHeight));const u=n.revcom(s);a.beginPath(),a.fillStyle=YM(u,e.theme),a.rect(c,4*e.sequenceRowHeight,l,e.sequenceRowHeight),a.fill(),e.lgv.bpPerPx<=.1&&(a.stroke(),KM(a,c,l,u,4*e.sequenceRowHeight))}for(let t=0;t<=2;t++)(o.start+i)%3===t&&ZM(a,e.lgv.bpPerPx,u,e.sequenceRowHeight*((e.lgv.bpPerPx<=1?5:3)+t),r,e.sequenceRowHeight,c,i,!0,e.showStartCodons,e.showStopCodons,e.highContrast)}}}),{name:"LinearApolloDisplayRenderSequence"}))}})))}(0,t).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{canvas:t,featureLayouts:r,featuresHeight:a,lgv:o}=e;if(!o.initialized||e.regionCannotBeRendered())return;const{displayedRegions:i,dynamicBlocks:s}=o,l=t?.getContext("2d");if(l){l.clearRect(0,0,s.totalWidthPx,a);for(const[t,a]of r.entries()){const r=i[t];for(const[o,i]of a.entries())for(const[a,s]of i){const i=e.getAnnotationFeatureById(s);a>0||!i||n.doesIntersect2(r.start,r.end,i.min,i.max)&&e.getGlyph(i).draw(l,i,o,e,t)}}}}),{name:"LinearApolloDisplayRenderFeatures"}))}})))}(0,t);return o.named("LinearApolloDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0,apolloHover:void 0}))).views((e=>({getMousePosition(t){const n=function(e,t){const n=e.currentTarget,{clientX:r,clientY:a}=e,{left:o,top:i}=n.getBoundingClientRect(),s=r-o,l=a-i,{coord:c,index:u,refName:f}=t.pxToBp(s);return{x:s,y:l,refName:f,bp:c,regionNumber:u}}(t,e.lgv),{bp:r,regionNumber:a,y:o}=n,i=Math.floor(o/e.apolloRowHeight),s=e.featureLayouts[a].get(i);if(!s)return n;const l=s.find((t=>{const n=e.getAnnotationFeatureById(t[1]);return n&&r>=n.min&&r<=n.max}));if(!l)return n;const[c,u]=l,f=e.getAnnotationFeatureById(u);if(!f)return n;const d=e.getGlyph(f),{featureTypeOntology:p}=e.session.apolloDataStore.ontologyManager;if(!p)throw new Error("featureTypeOntology is undefined");const h=d.getFeatureFromLayout(f,r,c,p);return h?{...n,featureAndGlyphUnderMouse:{feature:h,topLevelFeature:f,glyph:d}}:n}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setApolloHover(t){e.apolloHover=t},setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(e){}}))).actions((()=>({onClick(){}})))}(0,t).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.seqTrackOverlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.lgv.bpPerPx<=1?125:95);const{apolloHover:r,lgv:a,regions:o,sequenceRowHeight:i,session:s,theme:l}=e;if(!r)return;const{feature:c}=r,{featureTypeOntology:u}=s.apolloDataStore.ontologyManager;if(!u)throw new Error("featureTypeOntology is undefined");for(const[e,r]of o.entries())if(u.isTypeOf(c.type,"CDS")){const o=c.parent;if(!o)continue;const s=o.cdsLocations.find((e=>c.min===e.at(0)?.min&&c.max===e.at(-1)?.max));if(!s)continue;for(const o of s){const s=QM(n.getFrame(o.min,o.max,c.strand??1,o.phase),a.bpPerPx),u=(a.bpToPx({refName:r.refName,coord:o.min,regionNumber:e})?.offsetPx??0)-a.offsetPx,f=(o.max-o.min)/a.bpPerPx;tj(t,l,a.displayedRegions[e].reversed?u-f:u,i,s,f)}}else{const n=ej(c.strand,a.bpPerPx),o=(a.bpToPx({refName:r.refName,coord:c.min,regionNumber:e})?.offsetPx??0)-a.offsetPx,s=c.length/a.bpPerPx;tj(t,l,a.displayedRegions[e].reversed?o-s:o,i,n,s)}}),{name:"LinearApolloDisplayRenderSeqHighlight"}))}})))}(0,t);return o.views((e=>({contextMenuItems(t){const{apolloHover:n}=e;if(!n)return[];const r=e.getMousePosition(t),{topLevelFeature:a}=n,o=e.getGlyph(a);return XM(r)?o.getContextMenuItems(e,r):[]}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=np(r,t.bp,n,o),c="max"===n?new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);XM(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);XM(n)?n.featureAndGlyphUnderMouse.glyph.onMouseMove(e,n,t):(e.setApolloHover(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setApolloHover();const n=e.getMousePosition(t);XM(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);XM(n)?n.featureAndGlyphUnderMouse.glyph.onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,apolloHover:r}=e;if(!r)return;const{glyph:a}=r;a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:l.types.optional(cM,{})}).named("LinearApolloDisplay")}const rj=r.ConfigurationSchema("LinearApolloSixFrameDisplay",{},{explicitIdentifier:"displayId",explicitlyTyped:!0}),aj=p.observer((function({sourceFeature:e,filteredTranscripts:t,handleClose:n,onUpdate:r}){const a=[];if(e.children)for(const[,t]of e.children){const e=t.attributes.get("gff_id")?.toString();e&&a.push(e)}const[o,i]=u.useState(t);return R.default.createElement(_p,{open:!0,maxWidth:!1,"data-testid":"filter-transcripts-dialog",title:"Filter transcripts by ID",handleClose:n},R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,null,"Select the alternate transcripts you want to display in the apollo track"),R.default.createElement(c.Grid2,{container:!0,spacing:2},R.default.createElement(c.Grid2,{size:8},R.default.createElement(c.FormGroup,null,a.map((e=>R.default.createElement(c.FormControlLabel,{control:R.default.createElement(c.Checkbox,{checked:!o.includes(e),onChange:()=>{(e=>{const t=o.includes(e)?o.filter((t=>t!==e)):[...o,e];r(t),i(t)})(e)},inputProps:{"aria-label":"controlled"}}),label:e}))))))))}));let oj=null,ij=null,sj=null,lj=null;const cj=globalThis.document.createElement("canvas");if(cj?.getContext)for(const e of["forward","backward"])for(const t of["light","dark"]){const n=document.createElement("canvas"),r=10;n.width=n.height=r;const a=n.getContext("2d");if(a){const o="light"===t?"rgba(0,0,0,0)":"rgba(0,0,0,0.75)",i="light"===t?"rgba(255,255,255,0.25)":"rgba(0,0,0,0.50)",s="forward"===e?a.createLinearGradient(0,r,r,0):a.createLinearGradient(0,0,r,r);s.addColorStop(0,o),s.addColorStop(.25,o),s.addColorStop(.25,i),s.addColorStop(.5,i),s.addColorStop(.5,o),s.addColorStop(.75,o),s.addColorStop(.75,i),s.addColorStop(1,i),a.fillStyle=s,a.fillRect(0,0,10,10),"forward"===e?"light"===t?oj=a.createPattern(n,"repeat"):sj=a.createPattern(n,"repeat"):"light"===t?ij=a.createPattern(n,"repeat"):lj=a.createPattern(n,"repeat")}}function uj(e,t){for(const n of e)if(hN(n,t))return!0;return!1}function fj(e,t){return Boolean(t&&e._id===t._id)}function dj(e,t,r,a){const{filteredTranscripts:o,session:i}=a,{apolloDataStore:s}=i,{featureTypeOntology:l}=s.ontologyManager;if(!l)throw new Error("featureTypeOntology is undefined");const c=l.isTypeOf(r.type,"transcript");if(null===t)return;const u=r.attributes.get("gff_id")?.toString();if(u&&o.includes(u))return;const{bp:f,refName:d,regionNumber:p,x:h}=e,{lgv:m}=a;if(c){const e=r;if(!e.children)return;const a=[],o=[];for(const t of e.children.values()){const e=l.isTypeOf(t.type,"exon"),n=l.isTypeOf(t.type,"CDS");e?a.push(t):n&&o.push(t)}const i=a.find((e=>{const[t,r]=n.intersection2(f,f+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(i){const e=Xd(i,d,p,m);if(e){const t=Qd(i,h,e);if(t)return t}}const s=Xd(t,d,p,m);if(s){const e=o.find((e=>{const[t,r]=n.intersection2(f,f+1,e.min,e.max);return void 0!==t&&void 0!==r}));if(e){const t=Qd(e,h,s);if(t)return t}}}}const pj={draw:function(e,t,r,a,o){const{apolloRowHeight:i,lgv:s,session:l,theme:u,highestRow:f,filteredTranscripts:d,showFeatureLabels:p}=a,{bpPerPx:h,displayedRegions:m,offsetPx:g}=s,y=m[o],{refName:v,reversed:b}=y,_=i,w=_,x=_,S=_,E=p?2:1,k=u?.palette.text.primary??"black",{attributes:A,children:C,min:O,strand:T}=t;if(!C)return;const{apolloSelectedFeature:N}=l,{apolloDataStore:R}=l,{featureTypeOntology:I}=R.ontologyManager;if(!I)throw new Error("featureTypeOntology is undefined");const P=[],F=(s.bpToPx({refName:v,coord:O,regionNumber:o})?.offsetPx??0)-g,M=t.length/h,j=b?F-M:F,D=(1==T?3:4)*E*_;e.fillStyle=u?.palette.text.primary??"black",e.fillRect(j,D,M,S),e.fillStyle=fj(t,N)?c.alpha("rgb(0,0,0)",.7):c.alpha(u?.palette.background.paper??"#ffffff",.7),e.fillRect(j+1,D+1,M-2,S-2);const L=fj(t,N),q={x:j,y:D,h:S,text:A.get("gff_id")?.toString(),color:k,isSelected:L};L?P.unshift(q):P.push(q);const B="dark"===u?.palette.mode?sj:oj,U="dark"===u?.palette.mode?lj:ij,z=b?-1:1;let G=null,H=null;T&&([G,H]=T*z==1?[B,U]:[U,B]),G&&H&&(e.fillStyle=G,e.fillRect(j+1,D+1,M-2,(S-2)/2),e.fillStyle=H,e.fillRect(j+1,D+(S-2)/2,M-2,(S-2)/2));const $=new Set;for(const[,t]of C){if(!I.isTypeOf(t.type,"transcript")&&!I.isTypeOf(t.type,"pseudogenic_transcript"))continue;const{children:r,cdsLocations:a}=t;if(!r)continue;const i=t.attributes.get("gff_id")?.toString();if(i&&d.includes(i))continue;for(const[,t]of r){if(!I.isTypeOf(t.type,"exon"))continue;const n=(s.bpToPx({refName:v,coord:t.min,regionNumber:o})?.offsetPx??0)-g,r=t.length/h,a=b?n-r:n,i=D+(S-w)/2,l=fj(t,N);if(e.fillStyle=u?.palette.text.primary??"black",e.fillRect(a,i,r,w),r>2){e.clearRect(a+1,i+1,r-2,w-2),e.fillStyle=l?"rgb(0,0,0)":c.alpha("#f5f500",.6),e.fillRect(a+1,i+1,r-2,w-2),G&&H&&(e.fillStyle=G,e.fillRect(a+1,i+1,r-2,(w-2)/2),e.fillStyle=H,e.fillRect(a+1,i+1+(w-2)/2,r-2,(w-2)/2));const n={x:a,y:i,h:w,text:t.attributes.get("gff_id")?.toString(),color:k,isSelected:l};l?P.unshift(n):P.push(n)}}const l=fj(t,N?.parent);let p=0,m=0;for(const r of a){let a=0,i=0,c=1;for(const d of r.sort(((e,t)=>e.max-t.max)))if(N&&l&&I.isTypeOf(N.type,"CDS")||!uj($,d)){const r=(d.max-d.min)/h,y=(s.bpToPx({refName:v,coord:d.min,regionNumber:o})?.offsetPx??0)-g;p=b?y-r:y,e.fillStyle=u?.palette.text.primary??"black";const w=n.getFrame(d.min,d.max,t.strand??1,d.phase);if(m=((w<0?-1*w+5:w)*E-E)*_,e.fillRect(p,m,r,x),r>2){e.clearRect(p+1,m+1,r-2,x-2);const t=u?.palette.framesCDS.at(w)?.main,n=t??"rgb(171,71,188)";if(e.fillStyle=n,e.fillStyle=N&&l&&I.isTypeOf(N.type,"CDS")?"rgb(0,0,0)":n,e.fillRect(p+1,m+1,r-2,x-2),c>1){const t=[(p-i)/2+i,Math.max(w<0?_*E*f+1:1,Math.min(a,m)-_/2)];e.strokeStyle="rgb(0, 128, 128)",e.beginPath(),e.moveTo(i,a),e.lineTo(...t),e.stroke(),e.moveTo(...t),e.lineTo(p,m+_/2),e.stroke()}i=p+r,a=m+_/2,c+=1,G&&H&&(e.fillStyle=G,e.fillRect(p+1,m+1,r-2,(x-2)/2),e.fillStyle=H,e.fillRect(p+1,m+(x-2)/2,r-2,(x-2)/2))}$.add(d)}}const y={x:p,y:m,h:x,text:t.attributes.get("gff_id")?.toString(),color:k,isSelected:l};l?P.unshift(y):P.push(y)}p&&function(e,t,r="10px sans-serif"){for(let a=t.length-1;a>=0;--a){const o=t[a];e.fillStyle=o.color;const i=Math.max(o.x+1,0),s=o.y+o.h,l=n.measureText(o.text,10);o.isSelected&&(e.clearRect(i-5,s,l+10,o.h),e.font="bold ".concat(r)),o.text&&(e.fillText(o.text,i,s+11,l),e.font=r)}}(e,P)},drawDragPreview:function(e,t){const{apolloDragging:n,apolloRowHeight:r,lgv:a,theme:o}=e,{bpPerPx:i,displayedRegions:s,offsetPx:l}=a;if(!n)return;const{current:u,edge:f,feature:d,start:p}=n,h=Math.floor(p.y/r),m=s[p.regionNumber],g=(m.reversed?m.end-d[f]:d[f]-m.start)/i-l,y=Math.min(u.x,g),v=h*r,b=Math.abs(u.x-g),_=1*r;t.strokeStyle=o?.palette.info.main??"rgb(255,0,0)",t.setLineDash([6]),t.strokeRect(y,v,b,_),t.fillStyle=c.alpha(o?.palette.info.main??"rgb(255,0,0)",.2),t.fillRect(y,v,b,_)},drawHover:function(e,t){const{apolloHover:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,highestRow:s,session:l,showFeatureLabels:c}=e;if(!r)return;const{apolloDataStore:u}=l,{featureTypeOntology:f}=u.ontologyManager;if(!f)throw new Error("featureTypeOntology is undefined");const{feature:d}=r;if(!f.isTypeOf(d.type,"transcript"))return;const p=d.attributes.get("gff_id")?.toString();if(p&&o.includes(p))return;const h=e.getFeatureLayoutPosition(d);if(!h)return;const{bpPerPx:m,displayedRegions:g,offsetPx:y}=i,{layoutIndex:v}=h,b=g[v],{refName:_,reversed:w}=b,x=a,S=x,E=c?2:1,{cdsLocations:k,strand:A}=d;for(const e of k){let r=0,a=0,o=1;for(const l of e.sort(((e,t)=>e.max-t.max))){const e=(l.max-l.min)/m;if(e>2){const c=(i.bpToPx({refName:_,coord:l.min,regionNumber:v})?.offsetPx??0)-y,u=w?c-e:c,f=n.getFrame(l.min,l.max,A??1,l.phase),d=((f<0?-1*f+5:f)*E-E)*x;if(t.fillStyle="rgba(255,0,0,0.6)",t.fillRect(u,d,e,S),o>1){const e=[(u-a)/2+a,Math.max(f<0?x*E*s+1:1,Math.min(r,d)-x/2)];t.strokeStyle="rgb(0, 0, 0)",t.lineWidth=2,t.beginPath(),t.moveTo(a,r),t.lineTo(...e),t.stroke(),t.moveTo(...e),t.lineTo(u,d+x/2),t.stroke()}a=u+e,r=d+x/2,o+=1}}}},drawTooltip:function(e,t){const{apolloHover:r,apolloRowHeight:a,filteredTranscripts:o,lgv:i,theme:s}=e;if(!r)return;const{cds:l,feature:u}=r;if(!l)return;const f=e.getFeatureLayoutPosition(u);if(!f)return;const d=u.attributes.get("gff_id")?.toString();if(d&&o.includes(d))return;const{layoutIndex:p}=f,{bpPerPx:h,displayedRegions:m,offsetPx:g}=i,y=m[p],{refName:v,reversed:b}=y,_=a,w=Math.round(.7*_);let x="Loc: ";const{strand:S}=u,{max:E,min:k,phase:A}=l;x+=`${k+1}–${E}`;let C=(i.bpToPx({refName:v,coord:b?E:k,regionNumber:p})?.offsetPx??0)-g;const O=n.getFrame(k,E,S??1,A),T=((O<0?-1*O+5:O)-1)*_+(_-w)/2,N=(E-k)/h,R=`Type: ${l.type}`,{attributes:I}=u,P=I.get("gff_name")?.find((e=>""!==e)),F=[t.measureText(R).width,t.measureText(x).width];P&&F.push(t.measureText(`Parent Type: ${u.type}`).width,t.measureText(`Parent Name: ${P}`).width);const M=Math.max(...F);C=C+N+5,t.fillStyle=c.alpha(s?.palette.text.primary??"rgb(1, 1, 1)",.7),t.fillRect(C,T,M+4,4===F.length?55:35),t.beginPath(),t.moveTo(C,T),t.lineTo(C-5,T+5),t.lineTo(C,T+10),t.fill(),t.fillStyle=s?.palette.background.default??"rgba(255, 255, 255)";let j=T+12;t.fillText(R,C+2,j),P&&(j+=12,t.fillText(`Parent Type: ${u.type}`,C+2,j),j+=12,t.fillText(`Parent Name: ${P}`,C+2,j)),j+=12,t.fillText(x,C+2,j)},getContextMenuItems:function(e){const{apolloHover:t,apolloInternetAccount:n,changeManager:r,filteredTranscripts:a,regions:o,selectedFeature:i,session:s}=e,c=[];if(!t)return c;const{feature:u}=t,f=n?n.role:"admin",d="admin"===f,p=!(f&&["admin","user"].includes(f)),[h]=o,m=e.getAssemblyId(h.assemblyName),g=e.getAssemblyId(h.assemblyName);c.push({label:"Add child feature",disabled:p,onClick:()=>{s.queueDialog((e=>[TN,{session:s,handleClose:()=>{e()},changeManager:r,sourceFeature:u,sourceAssemblyId:m,internetAccount:n}]))}},{label:"Copy features and annotations",disabled:p,onClick:()=>{s.queueDialog((e=>[FN,{session:s,handleClose:()=>{e()},changeManager:r,sourceFeature:u,sourceAssemblyId:g}]))}},{label:"Delete feature",disabled:!d,onClick:()=>{s.queueDialog((t=>[jN,{session:s,handleClose:()=>{t()},changeManager:r,sourceFeature:u,sourceAssemblyId:g,selectedFeature:i,setSelectedFeature:t=>{e.setSelectedFeature(t)}}]))}});const{featureTypeOntology:y}=s.apolloDataStore.ontologyManager;if(!y)throw new Error("featureTypeOntology is undefined");return y.isTypeOf(u.type,"gene")&&c.push({label:"Filter alternate transcripts",onClick:()=>{s.queueDialog((t=>[aj,{handleClose:()=>{t()},sourceFeature:u,filteredTranscripts:l.getSnapshot(a),onUpdate:t=>{e.updateFilteredTranscripts(t)}}]))}}),c},onMouseDown:function(e,t,n){const{featureAndGlyphUnderMouse:r}=t,{cds:a,feature:o}=r,i=dj(t,a,o,e);i&&(n.stopPropagation(),e.startDrag(t,i.feature,i.edge,!0))},onMouseLeave:function(){},onMouseMove:function(e,t){if(hj(t)){const{featureAndGlyphUnderMouse:n}=t;e.setApolloHover(n);const{cds:r,feature:a}=n;if(dj(t,r,a,e))return void e.setCursor("col-resize")}e.setCursor()},onMouseUp:function(e,t){if(e.apolloDragging)return;const{featureAndGlyphUnderMouse:n}=t,{session:r}=e,{apolloDataStore:a}=r,{featureTypeOntology:o}=a.ontologyManager;if(!n)return;const{feature:i}=n;if(e.setSelectedFeature(i),!o)throw new Error("featureTypeOntology is undefined");let s=!1;for(const[,e]of i.children??[])if(o.isTypeOf(e.type,"CDS")||o.isTypeOf(e.type,"exon")){s=!0;break}(o.isTypeOf(i.type,"transcript")||o.isTypeOf(i.type,"pseudogenic_transcript"))&&s?e.showFeatureDetailsWidget(i,["ApolloTranscriptDetails","apolloTranscriptDetails"]):e.showFeatureDetailsWidget(i)}};function hj(e){return"featureAndGlyphUnderMouse"in e}function mj(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return function(e,t){const o=function(e,t){return a.BaseDisplay.named("BaseLinearApolloSixFrameDisplay").props({type:l.types.literal("LinearApolloSixFrameDisplay"),configuration:r.ConfigurationReference(t),graphical:!0,table:!1,showFeatureLabels:!0,heightPreConfig:l.types.maybe(l.types.refinement("displayHeight",l.types.number,(e=>e>=20))),filteredFeatureTypes:l.types.array(l.types.string)}).views((e=>{const{configuration:t,renderProps:n}=e;return{renderProps:()=>({...n(),...S.getParentRenderProps(e),config:t.renderer})}})).volatile((()=>({scrollTop:0}))).views((e=>({get lgv(){return n.getContainingView(e)},get height(){return e.heightPreConfig?e.heightPreConfig:e.graphical&&e.table?500:e.graphical?200:300}}))).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},get session(){return n.getSession(e)},get regions(){return e.lgv.dynamicBlocks.contentBlocks.map((({assemblyName:e,end:t,refName:n,start:r})=>({assemblyName:e,refName:n,start:Math.round(r),end:Math.round(t)})))},regionCannotBeRendered(){if(e.lgv&&e.lgv.bpPerPx>=200)return"Zoom in to see annotations"}}))).views((e=>({get apolloInternetAccount(){const[t]=e.regions,{internetAccounts:n}=l.getRoot(e),{assemblyName:a}=t,{assemblyManager:o}=e.session,i=o.get(a);if(!i)throw new Error(`No assembly found with name ${a}`);const{internetAccountConfigId:s}=r.getConf(i,["sequence","metadata"]);return n.find((e=>r.getConf(e,"internetAccountId")===s))},get changeManager(){return e.session.apolloDataStore.changeManager},getAssemblyId(t){const{assemblyManager:n}=e.session,r=n.get(t);if(!r)throw new Error(`Could not find assembly named ${t}`);return r.name},get selectedFeature(){return e.session.apolloSelectedFeature}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},showGraphicalOnly(){e.graphical=!0,e.table=!1},showTableOnly(){e.graphical=!1,e.table=!0},showGraphicalAndTable(){e.graphical=!0,e.table=!0},toggleShowFeatureLabels(){e.showFeatureLabels=!e.showFeatureLabels},updateFilteredFeatureTypes(t){e.filteredFeatureTypes=l.cast(t)}}))).views((e=>{const{filteredFeatureTypes:t,trackMenuItems:n}=e;return{trackMenuItems(){const{graphical:r,table:a,showFeatureLabels:o}=e;return[...n(),{type:"subMenu",label:"Appearance",subMenu:[{label:"Show graphical display",type:"radio",checked:r&&!a,onClick:()=>{e.showGraphicalOnly()}},{label:"Show table display",type:"radio",checked:a&&!r,onClick:()=>{e.showTableOnly()}},{label:"Show both graphical and table display",type:"radio",checked:a&&r,onClick:()=>{e.showGraphicalAndTable()}},{label:"Feature Labels",type:"checkbox",checked:o,onClick:()=>{e.toggleShowFeatureLabels()}}]},{label:"Filter features by type",onClick:()=>{const n=e.session;e.session.queueDialog((r=>[WM,{session:n,handleClose:()=>{r()},featureTypes:l.getSnapshot(t),onUpdate:t=>{e.updateFilteredFeatureTypes(t)}}]))}}]}}})).actions((e=>({setSelectedFeature(t){e.session.apolloSetSelectedFeature(t)},showFeatureDetailsWidget(t,n){const[r]=e.regions,{assemblyName:a,refName:o}=r,i=e.getAssemblyId(a);if(!i)return;const{session:s}=e,{changeManager:l}=s.apolloDataStore,[c,u]=n??["ApolloFeatureDetailsWidget","apolloFeatureDetailsWidget"],f=s.addWidget(c,u,{feature:t,assembly:i,refName:o,changeManager:l});s.showWidget(f)},afterAttach(){l.addDisposer(e,s.autorun((()=>{e.lgv.initialized&&!e.regionCannotBeRendered()&&(e.session.apolloDataStore.loadFeatures(e.regions),e.lgv.bpPerPx<=3&&e.session.apolloDataStore.loadRefSeq(e.regions))}),{name:"LinearApolloSixFrameDisplayLoadFeatures",delay:1e3}))}})))}(0,t);return o.named("LinearApolloSixFrameDisplayLayouts").props({featuresMinMaxLimit:5e5}).volatile((()=>({seenFeatures:s.observable.map()}))).views((e=>({get featuresMinMax(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map((r=>{const a=t.get(r.assemblyName);let o,i;const{end:s,refName:l,start:c}=r;for(const[,t]of e.seenFeatures)l!==a?.getCanonicalRefName(t.refSeq)||!n.doesIntersect2(c,s,t.min,t.max)||t.length>e.featuresMinMaxLimit||(void 0===o&&({min:o}=t),void 0===i&&({max:i}=t),t.minWithChildren<o&&({min:o}=t),t.maxWithChildren>i&&({max:i}=t));if(void 0!==o&&void 0!==i)return[o,i]}))},getGlyph:e=>pj,featureLabelSpacer:t=>e.showFeatureLabels?2*t-1:t}))).actions((e=>({addSeenFeature(t){e.seenFeatures.set(t._id,t)},deleteSeenFeature(t){e.seenFeatures.delete(t)}}))).views((e=>({get geneTrackRowNums(){return[4,5].map((t=>e.featureLabelSpacer(t)))}}))).views((e=>({get featureLayouts(){const{assemblyManager:t}=e.session;return e.lgv.displayedRegions.map(((r,a)=>{const o=t.get(r.assemblyName),i=new Map;if(!e.featuresMinMax[a])return i;const{end:s,refName:c,start:u}=r;for(const[t,r]of e.seenFeatures.entries()){if(!l.isAlive(r)){e.deleteSeenFeature(t);continue}if(c!==o?.getCanonicalRefName(r.refSeq)||!n.doesIntersect2(u,s,r.min,r.max))continue;const{featureTypeOntology:a}=e.session.apolloDataStore.ontologyManager;if(!a)throw new Error("featureTypeOntology is undefined");if(r.looksLikeGene){const t=1==r.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1];i.get(t)||i.set(t,[]);const o=i.get(t);o?.push({rowNum:t,feature:r,cds:null});const{children:s}=r;if(!s)continue;for(const[,t]of s)if(a.isTypeOf(t.type,"transcript")){const{cdsLocations:r,strand:o,children:s}=t;if(s)for(const[,t]of s){if(!a.isTypeOf(t.type,"exon"))continue;const n=1==t.strand?e.geneTrackRowNums[0]:e.geneTrackRowNums[1],r=i.get(n);r?.push({rowNum:n,feature:t,cds:null})}for(const a of r)for(const r of a){let a=n.getFrame(r.min,r.max,o??1,r.phase);a=e.featureLabelSpacer(a<0?-1*a+5:a),i.get(a)||i.set(a,[]);const s=i.get(a);s?.push({rowNum:a,feature:t,cds:r})}}}}return i}))},getFeatureLayoutPosition(e){const{featureLayouts:t}=this;for(const[n,r]of t.entries())for(const[,t]of r)for(const{feature:r}of t)if(e._id===r._id)return{layoutIndex:n,layoutRow:0,featureRow:0}}}))).views((e=>({get highestRow(){return 5}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(e.lgv.initialized&&!e.regionCannotBeRendered())for(const t of e.regions){const r=e.session.apolloDataStore.assemblies.get(t.assemblyName),a=r?.getByRefName(t.refName),o=a?.features;if(o)for(const[,r]of o)n.doesIntersect2(t.start,t.end,r.min,r.max)&&!e.seenFeatures.has(r._id)&&e.addSeenFeature(r)}}),{name:"LinearApolloSixFrameDisplaySetSeenFeatures",delay:1e3}))}})))}(0,t).named("LinearApolloSixFrameDisplayRendering").props({sequenceRowHeight:15,apolloRowHeight:20,detailsMinHeight:200,detailsHeight:200,lastRowTooltipBufferHeight:80,isShown:!0,filteredTranscripts:l.types.array(l.types.string)}).volatile((()=>({canvas:null,overlayCanvas:null,collaboratorCanvas:null,theme:void 0}))).views((e=>({get featuresHeight(){return(e.highestRow+1)*e.apolloRowHeight*(e.showFeatureLabels?2:1)+e.lastRowTooltipBufferHeight}}))).actions((e=>({toggleShown(){e.isShown=!e.isShown},setDetailsHeight(t){e.detailsHeight=e.isShown?Math.max(Math.min(t,e.height-100),Math.min(e.height,e.detailsMinHeight)):t},setCanvas(t){e.canvas=t},setOverlayCanvas(t){e.overlayCanvas=t},setCollaboratorCanvas(t){e.collaboratorCanvas=t},setTheme(t){e.theme=t},afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.collaboratorCanvas?.getContext("2d");if(t){t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);for(const n of e.session.collaborators){const{locations:r}=n;if(0===r.length)continue;let a=0;for(const o of e.lgv.displayedRegions){for(const i of r){if(i.refSeq!==o.refName)continue;const{end:r,refSeq:s,start:l}=i,c=e.lgv.bpToPx({refName:s,coord:l,regionNumber:a});if(!c)continue;const u=c.offsetPx-e.lgv.offsetPx,f=(r-l)/e.lgv.bpPerPx;t.fillStyle="rgba(0,255,0,.2)",t.fillRect(u,1,f,100),t.fillStyle="black",t.fillText(n.name,u+1,11,f-2)}a++}}}}),{name:"LinearApolloSixFrameDisplayRenderCollaborators"}))}})))}(0,t);return o.actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{const{canvas:t,featureLayouts:r,featuresHeight:a,lgv:o}=e;if(!o.initialized||e.regionCannotBeRendered())return;const{displayedRegions:i,dynamicBlocks:s}=o,l=t?.getContext("2d");if(l){l.clearRect(0,0,s.totalWidthPx,a);for(const[t,a]of r.entries()){const r=i[t];for(const[o,i]of a.entries())for(const{feature:a}of i){if(!a.looksLikeGene)continue;if(!n.doesIntersect2(r.start,r.end,a.min,a.max))continue;const{topLevelFeature:i}=a,s=e.getGlyph(i);void 0!==s&&s.draw(l,i,o,e,t)}}}}),{name:"LinearApolloSixFrameDisplayRenderFeatures"}))}})))}(0,t).named("LinearApolloSixFrameDisplayMouseEvents").volatile((()=>({apolloDragging:null,cursor:void 0,apolloHover:void 0}))).views((e=>({getMousePosition(t){const n=function(e,t){const n=e.currentTarget,{clientX:r,clientY:a}=e,{left:o,top:i}=n.getBoundingClientRect(),s=r-o,l=a-i,{coord:c,index:u,refName:f}=t.pxToBp(s);return{x:s,y:l,refName:f,bp:c,regionNumber:u}}(t,e.lgv),{bp:r,regionNumber:a,y:o}=n,i=Math.floor(o/e.apolloRowHeight)+1,s=e.featureLayouts[a].get(i);if(!s)return n;let l;if(e.geneTrackRowNums.includes(i)?(l=s.find((e=>"exon"==e.feature.type&&r>=e.feature.min&&r<=e.feature.max)),l||(l=s.find((e=>r>=e.feature.min&&r<=e.feature.max)))):l=s.find((t=>{const n=t.feature.attributes.get("gff_id")?.toString();return null!=t.cds&&r>=t.cds.min&&r<=t.cds.max&&(void 0===n||!e.filteredTranscripts.includes(n))})),!l)return n;const{feature:c,cds:u}=l,{topLevelFeature:f}=c,d=e.getGlyph(c);return{...n,featureAndGlyphUnderMouse:{cds:u,feature:c,topLevelFeature:f,glyph:d}}}}))).actions((e=>({continueDrag(t,n){if(!e.apolloDragging)throw new Error("continueDrag() called with no current drag in progress");n.stopPropagation(),e.apolloDragging={...e.apolloDragging,current:t}},setDragging(t){e.apolloDragging=t??null}}))).actions((e=>({setApolloHover(t){e.apolloHover=t},setCursor(t){e.cursor!==t&&(e.cursor=t)},updateFilteredTranscripts(t){e.filteredTranscripts=l.cast(t)}}))).actions((()=>({onClick(){}})))}(0,t);return o.views((e=>({contextMenuItems(t){const{apolloHover:n}=e;if(!n||!t)return[];const{topLevelFeature:r}=n;return e.getGlyph(r).getContextMenuItems(e)}}))).actions((e=>({startDrag(t,n,r,a=!1){e.apolloDragging={start:t,current:t,feature:n,edge:r,shrinkParent:a}},endDrag(){if(!e.apolloDragging)throw new Error("endDrag() called with no current drag in progress");const{current:t,edge:n,feature:r,start:a,shrinkParent:o}=e.apolloDragging;if(Math.abs(t.x-a.x)<=4)return e.setDragging(),void e.setCursor();const{displayedRegions:i}=e.lgv,s=e.getAssemblyId(i[a.regionNumber].assemblyName),l=np(r,t.bp,n,o),c="max"===n?new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldEnd:e.oldLocation,newEnd:e.newLocation}))),assembly:s}):new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:l.map((e=>e.featureId)),changes:l.map((e=>({featureId:e.featureId,oldStart:e.oldLocation,newStart:e.newLocation}))),assembly:s});e.changeManager.submit(c),e.setDragging(),e.setCursor()}}))).actions((e=>({onMouseDown(t){const n=e.getMousePosition(t);hj(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseDown(e,n,t)},onMouseMove(t){const n=e.getMousePosition(t);if(e.apolloDragging)return e.setCursor("col-resize"),void e.continueDrag(n,t);hj(n)?n.featureAndGlyphUnderMouse.glyph.onMouseMove(e,n,t):(e.setApolloHover(),e.setCursor())},onMouseLeave(t){e.setDragging(),e.setApolloHover();const n=e.getMousePosition(t);hj(n)&&n.featureAndGlyphUnderMouse.glyph.onMouseLeave(e,n,t)},onMouseUp(t){const n=e.getMousePosition(t);hj(n)?n.featureAndGlyphUnderMouse.glyph.onMouseUp(e,n,t):e.setSelectedFeature(),e.apolloDragging&&e.endDrag()}}))).actions((e=>({afterAttach(){l.addDisposer(e,s.autorun((()=>{if(!e.lgv.initialized||e.regionCannotBeRendered())return;const t=e.overlayCanvas?.getContext("2d");if(!t)return;t.clearRect(0,0,e.lgv.dynamicBlocks.totalWidthPx,e.featuresHeight);const{apolloDragging:n,apolloHover:r}=e;if(!r)return;const{glyph:a}=r;a.drawHover(e,t),a.drawTooltip(e,t),n&&e.getGlyph(n.feature.topLevelFeature).drawDragPreview(e,t)}),{name:"LinearApolloSixFrameDisplayRenderMouseoverAndDrag"}))}})))}(0,t).props({tabularEditor:l.types.optional(cM,{})}).named("LinearApolloSixFrameDisplay")}const gj=r.ConfigurationSchema("ApolloPlugin",{ontologies:l.types.array(EN),featureTypeOntologyName:{description:"Name of the feature type ontology",type:"string",defaultValue:"Sequence Ontology"},hasRole:{description:"Flag used internally by jbrowse-plugin-apollo",type:"boolean",defaultValue:!1}}),yj=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogene")||n.isTypeOf(e.type,"pseudogenic_transcript")},vj=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"gene")||n.isTypeOf(e.type,"pseudogene")},bj=(e,t)=>{const{featureTypeOntology:n}=t.apolloDataStore.ontologyManager;if(!n)throw new Error("featureTypeOntology is undefined");return n.isTypeOf(e.type,"transcript")||n.isTypeOf(e.type,"pseudogenic_transcript")};function _j(e){const{attributes:t}=e,n=["gene_name","gene_id","gene_stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}const wj=e=>{const t=function(e){const{attributes:t}=e,n=["name","gff_name","transcript_name","gene_name"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e),n=function(e){const{attributes:t}=e,n=["id","gff_id","transcript_id","gene_id","gene_stable_id","stable_id"];for(const e of n){const n=t?.[e];if(n?.[0])return n[0]}return""}(e);return t?`${e.type} - ${t}`:n?`${e.type} - ${n}`:e.type};function xj({annotationFeature:e,assembly:t,handleClose:n,refSeqId:r,session:a,region:o}){const i=a,{featureTypeOntology:s}=i.apolloDataStore.ontologyManager,f=u.useMemo((()=>Object.keys(e.children??{})),[e]),[d,p]=u.useState(!0),[h,m]=u.useState(f),[g,y]=u.useState(""),[v,b]=u.useState([]),[_,w]=u.useState(!1),[x,S]=u.useState(),E=i.apolloDataStore.assemblies.get(t.name),k=E?.refSeqs.get(r),A=k?.getFeatures(o.start,o.end),C=()=>{const t=[];for(const n of A??[])if(!(n.min>o.end||n.max<o.start)&&s?.isTypeOf(n.type,"gene")&&n.strand===e.strand){const e=l.getSnapshot(n);t.push(e)}return t};u.useEffect((()=>{y("");const e=C();b(e),S(e[0])}),[h,d,o]);const O=async e=>{if(x)for(const n of Object.keys(e)){const r=new tr.AddFeatureChange({parentFeatureId:x._id,changedIds:[x._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:e[n]});await I(r)}},T=async n=>{const a=(new Vn).toHexString(),o=Math.min(...Object.values(n).map((e=>e.min))),i=Math.max(...Object.values(n).map((e=>e.max))),s=new tr.AddFeatureChange({changedIds:[a],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{_id:a,refSeq:r,min:o,max:i,strand:e.strand,type:"gene",children:n,attributes:{name:[_j(e)],gene_name:[_j(e)]}}});await I(s)},N=async(e,n)=>{if(!x)return;const r=[];e!==x.min&&r.push(new tr.LocationStartChange({typeName:"LocationStartChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldStart:x.min,newStart:e})),n!==x.max&&r.push(new tr.LocationEndChange({typeName:"LocationEndChange",changedIds:[x._id],featureId:x._id,assembly:t.name,oldEnd:x.max,newEnd:n}));for(const e of r)await I(e)},I=async e=>{await i.apolloDataStore.changeManager.submit(e)};return R.default.createElement(_p,{open:!0,title:"Create Apollo Annotation",handleClose:n,fullWidth:!0,maxWidth:"sm"},R.default.createElement(c.DialogTitle,{fontSize:15},"Select the feature to be copied to apollo track"),R.default.createElement(c.DialogContent,null,R.default.createElement(c.Box,{sx:{ml:3}},yj(e,i)&&R.default.createElement(c.FormControlLabel,{control:R.default.createElement(c.Checkbox,{size:"small",checked:d,onChange:e=>{const t=e.target.checked;p(t),m(t?f:[])}}),label:`${wj(e)} (${e.min+1}..${e.max})`}),e.children&&R.default.createElement(c.Box,{sx:{display:"flex",flexDirection:"column",ml:3}},Object.values(e.children).filter((e=>bj(e,i))).map((e=>R.default.createElement(c.FormControlLabel,{key:e._id,control:R.default.createElement(c.Checkbox,{size:"small",checked:h.includes(e._id),onChange:t=>{((e,t)=>{m((n=>e.target.checked?[...n,t._id]:n.filter((e=>e!==t._id))))})(t,e)}}),label:`${wj(e)} (${e.min+1}..${e.max})`}))))),v.length>0&&(!d&&h.length>0||d&&bj(e,i))&&R.default.createElement("div",{style:{border:"1px solid #ccc",marginTop:20,padding:10,borderRadius:5}},R.default.createElement(c.Box,{sx:{ml:3}},R.default.createElement(c.Typography,{variant:"caption",fontSize:12},"Select the destination feature to copy the selected features"),R.default.createElement(c.Box,{sx:{mt:1}},R.default.createElement(c.Select,{labelId:"label",style:{width:"100%"},value:x?._id??"",onChange:e=>{const t=v.find((t=>t._id===e.target.value));S(t)},disabled:_},v.map((e=>R.default.createElement(c.MenuItem,{key:e._id,value:e._id},`${wj(e)} (${e.min+1}..${e.max})`)))))),R.default.createElement(c.Box,{sx:{ml:3}},R.default.createElement(c.FormGroup,null,R.default.createElement(c.FormControlLabel,{control:R.default.createElement(c.Checkbox,{checked:_,onChange:e=>{w(e.target.checked)}}),label:"Create new gene"}))))),R.default.createElement(c.DialogActions,null,R.default.createElement(c.Button,{variant:"contained",type:"submit",disabled:0===h.length||!d&&h.length>0&&!x,onClick:async()=>{if(d){if(vj(e,i)&&(await(async()=>{let n;if(e.children&&h.length!==Object.values(e.children).length){const r={};for(const t of h)r[t]=e.children[t];n=new tr.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:{...e,children:r}})}else n=new tr.AddFeatureChange({changedIds:[e._id],typeName:"AddFeatureChange",assembly:t.name,addedFeature:e});await I(n)})(),a.notify("Successfully copied selected gene and transcript(s)","success")),bj(e,i))if(x&&!_){const t={};if(t[e._id]=e,x.max<e.max||x.min>e.min){const n=Math.min(x.min,e.min),r=Math.max(x.max,e.max);await N(n,r),await O(t)}else await O(t);a.notify("Successfully copied selected transcripts to destination gene","success")}else{const t={};t[e._id]=e,await T(t),a.notify("Successfully created a new gene with selected transcripts","success")}}else{if(!e.children)return;if(x&&!_){const t={};for(const n of h)t[n]=e.children[n];const n=Math.min(...Object.values(t).map((e=>e.min))),r=Math.max(...Object.values(t).map((e=>e.max)));if(x.min>n||x.max<r){const e=Math.min(x.min,n),a=Math.max(x.max,r);await N(e,a),await O(t)}else await O(t);a.notify("Successfully copied transcript to destination gene","success")}else{const t={};for(const n of h)t[n]=e.children[n];await T(t),a.notify("Successfully created a new gene with selected transcript","success")}}n()}},"Create"),R.default.createElement(c.Button,{variant:"outlined",type:"submit",onClick:n},"Cancel")),g?R.default.createElement(c.DialogContent,null,R.default.createElement(c.DialogContentText,{color:"error"},g)):null)}function Sj(e){if("LinearPileupDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(){const t=e.contextMenuFeature,n=e.getAssembly(),r=e.getRefSeqId(n),a=t.get("start"),o=t.get("end"),i=t.get("strand"),s=t.get("name"),l=function(e){const t=/(\d+)([MIDNSHPX=])/g,n=[];let r;for(;null!==(r=t.exec(e));)n.push([r[2],Number.parseInt(r[1],10)]);return n}(t.get("CIGAR"));let c,u=a;const f=[];for(const[e,t]of l)switch(e){case"M":case"=":case"X":void 0===c&&(c=u),u+=t;break;case"N":void 0!==c&&(f.push({start:c,end:u}),c=void 0),u+=t;break;case"D":u+=t;break;case"I":case"S":case"H":case"P":break;default:throw new Error(`Unknown CIGAR operation: ${e}`)}void 0!==c&&f.push({start:c,end:u});const d={_id:Vn().toHexString(),refSeq:r,min:a,max:o,type:"mRNA",strand:i,attributes:{name:[s]}};if(0===f.length)return d;d.children={};for(const e of f){const t={_id:Vn().toHexString(),refSeq:r,min:e.start,max:e.end,type:"exon",strand:i};d.children[t._id]=t}return d}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:Nc,onClick:()=>{r.queueDialog((t=>[xj,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}function Ej(e,t){const n=JSON.parse(JSON.stringify(e)),r=n.subfeatures;return[{start:n.start+1,end:n.end,seq_id:t,source:n.source??null,type:n.type??null,score:n.score??null,strand:n.strand?1===n.strand?"+":"-":null,phase:null!==n.phase||void 0!==n.phase?n.phase:null,attributes:Aj(n),derived_features:[],child_features:r?r.map((e=>Ej(e,t))):[]}]}function kj(e,t){return tr.gff3ToAnnotationFeature(Ej(e,t))}function Aj(e){const t={},n=new Set(["start","end","type","strand","refName","subfeatures","derived_features","phase","source","score"]);for(const[r,a]of Object.entries(e))n.has(r)||(t[r]=Array.isArray(a)?a.map(String):[String(a)]);return t}function Cj(e){if("LinearBasicDisplay"!==e.name)return e;const{stateModel:t}=e,r=t.views((e=>({getFirstRegion:()=>n.getContainingView(e).dynamicBlocks.contentBlocks[0],getAssembly(){const t=e.getFirstRegion(),r=n.getSession(e),{assemblyManager:a}=r,{assemblyName:o}=t,i=a.get(o);if(!i)throw new Error(`Could not find assembly named ${o}`);return i},getRefSeqId(t){const n=e.getFirstRegion(),{refName:r}=n,{refNameAliases:a}=t;if(!a)throw new Error(`Could not find aliases for ${t.name}`);const o=[...Object.entries(a)].filter((([e,t])=>e!==t)).map((([e,t])=>({_id:e,name:t}))),i=o.find((e=>e.name===r))?._id;if(!i)throw new Error(`Could not find refSeqId named ${r}`);return i},getAnnotationFeature(t){const n=e.getRefSeqId(t);return kj(e.contextMenuFeature.data,n)}}))).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=n.getSession(e),a=e.getAssembly(),o=e.getFirstRegion();return e.contextMenuFeature?[...t(),{label:"Create Apollo annotation",icon:Nc,onClick:()=>{r.queueDialog((t=>[xj,{session:r,handleClose:()=>{t()},annotationFeature:e.getAnnotationFeature(a),assembly:a,refSeqId:e.getRefSeqId(a),region:o}]))}}]:t()}}}));return e.stateModel=r,e}var Oj={},Tj=Cc.exports;Object.defineProperty(Oj,"__esModule",{value:!0});var Nj=Oj.default=void 0;Nj=Oj.default=(0,Tj(Oc).default)((0,T.default.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var Rj={},Ij=Cc.exports;Object.defineProperty(Rj,"__esModule",{value:!0});var Pj=Rj.default=void 0;Pj=Rj.default=(0,Ij(Oc).default)((0,T.default.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}),"Error");const Fj=f.makeStyles()((e=>({canvasContainer:{position:"relative",left:0},canvas:{position:"absolute",left:0},ellipses:{textOverflow:"ellipsis",overflow:"hidden"},avatar:{position:"absolute",color:e.palette.warning.light,backgroundColor:e.palette.warning.contrastText},loading:{position:"absolute",right:e.spacing(3),zIndex:10,pointerEvents:"none",textAlign:"right"}}))),Mj=p.observer((function(e){const t=c.useTheme(),{model:r}=e,{loading:a,apolloDragging:o,apolloRowHeight:i,contextMenuItems:s,cursor:l,featuresHeight:f,isShown:p,onMouseDown:h,onMouseLeave:m,onMouseMove:g,onMouseUp:y,regionCannotBeRendered:v,session:b,setCanvas:_,setCollaboratorCanvas:w,setOverlayCanvas:x,setSeqTrackCanvas:S,setSeqTrackOverlayCanvas:E,setTheme:k}=r,{classes:A}=Fj(),C=n.getContainingView(r);u.useEffect((()=>{k(t)}),[t,k]);const[O,T]=u.useState(),[N,I]=u.useState([]),P=v();if(!p)return null;const{assemblyManager:F}=b;return R.default.createElement(R.default.Fragment,null,3/C.bpPerPx>=1?R.default.createElement("div",{className:A.canvasContainer,style:{width:C.dynamicBlocks.totalWidthPx,height:C.bpPerPx<=1?125:95}},R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),S(e)},width:C.dynamicBlocks.totalWidthPx,height:C.bpPerPx<=1?125:95,className:A.canvas,"data-testid":"seqTrackCanvas"}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),E(e)},width:C.dynamicBlocks.totalWidthPx,height:C.bpPerPx<=1?125:95,className:A.canvas,"data-testid":"seqTrackOverlayCanvas"})):null,R.default.createElement("div",{className:A.canvasContainer,style:{width:C.dynamicBlocks.totalWidthPx,height:f},onContextMenu:e=>{e.preventDefault(),N.length>0?I([]):(T([e.clientX,e.clientY]),I(s(e)))}},a?R.default.createElement("div",{className:A.loading},R.default.createElement(c.CircularProgress,{size:"18px"})):null,P?R.default.createElement(c.Alert,{severity:"warning",classes:{message:A.ellipses}},R.default.createElement(c.Tooltip,{title:P},R.default.createElement("div",null,P))):R.default.createElement(R.default.Fragment,null,R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),w(e)},width:C.dynamicBlocks.totalWidthPx,height:f,className:A.canvas,"data-testid":"collaboratorCanvas"}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),_(e)},width:C.dynamicBlocks.totalWidthPx,height:f,className:A.canvas,"data-testid":"canvas"}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),x(e)},width:C.dynamicBlocks.totalWidthPx,height:f,onMouseMove:g,onMouseLeave:m,onMouseDown:h,onMouseUp:y,className:A.canvas,style:{cursor:l??"default"},"data-testid":"overlayCanvas"}),C.displayedRegions.flatMap(((e,t)=>{const a=F.get(e.assemblyName);return[...b.apolloDataStore.checkResults.values()].filter((t=>a?.isValidRefName(t.refSeq)&&a.getCanonicalRefName(t.refSeq)===e.refName&&n.doesIntersect2(e.start,e.end,t.start,t.end))).map((n=>{const a=(C.bpToPx({refName:e.refName,coord:n.start,regionNumber:t})?.offsetPx??0)-C.offsetPx,[s]=n.ids;if(!s)return null;let l=0;const u=r.getFeatureLayoutPosition(s);return u&&(l=u.layoutRow+u.featureRow),R.default.createElement(c.Tooltip,{key:n._id,title:n.message},R.default.createElement(c.Avatar,{className:A.avatar,style:{top:l*i,left:a,height:i,width:i,pointerEvents:o?"none":"auto"}},R.default.createElement(Pj,{"data-testid":"ErrorIcon"})))}))})),R.default.createElement(d.Menu,{open:N.length>0,onMenuItemClick:(e,t)=>{t(),I([])},onClose:()=>{I([])},TransitionProps:{onExit:()=>{I([])}},anchorReference:"anchorPosition",anchorPosition:O?{top:O[1],left:O[0]}:void 0,style:{zIndex:t.zIndex.tooltip},menuItems:N}))))})),jj=p.observer((function({model:e,hrStyle:t={margin:0,top:0,color:"black"},idx:n=0}){const{apolloRowHeight:r,highestRow:a,showFeatureLabels:o}=e,i=o?2:1;return R.default.createElement("div",{style:{position:"absolute",left:0,top:r*i*(a+1)/2+n*i*r,width:"100%"}},R.default.createElement("hr",{style:t}))})),Dj=f.makeStyles()((e=>({canvasContainer:{position:"relative",left:0},canvas:{position:"absolute",left:0},ellipses:{textOverflow:"ellipsis",overflow:"hidden"},avatar:{position:"absolute",color:e.palette.warning.light,backgroundColor:e.palette.warning.contrastText}}))),Lj=p.observer((function(e){const t=c.useTheme(),{model:r}=e,{apolloRowHeight:a,contextMenuItems:o,cursor:i,featuresHeight:s,isShown:l,onMouseDown:f,onMouseLeave:p,onMouseMove:h,onMouseUp:m,regionCannotBeRendered:g,session:y,setCanvas:v,setCollaboratorCanvas:b,setOverlayCanvas:_,setTheme:w}=r,{classes:x}=Dj(),S=n.getContainingView(r);u.useEffect((()=>{w(t)}),[t,w]);const[E,k]=u.useState(),[A,C]=u.useState([]),O=g();if(!l)return null;const{assemblyManager:T}=y;return R.default.createElement(R.default.Fragment,null,R.default.createElement("div",{className:x.canvasContainer,style:{width:S.dynamicBlocks.totalWidthPx,height:s},onContextMenu:e=>{if(e.preventDefault(),A.length>0)C([]);else{const t=[e.clientX,e.clientY];k(t),C(o(t))}}},O?R.default.createElement(c.Alert,{severity:"warning",classes:{message:x.ellipses}},R.default.createElement(c.Tooltip,{title:O},R.default.createElement("div",null,O))):R.default.createElement(R.default.Fragment,null,R.default.createElement(jj,{model:r,idx:0}),R.default.createElement(jj,{model:r,hrStyle:{margin:0,top:0,color:"grey",opacity:.4},idx:1}),R.default.createElement(jj,{model:r,idx:2}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),b(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"collaboratorCanvas"}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),v(e)},width:S.dynamicBlocks.totalWidthPx,height:s,className:x.canvas,"data-testid":"canvas"}),R.default.createElement("canvas",{ref:async e=>{await Promise.resolve(),_(e)},width:S.dynamicBlocks.totalWidthPx,height:s,onMouseMove:h,onMouseLeave:p,onMouseDown:f,onMouseUp:m,className:x.canvas,style:{cursor:i??"default"},"data-testid":"overlayCanvas"}),S.displayedRegions.flatMap(((e,t)=>{const r=T.get(e.assemblyName);return[...y.apolloDataStore.checkResults.values()].filter((t=>r?.isValidRefName(t.refSeq)&&r.getCanonicalRefName(t.refSeq)===e.refName&&n.doesIntersect2(e.start,e.end,t.start,t.end))).map((n=>{const r=(S.bpToPx({refName:e.refName,coord:n.start,regionNumber:t})?.offsetPx??0)-S.offsetPx,[o]=n.ids;return o&&o.parent?.looksLikeGene?R.default.createElement(c.Tooltip,{key:n._id,title:n.message},R.default.createElement(c.Avatar,{className:x.avatar,style:{top:0,left:r,height:a,width:a}},R.default.createElement(Pj,null))):null}))})),R.default.createElement(d.Menu,{open:A.length>0,onMenuItemClick:(e,t)=>{t(),C([])},onClose:()=>{C([])},TransitionProps:{onExit:()=>{C([])}},anchorReference:"anchorPosition",anchorPosition:E?{top:E[1],left:E[0]}:void 0,style:{zIndex:t.zIndex.tooltip},menuItems:A}))))})),qj=f.makeStyles()((e=>({shading:{background:c.alpha(e.palette.primary.main,.2),overflowY:"scroll",overflowX:"hidden"},details:{background:e.palette.background.paper},accordionControl:{height:12,width:"100%","&:hover":{background:e.palette.action.hover},display:"flex",alignItems:"center",justifyContent:"center"},accordionRoot:{background:e.palette.divider},resizeHandle:{width:"100%",height:4,position:"absolute",cursor:"row-resize",zIndex:100},expandIcon:{},title:{userSelect:"none"},alertContainer:{display:"flex",alignItems:"center",justifyContent:"center"}})));function Bj(e,t){const{apolloRowHeight:n,selectedFeature:r}=e;if(t.current&&r){const a=e.getFeatureLayoutPosition(r);a&&t.current.scroll({top:(a.layoutRow+a.featureRow)*n,behavior:"smooth"})}}const Uj=({onResize:e})=>{const{classes:t}=qj(),n=u.useCallback((t=>{t.stopPropagation(),t.preventDefault(),e(t.movementY)}),[e]),r=u.useCallback((e=>{e.stopPropagation(),e.preventDefault(),globalThis.removeEventListener("mousemove",n),globalThis.removeEventListener("mouseup",r),globalThis.removeEventListener("mouseleave",r)}),[n]);return R.default.createElement("div",{onMouseDown:e=>{e.stopPropagation(),globalThis.addEventListener("mousemove",n),globalThis.addEventListener("mouseup",r),globalThis.addEventListener("mouseleave",r)},onClick:e=>{e.stopPropagation(),e.preventDefault()},className:t.resizeHandle})},zj=p.observer((function({onClick:e,onResize:t,open:n,title:r}){const{classes:a}=qj();return R.default.createElement("div",{className:a.accordionRoot},n&&t?R.default.createElement(Uj,{onResize:t}):null,R.default.createElement("div",{className:a.accordionControl,onClick:e},R.default.createElement(n?Nj:BR,{className:a.expandIcon}),r?R.default.createElement(c.Typography,{className:a.title,variant:"caption",component:"span"},r):null))})),Gj=p.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=qj(),{graphical:l,height:f,isShown:d,selectedFeature:p,table:h,tabularEditor:m,toggleShown:g}=e,y=u.useRef(null);u.useEffect((()=>{Bj(e,y)}),[e,p]);const v=t=>{e.setDetailsHeight(e.detailsHeight-t)};if(!i)return R.default.createElement("div",{className:s.alertContainer},R.default.createElement(c.Alert,{severity:"error"},"Could not load feature type ontology."));if(l&&h){const n=m.isShown?e.detailsHeight:0,r=d?f-e.detailsHeight-24:0;return R.default.createElement("div",{style:{height:f}},R.default.createElement(zj,{open:d,title:"Graphical",onClick:g}),R.default.createElement("div",{className:s.shading,ref:y,style:{height:r}},R.default.createElement(Mj,{model:e,...t})),R.default.createElement(zj,{title:"Table",open:m.isShown,onClick:m.togglePane,onResize:v}),R.default.createElement("div",{className:s.details,style:{height:n}},R.default.createElement(lM,{model:e})))}return l?R.default.createElement("div",{className:s.shading,ref:y,style:{height:f}},R.default.createElement(Mj,{model:e,...t})):R.default.createElement("div",{className:s.details,style:{height:f}},R.default.createElement(lM,{model:e}))})),Hj=p.observer((function({model:e,...t}){const r=n.getSession(e),{ontologyManager:a}=r.apolloDataStore,{featureTypeOntology:o}=a,i=o?.dataStore,{classes:s}=qj(),{detailsHeight:l,graphical:f,height:d,isShown:p,selectedFeature:h,table:m,tabularEditor:g,toggleShown:y}=e,v=u.useRef(null);u.useEffect((()=>{Bj(e,v)}),[e,h]);const b=t=>{e.setDetailsHeight(l-t)};if(!i)return R.default.createElement("div",{className:s.alertContainer},R.default.createElement(c.Alert,{severity:"error"},"Could not load feature type ontology."));if(f&&m){const n=g.isShown?l:0,r=p?d-l-24:0;return R.default.createElement("div",{style:{height:d}},R.default.createElement(zj,{open:p,title:"Graphical",onClick:y}),R.default.createElement("div",{className:s.shading,ref:v,style:{height:r}},R.default.createElement(Lj,{model:e,...t})),R.default.createElement(zj,{title:"Table",open:g.isShown,onClick:g.togglePane,onResize:b}),R.default.createElement("div",{className:s.details,style:{height:n}},R.default.createElement(lM,{model:e})))}return f?R.default.createElement("div",{className:s.shading,ref:v,style:{height:d}},R.default.createElement(Lj,{model:e,...t})):R.default.createElement("div",{className:s.details,style:{height:d}},R.default.createElement(lM,{model:e}))}));var $j={},Wj=Cc.exports;Object.defineProperty($j,"__esModule",{value:!0});var Vj=$j.default=void 0;Vj=$j.default=(0,Wj(Oc).default)((0,T.default.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save");const Jj=l.types.model("JobsManager",{}).views((e=>({get jobStatusWidget(){const{widgets:t}=n.getSession(e);let r=t.get("JobsList");return r||(r=n.getSession(e).addWidget("JobsListWidget","JobsList")),r}}))).actions((e=>({update(t,n,r){e.jobStatusWidget.updateJobStatusMessage(t,n),r&&e.jobStatusWidget.updateJobProgressPct(t,r)},abortJob(t,r){const a=n.getSession(e);if(n.isSessionModelWithWidgets(a)){a.showWidget(e.jobStatusWidget),e.jobStatusWidget.updateJobStatusMessage(t,r??"Aborted unexpectedly");const n=e.jobStatusWidget.jobs.findIndex((e=>e.name===t));e.jobStatusWidget.addAbortedJob({...e.jobStatusWidget.jobs[n]}),e.jobStatusWidget.removeJob(t),a.notify("Job aborted","info")}},runJob(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.addJob(t))},done(t){const r=n.getSession(e);n.isSessionModelWithWidgets(r)&&(r.showWidget(e.jobStatusWidget),e.jobStatusWidget.removeJob(t.name),e.jobStatusWidget.addFinishedJob({name:t.name,statusMessage:"All operations successful",progressPct:100,cancelCallback:t.cancelCallback}))}})));class Yj{clientStore;constructor(e){this.clientStore=e}}class Kj{dataStore;constructor(e){this.dataStore=e}recentChanges=[];async submit(e,t={}){const{addToRecents:r=!0,submitToBackend:a=!0,updateJobsManager:o=!1}=t,i=n.getSession(this.dataStore),s=new AbortController,{jobsManager:l}=n.getSession(this.dataStore),c={name:e.typeName,statusMessage:"Pre-validating",progressPct:0,cancelCallback:()=>{s.abort()}};o&&l.runJob(c);const u=await tr.validationRegistry.frontendPreValidate(e);if(!u.ok){const e=`Pre-validation failed: "${u.resultsMessages}"`;return o&&l.abortJob(c.name,e),void i.notify(e,"error")}try{await e.execute(this.dataStore)}catch(e){return o&&l.abortJob(c.name,String(e)),console.error(e),void i.notify(`Error encountered in client: ${String(e)}. Data may be out of sync, please refresh the page`,"error")}if((await tr.validationRegistry.frontendPostValidate(e,this.dataStore)).ok||await this.revert(e),a){o&&l.update(c.name,"Submitting to driver");const{collaborationServerDriver:n,getBackendDriver:a}=this.dataStore,s=B.isAssemblySpecificChange(e)?a(e.assembly):n;let f;try{f=await s.submitChange(e,t)}catch(t){return o&&l.abortJob(c.name,String(t)),console.error(t),i.notify(String(t),"error"),void await this.revert(e,!1)}if(!f.ok){const t=`Post-validation failed: "${u.resultsMessages}"`;return o&&l.abortJob(c.name,t),i.notify(t,"error"),void await this.revert(e,!1)}e.notification&&i.notify(e.notification,"success"),r&&this.recentChanges.push(e)}o&&l.done(c)}async revert(e,t=!0){const n=e.getInverse();return this.submit(n,{submitToBackend:t,addToRecents:!1})}async revertLastChange(){const e=this.recentChanges.pop();if(e)return this.revert(e);n.getSession(this.dataStore).notify("No changes to undo!","warning")}}class Zj extends Yj{inFlight=new Map;async fetch(e,t,n){return e.getFetcher({locationType:"UriLocation",uri:t.toString()})(t,n)}async searchFeatures(e,t){const n=this.clientStore.getInternetAccount(t[0]),{baseURL:r}=n,a=new URL("features/searchFeatures",r),o=new URLSearchParams({assemblies:t.join(","),term:e});a.search=o.toString();const i=a.toString(),s=await this.fetch(n,i);if(!s.ok){const e=await rp(s,"searchFeatures failed");throw new Error(e)}return s.json()}async getFeatures(e){const{assemblyName:t,end:a,refName:o,start:i}=e,{assemblyManager:s}=n.getSession(this.clientStore),l=s.get(t);if(!l)throw new Error(`Could not find assembly with name "${t}"`);const{ids:c}=r.getConf(l,["sequence","metadata"]),u=c[o];if(!u)throw new Error(`Could not find refSeq "${o}"`);const f=this.clientStore.getInternetAccount(t),{baseURL:d}=f,p=new URL("features/getFeatures",d),h=new URLSearchParams({refSeq:u,start:String(i),end:String(a)});p.search=h.toString();const m=p.toString(),g=await this.fetch(f,m);if(!g.ok){const e=await rp(g,"getFeatures failed");throw new Error(e)}return this.checkSocket(t,o,f),g.json()}checkSocket(e,t,n){const{socket:r}=n,a=n.retrieveToken(),o=`${e}-${t}`,i=new Kj(this.clientStore);r.hasListeners(o)||r.on(o,(async e=>{if(n.setLastChangeSequenceNumber(Number(e.changeSequence)),e.userSessionId!==a&&e.channel===o){const t=B.Change.fromJSON(e.changeInfo);await i.submit(t,{submitToBackend:!1})}}))}async getSequence(e){const t=`${e.refName}:${e.start}-${e.end}`,a=this.inFlight.get(t),{assemblyName:o,end:i,refName:s,start:l}=e,{assemblyManager:c}=n.getSession(this.clientStore),u=c.get(o);if(!u)throw new Error(`Could not find assembly with name "${o}"`);const{ids:f}=r.getConf(u,["sequence","metadata"]),d=f[s];if(!d)throw new Error(`Could not find refSeq "${s}"`);if(a)return{seq:await a,refSeq:d};let p=this.clientStore.assemblies.get(o);p||(p=this.clientStore.addAssembly(o));let h=p.refSeqs.get(d);h||(h=p.addRefSeq(d,s));const m=h.getSequence(l,i);if(m.length===i-l)return{seq:m,refSeq:d};const g=this.clientStore.getInternetAccount(o),{baseURL:y}=g,v=new URL("sequence",y),b=new URLSearchParams({refSeq:d,start:String(l),end:String(i)});v.search=b.toString();const _=v.toString(),w=this.getSeqFromServer(g,_,h,l,i);this.inFlight.set(t,w);const x=await w;return this.checkSocket(o,s,g),this.inFlight.delete(t),{seq:x,refSeq:d}}async getSeqFromServer(e,t,n,r,a){const o=await this.fetch(e,t);if(!o.ok){let e;try{e=await o.text()}catch{e=""}throw new Error(`getSequence failed: ${o.status} (${o.statusText})${e?` (${e})`:""}`)}const i=await o.text();return n.addSequence({sequence:i,start:r,stop:a}),i}async getRefNameAliases(e){const{assemblyManager:t}=n.getSession(this.clientStore);if(!t.get(e))throw new Error(`Could not find assembly with name "${e}"`);const r=this.clientStore.getInternetAccount(e),{baseURL:a}=r,o=new URL("refSeqs",a),i=new URLSearchParams({assembly:e});o.search=i.toString();const s=o.toString(),l=await this.fetch(r,s);if(!l.ok){let e;try{e=await l.text()}catch{e=""}throw new Error(`getRefNameAliases failed: ${l.status} (${l.statusText})${e?` (${e})`:""}`)}return(await l.json()).map((e=>({refName:e.name,aliases:[e._id,...e.aliases],uniqueId:`alias-${e._id}`})))}async getRegions(e){const{assemblyManager:t}=n.getSession(this.clientStore);if(!t.get(e))throw new Error(`Could not find assembly with name "${e}"`);const r=this.clientStore.getInternetAccount(e),{baseURL:a}=r,o=new URL("refSeqs",a),i=new URLSearchParams({assembly:e});o.search=i.toString();const s=o.toString(),l=await this.fetch(r,s);if(!l.ok){let e;try{e=await l.text()}catch{e=""}throw new Error(`getRegions failed: ${l.status} (${l.statusText})${e?` (${e})`:""}`)}return(await l.json()).map((e=>({refName:e.name,start:0,end:e.length})))}getAssemblies(e){const{assemblyManager:t}=n.getSession(this.clientStore);return t.assemblies.filter((t=>{const n=r.getConf(t,["sequence","metadata"]);return!(!(n&&n.apollo&&n.internetAccountConfigId)||e&&n.internetAccountConfigId!==e)}))}async submitChange(e,t={}){const{internetAccountId:n}=t,r=this.clientStore.getInternetAccount("assembly"in e?e.assembly:void 0,n),{baseURL:a}=r,o=new URL("changes",a).href,i=await this.fetch(r,o,{method:"POST",body:JSON.stringify(e.toJSON()),headers:{"Content-Type":"application/json"}});if(!i.ok){const e=await rp(i,"submitChange failed");throw new Error(e)}const s=new tr.ValidationResultSet;return i.ok||(s.ok=!1),s}}class Xj extends Yj{async getFeatures(){return[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=this.clientStore.assemblies.get(t);if(!o)return{seq:"",refSeq:r};const i=o.refSeqs.get(r);return i?{seq:i.getSequence(a,n),refSeq:r}:{seq:"",refSeq:r}}async getRefNameAliases(e){const t=this.clientStore.assemblies.get(e),n=[];if(!t)return n;for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getRegions(e){const t=this.clientStore.assemblies.get(e);if(!t)return[];const n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=r.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.file&&!t.internetAccountConfigId)}))}async submitChange(e,t={}){const{clientStore:n}=this,{assemblies:r}=n;n.clearCheckResults();for(const[,e]of r)if("InMemoryFileDriver"===e.backendDriverType){const t=await Vd(e);n.addCheckResults(t)}return new tr.ValidationResultSet}async searchFeatures(e,t){return[]}}class Qj extends Yj{async loadAssembly(e){const{assemblyManager:t}=n.getSession(this.clientStore),a=t.get(e);if(!a)throw new Error(`Assembly ${e} not found`);const{file:o}=r.getConf(a,["sequence","metadata"]),i=require("node:fs");return Wd(e,await i.promises.readFile(o,"utf8"),this.clientStore)}async getAssembly(e){let t=this.clientStore.assemblies.get(e);return t||(t=await this.loadAssembly(e)),t}async getRefNameAliases(e){const t=await this.getAssembly(e),n=[];for(const[,e]of t.refSeqs)n.push({refName:e.name,aliases:[e._id],uniqueId:`alias-${e._id}`});return n}async getFeatures(e){return await this.getAssembly(e.assemblyName),[[],[]]}async getSequence(e){const{assemblyName:t,end:n,refName:r,start:a}=e,o=(await this.getAssembly(t)).refSeqs.get(r);if(!o)throw new Error(`refSeq ${r} not found in client data store`);return{seq:o.getSequence(a,n),refSeq:r}}async getRegions(e){const t=await this.getAssembly(e),n=[];for(const[,r]of t.refSeqs)n.push({assemblyName:e,refName:r.name,start:r.sequence[0].start,end:r.sequence[0].stop});return n}getAssemblies(){const{assemblyManager:e}=n.getSession(this.clientStore);return e.assemblies.filter((e=>{const t=r.getConf(e,["sequence","metadata"]);return Boolean(t&&t.apollo&&!t.internetAccountConfigId&&t.file)}))}async submitChange(e){if(!B.isAssemblySpecificChange(e))throw new Error(`Cannot use this type of change with local file: "${e.typeName}"`);const{assemblyManager:t}=n.getSession(this.clientStore),a=t.get(e.assembly);if(!a)throw new Error(`Could not find assembly with name "${e.assembly}"`);const{file:o}=r.getConf(a,["sequence","metadata"]),i=this.clientStore.assemblies.get(e.assembly);if(!i)throw new Error(`Could not find assembly in client with name "${e.assembly}"`);const s=new Set(...i.refSeqs.keys()),{checkResults:c}=this.clientStore;for(const e of c.values())s.has(e.refSeq)&&c.delete(e._id);const u=await Vd(i);this.clientStore.addCheckResults(u);const f=[{directive:"gff-version",value:"3"}];for(const[,e]of i.refSeqs)f.push({directive:"sequence-region",value:`${e.name} 1 ${e.sequence[0].stop}`});for(const e of i.comments)f.push({comment:e});for(const[,e]of i.refSeqs){const{features:t}=e;for(const[,e]of t)f.push(tr.annotationFeatureToGFF3(l.getSnapshot(e)))}for(const[,e]of i.refSeqs){const[t]=e.sequence,n=tr.splitStringIntoChunks(t.sequence,80).join("\n");f.push({id:e.name,description:e.description,sequence:n})}const d=$d.formatSync(f),p=require("node:fs");return await p.promises.writeFile(o,d,"utf8"),new tr.ValidationResultSet}async searchFeatures(e,t){return[]}}function eD(e,t){const a=new AbortController,{signal:o}=a,i=e.evaluateExtensionPoint("Apollo-extendAnnotationFeature",pI.AnnotationFeatureModel),c=function(e){return l.types.model("ClientDataStore",{typeName:l.types.optional(l.types.literal("Client"),"Client"),assemblies:l.types.map(pI.ApolloAssembly),checkResults:l.types.map(pI.CheckResult),ontologyManager:l.types.optional(xN,{})}).views((t=>({get internetAccounts(){return l.getRoot(t).internetAccounts},get pluginConfiguration(){return l.getRoot(t).jbrowse.configuration.ApolloPlugin},getFeature:n=>l.resolveIdentifier(e,t.assemblies,n)}))).actions((e=>({addAssembly(t,n){const r={_id:t,refSeqs:{}};return n&&(r.backendDriverType=n),e.assemblies.put(r)},addFeature(t,n){const r=e.assemblies.get(t);if(!r)throw new Error(`Could not find assembly "${t}" to add feature "${n._id}"`);const a=r.refSeqs.get(n.refSeq);if(!a)throw new Error(`Could not find refSeq "${n.refSeq}" to add feature "${n._id}"`);a.features.put(n)},deleteFeature(t){const n=e.getFeature(t);if(!n)throw new Error(`Could not find feature "${t}" to delete`);const{_id:r,parent:a}=n;a?a.deleteChild(t):l.getParentOfType(n,pI.ApolloRefSeq).deleteFeature(r)},deleteAssembly(t){e.assemblies.delete(t)},addCheckResult(t){e.checkResults.put(t)},addCheckResults(t){for(const n of t)e.checkResults.has(n._id)||e.checkResults.put(n)},deleteCheckResult(t){e.checkResults.delete(t)},clearCheckResults(){e.checkResults.clear()}}))).volatile((e=>({changeManager:new Kj(e),collaborationServerDriver:new Zj(e),inMemoryFileDriver:new Xj(e),desktopFileDriver:n.isElectron?new Qj(e):void 0}))).actions((e=>({afterCreate(){l.addDisposer(e,s.autorun((()=>{const{ontologyManager:t,pluginConfiguration:a}=e,o=a.ontologies;for(const a of o||[]){const[o,i,s,l]=[r.readConfObject(a,"name"),r.readConfObject(a,"version"),r.readConfObject(a,"source"),r.readConfObject(a,"textIndexFields")];if(!t.findOntology(o)){const r=n.getSession(e),{jobsManager:a}=r,c=new AbortController,u=`Loading ontology "${o}"`,f={name:u,statusMessage:`Loading ontology "${o}", version "${i}", this may take a while`,progressPct:0,cancelCallback:()=>{c.abort(),a.abortJob(f.name)}};t.addOntology(o,i,s,{textIndexing:{indexFields:l},update:(e,t)=>{0!==t?100!==t?a.update(u,e,t):a.done(f):a.runJob(f)}})}}})))}}))).views((e=>({getBackendDriver(t){if(!t)return e.collaborationServerDriver;const a=n.getSession(e),{assemblyManager:o}=a,i=o.get(t);if(!i)return e.collaborationServerDriver;const{file:s,internetAccountConfigId:l}=r.getConf(i,["sequence","metadata"]);return n.isElectron&&s?e.desktopFileDriver:l?e.collaborationServerDriver:e.inMemoryFileDriver},getInternetAccount(t,a){if(!(t??a))throw new Error("Must provide either assemblyName or internetAccountId");let o=a;if(t&&!o){const{assemblyManager:a}=n.getSession(e),i=a.get(t);if(!i)throw new Error(`No assembly found with name ${t}`);({internetAccountConfigId:o}=r.getConf(i,["sequence","metadata"]))}const{internetAccounts:i}=e,s=i.find((e=>e.internetAccountId===o));if(!s)throw new Error(`No InternetAccount found with config id ${a}`);return s}}))).actions((e=>({loadFeatures:l.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const[r,a]=yield t.getFeatures(n);if(0===r.length)continue;const{assemblyName:o,refName:i}=n;let s=e.assemblies.get(o);s||(s=e.assemblies.put({_id:o,refSeqs:{}}));const[l]=r;let c=s.refSeqs.get(l.refSeq);c||(c=s.refSeqs.put({_id:l.refSeq,name:i,features:{}}));for(const e of r)c.features.has(e._id)||c.features.put(e);e.addCheckResults(a)}})),loadRefSeq:l.flow((function*(t){for(const n of t){const t=e.getBackendDriver(n.assemblyName);if(!t)return;const{refSeq:r,seq:a}=yield t.getSequence(n),{assemblyName:o,end:i,refName:s,start:l}=n;let c=e.assemblies.get(o);c||(c=e.assemblies.put({_id:o,refSeqs:{}}));let u=c.refSeqs.get(r);u||(u=c.refSeqs.put({_id:r,name:s,sequence:[]})),u.addSequence({start:l,stop:i,sequence:a})}}))})))}(i),u=t.props({apolloDataStore:l.types.optional(c,{typeName:"Client"}),apolloSelectedFeature:l.types.safeReference(i),jobsManager:l.types.optional(Jj,{})}).extend((()=>{const e=s.observable.array([]);return{views:{get collaborators(){return e}},actions:{addOrUpdateCollaborator(t){const n=e.find((e=>e.id===t.id));n?n.locations=t.locations:e.push(t)}}}})).actions((e=>({apolloSetSelectedFeature(t){e.apolloSelectedFeature=t},addApolloTrackConfig(t,n){const a=`apollo_track_${t.name}`;e.tracks.some((e=>e.trackId===a))||e.addTrackConf({type:"ApolloTrack",trackId:a,name:`Annotations (${r.getConf(t,"displayName")||t.name})`,assemblyNames:[t.name],textSearching:{textSearchAdapter:{type:"ApolloTextSearchAdapter",trackId:a,assemblyNames:[t.name],textSearchAdapterId:`apollo_search_${t.name}`,...n?{baseURL:{uri:n,locationType:"UriLocation"}}:{}}}})},broadcastLocations(){const{internetAccounts:t}=l.getRoot(e),n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;t.forEach((t=>{if(void 0!==t.regionNumber){const{assemblyName:r,end:a,refName:o,start:i}=t,s=e.apolloDataStore.assemblies.get(r);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:r,refName:o,start:i,end:a})}}))}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const r=[];for(const e of t)if("baseURL"in e){for(const e of n)r.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(r)}}}))).actions((e=>({afterCreate:l.flow((function*(){s.autorun((()=>{const n=[];for(const t of e.views){if("LinearGenomeView"!==t.type)return;const r=t;if(r.initialized){const{dynamicBlocks:t}=r;t.forEach((t=>{if(void 0!==t.regionNumber){const{assemblyName:r,end:a,refName:o,start:i}=t,s=e.apolloDataStore.assemblies.get(r);s&&"CollaborationServerDriver"===s.backendDriverType&&n.push({assemblyName:r,refName:o,start:i,end:a})}}))}}if(0===n.length){for(const e of t)"baseURL"in e&&e.postUserLocation([]);return}const r=[];for(const e of t)if("baseURL"in e){for(const e of n)r.push({assemblyId:e.assemblyName,refSeq:e.refName,start:e.start,end:e.end});e.postUserLocation(r)}}),{name:"ApolloSession"});const{internetAccounts:t,jbrowse:n,reloadPluginManagerCallback:a}=l.getRoot(e);if(r.readConfObject(n.configuration.ApolloPlugin,"hasRole"))return;const i=l.getSnapshot(e),{id:c,name:u}=i;l.applySnapshot(e,{name:u,id:c});for(const e of t){if("ApolloInternetAccount"!==e.type)continue;const{baseURL:t}=e,n=new URL("jbrowse/config.json",t).href,r=e.getFetcher({locationType:"UriLocation",uri:n});let s,l;try{s=yield r(n,{signal:o})}catch(e){console.error(e);continue}if(s.ok){try{l=yield s.json()}catch(e){console.error(e);continue}a(l,i)}else{const e=yield rp(s,"Failed to fetch assemblies");console.error(e)}}})),beforeDestroy(){a.abort("destroying session model")}}))).views((e=>{const t=e.getTrackActionMenuItems;return{getTrackActionMenuItems(n){if("ApolloTrack"===n.type||"ReferenceSequenceTrack"===n.type)return t?.(n);const a=r.readConfObject(n,"trackId");return a.endsWith("-sessionTrack")?[...t?.(n)??[],{label:"Save track to Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:r}=l.getRoot(e),o=l.getSnapshot(r);let i;i=tr.filterJBrowseConfig(o),0===Object.keys(i).length&&(i=void 0);const s={...l.getSnapshot(n),trackId:a.slice(0,a.length-13)};for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new tr.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:i,newJBrowseConfig:{...i,tracks:i?.tracks&&[...i.tracks,s]}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track added","success")}e.deleteTrackConf(n),r.addTrackConf(s)},icon:Vj}]:[...t?.(n)??[],{label:"Remove track from Apollo",onClick:async()=>{const{internetAccounts:t,jbrowse:r}=l.getRoot(e),o=l.getSnapshot(r);let i;i=tr.filterJBrowseConfig(o),0===Object.keys(i).length&&(i=void 0);const s=i?.tracks?.filter((e=>e.trackId!==a));for(const n of t){if("ApolloInternetAccount"!==n.type)continue;const t=new tr.ImportJBrowseConfigChange({typeName:"ImportJBrowseConfigChange",oldJBrowseConfig:i,newJBrowseConfig:{...i,tracks:s}}),{internetAccountId:r}=n;await e.apolloDataStore.changeManager.submit(t,{internetAccountId:r});const{notify:a}=e;a("Track removed","success")}e.deleteTrackConf(n),r.deleteTrackConf(n)},icon:Vj}]}}}));return l.types.snapshotProcessor(u,{postProcessor(e,t){e.apolloSelectedFeature=void 0;const n=Object.fromEntries(Object.entries(e.apolloDataStore.assemblies).filter((([,e])=>"InMemoryFileDriver"===e.backendDriverType)));if(e.apolloDataStore={typeName:"Client",assemblies:n,checkResults:{}},!t)return e;const{apolloDataStore:r}=t,{checkResults:a}=r;for(const[,t]of a){const[n]=t.ids;if(!n)continue;const a=r.assemblies.get(n.assemblyId);a&&"InMemoryFileDriver"===a.backendDriverType&&(e.apolloDataStore.checkResults[t._id]=l.getSnapshot(t))}return e}})}const tD="WorkerGlobalScope"in globalThis;for(const[e,t]of Object.entries(tr.changes))B.changeRegistry.registerChange(e,t);const nD=new tr.CDSCheck;B.checkRegistry.registerCheck(nD.name,nD),tr.validationRegistry.registerValidation(new tr.CoreValidation),tr.validationRegistry.registerValidation(new tr.ParentChildValidation),e.default=class extends A.default{name="ApolloPlugin";version="0.3.6";configurationSchema=gj;install(e){!function(e){e.addAdapterType((()=>new j.default({name:"ApolloSequenceAdapter",configSchema:RR,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:NR})))}(e),function(e){e.addAdapterType((()=>new j.default({name:"ApolloRefNameAliasAdapter",configSchema:SR,adapterMetadata:{category:void 0,hiddenFromGUI:!0,description:void 0},AdapterClass:xR})))}(e),function(e){e.addTextSearchAdapterType((()=>new a.TextSearchAdapterType({name:"ApolloTextSearchAdapter",displayName:"Apollo text search adapter",configSchema:DR,AdapterClass:jR,description:"Apollo Text Search adapter"})))}(e),e.addWidgetType((()=>{const e=r.ConfigurationSchema("ApolloFeatureDetailsWidget",{});return new a.WidgetType({name:"ApolloFeatureDetailsWidget",heading:"Apollo feature details",configSchema:e,stateModel:_I,ReactComponent:dI})})),e.addWidgetType((()=>{const e=r.ConfigurationSchema("ApolloTranscriptDetails",{});return new a.WidgetType({name:"ApolloTranscriptDetails",heading:"Apollo transcript details",configSchema:e,stateModel:wI,ReactComponent:qF})})),e.addTrackType((()=>{const t=r.ConfigurationSchema("ApolloTrack",{adapter:""},{baseConfiguration:a.createBaseTrackConfig(e),explicitIdentifier:"trackId"});return new a.TrackType({name:"ApolloTrack",configSchema:t,stateModel:a.createBaseTrackModel(e,"ApolloTrack",t)})})),e.addInternetAccountType((()=>new a.InternetAccountType({name:"ApolloInternetAccount",configSchema:Rc,stateModel:_R(Rc)}))),e.addDisplayType((()=>new a.DisplayType({name:"LinearApolloDisplay",configSchema:BF,stateModel:nj(0,BF),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:Gj}))),e.addDisplayType((()=>new a.DisplayType({name:"LinearApolloSixFrameDisplay",configSchema:rj,stateModel:mj(0,rj),trackType:"ApolloTrack",viewType:"LinearGenomeView",ReactComponent:Hj}))),e.addToExtensionPoint("Core-extendSession",eD.bind(this,e)),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,r=t.views((e=>{const t=e.rubberBandMenuItems;return{rubberBandMenuItems:()=>[...t(),{label:"Add new feature",icon:Nc,onClick:()=>{const t=n.getSession(e),{leftOffset:r,rightOffset:a}=e,o=e.getSelectedRegions(r,a);t.queueDialog((e=>[IN,{session:t,handleClose:()=>{e()},region:o[0],changeManager:t.apolloDataStore.changeManager}]))}}]}}));e.stateModel=r}return e})),e.addToExtensionPoint("Core-extendPluggableElement",Sj),e.addToExtensionPoint("Core-extendPluggableElement",Cj),tD||e.addToExtensionPoint("Core-extendWorker",(t=>"on"in t&&t.on?(t.on("apollo",(async n=>{if("object"!=typeof(r=n)||null===r||!("apollo"in r)||!0!==r.apollo)return;var r;const{apollo:a,messageId:o,method:i}=n;switch(i){case"getSequence":{const{region:r}=n,{assemblyName:i}=r,s=e.rootModel?.session?.apolloDataStore;if(!s)break;const l=s.getBackendDriver(i),{seq:c}=await l.getSequence(r);t.workers[0].postMessage({apollo:a,messageId:o,sequence:c});break}case"getRegions":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r),l=await s.getRegions(r);t.workers[0].postMessage({apollo:a,messageId:o,regions:l});break}case"getRefNameAliases":{const{assembly:r}=n,i=e.rootModel?.session?.apolloDataStore;if(!i)break;const s=i.getBackendDriver(r),l=await s.getRefNameAliases(r);t.workers[0].postMessage({apollo:a,messageId:o,refNameAliases:l});break}}})),t):t))}configure(e){n.isAbstractMenuManager(e.rootModel)&&(e.rootModel.appendToMenu("Apollo",{label:"Download GFF3",onClick:e=>{e.queueDialog((t=>[LN,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Manage Checks",onClick:e=>{e.queueDialog((t=>[UN,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"View Change Log",onClick:e=>{e.queueDialog((t=>[QN,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Open local GFF3 file",onClick:e=>{e.queueDialog((t=>[ZN,{session:e,handleClose:()=>{t()},inMemoryFileDriver:e.apolloDataStore.inMemoryFileDriver}]))}}),e.rootModel.appendToMenu("Apollo",{label:"View check results",onClick:e=>{e.queueDialog((t=>[rR,{session:e,handleClose:()=>{t()}}]))}}),e.rootModel.appendToMenu("Apollo",{label:"Log out",onClick:e=>{e.queueDialog((t=>[BN,{session:e,handleClose:()=>{t()}}]))}}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=jbrowse-plugin-apollo.umd.production.min.js.map
